{
  "version": 3,
  "sources": ["../../blockly/core/utils/deprecation.ts", "../../blockly/core/registry.ts", "../../blockly/core/common.ts", "../../blockly/core/utils/idgenerator.ts", "../../blockly/core/events/utils.ts", "../../blockly/core/utils/xml.ts", "../../blockly/core/utils/dom.ts", "../../blockly/core/dialog.ts", "../../blockly/core/interfaces/i_variable_backed_parameter_model.ts", "../../blockly/core/interfaces/i_legacy_procedure_blocks.ts", "../../blockly/core/variables.ts", "../../blockly/core/touch.ts", "../../blockly/core/browser_events.ts", "../../blockly/core/css.ts", "../../blockly/core/utils/style.ts", "../../blockly/core/utils/svg_math.ts", "../../blockly/core/xml.ts", "../../blockly/core/serialization/registry.ts", "../../blockly/core/serialization/blocks.ts", "../../blockly/core/connection.ts", "../../blockly/core/utils/math.ts", "../../blockly/core/dropdowndiv.ts", "../../blockly/core/utils/string.ts", "../../blockly/core/tooltip.ts", "../../blockly/core/utils/colour.ts", "../../blockly/core/utils/parsing.ts", "../../blockly/core/widgetdiv.ts", "../../blockly/core/field_registry.ts", "../../blockly/core/utils/aria.ts", "../../blockly/core/field_dropdown.ts", "../../blockly/core/utils/object.ts", "../../blockly/core/utils/toolbox.ts", "../../blockly/core/extensions.ts", "../../blockly/core/utils/array.ts", "../../blockly/core/block_animations.ts", "../../blockly/core/bump_objects.ts", "../../blockly/core/block_dragger.ts", "../../blockly/core/clipboard.ts", "../../blockly/core/contextmenu.ts", "../../blockly/core/keyboard_nav/ast_node.ts", "../../blockly/core/utils/svg_paths.ts", "../../blockly/core/render_management.ts", "../../blockly/core/contextmenu_items.ts", "../../blockly/core/interfaces/i_procedure_block.ts", "../../blockly/core/interfaces/i_observable.ts", "../../blockly/core/procedures.ts", "../../blockly/core/renderers/common/constants.ts", "../../blockly/core/renderers/common/debug.ts", "../../blockly/core/renderers/common/block_rendering.ts", "../../blockly/core/variables_dynamic.ts", "../../blockly/core/positionable_helpers.ts", "../../blockly/core/workspace_svg.ts", "../../blockly/core/inject.ts", "../../blockly/core/serialization/procedures.ts", "../../blockly/core/serialization/workspaces.ts", "../../blockly/core/shortcut_items.ts", "../../blockly/core/interfaces/i_selectable_toolbox_item.ts", "../../blockly/core/utils.ts", "../../blockly/core/blockly.ts", "../../blockly/src/com/google/javascript/jscomp/js/base.js", "../../blockly/src/com/google/javascript/jscomp/js/util/defines.js", "../../blockly/src/com/google/javascript/jscomp/js/util/defineproperty.js", "../../blockly/src/com/google/javascript/jscomp/js/util/global.js", "../../blockly/src/com/google/javascript/jscomp/js/util/shouldpolyfill.js", "../../blockly/src/com/google/javascript/jscomp/js/util/polyfill.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/globalthis.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/getownpropertydescriptors.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/arrayiterator.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/symbol.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/util/iteratorfromarray.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/values.js", "../../blockly/src/com/google/javascript/jscomp/js/util/owns.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/values.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/array/flat.js", "../../blockly/src/com/google/javascript/jscomp/js/es6/object/entries.js", "../../blockly/closure/goog/base_minimal.js", "../../blockly/closure/goog/goog.js", "../../blockly/core/blocks.ts", "../../blockly/core/input_types.ts", "../../blockly/core/utils/size.ts", "../../blockly/core/msg.ts", "../../blockly/core/events/events_abstract.ts", "../../blockly/core/events/events_var_base.ts", "../../blockly/core/events/events_var_create.ts", "../../blockly/core/variable_model.ts", "../../blockly/core/utils/coordinate.ts", "../../blockly/core/workspace_comment.ts", "../../blockly/core/events/events_ui_base.ts", "../../blockly/core/events/events_selected.ts", "../../blockly/core/utils/useragent.ts", "../../blockly/core/utils/rect.ts", "../../blockly/core/utils/svg.ts", "../../blockly/core/workspace_comment_svg.ts", "../../blockly/core/serialization/exceptions.ts", "../../blockly/core/serialization/priorities.ts", "../../blockly/core/events/events_block_base.ts", "../../blockly/core/events/events_block_create.ts", "../../blockly/core/events/workspace_events.ts", "../../blockly/core/events/events_ui.ts", "../../blockly/core/events/events_block_change.ts", "../../blockly/core/events/events_block_delete.ts", "../../blockly/core/connection_type.ts", "../../blockly/core/constants.ts", "../../blockly/core/marker_manager.ts", "../../blockly/core/field.ts", "../../blockly/core/menu.ts", "../../blockly/core/menuitem.ts", "../../blockly/core/events/events_bubble_open.ts", "../../blockly/core/scrollbar.ts", "../../blockly/core/bubble.ts", "../../blockly/core/config.ts", "../../blockly/core/icon.ts", "../../blockly/core/theme.ts", "../../blockly/core/theme/classic.ts", "../../blockly/core/options.ts", "../../blockly/core/mutator.ts", "../../blockly/core/field_label.ts", "../../blockly/core/input.ts", "../../blockly/core/block.ts", "../../blockly/core/block_drag_surface.ts", "../../blockly/core/events/events_block_drag.ts", "../../blockly/core/component_manager.ts", "../../blockly/core/insertion_marker_manager.ts", "../../blockly/core/comment.ts", "../../blockly/core/contextmenu_registry.ts", "../../blockly/core/internal_constants.ts", "../../blockly/core/keyboard_nav/marker.ts", "../../blockly/core/keyboard_nav/cursor.ts", "../../blockly/core/keyboard_nav/basic_cursor.ts", "../../blockly/core/keyboard_nav/tab_navigate_cursor.ts", "../../blockly/core/rendered_connection.ts", "../../blockly/core/warning.ts", "../../blockly/core/block_svg.ts", "../../blockly/core/bubble_dragger.ts", "../../blockly/core/connection_checker.ts", "../../blockly/core/connection_db.ts", "../../blockly/core/events/events_block_move.ts", "../../blockly/core/events/events_click.ts", "../../blockly/core/events/events_comment_base.ts", "../../blockly/core/events/events_comment_change.ts", "../../blockly/core/events/events_comment_create.ts", "../../blockly/core/events/events_comment_delete.ts", "../../blockly/core/events/events_comment_move.ts", "../../blockly/core/events/events_marker_move.ts", "../../blockly/core/events/events_theme_change.ts", "../../blockly/core/events/events_toolbox_item_select.ts", "../../blockly/core/events/events_trashcan_open.ts", "../../blockly/core/events/events_var_delete.ts", "../../blockly/core/events/events_var_rename.ts", "../../blockly/core/events/events_viewport.ts", "../../blockly/core/events/events.ts", "../../blockly/core/drag_target.ts", "../../blockly/core/delete_area.ts", "../../blockly/core/field_input.ts", "../../blockly/core/field_angle.ts", "../../blockly/core/field_checkbox.ts", "../../blockly/core/field_colour.ts", "../../blockly/core/field_image.ts", "../../blockly/core/field_label_serializable.ts", "../../blockly/core/field_textinput.ts", "../../blockly/core/field_multilineinput.ts", "../../blockly/core/field_number.ts", "../../blockly/core/field_variable.ts", "../../blockly/core/flyout_button.ts", "../../blockly/core/metrics_manager.ts", "../../blockly/core/flyout_metrics_manager.ts", "../../blockly/core/scrollbar_pair.ts", "../../blockly/core/workspace_dragger.ts", "../../blockly/core/gesture.ts", "../../blockly/core/grid.ts", "../../blockly/core/names.ts", "../../blockly/core/observable_procedure_map.ts", "../../blockly/core/renderers/measurables/types.ts", "../../blockly/core/renderers/measurables/base.ts", "../../blockly/core/renderers/measurables/row.ts", "../../blockly/core/renderers/measurables/bottom_row.ts", "../../blockly/core/renderers/measurables/connection.ts", "../../blockly/core/renderers/measurables/input_connection.ts", "../../blockly/core/renderers/measurables/external_value_input.ts", "../../blockly/core/renderers/measurables/field.ts", "../../blockly/core/renderers/measurables/hat.ts", "../../blockly/core/renderers/measurables/icon.ts", "../../blockly/core/renderers/measurables/in_row_spacer.ts", "../../blockly/core/renderers/measurables/inline_input.ts", "../../blockly/core/renderers/measurables/statement_input.ts", "../../blockly/core/renderers/measurables/input_row.ts", "../../blockly/core/renderers/measurables/jagged_edge.ts", "../../blockly/core/renderers/measurables/next_connection.ts", "../../blockly/core/renderers/measurables/output_connection.ts", "../../blockly/core/renderers/measurables/previous_connection.ts", "../../blockly/core/renderers/measurables/round_corner.ts", "../../blockly/core/renderers/measurables/spacer_row.ts", "../../blockly/core/renderers/measurables/square_corner.ts", "../../blockly/core/renderers/measurables/top_row.ts", "../../blockly/core/renderers/common/debugger.ts", "../../blockly/core/renderers/common/drawer.ts", "../../blockly/core/renderers/common/info.ts", "../../blockly/core/renderers/common/marker_svg.ts", "../../blockly/core/renderers/common/path_object.ts", "../../blockly/core/renderers/common/renderer.ts", "../../blockly/core/theme_manager.ts", "../../blockly/core/variable_map.ts", "../../blockly/core/workspace.ts", "../../blockly/core/workspace_audio.ts", "../../blockly/core/sprites.ts", "../../blockly/core/zoom_controls.ts", "../../blockly/core/flyout_base.ts", "../../blockly/core/flyout_horizontal.ts", "../../blockly/core/flyout_vertical.ts", "../../blockly/core/generator.ts", "../../blockly/core/shortcut_registry.ts", "../../blockly/core/workspace_drag_surface_svg.ts", "../../blockly/core/renderers/geras/constants.ts", "../../blockly/core/renderers/geras/highlighter.ts", "../../blockly/core/renderers/geras/drawer.ts", "../../blockly/core/renderers/geras/highlight_constants.ts", "../../blockly/core/renderers/geras/measurables/inline_input.ts", "../../blockly/core/renderers/geras/measurables/statement_input.ts", "../../blockly/core/renderers/geras/info.ts", "../../blockly/core/renderers/geras/path_object.ts", "../../blockly/core/renderers/geras/renderer.ts", "../../blockly/core/renderers/geras/geras.ts", "../../blockly/core/renderers/minimalist/constants.ts", "../../blockly/core/renderers/minimalist/drawer.ts", "../../blockly/core/renderers/minimalist/info.ts", "../../blockly/core/renderers/minimalist/renderer.ts", "../../blockly/core/renderers/minimalist/minimalist.ts", "../../blockly/core/renderers/thrasos/info.ts", "../../blockly/core/renderers/thrasos/renderer.ts", "../../blockly/core/renderers/thrasos/thrasos.ts", "../../blockly/core/renderers/zelos/constants.ts", "../../blockly/core/renderers/zelos/drawer.ts", "../../blockly/core/renderers/zelos/measurables/bottom_row.ts", "../../blockly/core/renderers/zelos/measurables/inputs.ts", "../../blockly/core/renderers/zelos/measurables/row_elements.ts", "../../blockly/core/renderers/zelos/measurables/top_row.ts", "../../blockly/core/renderers/zelos/info.ts", "../../blockly/core/renderers/zelos/marker_svg.ts", "../../blockly/core/renderers/zelos/path_object.ts", "../../blockly/core/renderers/zelos/renderer.ts", "../../blockly/core/renderers/zelos/zelos.ts", "../../blockly/core/serialization/variables.ts", "../../blockly/core/serialization.ts", "../../blockly/core/utils/keycodes.ts", "../../blockly/core/theme/zelos.ts", "../../blockly/core/theme/themes.ts", "../../blockly/core/toolbox/toolbox_item.ts", "../../blockly/core/toolbox/category.ts", "../../blockly/core/toolbox/separator.ts", "../../blockly/core/toolbox/collapsible_category.ts", "../../blockly/core/toolbox/toolbox.ts", "../../blockly/core/trashcan.ts", "../../blockly/core/main.js"],
  "sourcesContent": ["/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.deprecation');\n\n\n/**\n * Warn developers that a function or property is deprecated.\n *\n * @param name The name of the function or property.\n * @param deprecationDate The date of deprecation. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param deletionDate The date of deletion. Prefer 'version n.0.0'\n *     format, and fall back to 'month yyyy' or 'quarter yyyy' format.\n * @param opt_use The name of a function or property to use instead, if any.\n * @internal\n */\nexport function warn(\n    name: string, deprecationDate: string, deletionDate: string,\n    opt_use?: string) {\n  let msg = name + ' was deprecated in ' + deprecationDate +\n      ' and will be deleted in ' + deletionDate + '.';\n  if (opt_use) {\n    msg += '\\nUse ' + opt_use + ' instead.';\n  }\n  console.warn(msg);\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.registry');\n\nimport type {Abstract} from './events/events_abstract.js';\nimport type {Field} from './field.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {ISerializer} from './interfaces/i_serializer.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Options} from './options.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {Theme} from './theme.js';\nimport type {ToolboxItem} from './toolbox/toolbox_item.js';\n\n\n/**\n * A map of maps. With the keys being the type and name of the class we are\n * registering and the value being the constructor function.\n * e.g. {'field': {'field_angle': Blockly.FieldAngle}}\n */\nconst typeMap: {\n  [key: string]:\n      {[key: string]: (new () => AnyDuringMigration)|AnyDuringMigration}\n} = Object.create(null);\nexport const TEST_ONLY = {typeMap};\n\n/**\n * A map of maps. With the keys being the type and caseless name of the class we\n * are registring, and the value being the most recent cased name for that\n * registration.\n */\nconst nameMap: {[key: string]: {[key: string]: string}} = Object.create(null);\n\n/**\n * The string used to register the default class for a type of plugin.\n */\nexport const DEFAULT = 'default';\n\n/**\n * A name with the type of the element stored in the generic.\n */\nexport class Type<_T> {\n  /** @param name The name of the registry type. */\n  constructor(private readonly name: string) {}\n\n  /**\n   * Returns the name of the type.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name;\n  }\n\n  static CONNECTION_CHECKER = new Type<IConnectionChecker>('connectionChecker');\n\n  static CURSOR = new Type<Cursor>('cursor');\n\n  static EVENT = new Type<Abstract>('event');\n\n  static FIELD = new Type<Field>('field');\n\n  static RENDERER = new Type<Renderer>('renderer');\n\n  static TOOLBOX = new Type<IToolbox>('toolbox');\n\n  static THEME = new Type<Theme>('theme');\n\n  static TOOLBOX_ITEM = new Type<ToolboxItem>('toolboxItem');\n\n  static FLYOUTS_VERTICAL_TOOLBOX = new Type<IFlyout>('flyoutsVerticalToolbox');\n\n  static FLYOUTS_HORIZONTAL_TOOLBOX =\n      new Type<IFlyout>('flyoutsHorizontalToolbox');\n\n  static METRICS_MANAGER = new Type<IMetricsManager>('metricsManager');\n\n  static BLOCK_DRAGGER = new Type<IBlockDragger>('blockDragger');\n\n  /** @internal */\n  static SERIALIZER = new Type<ISerializer>('serializer');\n}\n\n/**\n * Registers a class based on a type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param registryItem The class or object to register.\n * @param opt_allowOverrides True to prevent an error when overriding an already\n *     registered item.\n * @throws {Error} if the type or name is empty, a name with the given type has\n *     already been registered, or if the given class or object is not valid for\n *     its type.\n */\nexport function register<T>(\n    type: string|Type<T>, name: string,\n    registryItem: (new (...p1: AnyDuringMigration[]) => T)|null|\n    AnyDuringMigration,\n    opt_allowOverrides?: boolean): void {\n  if (!(type instanceof Type) && typeof type !== 'string' ||\n      `${type}`.trim() === '') {\n    throw Error(\n        'Invalid type \"' + type + '\". The type must be a' +\n        ' non-empty string or a Blockly.registry.Type.');\n  }\n  type = `${type}`.toLowerCase();\n\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error(\n        'Invalid name \"' + name + '\". The name must be a' +\n        ' non-empty string.');\n  }\n  const caselessName = name.toLowerCase();\n  if (!registryItem) {\n    throw Error('Can not register a null value');\n  }\n  let typeRegistry = typeMap[type];\n  let nameRegistry = nameMap[type];\n  // If the type registry has not been created, create it.\n  if (!typeRegistry) {\n    typeRegistry = typeMap[type] = Object.create(null);\n    nameRegistry = nameMap[type] = Object.create(null);\n  }\n\n  // Validate that the given class has all the required properties.\n  validate(type, registryItem);\n\n  // Don't throw an error if opt_allowOverrides is true.\n  if (!opt_allowOverrides && typeRegistry[caselessName]) {\n    throw Error(\n        'Name \"' + caselessName + '\" with type \"' + type +\n        '\" already registered.');\n  }\n  typeRegistry[caselessName] = registryItem;\n  nameRegistry[caselessName] = name;\n}\n\n/**\n * Checks the given registry item for properties that are required based on the\n * type.\n *\n * @param type The type of the plugin. (e.g. Field, Renderer)\n * @param registryItem A class or object that we are checking for the required\n *     properties.\n */\nfunction validate(type: string, registryItem: Function|AnyDuringMigration) {\n  switch (type) {\n    case String(Type.FIELD):\n      if (typeof registryItem.fromJson !== 'function') {\n        throw Error('Type \"' + type + '\" must have a fromJson function');\n      }\n      break;\n  }\n}\n\n/**\n * Unregisters the registry item with the given type and name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n */\nexport function unregister<T>(type: string|Type<T>, name: string) {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    console.warn(\n        'Unable to unregister [' + name + '][' + type + '] from the ' +\n        'registry.');\n    return;\n  }\n  delete typeMap[type][name];\n  delete nameMap[type][name];\n}\n\n/**\n * Gets the registry item for the given name and type. This can be either a\n * class or an object.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class or object with the given name and type or null if none\n *     exists.\n */\nfunction getItem<T>(\n    type: string|Type<T>, name: string, opt_throwIfMissing?: boolean):\n    (new (...p1: AnyDuringMigration[]) => T)|null|AnyDuringMigration {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry || !typeRegistry[name]) {\n    const msg = 'Unable to find [' + name + '][' + type + '] in the registry.';\n    if (opt_throwIfMissing) {\n      throw new Error(\n          msg + ' You must require or register a ' + type + ' plugin.');\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  return typeRegistry[name];\n}\n\n/**\n * Returns whether or not the registry contains an item with the given type and\n * name.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @returns True if the registry has an item with the given type and name, false\n *     otherwise.\n */\nexport function hasItem<T>(type: string|Type<T>, name: string): boolean {\n  type = `${type}`.toLowerCase();\n  name = name.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    return false;\n  }\n  return !!typeRegistry[name];\n}\n\n/**\n * Gets the class for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Field, Renderer)\n * @param name The plugin's name. (Ex. field_angle, geras)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class with the given name and type or null if none exists.\n */\nexport function getClass<T>(\n    type: string|Type<T>, name: string, opt_throwIfMissing?: boolean):\n    (new (...p1: AnyDuringMigration[]) => T)|null {\n  return getItem(type, name, opt_throwIfMissing) as (\n             new (...p1: AnyDuringMigration[]) => T) |\n      null;\n}\n\n/**\n * Gets the object for the given name and type.\n *\n * @param type The type of the plugin.\n *     (e.g. Category)\n * @param name The plugin's name. (Ex. logic_category)\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object.\n * @returns The object with the given name and type or null if none exists.\n */\nexport function getObject<T>(\n    type: string|Type<T>, name: string, opt_throwIfMissing?: boolean): T|null {\n  return getItem(type, name, opt_throwIfMissing) as T;\n}\n\n/**\n * Returns a map of items registered with the given type.\n *\n * @param type The type of the plugin. (e.g. Category)\n * @param opt_cased Whether or not to return a map with cased keys (rather than\n *     caseless keys). False by default.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the object. False by default.\n * @returns A map of objects with the given type, or null if none exists.\n */\nexport function getAllItems<T>(\n    type: string|Type<T>, opt_cased?: boolean, opt_throwIfMissing?: boolean):\n    {[key: string]: T|null|(new (...p1: AnyDuringMigration[]) => T)}|null {\n  type = `${type}`.toLowerCase();\n  const typeRegistry = typeMap[type];\n  if (!typeRegistry) {\n    const msg = `Unable to find [${type}] in the registry.`;\n    if (opt_throwIfMissing) {\n      throw new Error(`${msg} You must require or register a ${type} plugin.`);\n    } else {\n      console.warn(msg);\n    }\n    return null;\n  }\n  if (!opt_cased) {\n    return typeRegistry;\n  }\n  const nameRegistry = nameMap[type];\n  const casedRegistry = Object.create(null);\n  for (const key of Object.keys(typeRegistry)) {\n    casedRegistry[nameRegistry[key]] = typeRegistry[key];\n  }\n  return casedRegistry;\n}\n\n/**\n * Gets the class from Blockly options for the given type.\n * This is used for plugins that override a built in feature. (e.g. Toolbox)\n *\n * @param type The type of the plugin.\n * @param options The option object to check for the given plugin.\n * @param opt_throwIfMissing Whether or not to throw an error if we are unable\n *     to find the plugin.\n * @returns The class for the plugin.\n */\nexport function getClassFromOptions<T>(\n    type: Type<T>, options: Options, opt_throwIfMissing?: boolean):\n    (new (...p1: AnyDuringMigration[]) => T)|null {\n  const plugin = options.plugins[String(type)] || DEFAULT;\n\n  // If the user passed in a plugin class instead of a registered plugin name.\n  if (typeof plugin === 'function') {\n    return plugin;\n  }\n  return getClass(type, plugin, opt_throwIfMissing);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.common');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Block} from './block.js';\nimport {BlockDefinition, Blocks} from './blocks.js';\nimport type {Connection} from './connection.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** Database of all workspaces. */\nconst WorkspaceDB_ = Object.create(null);\n\n\n/**\n * Find the workspace with the specified ID.\n *\n * @param id ID of workspace to find.\n * @returns The sought after workspace or null if not found.\n */\nexport function getWorkspaceById(id: string): Workspace|null {\n  return WorkspaceDB_[id] || null;\n}\n\n/**\n * Find all workspaces.\n *\n * @returns Array of workspaces.\n */\nexport function getAllWorkspaces(): Workspace[] {\n  const workspaces = [];\n  for (const workspaceId in WorkspaceDB_) {\n    workspaces.push(WorkspaceDB_[workspaceId]);\n  }\n  return workspaces;\n}\n\n/**\n * Register a workspace in the workspace db.\n *\n * @param workspace\n */\nexport function registerWorkspace(workspace: Workspace) {\n  WorkspaceDB_[workspace.id] = workspace;\n}\n\n/**\n * Unregister a workspace from the workspace db.\n *\n * @param workspace\n */\nexport function unregisterWorkpace(workspace: Workspace) {\n  delete WorkspaceDB_[workspace.id];\n}\n\n/**\n * The main workspace most recently used.\n * Set by Blockly.WorkspaceSvg.prototype.markFocused\n */\nlet mainWorkspace: Workspace;\n\n/**\n * Returns the last used top level workspace (based on focus).  Try not to use\n * this function, particularly if there are multiple Blockly instances on a\n * page.\n *\n * @returns The main workspace.\n */\nexport function getMainWorkspace(): Workspace {\n  return mainWorkspace;\n}\n\n/**\n * Sets last used main workspace.\n *\n * @param workspace The most recently used top level workspace.\n */\nexport function setMainWorkspace(workspace: Workspace) {\n  mainWorkspace = workspace;\n}\n\n/**\n * Currently selected copyable object.\n */\nlet selected: ICopyable|null = null;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport function getSelected(): ICopyable|null {\n  return selected;\n}\n\n/**\n * Sets the currently selected block. This function does not visually mark the\n * block as selected or fire the required events. If you wish to\n * programmatically select a block, use `BlockSvg#select`.\n *\n * @param newSelection The newly selected block.\n * @internal\n */\nexport function setSelected(newSelection: ICopyable|null) {\n  selected = newSelection;\n}\n\n/**\n * Container element in which to render the WidgetDiv, DropDownDiv and Tooltip.\n */\nlet parentContainer: Element|null;\n\n/**\n * Get the container element in which to render the WidgetDiv, DropDownDiv and\n * Tooltip.\n *\n * @returns The parent container.\n */\nexport function getParentContainer(): Element|null {\n  return parentContainer;\n}\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * DropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param newParent The container element.\n */\nexport function setParentContainer(newParent: Element) {\n  parentContainer = newParent;\n}\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n */\nexport function svgResize(workspace: WorkspaceSvg) {\n  let mainWorkspace = workspace;\n  while (mainWorkspace.options.parentWorkspace) {\n    mainWorkspace = mainWorkspace.options.parentWorkspace;\n  }\n  const svg = mainWorkspace.getParentSvg();\n  const cachedSize = mainWorkspace.getCachedParentSvgSize();\n  const div = svg.parentElement;\n  if (!(div instanceof HTMLElement)) {\n    // Workspace deleted, or something.\n    return;\n  }\n\n  const width = div.offsetWidth;\n  const height = div.offsetHeight;\n  if (cachedSize.width !== width) {\n    svg.setAttribute('width', width + 'px');\n    mainWorkspace.setCachedParentSvgSize(width, null);\n  }\n  if (cachedSize.height !== height) {\n    svg.setAttribute('height', height + 'px');\n    mainWorkspace.setCachedParentSvgSize(null, height);\n  }\n  mainWorkspace.resize();\n}\n\n/**\n * All of the connections on blocks that are currently being dragged.\n */\nexport const draggingConnections: Connection[] = [];\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following\n *    statements (blocks that are not inside a value or statement input\n *    of the block).\n * @returns Map of types to type counts for descendants of the bock.\n */\nexport function getBlockTypeCounts(\n    block: Block, opt_stripFollowing?: boolean): {[key: string]: number} {\n  const typeCountsMap = Object.create(null);\n  const descendants = block.getDescendants(true);\n  if (opt_stripFollowing) {\n    const nextBlock = block.getNextBlock();\n    if (nextBlock) {\n      const index = descendants.indexOf(nextBlock);\n      descendants.splice(index, descendants.length - index);\n    }\n  }\n  for (let i = 0, checkBlock; checkBlock = descendants[i]; i++) {\n    if (typeCountsMap[checkBlock.type]) {\n      typeCountsMap[checkBlock.type]++;\n    } else {\n      typeCountsMap[checkBlock.type] = 1;\n    }\n  }\n  return typeCountsMap;\n}\n\n/**\n * Helper function for defining a block from JSON.  The resulting function has\n * the correct value of jsonDef at the point in code where jsonInit is called.\n *\n * @param jsonDef The JSON definition of a block.\n * @returns A function that calls jsonInit with the correct value\n *     of jsonDef.\n */\nfunction jsonInitFactory(jsonDef: AnyDuringMigration): () => void {\n  return function(this: Block) {\n    this.jsonInit(jsonDef);\n  };\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n */\nexport function defineBlocksWithJsonArray(jsonArray: AnyDuringMigration[]) {\n  TEST_ONLY.defineBlocksWithJsonArrayInternal(jsonArray);\n}\n\n/**\n * Private version of defineBlocksWithJsonArray for stubbing in tests.\n */\nfunction defineBlocksWithJsonArrayInternal(jsonArray: AnyDuringMigration[]) {\n  defineBlocks(createBlockDefinitionsFromJsonArray(jsonArray));\n}\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @returns A map of the block\n *     definitions created.\n */\nexport function createBlockDefinitionsFromJsonArray(\n    jsonArray: AnyDuringMigration[]): {[key: string]: BlockDefinition} {\n  const blocks: {[key: string]: BlockDefinition} = {};\n  for (let i = 0; i < jsonArray.length; i++) {\n    const elem = jsonArray[i];\n    if (!elem) {\n      console.warn(`Block definition #${i} in JSON array is ${elem}. Skipping`);\n      continue;\n    }\n    const type = elem['type'];\n    if (!type) {\n      console.warn(\n          `Block definition #${i} in JSON array is missing a type attribute. ` +\n          'Skipping.');\n      continue;\n    }\n    blocks[type] = {init: jsonInitFactory(elem)};\n  }\n  return blocks;\n}\n\n/**\n * Add the specified block definitions to the block definitions\n * dictionary (Blockly.Blocks).\n *\n * @param blocks A map of block\n *     type names to block definitions.\n */\nexport function defineBlocks(blocks: {[key: string]: BlockDefinition}) {\n  // Iterate over own enumerable properties.\n  for (const type of Object.keys(blocks)) {\n    const definition = blocks[type];\n    if (type in Blocks) {\n      console.warn(`Block definiton \"${type}\" overwrites previous definition.`);\n    }\n    Blocks[type] = definition;\n  }\n}\n\nexport const TEST_ONLY = {defineBlocksWithJsonArrayInternal};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.idGenerator');\n\n/**\n * Legal characters for the universally unique IDs.  Should be all on\n * a US keyboard.  No characters that conflict with XML or JSON.\n * Requests to remove additional 'problematic' characters from this\n * soup will be denied.  That's your failure to properly escape in\n * your own environment.  Issues #251, #625, #682, #1304.\n */\nconst soup = '!#$%()*+,-./:;=?@[]^_`{|}~' +\n    'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n\n/**\n * Namespace object for internal implementations we want to be able to\n * stub in tests. Do not use externally.\n *\n * @internal\n */\nconst internal = {\n  /**\n   * Generate a random unique ID.  This should be globally unique.\n   * 87 characters ^ 20 length is greater than 128 bits (better than a UUID).\n   *\n   * @returns A globally unique ID string.\n   */\n  genUid: () => {\n    const length = 20;\n    const soupLength = soup.length;\n    const id = [];\n    for (let i = 0; i < length; i++) {\n      id[i] = soup.charAt(Math.random() * soupLength);\n    }\n    return id.join('');\n  },\n};\nexport const TEST_ONLY = internal;\n\n/** Next unique ID to use. */\nlet nextId = 0;\n\n/**\n * Generate the next unique element IDs.\n * IDs are compatible with the HTML4 'id' attribute restrictions:\n * Use only ASCII letters, digits, '_', '-' and '.'\n *\n * For UUIDs use genUid (below) instead; this ID generator should\n * primarily be used for IDs that end up in the DOM.\n *\n * @returns The next unique identifier.\n */\nexport function getNextUniqueId(): string {\n  return 'blockly-' + (nextId++).toString(36);\n}\n\n/**\n * Generate a random unique ID.\n *\n * @see internal.genUid\n * @returns A globally unique ID string.\n */\nexport function genUid(): string {\n  return internal.genUid();\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.utils');\n\nimport type {Block} from '../block.js';\nimport * as common from '../common.js';\nimport * as registry from '../registry.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type {Workspace} from '../workspace.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {Abstract} from './events_abstract.js';\nimport type {BlockChange} from './events_block_change.js';\nimport type {BlockCreate} from './events_block_create.js';\nimport type {BlockMove} from './events_block_move.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentMove} from './events_comment_move.js';\nimport type {ViewportChange} from './events_viewport.js';\n\n\n/** Group ID for new events.  Grouped events are indivisible. */\nlet group = '';\n\n/** Sets whether the next event should be added to the undo stack. */\nlet recordUndo = true;\n\n/**\n * Sets whether events should be added to the undo stack.\n *\n * @param newValue True if events should be added to the undo stack.\n */\nexport function setRecordUndo(newValue: boolean) {\n  recordUndo = newValue;\n}\n\n/**\n * Returns whether or not events will be added to the undo stack.\n *\n * @returns True if events will be added to the undo stack.\n */\nexport function getRecordUndo(): boolean {\n  return recordUndo;\n}\n\n/** Allow change events to be created and fired. */\nlet disabled = 0;\n\n/**\n * Name of event that creates a block. Will be deprecated for BLOCK_CREATE.\n */\nexport const CREATE = 'create';\n\n/**\n * Name of event that creates a block.\n */\nexport const BLOCK_CREATE = CREATE;\n\n/**\n * Name of event that deletes a block. Will be deprecated for BLOCK_DELETE.\n */\nexport const DELETE = 'delete';\n\n/**\n * Name of event that deletes a block.\n */\nexport const BLOCK_DELETE = DELETE;\n\n/**\n * Name of event that changes a block. Will be deprecated for BLOCK_CHANGE.\n */\nexport const CHANGE = 'change';\n\n/**\n * Name of event that changes a block.\n */\nexport const BLOCK_CHANGE = CHANGE;\n\n/**\n * Name of event that moves a block. Will be deprecated for BLOCK_MOVE.\n */\nexport const MOVE = 'move';\n\n/**\n * Name of event that moves a block.\n */\nexport const BLOCK_MOVE = MOVE;\n\n/**\n * Name of event that creates a variable.\n */\nexport const VAR_CREATE = 'var_create';\n\n/**\n * Name of event that deletes a variable.\n */\nexport const VAR_DELETE = 'var_delete';\n\n/**\n * Name of event that renames a variable.\n */\nexport const VAR_RENAME = 'var_rename';\n\n/**\n * Name of generic event that records a UI change.\n */\nexport const UI = 'ui';\n\n/**\n * Name of event that record a block drags a block.\n */\nexport const BLOCK_DRAG = 'drag';\n\n/**\n * Name of event that records a change in selected element.\n */\nexport const SELECTED = 'selected';\n\n/**\n * Name of event that records a click.\n */\nexport const CLICK = 'click';\n\n/**\n * Name of event that records a marker move.\n */\nexport const MARKER_MOVE = 'marker_move';\n\n/**\n * Name of event that records a bubble open.\n */\nexport const BUBBLE_OPEN = 'bubble_open';\n\n/**\n * Name of event that records a trashcan open.\n */\nexport const TRASHCAN_OPEN = 'trashcan_open';\n\n/**\n * Name of event that records a toolbox item select.\n */\nexport const TOOLBOX_ITEM_SELECT = 'toolbox_item_select';\n\n/**\n * Name of event that records a theme change.\n */\nexport const THEME_CHANGE = 'theme_change';\n\n/**\n * Name of event that records a viewport change.\n */\nexport const VIEWPORT_CHANGE = 'viewport_change';\n\n/**\n * Name of event that creates a comment.\n */\nexport const COMMENT_CREATE = 'comment_create';\n\n/**\n * Name of event that deletes a comment.\n */\nexport const COMMENT_DELETE = 'comment_delete';\n\n/**\n * Name of event that changes a comment.\n */\nexport const COMMENT_CHANGE = 'comment_change';\n\n/**\n * Name of event that moves a comment.\n */\nexport const COMMENT_MOVE = 'comment_move';\n\n/**\n * Name of event that records a workspace load.\n */\nexport const FINISHED_LOADING = 'finished_loading';\n\n/**\n * Type of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport type BumpEvent = BlockCreate|BlockMove|CommentCreate|CommentMove;\n\n/**\n * List of events that cause objects to be bumped back into the visible\n * portion of the workspace.\n *\n * Not to be confused with bumping so that disconnected connections do not\n * appear connected.\n */\nexport const BUMP_EVENTS: string[] =\n    [BLOCK_CREATE, BLOCK_MOVE, COMMENT_CREATE, COMMENT_MOVE];\n\n/** List of events queued for firing. */\nconst FIRE_QUEUE: Abstract[] = [];\n\n/**\n * Create a custom event and fire it.\n *\n * @param event Custom data for event.\n */\nexport function fire(event: Abstract) {\n  TEST_ONLY.fireInternal(event);\n}\n\n/**\n * Private version of fireInternal for stubbing in tests.\n */\nfunction fireInternal(event: Abstract) {\n  if (!isEnabled()) {\n    return;\n  }\n  if (!FIRE_QUEUE.length) {\n    // First event added; schedule a firing of the event queue.\n    try {\n      // If we are in a browser context, we want to make sure that the event\n      // fires after blocks have been rerendered this frame.\n      requestAnimationFrame(() => {\n        setTimeout(fireNow, 0);\n      });\n    } catch (e) {\n      // Otherwise we just want to delay so events can be coallesced.\n      // requestAnimationFrame will error triggering this.\n      setTimeout(fireNow, 0);\n    }\n  }\n  FIRE_QUEUE.push(event);\n}\n\n\n/** Fire all queued events. */\nfunction fireNow() {\n  const queue = filter(FIRE_QUEUE, true);\n  FIRE_QUEUE.length = 0;\n  for (let i = 0, event; event = queue[i]; i++) {\n    if (!event.workspaceId) {\n      continue;\n    }\n    const eventWorkspace = common.getWorkspaceById(event.workspaceId);\n    if (eventWorkspace) {\n      eventWorkspace.fireChangeListener(event);\n    }\n  }\n}\n\n/**\n * Filter the queued events and merge duplicates.\n *\n * @param queueIn Array of events.\n * @param forward True if forward (redo), false if backward (undo).\n * @returns Array of filtered events.\n */\nexport function filter(queueIn: Abstract[], forward: boolean): Abstract[] {\n  let queue = queueIn.slice();\n  // Shallow copy of queue.\n  if (!forward) {\n    // Undo is merged in reverse order.\n    queue.reverse();\n  }\n  const mergedQueue = [];\n  const hash = Object.create(null);\n  // Merge duplicates.\n  for (let i = 0, event; event = queue[i]; i++) {\n    if (!event.isNull()) {\n      // Treat all UI events as the same type in hash table.\n      const eventType = event.isUiEvent ? UI : event.type;\n      // TODO(#5927): Check whether `blockId` exists before accessing it.\n      const blockId = (event as AnyDuringMigration).blockId;\n      const key = [eventType, blockId, event.workspaceId].join(' ');\n\n      const lastEntry = hash[key];\n      const lastEvent = lastEntry ? lastEntry.event : null;\n      if (!lastEntry) {\n        // Each item in the hash table has the event and the index of that event\n        // in the input array.  This lets us make sure we only merge adjacent\n        // move events.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      } else if (event.type === MOVE && lastEntry.index === i - 1) {\n        const moveEvent = event as BlockMove;\n        // Merge move events.\n        lastEvent.newParentId = moveEvent.newParentId;\n        lastEvent.newInputName = moveEvent.newInputName;\n        lastEvent.newCoordinate = moveEvent.newCoordinate;\n        lastEntry.index = i;\n      } else if (\n          event.type === CHANGE &&\n          (event as BlockChange).element === lastEvent.element &&\n          (event as BlockChange).name === lastEvent.name) {\n        const changeEvent = event as BlockChange;\n        // Merge change events.\n        lastEvent.newValue = changeEvent.newValue;\n      } else if (event.type === VIEWPORT_CHANGE) {\n        const viewportEvent = event as ViewportChange;\n        // Merge viewport change events.\n        lastEvent.viewTop = viewportEvent.viewTop;\n        lastEvent.viewLeft = viewportEvent.viewLeft;\n        lastEvent.scale = viewportEvent.scale;\n        lastEvent.oldScale = viewportEvent.oldScale;\n      } else if (event.type === CLICK && lastEvent.type === BUBBLE_OPEN) {\n        // Drop click events caused by opening/closing bubbles.\n      } else {\n        // Collision: newer events should merge into this event to maintain\n        // order.\n        hash[key] = {event, index: i};\n        mergedQueue.push(event);\n      }\n    }\n  }\n  // Filter out any events that have become null due to merging.\n  queue = mergedQueue.filter(function(e) {\n    return !e.isNull();\n  });\n  if (!forward) {\n    // Restore undo order.\n    queue.reverse();\n  }\n  // Move mutation events to the top of the queue.\n  // Intentionally skip first event.\n  for (let i = 1, event; event = queue[i]; i++) {\n    // AnyDuringMigration because:  Property 'element' does not exist on type\n    // 'Abstract'.\n    if (event.type === CHANGE &&\n        (event as AnyDuringMigration).element === 'mutation') {\n      queue.unshift(queue.splice(i, 1)[0]);\n    }\n  }\n  return queue;\n}\n\n/**\n * Modify pending undo events so that when they are fired they don't land\n * in the undo stack.  Called by Workspace.clearUndo.\n */\nexport function clearPendingUndo() {\n  for (let i = 0, event; event = FIRE_QUEUE[i]; i++) {\n    event.recordUndo = false;\n  }\n}\n\n/**\n * Stop sending events.  Every call to this function MUST also call enable.\n */\nexport function disable() {\n  disabled++;\n}\n\n/**\n * Start sending events.  Unless events were already disabled when the\n * corresponding call to disable was made.\n */\nexport function enable() {\n  disabled--;\n}\n\n/**\n * Returns whether events may be fired or not.\n *\n * @returns True if enabled.\n */\nexport function isEnabled(): boolean {\n  return disabled === 0;\n}\n\n/**\n * Current group.\n *\n * @returns ID string.\n */\nexport function getGroup(): string {\n  return group;\n}\n\n/**\n * Start or stop a group.\n *\n * @param state True to start new group, false to end group.\n *   String to set group explicitly.\n */\nexport function setGroup(state: boolean|string) {\n  TEST_ONLY.setGroupInternal(state);\n}\n\n/**\n * Private version of setGroup for stubbing in tests.\n */\nfunction setGroupInternal(state: boolean|string) {\n  if (typeof state === 'boolean') {\n    group = state ? idGenerator.genUid() : '';\n  } else {\n    group = state;\n  }\n}\n\n/**\n * Compute a list of the IDs of the specified block and all its descendants.\n *\n * @param block The root block.\n * @returns List of block IDs.\n * @internal\n */\nexport function getDescendantIds(block: Block): string[] {\n  const ids = [];\n  const descendants = block.getDescendants(false);\n  for (let i = 0, descendant; descendant = descendants[i]; i++) {\n    ids[i] = descendant.id;\n  }\n  return ids;\n}\n\n/**\n * Decode the JSON into an event.\n *\n * @param json JSON representation.\n * @param workspace Target workspace for event.\n * @returns The event represented by the JSON.\n * @throws {Error} if an event type is not found in the registry.\n */\nexport function fromJson(\n    json: AnyDuringMigration, workspace: Workspace): Abstract {\n  const eventClass = get(json['type']);\n  if (!eventClass) throw Error('Unknown event type.');\n\n  if (eventClassHasStaticFromJson(eventClass)) {\n    return (eventClass as any).fromJson(json, workspace);\n  }\n\n  // Fallback to the old deserialization method.\n  const event = new eventClass();\n  event.fromJson(json);\n  event.workspaceId = workspace.id;\n  return event;\n}\n\n/**\n * Returns true if the given event constructor has /its own/ static fromJson\n * method.\n *\n * Returns false if no static fromJson method exists on the contructor, or if\n * the static fromJson method is inheritted.\n */\nfunction eventClassHasStaticFromJson(eventClass: new (...p: any[]) => Abstract):\n    boolean {\n  const untypedEventClass = eventClass as any;\n  return Object.getOwnPropertyDescriptors(untypedEventClass).fromJson &&\n      typeof untypedEventClass.fromJson === 'function';\n}\n\n/**\n * Gets the class for a specific event type from the registry.\n *\n * @param eventType The type of the event to get.\n * @returns The event class with the given type.\n */\nexport function get(eventType: string):\n    (new (...p1: AnyDuringMigration[]) => Abstract) {\n  const event = registry.getClass(registry.Type.EVENT, eventType);\n  if (!event) {\n    throw new Error(`Event type ${eventType} not found in registry.`);\n  }\n  return event;\n}\n\n/**\n * Enable/disable a block depending on whether it is properly connected.\n * Use this on applications where all blocks should be connected to a top block.\n * Recommend setting the 'disable' option to 'false' in the config so that\n * users don't try to re-enable disabled orphan blocks.\n *\n * @param event Custom data for event.\n */\nexport function disableOrphans(event: Abstract) {\n  if (event.type === MOVE || event.type === CREATE) {\n    const blockEvent = event as BlockMove | BlockCreate;\n    if (!blockEvent.workspaceId) {\n      return;\n    }\n    const eventWorkspace =\n        common.getWorkspaceById(blockEvent.workspaceId) as WorkspaceSvg;\n    if (!blockEvent.blockId) {\n      throw new Error('Encountered a blockEvent without a proper blockId');\n    }\n    let block = eventWorkspace.getBlockById(blockEvent.blockId);\n    if (block) {\n      // Changing blocks as part of this event shouldn't be undoable.\n      const initialUndoFlag = recordUndo;\n      try {\n        recordUndo = false;\n        const parent = block.getParent();\n        if (parent && parent.isEnabled()) {\n          const children = block.getDescendants(false);\n          for (let i = 0, child; child = children[i]; i++) {\n            child.setEnabled(true);\n          }\n        } else if (\n            (block.outputConnection || block.previousConnection) &&\n            !eventWorkspace.isDragging()) {\n          do {\n            block.setEnabled(false);\n            block = block.getNextBlock();\n          } while (block);\n        }\n      } finally {\n        recordUndo = initialUndoFlag;\n      }\n    }\n  }\n}\n\nexport const TEST_ONLY = {\n  FIRE_QUEUE,\n  fireNow,\n  fireInternal,\n  setGroupInternal,\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.xml');\n\nimport * as deprecation from './deprecation.js';\n\n\n/**\n * Injected dependencies.  By default these are just (and have the\n * same types as) the corresponding DOM Window properties, but the\n * Node.js wrapper for Blockly (see scripts/package/node/core.js)\n * calls injectDependencies to supply implementations from the jsdom\n * package instead.\n */\nlet {document, DOMParser, XMLSerializer} = globalThis;\n\n/**\n * Inject implementations of document, DOMParser and/or XMLSerializer\n * to use instead of the default ones.\n *\n * Used by the Node.js wrapper for Blockly (see\n * scripts/package/node/core.js) to supply implementations from the\n * jsdom package instead.\n *\n * While they may be set individually, it is normally the case that\n * all three will be sourced from the same JSDOM instance.  They MUST\n * at least come from the same copy of the jsdom package.  (Typically\n * this is hard to avoid satsifying this requirement, but it can be\n * inadvertently violated by using webpack to build multiple bundles\n * containing Blockly and jsdom, and then loading more than one into\n * the same JavaScript runtime.  See\n * https://github.com/google/blockly-samples/pull/1452#issuecomment-1364442135\n * for an example of how this happened.)\n *\n * @param dependencies Options object containing dependencies to set.\n */\nexport function injectDependencies(dependencies: {\n  document?: Document,\n  DOMParser?: typeof DOMParser,\n  XMLSerializer?: typeof XMLSerializer,\n}) {\n  ({\n    // Default to existing value if option not supplied.\n    document = document,\n    DOMParser = DOMParser,\n    XMLSerializer = XMLSerializer,\n  } = dependencies);\n}\n\n/**\n * Namespace for Blockly's XML.\n */\nexport const NAME_SPACE = 'https://developers.google.com/blockly/xml';\n\n/**\n * Get the document object to use for XML serialization.\n *\n * @returns The document object.\n * @deprecated No longer provided by Blockly.\n */\nexport function getDocument(): Document {\n  deprecation.warn('Blockly.utils.xml.getDocument', 'version 9', 'version 10');\n  return document;\n}\n\n/**\n * Get the document object to use for XML serialization.\n *\n * @param xmlDocument The document object to use.\n * @deprecated No longer provided by Blockly.\n */\nexport function setDocument(xmlDocument: Document) {\n  deprecation.warn('Blockly.utils.xml.setDocument', 'version 9', 'version 10');\n  document = xmlDocument;\n}\n\n/**\n * Create DOM element for XML.\n *\n * @param tagName Name of DOM element.\n * @returns New DOM element.\n */\nexport function createElement(tagName: string): Element {\n  return document.createElementNS(NAME_SPACE, tagName);\n}\n\n/**\n * Create text element for XML.\n *\n * @param text Text content.\n * @returns New DOM text node.\n */\nexport function createTextNode(text: string): Text {\n  return document.createTextNode(text);\n}\n\n/**\n * Converts an XML string into a DOM structure.\n *\n * @param text An XML string.\n * @returns A DOM object representing the singular child of the document\n *     element.\n * @throws if the text doesn't parse.\n */\nexport function textToDom(text: string): Element {\n  const doc = textToDomDocument(text);\n  if (!doc || !doc.documentElement ||\n      doc.getElementsByTagName('parsererror').length) {\n    throw Error('textToDom was unable to parse: ' + text);\n  }\n  return doc.documentElement;\n}\n\n/**\n * Converts an XML string into a DOM tree.\n *\n * @param text XML string.\n * @returns The DOM document.\n * @throws if XML doesn't parse.\n */\nexport function textToDomDocument(text: string): Document {\n  const oParser = new DOMParser();\n  return oParser.parseFromString(text, 'text/xml');\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  const oSerializer = new XMLSerializer();\n  return oSerializer.serializeToString(dom);\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.dom');\n\nimport type {Svg} from './svg.js';\n\n\n/**\n * Required name space for SVG elements.\n */\nexport const SVG_NS = 'http://www.w3.org/2000/svg';\n\n/**\n * Required name space for HTML elements.\n */\nexport const HTML_NS = 'http://www.w3.org/1999/xhtml';\n\n/**\n * Required name space for XLINK elements.\n */\nexport const XLINK_NS = 'http://www.w3.org/1999/xlink';\n\n/**\n * Node type constants.\n * https://developer.mozilla.org/en-US/docs/Web/API/Node/nodeType\n */\nexport enum NodeType {\n  ELEMENT_NODE = 1,\n  TEXT_NODE = 3,\n  COMMENT_NODE = 8,\n  DOCUMENT_POSITION_CONTAINED_BY = 16\n}\n\n/** Temporary cache of text widths. */\nlet cacheWidths: {[key: string]: number}|null = null;\n\n/** Number of current references to cache. */\nlet cacheReference = 0;\n\n/** A HTML canvas context used for computing text width. */\nlet canvasContext: CanvasRenderingContext2D|null = null;\n\n/**\n * Helper method for creating SVG elements.\n *\n * @param name Element's tag name.\n * @param attrs Dictionary of attribute names and values.\n * @param opt_parent Optional parent on which to append the element.\n * @returns if name is a string or a more specific type if it a member of Svg.\n */\nexport function createSvgElement<T extends SVGElement>(\n    name: string|Svg<T>, attrs: {[key: string]: string|number},\n    opt_parent?: Element|null): T {\n  const e = document.createElementNS(SVG_NS, `${name}`) as T;\n  for (const key in attrs) {\n    e.setAttribute(key, `${attrs[key]}`);\n  }\n  if (opt_parent) {\n    opt_parent.appendChild(e);\n  }\n  return e;\n}\n\n/**\n * Add a CSS class to a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to add class to.\n * @param className Name of class to add.\n * @returns True if class was added, false if already present.\n */\nexport function addClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.add(...classNames);\n  return true;\n}\n\n/**\n * Removes multiple classes from an element.\n *\n * @param element DOM element to remove classes from.\n * @param classNames A string of one or multiple class names for an element.\n */\nexport function removeClasses(element: Element, classNames: string) {\n  element.classList.remove(...classNames.split(' '));\n}\n\n/**\n * Remove a CSS class from a element.\n *\n * Handles multiple space-separated classes for legacy reasons.\n *\n * @param element DOM element to remove class from.\n * @param className Name of class to remove.\n * @returns True if class was removed, false if never present.\n */\nexport function removeClass(element: Element, className: string): boolean {\n  const classNames = className.split(' ');\n  if (classNames.every((name) => !element.classList.contains(name))) {\n    return false;\n  }\n  element.classList.remove(...classNames);\n  return true;\n}\n\n/**\n * Checks if an element has the specified CSS class.\n *\n * @param element DOM element to check.\n * @param className Name of class to check.\n * @returns True if class exists, false otherwise.\n */\nexport function hasClass(element: Element, className: string): boolean {\n  return element.classList.contains(className);\n}\n\n/**\n * Removes a node from its parent. No-op if not attached to a parent.\n *\n * @param node The node to remove.\n * @returns The node removed if removed; else, null.\n */\n// Copied from Closure goog.dom.removeNode\nexport function removeNode(node: Node|null): Node|null {\n  return node && node.parentNode ? node.parentNode.removeChild(node) : null;\n}\n\n/**\n * Insert a node after a reference node.\n * Contrast with node.insertBefore function.\n *\n * @param newNode New element to insert.\n * @param refNode Existing element to precede new node.\n */\nexport function insertAfter(newNode: Element, refNode: Element) {\n  const siblingNode = refNode.nextSibling;\n  const parentNode = refNode.parentNode;\n  if (!parentNode) {\n    throw Error('Reference node has no parent.');\n  }\n  if (siblingNode) {\n    parentNode.insertBefore(newNode, siblingNode);\n  } else {\n    parentNode.appendChild(newNode);\n  }\n}\n\n/**\n * Whether a node contains another node.\n *\n * @param parent The node that should contain the other node.\n * @param descendant The node to test presence of.\n * @returns Whether the parent node contains the descendant node.\n */\nexport function containsNode(parent: Node, descendant: Node): boolean {\n  return !!(\n      parent.compareDocumentPosition(descendant) &\n      NodeType.DOCUMENT_POSITION_CONTAINED_BY);\n}\n\n/**\n * Sets the CSS transform property on an element. This function sets the\n * non-vendor-prefixed and vendor-prefixed versions for backwards compatibility\n * with older browsers. See https://caniuse.com/#feat=transforms2d\n *\n * @param element Element to which the CSS transform will be applied.\n * @param transform The value of the CSS `transform` property.\n */\nexport function setCssTransform(\n    element: HTMLElement|SVGElement, transform: string) {\n  element.style['transform'] = transform;\n  element.style['-webkit-transform' as any] = transform;\n}\n\n/**\n * Start caching text widths. Every call to this function MUST also call\n * stopTextWidthCache. Caches must not survive between execution threads.\n */\nexport function startTextWidthCache() {\n  cacheReference++;\n  if (!cacheWidths) {\n    cacheWidths = Object.create(null);\n  }\n}\n\n/**\n * Stop caching field widths. Unless caching was already on when the\n * corresponding call to startTextWidthCache was made.\n */\nexport function stopTextWidthCache() {\n  cacheReference--;\n  if (!cacheReference) {\n    cacheWidths = null;\n  }\n}\n\n/**\n * Gets the width of a text element, caching it in the process.\n *\n * @param textElement An SVG 'text' element.\n * @returns Width of element.\n */\nexport function getTextWidth(textElement: SVGTextElement): number {\n  const key = textElement.textContent + '\\n' + textElement.className.baseVal;\n  let width;\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  // Attempt to compute fetch the width of the SVG text element.\n  try {\n    width = textElement.getComputedTextLength();\n  } catch (e) {\n    // In other cases where we fail to get the computed text. Instead, use an\n    // approximation and do not cache the result. At some later point in time\n    // when the block is inserted into the visible DOM, this method will be\n    // called again and, at that point in time, will not throw an exception.\n    return textElement.textContent!.length * 8;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidth(\n    textElement: SVGTextElement, fontSize: number, fontWeight: string,\n    fontFamily: string): number {\n  return getFastTextWidthWithSizeString(\n      textElement, fontSize + 'pt', fontWeight, fontFamily);\n}\n\n/**\n * Gets the width of a text element using a faster method than `getTextWidth`.\n * This method requires that we know the text element's font family and size in\n * advance. Similar to `getTextWidth`, we cache the width we compute.\n * This method is similar to `getFastTextWidth` but expects the font size\n * parameter to be a string.\n *\n * @param textElement An SVG 'text' element.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Width of element.\n */\nexport function getFastTextWidthWithSizeString(\n    textElement: SVGTextElement, fontSize: string, fontWeight: string,\n    fontFamily: string): number {\n  const text = textElement.textContent;\n  const key = text + '\\n' + textElement.className.baseVal;\n  let width;\n\n  // Return the cached width if it exists.\n  if (cacheWidths) {\n    width = cacheWidths[key];\n    if (width) {\n      return width;\n    }\n  }\n\n  if (!canvasContext) {\n    // Inject the canvas element used for computing text widths.\n    const computeCanvas = (document.createElement('canvas'));\n    computeCanvas.className = 'blocklyComputeCanvas';\n    document.body.appendChild(computeCanvas);\n\n    // Initialize the HTML canvas context and set the font.\n    // The context font must match blocklyText's fontsize and font-family\n    // set in CSS.\n    canvasContext = computeCanvas.getContext('2d') as CanvasRenderingContext2D;\n  }\n  // Set the desired font size and family.\n  canvasContext.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n\n  // Measure the text width using the helper canvas context.\n  if (text) {\n    width = canvasContext.measureText(text).width;\n  } else {\n    width = 0;\n  }\n\n  // Cache the computed width and return.\n  if (cacheWidths) {\n    cacheWidths[key] = width;\n  }\n  return width;\n}\n\n/**\n * Measure a font's metrics. The height and baseline values.\n *\n * @param text Text to measure the font dimensions of.\n * @param fontSize The font size to use.\n * @param fontWeight The font weight to use.\n * @param fontFamily The font family to use.\n * @returns Font measurements.\n */\nexport function measureFontMetrics(\n    text: string, fontSize: string, fontWeight: string,\n    fontFamily: string): {height: number, baseline: number} {\n  const span = (document.createElement('span'));\n  span.style.font = fontWeight + ' ' + fontSize + ' ' + fontFamily;\n  span.textContent = text;\n\n  const block = (document.createElement('div'));\n  block.style.width = '1px';\n  block.style.height = '0';\n\n  const div = (document.createElement('div'));\n  div.setAttribute('style', 'position: fixed; top: 0; left: 0; display: flex;');\n  div.appendChild(span);\n  div.appendChild(block);\n\n  document.body.appendChild(div);\n  const result = {\n    height: 0,\n    baseline: 0,\n  };\n  try {\n    div.style.alignItems = 'baseline';\n    result.baseline = block.offsetTop - span.offsetTop;\n    div.style.alignItems = 'flex-end';\n    result.height = block.offsetTop - span.offsetTop;\n  } finally {\n    document.body.removeChild(div);\n  }\n  return result;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.dialog');\n\n\nlet alertImplementation = function(message: string, opt_callback?: () => void) {\n  window.alert(message);\n  if (opt_callback) {\n    opt_callback();\n  }\n};\n\nlet confirmImplementation = function(\n    message: string, callback: (result: boolean) => void) {\n  callback(window.confirm(message));\n};\n\nlet promptImplementation = function(\n    message: string, defaultValue: string,\n    callback: (result: string|null) => void) {\n  callback(window.prompt(message, defaultValue));\n};\n\n/**\n * Wrapper to window.alert() that app developers may override via setAlert to\n * provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param opt_callback The callback when the alert is dismissed.\n */\nexport function alert(message: string, opt_callback?: () => void) {\n  alertImplementation(message, opt_callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.alert() is called.\n *\n * @param alertFunction The function to be run.\n * @see Blockly.dialog.alert\n */\nexport function setAlert(alertFunction: (p1: string, p2?: () => void) => void) {\n  alertImplementation = alertFunction;\n}\n\n/**\n * Wrapper to window.confirm() that app developers may override via setConfirm\n * to provide alternatives to the modal browser window.\n *\n * @param message The message to display to the user.\n * @param callback The callback for handling user response.\n */\nexport function confirm(message: string, callback: (p1: boolean) => void) {\n  TEST_ONLY.confirmInternal(message, callback);\n}\n\n/**\n * Private version of confirm for stubbing in tests.\n */\nfunction confirmInternal(message: string, callback: (p1: boolean) => void) {\n  confirmImplementation(message, callback);\n}\n\n\n/**\n * Sets the function to be run when Blockly.dialog.confirm() is called.\n *\n * @param confirmFunction The function to be run.\n * @see Blockly.dialog.confirm\n */\nexport function setConfirm(\n    confirmFunction: (p1: string, p2: (p1: boolean) => void) => void) {\n  confirmImplementation = confirmFunction;\n}\n\n/**\n * Wrapper to window.prompt() that app developers may override via setPrompt to\n * provide alternatives to the modal browser window. Built-in browser prompts\n * are often used for better text input experience on mobile device. We strongly\n * recommend testing mobile when overriding this.\n *\n * @param message The message to display to the user.\n * @param defaultValue The value to initialize the prompt with.\n * @param callback The callback for handling user response.\n */\nexport function prompt(\n    message: string, defaultValue: string,\n    callback: (p1: string|null) => void) {\n  promptImplementation(message, defaultValue, callback);\n}\n\n/**\n * Sets the function to be run when Blockly.dialog.prompt() is called.\n *\n * @param promptFunction The function to be run.\n * @see Blockly.dialog.prompt\n */\nexport function setPrompt(\n    promptFunction: (p1: string, p2: string, p3: (p1: string|null) => void) =>\n        void) {\n  promptImplementation = promptFunction;\n}\n\nexport const TEST_ONLY = {\n  confirmInternal,\n};\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {VariableModel} from '../variable_model.js';\nimport {IParameterModel} from './i_parameter_model.js';\n\n\n/** Interface for a parameter model that holds a variable model. */\nexport interface IVariableBackedParameterModel extends IParameterModel {\n  /** Returns the variable model held by this type. */\n  getVariableModel(): VariableModel;\n}\n\n/**\n * Returns whether the given object is a variable holder or not.\n */\nexport function isVariableBackedParameterModel(param: IParameterModel):\n    param is IVariableBackedParameterModel {\n  return (param as any).getVariableModel !== undefined;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n\n/**\n * Legacy means of representing a procedure signature. The elements are\n * respectively: name, parameter names, and whether it has a return value.\n */\nexport type ProcedureTuple = [string, string[], boolean];\n\n/**\n * Procedure block type.\n *\n * @internal\n */\nexport interface ProcedureBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n  getProcedureDef: () => ProcedureTuple;\n}\n\n/** @internal */\nexport interface LegacyProcedureDefBlock {\n  getProcedureDef: () => ProcedureTuple\n}\n\n/** @internal */\nexport function isLegacyProcedureDefBlock(block: Object):\n    block is LegacyProcedureDefBlock {\n  return (block as any).getProcedureDef !== undefined;\n}\n\n/** @internal */\nexport interface LegacyProcedureCallBlock {\n  getProcedureCall: () => string;\n  renameProcedure: (p1: string, p2: string) => void;\n}\n\n/** @internal */\nexport function isLegacyProcedureCallBlock(block: Object):\n    block is LegacyProcedureCallBlock {\n  return (block as any).getProcedureCall !== undefined &&\n      (block as any).renameProcedure !== undefined;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Variables');\n\nimport {Blocks} from './blocks.js';\nimport * as dialog from './dialog.js';\nimport {isVariableBackedParameterModel} from './interfaces/i_variable_backed_parameter_model.js';\nimport {Msg} from './msg.js';\nimport {isLegacyProcedureDefBlock} from './interfaces/i_legacy_procedure_blocks.js';\nimport * as utilsXml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Procedures.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE';\n\n/**\n * Find all user-created variables that are in use in the workspace.\n * For use by generators.\n * To get a list of all variables on a workspace, including unused variables,\n * call Workspace.getAllVariables.\n *\n * @param ws The workspace to search for variables.\n * @returns Array of variable models.\n */\nexport function allUsedVarModels(ws: Workspace): VariableModel[] {\n  const blocks = ws.getAllBlocks(false);\n  const variables = new Set<VariableModel>();\n  // Iterate through every block and add each variable to the set.\n  for (let i = 0; i < blocks.length; i++) {\n    const blockVariables = blocks[i].getVarModels();\n    if (blockVariables) {\n      for (let j = 0; j < blockVariables.length; j++) {\n        const variable = blockVariables[j];\n        const id = variable.getId();\n        if (id) {\n          variables.add(variable);\n        }\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Find all developer variables used by blocks in the workspace.\n * Developer variables are never shown to the user, but are declared as global\n * variables in the generated code.\n * To declare developer variables, define the getDeveloperVariables function on\n * your block and return a list of variable names.\n * For use by generators.\n *\n * @param workspace The workspace to search.\n * @returns A list of non-duplicated variable names.\n */\nexport function allDeveloperVariables(workspace: Workspace): string[] {\n  const blocks = workspace.getAllBlocks(false);\n  const variables = new Set<string>();\n  for (let i = 0, block; block = blocks[i]; i++) {\n    const getDeveloperVariables = block.getDeveloperVariables;\n    if (getDeveloperVariables) {\n      const devVars = getDeveloperVariables();\n      for (let j = 0; j < devVars.length; j++) {\n        variables.add(devVars[j]);\n      }\n    }\n  }\n  // Convert the set into a list.\n  return Array.from(variables.values());\n}\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  const button = document.createElement('button');\n  button.setAttribute('text', '%{BKY_NEW_VARIABLE}');\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE');\n\n  workspace.registerButtonCallback('CREATE_VARIABLE', function(button) {\n    createVariableButtonHandler(button.getTargetWorkspace());\n  });\n\n  xmlList.push(button);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getVariablesOfType('');\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    // New variables are added to the end of the variableModelList.\n    const mostRecentVariable = variableModelList[variableModelList.length - 1];\n    if (Blocks['variables_set']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'variables_set');\n      block.setAttribute('gap', Blocks['math_change'] ? '8' : '24');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['math_change']) {\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', 'math_change');\n      block.setAttribute('gap', Blocks['variables_get'] ? '20' : '8');\n      block.appendChild(generateVariableFieldDom(mostRecentVariable));\n      const value = utilsXml.textToDom(\n          '<value name=\"DELTA\">' +\n          '<shadow type=\"math_number\">' +\n          '<field name=\"NUM\">1</field>' +\n          '</shadow>' +\n          '</value>');\n      block.appendChild(value);\n      xmlList.push(block);\n    }\n\n    if (Blocks['variables_get']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; variable = variableModelList[i]; i++) {\n        const block = utilsXml.createElement('block');\n        block.setAttribute('type', 'variables_get');\n        block.setAttribute('gap', '8');\n        block.appendChild(generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n\nexport const VAR_LETTER_OPTIONS = 'ijkmnopqrstuvwxyzabcdefgh';\n\n/**\n * Return a new variable name that is not yet being used. This will try to\n * generate single letter variable names in the range 'i' to 'z' to start with.\n * If no unique name is located it will try 'i' to 'z', 'a' to 'h',\n * then 'i2' to 'z2' etc.  Skip 'l'.\n *\n * @param workspace The workspace to be unique in.\n * @returns New variable name.\n */\nexport function generateUniqueName(workspace: Workspace): string {\n  return TEST_ONLY.generateUniqueNameInternal(workspace);\n}\n\n/**\n * Private version of generateUniqueName for stubbing in tests.\n */\nfunction generateUniqueNameInternal(workspace: Workspace): string {\n  return generateUniqueNameFromOptions(\n      VAR_LETTER_OPTIONS.charAt(0), workspace.getAllVariableNames());\n}\n\n/**\n * Returns a unique name that is not present in the usedNames array. This\n * will try to generate single letter names in the range a - z (skip l). It\n * will start with the character passed to startChar.\n *\n * @param startChar The character to start the search at.\n * @param usedNames A list of all of the used names.\n * @returns A unique name that is not present in the usedNames array.\n */\nexport function generateUniqueNameFromOptions(\n    startChar: string, usedNames: string[]): string {\n  if (!usedNames.length) {\n    return startChar;\n  }\n\n  const letters = VAR_LETTER_OPTIONS;\n  let suffix = '';\n  let letterIndex = letters.indexOf(startChar);\n  let potName = startChar;\n\n  // eslint-disable-next-line no-constant-condition\n  while (true) {\n    let inUse = false;\n    for (let i = 0; i < usedNames.length; i++) {\n      if (usedNames[i].toLowerCase() === potName) {\n        inUse = true;\n        break;\n      }\n    }\n    if (!inUse) {\n      break;\n    }\n\n    letterIndex++;\n    if (letterIndex === letters.length) {\n      // Reached the end of the character sequence so back to 'i'.\n      letterIndex = 0;\n      suffix = `${Number(suffix) + 1}`;\n    }\n    potName = letters.charAt(letterIndex) + suffix;\n  }\n  return potName;\n}\n\n/**\n * Handles \"Create Variable\" button in the default variables toolbox category.\n * It will prompt the user for a variable name, including re-prompts if a name\n * is already in use among the workspace's variables.\n *\n * Custom button handlers can delegate to this function, allowing variables\n * types and after-creation processing. More complex customization (e.g.,\n * prompting for variable type) is beyond the scope of this function.\n *\n * @param workspace The workspace on which to create the variable.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n * @param opt_type The type of the variable like 'int', 'string', or ''. This\n *     will default to '', which is a specific type.\n */\nexport function createVariableButtonHandler(\n    workspace: Workspace, opt_callback?: (p1?: string|null) => void,\n    opt_type?: string) {\n  const type = opt_type || '';\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    promptName(Msg['NEW_VARIABLE_TITLE'], defaultName, function(text) {\n      if (!text) {  // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithAnyType(text, workspace);\n      if (!existing) {  // No conflict\n        workspace.createVariable(text, type);\n        if (opt_callback) opt_callback(text);\n        return;\n      }\n\n      let msg;\n      if (existing.type === type) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS'].replace('%1', existing.name);\n      } else {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE'];\n        msg = msg.replace('%1', existing.name).replace('%2', existing.type);\n      }\n      dialog.alert(msg, function() {\n        promptAndCheckWithAlert(text);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Opens a prompt that allows the user to enter a new name for a variable.\n * Triggers a rename if the new name is valid. Or re-prompts if there is a\n * collision.\n *\n * @param workspace The workspace on which to rename the variable.\n * @param variable Variable to rename.\n * @param opt_callback A callback. It will be passed an acceptable new variable\n *     name, or null if change is to be aborted (cancel button), or undefined if\n *     an existing variable was chosen.\n */\nexport function renameVariable(\n    workspace: Workspace, variable: VariableModel,\n    opt_callback?: (p1?: string|null) => void) {\n  // This function needs to be named so it can be called recursively.\n  function promptAndCheckWithAlert(defaultName: string) {\n    const promptText =\n        Msg['RENAME_VARIABLE_TITLE'].replace('%1', variable.name);\n    promptName(promptText, defaultName, function(newName) {\n      if (!newName) {  // User canceled prompt.\n        if (opt_callback) opt_callback(null);\n        return;\n      }\n\n      const existing = nameUsedWithOtherType(newName, variable.type, workspace);\n      const procedure =\n          nameUsedWithConflictingParam(variable.name, newName, workspace);\n      if (!existing && !procedure) {  // No conflict.\n        workspace.renameVariableById(variable.getId(), newName);\n        if (opt_callback) opt_callback(newName);\n        return;\n      }\n\n      let msg = '';\n      if (existing) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_ANOTHER_TYPE']\n                  .replace('%1', existing.name)\n                  .replace('%2', existing.type);\n      } else if (procedure) {\n        msg = Msg['VARIABLE_ALREADY_EXISTS_FOR_A_PARAMETER']\n                  .replace('%1', newName)\n                  .replace('%2', procedure);\n      }\n      dialog.alert(msg, function() {\n        promptAndCheckWithAlert(newName);\n      });\n    });\n  }\n  promptAndCheckWithAlert('');\n}\n\n/**\n * Prompt the user for a new variable name.\n *\n * @param promptText The string of the prompt.\n * @param defaultText The default value to show in the prompt's field.\n * @param callback A callback. It will be passed the new variable name, or null\n *     if the user picked something illegal.\n */\nexport function promptName(\n    promptText: string, defaultText: string,\n    callback: (p1: string|null) => void) {\n  dialog.prompt(promptText, defaultText, function(newVar) {\n    // Merge runs of whitespace.  Strip leading and trailing whitespace.\n    // Beyond this, all names are legal.\n    if (newVar) {\n      newVar = newVar.replace(/[\\s\\xa0]+/g, ' ').trim();\n      if (newVar === Msg['RENAME_VARIABLE'] || newVar === Msg['NEW_VARIABLE']) {\n        // Ok, not ALL names are legal...\n        newVar = null;\n      }\n    }\n    callback(newVar);\n  });\n}\n/**\n * Check whether there exists a variable with the given name but a different\n * type.\n *\n * @param name The name to search for.\n * @param type The type to exclude from the search.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name and a different type, or null if\n *     none was found.\n */\nfunction nameUsedWithOtherType(\n    name: string, type: string, workspace: Workspace): VariableModel|null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; variable = allVariables[i]; i++) {\n    if (variable.name.toLowerCase() === name && variable.type !== type) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Check whether there exists a variable with the given name of any type.\n *\n * @param name The name to search for.\n * @param workspace The workspace to search for the variable.\n * @returns The variable with the given name, or null if none was found.\n */\nexport function nameUsedWithAnyType(\n    name: string, workspace: Workspace): VariableModel|null {\n  const allVariables = workspace.getVariableMap().getAllVariables();\n\n  name = name.toLowerCase();\n  for (let i = 0, variable; variable = allVariables[i]; i++) {\n    if (variable.name.toLowerCase() === name) {\n      return variable;\n    }\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure with a conflicting parameter name, or null\n * if one does not exist.\n *\n * This checks the procedure map if it contains models, and the legacy procedure\n * blocks otherwise.\n *\n * @param oldName The old name of the variable.\n * @param newName The proposed name of the variable.\n * @param workspace The workspace to search for conflicting parameters.\n * @internal\n */\nexport function nameUsedWithConflictingParam(\n    oldName: string, newName: string, workspace: Workspace): string|null {\n  return workspace.getProcedureMap().getProcedures().length ?\n      checkForConflictingParamWithProcedureModels(oldName, newName, workspace) :\n      checkForConflictingParamWithLegacyProcedures(oldName, newName, workspace);\n}\n\n/**\n * Returns the name of the procedure model with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithProcedureModels(\n    oldName: string, newName: string, workspace: Workspace): string|null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const procedures = workspace.getProcedureMap().getProcedures();\n  for (const procedure of procedures) {\n    const params = procedure.getParameters()\n                       .filter(isVariableBackedParameterModel)\n                       .map((param) => param.getVariableModel().name);\n    if (!params) continue;\n    const procHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const procHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (procHasOld && procHasNew) return procedure.getName();\n  }\n  return null;\n}\n\n/**\n * Returns the name of the procedure block with a conflicting param name, or\n * null if one does not exist.\n */\nfunction checkForConflictingParamWithLegacyProcedures(\n    oldName: string, newName: string, workspace: Workspace): string|null {\n  oldName = oldName.toLowerCase();\n  newName = newName.toLowerCase();\n\n  const blocks = workspace.getAllBlocks(false);\n  for (const block of blocks) {\n    if (!isLegacyProcedureDefBlock(block)) continue;\n    const def = block.getProcedureDef();\n    const params = def[1];\n    const blockHasOld = params.some((param) => param.toLowerCase() === oldName);\n    const blockHasNew = params.some((param) => param.toLowerCase() === newName);\n    if (blockHasOld && blockHasNew) return def[0];\n  }\n  return null;\n}\n\n/**\n * Generate DOM objects representing a variable field.\n *\n * @param variableModel The variable model to represent.\n * @returns The generated DOM.\n */\nexport function generateVariableFieldDom(variableModel: VariableModel):\n    Element {\n  /* Generates the following XML:\n   * <field name=\"VAR\" id=\"goKTKmYJ8DhVHpruv\" variabletype=\"int\">foo</field>\n   */\n  const field = utilsXml.createElement('field');\n  field.setAttribute('name', 'VAR');\n  field.setAttribute('id', variableModel.getId());\n  field.setAttribute('variabletype', variableModel.type);\n  const name = utilsXml.createTextNode(variableModel.name);\n  field.appendChild(name);\n  return field;\n}\n\n/**\n * Helper function to look up or create a variable on the given workspace.\n * If no variable exists, creates and returns it.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up or create the variable, or null.\n * @param opt_name The string to use to look up or create the variable.\n * @param opt_type The type to use to look up or create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nexport function getOrCreateVariablePackage(\n    workspace: Workspace, id: string|null, opt_name?: string,\n    opt_type?: string): VariableModel {\n  let variable = getVariable(workspace, id, opt_name, opt_type);\n  if (!variable) {\n    variable = createVariable(workspace, id, opt_name, opt_type);\n  }\n  return variable;\n}\n\n/**\n * Look up  a variable on the given workspace.\n * Always looks in the main workspace before looking in the flyout workspace.\n * Always prefers lookup by ID to lookup by name + type.\n *\n * @param workspace The workspace to search for the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to look up the variable, or null.\n * @param opt_name The string to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @param opt_type The type to use to look up the variable.\n *     Only used if lookup by ID fails.\n * @returns The variable corresponding to the given ID or name + type\n *     combination, or null if not found.\n */\nexport function getVariable(\n    workspace: Workspace, id: string|null, opt_name?: string,\n    opt_type?: string): VariableModel|null {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  let variable = null;\n  // Try to just get the variable, by ID if possible.\n  if (id) {\n    // Look in the real variable map before checking the potential variable map.\n    variable = workspace.getVariableById(id);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariableById(id);\n    }\n    if (variable) {\n      return variable;\n    }\n  }\n  // If there was no ID, or there was an ID but it didn't match any variables,\n  // look up by name and type.\n  if (opt_name) {\n    if (opt_type === undefined) {\n      throw Error('Tried to look up a variable by name without a type');\n    }\n    // Otherwise look up by name and type.\n    variable = workspace.getVariable(opt_name, opt_type);\n    if (!variable && potentialVariableMap) {\n      variable = potentialVariableMap.getVariable(opt_name, opt_type);\n    }\n  }\n  return variable;\n}\n\n/**\n * Helper function to create a variable on the given workspace.\n *\n * @param workspace The workspace in which to create the variable.  It may be a\n *     flyout workspace or main workspace.\n * @param id The ID to use to create the variable, or null.\n * @param opt_name The string to use to create the variable.\n * @param opt_type The type to use to create the variable.\n * @returns The variable corresponding to the given ID or name + type\n *     combination.\n */\nfunction createVariable(\n    workspace: Workspace, id: string|null, opt_name?: string,\n    opt_type?: string): VariableModel {\n  const potentialVariableMap = workspace.getPotentialVariableMap();\n  // Variables without names get uniquely named for this workspace.\n  if (!opt_name) {\n    const ws =\n        (workspace.isFlyout ? (workspace as WorkspaceSvg).targetWorkspace :\n                              workspace);\n    opt_name = generateUniqueName(ws!);\n  }\n\n  // Create a potential variable if in the flyout.\n  let variable = null;\n  if (potentialVariableMap) {\n    variable = potentialVariableMap.createVariable(opt_name, opt_type, id);\n  } else {\n    // In the main workspace, create a real variable.\n    variable = workspace.createVariable(opt_name, opt_type, id);\n  }\n  return variable;\n}\n\n/**\n * Helper function to get the list of variables that have been added to the\n * workspace after adding a new block, using the given list of variables that\n * were in the workspace before the new block was added.\n *\n * @param workspace The workspace to inspect.\n * @param originalVariables The array of variables that existed in the workspace\n *     before adding the new block.\n * @returns The new array of variables that were freshly added to the workspace\n *     after creating the new block, or [] if no new variables were added to the\n *     workspace.\n * @internal\n */\nexport function getAddedVariables(\n    workspace: Workspace, originalVariables: VariableModel[]): VariableModel[] {\n  const allCurrentVariables = workspace.getAllVariables();\n  const addedVariables = [];\n  if (originalVariables.length !== allCurrentVariables.length) {\n    for (let i = 0; i < allCurrentVariables.length; i++) {\n      const variable = allCurrentVariables[i];\n      // For any variable that is present in allCurrentVariables but not\n      // present in originalVariables, add the variable to addedVariables.\n      if (originalVariables.indexOf(variable) === -1) {\n        addedVariables.push(variable);\n      }\n    }\n  }\n  return addedVariables;\n}\n\nexport const TEST_ONLY = {\n  generateUniqueNameInternal,\n};\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Touch');\n\nimport type {Gesture} from './gesture.js';\nimport * as deprecation from './utils/deprecation.js';\n\n\n/**\n * A mock event, created from either a mouse or touch event,\n * with no more than one entry in the changedTouches array.\n */\ninterface PseudoEvent {\n  type: string;\n  changedTouches: Touch[];\n  target: Element;\n  stopPropagation: () => void;\n  preventDefault: () => void;\n}\n\n/** Length in ms for a touch to become a long press. */\nconst LONGPRESS = 750;\n\n/**\n * Whether touch is enabled in the browser.\n * Copied from Closure's goog.events.BrowserFeature.TOUCH_ENABLED\n */\nexport const TOUCH_ENABLED = 'ontouchstart' in globalThis ||\n    !!(globalThis['document'] && document.documentElement &&\n       'ontouchstart' in\n           document.documentElement) ||  // IE10 uses non-standard touch events,\n    // so it has a different check.\n    !!(globalThis['navigator'] &&\n       (globalThis['navigator']['maxTouchPoints'] ||\n        (globalThis['navigator'] as any)['msMaxTouchPoints']));\n\n/** Which touch events are we currently paying attention to? */\nlet touchIdentifier_: string|null = null;\n\n/**\n * The TOUCH_MAP lookup dictionary specifies additional touch events to fire,\n * in conjunction with mouse events.\n */\nexport const TOUCH_MAP: {[key: string]: string[]} = {\n  'mousedown': ['pointerdown'],\n  'mouseenter': ['pointerenter'],\n  'mouseleave': ['pointerleave'],\n  'mousemove': ['pointermove'],\n  'mouseout': ['pointerout'],\n  'mouseover': ['pointerover'],\n  'mouseup': ['pointerup', 'pointercancel'],\n  'touchend': ['pointerup'],\n  'touchcancel': ['pointercancel'],\n};\n\n/** PID of queued long-press task. */\nlet longPid_: AnyDuringMigration = 0;\n\n/**\n * Context menus on touch devices are activated using a long-press.\n * Unfortunately the contextmenu touch event is currently (2015) only supported\n * by Chrome.  This function is fired on any touchstart event, queues a task,\n * which after about a second opens the context menu.  The tasks is killed\n * if the touch event terminates early.\n *\n * @param e Touch start event.\n * @param gesture The gesture that triggered this longStart.\n * @internal\n */\nexport function longStart(e: PointerEvent, gesture: Gesture) {\n  longStop();\n  longPid_ = setTimeout(function() {\n    // Let the gesture route the right-click correctly.\n    if (gesture) {\n      gesture.handleRightClick(e);\n    }\n  }, LONGPRESS);\n}\n\n/**\n * Nope, that's not a long-press.  Either touchend or touchcancel was fired,\n * or a drag hath begun.  Kill the queued long-press task.\n *\n * @internal\n */\nexport function longStop() {\n  if (longPid_) {\n    clearTimeout(longPid_);\n    longPid_ = 0;\n  }\n}\n\n/**\n * Clear the touch identifier that tracks which touch stream to pay attention\n * to.  This ends the current drag/gesture and allows other pointers to be\n * captured.\n */\nexport function clearTouchIdentifier() {\n  touchIdentifier_ = null;\n}\n\n/**\n * Decide whether Blockly should handle or ignore this event.\n * Mouse and touch events require special checks because we only want to deal\n * with one touch stream at a time.  All other events should always be handled.\n *\n * @param e The event to check.\n * @returns True if this event should be passed through to the registered\n *     handler; false if it should be blocked.\n */\nexport function shouldHandleEvent(e: Event): boolean {\n  // Do not replace the startsWith with a check for `instanceof PointerEvent`.\n  // `click` and `contextmenu` are PointerEvents in some browsers,\n  // despite not starting with `pointer`, but we want to always handle them\n  // without worrying about touch identifiers.\n  return !(e.type.startsWith('pointer')) ||\n      (e instanceof PointerEvent && checkTouchIdentifier(e));\n}\n\n/**\n * Get the pointer identifier from the given event.\n *\n * @param e Pointer event.\n * @returns The pointerId of the event.\n */\nexport function getTouchIdentifierFromEvent(e: PointerEvent): string {\n  return `${e.pointerId}`;\n}\n\n/**\n * Check whether the pointer identifier on the event matches the current saved\n * identifier. If the current identifier was unset, save the identifier from\n * the event. This starts a drag/gesture, during which pointer events with\n * other identifiers will be silently ignored.\n *\n * @param e Pointer event.\n * @returns Whether the identifier on the event matches the current saved\n *     identifier.\n */\nexport function checkTouchIdentifier(e: PointerEvent): boolean {\n  const identifier = getTouchIdentifierFromEvent(e);\n\n  if (touchIdentifier_) {\n    // We're already tracking some touch/mouse event.  Is this from the same\n    // source?\n    return touchIdentifier_ === identifier;\n  }\n  if (e.type === 'pointerdown') {\n    // No identifier set yet, and this is the start of a drag.  Set it and\n    // return.\n    touchIdentifier_ = identifier;\n    return true;\n  }\n  // There was no identifier yet, but this wasn't a start event so we're going\n  // to ignore it.  This probably means that another drag finished while this\n  // pointer was down.\n  return false;\n}\n\n/**\n * Set an event's clientX and clientY from its first changed touch.  Use this to\n * make a touch event work in a mouse event handler.\n *\n * @param e A touch event.\n */\nexport function setClientFromTouch(e: Event|PseudoEvent) {\n  deprecation.warn('setClientFromTouch()', 'version 9', 'version 10');\n  // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n  // type 'PseudoEvent | Event'.\n  if (e.type.startsWith('touch') && (e as AnyDuringMigration).changedTouches) {\n    // Map the touch event's properties to the event.\n    // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n    // type 'PseudoEvent | Event'.\n    const touchPoint = (e as AnyDuringMigration).changedTouches[0];\n    // AnyDuringMigration because:  Property 'clientX' does not exist on type\n    // 'PseudoEvent | Event'.\n    (e as AnyDuringMigration).clientX = touchPoint.clientX;\n    // AnyDuringMigration because:  Property 'clientY' does not exist on type\n    // 'PseudoEvent | Event'.\n    (e as AnyDuringMigration).clientY = touchPoint.clientY;\n  }\n}\n\n/**\n * Check whether a given event is a mouse, touch, or pointer event.\n *\n * @param e An event.\n * @returns True if it is a mouse, touch, or pointer event; false otherwise.\n */\nexport function isMouseOrTouchEvent(e: Event|PseudoEvent): boolean {\n  deprecation.warn('isMouseOrTouchEvent()', 'version 9', 'version 10');\n  return e.type.startsWith('touch') || e.type.startsWith('mouse') ||\n      e.type.startsWith('pointer');\n}\n\n/**\n * Check whether a given event is a touch event or a pointer event.\n *\n * @param e An event.\n * @returns True if it is a touch or pointer event; false otherwise.\n */\nexport function isTouchEvent(e: Event|PseudoEvent): boolean {\n  deprecation.warn('isTouchEvent()', 'version 9', 'version 10');\n  return e.type.startsWith('touch') || e.type.startsWith('pointer');\n}\n\n/**\n * Split an event into an array of events, one per changed touch or mouse\n * point.\n *\n * @param e A mouse event or a touch event with one or more changed touches.\n * @returns An array of events or pseudo events.\n *     Each pseudo-touch event will have exactly one changed touch and there\n * will be no real touch events.\n */\nexport function splitEventByTouches(e: Event): Array<Event|PseudoEvent> {\n  deprecation.warn('splitEventByTouches()', 'version 9', 'version 10');\n  const events = [];\n  // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n  // type 'PseudoEvent | Event'.\n  if ((e as AnyDuringMigration).changedTouches) {\n    // AnyDuringMigration because:  Property 'changedTouches' does not exist on\n    // type 'PseudoEvent | Event'.\n    for (let i = 0; i < (e as AnyDuringMigration).changedTouches.length; i++) {\n      const newEvent = {\n        type: e.type,\n        // AnyDuringMigration because:  Property 'changedTouches' does not exist\n        // on type 'PseudoEvent | Event'.\n        changedTouches: [(e as AnyDuringMigration).changedTouches[i]],\n        target: e.target,\n        stopPropagation() {\n          e.stopPropagation();\n        },\n        preventDefault() {\n          e.preventDefault();\n        },\n      };\n      events[i] = newEvent;\n    }\n  } else {\n    events.push(e);\n  }\n  // AnyDuringMigration because:  Type '(Event | { type: string; changedTouches:\n  // Touch[]; target: EventTarget | null; stopPropagation(): void;\n  // preventDefault(): void; })[]' is not assignable to type '(PseudoEvent |\n  // Event)[]'.\n  return events as AnyDuringMigration;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.browserEvents');\n\nimport * as Touch from './touch.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as userAgent from './utils/useragent.js';\n\n\n/**\n * Blockly opaque event data used to unbind events when using\n * `bind` and `conditionalBind`.\n */\nexport type Data = [EventTarget, string, (e: Event) => void][];\n\n/**\n * The multiplier for scroll wheel deltas using the line delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst LINE_MODE_MULTIPLIER = 40;\n\n/**\n * The multiplier for scroll wheel deltas using the page delta mode.\n * See https://developer.mozilla.org/en-US/docs/Web/API/WheelEvent/deltaMode\n * for more information on deltaMode.\n */\nconst PAGE_MODE_MULTIPLIER = 125;\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @param opt_noPreventDefault No-op, deprecated and will be removed in v10.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function conditionalBind(\n    node: EventTarget, name: string, thisObject: Object|null, func: Function,\n    opt_noCaptureIdentifier?: boolean, opt_noPreventDefault?: boolean): Data {\n  if (opt_noPreventDefault !== undefined) {\n    deprecation.warn(\n        'The opt_noPreventDefault argument of conditionalBind', 'version 9',\n        'version 10');\n  }\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    const captureIdentifier = !opt_noCaptureIdentifier;\n\n    if (!(captureIdentifier && !Touch.shouldHandleEvent(e))) {\n      if (thisObject) {\n        func.call(thisObject, e);\n      } else {\n        func(e);\n      }\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n */\nexport function bind(\n    node: EventTarget, name: string, thisObject: Object|null,\n    func: Function): Data {\n  /**\n   *\n   * @param e\n   */\n  function wrapFunc(e: Event) {\n    if (thisObject) {\n      func.call(thisObject, e);\n    } else {\n      func(e);\n    }\n  }\n\n  const bindData: Data = [];\n  if (name in Touch.TOUCH_MAP) {\n    for (let i = 0; i < Touch.TOUCH_MAP[name].length; i++) {\n      const type = Touch.TOUCH_MAP[name][i];\n      node.addEventListener(type, wrapFunc, false);\n      bindData.push([node, type, wrapFunc]);\n    }\n  } else {\n    node.addEventListener(name, wrapFunc, false);\n    bindData.push([node, name, wrapFunc]);\n  }\n  return bindData;\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n */\nexport function unbind(bindData: Data): (e: Event) => void {\n  // Accessing an element of the last property of the array is unsafe if the\n  // bindData is an empty array. But that should never happen because developers\n  // should only pass Data from bind or conditionalBind.\n  const callback = bindData[bindData.length - 1][2];\n  while (bindData.length) {\n    const [node, name, func] = bindData.pop()!;\n    node.removeEventListener(name, func, false);\n  }\n  return callback;\n}\n\n/**\n * Returns true if this event is targeting a text input widget?\n *\n * @param e An event.\n * @returns True if text input.\n */\nexport function isTargetInput(e: Event): boolean {\n  if (e.target instanceof HTMLElement) {\n    if (e.target.isContentEditable ||\n        e.target.getAttribute('data-is-text-input') === 'true') {\n      return true;\n    }\n\n    if (e.target instanceof HTMLInputElement) {\n      const target = e.target;\n      return target.type === 'text' || target.type === 'number' ||\n          target.type === 'email' || target.type === 'password' ||\n          target.type === 'search' || target.type === 'tel' ||\n          target.type === 'url';\n    }\n\n    if (e.target instanceof HTMLTextAreaElement) {\n      return true;\n    }\n  }\n\n  return false;\n}\n\n/**\n * Returns true this event is a right-click.\n *\n * @param e Mouse event.\n * @returns True if right-click.\n */\nexport function isRightButton(e: MouseEvent): boolean {\n  if (e.ctrlKey && userAgent.MAC) {\n    // Control-clicking on Mac OS X is treated as a right-click.\n    // WebKit on Mac OS X fails to change button to 2 (but Gecko does).\n    return true;\n  }\n  return e.button === 2;\n}\n\n/**\n * Returns the converted coordinates of the given mouse event.\n * The origin (0,0) is the top-left corner of the Blockly SVG.\n *\n * @param e Mouse event.\n * @param svg SVG element.\n * @param matrix Inverted screen CTM to use.\n * @returns Object with .x and .y properties.\n */\nexport function mouseToSvg(\n    e: MouseEvent, svg: SVGSVGElement, matrix: SVGMatrix|null): SVGPoint {\n  const svgPoint = svg.createSVGPoint();\n  svgPoint.x = e.clientX;\n  svgPoint.y = e.clientY;\n\n  if (!matrix) {\n    matrix = svg.getScreenCTM()!.inverse();\n  }\n  return svgPoint.matrixTransform(matrix);\n}\n\n/**\n * Returns the scroll delta of a mouse event in pixel units.\n *\n * @param e Mouse event.\n * @returns Scroll delta object with .x and .y properties.\n */\nexport function getScrollDeltaPixels(e: WheelEvent): {x: number, y: number} {\n  switch (e.deltaMode) {\n    case 0x00:  // Pixel mode.\n    default:\n      return {x: e.deltaX, y: e.deltaY};\n    case 0x01:  // Line mode.\n      return {\n        x: e.deltaX * LINE_MODE_MULTIPLIER,\n        y: e.deltaY * LINE_MODE_MULTIPLIER,\n      };\n    case 0x02:  // Page mode.\n      return {\n        x: e.deltaX * PAGE_MODE_MULTIPLIER,\n        y: e.deltaY * PAGE_MODE_MULTIPLIER,\n      };\n  }\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Css');\n\n\n/** Has CSS already been injected? */\nlet injected = false;\n\n/**\n * Add some CSS to the blob that will be injected later.  Allows optional\n * components such as fields and the toolbox to store separate CSS.\n *\n * @param cssContent Multiline CSS string or an array of single lines of CSS.\n */\nexport function register(cssContent: string) {\n  if (injected) {\n    throw Error('CSS already injected');\n  }\n  content += '\\n' + cssContent;\n}\n\n/**\n * Inject the CSS into the DOM.  This is preferable over using a regular CSS\n * file since:\n * a) It loads synchronously and doesn't force a redraw later.\n * b) It speeds up loading by not blocking on a separate HTTP transfer.\n * c) The CSS content may be made dynamic depending on init options.\n *\n * @param hasCss If false, don't inject CSS (providing CSS becomes the\n *     document's responsibility).\n * @param pathToMedia Path from page to the Blockly media directory.\n */\nexport function inject(hasCss: boolean, pathToMedia: string) {\n  // Only inject the CSS once.\n  if (injected) {\n    return;\n  }\n  injected = true;\n  if (!hasCss) {\n    return;\n  }\n  // Strip off any trailing slash (either Unix or Windows).\n  const mediaPath = pathToMedia.replace(/[\\\\/]$/, '');\n  const cssContent = content.replace(/<<<PATH>>>/g, mediaPath);\n  // Cleanup the collected css content after injecting it to the DOM.\n  content = '';\n\n  // Inject CSS tag at start of head.\n  const cssNode = document.createElement('style');\n  cssNode.id = 'blockly-common-style';\n  const cssTextNode = document.createTextNode(cssContent);\n  cssNode.appendChild(cssTextNode);\n  document.head.insertBefore(cssNode, document.head.firstChild);\n}\n\n/**\n * The CSS content for Blockly.\n */\nlet content = `\n.blocklySvg {\n  background-color: #fff;\n  outline: none;\n  overflow: hidden;  /* IE overflows by default. */\n  position: absolute;\n  display: block;\n}\n\n.blocklyWidgetDiv {\n  display: none;\n  position: absolute;\n  z-index: 99999;  /* big value for bootstrap3 compatibility */\n}\n\n.injectionDiv {\n  height: 100%;\n  position: relative;\n  overflow: hidden;  /* So blocks in drag surface disappear at edges */\n  touch-action: none;\n}\n\n.blocklyNonSelectable {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n}\n\n.blocklyWsDragSurface {\n  display: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n}\n\n/* Added as a separate rule with multiple classes to make it more specific\n   than a bootstrap rule that selects svg:root. See issue #1275 for context.\n*/\n.blocklyWsDragSurface.blocklyOverflowVisible {\n  overflow: visible;\n}\n\n.blocklyBlockDragSurface {\n  display: none;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  overflow: visible !important;\n  z-index: 50;  /* Display below toolbox, but above everything else. */\n}\n\n.blocklyBlockCanvas.blocklyCanvasTransitioning,\n.blocklyBubbleCanvas.blocklyCanvasTransitioning {\n  transition: transform .5s;\n}\n\n.blocklyTooltipDiv {\n  background-color: #ffffc7;\n  border: 1px solid #ddc;\n  box-shadow: 4px 4px 20px 1px rgba(0,0,0,.15);\n  color: #000;\n  display: none;\n  font: 9pt sans-serif;\n  opacity: .9;\n  padding: 2px;\n  position: absolute;\n  z-index: 100000;  /* big value for bootstrap3 compatibility */\n}\n\n.blocklyDropDownDiv {\n  position: absolute;\n  left: 0;\n  top: 0;\n  z-index: 1000;\n  display: none;\n  border: 1px solid;\n  border-color: #dadce0;\n  background-color: #fff;\n  border-radius: 2px;\n  padding: 4px;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownContent {\n  max-height: 300px;  /* @todo: spec for maximum height. */\n  overflow: auto;\n  overflow-x: hidden;\n  position: relative;\n}\n\n.blocklyDropDownArrow {\n  position: absolute;\n  left: 0;\n  top: 0;\n  width: 16px;\n  height: 16px;\n  z-index: -1;\n  background-color: inherit;\n  border-color: inherit;\n}\n\n.blocklyDropDownButton {\n  display: inline-block;\n  float: left;\n  padding: 0;\n  margin: 4px;\n  border-radius: 4px;\n  outline: none;\n  border: 1px solid;\n  transition: box-shadow .1s;\n  cursor: pointer;\n}\n\n.blocklyArrowTop {\n  border-top: 1px solid;\n  border-left: 1px solid;\n  border-top-left-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyArrowBottom {\n  border-bottom: 1px solid;\n  border-right: 1px solid;\n  border-bottom-right-radius: 4px;\n  border-color: inherit;\n}\n\n.blocklyResizeSE {\n  cursor: se-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeSW {\n  cursor: sw-resize;\n  fill: #aaa;\n}\n\n.blocklyResizeLine {\n  stroke: #515A5A;\n  stroke-width: 1;\n}\n\n.blocklyHighlightedConnectionPath {\n  fill: none;\n  stroke: #fc3;\n  stroke-width: 4px;\n}\n\n.blocklyPathLight {\n  fill: none;\n  stroke-linecap: round;\n  stroke-width: 1;\n}\n\n.blocklySelected>.blocklyPathLight {\n  display: none;\n}\n\n.blocklyDraggable {\n  cursor: grab;\n  cursor: -webkit-grab;\n}\n\n.blocklyDragging {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n  /* Changes cursor on mouse down. Not effective in Firefox because of\n     https://bugzilla.mozilla.org/show_bug.cgi?id=771241 */\n.blocklyDraggable:active {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Change the cursor on the whole drag surface in case the mouse gets\n   ahead of block during a drag. This way the cursor is still a closed hand.\n  */\n.blocklyBlockDragSurface .blocklyDraggable {\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n.blocklyDragging.blocklyDraggingDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyDragging>.blocklyPath,\n.blocklyDragging>.blocklyPathLight {\n  fill-opacity: .8;\n  stroke-opacity: .8;\n}\n\n.blocklyDragging>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyDisabled>.blocklyPath {\n  fill-opacity: .5;\n  stroke-opacity: .5;\n}\n\n.blocklyDisabled>.blocklyPathLight,\n.blocklyDisabled>.blocklyPathDark {\n  display: none;\n}\n\n.blocklyInsertionMarker>.blocklyPath,\n.blocklyInsertionMarker>.blocklyPathLight,\n.blocklyInsertionMarker>.blocklyPathDark {\n  fill-opacity: .2;\n  stroke: none;\n}\n\n.blocklyMultilineText {\n  font-family: monospace;\n}\n\n.blocklyNonEditableText>text {\n  pointer-events: none;\n}\n\n.blocklyFlyout {\n  position: absolute;\n  z-index: 20;\n}\n\n.blocklyText text {\n  cursor: default;\n}\n\n/*\n  Don't allow users to select text.  It gets annoying when trying to\n  drag a block and selected text moves instead.\n*/\n.blocklySvg text,\n.blocklyBlockDragSurface text {\n  user-select: none;\n  -ms-user-select: none;\n  -webkit-user-select: none;\n  cursor: inherit;\n}\n\n.blocklyHidden {\n  display: none;\n}\n\n.blocklyFieldDropdown:not(.blocklyHidden) {\n  display: block;\n}\n\n.blocklyIconGroup {\n  cursor: default;\n}\n\n.blocklyIconGroup:not(:hover),\n.blocklyIconGroupReadonly {\n  opacity: .6;\n}\n\n.blocklyIconShape {\n  fill: #00f;\n  stroke: #fff;\n  stroke-width: 1px;\n}\n\n.blocklyIconSymbol {\n  fill: #fff;\n}\n\n.blocklyMinimalBody {\n  margin: 0;\n  padding: 0;\n}\n\n.blocklyHtmlInput {\n  border: none;\n  border-radius: 4px;\n  height: 100%;\n  margin: 0;\n  outline: none;\n  padding: 0;\n  width: 100%;\n  text-align: center;\n  display: block;\n  box-sizing: border-box;\n}\n\n/* Remove the increase and decrease arrows on the field number editor */\ninput.blocklyHtmlInput[type=number]::-webkit-inner-spin-button,\ninput.blocklyHtmlInput[type=number]::-webkit-outer-spin-button {\n  -webkit-appearance: none;\n  margin: 0;\n}\n\ninput[type=number] {\n  -moz-appearance: textfield;\n}\n\n.blocklyMainBackground {\n  stroke-width: 1;\n  stroke: #c6c6c6;  /* Equates to #ddd due to border being off-pixel. */\n}\n\n.blocklyMutatorBackground {\n  fill: #fff;\n  stroke: #ddd;\n  stroke-width: 1;\n}\n\n.blocklyFlyoutBackground {\n  fill: #ddd;\n  fill-opacity: .8;\n}\n\n.blocklyMainWorkspaceScrollbar {\n  z-index: 20;\n}\n\n.blocklyFlyoutScrollbar {\n  z-index: 30;\n}\n\n.blocklyScrollbarHorizontal,\n.blocklyScrollbarVertical {\n  position: absolute;\n  outline: none;\n}\n\n.blocklyScrollbarBackground {\n  opacity: 0;\n}\n\n.blocklyScrollbarHandle {\n  fill: #ccc;\n}\n\n.blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyScrollbarHandle:hover {\n  fill: #bbb;\n}\n\n/* Darken flyout scrollbars due to being on a grey background. */\n/* By contrast, workspace scrollbars are on a white background. */\n.blocklyFlyout .blocklyScrollbarHandle {\n  fill: #bbb;\n}\n\n.blocklyFlyout .blocklyScrollbarBackground:hover+.blocklyScrollbarHandle,\n.blocklyFlyout .blocklyScrollbarHandle:hover {\n  fill: #aaa;\n}\n\n.blocklyInvalidInput {\n  background: #faa;\n}\n\n.blocklyVerticalMarker {\n  stroke-width: 3px;\n  fill: rgba(255,255,255,.5);\n  pointer-events: none;\n}\n\n.blocklyComputeCanvas {\n  position: absolute;\n  width: 0;\n  height: 0;\n}\n\n.blocklyNoPointerEvents {\n  pointer-events: none;\n}\n\n.blocklyContextMenu {\n  border-radius: 4px;\n  max-height: 100%;\n}\n\n.blocklyDropdownMenu {\n  border-radius: 2px;\n  padding: 0 !important;\n}\n\n.blocklyDropdownMenu .blocklyMenuItem {\n  /* 28px on the left for icon or checkbox. */\n  padding-left: 28px;\n}\n\n/* BiDi override for the resting state. */\n.blocklyDropdownMenu .blocklyMenuItemRtl {\n  /* Flip left/right padding for BiDi. */\n  padding-left: 5px;\n  padding-right: 28px;\n}\n\n.blocklyWidgetDiv .blocklyMenu {\n  background: #fff;\n  border: 1px solid transparent;\n  box-shadow: 0 0 3px 1px rgba(0,0,0,.3);\n  font: normal 13px Arial, sans-serif;\n  margin: 0;\n  outline: none;\n  padding: 4px 0;\n  position: absolute;\n  overflow-y: auto;\n  overflow-x: hidden;\n  max-height: 100%;\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n.blocklyWidgetDiv .blocklyMenu.blocklyFocused {\n  box-shadow: 0 0 6px 1px rgba(0,0,0,.3);\n}\n\n.blocklyDropDownDiv .blocklyMenu {\n  background: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  border: inherit;  /* Compatibility with gapi, reset from goog-menu */\n  font: normal 13px \"Helvetica Neue\", Helvetica, sans-serif;\n  outline: none;\n  position: relative;  /* Compatibility with gapi, reset from goog-menu */\n  z-index: 20000;  /* Arbitrary, but some apps depend on it... */\n}\n\n/* State: resting. */\n.blocklyMenuItem {\n  border: none;\n  color: #000;\n  cursor: pointer;\n  list-style: none;\n  margin: 0;\n  /* 7em on the right for shortcut. */\n  min-width: 7em;\n  padding: 6px 15px;\n  white-space: nowrap;\n}\n\n/* State: disabled. */\n.blocklyMenuItemDisabled {\n  color: #ccc;\n  cursor: inherit;\n}\n\n/* State: hover. */\n.blocklyMenuItemHighlight {\n  background-color: rgba(0,0,0,.1);\n}\n\n/* State: selected/checked. */\n.blocklyMenuItemCheckbox {\n  height: 16px;\n  position: absolute;\n  width: 16px;\n}\n\n.blocklyMenuItemSelected .blocklyMenuItemCheckbox {\n  background: url(<<<PATH>>>/sprites.png) no-repeat -48px -16px;\n  float: left;\n  margin-left: -24px;\n  position: static;  /* Scroll with the menu. */\n}\n\n.blocklyMenuItemRtl .blocklyMenuItemCheckbox {\n  float: right;\n  margin-right: -24px;\n}\n`;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.style');\n\nimport * as deprecation from './deprecation.js';\nimport {Coordinate} from './coordinate.js';\nimport {Rect} from './rect.js';\nimport {Size} from './size.js';\n\n\n/**\n * Gets the height and width of an element.\n * Similar to Closure's goog.style.getSize\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nexport function getSize(element: Element): Size {\n  return TEST_ONLY.getSizeInternal(element);\n}\n\n/**\n * Private version of getSize for stubbing in tests.\n */\nfunction getSizeInternal(element: Element): Size {\n  if (getComputedStyle(element, 'display') !== 'none') {\n    return getSizeWithDisplay(element);\n  }\n\n  // Evaluate size with a temporary element.\n  // AnyDuringMigration because:  Property 'style' does not exist on type\n  // 'Element'.\n  const style = (element as AnyDuringMigration).style;\n  const originalDisplay = style.display;\n  const originalVisibility = style.visibility;\n  const originalPosition = style.position;\n\n  style.visibility = 'hidden';\n  style.position = 'absolute';\n  style.display = 'inline';\n\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n\n  style.display = originalDisplay;\n  style.position = originalPosition;\n  style.visibility = originalVisibility;\n\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Gets the height and width of an element when the display is not none.\n *\n * @param element Element to get size of.\n * @returns Object with width/height properties.\n */\nfunction getSizeWithDisplay(element: Element): Size {\n  const offsetWidth = (element as HTMLElement).offsetWidth;\n  const offsetHeight = (element as HTMLElement).offsetHeight;\n  return new Size(offsetWidth, offsetHeight);\n}\n\n/**\n * Retrieves a computed style value of a node. It returns empty string\n * if the property requested is an SVG one and it has not been\n * explicitly set (firefox and webkit).\n *\n * Copied from Closure's goog.style.getComputedStyle\n *\n * @param element Element to get style of.\n * @param property Property to get (camel-case).\n * @returns Style value.\n */\nexport function getComputedStyle(element: Element, property: string): string {\n  const styles = window.getComputedStyle(element);\n  // element.style[..] is undefined for browser specific styles\n  // as 'filter'.\n  return (styles as AnyDuringMigration)[property] ||\n      styles.getPropertyValue(property);\n}\n\n/**\n * Gets the cascaded style value of a node, or null if the value cannot be\n * computed (only Internet Explorer can do this).\n *\n * Copied from Closure's goog.style.getCascadedStyle\n *\n * @param element Element to get style of.\n * @param style Property to get (camel-case).\n * @returns Style value.\n * @deprecated No longer provided by Blockly.\n */\nexport function getCascadedStyle(element: Element, style: string): string {\n  deprecation.warn(\n      'Blockly.utils.style.getCascadedStyle', 'version 9', 'version 10');\n  // AnyDuringMigration because:  Property 'currentStyle' does not exist on type\n  // 'Element'. AnyDuringMigration because:  Property 'currentStyle' does not\n  // exist on type 'Element'.\n  return (element as AnyDuringMigration).currentStyle ?\n      (element as AnyDuringMigration).currentStyle[style] :\n      '' as string;\n}\n\n/**\n * Returns a Coordinate object relative to the top-left of the HTML document.\n * Similar to Closure's goog.style.getPageOffset\n *\n * @param el Element to get the page offset for.\n * @returns The page offset.\n */\nexport function getPageOffset(el: Element): Coordinate {\n  const pos = new Coordinate(0, 0);\n  const box = el.getBoundingClientRect();\n  const documentElement = document.documentElement;\n  // Must add the scroll coordinates in to get the absolute page offset\n  // of element since getBoundingClientRect returns relative coordinates to\n  // the viewport.\n  const scrollCoord = new Coordinate(\n      window.pageXOffset || documentElement.scrollLeft,\n      window.pageYOffset || documentElement.scrollTop);\n  pos.x = box.left + scrollCoord.x;\n  pos.y = box.top + scrollCoord.y;\n\n  return pos;\n}\n\n/**\n * Calculates the viewport coordinates relative to the document.\n * Similar to Closure's goog.style.getViewportPageOffset\n *\n * @returns The page offset of the viewport.\n */\nexport function getViewportPageOffset(): Coordinate {\n  const body = document.body;\n  const documentElement = document.documentElement;\n  const scrollLeft = body.scrollLeft || documentElement.scrollLeft;\n  const scrollTop = body.scrollTop || documentElement.scrollTop;\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\n/**\n * Gets the computed border widths (on all sides) in pixels\n * Copied from Closure's goog.style.getBorderBox\n *\n * @param element  The element to get the border widths for.\n * @returns The computed border widths.\n */\nexport function getBorderBox(element: Element): Rect {\n  const left = parseFloat(getComputedStyle(element, 'borderLeftWidth'));\n  const right = parseFloat(getComputedStyle(element, 'borderRightWidth'));\n  const top = parseFloat(getComputedStyle(element, 'borderTopWidth'));\n  const bottom = parseFloat(getComputedStyle(element, 'borderBottomWidth'));\n\n  return new Rect(top, bottom, left, right);\n}\n\n/**\n * Changes the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.scrollIntoContainerView\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n */\nexport function scrollIntoContainerView(\n    element: Element, container: Element, opt_center?: boolean) {\n  const offset = getContainerOffsetToScrollInto(element, container, opt_center);\n  container.scrollLeft = offset.x;\n  container.scrollTop = offset.y;\n}\n\n/**\n * Calculate the scroll position of `container` with the minimum amount so\n * that the content and the borders of the given `element` become visible.\n * If the element is bigger than the container, its top left corner will be\n * aligned as close to the container's top left corner as possible.\n * Copied from Closure's goog.style.getContainerOffsetToScrollInto\n *\n * @param element The element to make visible.\n * @param container The container to scroll. If not set, then the document\n *     scroll element will be used.\n * @param opt_center Whether to center the element in the container.\n *     Defaults to false.\n * @returns The new scroll position of the container.\n */\nexport function getContainerOffsetToScrollInto(\n    element: Element, container: Element, opt_center?: boolean): Coordinate {\n  // Absolute position of the element's border's top left corner.\n  const elementPos = getPageOffset(element);\n  // Absolute position of the container's border's top left corner.\n  const containerPos = getPageOffset(container);\n  const containerBorder = getBorderBox(container);\n  // Relative pos. of the element's border box to the container's content box.\n  const relX = elementPos.x - containerPos.x - containerBorder.left;\n  const relY = elementPos.y - containerPos.y - containerBorder.top;\n  // How much the element can move in the container, i.e. the difference between\n  // the element's bottom-right-most and top-left-most position where it's\n  // fully visible.\n  const elementSize = getSizeWithDisplay(element);\n  const spaceX = container.clientWidth - elementSize.width;\n  const spaceY = container.clientHeight - elementSize.height;\n  let scrollLeft = container.scrollLeft;\n  let scrollTop = container.scrollTop;\n  if (opt_center) {\n    // All browsers round non-integer scroll positions down.\n    scrollLeft += relX - spaceX / 2;\n    scrollTop += relY - spaceY / 2;\n  } else {\n    // This formula was designed to give the correct scroll values in the\n    // following cases:\n    // - element is higher than container (spaceY < 0) => scroll down by relY\n    // - element is not higher that container (spaceY >= 0):\n    //   - it is above container (relY < 0) => scroll up by abs(relY)\n    //   - it is below container (relY > spaceY) => scroll down by relY - spaceY\n    //   - it is in the container => don't scroll\n    scrollLeft += Math.min(relX, Math.max(relX - spaceX, 0));\n    scrollTop += Math.min(relY, Math.max(relY - spaceY, 0));\n  }\n  return new Coordinate(scrollLeft, scrollTop);\n}\n\nexport const TEST_ONLY = {\n  getSizeInternal,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.svgMath');\n\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport {Coordinate} from './coordinate.js';\nimport * as deprecation from './deprecation.js';\nimport {Rect} from './rect.js';\nimport * as style from './style.js';\n\n\n/**\n * Static regex to pull the x,y values out of an SVG translate() directive.\n * Note that Firefox and IE (9,10) return 'translate(12)' instead of\n * 'translate(12, 0)'.\n * Note that IE (9,10) returns 'translate(16 8)' instead of 'translate(16, 8)'.\n * Note that IE has been reported to return scientific notation (0.123456e-42).\n */\nconst XY_REGEX = /translate\\(\\s*([-+\\d.e]+)([ ,]\\s*([-+\\d.e]+)\\s*)?/;\n\n/**\n * Static regex to pull the x,y values out of a translate() or translate3d()\n * style property.\n * Accounts for same exceptions as XY_REGEX.\n */\nconst XY_STYLE_REGEX =\n    /transform:\\s*translate(?:3d)?\\(\\s*([-+\\d.e]+)\\s*px([ ,]\\s*([-+\\d.e]+)\\s*px)?/;\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  const xy = new Coordinate(0, 0);\n  // First, check for x and y attributes.\n  // Checking for the existence of x/y properties is faster than getAttribute.\n  // However, x/y contains an SVGAnimatedLength object, so rely on getAttribute\n  // to get the number.\n  const x = (element as any).x && element.getAttribute('x');\n  const y = (element as any).y && element.getAttribute('y');\n  if (x) {\n    xy.x = parseInt(x);\n  }\n  if (y) {\n    xy.y = parseInt(y);\n  }\n  // Second, check for transform=\"translate(...)\" attribute.\n  const transform = element.getAttribute('transform');\n  const r = transform && transform.match(XY_REGEX);\n  if (r) {\n    xy.x += Number(r[1]);\n    if (r[3]) {\n      xy.y += Number(r[3]);\n    }\n  }\n\n  // Then check for style = transform: translate(...) or translate3d(...)\n  const style = element.getAttribute('style');\n  if (style && style.indexOf('translate') > -1) {\n    const styleComponents = style.match(XY_STYLE_REGEX);\n    if (styleComponents) {\n      xy.x += Number(styleComponents[1]);\n      if (styleComponents[3]) {\n        xy.y += Number(styleComponents[3]);\n      }\n    }\n  }\n  return xy;\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n */\nexport function getInjectionDivXY(element: Element): Coordinate {\n  let x = 0;\n  let y = 0;\n  while (element) {\n    const xy = getRelativeXY(element);\n    x = x + xy.x;\n    y = y + xy.y;\n    const classes = element.getAttribute('class') || '';\n    if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\n      break;\n    }\n    element = element.parentNode as Element;\n  }\n  return new Coordinate(x, y);\n}\n\n/**\n * Check if 3D transforms are supported by adding an element\n * and attempting to set the property.\n *\n * @returns True if 3D transforms are supported.\n * @deprecated No longer provided by Blockly.\n */\nexport function is3dSupported(): boolean {\n  // All browsers support translate3d in 2022.\n  deprecation.warn(\n      'Blockly.utils.svgMath.is3dSupported', 'version 9', 'version 10');\n  return true;\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  // Pixels, in window coordinates.\n  const scrollOffset = style.getViewportPageOffset();\n  return new Rect(\n      scrollOffset.y, document.documentElement.clientHeight + scrollOffset.y,\n      scrollOffset.x, document.documentElement.clientWidth + scrollOffset.x);\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n */\nexport function getDocumentScroll(): Coordinate {\n  const el = document.documentElement;\n  const win = window;\n  return new Coordinate(\n      win.pageXOffset || el.scrollLeft, win.pageYOffset || el.scrollTop);\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @returns The workspace coordinates.\n */\nexport function screenToWsCoordinates(\n    ws: WorkspaceSvg, screenCoordinates: Coordinate): Coordinate {\n  const screenX = screenCoordinates.x;\n  const screenY = screenCoordinates.y;\n\n  const injectionDiv = ws.getInjectionDiv();\n  // Bounding rect coordinates are in client coordinates, meaning that they\n  // are in pixels relative to the upper left corner of the visible browser\n  // window.  These coordinates change when you scroll the browser window.\n  const boundingRect = injectionDiv.getBoundingClientRect();\n\n  // The client coordinates offset by the injection div's upper left corner.\n  const clientOffsetPixels =\n      new Coordinate(screenX - boundingRect.left, screenY - boundingRect.top);\n\n  // The offset in pixels between the main workspace's origin and the upper\n  // left corner of the injection div.\n  const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n  // The position of the new comment in pixels relative to the origin of the\n  // main workspace.\n  const finalOffsetPixels =\n      Coordinate.difference(clientOffsetPixels, mainOffsetPixels);\n  // The position in main workspace coordinates.\n  const finalOffsetMainWs = finalOffsetPixels.scale(1 / ws.scale);\n  return finalOffsetMainWs;\n}\n\nexport const TEST_ONLY = {\n  XY_REGEX,\n  XY_STYLE_REGEX,\n};\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Xml');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {Connection} from './connection.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {inputTypes} from './input_types.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport * as utilsXml from './utils/xml.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Encode a block tree as XML.\n *\n * @param workspace The workspace containing blocks.\n * @param opt_noId True if the encoder should skip the block IDs.\n * @returns XML DOM element.\n */\nexport function workspaceToDom(\n    workspace: Workspace, opt_noId?: boolean): Element {\n  const treeXml = utilsXml.createElement('xml');\n  const variablesElement =\n      variablesToDom(Variables.allUsedVarModels(workspace));\n  if (variablesElement.hasChildNodes()) {\n    treeXml.appendChild(variablesElement);\n  }\n  const comments = workspace.getTopComments(true);\n  for (let i = 0; i < comments.length; i++) {\n    const comment = comments[i];\n    treeXml.appendChild(comment.toXmlWithXY(opt_noId));\n  }\n  const blocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < blocks.length; i++) {\n    const block = blocks[i];\n    treeXml.appendChild(blockToDomWithXY(block, opt_noId));\n  }\n  return treeXml;\n}\n\n/**\n * Encode a list of variables as XML.\n *\n * @param variableList List of all variable models.\n * @returns Tree of XML elements.\n */\nexport function variablesToDom(variableList: VariableModel[]): Element {\n  const variables = utilsXml.createElement('variables');\n  for (let i = 0; i < variableList.length; i++) {\n    const variable = variableList[i];\n    const element = utilsXml.createElement('variable');\n    element.appendChild(utilsXml.createTextNode(variable.name));\n    if (variable.type) {\n      element.setAttribute('type', variable.type);\n    }\n    element.id = variable.getId();\n    variables.appendChild(element);\n  }\n  return variables;\n}\n\n/**\n * Encode a block subtree as XML with XY coordinates.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDomWithXY(block: Block, opt_noId?: boolean): Element|\n    DocumentFragment {\n  if (block.isInsertionMarker()) {  // Skip over insertion markers.\n    block = block.getChildren(false)[0];\n    if (!block) {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  let width = 0;  // Not used in LTR.\n  if (block.workspace.RTL) {\n    width = block.workspace.getWidth();\n  }\n\n  const element = blockToDom(block, opt_noId);\n  if (isElement(element)) {\n    const xy = block.getRelativeToSurfaceXY();\n    element.setAttribute(\n        'x', String(Math.round(block.workspace.RTL ? width - xy.x : xy.x)));\n    element.setAttribute('y', String(Math.round(xy.y)));\n  }\n  return element;\n}\n\n/**\n * Encode a field as XML.\n *\n * @param field The field to encode.\n * @returns XML element, or null if the field did not need to be serialized.\n */\nfunction fieldToDom(field: Field): Element|null {\n  if (field.isSerializable()) {\n    const container = utilsXml.createElement('field');\n    container.setAttribute('name', field.name || '');\n    return field.toXml(container);\n  }\n  return null;\n}\n\n/**\n * Encode all of a block's fields as XML and attach them to the given tree of\n * XML elements.\n *\n * @param block A block with fields to be encoded.\n * @param element The XML element to which the field DOM should be attached.\n */\nfunction allFieldsToDom(block: Block, element: Element) {\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      const fieldDom = fieldToDom(field);\n      if (fieldDom) {\n        element.appendChild(fieldDom);\n      }\n    }\n  }\n}\n\n/**\n * Encode a block subtree as XML.\n *\n * @param block The root block to encode.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns Tree of XML elements or an empty document fragment if the block was\n *     an insertion marker.\n */\nexport function blockToDom(block: Block, opt_noId?: boolean): Element|\n    DocumentFragment {\n  // Skip over insertion markers.\n  if (block.isInsertionMarker()) {\n    const child = block.getChildren(false)[0];\n    if (child) {\n      return blockToDom(child);\n    } else {\n      // Disappears when appended.\n      return new DocumentFragment();\n    }\n  }\n\n  const element = utilsXml.createElement(block.isShadow() ? 'shadow' : 'block');\n  element.setAttribute('type', block.type);\n  if (!opt_noId) {\n    element.id = block.id;\n  }\n  if (block.mutationToDom) {\n    // Custom data for an advanced block.\n    const mutation = block.mutationToDom();\n    if (mutation && (mutation.hasChildNodes() || mutation.hasAttributes())) {\n      element.appendChild(mutation);\n    }\n  }\n\n  allFieldsToDom(block, element);\n\n  const commentText = block.getCommentText();\n  if (commentText) {\n    const size = block.commentModel.size;\n    const pinned = block.commentModel.pinned;\n\n    const commentElement = utilsXml.createElement('comment');\n    commentElement.appendChild(utilsXml.createTextNode(commentText));\n    commentElement.setAttribute('pinned', `${pinned}`);\n    commentElement.setAttribute('h', String(size.height));\n    commentElement.setAttribute('w', String(size.width));\n\n    element.appendChild(commentElement);\n  }\n\n  if (block.data) {\n    const dataElement = utilsXml.createElement('data');\n    dataElement.appendChild(utilsXml.createTextNode(block.data));\n    element.appendChild(dataElement);\n  }\n\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    let container: Element;\n    let empty = true;\n    if (input.type === inputTypes.DUMMY) {\n      continue;\n    } else {\n      const childBlock = input.connection!.targetBlock();\n      if (input.type === inputTypes.VALUE) {\n        container = utilsXml.createElement('value');\n      } else if (input.type === inputTypes.STATEMENT) {\n        container = utilsXml.createElement('statement');\n      }\n      const childShadow = input.connection!.getShadowDom();\n      if (childShadow && (!childBlock || !childBlock.isShadow())) {\n        container!.appendChild(cloneShadow(childShadow, opt_noId));\n      }\n      if (childBlock) {\n        const childElem = blockToDom(childBlock, opt_noId);\n        if (childElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n          container!.appendChild(childElem);\n          empty = false;\n        }\n      }\n    }\n    container!.setAttribute('name', input.name);\n    if (!empty) {\n      element.appendChild(container!);\n    }\n  }\n  if (block.inputsInline !== undefined &&\n      block.inputsInline !== block.inputsInlineDefault) {\n    element.setAttribute('inline', String(block.inputsInline));\n  }\n  if (block.isCollapsed()) {\n    element.setAttribute('collapsed', 'true');\n  }\n  if (!block.isEnabled()) {\n    element.setAttribute('disabled', 'true');\n  }\n  if (!block.isDeletable() && !block.isShadow()) {\n    element.setAttribute('deletable', 'false');\n  }\n  if (!block.isMovable() && !block.isShadow()) {\n    element.setAttribute('movable', 'false');\n  }\n  if (!block.isEditable()) {\n    element.setAttribute('editable', 'false');\n  }\n\n  const nextBlock = block.getNextBlock();\n  let container: Element;\n  if (nextBlock) {\n    const nextElem = blockToDom(nextBlock, opt_noId);\n    if (nextElem.nodeType === dom.NodeType.ELEMENT_NODE) {\n      container = utilsXml.createElement('next');\n      container.appendChild(nextElem);\n      element.appendChild(container);\n    }\n  }\n  const nextShadow =\n      block.nextConnection && block.nextConnection.getShadowDom();\n  if (nextShadow && (!nextBlock || !nextBlock.isShadow())) {\n    container!.appendChild(cloneShadow(nextShadow, opt_noId));\n  }\n\n  return element;\n}\n\n/**\n * Deeply clone the shadow's DOM so that changes don't back-wash to the block.\n *\n * @param shadow A tree of XML elements.\n * @param opt_noId True if the encoder should skip the block ID.\n * @returns A tree of XML elements.\n */\nfunction cloneShadow(shadow: Element, opt_noId?: boolean): Element {\n  shadow = shadow.cloneNode(true) as Element;\n  // Walk the tree looking for whitespace.  Don't prune whitespace in a tag.\n  let node: Node|null = shadow;\n  let textNode;\n  while (node) {\n    if (opt_noId && node.nodeName === 'shadow') {\n      // Strip off IDs from shadow blocks.  There should never be a 'block' as\n      // a child of a 'shadow', so no need to check that.\n      (node as Element).removeAttribute('id');\n    }\n    if (node.firstChild) {\n      node = node.firstChild;\n    } else {\n      while (node && !node.nextSibling) {\n        textNode = node;\n        node = node.parentNode;\n        if (textNode.nodeType === dom.NodeType.TEXT_NODE &&\n            (textNode as Text).data.trim() === '' &&\n            node?.firstChild !== textNode) {\n          // Prune whitespace after a tag.\n          dom.removeNode(textNode);\n        }\n      }\n      if (node) {\n        textNode = node;\n        node = node.nextSibling;\n        if (textNode.nodeType === dom.NodeType.TEXT_NODE &&\n            (textNode as Text).data.trim() === '') {\n          // Prune whitespace before a tag.\n          dom.removeNode(textNode);\n        }\n      }\n    }\n  }\n  return shadow;\n}\n\n/**\n * Converts a DOM structure into plain text.\n * Currently the text format is fairly ugly: all one line with no whitespace,\n * unless the DOM itself has whitespace built-in.\n *\n * @param dom A tree of XML nodes.\n * @returns Text representation.\n */\nexport function domToText(dom: Node): string {\n  const text = utilsXml.domToText(dom);\n  // Unpack self-closing tags.  These tags fail when embedded in HTML.\n  // <block name=\"foo\"/> -> <block name=\"foo\"></block>\n  return text.replace(/<(\\w+)([^<]*)\\/>/g, '<$1$2></$1>');\n}\n\n/**\n * Converts a DOM structure into properly indented text.\n *\n * @param dom A tree of XML elements.\n * @returns Text representation.\n */\nexport function domToPrettyText(dom: Node): string {\n  // This function is not guaranteed to be correct for all XML.\n  // But it handles the XML that Blockly generates.\n  const blob = domToText(dom);\n  // Place every open and close tag on its own line.\n  const lines = blob.split('<');\n  // Indent every line.\n  let indent = '';\n  for (let i = 1; i < lines.length; i++) {\n    const line = lines[i];\n    if (line[0] === '/') {\n      indent = indent.substring(2);\n    }\n    lines[i] = indent + '<' + line;\n    if (line[0] !== '/' && line.slice(-2) !== '/>') {\n      indent += '  ';\n    }\n  }\n  // Pull simple tags back together.\n  // E.g. <foo></foo>\n  let text = lines.join('\\n');\n  text = text.replace(/(<(\\w+)\\b[^>]*>[^\\n]*)\\n *<\\/\\2>/g, '$1</$2>');\n  // Trim leading blank line.\n  return text.replace(/^\\n/, '');\n}\n\n/**\n * Converts an XML string into a DOM structure.\n *\n * @param text An XML string.\n * @returns A DOM object representing the singular child of the document\n *     element.\n * @throws if the text doesn't parse.\n * @deprecated Moved to core/utils/xml.js.\n */\nexport function textToDom(text: string): Element {\n  deprecation.warn(\n      'Blockly.Xml.textToDom', 'version 9', 'version 10',\n      'Use Blockly.utils.xml.textToDom instead');\n  return utilsXml.textToDom(text);\n}\n\n/**\n * Clear the given workspace then decode an XML DOM and\n * create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n */\nexport function clearWorkspaceAndLoadFromXml(\n    xml: Element, workspace: WorkspaceSvg): string[] {\n  workspace.setResizesEnabled(false);\n  workspace.clear();\n  const blockIds = domToWorkspace(xml, workspace);\n  workspace.setResizesEnabled(true);\n  return blockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace.\n *\n * @param xml XML DOM.\n * @param workspace The workspace.\n * @returns An array containing new block IDs.\n * @suppress {strictModuleDepCheck} Suppress module check while workspace\n * comments are not bundled in.\n */\nexport function domToWorkspace(xml: Element, workspace: Workspace): string[] {\n  let width = 0;  // Not used in LTR.\n  if (workspace.RTL) {\n    width = workspace.getWidth();\n  }\n  const newBlockIds = [];  // A list of block IDs added by this call.\n  dom.startTextWidthCache();\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  // Disable workspace resizes as an optimization.\n  // Assume it is rendered so we can check.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(false);\n  }\n  let variablesFirst = true;\n  try {\n    for (let i = 0, xmlChild; xmlChild = xml.childNodes[i]; i++) {\n      const name = xmlChild.nodeName.toLowerCase();\n      const xmlChildElement = xmlChild as Element;\n      if (name === 'block' ||\n          name === 'shadow' && !eventUtils.getRecordUndo()) {\n        // Allow top-level shadow blocks if recordUndo is disabled since\n        // that means an undo is in progress.  Such a block is expected\n        // to be moved to a nested destination in the next operation.\n        const block = domToBlock(xmlChildElement, workspace);\n        newBlockIds.push(block.id);\n        const blockX = parseInt(xmlChildElement.getAttribute('x') ?? '10', 10);\n        const blockY = parseInt(xmlChildElement.getAttribute('y') ?? '10', 10);\n        if (!isNaN(blockX) && !isNaN(blockY)) {\n          block.moveBy(workspace.RTL ? width - blockX : blockX, blockY);\n        }\n        variablesFirst = false;\n      } else if (name === 'shadow') {\n        throw TypeError('Shadow block cannot be a top-level block.');\n      } else if (name === 'comment') {\n        if (workspace.rendered) {\n          WorkspaceCommentSvg.fromXmlRendered(\n              xmlChildElement, workspace as WorkspaceSvg, width);\n        } else {\n          WorkspaceComment.fromXml(xmlChildElement, workspace);\n        }\n      } else if (name === 'variables') {\n        if (variablesFirst) {\n          domToVariables(xmlChildElement, workspace);\n        } else {\n          throw Error(\n              '\\'variables\\' tag must exist once before block and ' +\n              'shadow tag elements in the workspace XML, but it was found in ' +\n              'another location.');\n        }\n        variablesFirst = false;\n      }\n    }\n  } finally {\n    eventUtils.setGroup(existingGroup);\n    dom.stopTextWidthCache();\n  }\n  // Re-enable workspace resizing.\n  if ((workspace as WorkspaceSvg).setResizesEnabled) {\n    (workspace as WorkspaceSvg).setResizesEnabled(true);\n  }\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n  return newBlockIds;\n}\n\n/**\n * Decode an XML DOM and create blocks on the workspace. Position the new\n * blocks immediately below prior blocks, aligned by their starting edge.\n *\n * @param xml The XML DOM.\n * @param workspace The workspace to add to.\n * @returns An array containing new block IDs.\n */\nexport function appendDomToWorkspace(\n    xml: Element, workspace: WorkspaceSvg): string[] {\n  // First check if we have a WorkspaceSvg, otherwise the blocks have no shape\n  // and the position does not matter.\n  // Assume it is rendered so we can check.\n  if (!(workspace as WorkspaceSvg).getBlocksBoundingBox) {\n    return domToWorkspace(xml, workspace);\n  }\n\n  const bbox = (workspace as WorkspaceSvg).getBlocksBoundingBox();\n  // Load the new blocks into the workspace and get the IDs of the new blocks.\n  const newBlockIds = domToWorkspace(xml, workspace);\n  if (bbox && bbox.top !== bbox.bottom) {  // Check if any previous block.\n    let offsetY = 0;  // Offset to add to y of the new block.\n    let offsetX = 0;\n    const farY = bbox.bottom;                             // Bottom position.\n    const topX = workspace.RTL ? bbox.right : bbox.left;  // X of bounding box.\n    // Check position of the new blocks.\n    let newLeftX = Infinity;    // X of top left corner.\n    let newRightX = -Infinity;  // X of top right corner.\n    let newY = Infinity;        // Y of top corner.\n    const ySeparation = 10;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const blockXY =\n          workspace.getBlockById(newBlockIds[i])!.getRelativeToSurfaceXY();\n      if (blockXY.y < newY) {\n        newY = blockXY.y;\n      }\n      if (blockXY.x < newLeftX) {  // if we left align also on x\n        newLeftX = blockXY.x;\n      }\n      if (blockXY.x > newRightX) {  // if we right align also on x\n        newRightX = blockXY.x;\n      }\n    }\n    offsetY = farY - newY + ySeparation;\n    offsetX = workspace.RTL ? topX - newRightX : topX - newLeftX;\n    for (let i = 0; i < newBlockIds.length; i++) {\n      const block = workspace.getBlockById(newBlockIds[i]);\n      block!.moveBy(offsetX, offsetY);\n    }\n  }\n  return newBlockIds;\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @returns The root block created.\n */\nexport function domToBlock(xmlBlock: Element, workspace: Workspace): Block {\n  // Create top-level block.\n  eventUtils.disable();\n  const variablesBeforeCreation = workspace.getAllVariables();\n  let topBlock;\n  try {\n    topBlock = domToBlockHeadless(xmlBlock, workspace);\n    // Generate list of all blocks.\n    if (workspace.rendered) {\n      const topBlockSvg = topBlock as BlockSvg;\n      const blocks = topBlock.getDescendants(false);\n      topBlockSvg.setConnectionTracking(false);\n      // Render each block.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).initSvg();\n      }\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        (blocks[i] as BlockSvg).render(false);\n      }\n      // Populating the connection database may be deferred until after the\n      // blocks have rendered.\n      setTimeout(function() {\n        if (!topBlockSvg.disposed) {\n          topBlockSvg.setConnectionTracking(true);\n        }\n      }, 1);\n      topBlockSvg.updateDisabled();\n      // Allow the scrollbars to resize and move based on the new contents.\n      // TODO(@picklesrus): #387. Remove when domToBlock avoids resizing.\n      (workspace as WorkspaceSvg).resizeContents();\n    } else {\n      const blocks = topBlock.getDescendants(false);\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].initModel();\n      }\n    }\n  } finally {\n    eventUtils.enable();\n  }\n  if (eventUtils.isEnabled()) {\n    const newVariables =\n        Variables.getAddedVariables(workspace, variablesBeforeCreation);\n    // Fire a VarCreate event for each (if any) new variable created.\n    for (let i = 0; i < newVariables.length; i++) {\n      const thisVariable = newVariables[i];\n      eventUtils.fire(\n          new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable));\n    }\n    // Block events come after var events, in case they refer to newly created\n    // variables.\n    eventUtils.fire(new (eventUtils.get(eventUtils.CREATE))(topBlock));\n  }\n  return topBlock;\n}\n\n/**\n * Decode an XML list of variables and add the variables to the workspace.\n *\n * @param xmlVariables List of XML variable elements.\n * @param workspace The workspace to which the variable should be added.\n */\nexport function domToVariables(xmlVariables: Element, workspace: Workspace) {\n  for (let i = 0; i < xmlVariables.children.length; i++) {\n    const xmlChild = xmlVariables.children[i];\n    const type = xmlChild.getAttribute('type');\n    const id = xmlChild.getAttribute('id');\n    const name = xmlChild.textContent;\n\n    if (!name) return;\n    workspace.createVariable(name, type, id);\n  }\n}\n\n/** A mapping of nodeName to node for child nodes of xmlBlock. */\ninterface childNodeTagMap {\n  mutation: Element[];\n  comment: Element[];\n  data: Element[];\n  field: Element[];\n  input: Element[];\n  next: Element[];\n}\n\n/**\n * Creates a mapping of childNodes for each supported XML tag for the provided\n * xmlBlock. Logs a warning for any encountered unsupported tags.\n *\n * @param xmlBlock XML block element.\n * @returns The childNode map from nodeName to node.\n */\nfunction mapSupportedXmlTags(xmlBlock: Element): childNodeTagMap {\n  const childNodeMap = {\n    mutation: new Array<Element>(),\n    comment: new Array<Element>(),\n    data: new Array<Element>(),\n    field: new Array<Element>(),\n    input: new Array<Element>(),\n    next: new Array<Element>(),\n  };\n  for (let i = 0; i < xmlBlock.children.length; i++) {\n    const xmlChild = xmlBlock.children[i];\n    if (xmlChild.nodeType === dom.NodeType.TEXT_NODE) {\n      // Ignore any text at the <block> level.  It's all whitespace anyway.\n      continue;\n    }\n    switch (xmlChild.nodeName.toLowerCase()) {\n      case 'mutation':\n        childNodeMap.mutation.push(xmlChild);\n        break;\n      case 'comment':\n        childNodeMap.comment.push(xmlChild);\n        break;\n      case 'data':\n        childNodeMap.data.push(xmlChild);\n        break;\n      case 'title':\n      // Titles were renamed to field in December 2013.\n      // Fall through.\n      case 'field':\n        childNodeMap.field.push(xmlChild);\n        break;\n      case 'value':\n      case 'statement':\n        childNodeMap.input.push(xmlChild);\n        break;\n      case 'next':\n        childNodeMap.next.push(xmlChild);\n        break;\n      default:\n        // Unknown tag; ignore.  Same principle as HTML parsers.\n        console.warn('Ignoring unknown tag: ' + xmlChild.nodeName);\n    }\n  }\n  return childNodeMap;\n}\n\n/**\n * Applies mutation tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n * @returns True if mutation may have added some elements that need\n *     initialization (requiring initSvg call).\n */\nfunction applyMutationTagNodes(xmlChildren: Element[], block: Block): boolean {\n  let shouldCallInitSvg = false;\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    // Custom data for an advanced block.\n    if (block.domToMutation) {\n      block.domToMutation(xmlChild);\n      if ((block as BlockSvg).initSvg) {\n        // Mutation may have added some elements that need initializing.\n        shouldCallInitSvg = true;\n      }\n    }\n  }\n  return shouldCallInitSvg;\n}\n\n/**\n * Applies comment tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyCommentTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const text = xmlChild.textContent;\n    const pinned = xmlChild.getAttribute('pinned') === 'true';\n    const width = parseInt(xmlChild.getAttribute('w') ?? '50', 10);\n    const height = parseInt(xmlChild.getAttribute('h') ?? '50', 10);\n\n    block.setCommentText(text);\n    block.commentModel.pinned = pinned;\n    if (!isNaN(width) && !isNaN(height)) {\n      block.commentModel.size = new Size(width, height);\n    }\n\n    if (pinned && (block as BlockSvg).getCommentIcon && !block.isInFlyout) {\n      const blockSvg = block as BlockSvg;\n      setTimeout(function() {\n        blockSvg.getCommentIcon()!.setVisible(true);\n      }, 1);\n    }\n  }\n}\n\n/**\n * Applies data tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyDataTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    block.data = xmlChild.textContent;\n  }\n}\n\n/**\n * Applies field tag child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param block The block to apply the child nodes on.\n */\nfunction applyFieldTagNodes(xmlChildren: Element[], block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    if (!nodeName) {\n      console.warn(`Ignoring unnamed field in block ${block.type}`);\n      continue;\n    }\n    domToField(block, nodeName, xmlChild);\n  }\n}\n\n/**\n * Finds any enclosed blocks or shadows within this XML node.\n *\n * @param xmlNode The XML node to extract child block info from.\n * @returns Any found child block.\n */\nfunction findChildBlocks(xmlNode: Element):\n    {childBlockElement: Element|null, childShadowElement: Element|null} {\n  let childBlockElement: Element|null = null;\n  let childShadowElement: Element|null = null;\n  for (let i = 0; i < xmlNode.childNodes.length; i++) {\n    const xmlChild = xmlNode.childNodes[i];\n    if (isElement(xmlChild)) {\n      if (xmlChild.nodeName.toLowerCase() === 'block') {\n        childBlockElement = xmlChild;\n      } else if (xmlChild.nodeName.toLowerCase() === 'shadow') {\n        childShadowElement = xmlChild;\n      }\n    }\n  }\n  return {childBlockElement, childShadowElement};\n}\n/**\n * Applies input child nodes (value or statement) to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n * @param prototypeName The prototype name of the block.\n */\nfunction applyInputTagNodes(\n    xmlChildren: Element[], workspace: Workspace, block: Block,\n    prototypeName: string) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const nodeName = xmlChild.getAttribute('name');\n    const input = nodeName ? block.getInput(nodeName) : null;\n    if (!input) {\n      console.warn(\n          'Ignoring non-existent input ' + nodeName + ' in block ' +\n          prototypeName);\n      break;\n    }\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!input.connection) {\n        throw TypeError('Input connection does not exist.');\n      }\n      domToBlockHeadless(\n          childBlockInfo.childBlockElement, workspace, input.connection, false);\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement) {\n      input.connection?.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Applies next child nodes to the given block.\n *\n * @param xmlChildren Child nodes.\n * @param workspace The workspace containing the given block.\n * @param block The block to apply the child nodes on.\n */\nfunction applyNextTagNodes(\n    xmlChildren: Element[], workspace: Workspace, block: Block) {\n  for (let i = 0; i < xmlChildren.length; i++) {\n    const xmlChild = xmlChildren[i];\n    const childBlockInfo = findChildBlocks(xmlChild);\n    if (childBlockInfo.childBlockElement) {\n      if (!block.nextConnection) {\n        throw TypeError('Next statement does not exist.');\n      }\n      // If there is more than one XML 'next' tag.\n      if (block.nextConnection.isConnected()) {\n        throw TypeError('Next statement is already connected.');\n      }\n      // Create child block.\n      domToBlockHeadless(\n          childBlockInfo.childBlockElement, workspace, block.nextConnection,\n          true);\n    }\n    // Set shadow after so we don't create a shadow we delete immediately.\n    if (childBlockInfo.childShadowElement && block.nextConnection) {\n      block.nextConnection.setShadowDom(childBlockInfo.childShadowElement);\n    }\n  }\n}\n\n/**\n * Decode an XML block tag and create a block (and possibly sub blocks) on the\n * workspace.\n *\n * @param xmlBlock XML block element.\n * @param workspace The workspace.\n * @param parentConnection The parent connection to to connect this block to\n *     after instantiating.\n * @param connectedToParentNext Whether the provided parent connection is a next\n *     connection, rather than output or statement.\n * @returns The root block created.\n */\nfunction domToBlockHeadless(\n    xmlBlock: Element, workspace: Workspace, parentConnection?: Connection,\n    connectedToParentNext?: boolean): Block {\n  let block = null;\n  const prototypeName = xmlBlock.getAttribute('type');\n  if (!prototypeName) {\n    throw TypeError('Block type unspecified: ' + xmlBlock.outerHTML);\n  }\n  const id = xmlBlock.getAttribute('id') ?? undefined;\n  block = workspace.newBlock(prototypeName, id);\n\n  // Preprocess childNodes so tags can be processed in a consistent order.\n  const xmlChildNameMap = mapSupportedXmlTags(xmlBlock);\n\n  const shouldCallInitSvg =\n      applyMutationTagNodes(xmlChildNameMap.mutation, block);\n  applyCommentTagNodes(xmlChildNameMap.comment, block);\n  applyDataTagNodes(xmlChildNameMap.data, block);\n\n  // Connect parent after processing mutation and before setting fields.\n  if (parentConnection) {\n    if (connectedToParentNext) {\n      if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError('Next block does not have previous statement.');\n      }\n    } else {\n      if (block.outputConnection) {\n        parentConnection.connect(block.outputConnection);\n      } else if (block.previousConnection) {\n        parentConnection.connect(block.previousConnection);\n      } else {\n        throw TypeError(\n            'Child block does not have output or previous statement.');\n      }\n    }\n  }\n\n  applyFieldTagNodes(xmlChildNameMap.field, block);\n  applyInputTagNodes(xmlChildNameMap.input, workspace, block, prototypeName);\n  applyNextTagNodes(xmlChildNameMap.next, workspace, block);\n\n  if (shouldCallInitSvg) {\n    // This shouldn't even be called here\n    // (ref: https://github.com/google/blockly/pull/4296#issuecomment-884226021\n    // But the XML serializer/deserializer is iceboxed so I'm not going to fix\n    // it.\n    (block as BlockSvg).initSvg();\n  }\n\n  const inline = xmlBlock.getAttribute('inline');\n  if (inline) {\n    block.setInputsInline(inline === 'true');\n  }\n  const disabled = xmlBlock.getAttribute('disabled');\n  if (disabled) {\n    block.setEnabled(disabled !== 'true' && disabled !== 'disabled');\n  }\n  const deletable = xmlBlock.getAttribute('deletable');\n  if (deletable) {\n    block.setDeletable(deletable === 'true');\n  }\n  const movable = xmlBlock.getAttribute('movable');\n  if (movable) {\n    block.setMovable(movable === 'true');\n  }\n  const editable = xmlBlock.getAttribute('editable');\n  if (editable) {\n    block.setEditable(editable === 'true');\n  }\n  const collapsed = xmlBlock.getAttribute('collapsed');\n  if (collapsed) {\n    block.setCollapsed(collapsed === 'true');\n  }\n  if (xmlBlock.nodeName.toLowerCase() === 'shadow') {\n    // Ensure all children are also shadows.\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      const child = children[i];\n      if (!child.isShadow()) {\n        throw TypeError('Shadow block not allowed non-shadow child.');\n      }\n    }\n    // Ensure this block doesn't have any variable inputs.\n    if (block.getVarModels().length) {\n      throw TypeError('Shadow blocks cannot have variable references.');\n    }\n    block.setShadow(true);\n  }\n  return block;\n}\n\n/**\n * Decode an XML field tag and set the value of that field on the given block.\n *\n * @param block The block that is currently being deserialized.\n * @param fieldName The name of the field on the block.\n * @param xml The field tag to decode.\n */\nfunction domToField(block: Block, fieldName: string, xml: Element) {\n  const field = block.getField(fieldName);\n  if (!field) {\n    console.warn(\n        'Ignoring non-existent field ' + fieldName + ' in block ' + block.type);\n    return;\n  }\n  field.fromXml(xml);\n}\n\n/**\n * Remove any 'next' block (statements in a stack).\n *\n * @param xmlBlock XML block element or an empty DocumentFragment if the block\n *     was an insertion marker.\n */\nexport function deleteNext(xmlBlock: Element|DocumentFragment) {\n  for (let i = 0; i < xmlBlock.childNodes.length; i++) {\n    const child = xmlBlock.childNodes[i];\n    if (child.nodeName.toLowerCase() === 'next') {\n      xmlBlock.removeChild(child);\n      break;\n    }\n  }\n}\n\nfunction isElement(node: Node): node is Element {\n  return node.nodeType === dom.NodeType.ELEMENT_NODE;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.registry');\n\n// eslint-disable-next-line no-unused-vars\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\n\n\n/**\n * Registers the given serializer so that it can be used for serialization and\n * deserialization.\n *\n * @param name The name of the serializer to register.\n * @param serializer The serializer to register.\n */\nexport function register(name: string, serializer: ISerializer) {\n  registry.register(registry.Type.SERIALIZER, name, serializer);\n}\n\n/**\n * Unregisters the serializer associated with the given name.\n *\n * @param name The name of the serializer to unregister.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.SERIALIZER, name);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.blocks');\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport type {Connection} from '../connection.js';\nimport * as eventUtils from '../events/utils.js';\nimport {inputTypes} from '../input_types.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport {Size} from '../utils/size.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\n\nimport {BadConnectionCheck, MissingBlockType, MissingConnection, RealChildOfShadow} from './exceptions.js';\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n\n// TODO(#5160): Remove this once lint is fixed.\n/* eslint-disable no-use-before-define */\n\n/**\n * Represents the state of a connection.\n */\nexport interface ConnectionState {\n  shadow: State|undefined;\n  block: State|undefined;\n}\n\n/**\n * Represents the state of a given block.\n */\nexport interface State {\n  type: string;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  deletable?: boolean;\n  movable?: boolean;\n  editable?: boolean;\n  enabled?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * Returns the state of the given block as a plain JavaScript object.\n *\n * @param block The block to serialize.\n * @param param1 addCoordinates: If true, the coordinates of the block are added\n *     to the serialized state. False by default. addinputBlocks: If true,\n *     children of the block which are connected to inputs will be serialized.\n *     True by default. addNextBlocks: If true, children of the block which are\n *     connected to the block's next connection (if it exists) will be\n *     serialized. True by default. doFullSerialization: If true, fields that\n *     normally just save a reference to some external state (eg variables) will\n *     instead serialize all of the info about that state. This supports\n *     deserializing the block into a workspace where that state doesn't yet\n *     exist. True by default.\n * @returns The serialized state of the block, or null if the block could not be\n *     serialied (eg it was an insertion marker).\n */\nexport function save(block: Block, {\n  addCoordinates = false,\n  addInputBlocks = true,\n  addNextBlocks = true,\n  doFullSerialization = true,\n}: {\n  addCoordinates?: boolean,\n  addInputBlocks?: boolean,\n  addNextBlocks?: boolean,\n  doFullSerialization?: boolean\n} = {}): State|null {\n  if (block.isInsertionMarker()) {\n    return null;\n  }\n\n  const state = {\n    'type': block.type,\n    'id': block.id,\n  };\n\n  if (addCoordinates) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveCoords(block, state as AnyDuringMigration);\n  }\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveAttributes(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveExtraState(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveIcons(block, state as AnyDuringMigration);\n  // AnyDuringMigration because:  Argument of type '{ type: string; id: string;\n  // }' is not assignable to parameter of type 'State'.\n  saveFields(block, state as AnyDuringMigration, doFullSerialization);\n  if (addInputBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveInputBlocks(block, state as AnyDuringMigration, doFullSerialization);\n  }\n  if (addNextBlocks) {\n    // AnyDuringMigration because:  Argument of type '{ type: string; id:\n    // string; }' is not assignable to parameter of type 'State'.\n    saveNextBlocks(block, state as AnyDuringMigration, doFullSerialization);\n  }\n\n  // AnyDuringMigration because:  Type '{ type: string; id: string; }' is not\n  // assignable to type 'State'.\n  return state as AnyDuringMigration;\n}\n\n/**\n * Adds attributes to the given state object based on the state of the block.\n * Eg collapsed, disabled, inline, etc.\n *\n * @param block The block to base the attributes on.\n * @param state The state object to append to.\n */\nfunction saveAttributes(block: Block, state: State) {\n  if (block.isCollapsed()) {\n    state['collapsed'] = true;\n  }\n  if (!block.isEnabled()) {\n    state['enabled'] = false;\n  }\n  if (!block.isOwnDeletable()) {\n    state['deletable'] = false;\n  }\n  if (!block.isOwnMovable()) {\n    state['movable'] = false;\n  }\n  if (!block.isOwnEditable()) {\n    state['editable'] = false;\n  }\n  if (block.inputsInline !== undefined &&\n      block.inputsInline !== block.inputsInlineDefault) {\n    state['inline'] = block.inputsInline;\n  }\n  // Data is a nullable string, so we don't need to worry about falsy values.\n  if (block.data) {\n    state['data'] = block.data;\n  }\n}\n\n/**\n * Adds the coordinates of the given block to the given state object.\n *\n * @param block The block to base the coordinates on.\n * @param state The state object to append to.\n */\nfunction saveCoords(block: Block, state: State) {\n  const workspace = block.workspace;\n  const xy = block.getRelativeToSurfaceXY();\n  state['x'] = Math.round(workspace.RTL ? workspace.getWidth() - xy.x : xy.x);\n  state['y'] = Math.round(xy.y);\n}\n/**\n * Adds any extra state the block may provide to the given state object.\n *\n * @param block The block to serialize the extra state of.\n * @param state The state object to append to.\n */\nfunction saveExtraState(block: Block, state: State) {\n  if (block.saveExtraState) {\n    const extraState = block.saveExtraState();\n    if (extraState !== null) {\n      state['extraState'] = extraState;\n    }\n  } else if (block.mutationToDom) {\n    const extraState = block.mutationToDom();\n    if (extraState !== null) {\n      state['extraState'] =\n          Xml.domToText(extraState)\n              .replace(\n                  ' xmlns=\"https://developers.google.com/blockly/xml\"', '');\n    }\n  }\n}\n\n/**\n * Adds the state of all of the icons on the block to the given state object.\n *\n * @param block The block to serialize the icon state of.\n * @param state The state object to append to.\n */\nfunction saveIcons(block: Block, state: State) {\n  // TODO(#2105): Remove this logic and put it in the icon.\n  if (block.getCommentText()) {\n    state['icons'] = {\n      'comment': {\n        'text': block.getCommentText(),\n        'pinned': block.commentModel.pinned,\n        'height': Math.round(block.commentModel.size.height),\n        'width': Math.round(block.commentModel.size.width),\n      },\n    };\n  }\n}\n\n/**\n * Adds the state of all of the fields on the block to the given state object.\n *\n * @param block The block to serialize the field state of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to serialize the full state of the\n *     field (rather than possibly saving a reference to some state).\n */\nfunction saveFields(block: Block, state: State, doFullSerialization: boolean) {\n  const fields = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    for (let j = 0; j < input.fieldRow.length; j++) {\n      const field = input.fieldRow[j];\n      if (field.isSerializable()) {\n        fields[field.name!] = field.saveState(doFullSerialization);\n      }\n    }\n  }\n  if (Object.keys(fields).length) {\n    state['fields'] = fields;\n  }\n}\n\n/**\n * Adds the state of all of the child blocks of the given block (which are\n * connected to inputs) to the given state object.\n *\n * @param block The block to serialize the input blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveInputBlocks(\n    block: Block, state: State, doFullSerialization: boolean) {\n  const inputs = Object.create(null);\n  for (let i = 0; i < block.inputList.length; i++) {\n    const input = block.inputList[i];\n    if (input.type === inputTypes.DUMMY) {\n      continue;\n    }\n    const connectionState =\n        saveConnection(input.connection as Connection, doFullSerialization);\n    if (connectionState) {\n      inputs[input.name] = connectionState;\n    }\n  }\n\n  if (Object.keys(inputs).length) {\n    state['inputs'] = inputs;\n  }\n}\n\n/**\n * Adds the state of all of the next blocks of the given block to the given\n * state object.\n *\n * @param block The block to serialize the next blocks of.\n * @param state The state object to append to.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveNextBlocks(\n    block: Block, state: State, doFullSerialization: boolean) {\n  if (!block.nextConnection) {\n    return;\n  }\n  const connectionState =\n      saveConnection(block.nextConnection, doFullSerialization);\n  if (connectionState) {\n    state['next'] = connectionState;\n  }\n}\n\n/**\n * Returns the state of the given connection (ie the state of any connected\n * shadow or real blocks).\n *\n * @param connection The connection to serialize the connected blocks of.\n * @returns An object containing the state of any connected shadow block, or any\n *     connected real block.\n * @param doFullSerialization Whether or not to do full serialization.\n */\nfunction saveConnection(connection: Connection, doFullSerialization: boolean):\n    ConnectionState|null {\n  const shadow = connection.getShadowState(true);\n  const child = connection.targetBlock();\n  if (!shadow && !child) {\n    return null;\n  }\n  const state = Object.create(null);\n  if (shadow) {\n    state['shadow'] = shadow;\n  }\n  if (child && !child.isShadow()) {\n    state['block'] = save(child, {doFullSerialization});\n  }\n  return state;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n * @returns The block that was just loaded.\n */\nexport function append(\n    state: State, workspace: Workspace,\n    {recordUndo = false}: {recordUndo?: boolean} = {}): Block {\n  return appendInternal(state, workspace, {recordUndo});\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined internally so that the extra parameters don't clutter our\n * external API.\n * But it is exported so that other places within Blockly can call it directly\n * with the extra parameters.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: If true, the block will be set to a shadow block after\n *     it is created. False by default. recordUndo: If true, events triggered by\n *     this function will be undo-able by the user. False by default.\n * @returns The block that was just appended.\n * @internal\n */\nexport function appendInternal(\n    state: State, workspace: Workspace,\n    {parentConnection = undefined, isShadow = false, recordUndo = false}: {\n      parentConnection?: Connection,\n      isShadow?: boolean,\n      recordUndo?: boolean\n    } = {}): Block {\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n  eventUtils.disable();\n\n  const block = appendPrivate(state, workspace, {parentConnection, isShadow});\n\n  eventUtils.enable();\n  eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block));\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n\n  // Adding connections to the connection db is expensive. This defers that\n  // operation to decrease load time.\n  if (workspace.rendered) {\n    const blockSvg = block as BlockSvg;\n    setTimeout(() => {\n      if (!blockSvg.disposed) {\n        blockSvg.setConnectionTracking(true);\n      }\n    }, 1);\n  }\n\n  return block;\n}\n\n/**\n * Loads the block represented by the given state into the given workspace.\n * This is defined privately so that it can be called recursively without firing\n * eroneous events. Events (and other things we only want to occur on the top\n * block) are handled by appendInternal.\n *\n * @param state The state of a block to deserialize into the workspace.\n * @param workspace The workspace to add the block to.\n * @param param1 parentConnection: If provided, the system will attempt to\n *     connect the block to this connection after it is created. Undefined by\n *     default. isShadow: The block will be set to a shadow block after it is\n *     created. False by default.\n * @returns The block that was just appended.\n */\nfunction appendPrivate(\n    state: State, workspace: Workspace,\n    {parentConnection = undefined, isShadow = false}:\n        {parentConnection?: Connection, isShadow?: boolean} = {}): Block {\n  if (!state['type']) {\n    throw new MissingBlockType(state);\n  }\n\n  const block = workspace.newBlock(state['type'], state['id']);\n  block.setShadow(isShadow);\n  loadCoords(block, state);\n  loadAttributes(block, state);\n  loadExtraState(block, state);\n  tryToConnectParent(parentConnection, block, state);\n  loadIcons(block, state);\n  loadFields(block, state);\n  loadInputBlocks(block, state);\n  loadNextBlocks(block, state);\n  initBlock(block, workspace.rendered);\n\n  return block;\n}\n\n/**\n * Applies any coordinate information available on the state object to the\n * block.\n *\n * @param block The block to set the position of.\n * @param state The state object to reference.\n */\nfunction loadCoords(block: Block, state: State) {\n  let x = state['x'] === undefined ? 0 : state['x'];\n  const y = state['y'] === undefined ? 0 : state['y'];\n\n  const workspace = block.workspace;\n  x = workspace.RTL ? workspace.getWidth() - x : x;\n\n  block.moveBy(x, y);\n}\n\n/**\n * Applies any attribute information available on the state object to the block.\n *\n * @param block The block to set the attributes of.\n * @param state The state object to reference.\n */\nfunction loadAttributes(block: Block, state: State) {\n  if (state['collapsed']) {\n    block.setCollapsed(true);\n  }\n  if (state['deletable'] === false) {\n    block.setDeletable(false);\n  }\n  if (state['movable'] === false) {\n    block.setMovable(false);\n  }\n  if (state['editable'] === false) {\n    block.setEditable(false);\n  }\n  if (state['enabled'] === false) {\n    block.setEnabled(false);\n  }\n  if (state['inline'] !== undefined) {\n    block.setInputsInline(state['inline']);\n  }\n  if (state['data'] !== undefined) {\n    block.data = state['data'];\n  }\n}\n\n/**\n * Applies any extra state information available on the state object to the\n * block.\n *\n * @param block The block to set the extra state of.\n * @param state The state object to reference.\n */\nfunction loadExtraState(block: Block, state: State) {\n  if (!state['extraState']) {\n    return;\n  }\n  if (block.loadExtraState) {\n    block.loadExtraState(state['extraState']);\n  } else if (block.domToMutation) {\n    block.domToMutation(utilsXml.textToDom(state['extraState']));\n  }\n}\n\n/**\n * Attempts to connect the block to the parent connection, if it exists.\n *\n * @param parentConnection The parent connection to try to connect the block to.\n * @param child The block to try to connect to the parent.\n * @param state The state which defines the given block\n */\nfunction tryToConnectParent(\n    parentConnection: Connection|undefined, child: Block, state: State) {\n  if (!parentConnection) {\n    return;\n  }\n\n  if (parentConnection.getSourceBlock().isShadow() && !child.isShadow()) {\n    throw new RealChildOfShadow(state);\n  }\n\n  let connected = false;\n  let childConnection;\n  if (parentConnection.type === inputTypes.VALUE) {\n    childConnection = child.outputConnection;\n    if (!childConnection) {\n      throw new MissingConnection('output', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  } else {  // Statement type.\n    childConnection = child.previousConnection;\n    if (!childConnection) {\n      throw new MissingConnection('previous', child, state);\n    }\n    connected = parentConnection.connect(childConnection);\n  }\n\n  if (!connected) {\n    const checker = child.workspace.connectionChecker;\n    throw new BadConnectionCheck(\n        checker.getErrorMessage(\n            checker.canConnectWithReason(\n                childConnection, parentConnection, false),\n            childConnection, parentConnection),\n        parentConnection.type === inputTypes.VALUE ? 'output connection' :\n                                                     'previous connection',\n        child, state);\n  }\n}\n\n/**\n * Applies icon state to the icons on the block, based on the given state\n * object.\n *\n * @param block The block to set the icon state of.\n * @param state The state object to reference.\n */\nfunction loadIcons(block: Block, state: State) {\n  if (!state['icons']) {\n    return;\n  }\n  // TODO(#2105): Remove this logic and put it in the icon.\n  const comment = state['icons']['comment'];\n  if (comment) {\n    block.setCommentText(comment['text']);\n    // Load if saved. (Cleaned unnecessary attributes when in the trashcan.)\n    if ('pinned' in comment) {\n      block.commentModel.pinned = comment['pinned'];\n    }\n    if ('width' in comment && 'height' in comment) {\n      block.commentModel.size = new Size(comment['width'], comment['height']);\n    }\n    if (comment['pinned'] && block.rendered && !block.isInFlyout) {\n      // Give the block a chance to be positioned and rendered before showing.\n      const blockSvg = block as BlockSvg;\n      setTimeout(() => blockSvg.getCommentIcon()!.setVisible(true), 1);\n    }\n  }\n}\n\n/**\n * Applies any field information available on the state object to the block.\n *\n * @param block The block to set the field state of.\n * @param state The state object to reference.\n */\nfunction loadFields(block: Block, state: State) {\n  if (!state['fields']) {\n    return;\n  }\n  const keys = Object.keys(state['fields']);\n  for (let i = 0; i < keys.length; i++) {\n    const fieldName = keys[i];\n    const fieldState = state['fields'][fieldName];\n    const field = block.getField(fieldName);\n    if (!field) {\n      console.warn(\n          `Ignoring non-existant field ${fieldName} in block ${block.type}`);\n      continue;\n    }\n    field.loadState(fieldState);\n  }\n}\n\n/**\n * Creates any child blocks (attached to inputs) defined by the given state\n * and attaches them to the given block.\n *\n * @param block The block to attach input blocks to.\n * @param state The state object to reference.\n */\nfunction loadInputBlocks(block: Block, state: State) {\n  if (!state['inputs']) {\n    return;\n  }\n  const keys = Object.keys(state['inputs']);\n  for (let i = 0; i < keys.length; i++) {\n    const inputName = keys[i];\n    const input = block.getInput(inputName);\n    if (!input || !input.connection) {\n      throw new MissingConnection(inputName, block, state);\n    }\n    loadConnection(input.connection, state['inputs'][inputName]);\n  }\n}\n\n/**\n * Creates any next blocks defined by the given state and attaches them to the\n * given block.\n *\n * @param block The block to attach next blocks to.\n * @param state The state object to reference.\n */\nfunction loadNextBlocks(block: Block, state: State) {\n  if (!state['next']) {\n    return;\n  }\n  if (!block.nextConnection) {\n    throw new MissingConnection('next', block, state);\n  }\n  loadConnection(block.nextConnection, state['next']);\n}\n/**\n * Applies the state defined by connectionState to the given connection, ie\n * assigns shadows and attaches child blocks.\n *\n * @param connection The connection to deserialize the connected blocks of.\n * @param connectionState The object containing the state of any connected\n *     shadow block, or any connected real block.\n */\nfunction loadConnection(\n    connection: Connection, connectionState: ConnectionState) {\n  if (connectionState['shadow']) {\n    connection.setShadowState(connectionState['shadow']);\n  }\n  if (connectionState['block']) {\n    appendPrivate(\n        connectionState['block'], connection.getSourceBlock().workspace,\n        {parentConnection: connection});\n  }\n}\n\n// TODO(#5146): Remove this from the serialization system.\n/**\n * Initializes the give block, eg init the model, inits the svg, renders, etc.\n *\n * @param block The block to initialize.\n * @param rendered Whether the block is a rendered or headless block.\n */\nfunction initBlock(block: Block, rendered: boolean) {\n  if (rendered) {\n    const blockSvg = block as BlockSvg;\n    // Adding connections to the connection db is expensive. This defers that\n    // operation to decrease load time.\n    blockSvg.setConnectionTracking(false);\n\n    blockSvg.initSvg();\n    blockSvg.render(false);\n    // fixes #6076 JSO deserialization doesn't\n    // set .iconXY_ property so here it will be set\n    const icons = blockSvg.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].computeIconLocation();\n    }\n  } else {\n    block.initModel();\n  }\n}\n\n// Alias to disambiguate saving within the serializer.\nconst saveBlock = save;\n\n/**\n * Serializer for saving and loading block state.\n */\nexport class BlockSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing blocks. */\n    this.priority = priorities.BLOCKS;\n  }\n\n  /**\n   * Serializes the blocks of the given workspace.\n   *\n   * @param workspace The workspace to save the blocks of.\n   * @returns The state of the workspace's blocks, or null if there are no\n   *     blocks.\n   */\n  save(workspace: Workspace): {languageVersion: number, blocks: State[]}|null {\n    const blockStates = [];\n    for (const block of workspace.getTopBlocks(false)) {\n      const state =\n          saveBlock(block, {addCoordinates: true, doFullSerialization: false});\n      if (state) {\n        blockStates.push(state);\n      }\n    }\n    if (blockStates.length) {\n      return {\n        'languageVersion': 0,  // Currently unused.\n        'blocks': blockStates,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Deserializes the blocks defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the blocks to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(\n      state: {languageVersion: number, blocks: State[]}, workspace: Workspace) {\n    const blockStates = state['blocks'];\n    for (const state of blockStates) {\n      append(state, workspace, {recordUndo: eventUtils.getRecordUndo()});\n    }\n  }\n\n  /**\n   * Disposes of any blocks that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the blocks of.\n   */\n  clear(workspace: Workspace) {\n    // Cannot use workspace.clear() because that also removes variables.\n    for (const block of workspace.getTopBlocks(false)) {\n      block.dispose(false);\n    }\n  }\n}\n\nserializationRegistry.register('blocks', new BlockSerializer());\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Connection');\n\nimport type {Block} from './block.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './input.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Xml from './xml.js';\n\n\n/**\n * Class for a connection between blocks.\n */\nexport class Connection implements IASTNodeLocationWithBlock {\n  /** Constants for checking whether two connections are compatible. */\n  static CAN_CONNECT = 0;\n  static REASON_SELF_CONNECTION = 1;\n  static REASON_WRONG_TYPE = 2;\n  static REASON_TARGET_NULL = 3;\n  static REASON_CHECKS_FAILED = 4;\n  static REASON_DIFFERENT_WORKSPACES = 5;\n  static REASON_SHADOW_PARENT = 6;\n  static REASON_DRAG_CHECKS_FAILED = 7;\n  static REASON_PREVIOUS_AND_OUTPUT = 8;\n\n  protected sourceBlock_: Block;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  targetConnection: Connection|null = null;\n\n  /**\n   * Has this connection been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** List of compatible value types.  Null if all types are compatible. */\n  private check_: string[]|null = null;\n\n  /** DOM representation of a shadow block, or null if none. */\n  private shadowDom_: Element|null = null;\n\n  /**\n   * Horizontal location of this connection.\n   *\n   * @internal\n   */\n  x = 0;\n\n  /**\n   * Vertical location of this connection.\n   *\n   * @internal\n   */\n  y = 0;\n\n  private shadowState_: blocks.State|null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: Block, public type: number) {\n    this.sourceBlock_ = source;\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected connect_(childConnection: Connection) {\n    const INPUT = ConnectionType.INPUT_VALUE;\n    const parentBlock = this.getSourceBlock();\n    const childBlock = childConnection.getSourceBlock();\n\n    // Make sure the childConnection is available.\n    if (childConnection.isConnected()) {\n      childConnection.disconnectInternal(false);\n    }\n\n    // Make sure the parentConnection is available.\n    let orphan;\n    if (this.isConnected()) {\n      const shadowState = this.stashShadowState_();\n      const target = this.targetBlock();\n      if (target!.isShadow()) {\n        target!.dispose(false);\n      } else {\n        this.disconnectInternal();\n        orphan = target;\n      }\n      this.applyShadowState_(shadowState);\n    }\n\n    // Connect the new connection to the parent.\n    let event;\n    if (eventUtils.isEnabled()) {\n      event =\n          new (eventUtils.get(eventUtils.BLOCK_MOVE))(childBlock) as BlockMove;\n    }\n    connectReciprocally(this, childConnection);\n    childBlock.setParent(parentBlock);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    // Deal with the orphan if it exists.\n    if (orphan) {\n      const orphanConnection = this.type === INPUT ? orphan.outputConnection :\n                                                     orphan.previousConnection;\n      if (!orphanConnection) return;\n      const connection = Connection.getConnectionForOrphanedConnection(\n          childBlock, orphanConnection);\n      if (connection) {\n        orphanConnection.connect(connection);\n      } else {\n        orphanConnection.onFailedConnect(this);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this connection and deal with connected blocks.\n   *\n   * @internal\n   */\n  dispose() {\n    // isConnected returns true for shadows and non-shadows.\n    if (this.isConnected()) {\n      // Destroy the attached shadow block & its children (if it exists).\n      this.setShadowStateInternal_();\n\n      const targetBlock = this.targetBlock();\n      if (targetBlock && !targetBlock.isDeadOrDying()) {\n        // Disconnect the attached normal block.\n        targetBlock.unplug();\n      }\n    }\n\n    this.disposed = true;\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Does the connection belong to a superior block (higher in the source\n   * stack)?\n   *\n   * @returns True if connection faces down or right.\n   */\n  isSuperior(): boolean {\n    return this.type === ConnectionType.INPUT_VALUE ||\n        this.type === ConnectionType.NEXT_STATEMENT;\n  }\n\n  /**\n   * Is the connection connected?\n   *\n   * @returns True if connection is connected to another connection.\n   */\n  isConnected(): boolean {\n    return !!this.targetConnection;\n  }\n\n  /**\n   * Get the workspace's connection type checker object.\n   *\n   * @returns The connection type checker for the source block's workspace.\n   * @internal\n   */\n  getConnectionChecker(): IConnectionChecker {\n    return this.sourceBlock_.workspace.connectionChecker;\n  }\n\n  /**\n   * Called when an attempted connection fails. NOP by default (i.e. for\n   * headless workspaces).\n   *\n   * @param _otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  onFailedConnect(_otherConnection: Connection) {}\n  // NOP\n\n  /**\n   * Connect this connection to another connection.\n   *\n   * @param otherConnection Connection to connect to.\n   * @returns Whether the the blocks are now connected or not.\n   */\n  connect(otherConnection: Connection): boolean {\n    if (this.targetConnection === otherConnection) {\n      // Already connected together.  NOP.\n      return true;\n    }\n\n    const checker = this.getConnectionChecker();\n    if (checker.canConnect(this, otherConnection, false)) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      // Determine which block is superior (higher in the source stack).\n      if (this.isSuperior()) {\n        // Superior block.\n        this.connect_(otherConnection);\n      } else {\n        // Inferior block.\n        otherConnection.connect_(this);\n      }\n      eventUtils.setGroup(existingGroup);\n    }\n\n    return this.isConnected();\n  }\n\n  /**\n   * Disconnect this connection.\n   */\n  disconnect() {\n    this.disconnectInternal();\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  protected disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n        this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) {\n      throw Error('Source connection not connected.');\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n\n    let event;\n    if (eventUtils.isEnabled()) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n                  childConnection.getSourceBlock()) as BlockMove;\n    }\n    const otherConnection = this.targetConnection;\n    if (otherConnection) {\n      otherConnection.targetConnection = null;\n    }\n    this.targetConnection = null;\n    if (setParent) childConnection.getSourceBlock().setParent(null);\n    if (event) {\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n\n    if (!childConnection.getSourceBlock().isShadow()) {\n      // If we were disconnecting a shadow, no need to spawn a new one.\n      parentConnection.respawnShadow_();\n    }\n\n    eventUtils.setGroup(existingGroup);\n  }\n\n  /**\n   * Returns the parent connection (superior) and child connection (inferior)\n   * given this connection and the connection it is connected to.\n   *\n   * @returns The parent connection and child connection, given this connection\n   *     and the connection it is connected to.\n   */\n  protected getParentAndChildConnections():\n      {parentConnection?: Connection, childConnection?: Connection} {\n    if (!this.targetConnection) return {};\n    if (this.isSuperior()) {\n      return {\n        parentConnection: this,\n        childConnection: this.targetConnection,\n      };\n    }\n    return {\n      parentConnection: this.targetConnection,\n      childConnection: this,\n    };\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   */\n  protected respawnShadow_() {\n    // Have to keep respawnShadow_ for backwards compatibility.\n    this.createShadowBlock_(true);\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  targetBlock(): Block|null {\n    if (this.isConnected()) {\n      return this.targetConnection?.getSourceBlock() ?? null;\n    }\n    return null;\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (this.isConnected() &&\n        (!this.targetConnection ||\n         !this.getConnectionChecker().canConnect(\n             this, this.targetConnection, false))) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types. Null if all\n   *     types are compatible.\n   * @returns The connection being modified (to allow chaining).\n   */\n  setCheck(check: string|string[]|null): Connection {\n    if (check) {\n      if (!Array.isArray(check)) {\n        check = [check];\n      }\n      this.check_ = check;\n      this.onCheckChanged_();\n    } else {\n      this.check_ = null;\n    }\n    return this;\n  }\n\n  /**\n   * Get a connection's compatibility.\n   *\n   * @returns List of compatible value types.\n   *     Null if all types are compatible.\n   */\n  getCheck(): string[]|null {\n    return this.check_;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowDom DOM representation of a block or null.\n   */\n  setShadowDom(shadowDom: Element|null) {\n    this.setShadowStateInternal_({shadowDom});\n  }\n\n  /**\n   * Returns the xml representation of the connection's shadow block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved shadowDom is\n   *     just returned.\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(returnCurrent?: boolean): Element|null {\n    return returnCurrent && this.targetBlock()!.isShadow() ?\n        Xml.blockToDom((this.targetBlock() as Block)) as Element :\n        this.shadowDom_;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadowState An state represetation of the block or null.\n   */\n  setShadowState(shadowState: blocks.State|null) {\n    this.setShadowStateInternal_({shadowState});\n  }\n\n  /**\n   * Returns the serialized object representation of the connection's shadow\n   * block.\n   *\n   * @param returnCurrent If true, and the shadow block is currently attached to\n   *     this connection, this serializes the state of that block and returns it\n   *     (so that field values are correct). Otherwise the saved state is just\n   *     returned.\n   * @returns Serialized object representation of the block, or null.\n   */\n  getShadowState(returnCurrent?: boolean): blocks.State|null {\n    if (returnCurrent && this.targetBlock() && this.targetBlock()!.isShadow()) {\n      return blocks.save(this.targetBlock() as Block);\n    }\n    return this.shadowState_;\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * Headless configurations (the default) do not have neighboring connection,\n   * and always return an empty list (the default).\n   * {@link RenderedConnection#neighbours} overrides this behavior with a list\n   * computed from the rendered positioning.\n   *\n   * @param _maxLimit The maximum radius to another connection.\n   * @returns List of connections.\n   * @internal\n   */\n  neighbours(_maxLimit: number): Connection[] {\n    return [];\n  }\n\n  /**\n   * Get the parent input of a connection.\n   *\n   * @returns The input that the connection belongs to or null if no parent\n   *     exists.\n   * @internal\n   */\n  getParentInput(): Input|null {\n    let parentInput = null;\n    const inputs = this.sourceBlock_.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      if (inputs[i].connection === this) {\n        parentInput = inputs[i];\n        break;\n      }\n    }\n    return parentInput;\n  }\n\n  /**\n   * This method returns a string describing this Connection in developer terms\n   * (English only). Intended to on be used in console logs and errors.\n   *\n   * @returns The description.\n   */\n  toString(): string {\n    const block = this.sourceBlock_;\n    if (!block) {\n      return 'Orphan Connection';\n    }\n    let msg;\n    if (block.outputConnection === this) {\n      msg = 'Output Connection of ';\n    } else if (block.previousConnection === this) {\n      msg = 'Previous Connection of ';\n    } else if (block.nextConnection === this) {\n      msg = 'Next Connection of ';\n    } else {\n      let parentInput = null;\n      for (let i = 0, input; input = block.inputList[i]; i++) {\n        if (input.connection === this) {\n          parentInput = input;\n          break;\n        }\n      }\n      if (parentInput) {\n        msg = 'Input \"' + parentInput.name + '\" connection on ';\n      } else {\n        console.warn('Connection not actually connected to sourceBlock_');\n        return 'Orphan Connection';\n      }\n    }\n    return msg + block.toDevString();\n  }\n\n  /**\n   * Returns the state of the shadowDom_ and shadowState_ properties, then\n   * temporarily sets those properties to null so no shadow respawns.\n   *\n   * @returns The state of both the shadowDom_ and shadowState_ properties.\n   */\n  private stashShadowState_():\n      {shadowDom: Element|null, shadowState: blocks.State|null} {\n    const shadowDom = this.getShadowDom(true);\n    const shadowState = this.getShadowState(true);\n    // Set to null so it doesn't respawn.\n    this.shadowDom_ = null;\n    this.shadowState_ = null;\n    return {shadowDom, shadowState};\n  }\n\n  /**\n   * Reapplies the stashed state of the shadowDom_ and shadowState_ properties.\n   *\n   * @param param0 The state to reapply to the shadowDom_ and shadowState_\n   *     properties.\n   */\n  private applyShadowState_({shadowDom, shadowState}: {\n    shadowDom: Element|null,\n    shadowState: blocks.State|null\n  }) {\n    this.shadowDom_ = shadowDom;\n    this.shadowState_ = shadowState;\n  }\n\n  /**\n   * Sets the state of the shadow of this connection.\n   *\n   * @param param0 The state to set the shadow of this connection to.\n   */\n  private setShadowStateInternal_({shadowDom = null, shadowState = null}: {\n    shadowDom?: Element|null,\n    shadowState?: blocks.State|null\n  } = {}) {\n    // One or both of these should always be null.\n    // If neither is null, the shadowState will get priority.\n    this.shadowDom_ = shadowDom;\n    this.shadowState_ = shadowState;\n\n    const target = this.targetBlock();\n    if (!target) {\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow_(this.targetBlock());\n      }\n    } else if (target.isShadow()) {\n      target.dispose(false);\n      if (this.getSourceBlock().isDeadOrDying()) return;\n      this.respawnShadow_();\n      if (this.targetBlock() && this.targetBlock()!.isShadow()) {\n        this.serializeShadow_(this.targetBlock());\n      }\n    } else {\n      const shadow = this.createShadowBlock_(false);\n      this.serializeShadow_(shadow);\n      if (shadow) {\n        shadow.dispose(false);\n      }\n    }\n  }\n\n  /**\n   * Creates a shadow block based on the current shadowState_ or shadowDom_.\n   * shadowState_ gets priority.\n   *\n   * @param attemptToConnect Whether to try to connect the shadow block to this\n   *     connection or not.\n   * @returns The shadow block that was created, or null if both the\n   *     shadowState_ and shadowDom_ are null.\n   */\n  private createShadowBlock_(attemptToConnect: boolean): Block|null {\n    const parentBlock = this.getSourceBlock();\n    const shadowState = this.getShadowState();\n    const shadowDom = this.getShadowDom();\n    if (parentBlock.isDeadOrDying() || !shadowState && !shadowDom) {\n      return null;\n    }\n\n    let blockShadow;\n    if (shadowState) {\n      blockShadow = blocks.appendInternal(shadowState, parentBlock.workspace, {\n        parentConnection: attemptToConnect ? this : undefined,\n        isShadow: true,\n        recordUndo: false,\n      });\n      return blockShadow;\n    }\n\n    if (shadowDom) {\n      blockShadow = Xml.domToBlock(shadowDom, parentBlock.workspace);\n      if (attemptToConnect) {\n        if (this.type === ConnectionType.INPUT_VALUE) {\n          if (!blockShadow.outputConnection) {\n            throw new Error('Shadow block is missing an output connection');\n          }\n          if (!this.connect(blockShadow.outputConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else if (this.type === ConnectionType.NEXT_STATEMENT) {\n          if (!blockShadow.previousConnection) {\n            throw new Error('Shadow block is missing previous connection');\n          }\n          if (!this.connect(blockShadow.previousConnection)) {\n            throw new Error('Could not connect shadow block to connection');\n          }\n        } else {\n          throw new Error(\n              'Cannot connect a shadow block to a previous/output connection');\n        }\n      }\n      return blockShadow;\n    }\n    return null;\n  }\n\n  /**\n   * Saves the given shadow block to both the shadowDom_ and shadowState_\n   * properties, in their respective serialized forms.\n   *\n   * @param shadow The shadow to serialize, or null.\n   */\n  private serializeShadow_(shadow: Block|null) {\n    if (!shadow) {\n      return;\n    }\n    this.shadowDom_ = Xml.blockToDom(shadow) as Element;\n    this.shadowState_ = blocks.save(shadow);\n  }\n\n  /**\n   * Returns the connection (starting at the startBlock) which will accept\n   * the given connection. This includes compatible connection types and\n   * connection checks.\n   *\n   * @param startBlock The block on which to start the search.\n   * @param orphanConnection The connection that is looking for a home.\n   * @returns The suitable connection point on the chain of blocks, or null.\n   */\n  static getConnectionForOrphanedConnection(\n      startBlock: Block, orphanConnection: Connection): Connection|null {\n    if (orphanConnection.type === ConnectionType.OUTPUT_VALUE) {\n      return getConnectionForOrphanedOutput(\n          startBlock, orphanConnection.getSourceBlock());\n    }\n    // Otherwise we're dealing with a stack.\n    const connection = startBlock.lastConnectionInStack(true);\n    const checker = orphanConnection.getConnectionChecker();\n    if (connection && checker.canConnect(orphanConnection, connection, false)) {\n      return connection;\n    }\n    return null;\n  }\n}\n\n/**\n * Update two connections to target each other.\n *\n * @param first The first connection to update.\n * @param second The second connection to update.\n */\nfunction connectReciprocally(first: Connection, second: Connection) {\n  if (!first || !second) {\n    throw Error('Cannot connect null connections.');\n  }\n  first.targetConnection = second;\n  second.targetConnection = first;\n}\n/**\n * Returns the single connection on the block that will accept the orphaned\n * block, if one can be found. If the block has multiple compatible connections\n * (even if they are filled) this returns null. If the block has no compatible\n * connections, this returns null.\n *\n * @param block The superior block.\n * @param orphanBlock The inferior block.\n * @returns The suitable connection point on 'block', or null.\n */\nfunction getSingleConnection(block: Block, orphanBlock: Block): Connection|\n    null {\n  let foundConnection = null;\n  const output = orphanBlock.outputConnection;\n  const typeChecker = output?.getConnectionChecker();\n\n  for (let i = 0, input; input = block.inputList[i]; i++) {\n    const connection = input.connection;\n    if (connection && typeChecker?.canConnect(output, connection, false)) {\n      if (foundConnection) {\n        return null;  // More than one connection.\n      }\n      foundConnection = connection;\n    }\n  }\n  return foundConnection;\n}\n\n/**\n * Walks down a row a blocks, at each stage checking if there are any\n * connections that will accept the orphaned block.  If at any point there\n * are zero or multiple eligible connections, returns null.  Otherwise\n * returns the only input on the last block in the chain.\n * Terminates early for shadow blocks.\n *\n * @param startBlock The block on which to start the search.\n * @param orphanBlock The block that is looking for a home.\n * @returns The suitable connection point on the chain of blocks, or null.\n */\nfunction getConnectionForOrphanedOutput(\n    startBlock: Block, orphanBlock: Block): Connection|null {\n  let newBlock: Block|null = startBlock;\n  let connection;\n  while (connection = getSingleConnection(newBlock, orphanBlock)) {\n    newBlock = connection.targetBlock();\n    if (!newBlock || newBlock.isShadow()) {\n      return connection;\n    }\n  }\n  return null;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.math');\n\n\n/**\n * Converts degrees to radians.\n * Copied from Closure's goog.math.toRadians.\n *\n * @param angleDegrees Angle in degrees.\n * @returns Angle in radians.\n */\nexport function toRadians(angleDegrees: number): number {\n  return angleDegrees * Math.PI / 180;\n}\n\n/**\n * Converts radians to degrees.\n * Copied from Closure's goog.math.toDegrees.\n *\n * @param angleRadians Angle in radians.\n * @returns Angle in degrees.\n */\nexport function toDegrees(angleRadians: number): number {\n  return angleRadians * 180 / Math.PI;\n}\n\n/**\n * Clamp the provided number between the lower bound and the upper bound.\n *\n * @param lowerBound The desired lower bound.\n * @param number The number to clamp.\n * @param upperBound The desired upper bound.\n * @returns The clamped number.\n */\nexport function clamp(\n    lowerBound: number, number: number, upperBound: number): number {\n  if (upperBound < lowerBound) {\n    const temp = upperBound;\n    upperBound = lowerBound;\n    lowerBound = temp;\n  }\n  return Math.max(lowerBound, Math.min(number, upperBound));\n}\n", "/**\n * @license\n * Copyright 2016 Massachusetts Institute of Technology\n * All rights reserved.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A div that floats on top of the workspace, for drop-down menus.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.dropDownDiv');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Field} from './field.js';\nimport * as math from './utils/math.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Arrow size in px. Should match the value in CSS\n * (need to position pre-render).\n */\nexport const ARROW_SIZE = 16;\n\n/**\n * Drop-down border size in px. Should match the value in CSS (need to position\n * the arrow).\n */\nexport const BORDER_SIZE = 1;\n\n/**\n * Amount the arrow must be kept away from the edges of the main drop-down div,\n * in px.\n */\nexport const ARROW_HORIZONTAL_PADDING = 12;\n\n/** Amount drop-downs should be padded away from the source, in px. */\nexport const PADDING_Y = 16;\n\n/** Length of animations in seconds. */\nexport const ANIMATION_TIME = 0.25;\n\n/**\n * Timer for animation out, to be cleared if we need to immediately hide\n * without disrupting new shows.\n */\nlet animateOutTimer: ReturnType<typeof setTimeout>|null = null;\n\n/** Callback for when the drop-down is hidden. */\nlet onHide: Function|null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet renderedClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The content element. */\nlet div: HTMLDivElement;\n\n/** The content element. */\nlet content: HTMLDivElement;\n\n/** The arrow element. */\nlet arrow: HTMLDivElement;\n\n/**\n * Drop-downs will appear within the bounds of this element if possible.\n * Set in setBoundsElement.\n */\nlet boundsElement: Element|null = null;\n\n/** The object currently using the drop-down. */\nlet owner: Field|null = null;\n\n/** Whether the dropdown was positioned to a field or the source block. */\nlet positionToField: boolean|null = null;\n\n/**\n * Dropdown bounds info object used to encapsulate sizing information about a\n * bounding element (bounding box and width/height).\n */\nexport interface BoundsInfo {\n  top: number;\n  left: number;\n  bottom: number;\n  right: number;\n  width: number;\n  height: number;\n}\n\n/** Dropdown position metrics. */\nexport interface PositionMetrics {\n  initialX: number;\n  initialY: number;\n  finalX: number;\n  finalY: number;\n  arrowX: number|null;\n  arrowY: number|null;\n  arrowAtTop: boolean|null;\n  arrowVisible: boolean;\n}\n\n/**\n * Create and insert the DOM element for this div.\n *\n * @internal\n */\nexport function createDom() {\n  if (div) {\n    return;  // Already created.\n  }\n  div = document.createElement('div');\n  div.className = 'blocklyDropDownDiv';\n  const parentDiv = common.getParentContainer() || document.body;\n  parentDiv.appendChild(div);\n\n  content = document.createElement('div');\n  content.className = 'blocklyDropDownContent';\n  div.appendChild(content);\n\n  arrow = document.createElement('div');\n  arrow.className = 'blocklyDropDownArrow';\n  div.appendChild(arrow);\n\n  div.style.opacity = '0';\n  // Transition animation for transform: translate() and opacity.\n  div.style.transition = 'transform ' + ANIMATION_TIME + 's, ' +\n      'opacity ' + ANIMATION_TIME + 's';\n\n  // Handle focusin/out events to add a visual indicator when\n  // a child is focused or blurred.\n  div.addEventListener('focusin', function() {\n    dom.addClass(div, 'blocklyFocused');\n  });\n  div.addEventListener('focusout', function() {\n    dom.removeClass(div, 'blocklyFocused');\n  });\n}\n\n/**\n * Set an element to maintain bounds within. Drop-downs will appear\n * within the box of this element if possible.\n *\n * @param boundsElem Element to bind drop-down to.\n */\nexport function setBoundsElement(boundsElem: Element|null) {\n  boundsElement = boundsElem;\n}\n\n/**\n * @returns The field that currently owns this, or null.\n */\nexport function getOwner(): Field|null {\n  return owner;\n}\n\n/**\n * Provide the div for inserting content into the drop-down.\n *\n * @returns Div to populate with content.\n */\nexport function getContentDiv(): Element {\n  return content;\n}\n\n/** Clear the content of the drop-down. */\nexport function clearContent() {\n  content.textContent = '';\n  content.style.width = '';\n}\n\n/**\n * Set the colour for the drop-down.\n *\n * @param backgroundColour Any CSS colour for the background.\n * @param borderColour Any CSS colour for the border.\n */\nexport function setColour(backgroundColour: string, borderColour: string) {\n  div.style.backgroundColor = backgroundColour;\n  div.style.borderColor = borderColour;\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular block. The primary position will be below the block,\n * and the secondary position above the block. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field showing the drop-down.\n * @param block Block to position the drop-down around.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByBlock<T>(\n    field: Field<T>, block: BlockSvg, opt_onHide?: Function,\n    opt_secondaryYOffset?: number): boolean {\n  return showPositionedByRect(\n      getScaledBboxOfBlock(block), field as Field, opt_onHide,\n      opt_secondaryYOffset);\n}\n\n/**\n * Shortcut to show and place the drop-down with positioning determined\n * by a particular field. The primary position will be below the field,\n * and the secondary position above the field. Drop-down will be\n * constrained to the block's workspace.\n *\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nexport function showPositionedByField<T>(\n    field: Field<T>, opt_onHide?: Function,\n    opt_secondaryYOffset?: number): boolean {\n  positionToField = true;\n  return showPositionedByRect(\n      getScaledBboxOfField(field as Field), field as Field, opt_onHide,\n      opt_secondaryYOffset);\n}\n/**\n * Get the scaled bounding box of a block.\n *\n * @param block The block.\n * @returns The scaled bounding box of the block.\n */\nfunction getScaledBboxOfBlock(block: BlockSvg): Rect {\n  const blockSvg = block.getSvgRoot();\n  const scale = block.workspace.scale;\n  const scaledHeight = block.height * scale;\n  const scaledWidth = block.width * scale;\n  const xy = style.getPageOffset(blockSvg);\n  return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n}\n\n/**\n * Get the scaled bounding box of a field.\n *\n * @param field The field.\n * @returns The scaled bounding box of the field.\n */\nfunction getScaledBboxOfField(field: Field): Rect {\n  const bBox = field.getScaledBBox();\n  return new Rect(bBox.top, bBox.bottom, bBox.left, bBox.right);\n}\n\n/**\n * Helper method to show and place the drop-down with positioning determined\n * by a scaled bounding box.  The primary position will be below the rect,\n * and the secondary position above the rect. Drop-down will be constrained to\n * the block's workspace.\n *\n * @param bBox The scaled bounding box.\n * @param field The field to position the dropdown against.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @param opt_secondaryYOffset Optional Y offset for above-block positioning.\n * @returns True if the menu rendered below block; false if above.\n */\nfunction showPositionedByRect(\n    bBox: Rect, field: Field, opt_onHide?: Function,\n    opt_secondaryYOffset?: number): boolean {\n  // If we can fit it, render below the block.\n  const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n  const primaryY = bBox.bottom;\n  // If we can't fit it, render above the entire parent block.\n  const secondaryX = primaryX;\n  let secondaryY = bBox.top;\n  if (opt_secondaryYOffset) {\n    secondaryY += opt_secondaryYOffset;\n  }\n  const sourceBlock = field.getSourceBlock() as BlockSvg;\n  // Set bounds to main workspace; show the drop-down.\n  let workspace = sourceBlock.workspace;\n  while (workspace.options.parentWorkspace) {\n    workspace = workspace.options.parentWorkspace;\n  }\n  setBoundsElement(workspace.getParentSvg().parentNode as Element | null);\n  return show(\n      field, sourceBlock.RTL, primaryX, primaryY, secondaryX, secondaryY,\n      opt_onHide);\n}\n\n/**\n * Show and place the drop-down.\n * The drop-down is placed with an absolute \"origin point\" (x, y) - i.e.,\n * the arrow will point at this origin and box will positioned below or above\n * it.  If we can maintain the container bounds at the primary point, the arrow\n * will point there, and the container will be positioned below it.\n * If we can't maintain the container bounds at the primary point, fall-back to\n * the secondary point and position above.\n *\n * @param newOwner The object showing the drop-down\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param opt_onHide Optional callback for when the drop-down is hidden.\n * @returns True if the menu rendered at the primary origin point.\n * @internal\n */\nexport function show<T>(\n    newOwner: Field<T>, rtl: boolean, primaryX: number, primaryY: number,\n    secondaryX: number, secondaryY: number, opt_onHide?: Function): boolean {\n  owner = newOwner as Field;\n  onHide = opt_onHide || null;\n  // Set direction.\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  renderedClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (renderedClassName) {\n    dom.addClass(div, renderedClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n\n  // When we change `translate` multiple times in close succession,\n  // Chrome may choose to wait and apply them all at once.\n  // Since we want the translation to initial X, Y to be immediate,\n  // and the translation to final X, Y to be animated,\n  // we saw problems where both would be applied after animation was turned on,\n  // making the dropdown appear to fly in from (0, 0).\n  // Using both `left`, `top` for the initial translation and then `translate`\n  // for the animated transition to final X, Y is a workaround.\n  return positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n}\n\nconst internal = {\n  /**\n   * Get sizing info about the bounding element.\n   *\n   * @returns An object containing size information about the bounding element\n   *     (bounding box and width/height).\n   */\n  getBoundsInfo: function(): BoundsInfo {\n    const boundPosition = style.getPageOffset(boundsElement as Element);\n    const boundSize = style.getSize(boundsElement as Element);\n\n    return {\n      left: boundPosition.x,\n      right: boundPosition.x + boundSize.width,\n      top: boundPosition.y,\n      bottom: boundPosition.y + boundSize.height,\n      width: boundSize.width,\n      height: boundSize.height,\n    };\n  },\n\n  /**\n   * Helper to position the drop-down and the arrow, maintaining bounds.\n   * See explanation of origin points in show.\n   *\n   * @param primaryX Desired origin point x, in absolute px.\n   * @param primaryY Desired origin point y, in absolute px.\n   * @param secondaryX Secondary/alternative origin point x, in absolute px.\n   * @param secondaryY Secondary/alternative origin point y, in absolute px.\n   * @returns Various final metrics, including rendered positions for drop-down\n   *     and arrow.\n   */\n  getPositionMetrics: function(\n      primaryX: number, primaryY: number, secondaryX: number,\n      secondaryY: number): PositionMetrics {\n    const boundsInfo = internal.getBoundsInfo();\n    const divSize = style.getSize(div as Element);\n\n    // Can we fit in-bounds below the target?\n    if (primaryY + divSize.height < boundsInfo.bottom) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit in-bounds above the target?\n    if (secondaryY - divSize.height > boundsInfo.top) {\n      return getPositionAboveMetrics(\n          secondaryX, secondaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // below?\n    if (primaryY + divSize.height < document.documentElement.clientHeight) {\n      return getPositionBelowMetrics(primaryX, primaryY, boundsInfo, divSize);\n    }\n    // Can we fit outside the workspace bounds (but inside the window)\n    // above?\n    if (secondaryY - divSize.height > document.documentElement.clientTop) {\n      return getPositionAboveMetrics(\n          secondaryX, secondaryY, boundsInfo, divSize);\n    }\n\n    // Last resort, render at top of page.\n    return getPositionTopOfPageMetrics(primaryX, boundsInfo, divSize);\n  },\n};\n\n/**\n * Get the metrics for positioning the div below the source.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionBelowMetrics(\n    primaryX: number, primaryY: number, boundsInfo: BoundsInfo,\n    divSize: Size): PositionMetrics {\n  const xCoords =\n      getPositionX(primaryX, boundsInfo.left, boundsInfo.right, divSize.width);\n\n  const arrowY = -(ARROW_SIZE / 2 + BORDER_SIZE);\n  const finalY = primaryY + PADDING_Y;\n\n  return {\n    initialX: xCoords.divX,\n    initialY: primaryY,\n    finalX: xCoords.divX,  // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: true,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div above the source.\n *\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionAboveMetrics(\n    secondaryX: number, secondaryY: number, boundsInfo: BoundsInfo,\n    divSize: Size): PositionMetrics {\n  const xCoords = getPositionX(\n      secondaryX, boundsInfo.left, boundsInfo.right, divSize.width);\n\n  const arrowY = divSize.height - BORDER_SIZE * 2 - ARROW_SIZE / 2;\n  const finalY = secondaryY - divSize.height - PADDING_Y;\n  const initialY = secondaryY - divSize.height;  // No padding on Y.\n\n  return {\n    initialX: xCoords.divX,\n    initialY,\n    finalX: xCoords.divX,  // X position remains constant during animation.\n    finalY,\n    arrowX: xCoords.arrowX,\n    arrowY,\n    arrowAtTop: false,\n    arrowVisible: true,\n  };\n}\n\n/**\n * Get the metrics for positioning the div at the top of the page.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsInfo An object containing size information about the bounding\n *     element (bounding box and width/height).\n * @param divSize An object containing information about the size of the\n *     DropDownDiv (width & height).\n * @returns Various final metrics, including rendered positions for drop-down\n *     and arrow.\n */\nfunction getPositionTopOfPageMetrics(\n    sourceX: number, boundsInfo: BoundsInfo, divSize: Size): PositionMetrics {\n  const xCoords =\n      getPositionX(sourceX, boundsInfo.left, boundsInfo.right, divSize.width);\n\n  // No need to provide arrow-specific information because it won't be visible.\n  return {\n    initialX: xCoords.divX,\n    initialY: 0,\n    finalX: xCoords.divX,  // X position remains constant during animation.\n    finalY: 0,             // Y position remains constant during animation.\n    arrowAtTop: null,\n    arrowX: null,\n    arrowY: null,\n    arrowVisible: false,\n  };\n}\n\n/**\n * Get the x positions for the left side of the DropDownDiv and the arrow,\n * accounting for the bounds of the workspace.\n *\n * @param sourceX Desired origin point x, in absolute px.\n * @param boundsLeft The left edge of the bounding element, in absolute px.\n * @param boundsRight The right edge of the bounding element, in absolute px.\n * @param divWidth The width of the div in px.\n * @returns An object containing metrics for the x positions of the left side of\n *     the DropDownDiv and the arrow.\n * @internal\n */\nexport function getPositionX(\n    sourceX: number, boundsLeft: number, boundsRight: number,\n    divWidth: number): {divX: number, arrowX: number} {\n  let divX = sourceX;\n  // Offset the topLeft coord so that the dropdowndiv is centered.\n  divX -= divWidth / 2;\n  // Fit the dropdowndiv within the bounds of the workspace.\n  divX = math.clamp(boundsLeft, divX, boundsRight - divWidth);\n\n  let arrowX = sourceX;\n  // Offset the arrow coord so that the arrow is centered.\n  arrowX -= ARROW_SIZE / 2;\n  // Convert the arrow position to be relative to the top left of the div.\n  let relativeArrowX = arrowX - divX;\n  const horizPadding = ARROW_HORIZONTAL_PADDING;\n  // Clamp the arrow position so that it stays attached to the dropdowndiv.\n  relativeArrowX = math.clamp(\n      horizPadding, relativeArrowX, divWidth - horizPadding - ARROW_SIZE);\n\n  return {arrowX: relativeArrowX, divX};\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Hide the menu only if it is owned by the provided object.\n *\n * @param divOwner Object which must be owning the drop-down to hide.\n * @param opt_withoutAnimation True if we should hide the dropdown without\n *     animating.\n * @returns True if hidden.\n */\nexport function hideIfOwner<T>(\n    divOwner: Field<T>, opt_withoutAnimation?: boolean): boolean {\n  if (owner === divOwner) {\n    if (opt_withoutAnimation) {\n      hideWithoutAnimation();\n    } else {\n      hide();\n    }\n    return true;\n  }\n  return false;\n}\n\n/** Hide the menu, triggering animation. */\nexport function hide() {\n  // Start the animation by setting the translation and fading out.\n  // Reset to (initialX, initialY) - i.e., no translation.\n  div.style.transform = 'translate(0, 0)';\n  div.style.opacity = '0';\n  // Finish animation - reset all values to default.\n  animateOutTimer = setTimeout(function() {\n    hideWithoutAnimation();\n  }, ANIMATION_TIME * 1000);\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n}\n\n/** Hide the menu, without animation. */\nexport function hideWithoutAnimation() {\n  if (!isVisible()) {\n    return;\n  }\n  if (animateOutTimer) {\n    clearTimeout(animateOutTimer);\n  }\n\n  // Reset style properties in case this gets called directly\n  // instead of hide() - see discussion on #2551.\n  div.style.transform = '';\n  div.style.left = '';\n  div.style.top = '';\n  div.style.opacity = '0';\n  div.style.display = 'none';\n  div.style.backgroundColor = '';\n  div.style.borderColor = '';\n\n  if (onHide) {\n    onHide();\n    onHide = null;\n  }\n  clearContent();\n  owner = null;\n\n  if (renderedClassName) {\n    dom.removeClass(div, renderedClassName);\n    renderedClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Set the dropdown div's position.\n *\n * @param primaryX Desired origin point x, in absolute px.\n * @param primaryY Desired origin point y, in absolute px.\n * @param secondaryX Secondary/alternative origin point x, in absolute px.\n * @param secondaryY Secondary/alternative origin point y, in absolute px.\n * @returns True if the menu rendered at the primary origin point.\n */\nfunction positionInternal(\n    primaryX: number, primaryY: number, secondaryX: number,\n    secondaryY: number): boolean {\n  const metrics =\n      internal.getPositionMetrics(primaryX, primaryY, secondaryX, secondaryY);\n\n  // Update arrow CSS.\n  if (metrics.arrowVisible) {\n    arrow.style.display = '';\n    arrow.style.transform = 'translate(' + metrics.arrowX + 'px,' +\n        metrics.arrowY + 'px) rotate(45deg)';\n    arrow.setAttribute(\n        'class',\n        metrics.arrowAtTop ? 'blocklyDropDownArrow blocklyArrowTop' :\n                             'blocklyDropDownArrow blocklyArrowBottom');\n  } else {\n    arrow.style.display = 'none';\n  }\n\n  const initialX = Math.floor(metrics.initialX);\n  const initialY = Math.floor(metrics.initialY);\n  const finalX = Math.floor(metrics.finalX);\n  const finalY = Math.floor(metrics.finalY);\n\n  // First apply initial translation.\n  div.style.left = initialX + 'px';\n  div.style.top = initialY + 'px';\n\n  // Show the div.\n  div.style.display = 'block';\n  div.style.opacity = '1';\n  // Add final translate, animated through `transition`.\n  // Coordinates are relative to (initialX, initialY),\n  // where the drop-down is absolutely positioned.\n  const dx = finalX - initialX;\n  const dy = finalY - initialY;\n  div.style.transform = 'translate(' + dx + 'px,' + dy + 'px)';\n\n  return !!metrics.arrowAtTop;\n}\n\n/**\n * Repositions the dropdownDiv on window resize. If it doesn't know how to\n * calculate the new position, it will just hide it instead.\n *\n * @internal\n */\nexport function repositionForWindowResize() {\n  // This condition mainly catches the dropdown div when it is being used as a\n  // dropdown.  It is important not to close it in this case because on Android,\n  // when a field is focused, the soft keyboard opens triggering a window resize\n  // event and we want the dropdown div to stick around so users can type into\n  // it.\n  if (owner) {\n    const block = owner.getSourceBlock() as BlockSvg;\n    const bBox = positionToField ? getScaledBboxOfField(owner) :\n                                   getScaledBboxOfBlock(block);\n    // If we can fit it, render below the block.\n    const primaryX = bBox.left + (bBox.right - bBox.left) / 2;\n    const primaryY = bBox.bottom;\n    // If we can't fit it, render above the entire parent block.\n    const secondaryX = primaryX;\n    const secondaryY = bBox.top;\n    positionInternal(primaryX, primaryY, secondaryX, secondaryY);\n  } else {\n    hide();\n  }\n}\n\nexport const TEST_ONLY = internal;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.string');\n\nimport * as deprecation from './deprecation.js';\n\n\n/**\n * Fast prefix-checker.\n * Copied from Closure's goog.string.startsWith.\n *\n * @param str The string to check.\n * @param prefix A string to look for at the start of `str`.\n * @returns True if `str` begins with `prefix`.\n * @deprecated Use built-in **string.startsWith** instead.\n */\nexport function startsWith(str: string, prefix: string): boolean {\n  deprecation.warn(\n      'Blockly.utils.string.startsWith()', 'April 2022', 'April 2023',\n      'Use built-in string.startsWith');\n  return str.startsWith(prefix);\n}\n\n/**\n * Given an array of strings, return the length of the shortest one.\n *\n * @param array Array of strings.\n * @returns Length of shortest string.\n */\nexport function shortestStringLength(array: string[]): number {\n  if (!array.length) {\n    return 0;\n  }\n  return array\n      .reduce(function(a, b) {\n        return a.length < b.length ? a : b;\n      })\n      .length;\n}\n\n/**\n * Given an array of strings, return the length of the common prefix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common prefix.\n */\nexport function commonWordPrefix(\n    array: string[], opt_shortest?: number): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0][len];\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i][len]) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i][len];\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Given an array of strings, return the length of the common suffix.\n * Words may not be split.  Any space after a word is included in the length.\n *\n * @param array Array of strings.\n * @param opt_shortest Length of shortest string.\n * @returns Length of common suffix.\n */\nexport function commonWordSuffix(\n    array: string[], opt_shortest?: number): number {\n  if (!array.length) {\n    return 0;\n  } else if (array.length === 1) {\n    return array[0].length;\n  }\n  let wordPrefix = 0;\n  const max = opt_shortest || shortestStringLength(array);\n  let len;\n  for (len = 0; len < max; len++) {\n    const letter = array[0].substr(-len - 1, 1);\n    for (let i = 1; i < array.length; i++) {\n      if (letter !== array[i].substr(-len - 1, 1)) {\n        return wordPrefix;\n      }\n    }\n    if (letter === ' ') {\n      wordPrefix = len + 1;\n    }\n  }\n  for (let i = 1; i < array.length; i++) {\n    const letter = array[i].charAt(array[i].length - len - 1);\n    if (letter && letter !== ' ') {\n      return wordPrefix;\n    }\n  }\n  return max;\n}\n\n/**\n * Wrap text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nexport function wrap(text: string, limit: number): string {\n  const lines = text.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    lines[i] = wrapLine(lines[i], limit);\n  }\n  return lines.join('\\n');\n}\n\n/**\n * Wrap single line of text to the specified width.\n *\n * @param text Text to wrap.\n * @param limit Width to wrap each line.\n * @returns Wrapped text.\n */\nfunction wrapLine(text: string, limit: number): string {\n  if (text.length <= limit) {\n    // Short text, no need to wrap.\n    return text;\n  }\n  // Split the text into words.\n  const words = text.trim().split(/\\s+/);\n  // Set limit to be the length of the largest word.\n  for (let i = 0; i < words.length; i++) {\n    if (words[i].length > limit) {\n      limit = words[i].length;\n    }\n  }\n\n  let lastScore;\n  let score = -Infinity;\n  let lastText;\n  let lineCount = 1;\n  do {\n    lastScore = score;\n    lastText = text;\n    // Create a list of booleans representing if a space (false) or\n    // a break (true) appears after each word.\n    let wordBreaks = [];\n    // Seed the list with evenly spaced linebreaks.\n    const steps = words.length / lineCount;\n    let insertedBreaks = 1;\n    for (let i = 0; i < words.length - 1; i++) {\n      if (insertedBreaks < (i + 1.5) / steps) {\n        insertedBreaks++;\n        wordBreaks[i] = true;\n      } else {\n        wordBreaks[i] = false;\n      }\n    }\n    wordBreaks = wrapMutate(words, wordBreaks, limit);\n    score = wrapScore(words, wordBreaks, limit);\n    text = wrapToText(words, wordBreaks);\n    lineCount++;\n  } while (score > lastScore);\n  return lastText;\n}\n\n/**\n * Compute a score for how good the wrapping is.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns Larger the better.\n */\nfunction wrapScore(\n    words: string[], wordBreaks: boolean[], limit: number): number {\n  // If this function becomes a performance liability, add caching.\n  // Compute the length of each line.\n  const lineLengths = [0];\n  const linePunctuation = [];\n  for (let i = 0; i < words.length; i++) {\n    lineLengths[lineLengths.length - 1] += words[i].length;\n    if (wordBreaks[i] === true) {\n      lineLengths.push(0);\n      linePunctuation.push(words[i].charAt(words[i].length - 1));\n    } else if (wordBreaks[i] === false) {\n      lineLengths[lineLengths.length - 1]++;\n    }\n  }\n  const maxLength = Math.max(...lineLengths);\n\n  let score = 0;\n  for (let i = 0; i < lineLengths.length; i++) {\n    // Optimize for width.\n    // -2 points per char over limit (scaled to the power of 1.5).\n    score -= Math.pow(Math.abs(limit - lineLengths[i]), 1.5) * 2;\n    // Optimize for even lines.\n    // -1 point per char smaller than max (scaled to the power of 1.5).\n    score -= Math.pow(maxLength - lineLengths[i], 1.5);\n    // Optimize for structure.\n    // Add score to line endings after punctuation.\n    if ('.?!'.indexOf(linePunctuation[i]) !== -1) {\n      score += limit / 3;\n    } else if (',;)]}'.indexOf(linePunctuation[i]) !== -1) {\n      score += limit / 4;\n    }\n  }\n  // All else being equal, the last line should not be longer than the\n  // previous line.  For example, this looks wrong:\n  // aaa bbb\n  // ccc ddd eee\n  if (lineLengths.length > 1 &&\n      lineLengths[lineLengths.length - 1] <=\n          lineLengths[lineLengths.length - 2]) {\n    score += 0.5;\n  }\n  return score;\n}\n/**\n * Mutate the array of line break locations until an optimal solution is found.\n * No line breaks are added or deleted, they are simply moved around.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @param limit Width to wrap each line.\n * @returns New array of optimal line breaks.\n */\nfunction wrapMutate(\n    words: string[], wordBreaks: boolean[], limit: number): boolean[] {\n  let bestScore = wrapScore(words, wordBreaks, limit);\n  let bestBreaks;\n  // Try shifting every line break forward or backward.\n  for (let i = 0; i < wordBreaks.length - 1; i++) {\n    if (wordBreaks[i] === wordBreaks[i + 1]) {\n      continue;\n    }\n    const mutatedWordBreaks = (new Array<boolean>()).concat(wordBreaks);\n    mutatedWordBreaks[i] = !mutatedWordBreaks[i];\n    mutatedWordBreaks[i + 1] = !mutatedWordBreaks[i + 1];\n    const mutatedScore = wrapScore(words, mutatedWordBreaks, limit);\n    if (mutatedScore > bestScore) {\n      bestScore = mutatedScore;\n      bestBreaks = mutatedWordBreaks;\n    }\n  }\n  if (bestBreaks) {\n    // Found an improvement.  See if it may be improved further.\n    return wrapMutate(words, bestBreaks, limit);\n  }\n  // No improvements found.  Done.\n  return wordBreaks;\n}\n\n/**\n * Reassemble the array of words into text, with the specified line breaks.\n *\n * @param words Array of each word.\n * @param wordBreaks Array of line breaks.\n * @returns Plain text.\n */\nfunction wrapToText(words: string[], wordBreaks: boolean[]): string {\n  const text = [];\n  for (let i = 0; i < words.length; i++) {\n    text.push(words[i]);\n    if (wordBreaks[i] !== undefined) {\n      text.push(wordBreaks[i] ? '\\n' : ' ');\n    }\n  }\n  return text.join('');\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n */\nexport function isNumber(str: string): boolean {\n  return /^\\s*-?\\d+(\\.\\d+)?\\s*$/.test(str);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Tooltip');\n\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as blocklyString from './utils/string.js';\n\n\n/**\n * A type which can define a tooltip.\n * Either a string, an object containing a tooltip property, or a function which\n * returns either a string, or another arbitrarily nested function which\n * eventually unwinds to a string.\n */\nexport type TipInfo =\n    string|{tooltip: AnyDuringMigration}|(() => TipInfo|string|Function);\n\n/**\n * A function that renders custom tooltip UI.\n * 1st parameter: the div element to render content into.\n * 2nd parameter: the element being moused over (i.e., the element for which the\n * tooltip should be shown).\n */\nexport type CustomTooltip = (p1: Element, p2: Element) => AnyDuringMigration;\n\n/**\n * An optional function that renders custom tooltips into the provided DIV. If\n * this is defined, the function will be called instead of rendering the default\n * tooltip UI.\n */\nlet customTooltip: CustomTooltip|undefined = undefined;\n\n/**\n * Sets a custom function that will be called if present instead of the default\n * tooltip UI.\n *\n * @param customFn A custom tooltip used to render an alternate tooltip UI.\n */\nexport function setCustomTooltip(customFn: CustomTooltip) {\n  customTooltip = customFn;\n}\n\n/**\n * Gets the custom tooltip function.\n *\n * @returns The custom tooltip function, if defined.\n */\nexport function getCustomTooltip(): CustomTooltip|undefined {\n  return customTooltip;\n}\n\n/** Is a tooltip currently showing? */\nlet visible = false;\n\n/**\n * Returns whether or not a tooltip is showing\n *\n * @returns True if a tooltip is showing\n */\nexport function isVisible(): boolean {\n  return visible;\n}\n\n/** Is someone else blocking the tooltip from being shown? */\nlet blocked = false;\n\n/**\n * Maximum width (in characters) of a tooltip.\n */\nexport const LIMIT = 50;\n\n/** PID of suspended thread to clear tooltip on mouse out. */\nlet mouseOutPid: AnyDuringMigration = 0;\n\n/** PID of suspended thread to show the tooltip. */\nlet showPid: AnyDuringMigration = 0;\n\n/**\n * Last observed X location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastX = 0;\n\n/**\n * Last observed Y location of the mouse pointer (freezes when tooltip appears).\n */\nlet lastY = 0;\n\n/** Current element being pointed at. */\nlet element: AnyDuringMigration = null;\n\n/**\n * Once a tooltip has opened for an element, that element is 'poisoned' and\n * cannot respawn a tooltip until the pointer moves over a different element.\n */\nlet poisonedElement: AnyDuringMigration = null;\n\n/**\n * Horizontal offset between mouse cursor and tooltip.\n */\nexport const OFFSET_X = 0;\n\n/**\n * Vertical offset between mouse cursor and tooltip.\n */\nexport const OFFSET_Y = 10;\n\n/**\n * Radius mouse can move before killing tooltip.\n */\nexport const RADIUS_OK = 10;\n\n/**\n * Delay before tooltip appears.\n */\nexport const HOVER_MS = 750;\n\n/**\n * Horizontal padding between tooltip and screen edge.\n */\nexport const MARGINS = 5;\n\n/** The HTML container.  Set once by createDom. */\nlet containerDiv: HTMLDivElement|null = null;\n\n/**\n * Returns the HTML tooltip container.\n *\n * @returns The HTML tooltip container.\n */\nexport function getDiv(): HTMLDivElement|null {\n  return containerDiv;\n}\n\n/**\n * Returns the tooltip text for the given element.\n *\n * @param object The object to get the tooltip text of.\n * @returns The tooltip text of the element.\n */\nexport function getTooltipOfObject(object: AnyDuringMigration|null): string {\n  const obj = getTargetObject(object);\n  if (obj) {\n    let tooltip = obj.tooltip;\n    while (typeof tooltip === 'function') {\n      tooltip = tooltip();\n    }\n    if (typeof tooltip !== 'string') {\n      throw Error('Tooltip function must return a string.');\n    }\n    return tooltip;\n  }\n  return '';\n}\n\n/**\n * Returns the target object that the given object is targeting for its\n * tooltip. Could be the object itself.\n *\n * @param obj The object are trying to find the target tooltip object of.\n * @returns The target tooltip object.\n */\nfunction getTargetObject(obj: object|null): {tooltip: AnyDuringMigration}|null {\n  while (obj && (obj as any).tooltip) {\n    if (typeof (obj as any).tooltip === 'string' ||\n        typeof (obj as any).tooltip === 'function') {\n      return obj as {tooltip: string | (() => string)};\n    }\n    obj = (obj as any).tooltip;\n  }\n  return null;\n}\n\n/**\n * Create the tooltip div and inject it onto the page.\n */\nexport function createDom() {\n  if (containerDiv) {\n    return;  // Already created.\n  }\n  // Create an HTML container for popup overlays (e.g. editor widgets).\n  containerDiv = document.createElement('div');\n  containerDiv.className = 'blocklyTooltipDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Binds the required mouse events onto an SVG element.\n *\n * @param element SVG element onto which tooltip is to be bound.\n */\nexport function bindMouseEvents(element: Element) {\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  (element as AnyDuringMigration).mouseOverWrapper_ =\n      browserEvents.bind(element, 'pointerover', null, onMouseOver);\n  (element as AnyDuringMigration).mouseOutWrapper_ =\n      browserEvents.bind(element, 'pointerout', null, onMouseOut);\n\n  // Don't use bindEvent_ for mousemove since that would create a\n  // corresponding touch handler, even though this only makes sense in the\n  // context of a mouseover/mouseout.\n  element.addEventListener('pointermove', onMouseMove, false);\n}\n\n/**\n * Unbinds tooltip mouse events from the SVG element.\n *\n * @param element SVG element onto which tooltip is bound.\n */\nexport function unbindMouseEvents(element: Element|null) {\n  if (!element) {\n    return;\n  }\n  // TODO (#6097): Don't stash wrapper info on the DOM.\n  browserEvents.unbind((element as AnyDuringMigration).mouseOverWrapper_);\n  browserEvents.unbind((element as AnyDuringMigration).mouseOutWrapper_);\n  element.removeEventListener('pointermove', onMouseMove);\n}\n\n/**\n * Hide the tooltip if the mouse is over a different object.\n * Initialize the tooltip to potentially appear for this object.\n *\n * @param e Mouse event.\n */\nfunction onMouseOver(e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // If the tooltip is an object, treat it as a pointer to the next object in\n  // the chain to look at.  Terminate when a string or function is found.\n  const newElement = getTargetObject(e.currentTarget);\n  if (element !== newElement) {\n    hide();\n    poisonedElement = null;\n    element = newElement;\n  }\n  // Forget about any immediately preceding mouseOut event.\n  clearTimeout(mouseOutPid);\n}\n\n/**\n * Hide the tooltip if the mouse leaves the object and enters the workspace.\n *\n * @param _e Mouse event.\n */\nfunction onMouseOut(_e: PointerEvent) {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  // Moving from one element to another (overlapping or with no gap) generates\n  // a mouseOut followed instantly by a mouseOver.  Fork off the mouseOut\n  // event and kill it if a mouseOver is received immediately.\n  // This way the task only fully executes if mousing into the void.\n  mouseOutPid = setTimeout(function() {\n    element = null;\n    poisonedElement = null;\n    hide();\n  }, 1);\n  clearTimeout(showPid);\n  showPid = 0;\n}\n\n/**\n * When hovering over an element, schedule a tooltip to be shown.  If a tooltip\n * is already visible, hide it if the mouse strays out of a certain radius.\n *\n * @param e Mouse event.\n */\nfunction onMouseMove(e: Event) {\n  if (!element || !(element as AnyDuringMigration).tooltip) {\n    // No tooltip here to show.\n    return;\n  } else if (blocked) {\n    // Someone doesn't want us to show tooltips.  We are probably handling a\n    // user gesture, such as a click or drag.\n    return;\n  }\n  if (visible) {\n    // Compute the distance between the mouse position when the tooltip was\n    // shown and the current mouse position.  Pythagorean theorem.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    const dx = lastX - (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    const dy = lastY - (e as AnyDuringMigration).pageY;\n    if (Math.sqrt(dx * dx + dy * dy) > RADIUS_OK) {\n      hide();\n    }\n  } else if (poisonedElement !== element) {\n    // The mouse moved, clear any previously scheduled tooltip.\n    clearTimeout(showPid);\n    // Maybe this time the mouse will stay put.  Schedule showing of tooltip.\n    // AnyDuringMigration because:  Property 'pageX' does not exist on type\n    // 'Event'.\n    lastX = (e as AnyDuringMigration).pageX;\n    // AnyDuringMigration because:  Property 'pageY' does not exist on type\n    // 'Event'.\n    lastY = (e as AnyDuringMigration).pageY;\n    showPid = setTimeout(show, HOVER_MS);\n  }\n}\n\n/**\n * Dispose of the tooltip.\n *\n * @internal\n */\nexport function dispose() {\n  element = null;\n  poisonedElement = null;\n  hide();\n}\n\n/**\n * Hide the tooltip.\n */\nexport function hide() {\n  if (visible) {\n    visible = false;\n    if (containerDiv) {\n      containerDiv.style.display = 'none';\n    }\n  }\n  if (showPid) {\n    clearTimeout(showPid);\n    showPid = 0;\n  }\n}\n\n/**\n * Hide any in-progress tooltips and block showing new tooltips until the next\n * call to unblock().\n *\n * @internal\n */\nexport function block() {\n  hide();\n  blocked = true;\n}\n\n/**\n * Unblock tooltips: allow them to be scheduled and shown according to their own\n * logic.\n *\n * @internal\n */\nexport function unblock() {\n  blocked = false;\n}\n\n/** Renders the tooltip content into the tooltip div. */\nfunction renderContent() {\n  if (!containerDiv || !element) {\n    // This shouldn't happen, but if it does, we can't render.\n    return;\n  }\n  if (typeof customTooltip === 'function') {\n    customTooltip(containerDiv, element);\n  } else {\n    renderDefaultContent();\n  }\n}\n\n/** Renders the default tooltip UI. */\nfunction renderDefaultContent() {\n  let tip = getTooltipOfObject(element);\n  tip = blocklyString.wrap(tip, LIMIT);\n  // Create new text, line by line.\n  const lines = tip.split('\\n');\n  for (let i = 0; i < lines.length; i++) {\n    const div = (document.createElement('div'));\n    div.appendChild(document.createTextNode(lines[i]));\n    containerDiv!.appendChild(div);\n  }\n}\n\n/**\n * Gets the coordinates for the tooltip div, taking into account the edges of\n * the screen to prevent showing the tooltip offscreen.\n *\n * @param rtl True if the tooltip should be in right-to-left layout.\n * @returns Coordinates at which the tooltip div should be placed.\n */\nfunction getPosition(rtl: boolean): {x: number, y: number} {\n  // Position the tooltip just below the cursor.\n  const windowWidth = document.documentElement.clientWidth;\n  const windowHeight = document.documentElement.clientHeight;\n\n  let anchorX = lastX;\n  if (rtl) {\n    anchorX -= OFFSET_X + containerDiv!.offsetWidth;\n  } else {\n    anchorX += OFFSET_X;\n  }\n\n  let anchorY = lastY + OFFSET_Y;\n  if (anchorY + containerDiv!.offsetHeight > windowHeight + window.scrollY) {\n    // Falling off the bottom of the screen; shift the tooltip up.\n    anchorY -= containerDiv!.offsetHeight + 2 * OFFSET_Y;\n  }\n\n  if (rtl) {\n    // Prevent falling off left edge in RTL mode.\n    anchorX = Math.max(MARGINS - window.scrollX, anchorX);\n  } else {\n    if (anchorX + containerDiv!.offsetWidth >\n        windowWidth + window.scrollX - 2 * MARGINS) {\n      // Falling off the right edge of the screen;\n      // clamp the tooltip on the edge.\n      anchorX = windowWidth - containerDiv!.offsetWidth - 2 * MARGINS;\n    }\n  }\n\n  return {x: anchorX, y: anchorY};\n}\n\n/** Create the tooltip and show it. */\nfunction show() {\n  if (blocked) {\n    // Someone doesn't want us to show tooltips.\n    return;\n  }\n  poisonedElement = element;\n  if (!containerDiv) {\n    return;\n  }\n  // Erase all existing text.\n  containerDiv.textContent = '';\n\n  // Add new content.\n  renderContent();\n\n  // Display the tooltip.\n  const rtl = (element as any).RTL;\n  containerDiv.style.direction = rtl ? 'rtl' : 'ltr';\n  containerDiv.style.display = 'block';\n  visible = true;\n\n  const {x, y} = getPosition(rtl);\n  containerDiv.style.left = x + 'px';\n  containerDiv.style.top = y + 'px';\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.colour');\n\n\n/**\n * The richness of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvSaturation = 0.45;\n\n/**\n * Get the richness of block colours, regardless of the hue.\n *\n * @returns The current richness.\n * @internal\n */\nexport function getHsvSaturation(): number {\n  return hsvSaturation;\n}\n\n/**\n * Set the richness of block colours, regardless of the hue.\n *\n * @param newSaturation The new richness, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvSaturation(newSaturation: number) {\n  hsvSaturation = newSaturation;\n}\n\n/**\n * The intensity of block colours, regardless of the hue.\n * Must be in the range of 0 (inclusive) to 1 (exclusive).\n */\nlet hsvValue = 0.65;\n\n/**\n * Get the intensity of block colours, regardless of the hue.\n *\n * @returns The current intensity.\n * @internal\n */\nexport function getHsvValue(): number {\n  return hsvValue;\n}\n\n/**\n * Set the intensity of block colours, regardless of the hue.\n *\n * @param newValue The new intensity, in the range of  0 (inclusive) to 1\n *     (exclusive)\n * @internal\n */\nexport function setHsvValue(newValue: number) {\n  hsvValue = newValue;\n}\n\n/**\n * Parses a colour from a string.\n * .parse('red') = '#ff0000'\n * .parse('#f00') = '#ff0000'\n * .parse('#ff0000') = '#ff0000'\n * .parse('0xff0000') = '#ff0000'\n * .parse('rgb(255, 0, 0)') = '#ff0000'\n *\n * @param str Colour in some CSS format.\n * @returns A string containing a hex representation of the colour, or null if\n *     can't be parsed.\n */\nexport function parse(str: string|number): string|null {\n  str = `${str}`.toLowerCase().trim();\n  let hex = names[str];\n  if (hex) {\n    // e.g. 'red'\n    return hex;\n  }\n  hex = str.substring(0, 2) === '0x' ? '#' + str.substring(2) : str;\n  hex = hex[0] === '#' ? hex : '#' + hex;\n  if (/^#[0-9a-f]{6}$/.test(hex)) {\n    // e.g. '#00ff88'\n    return hex;\n  }\n  if (/^#[0-9a-f]{3}$/.test(hex)) {\n    // e.g. '#0f8'\n    return ['#', hex[1], hex[1], hex[2], hex[2], hex[3], hex[3]].join('');\n  }\n  const rgb = str.match(/^(?:rgb)?\\s*\\(\\s*(\\d+)\\s*,\\s*(\\d+)\\s*,\\s*(\\d+)\\s*\\)$/);\n  if (rgb) {\n    // e.g. 'rgb(0, 128, 255)'\n    const r = Number(rgb[1]);\n    const g = Number(rgb[2]);\n    const b = Number(rgb[3]);\n    if (r >= 0 && r < 256 && g >= 0 && g < 256 && b >= 0 && b < 256) {\n      return rgbToHex(r, g, b);\n    }\n  }\n  return null;\n}\n\n/**\n * Converts a colour from RGB to hex representation.\n *\n * @param r Amount of red, int between 0 and 255.\n * @param g Amount of green, int between 0 and 255.\n * @param b Amount of blue, int between 0 and 255.\n * @returns Hex representation of the colour.\n */\nexport function rgbToHex(r: number, g: number, b: number): string {\n  const rgb = r << 16 | g << 8 | b;\n  if (r < 0x10) {\n    return '#' + (0x1000000 | rgb).toString(16).substr(1);\n  }\n  return '#' + rgb.toString(16);\n}\n\n/**\n * Converts a colour to RGB.\n *\n * @param colour String representing colour in any colour format ('#ff0000',\n *     'red', '0xff000', etc).\n * @returns RGB representation of the colour.\n */\nexport function hexToRgb(colour: string): number[] {\n  const hex = parse(colour);\n  if (!hex) {\n    return [0, 0, 0];\n  }\n\n  const rgb = parseInt(hex.substr(1), 16);\n  const r = rgb >> 16;\n  const g = rgb >> 8 & 255;\n  const b = rgb & 255;\n\n  return [r, g, b];\n}\n\n/**\n * Converts an HSV triplet to hex representation.\n *\n * @param h Hue value in [0, 360].\n * @param s Saturation value in [0, 1].\n * @param v Brightness in [0, 255].\n * @returns Hex representation of the colour.\n */\nexport function hsvToHex(h: number, s: number, v: number): string {\n  let red = 0;\n  let green = 0;\n  let blue = 0;\n  if (s === 0) {\n    red = v;\n    green = v;\n    blue = v;\n  } else {\n    const sextant = Math.floor(h / 60);\n    const remainder = h / 60 - sextant;\n    const val1 = v * (1 - s);\n    const val2 = v * (1 - s * remainder);\n    const val3 = v * (1 - s * (1 - remainder));\n    switch (sextant) {\n      case 1:\n        red = val2;\n        green = v;\n        blue = val1;\n        break;\n      case 2:\n        red = val1;\n        green = v;\n        blue = val3;\n        break;\n      case 3:\n        red = val1;\n        green = val2;\n        blue = v;\n        break;\n      case 4:\n        red = val3;\n        green = val1;\n        blue = v;\n        break;\n      case 5:\n        red = v;\n        green = val1;\n        blue = val2;\n        break;\n      case 6:\n      case 0:\n        red = v;\n        green = val3;\n        blue = val1;\n        break;\n    }\n  }\n  return rgbToHex(Math.floor(red), Math.floor(green), Math.floor(blue));\n}\n\n/**\n * Blend two colours together, using the specified factor to indicate the\n * weight given to the first colour.\n *\n * @param colour1 First colour.\n * @param colour2 Second colour.\n * @param factor The weight to be given to colour1 over colour2.\n *     Values should be in the range [0, 1].\n * @returns Combined colour represented in hex.\n */\nexport function blend(colour1: string, colour2: string, factor: number): string|\n    null {\n  const hex1 = parse(colour1);\n  if (!hex1) {\n    return null;\n  }\n  const hex2 = parse(colour2);\n  if (!hex2) {\n    return null;\n  }\n  const rgb1 = hexToRgb(hex1);\n  const rgb2 = hexToRgb(hex2);\n  const r = Math.round(rgb2[0] + factor * (rgb1[0] - rgb2[0]));\n  const g = Math.round(rgb2[1] + factor * (rgb1[1] - rgb2[1]));\n  const b = Math.round(rgb2[2] + factor * (rgb1[2] - rgb2[2]));\n  return rgbToHex(r, g, b);\n}\n\n/**\n * A map that contains the 16 basic colour keywords as defined by W3C:\n * https://www.w3.org/TR/2018/REC-css-color-3-20180619/#html4\n * The keys of this map are the lowercase \"readable\" names of the colours,\n * while the values are the \"hex\" values.\n */\nexport const names: {[key: string]: string} = {\n  'aqua': '#00ffff',\n  'black': '#000000',\n  'blue': '#0000ff',\n  'fuchsia': '#ff00ff',\n  'gray': '#808080',\n  'green': '#008000',\n  'lime': '#00ff00',\n  'maroon': '#800000',\n  'navy': '#000080',\n  'olive': '#808000',\n  'purple': '#800080',\n  'red': '#ff0000',\n  'silver': '#c0c0c0',\n  'teal': '#008080',\n  'white': '#ffffff',\n  'yellow': '#ffff00',\n};\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n */\nexport function hueToHex(hue: number): string {\n  return hsvToHex(hue, hsvSaturation, hsvValue * 255);\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.parsing');\n\nimport {Msg} from '../msg.js';\n\nimport * as colourUtils from './colour.js';\n\n\n/**\n * Internal implementation of the message reference and interpolation token\n * parsing used by tokenizeInterpolation() and replaceMessageReferences().\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @param parseInterpolationTokens Option to parse numeric\n *     interpolation tokens (%1, %2, ...) when true.\n * @returns Array of strings and numbers.\n */\nfunction tokenizeInterpolationInternal(\n    message: string, parseInterpolationTokens: boolean): (string|number)[] {\n  const tokens = [];\n  const chars = message.split('');\n  chars.push('');  // End marker.\n  // Parse the message with a finite state machine.\n  // 0 - Base case.\n  // 1 - % found.\n  // 2 - Digit found.\n  // 3 - Message ref found.\n  let state = 0;\n  const buffer = new Array<string>();\n  let number = null;\n  for (let i = 0; i < chars.length; i++) {\n    const c = chars[i];\n    if (state === 0) {  // Start escape.\n      if (c === '%') {\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n        state = 1;\n      } else {\n        buffer.push(c);  // Regular char.\n      }\n    } else if (state === 1) {\n      if (c === '%') {\n        buffer.push(c);  // Escaped %: %%\n        state = 0;\n      } else if (parseInterpolationTokens && '0' <= c && c <= '9') {\n        state = 2;\n        number = c;\n        const text = buffer.join('');\n        if (text) {\n          tokens.push(text);\n        }\n        buffer.length = 0;\n      } else if (c === '{') {\n        state = 3;\n      } else {\n        buffer.push('%', c);  // Not recognized. Return as literal.\n        state = 0;\n      }\n    } else if (state === 2) {\n      if ('0' <= c && c <= '9') {\n        number += c;  // Multi-digit number.\n      } else {\n        tokens.push(parseInt(number ?? '', 10));\n        i--;  // Parse this char again.\n        state = 0;\n      }\n    } else if (state === 3) {  // String table reference\n      if (c === '') {\n        // Premature end before closing '}'\n        buffer.splice(0, 0, '%{');  // Re-insert leading delimiter\n        i--;                        // Parse this char again.\n        state = 0;                  // and parse as string literal.\n      } else if (c !== '}') {\n        buffer.push(c);\n      } else {\n        const rawKey = buffer.join('');\n        if (/[A-Z]\\w*/i.test(rawKey)) {  // Strict matching\n          // Found a valid string key. Attempt case insensitive match.\n          const keyUpper = rawKey.toUpperCase();\n\n          // BKY_ is the prefix used to namespace the strings used in\n          // Blockly core files and the predefined blocks in ../blocks/.\n          // These strings are defined in ../msgs/ files.\n          const bklyKey =\n              keyUpper.startsWith('BKY_') ? keyUpper.substring(4) : null;\n          if (bklyKey && bklyKey in Msg) {\n            const rawValue = Msg[bklyKey];\n            if (typeof rawValue === 'string') {\n              // Attempt to dereference substrings, too, appending to the\n              // end.\n              Array.prototype.push.apply(\n                  tokens,\n                  tokenizeInterpolationInternal(\n                      rawValue, parseInterpolationTokens));\n            } else if (parseInterpolationTokens) {\n              // When parsing interpolation tokens, numbers are special\n              // placeholders (%1, %2, etc). Make sure all other values are\n              // strings.\n              tokens.push(`${rawValue}`);\n            } else {\n              tokens.push(rawValue);\n            }\n          } else {\n            // No entry found in the string table. Pass reference as string.\n            tokens.push('%{' + rawKey + '}');\n          }\n          buffer.length = 0;  // Clear the array\n          state = 0;\n        } else {\n          tokens.push('%{' + rawKey + '}');\n          buffer.length = 0;\n          state = 0;  // and parse as string literal.\n        }\n      }\n    }\n  }\n  let text = buffer.join('');\n  if (text) {\n    tokens.push(text);\n  }\n\n  // Merge adjacent text tokens into a single string.\n  const mergedTokens = [];\n  buffer.length = 0;\n  for (let i = 0; i < tokens.length; i++) {\n    if (typeof tokens[i] === 'string') {\n      buffer.push(tokens[i] as string);\n    } else {\n      text = buffer.join('');\n      if (text) {\n        mergedTokens.push(text);\n      }\n      buffer.length = 0;\n      mergedTokens.push(tokens[i]);\n    }\n  }\n  text = buffer.join('');\n  if (text) {\n    mergedTokens.push(text);\n  }\n  buffer.length = 0;\n\n  return mergedTokens;\n}\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%').\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n */\nexport function tokenizeInterpolation(message: string): (string|number)[] {\n  return tokenizeInterpolationInternal(message, true);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains\n *     string table references.\n * @returns String with message references replaced.\n */\nexport function replaceMessageReferences(message: string|any): string {\n  if (typeof message !== 'string') {\n    return message;\n  }\n  const interpolatedResult = tokenizeInterpolationInternal(message, false);\n  // When parseInterpolationTokens === false, interpolatedResult should be at\n  // most length 1.\n  return interpolatedResult.length ? String(interpolatedResult[0]) : '';\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n */\nexport function checkMessageReferences(message: string): boolean {\n  let validSoFar = true;\n\n  const msgTable = Msg;\n  // TODO (#1169): Implement support for other string tables,\n  // prefixes other than BKY_.\n  const m = message.match(/%{BKY_[A-Z]\\w*}/ig);\n  if (m) {\n    for (let i = 0; i < m.length; i++) {\n      const msgKey = m[i].toUpperCase();\n      if (msgTable[msgKey.slice(6, -1)] === undefined) {\n        console.warn('No message string for ' + m[i] + ' in ' + message);\n        validSoFar = false;  // Continue to report other errors.\n      }\n    }\n  }\n\n  return validSoFar;\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string,\n *     or a message reference string pointing to one of those two values.\n * @returns An object containing the colour as\n *     a #RRGGBB string, and the hue if the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n */\nexport function parseBlockColour(colour: number|\n                                 string): {hue: number|null, hex: string} {\n  const dereferenced =\n      typeof colour === 'string' ? replaceMessageReferences(colour) : colour;\n\n  const hue = Number(dereferenced);\n  if (!isNaN(hue) && 0 <= hue && hue <= 360) {\n    return {\n      hue: hue,\n      hex: colourUtils.hsvToHex(\n          hue, colourUtils.getHsvSaturation(), colourUtils.getHsvValue() * 255),\n    };\n  } else {\n    const hex = colourUtils.parse(dereferenced);\n    if (hex) {\n      // Only store hue if colour is set as a hue.\n      return {hue: null, hex: hex};\n    } else {\n      let errorMsg = 'Invalid colour: \"' + dereferenced + '\"';\n      if (colour !== dereferenced) {\n        errorMsg += ' (from \"' + colour + '\")';\n      }\n      throw Error(errorMsg);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WidgetDiv');\n\nimport * as common from './common.js';\nimport * as dom from './utils/dom.js';\nimport type {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** The object currently using this container. */\nlet owner: unknown = null;\n\n/** Optional cleanup function set by whichever object uses the widget. */\nlet dispose: (() => void)|null = null;\n\n/** A class name representing the current owner's workspace renderer. */\nlet rendererClassName = '';\n\n/** A class name representing the current owner's workspace theme. */\nlet themeClassName = '';\n\n/** The HTML container for popup overlays (e.g. editor widgets). */\nlet containerDiv: HTMLDivElement|null;\n\n/**\n * Returns the HTML container for editor widgets.\n *\n * @returns The editor widget container.\n */\nexport function getDiv(): HTMLDivElement|null {\n  return containerDiv;\n}\n\n/**\n * Allows unit tests to reset the div. Do not use outside of tests.\n *\n * @param newDiv The new value for the DIV field.\n * @internal\n */\nexport function testOnly_setDiv(newDiv: HTMLDivElement|null) {\n  containerDiv = newDiv;\n}\n\n/**\n * Create the widget div and inject it onto the page.\n */\nexport function createDom() {\n  if (containerDiv) {\n    return;  // Already created.\n  }\n\n  containerDiv = document.createElement('div') as HTMLDivElement;\n  containerDiv.className = 'blocklyWidgetDiv';\n  const container = common.getParentContainer() || document.body;\n  container.appendChild(containerDiv);\n}\n\n/**\n * Initialize and display the widget div.  Close the old one if needed.\n *\n * @param newOwner The object that will be using this container.\n * @param rtl Right-to-left (true) or left-to-right (false).\n * @param newDispose Optional cleanup function to be run when the widget is\n *     closed.\n */\nexport function show(newOwner: unknown, rtl: boolean, newDispose: () => void) {\n  hide();\n  owner = newOwner;\n  dispose = newDispose;\n  const div = containerDiv;\n  if (!div) return;\n  div.style.direction = rtl ? 'rtl' : 'ltr';\n  div.style.display = 'block';\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  rendererClassName = mainWorkspace.getRenderer().getClassName();\n  themeClassName = mainWorkspace.getTheme().getClassName();\n  if (rendererClassName) {\n    dom.addClass(div, rendererClassName);\n  }\n  if (themeClassName) {\n    dom.addClass(div, themeClassName);\n  }\n}\n\n/**\n * Destroy the widget and hide the div.\n */\nexport function hide() {\n  if (!isVisible()) {\n    return;\n  }\n  owner = null;\n\n  const div = containerDiv;\n  if (!div) return;\n  div.style.display = 'none';\n  div.style.left = '';\n  div.style.top = '';\n  dispose && dispose();\n  dispose = null;\n  div.textContent = '';\n\n  if (rendererClassName) {\n    dom.removeClass(div, rendererClassName);\n    rendererClassName = '';\n  }\n  if (themeClassName) {\n    dom.removeClass(div, themeClassName);\n    themeClassName = '';\n  }\n  (common.getMainWorkspace() as WorkspaceSvg).markFocused();\n}\n\n/**\n * Is the container visible?\n *\n * @returns True if visible.\n */\nexport function isVisible(): boolean {\n  return !!owner;\n}\n\n/**\n * Destroy the widget and hide the div if it is being used by the specified\n * object.\n *\n * @param oldOwner The object that was using this container.\n */\nexport function hideIfOwner(oldOwner: unknown) {\n  if (owner === oldOwner) {\n    hide();\n  }\n}\n/**\n * Set the widget div's position and height.  This function does nothing clever:\n * it will not ensure that your widget div ends up in the visible window.\n *\n * @param x Horizontal location (window coordinates, not body).\n * @param y Vertical location (window coordinates, not body).\n * @param height The height of the widget div (pixels).\n */\nfunction positionInternal(x: number, y: number, height: number) {\n  containerDiv!.style.left = x + 'px';\n  containerDiv!.style.top = y + 'px';\n  containerDiv!.style.height = height + 'px';\n}\n\n/**\n * Position the widget div based on an anchor rectangle.\n * The widget should be placed adjacent to but not overlapping the anchor\n * rectangle.  The preferred position is directly below and aligned to the left\n * (LTR) or right (RTL) side of the anchor.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The size of the widget that is inside the widget div, in\n *     window coordinates.\n * @param rtl Whether the workspace is in RTL mode.  This determines horizontal\n *     alignment.\n * @internal\n */\nexport function positionWithAnchor(\n    viewportBBox: Rect, anchorBBox: Rect, widgetSize: Size, rtl: boolean) {\n  const y = calculateY(viewportBBox, anchorBBox, widgetSize);\n  const x = calculateX(viewportBBox, anchorBBox, widgetSize, rtl);\n\n  if (y < 0) {\n    positionInternal(x, 0, widgetSize.height + y);\n  } else {\n    positionInternal(x, y, widgetSize.height);\n  }\n}\n\n/**\n * Calculate an x position (in window coordinates) such that the widget will not\n * be offscreen on the right or left.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @param rtl Whether the Blockly workspace is in RTL mode.\n * @returns A valid x-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateX(\n    viewportBBox: Rect, anchorBBox: Rect, widgetSize: Size,\n    rtl: boolean): number {\n  if (rtl) {\n    // Try to align the right side of the field and the right side of widget.\n    const widgetLeft = anchorBBox.right - widgetSize.width;\n    // Don't go offscreen left.\n    const x = Math.max(widgetLeft, viewportBBox.left);\n    // But really don't go offscreen right:\n    return Math.min(x, viewportBBox.right - widgetSize.width);\n  } else {\n    // Try to align the left side of the field and the left side of widget.\n    // Don't go offscreen right.\n    const x = Math.min(anchorBBox.left, viewportBBox.right - widgetSize.width);\n    // But left is more important, because that's where the text is.\n    return Math.max(x, viewportBBox.left);\n  }\n}\n\n/**\n * Calculate a y position (in window coordinates) such that the widget will not\n * be offscreen on the top or bottom.\n *\n * @param viewportBBox The bounding rectangle of the current viewport, in window\n *     coordinates.\n * @param anchorBBox The bounding rectangle of the anchor, in window\n *     coordinates.\n * @param widgetSize The dimensions of the widget inside the widget div.\n * @returns A valid y-coordinate for the top left corner of the widget div, in\n *     window coordinates.\n */\nfunction calculateY(\n    viewportBBox: Rect, anchorBBox: Rect, widgetSize: Size): number {\n  // Flip the widget vertically if off the bottom.\n  // The widget could go off the top of the window, but it would also go off\n  // the bottom.  The window is just too small.\n  if (anchorBBox.bottom + widgetSize.height >= viewportBBox.bottom) {\n    // The bottom of the widget is at the top of the field.\n    return anchorBBox.top - widgetSize.height;\n  } else {\n    // The top of the widget is at the bottom of the field.\n    return anchorBBox.bottom;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.fieldRegistry');\n\nimport type {Field, FieldProto} from './field.js';\nimport * as registry from './registry.js';\n\ninterface RegistryOptions {\n  type: string;\n  [key: string]: unknown;\n}\n\n/**\n * Registers a field type.\n * fieldRegistry.fromJson uses this registry to\n * find the appropriate field type.\n *\n * @param type The field type name as used in the JSON definition.\n * @param fieldClass The field class containing a fromJson function that can\n *     construct an instance of the field.\n * @throws {Error} if the type name is empty, the field is already registered,\n *     or the fieldClass is not an object containing a fromJson function.\n */\nexport function register(type: string, fieldClass: FieldProto) {\n  registry.register(registry.Type.FIELD, type, fieldClass);\n}\n\n/**\n * Unregisters the field registered with the given type.\n *\n * @param type The field type name as used in the JSON definition.\n */\nexport function unregister(type: string) {\n  registry.unregister(registry.Type.FIELD, type);\n}\n\n/**\n * Construct a Field from a JSON arg object.\n * Finds the appropriate registered field by the type name as registered using\n * fieldRegistry.register.\n *\n * @param options A JSON object with a type and options specific to the field\n *     type.\n * @returns The new field instance or null if a field wasn't found with the\n *     given type name\n * @internal\n */\nexport function fromJson<T>(options: RegistryOptions): Field<T>|null {\n  return TEST_ONLY.fromJsonInternal(options);\n}\n\n/**\n * Private version of fromJson for stubbing in tests.\n *\n * @param options\n */\nfunction fromJsonInternal<T>(options: RegistryOptions): Field<T>|null {\n  const fieldObject = registry.getObject(registry.Type.FIELD, options.type);\n  if (!fieldObject) {\n    console.warn(\n        'Blockly could not create a field of type ' + options['type'] +\n        '. The field is probably not being registered. This could be because' +\n        ' the file is not loaded, the field does not register itself (Issue' +\n        ' #1584), or the registration is not being reached.');\n    return null;\n  } else if (typeof (fieldObject as any).fromJson !== 'function') {\n    throw new TypeError('returned Field was not a IRegistrableField');\n  } else {\n    type fromJson = (options: {}) => Field<T>;\n    return (fieldObject as unknown as {fromJson: fromJson}).fromJson(options);\n  }\n}\n\nexport const TEST_ONLY = {\n  fromJsonInternal,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.aria');\n\n\n/** ARIA states/properties prefix. */\nconst ARIA_PREFIX = 'aria-';\n\n/** ARIA role attribute. */\nconst ROLE_ATTRIBUTE = 'role';\n\n/**\n * ARIA role values.\n * Copied from Closure's goog.a11y.aria.Role\n */\nexport enum Role {\n  // ARIA role for an interactive control of tabular data.\n  GRID = 'grid',\n\n  // ARIA role for a cell in a grid.\n  GRIDCELL = 'gridcell',\n  // ARIA role for a group of related elements like tree item siblings.\n  GROUP = 'group',\n\n  // ARIA role for a listbox.\n  LISTBOX = 'listbox',\n\n  // ARIA role for a popup menu.\n  MENU = 'menu',\n\n  // ARIA role for menu item elements.\n  MENUITEM = 'menuitem',\n  // ARIA role for a checkbox box element inside a menu.\n  MENUITEMCHECKBOX = 'menuitemcheckbox',\n  // ARIA role for option items that are  children of combobox, listbox, menu,\n  // radiogroup, or tree elements.\n  OPTION = 'option',\n  // ARIA role for ignorable cosmetic elements with no semantic significance.\n  PRESENTATION = 'presentation',\n\n  // ARIA role for a row of cells in a grid.\n  ROW = 'row',\n  // ARIA role for a tree.\n  TREE = 'tree',\n\n  // ARIA role for a tree item that sometimes may be expanded or collapsed.\n  TREEITEM = 'treeitem'\n}\n\n/**\n * ARIA states and properties.\n * Copied from Closure's goog.a11y.aria.State\n */\nexport enum State {\n  // ARIA property for setting the currently active descendant of an element,\n  // for example the selected item in a list box. Value: ID of an element.\n  ACTIVEDESCENDANT = 'activedescendant',\n  // ARIA property defines the total number of columns in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  COLCOUNT = 'colcount',\n  // ARIA state for a disabled item. Value: one of {true, false}.\n  DISABLED = 'disabled',\n\n  // ARIA state for setting whether the element like a tree node is expanded.\n  // Value: one of {true, false, undefined}.\n  EXPANDED = 'expanded',\n\n  // ARIA state indicating that the entered value does not conform. Value:\n  // one of {false, true, 'grammar', 'spelling'}\n  INVALID = 'invalid',\n\n  // ARIA property that provides a label to override any other text, value, or\n  // contents used to describe this element. Value: string.\n  LABEL = 'label',\n  // ARIA property for setting the element which labels another element.\n  // Value: space-separated IDs of elements.\n  LABELLEDBY = 'labelledby',\n\n  // ARIA property for setting the level of an element in the hierarchy.\n  // Value: integer.\n  LEVEL = 'level',\n  // ARIA property indicating if the element is horizontal or vertical.\n  // Value: one of {'vertical', 'horizontal'}.\n  ORIENTATION = 'orientation',\n\n  // ARIA property that defines an element's number of position in a list.\n  // Value: integer.\n  POSINSET = 'posinset',\n\n  // ARIA property defines the total number of rows in a table, grid, or\n  // treegrid.\n  // Value: integer.\n  ROWCOUNT = 'rowcount',\n\n  // ARIA state for setting the currently selected item in the list.\n  // Value: one of {true, false, undefined}.\n  SELECTED = 'selected',\n  // ARIA property defining the number of items in a list. Value: integer.\n  SETSIZE = 'setsize',\n\n  // ARIA property for slider maximum value. Value: number.\n  VALUEMAX = 'valuemax',\n\n  // ARIA property for slider minimum value. Value: number.\n  VALUEMIN = 'valuemin'\n}\n\n/**\n * Sets the role of an element.\n *\n * Similar to Closure's goog.a11y.aria\n *\n * @param element DOM node to set role of.\n * @param roleName Role name.\n */\nexport function setRole(element: Element, roleName: Role) {\n  element.setAttribute(ROLE_ATTRIBUTE, roleName);\n}\n\n/**\n * Sets the state or property of an element.\n * Copied from Closure's goog.a11y.aria\n *\n * @param element DOM node where we set state.\n * @param stateName State attribute being set.\n *     Automatically adds prefix 'aria-' to the state name if the attribute is\n * not an extra attribute.\n * @param value Value for the state attribute.\n */\nexport function setState(\n    element: Element, stateName: State, value: string|boolean|number|string[]) {\n  if (Array.isArray(value)) {\n    value = value.join(' ');\n  }\n  const attrStateName = ARIA_PREFIX + stateName;\n  element.setAttribute(attrStateName, `${value}`);\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Dropdown input field.  Used for editable titles and variables.\n * In the interests of a consistent UI, the toolbox shares some functions and\n * properties with the context menu.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldDropdown');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Field, FieldConfig, FieldValidator, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport * as style from './utils/style.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as utilsString from './utils/string.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an editable dropdown field.\n */\nexport class FieldDropdown extends Field<string> {\n  /** Horizontal distance that a checkmark overhangs the dropdown. */\n  static CHECKMARK_OVERHANG = 25;\n\n  /**\n   * Maximum height of the dropdown menu, as a percentage of the viewport\n   * height.\n   */\n  static MAX_MENU_HEIGHT_VH = 0.45;\n\n  static ARROW_CHAR = '';\n\n  /** A reference to the currently selected menu item. */\n  private selectedMenuItem_: MenuItem|null = null;\n\n  /** The dropdown menu. */\n  protected menu_: Menu|null = null;\n\n  /**\n   * SVG image element if currently selected option is an image, or null.\n   */\n  private imageElement_: SVGImageElement|null = null;\n\n  /** Tspan based arrow element. */\n  private arrow_: SVGTSpanElement|null = null;\n\n  /** SVG based arrow element. */\n  private svgArrow_: SVGElement|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  protected menuGenerator_?: MenuGenerator;\n\n  /** A cache of the most recently generated options. */\n  private generatedOptions_: MenuOption[]|null = null;\n\n  /**\n   * The prefix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override prefixField: string|null = null;\n\n  /**\n   * The suffix field label, of common words set after options are trimmed.\n   *\n   * @internal\n   */\n  override suffixField: string|null = null;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  private selectedOption_!: MenuOption;\n  override clickTarget_: SVGElement|null = null;\n\n  /**\n   * @param menuGenerator A non-empty array of options for a dropdown list, or a\n   *     function which generates these options. Also accepts Field.SKIP_SETUP\n   *     if you wish to skip setup (only used by subclasses that want to handle\n   *     configuration and setting the field value after their own constructors\n   *     have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a language-neutral dropdown option & returns a\n   *     validated language-neutral dropdown option, or null to abort the\n   *     change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/dropdown#creation}\n   * for a list of properties this parameter supports.\n   * @throws {TypeError} If `menuGenerator` options are incorrectly structured.\n   */\n  constructor(\n      menuGenerator: MenuGenerator,\n      validator?: FieldDropdownValidator,\n      config?: FieldDropdownConfig,\n  );\n  constructor(menuGenerator: typeof Field.SKIP_SETUP);\n  constructor(\n      menuGenerator: MenuGenerator|typeof Field.SKIP_SETUP,\n      validator?: FieldDropdownValidator,\n      config?: FieldDropdownConfig,\n  ) {\n    super(Field.SKIP_SETUP);\n\n    // If we pass SKIP_SETUP, don't do *anything* with the menu generator.\n    if (menuGenerator === Field.SKIP_SETUP) return;\n\n    if (Array.isArray(menuGenerator)) {\n      validateOptions(menuGenerator);\n      const trimmed = trimOptions(menuGenerator);\n      this.menuGenerator_ = trimmed.options;\n      this.prefixField = trimmed.prefix || null;\n      this.suffixField = trimmed.suffix || null;\n    } else {\n      this.menuGenerator_ = menuGenerator;\n    }\n\n    /**\n     * The currently selected option. The field is initialized with the\n     * first option selected.\n     */\n    this.selectedOption_ = this.getOptions(false)[0];\n\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(this.selectedOption_[1]);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(fieldElement.textContent);\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state to apply to the dropdown field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(FieldDropdown, state)) {\n      return;\n    }\n    if (this.isOptionListDynamic()) {\n      this.getOptions(false);\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this dropdown.\n   *\n   * @internal\n   */\n  override initView() {\n    if (this.shouldAddBorderRect_()) {\n      this.createBorderRect_();\n    } else {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    }\n    this.createTextElement_();\n\n    this.imageElement_ = dom.createSvgElement(Svg.IMAGE, {}, this.fieldGroup_);\n\n    if (this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW) {\n      this.createSVGArrow_();\n    } else {\n      this.createTextArrow_();\n    }\n\n    if (this.borderRect_) {\n      dom.addClass(this.borderRect_, 'blocklyDropdownRect');\n    }\n  }\n\n  /**\n   * Whether or not the dropdown should add a border rect.\n   *\n   * @returns True if the dropdown field should add a border rect.\n   */\n  protected shouldAddBorderRect_(): boolean {\n    return !this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n        this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW &&\n        !this.getSourceBlock()?.isShadow();\n  }\n\n  /** Create a tspan based arrow. */\n  protected createTextArrow_() {\n    this.arrow_ = dom.createSvgElement(Svg.TSPAN, {}, this.textElement_);\n    this.arrow_!.appendChild(document.createTextNode(\n        this.getSourceBlock()?.RTL ? FieldDropdown.ARROW_CHAR + ' ' :\n                                     ' ' + FieldDropdown.ARROW_CHAR));\n    if (this.getSourceBlock()?.RTL) {\n      this.getTextElement().insertBefore(this.arrow_, this.textContent_);\n    } else {\n      this.getTextElement().appendChild(this.arrow_);\n    }\n  }\n\n  /** Create an SVG based arrow. */\n  protected createSVGArrow_() {\n    this.svgArrow_ = dom.createSvgElement(\n        Svg.IMAGE, {\n          'height': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n          'width': this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE + 'px',\n        },\n        this.fieldGroup_);\n    this.svgArrow_!.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_DATAURI);\n  }\n\n  /**\n   * Create a dropdown menu under the text.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected override showEditor_(e?: MouseEvent) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.dropdownCreate_();\n    if (e && typeof e.clientX === 'number') {\n      this.menu_!.openingCoords = new Coordinate(e.clientX, e.clientY);\n    } else {\n      this.menu_!.openingCoords = null;\n    }\n\n    // Remove any pre-existing elements in the dropdown.\n    dropDownDiv.clearContent();\n    // Element gets created in render.\n    const menuElement = this.menu_!.render(dropDownDiv.getContentDiv());\n    dom.addClass(menuElement, 'blocklyDropdownMenu');\n\n    if (this.getConstants()!.FIELD_DROPDOWN_COLOURED_DIV) {\n      const primaryColour =\n          block.isShadow() ? block.getParent()!.getColour() : block.getColour();\n      const borderColour = block.isShadow() ?\n          (block.getParent() as BlockSvg).style.colourTertiary :\n          (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      dropDownDiv.setColour(primaryColour, borderColour);\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose_.bind(this));\n\n    // Focusing needs to be handled after the menu is rendered and positioned.\n    // Otherwise it will cause a page scroll to get the misplaced menu in\n    // view. See issue #1329.\n    this.menu_!.focus();\n\n    if (this.selectedMenuItem_) {\n      this.menu_!.setHighlighted(this.selectedMenuItem_);\n      style.scrollIntoContainerView(\n          this.selectedMenuItem_.getElement()!, dropDownDiv.getContentDiv(),\n          true);\n    }\n\n    this.applyColour();\n  }\n\n  /** Create the dropdown editor. */\n  private dropdownCreate_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const menu = new Menu();\n    menu.setRole(aria.Role.LISTBOX);\n    this.menu_ = menu;\n\n    const options = this.getOptions(false);\n    this.selectedMenuItem_ = null;\n    for (let i = 0; i < options.length; i++) {\n      const [label, value] = options[i];\n      const content = (() => {\n        if (typeof label === 'object') {\n          // Convert ImageProperties to an HTMLImageElement.\n          const image = new Image(label['width'], label['height']);\n          image.src = label['src'];\n          image.alt = label['alt'] || '';\n          return image;\n        }\n        return label;\n      })();\n      const menuItem = new MenuItem(content, value);\n      menuItem.setRole(aria.Role.OPTION);\n      menuItem.setRightToLeft(block.RTL);\n      menuItem.setCheckable(true);\n      menu.addChild(menuItem);\n      menuItem.setChecked(value === this.value_);\n      if (value === this.value_) {\n        this.selectedMenuItem_ = menuItem;\n      }\n      menuItem.onAction(this.handleMenuActionEvent_, this);\n    }\n  }\n\n  /**\n   * Disposes of events and DOM-references belonging to the dropdown editor.\n   */\n  protected dropdownDispose_() {\n    if (this.menu_) {\n      this.menu_.dispose();\n    }\n    this.menu_ = null;\n    this.selectedMenuItem_ = null;\n    this.applyColour();\n  }\n\n  /**\n   * Handle an action in the dropdown menu.\n   *\n   * @param menuItem The MenuItem selected within menu.\n   */\n  private handleMenuActionEvent_(menuItem: MenuItem) {\n    dropDownDiv.hideIfOwner(this, true);\n    this.onItemSelected_(this.menu_ as Menu, menuItem);\n  }\n\n  /**\n   * Handle the selection of an item in the dropdown menu.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    this.setValue(menuItem.getValue());\n  }\n\n  /**\n   * @returns True if the option list is generated by a function.\n   *     Otherwise false.\n   */\n  isOptionListDynamic(): boolean {\n    return typeof this.menuGenerator_ === 'function';\n  }\n\n  /**\n   * Return a list of the options for this dropdown.\n   *\n   * @param useCache For dynamic options, whether or not to use the cached\n   *     options or to re-generate them.\n   * @returns A non-empty array of option tuples:\n   *     (human-readable text or image, language-neutral name).\n   * @throws {TypeError} If generated options are incorrectly structured.\n   */\n  getOptions(useCache?: boolean): MenuOption[] {\n    if (!this.menuGenerator_) {\n      // A subclass improperly skipped setup without defining the menu\n      // generator.\n      throw TypeError('A menu generator was never defined.');\n    }\n    if (Array.isArray(this.menuGenerator_)) return this.menuGenerator_;\n    if (useCache && this.generatedOptions_) return this.generatedOptions_;\n\n    this.generatedOptions_ = this.menuGenerator_();\n    validateOptions(this.generatedOptions_);\n    return this.generatedOptions_;\n  }\n\n  /**\n   * Ensure that the input value is a valid language-neutral option.\n   *\n   * @param newValue The input value.\n   * @returns A valid language-neutral option, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: string): string|null {\n    const options = this.getOptions(true);\n    const isValueValid = options.some((option) => option[1] === newValue);\n\n    if (!isValueValid) {\n      if (this.sourceBlock_) {\n        console.warn(\n            'Cannot set the dropdown\\'s value to an unavailable option.' +\n            ' Block type: ' + this.sourceBlock_.type +\n            ', Field name: ' + this.name + ', Value: ' + newValue);\n      }\n      return null;\n    }\n    return newValue as string;\n  }\n\n  /**\n   * Update the value of this dropdown field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is one of the valid dropdown options.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    super.doValueUpdate_(newValue);\n    const options = this.getOptions(true);\n    for (let i = 0, option; option = options[i]; i++) {\n      if (option[1] === this.value_) {\n        this.selectedOption_ = option;\n      }\n    }\n  }\n\n  /**\n   * Updates the dropdown arrow to match the colour/style of the block.\n   *\n   * @internal\n   */\n  override applyColour() {\n    const style = (this.sourceBlock_ as BlockSvg).style;\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', style.colourTertiary);\n      if (this.menu_) {\n        this.borderRect_.setAttribute('fill', style.colourTertiary);\n      } else {\n        this.borderRect_.setAttribute('fill', 'transparent');\n      }\n    }\n    // Update arrow's colour.\n    if (this.sourceBlock_ && this.arrow_) {\n      if (this.sourceBlock_.isShadow()) {\n        this.arrow_.style.fill = style.colourSecondary;\n      } else {\n        this.arrow_.style.fill = style.colourPrimary;\n      }\n    }\n  }\n\n  /** Draws the border with the correct width. */\n  protected override render_() {\n    // Hide both elements.\n    this.getTextContent().nodeValue = '';\n    this.imageElement_!.style.display = 'none';\n\n    // Show correct element.\n    const option = this.selectedOption_ && this.selectedOption_[0];\n    if (option && typeof option === 'object') {\n      this.renderSelectedImage_(option);\n    } else {\n      this.renderSelectedText_();\n    }\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Renders the selected option, which must be an image.\n   *\n   * @param imageJson Selected option that must be an image.\n   */\n  private renderSelectedImage_(imageJson: ImageProperties) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.imageElement_!.style.display = '';\n    this.imageElement_!.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href', imageJson.src);\n    this.imageElement_!.setAttribute('height', String(imageJson.height));\n    this.imageElement_!.setAttribute('width', String(imageJson.width));\n\n    const imageHeight = Number(imageJson.height);\n    const imageWidth = Number(imageJson.width);\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n        hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n        imageHeight + IMAGE_Y_PADDING);\n    const xPadding =\n        hasBorder ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow_) {\n      arrowWidth = this.positionSVGArrow_(\n          imageWidth + xPadding,\n          height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2);\n    } else {\n      arrowWidth = dom.getFastTextWidth(\n          this.arrow_ as SVGTSpanElement,\n          this.getConstants()!.FIELD_TEXT_FONTSIZE,\n          this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n          this.getConstants()!.FIELD_TEXT_FONTFAMILY);\n    }\n    this.size_.width = imageWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    let arrowX = 0;\n    if (block.RTL) {\n      const imageX = xPadding + arrowWidth;\n      this.imageElement_!.setAttribute('x', `${imageX}`);\n    } else {\n      arrowX = imageWidth + arrowWidth;\n      this.getTextElement().setAttribute('text-anchor', 'end');\n      this.imageElement_!.setAttribute('x', `${xPadding}`);\n    }\n    this.imageElement_!.setAttribute('y', String(height / 2 - imageHeight / 2));\n\n    this.positionTextElement_(arrowX + xPadding, imageWidth + arrowWidth);\n  }\n\n  /** Renders the selected option, which must be text. */\n  private renderSelectedText_() {\n    // Retrieves the selected option to display through getText_.\n    this.getTextContent().nodeValue = this.getDisplayText_();\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyDropdownText');\n    textElement.setAttribute('text-anchor', 'start');\n\n    // Height and width include the border rect.\n    const hasBorder = !!this.borderRect_;\n    const height = Math.max(\n        hasBorder ? this.getConstants()!.FIELD_DROPDOWN_BORDER_RECT_HEIGHT : 0,\n        this.getConstants()!.FIELD_TEXT_HEIGHT);\n    const textWidth = dom.getFastTextWidth(\n        this.getTextElement(), this.getConstants()!.FIELD_TEXT_FONTSIZE,\n        this.getConstants()!.FIELD_TEXT_FONTWEIGHT,\n        this.getConstants()!.FIELD_TEXT_FONTFAMILY);\n    const xPadding =\n        hasBorder ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING : 0;\n    let arrowWidth = 0;\n    if (this.svgArrow_) {\n      arrowWidth = this.positionSVGArrow_(\n          textWidth + xPadding,\n          height / 2 - this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE / 2);\n    }\n    this.size_.width = textWidth + arrowWidth + xPadding * 2;\n    this.size_.height = height;\n\n    this.positionTextElement_(xPadding, textWidth);\n  }\n\n  /**\n   * Position a drop-down arrow at the appropriate location at render-time.\n   *\n   * @param x X position the arrow is being rendered at, in px.\n   * @param y Y position the arrow is being rendered at, in px.\n   * @returns Amount of space the arrow is taking up, in px.\n   */\n  private positionSVGArrow_(x: number, y: number): number {\n    if (!this.svgArrow_) {\n      return 0;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const hasBorder = !!this.borderRect_;\n    const xPadding =\n        hasBorder ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING : 0;\n    const textPadding = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_PADDING;\n    const svgArrowSize = this.getConstants()!.FIELD_DROPDOWN_SVG_ARROW_SIZE;\n    const arrowX = block.RTL ? xPadding : x + textPadding;\n    this.svgArrow_.setAttribute(\n        'transform', 'translate(' + arrowX + ',' + y + ')');\n    return svgArrowSize + textPadding;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.  Get the selected option text.  If the selected option is\n   * an image we return the image alt text.\n   *\n   * @returns Selected option text.\n   */\n  protected override getText_(): string|null {\n    if (!this.selectedOption_) {\n      return null;\n    }\n    const option = this.selectedOption_[0];\n    if (typeof option === 'object') {\n      return option['alt'];\n    }\n    return option;\n  }\n\n  /**\n   * Construct a FieldDropdown from a JSON arg object.\n   *\n   * @param options A JSON object with options (options).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldDropdownFromJsonConfig): FieldDropdown {\n    if (!options.options) {\n      throw new Error(\n          'options are required for the dropdown field. The ' +\n          'options property must be assigned an array of ' +\n          '[humanReadableValue, languageNeutralValue] tuples.');\n    }\n    // `this` might be a subclass of FieldDropdown if that class doesn't\n    // override the static fromJson method.\n    return new this(options.options, undefined, options);\n  }\n}\n\n/**\n * Definition of a human-readable image dropdown option.\n */\nexport interface ImageProperties {\n  src: string;\n  alt: string;\n  width: number;\n  height: number;\n}\n\n/**\n * An individual option in the dropdown menu. The first element is the human-\n * readable value (text or image), and the second element is the language-\n * neutral value.\n */\nexport type MenuOption = [string | ImageProperties, string];\n\n/**\n * A function that generates an array of menu options for FieldDropdown\n * or its descendants.\n */\nexport type MenuGeneratorFunction = (this: FieldDropdown) => MenuOption[];\n\n/**\n * Either an array of menu options or a function that generates an array of\n * menu options for FieldDropdown or its descendants.\n */\nexport type MenuGenerator = MenuOption[]|MenuGeneratorFunction;\n\n/**\n * Config options for the dropdown field.\n */\nexport type FieldDropdownConfig = FieldConfig;\n\n/**\n * fromJson config for the dropdown field.\n */\nexport interface FieldDropdownFromJsonConfig extends FieldDropdownConfig {\n  options?: MenuOption[];\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldDropdownValidator = FieldValidator<string>;\n\n/**\n * The y offset from the top of the field to the top of the image, if an image\n * is selected.\n */\nconst IMAGE_Y_OFFSET = 5;\n\n/** The total vertical padding above and below an image. */\nconst IMAGE_Y_PADDING: number = IMAGE_Y_OFFSET * 2;\n\n/**\n * Factor out common words in statically defined options.\n * Create prefix and/or suffix labels.\n */\nfunction trimOptions(options: MenuOption[]):\n    {options: MenuOption[]; prefix?: string; suffix?: string;} {\n  let hasImages = false;\n  const trimmedOptions = options.map(([label, value]): MenuOption => {\n    if (typeof label === 'string') {\n      return [parsing.replaceMessageReferences(label), value];\n    }\n\n    hasImages = true;\n    // Copy the image properties so they're not influenced by the original.\n    // NOTE: No need to deep copy since image properties are only 1 level deep.\n    const imageLabel = label.alt !== null ?\n        {...label, alt: parsing.replaceMessageReferences(label.alt)} :\n        {...label};\n    return [imageLabel, value];\n  });\n\n  if (hasImages || options.length < 2) return {options: trimmedOptions};\n\n  const stringOptions = trimmedOptions as [string, string][];\n  const stringLabels = stringOptions.map(([label]) => label);\n\n  const shortest = utilsString.shortestStringLength(stringLabels);\n  const prefixLength = utilsString.commonWordPrefix(stringLabels, shortest);\n  const suffixLength = utilsString.commonWordSuffix(stringLabels, shortest);\n\n  if ((!prefixLength && !suffixLength) ||\n      (shortest <= prefixLength + suffixLength)) {\n    // One or more strings will entirely vanish if we proceed.  Abort.\n    return {options: stringOptions};\n  }\n\n  const prefix =\n      prefixLength ? stringLabels[0].substring(0, prefixLength - 1) : undefined;\n  const suffix =\n      suffixLength ? stringLabels[0].substr(1 - suffixLength) : undefined;\n  return {\n    options: applyTrim(stringOptions, prefixLength, suffixLength),\n    prefix,\n    suffix,\n  };\n}\n\n/**\n * Use the calculated prefix and suffix lengths to trim all of the options in\n * the given array.\n *\n * @param options Array of option tuples:\n *     (human-readable text or image, language-neutral name).\n * @param prefixLength The length of the common prefix.\n * @param suffixLength The length of the common suffix\n * @returns A new array with all of the option text trimmed.\n */\nfunction applyTrim(\n    options: [string, string][], prefixLength: number,\n    suffixLength: number): MenuOption[] {\n  return options.map(\n      ([text, value]) =>\n          [text.substring(prefixLength, text.length - suffixLength),\n           value,\n  ]);\n}\n\n/**\n * Validates the data structure to be processed as an options list.\n *\n * @param options The proposed dropdown options.\n * @throws {TypeError} If proposed options are incorrectly structured.\n */\nfunction validateOptions(options: MenuOption[]) {\n  if (!Array.isArray(options)) {\n    throw TypeError('FieldDropdown options must be an array.');\n  }\n  if (!options.length) {\n    throw TypeError('FieldDropdown options must not be an empty array.');\n  }\n  let foundError = false;\n  for (let i = 0; i < options.length; i++) {\n    const tuple = options[i];\n    if (!Array.isArray(tuple)) {\n      foundError = true;\n      console.error(\n          'Invalid option[' + i + ']: Each FieldDropdown option must be an ' +\n              'array. Found: ',\n          tuple);\n    } else if (typeof tuple[1] !== 'string') {\n      foundError = true;\n      console.error(\n          'Invalid option[' + i + ']: Each FieldDropdown option id must be ' +\n              'a string. Found ' + tuple[1] + ' in: ',\n          tuple);\n    } else if (\n        tuple[0] && typeof tuple[0] !== 'string' &&\n        typeof tuple[0].src !== 'string') {\n      foundError = true;\n      console.error(\n          'Invalid option[' + i + ']: Each FieldDropdown option must have a ' +\n              'string label or image description. Found' + tuple[0] + ' in: ',\n          tuple);\n    }\n  }\n  if (foundError) {\n    throw TypeError('Found invalid FieldDropdown options.');\n  }\n}\n\nfieldRegistry.register('field_dropdown', FieldDropdown);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.object');\n\nimport * as deprecation from './deprecation.js';\n\n\n/**\n * Inherit the prototype methods from one constructor into another.\n *\n * @param childCtor Child class.\n * @param parentCtor Parent class.\n * @suppress {strictMissingProperties} superClass_ is not defined on Function.\n * @deprecated No longer provided by Blockly.\n */\nexport function inherits(childCtor: Function, parentCtor: Function) {\n  deprecation.warn('Blockly.utils.object.inherits', 'version 9', 'version 10');\n  // Set a .superClass_ property so that methods can call parent methods\n  // without hard-coding the parent class name.\n  // Could be replaced by ES6's super().\n  // AnyDuringMigration because:  Property 'superClass_' does not exist on type\n  // 'Function'.\n  (childCtor as AnyDuringMigration).superClass_ = parentCtor.prototype;\n\n  // Link the child class to the parent class so that static methods inherit.\n  Object.setPrototypeOf(childCtor, parentCtor);\n\n  // Replace the child constructor's prototype object with an instance\n  // of the parent class.\n  childCtor.prototype = Object.create(parentCtor.prototype);\n  childCtor.prototype.constructor = childCtor;\n}\n// Alternatively, one could use this instead:\n// Object.setPrototypeOf(childCtor.prototype, parentCtor.prototype);\n\n/**\n * Copies all the members of a source object to a target object.\n *\n * @param target Target.\n * @param source Source.\n * @deprecated Use the built-in **Object.assign** instead.\n */\nexport function mixin(target: AnyDuringMigration, source: AnyDuringMigration) {\n  deprecation.warn(\n      'Blockly.utils.object.mixin', 'May 2022', 'May 2023', 'Object.assign');\n  for (const x in source) {\n    target[x] = source[x];\n  }\n}\n\n/**\n * Complete a deep merge of all members of a source object with a target object.\n *\n * @param target Target.\n * @param source Source.\n * @returns The resulting object.\n */\nexport function deepMerge(\n    target: AnyDuringMigration,\n    source: AnyDuringMigration): AnyDuringMigration {\n  for (const x in source) {\n    if (source[x] !== null && typeof source[x] === 'object') {\n      target[x] = deepMerge(target[x] || Object.create(null), source[x]);\n    } else {\n      target[x] = source[x];\n    }\n  }\n  return target;\n}\n\n/**\n * Returns an array of a given object's own enumerable property values.\n *\n * @param obj Object containing values.\n * @returns Array of values.\n * @deprecated Use the built-in **Object.values** instead.\n */\nexport function values(obj: AnyDuringMigration): AnyDuringMigration[] {\n  deprecation.warn(\n      'Blockly.utils.object.values', 'version 9', 'version 10',\n      'Object.values');\n  return Object.values(obj);\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.toolbox');\n\nimport type {ConnectionState} from '../serialization/blocks.js';\nimport type {CssConfig as CategoryCssConfig} from '../toolbox/category.js';\nimport type {CssConfig as SeparatorCssConfig} from '../toolbox/separator.js';\nimport * as utilsXml from './xml.js';\n\n\n/**\n * The information needed to create a block in the toolbox.\n * Note that disabled has a different type for backwards compatibility.\n */\nexport interface BlockInfo {\n  kind: string;\n  blockxml?: string|Node;\n  type?: string;\n  gap?: string|number;\n  disabled?: string|boolean;\n  enabled?: boolean;\n  id?: string;\n  x?: number;\n  y?: number;\n  collapsed?: boolean;\n  inline?: boolean;\n  data?: string;\n  extraState?: AnyDuringMigration;\n  icons?: {[key: string]: AnyDuringMigration};\n  fields?: {[key: string]: AnyDuringMigration};\n  inputs?: {[key: string]: ConnectionState};\n  next?: ConnectionState;\n}\n\n/**\n * The information needed to create a separator in the toolbox.\n */\nexport interface SeparatorInfo {\n  kind: string;\n  id: string|undefined;\n  gap: number|undefined;\n  cssconfig: SeparatorCssConfig|undefined;\n}\n\n/**\n * The information needed to create a button in the toolbox.\n */\nexport interface ButtonInfo {\n  kind: string;\n  text: string;\n  callbackkey: string;\n}\n\n/**\n * The information needed to create a label in the toolbox.\n */\nexport interface LabelInfo {\n  kind: string;\n  text: string;\n  id: string|undefined;\n}\n\n/**\n * The information needed to create either a button or a label in the flyout.\n */\nexport type ButtonOrLabelInfo = ButtonInfo|LabelInfo;\n\n/**\n * The information needed to create a category in the toolbox.\n */\nexport interface StaticCategoryInfo {\n  kind: string;\n  name: string;\n  contents: ToolboxItemInfo[];\n  id: string|undefined;\n  categorystyle: string|undefined;\n  colour: string|undefined;\n  cssconfig: CategoryCssConfig|undefined;\n  hidden: string|undefined;\n  expanded?: string|boolean;\n}\n\n/**\n * The information needed to create a custom category.\n */\nexport interface DynamicCategoryInfo {\n  kind: string;\n  custom: string;\n  id: string|undefined;\n  categorystyle: string|undefined;\n  colour: string|undefined;\n  cssconfig: CategoryCssConfig|undefined;\n  hidden: string|undefined;\n  expanded?: string|boolean;\n}\n\n/**\n * The information needed to create either a dynamic or static category.\n */\nexport type CategoryInfo = StaticCategoryInfo|DynamicCategoryInfo;\n\n/**\n * Any information that can be used to create an item in the toolbox.\n */\nexport type ToolboxItemInfo = FlyoutItemInfo|StaticCategoryInfo;\n\n/**\n * All the different types that can be displayed in a flyout.\n */\nexport type FlyoutItemInfo =\n    BlockInfo|SeparatorInfo|ButtonInfo|LabelInfo|DynamicCategoryInfo;\n\n/**\n * The JSON definition of a toolbox.\n */\nexport interface ToolboxInfo {\n  kind?: string;\n  contents: ToolboxItemInfo[];\n}\n\n/**\n * An array holding flyout items.\n */\nexport type FlyoutItemInfoArray = FlyoutItemInfo[];\n\n/**\n * All of the different types that can create a toolbox.\n */\nexport type ToolboxDefinition = Node|ToolboxInfo|string;\n\n/**\n * All of the different types that can be used to show items in a flyout.\n */\nexport type FlyoutDefinition = FlyoutItemInfoArray|NodeList|ToolboxInfo|Node[];\n\n/**\n * The name used to identify a toolbox that has category like items.\n * This only needs to be used if a toolbox wants to be treated like a category\n * toolbox but does not actually contain any toolbox items with the kind\n * 'category'.\n */\nconst CATEGORY_TOOLBOX_KIND = 'categoryToolbox';\n\n/**\n * The name used to identify a toolbox that has no categories and is displayed\n * as a simple flyout displaying blocks, buttons, or labels.\n */\nconst FLYOUT_TOOLBOX_KIND = 'flyoutToolbox';\n\n/**\n * Position of the toolbox and/or flyout relative to the workspace.\n */\nexport enum Position {\n  TOP,\n  BOTTOM,\n  LEFT,\n  RIGHT\n}\n\n/**\n * Converts the toolbox definition into toolbox JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n * @internal\n */\nexport function convertToolboxDefToJson(toolboxDef: ToolboxDefinition|\n                                        null): ToolboxInfo|null {\n  if (!toolboxDef) {\n    return null;\n  }\n\n  if (toolboxDef instanceof Element || typeof toolboxDef === 'string') {\n    toolboxDef = parseToolboxTree(toolboxDef);\n    // AnyDuringMigration because:  Argument of type 'Node | null' is not\n    // assignable to parameter of type 'Node'.\n    toolboxDef = convertToToolboxJson(toolboxDef as AnyDuringMigration);\n  }\n\n  const toolboxJson = toolboxDef as ToolboxInfo;\n  validateToolbox(toolboxJson);\n  return toolboxJson;\n}\n\n/**\n * Validates the toolbox JSON fields have been set correctly.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @throws {Error} if the toolbox is not the correct format.\n */\nfunction validateToolbox(toolboxJson: ToolboxInfo) {\n  const toolboxKind = toolboxJson['kind'];\n  const toolboxContents = toolboxJson['contents'];\n\n  if (toolboxKind) {\n    if (toolboxKind !== FLYOUT_TOOLBOX_KIND &&\n        toolboxKind !== CATEGORY_TOOLBOX_KIND) {\n      throw Error(\n          'Invalid toolbox kind ' + toolboxKind + '.' +\n          ' Please supply either ' + FLYOUT_TOOLBOX_KIND + ' or ' +\n          CATEGORY_TOOLBOX_KIND);\n    }\n  }\n  if (!toolboxContents) {\n    throw Error('Toolbox must have a contents attribute.');\n  }\n}\n\n/**\n * Converts the flyout definition into a list of flyout items.\n *\n * @param flyoutDef The definition of the flyout in one of its many forms.\n * @returns A list of flyout items.\n * @internal\n */\nexport function convertFlyoutDefToJsonArray(flyoutDef: FlyoutDefinition|\n                                            null): FlyoutItemInfoArray {\n  if (!flyoutDef) {\n    return [];\n  }\n\n  if ((flyoutDef as AnyDuringMigration)['contents']) {\n    return (flyoutDef as AnyDuringMigration)['contents'];\n  }\n  // If it is already in the correct format return the flyoutDef.\n  // AnyDuringMigration because:  Property 'nodeType' does not exist on type\n  // 'Node | FlyoutItemInfo'.\n  if (Array.isArray(flyoutDef) && flyoutDef.length > 0 &&\n      !((flyoutDef[0]) as AnyDuringMigration).nodeType) {\n    // AnyDuringMigration because:  Type 'FlyoutItemInfoArray | Node[]' is not\n    // assignable to type 'FlyoutItemInfoArray'.\n    return flyoutDef as AnyDuringMigration;\n  }\n\n  // AnyDuringMigration because:  Type 'ToolboxItemInfo[] | FlyoutItemInfoArray'\n  // is not assignable to type 'FlyoutItemInfoArray'.\n  return xmlToJsonArray(flyoutDef as Node[] | NodeList) as AnyDuringMigration;\n}\n\n/**\n * Whether or not the toolbox definition has categories.\n *\n * @param toolboxJson Object holding information for creating a toolbox.\n * @returns True if the toolbox has categories.\n * @internal\n */\nexport function hasCategories(toolboxJson: ToolboxInfo|null): boolean {\n  return TEST_ONLY.hasCategoriesInternal(toolboxJson);\n}\n\n/**\n * Private version of hasCategories for stubbing in tests.\n */\nfunction hasCategoriesInternal(toolboxJson: ToolboxInfo|null): boolean {\n  if (!toolboxJson) {\n    return false;\n  }\n\n  const toolboxKind = toolboxJson['kind'];\n  if (toolboxKind) {\n    return toolboxKind === CATEGORY_TOOLBOX_KIND;\n  }\n\n  const categories = toolboxJson['contents'].filter(function(item) {\n    return item['kind'].toUpperCase() === 'CATEGORY';\n  });\n  return !!categories.length;\n}\n\n/**\n * Whether or not the category is collapsible.\n *\n * @param categoryInfo Object holing information for creating a category.\n * @returns True if the category has subcategories.\n * @internal\n */\nexport function isCategoryCollapsible(categoryInfo: CategoryInfo): boolean {\n  if (!categoryInfo || !(categoryInfo as AnyDuringMigration)['contents']) {\n    return false;\n  }\n\n  const categories =\n      (categoryInfo as AnyDuringMigration)['contents'].filter(function(\n          item: AnyDuringMigration) {\n        return item['kind'].toUpperCase() === 'CATEGORY';\n      });\n  return !!categories.length;\n}\n\n/**\n * Parses the provided toolbox definition into a consistent format.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns Object holding information for creating a toolbox.\n */\nfunction convertToToolboxJson(toolboxDef: Node): ToolboxInfo {\n  const contents = xmlToJsonArray(toolboxDef as Node | Node[]);\n  const toolboxJson = {'contents': contents};\n  if (toolboxDef instanceof Node) {\n    addAttributes(toolboxDef, toolboxJson);\n  }\n  return toolboxJson;\n}\n\n/**\n * Converts the xml for a toolbox to JSON.\n *\n * @param toolboxDef The definition of the toolbox in one of its many forms.\n * @returns A list of objects in the toolbox.\n */\nfunction xmlToJsonArray(toolboxDef: Node|Node[]|NodeList): FlyoutItemInfoArray|\n    ToolboxItemInfo[] {\n  const arr = [];\n  // If it is a node it will have children.\n  // AnyDuringMigration because:  Property 'childNodes' does not exist on type\n  // 'Node | NodeList | Node[]'.\n  let childNodes = (toolboxDef as AnyDuringMigration).childNodes;\n  if (!childNodes) {\n    // Otherwise the toolboxDef is an array or collection.\n    childNodes = toolboxDef;\n  }\n  for (let i = 0, child; child = childNodes[i]; i++) {\n    if (!child.tagName) {\n      continue;\n    }\n    const obj = {};\n    const tagName = child.tagName.toUpperCase();\n    (obj as AnyDuringMigration)['kind'] = tagName;\n\n    // Store the XML for a block.\n    if (tagName === 'BLOCK') {\n      (obj as AnyDuringMigration)['blockxml'] = child;\n    } else if (child.childNodes && child.childNodes.length > 0) {\n      // Get the contents of a category\n      (obj as AnyDuringMigration)['contents'] = xmlToJsonArray(child);\n    }\n\n    // Add XML attributes to object\n    addAttributes(child, obj);\n    arr.push(obj);\n  }\n  // AnyDuringMigration because:  Type '{}[]' is not assignable to type\n  // 'ToolboxItemInfo[] | FlyoutItemInfoArray'.\n  return arr as AnyDuringMigration;\n}\n\n/**\n * Adds the attributes on the node to the given object.\n *\n * @param node The node to copy the attributes from.\n * @param obj The object to copy the attributes to.\n */\nfunction addAttributes(node: Node, obj: AnyDuringMigration) {\n  // AnyDuringMigration because:  Property 'attributes' does not exist on type\n  // 'Node'.\n  for (let j = 0; j < (node as AnyDuringMigration).attributes.length; j++) {\n    // AnyDuringMigration because:  Property 'attributes' does not exist on type\n    // 'Node'.\n    const attr = (node as AnyDuringMigration).attributes[j];\n    if (attr.nodeName.indexOf('css-') > -1) {\n      obj['cssconfig'] = obj['cssconfig'] || {};\n      obj['cssconfig'][attr.nodeName.replace('css-', '')] = attr.value;\n    } else {\n      obj[attr.nodeName] = attr.value;\n    }\n  }\n}\n\n/**\n * Parse the provided toolbox tree into a consistent DOM format.\n *\n * @param toolboxDef DOM tree of blocks, or text representation of same.\n * @returns DOM tree of blocks, or null.\n */\nexport function parseToolboxTree(toolboxDef: Element|null|string): Element|\n    null {\n  let parsedToolboxDef: Element|null = null;\n  if (toolboxDef) {\n    if (typeof toolboxDef === 'string') {\n      parsedToolboxDef = utilsXml.textToDom(toolboxDef);\n      if (parsedToolboxDef.nodeName.toLowerCase() !== 'xml') {\n        throw TypeError('Toolbox should be an <xml> document.');\n      }\n    } else if (toolboxDef instanceof Element) {\n      parsedToolboxDef = toolboxDef;\n    }\n  }\n  return parsedToolboxDef;\n}\n\nexport const TEST_ONLY = {\n  hasCategoriesInternal,\n};\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Extensions');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {FieldDropdown} from './field_dropdown.js';\nimport {Mutator} from './mutator.js';\nimport * as parsing from './utils/parsing.js';\n\n\n/** The set of all registered extensions, keyed by extension name/id. */\nconst allExtensions = Object.create(null);\nexport const TEST_ONLY = {allExtensions};\n\n/**\n * Registers a new extension function. Extensions are functions that help\n * initialize blocks, usually adding dynamic behavior such as onchange\n * handlers and mutators. These are applied using Block.applyExtension(), or\n * the JSON \"extensions\" array attribute.\n *\n * @param name The name of this extension.\n * @param initFn The function to initialize an extended block.\n * @throws {Error} if the extension name is empty, the extension is already\n *     registered, or extensionFn is not a function.\n */\nexport function register(name: string, initFn: Function) {\n  if (typeof name !== 'string' || name.trim() === '') {\n    throw Error('Error: Invalid extension name \"' + name + '\"');\n  }\n  if (allExtensions[name]) {\n    throw Error('Error: Extension \"' + name + '\" is already registered.');\n  }\n  if (typeof initFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" must be a function');\n  }\n  allExtensions[name] = initFn;\n}\n\n/**\n * Registers a new extension function that adds all key/value of mixinObj.\n *\n * @param name The name of this extension.\n * @param mixinObj The values to mix in.\n * @throws {Error} if the extension name is empty or the extension is already\n *     registered.\n */\nexport function registerMixin(name: string, mixinObj: AnyDuringMigration) {\n  if (!mixinObj || typeof mixinObj !== 'object') {\n    throw Error('Error: Mixin \"' + name + '\" must be a object');\n  }\n  register(name, function(this: Block) {\n    this.mixin(mixinObj);\n  });\n}\n\n/**\n * Registers a new extension function that adds a mutator to the block.\n * At register time this performs some basic sanity checks on the mutator.\n * The wrapper may also add a mutator dialog to the block, if both compose and\n * decompose are defined on the mixin.\n *\n * @param name The name of this mutator extension.\n * @param mixinObj The values to mix in.\n * @param opt_helperFn An optional function to apply after mixing in the object.\n * @param opt_blockList A list of blocks to appear in the flyout of the mutator\n *     dialog.\n * @throws {Error} if the mutation is invalid or can't be applied to the block.\n */\nexport function registerMutator(\n    name: string, mixinObj: AnyDuringMigration,\n    opt_helperFn?: () => AnyDuringMigration, opt_blockList?: string[]) {\n  const errorPrefix = 'Error when registering mutator \"' + name + '\": ';\n\n  checkHasMutatorProperties(errorPrefix, mixinObj);\n  const hasMutatorDialog = checkMutatorDialog(mixinObj, errorPrefix);\n\n  if (opt_helperFn && typeof opt_helperFn !== 'function') {\n    throw Error(errorPrefix + 'Extension \"' + name + '\" is not a function');\n  }\n\n  // Sanity checks passed.\n  register(name, function(this: Block) {\n    if (hasMutatorDialog) {\n      this.setMutator(new Mutator(opt_blockList || [], this as BlockSvg));\n    }\n    // Mixin the object.\n    this.mixin(mixinObj);\n\n    if (opt_helperFn) {\n      opt_helperFn.apply(this);\n    }\n  });\n}\n\n/**\n * Unregisters the extension registered with the given name.\n *\n * @param name The name of the extension to unregister.\n */\nexport function unregister(name: string) {\n  if (isRegistered(name)) {\n    delete allExtensions[name];\n  } else {\n    console.warn(\n        'No extension mapping for name \"' + name + '\" found to unregister');\n  }\n}\n\n/**\n * Returns whether an extension is registered with the given name.\n *\n * @param name The name of the extension to check for.\n * @returns True if the extension is registered.  False if it is not registered.\n */\nexport function isRegistered(name: string): boolean {\n  return !!allExtensions[name];\n}\n\n/**\n * Applies an extension method to a block. This should only be called during\n * block construction.\n *\n * @param name The name of the extension.\n * @param block The block to apply the named extension to.\n * @param isMutator True if this extension defines a mutator.\n * @throws {Error} if the extension is not found.\n */\nexport function apply(name: string, block: Block, isMutator: boolean) {\n  const extensionFn = allExtensions[name];\n  if (typeof extensionFn !== 'function') {\n    throw Error('Error: Extension \"' + name + '\" not found.');\n  }\n  let mutatorProperties;\n  if (isMutator) {\n    // Fail early if the block already has mutation properties.\n    checkNoMutatorProperties(name, block);\n  } else {\n    // Record the old properties so we can make sure they don't change after\n    // applying the extension.\n    mutatorProperties = getMutatorProperties(block);\n  }\n  extensionFn.apply(block);\n\n  if (isMutator) {\n    const errorPrefix = 'Error after applying mutator \"' + name + '\": ';\n    checkHasMutatorProperties(errorPrefix, block);\n  } else {\n    if (!mutatorPropertiesMatch(\n            mutatorProperties as AnyDuringMigration[], block)) {\n      throw Error(\n          'Error when applying extension \"' + name + '\": ' +\n          'mutation properties changed when applying a non-mutator extension.');\n    }\n  }\n}\n\n/**\n * Check that the given block does not have any of the four mutator properties\n * defined on it.  This function should be called before applying a mutator\n * extension to a block, to make sure we are not overwriting properties.\n *\n * @param mutationName The name of the mutation to reference in error messages.\n * @param block The block to check.\n * @throws {Error} if any of the properties already exist on the block.\n */\nfunction checkNoMutatorProperties(mutationName: string, block: Block) {\n  const properties = getMutatorProperties(block);\n  if (properties.length) {\n    throw Error(\n        'Error: tried to apply mutation \"' + mutationName +\n        '\" to a block that already has mutator functions.' +\n        '  Block id: ' + block.id);\n  }\n}\n\n/**\n * Checks if the given object has both the 'mutationToDom' and 'domToMutation'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkXmlHooks(\n    object: AnyDuringMigration, errorPrefix: string): boolean {\n  return checkHasFunctionPair(\n      object.mutationToDom, object.domToMutation,\n      errorPrefix + ' mutationToDom/domToMutation');\n}\n/**\n * Checks if the given object has both the 'saveExtraState' and 'loadExtraState'\n * functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkJsonHooks(\n    object: AnyDuringMigration, errorPrefix: string): boolean {\n  return checkHasFunctionPair(\n      object.saveExtraState, object.loadExtraState,\n      errorPrefix + ' saveExtraState/loadExtraState');\n}\n\n/**\n * Checks if the given object has both the 'compose' and 'decompose' functions.\n *\n * @param object The object to check.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} if the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkMutatorDialog(\n    object: AnyDuringMigration, errorPrefix: string): boolean {\n  return checkHasFunctionPair(\n      object.compose, object.decompose, errorPrefix + ' compose/decompose');\n}\n\n/**\n * Checks that both or neither of the given functions exist and that they are\n * indeed functions.\n *\n * @param func1 The first function in the pair.\n * @param func2 The second function in the pair.\n * @param errorPrefix The string to prepend to any error message.\n * @returns True if the object has both functions.  False if it has neither\n *     function.\n * @throws {Error} If the object has only one of the functions, or either is not\n *     actually a function.\n */\nfunction checkHasFunctionPair(\n    func1: AnyDuringMigration, func2: AnyDuringMigration,\n    errorPrefix: string): boolean {\n  if (func1 && func2) {\n    if (typeof func1 !== 'function' || typeof func2 !== 'function') {\n      throw Error(errorPrefix + ' must be a function');\n    }\n    return true;\n  } else if (!func1 && !func2) {\n    return false;\n  }\n  throw Error(errorPrefix + 'Must have both or neither functions');\n}\n\n/**\n * Checks that the given object required mutator properties.\n *\n * @param errorPrefix The string to prepend to any error message.\n * @param object The object to inspect.\n */\nfunction checkHasMutatorProperties(\n    errorPrefix: string, object: AnyDuringMigration) {\n  const hasXmlHooks = checkXmlHooks(object, errorPrefix);\n  const hasJsonHooks = checkJsonHooks(object, errorPrefix);\n  if (!hasXmlHooks && !hasJsonHooks) {\n    throw Error(\n        errorPrefix +\n        'Mutations must contain either XML hooks, or JSON hooks, or both');\n  }\n  // A block with a mutator isn't required to have a mutation dialog, but\n  // it should still have both or neither of compose and decompose.\n  checkMutatorDialog(object, errorPrefix);\n}\n\n/**\n * Get a list of values of mutator properties on the given block.\n *\n * @param block The block to inspect.\n * @returns A list with all of the defined properties, which should be\n *     functions, but may be anything other than undefined.\n */\nfunction getMutatorProperties(block: Block): AnyDuringMigration[] {\n  const result = [];\n  // List each function explicitly by reference to allow for renaming\n  // during compilation.\n  if (block.domToMutation !== undefined) {\n    result.push(block.domToMutation);\n  }\n  if (block.mutationToDom !== undefined) {\n    result.push(block.mutationToDom);\n  }\n  if (block.saveExtraState !== undefined) {\n    result.push(block.saveExtraState);\n  }\n  if (block.loadExtraState !== undefined) {\n    result.push(block.loadExtraState);\n  }\n  if (block.compose !== undefined) {\n    result.push(block.compose);\n  }\n  if (block.decompose !== undefined) {\n    result.push(block.decompose);\n  }\n  return result;\n}\n\n/**\n * Check that the current mutator properties match a list of old mutator\n * properties.  This should be called after applying a non-mutator extension,\n * to verify that the extension didn't change properties it shouldn't.\n *\n * @param oldProperties The old values to compare to.\n * @param block The block to inspect for new values.\n * @returns True if the property lists match.\n */\nfunction mutatorPropertiesMatch(\n    oldProperties: AnyDuringMigration[], block: Block): boolean {\n  const newProperties = getMutatorProperties(block);\n  if (newProperties.length !== oldProperties.length) {\n    return false;\n  }\n  for (let i = 0; i < newProperties.length; i++) {\n    if (oldProperties[i] !== newProperties[i]) {\n      return false;\n    }\n  }\n  return true;\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @internal\n */\nexport function runAfterPageLoad(fn: () => void) {\n  if (typeof document !== 'object') {\n    throw Error('runAfterPageLoad() requires browser document.');\n  }\n  if (document.readyState === 'complete') {\n    fn();  // Page has already loaded. Call immediately.\n  } else {\n    // Poll readyState.\n    const readyStateCheckInterval = setInterval(function() {\n      if (document.readyState === 'complete') {\n        clearInterval(readyStateCheckInterval);\n        fn();\n      }\n    }, 10);\n  }\n}\n\n/**\n * Builds an extension function that will map a dropdown value to a tooltip\n * string.\n *\n * This method includes multiple checks to ensure tooltips, dropdown options,\n * and message references are aligned. This aims to catch errors as early as\n * possible, without requiring developers to manually test tooltips under each\n * option. After the page is loaded, each tooltip text string will be checked\n * for matching message keys in the internationalized string table. Deferring\n * this until the page is loaded decouples loading dependencies. Later, upon\n * loading the first block of any given type, the extension will validate every\n * dropdown option has a matching tooltip in the lookupTable.  Errors are\n * reported as warnings in the console, and are never fatal.\n *\n * @param dropdownName The name of the field whose value is the key to the\n *     lookup table.\n * @param lookupTable The table of field values to tooltip text.\n * @returns The extension function.\n */\nexport function buildTooltipForDropdown(\n    dropdownName: string, lookupTable: {[key: string]: string}): Function {\n  // List of block types already validated, to minimize duplicate warnings.\n  const blockTypesChecked: AnyDuringMigration[] = [];\n\n  // Check the tooltip string messages for invalid references.\n  // Wait for load, in case Blockly.Msg is not yet populated.\n  // runAfterPageLoad() does not run in a Node.js environment due to lack\n  // of document object, in which case skip the validation.\n  if (typeof document === 'object') {  // Relies on document.readyState\n    runAfterPageLoad(function() {\n      for (const key in lookupTable) {\n        // Will print warnings if reference is missing.\n        parsing.checkMessageReferences(lookupTable[key]);\n      }\n    });\n  }\n\n  /** The actual extension. */\n  function extensionFn(this: Block) {\n    if (this.type && blockTypesChecked.indexOf(this.type) === -1) {\n      checkDropdownOptionsInTable(this, dropdownName, lookupTable);\n      blockTypesChecked.push(this.type);\n    }\n\n    this.setTooltip(function(this: Block) {\n      const value = String(this.getFieldValue(dropdownName));\n      let tooltip = lookupTable[value];\n      if (tooltip === null) {\n        if (blockTypesChecked.indexOf(this.type) === -1) {\n          // Warn for missing values on generated tooltips.\n          let warning = 'No tooltip mapping for value ' + value + ' of field ' +\n              dropdownName;\n          if (this.type !== null) {\n            warning += ' of block type ' + this.type;\n          }\n          console.warn(warning + '.');\n        }\n      } else {\n        tooltip = parsing.replaceMessageReferences(tooltip);\n      }\n      return tooltip;\n    }.bind(this));\n  }\n  return extensionFn;\n}\n\n/**\n * Checks all options keys are present in the provided string lookup table.\n * Emits console warnings when they are not.\n *\n * @param block The block containing the dropdown\n * @param dropdownName The name of the dropdown\n * @param lookupTable The string lookup table\n */\nfunction checkDropdownOptionsInTable(\n    block: Block, dropdownName: string, lookupTable: {[key: string]: string}) {\n  // Validate all dropdown options have values.\n  const dropdown = block.getField(dropdownName);\n  if (dropdown instanceof FieldDropdown && !dropdown.isOptionListDynamic()) {\n    const options = dropdown.getOptions();\n    for (let i = 0; i < options.length; i++) {\n      const optionKey = options[i][1];  // label, then value\n      if (lookupTable[optionKey] === null) {\n        console.warn(\n            'No tooltip mapping for value ' + optionKey + ' of field ' +\n            dropdownName + ' of block type ' + block.type);\n      }\n    }\n  }\n}\n\n/**\n * Builds an extension function that will install a dynamic tooltip. The\n * tooltip message should include the string '%1' and that string will be\n * replaced with the text of the named field.\n *\n * @param msgTemplate The template form to of the message text, with %1\n *     placeholder.\n * @param fieldName The field with the replacement text.\n * @returns The extension function.\n */\nexport function buildTooltipWithFieldText(\n    msgTemplate: string, fieldName: string): Function {\n  // Check the tooltip string messages for invalid references.\n  // Wait for load, in case Blockly.Msg is not yet populated.\n  // runAfterPageLoad() does not run in a Node.js environment due to lack\n  // of document object, in which case skip the validation.\n  if (typeof document === 'object') {  // Relies on document.readyState\n    runAfterPageLoad(function() {\n      // Will print warnings if reference is missing.\n      parsing.checkMessageReferences(msgTemplate);\n    });\n  }\n\n  /** The actual extension. */\n  function extensionFn(this: Block) {\n    this.setTooltip(function(this: Block) {\n      const field = this.getField(fieldName);\n      return parsing.replaceMessageReferences(msgTemplate)\n          .replace('%1', field ? field.getText() : '');\n    }.bind(this));\n  }\n  return extensionFn;\n}\n\n/**\n * Configures the tooltip to mimic the parent block when connected. Otherwise,\n * uses the tooltip text at the time this extension is initialized. This takes\n * advantage of the fact that all other values from JSON are initialized before\n * extensions.\n */\nfunction extensionParentTooltip(this: Block) {\n  const tooltipWhenNotConnected = this.tooltip;\n  this.setTooltip(function(this: Block) {\n    const parent = this.getParent();\n    return parent && parent.getInputsInline() && parent.tooltip ||\n        tooltipWhenNotConnected;\n  }.bind(this));\n}\nregister('parent_tooltip_when_inline', extensionParentTooltip);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.array');\n\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @internal\n */\nexport function removeElem<T>(arr: Array<T>, value: T): boolean {\n  const i = arr.indexOf(value);\n  if (i === -1) {\n    return false;\n  }\n  arr.splice(i, 1);\n  return true;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockAnimations');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n\n/** A bounding box for a cloned block. */\ninterface CloneRect {\n  x: number;\n  y: number;\n  width: number;\n  height: number;\n}\n\n/** PID of disconnect UI animation.  There can only be one at a time. */\nlet disconnectPid: ReturnType<typeof setTimeout>|null = null;\n\n/** The wobbling block.  There can only be one at a time. */\nlet wobblingBlock: BlockSvg|null = null;\n\n\n/**\n * Play some UI effects (sound, animation) when disposing of a block.\n *\n * @param block The block being disposed of.\n * @internal\n */\nexport function disposeUiEffect(block: BlockSvg) {\n  // Disposing is going to take so long the animation won't play anyway.\n  if (block.getDescendants(false).length > 100) return;\n\n  const workspace = block.workspace;\n  const svgGroup = block.getSvgRoot();\n  workspace.getAudioManager().play('delete');\n\n  const xy = workspace.getSvgXY(svgGroup);\n  // Deeply clone the current block.\n  const clone: SVGGElement = svgGroup.cloneNode(true) as SVGGElement;\n  clone.setAttribute('transform', 'translate(' + xy.x + ',' + xy.y + ')');\n  workspace.getParentSvg().appendChild(clone);\n  const cloneRect =\n      {'x': xy.x, 'y': xy.y, 'width': block.width, 'height': block.height};\n  disposeUiStep(clone, cloneRect, workspace.RTL, new Date(), workspace.scale);\n}\n/**\n * Animate a cloned block and eventually dispose of it.\n * This is a class method, not an instance method since the original block has\n * been destroyed and is no longer accessible.\n *\n * @param clone SVG element to animate and dispose of.\n * @param rect Starting rect of the clone.\n * @param rtl True if RTL, false if LTR.\n * @param start Date of animation's start.\n * @param workspaceScale Scale of workspace.\n */\nfunction disposeUiStep(\n    clone: Element, rect: CloneRect, rtl: boolean, start: Date,\n    workspaceScale: number) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(clone);\n  } else {\n    const x =\n        rect.x + (rtl ? -1 : 1) * rect.width * workspaceScale / 2 * percent;\n    const y = rect.y + rect.height * workspaceScale * percent;\n    const scale = (1 - percent) * workspaceScale;\n    clone.setAttribute(\n        'transform',\n        'translate(' + x + ',' + y + ')' +\n            ' scale(' + scale + ')');\n    setTimeout(disposeUiStep, 10, clone, rect, rtl, start, workspaceScale);\n  }\n}\n\n/**\n * Play some UI effects (sound, ripple) after a connection has been established.\n *\n * @param block The block being connected.\n * @internal\n */\nexport function connectionUiEffect(block: BlockSvg) {\n  const workspace = block.workspace;\n  const scale = workspace.scale;\n  workspace.getAudioManager().play('click');\n  if (scale < 1) {\n    return;  // Too small to care about visual effects.\n  }\n  // Determine the absolute coordinates of the inferior block.\n  const xy = workspace.getSvgXY(block.getSvgRoot());\n  // Offset the coordinates based on the two connection types, fix scale.\n  if (block.outputConnection) {\n    xy.x += (block.RTL ? 3 : -3) * scale;\n    xy.y += 13 * scale;\n  } else if (block.previousConnection) {\n    xy.x += (block.RTL ? -23 : 23) * scale;\n    xy.y += 3 * scale;\n  }\n  const ripple = dom.createSvgElement(\n      Svg.CIRCLE, {\n        'cx': xy.x,\n        'cy': xy.y,\n        'r': 0,\n        'fill': 'none',\n        'stroke': '#888',\n        'stroke-width': 10,\n      },\n      workspace.getParentSvg());\n  // Start the animation.\n  connectionUiStep(ripple, new Date(), scale);\n}\n\n/**\n * Expand a ripple around a connection.\n *\n * @param ripple Element to animate.\n * @param start Date of animation's start.\n * @param scale Scale of workspace.\n */\nfunction connectionUiStep(ripple: SVGElement, start: Date, scale: number) {\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / 150;\n  if (percent > 1) {\n    dom.removeNode(ripple);\n  } else {\n    ripple.setAttribute('r', String(percent * 25 * scale));\n    ripple.style.opacity = String(1 - percent);\n    disconnectPid = setTimeout(connectionUiStep, 10, ripple, start, scale);\n  }\n}\n\n/**\n * Play some UI effects (sound, animation) when disconnecting a block.\n *\n * @param block The block being disconnected.\n * @internal\n */\nexport function disconnectUiEffect(block: BlockSvg) {\n  disconnectUiStop();\n  block.workspace.getAudioManager().play('disconnect');\n  if (block.workspace.scale < 1) {\n    return;  // Too small to care about visual effects.\n  }\n  // Horizontal distance for bottom of block to wiggle.\n  const DISPLACEMENT = 10;\n  // Scale magnitude of skew to height of block.\n  const height = block.getHeightWidth().height;\n  let magnitude = Math.atan(DISPLACEMENT / height) / Math.PI * 180;\n  if (!block.RTL) {\n    magnitude *= -1;\n  }\n  // Start the animation.\n  wobblingBlock = block;\n  disconnectUiStep(block, magnitude, new Date());\n}\n\n/**\n * Animate a brief wiggle of a disconnected block.\n *\n * @param block Block to animate.\n * @param magnitude Maximum degrees skew (reversed for RTL).\n * @param start Date of animation's start.\n */\nfunction disconnectUiStep(block: BlockSvg, magnitude: number, start: Date) {\n  const DURATION = 200;  // Milliseconds.\n  const WIGGLES = 3;     // Half oscillations.\n\n  const ms = new Date().getTime() - start.getTime();\n  const percent = ms / DURATION;\n\n  let skew = '';\n  if (percent <= 1) {\n    const val = Math.round(\n        Math.sin(percent * Math.PI * WIGGLES) * (1 - percent) * magnitude);\n    skew = `skewX(${val})`;\n    disconnectPid = setTimeout(disconnectUiStep, 10, block, magnitude, start);\n  }\n\n  block.getSvgRoot().setAttribute(\n      'transform', `${block.getTranslation()} ${skew}`);\n}\n\n/**\n * Stop the disconnect UI animation immediately.\n *\n * @internal\n */\nexport function disconnectUiStop() {\n  if (!wobblingBlock) return;\n  if (disconnectPid) {\n    clearTimeout(disconnectPid);\n    disconnectPid = null;\n  }\n  wobblingBlock.getSvgRoot().setAttribute(\n      'transform', wobblingBlock.getTranslation());\n  wobblingBlock = null;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.bumpObjects');\n\nimport type {BlockSvg} from './block_svg.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockCreate} from './events/events_block_create.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport type {CommentCreate} from './events/events_comment_create.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport type {ViewportChange} from './events/events_viewport.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport * as mathUtils from './utils/math.js';\nimport type {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Bumps the given object that has passed out of bounds.\n *\n * @param workspace The workspace containing the object.\n * @param scrollMetrics Scroll metrics\n *    in workspace coordinates.\n * @param object The object to bump.\n * @returns True if block was bumped.\n */\nfunction bumpObjectIntoBounds(\n    workspace: WorkspaceSvg, scrollMetrics: ContainerRegion,\n    object: IBoundedElement): boolean {\n  // Compute new top/left position for object.\n  const objectMetrics = object.getBoundingRectangle();\n  const height = objectMetrics.bottom - objectMetrics.top;\n  const width = objectMetrics.right - objectMetrics.left;\n\n  const topClamp = scrollMetrics.top;\n  const scrollMetricsBottom = scrollMetrics.top + scrollMetrics.height;\n  const bottomClamp = scrollMetricsBottom - height;\n  // If the object is taller than the workspace we want to\n  // top-align the block\n  const newYPosition =\n      mathUtils.clamp(topClamp, objectMetrics.top, bottomClamp);\n  const deltaY = newYPosition - objectMetrics.top;\n\n  // Note: Even in RTL mode the \"anchor\" of the object is the\n  // top-left corner of the object.\n  let leftClamp = scrollMetrics.left;\n  const scrollMetricsRight = scrollMetrics.left + scrollMetrics.width;\n  let rightClamp = scrollMetricsRight - width;\n  if (workspace.RTL) {\n    // If the object is wider than the workspace and we're in RTL\n    // mode we want to right-align the block, which means setting\n    // the left clamp to match.\n    leftClamp = Math.min(rightClamp, leftClamp);\n  } else {\n    // If the object is wider than the workspace and we're in LTR\n    // mode we want to left-align the block, which means setting\n    // the right clamp to match.\n    rightClamp = Math.max(leftClamp, rightClamp);\n  }\n  const newXPosition =\n      mathUtils.clamp(leftClamp, objectMetrics.left, rightClamp);\n  const deltaX = newXPosition - objectMetrics.left;\n\n  if (deltaX || deltaY) {\n    object.moveBy(deltaX, deltaY);\n    return true;\n  }\n  return false;\n}\nexport const bumpIntoBounds = bumpObjectIntoBounds;\n\n/**\n * Creates a handler for bumping objects when they cross fixed bounds.\n *\n * @param workspace The workspace to handle.\n * @returns The event handler.\n */\nexport function bumpIntoBoundsHandler(workspace: WorkspaceSvg):\n    (p1: Abstract) => void {\n  return (e) => {\n    const metricsManager = workspace.getMetricsManager();\n    if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n      return;\n    }\n\n    if (eventUtils.BUMP_EVENTS.indexOf(e.type ?? '') !== -1) {\n      const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n\n      // Triggered by move/create event\n      const object =\n          extractObjectFromEvent(workspace, e as eventUtils.BumpEvent);\n      if (!object) {\n        return;\n      }\n      // Handle undo.\n      const existingGroup = eventUtils.getGroup() || false;\n      eventUtils.setGroup(e.group);\n\n      const wasBumped = bumpObjectIntoBounds(\n          workspace, scrollMetricsInWsCoords, (object as IBoundedElement));\n\n      if (wasBumped && !e.group) {\n        console.warn(\n            'Moved object in bounds but there was no' +\n            ' event group. This may break undo.');\n      }\n      eventUtils.setGroup(existingGroup);\n    } else if (e.type === eventUtils.VIEWPORT_CHANGE) {\n      const viewportEvent = (e as ViewportChange);\n      if (viewportEvent.scale && viewportEvent.oldScale &&\n          viewportEvent.scale > viewportEvent.oldScale) {\n        bumpTopObjectsIntoBounds(workspace);\n      }\n    }\n  };\n}\n\n/**\n * Extracts the object from the given event.\n *\n * @param workspace The workspace the event originated\n *    from.\n * @param e An event containing an object.\n * @returns The extracted\n *    object.\n */\nfunction extractObjectFromEvent(\n    workspace: WorkspaceSvg, e: eventUtils.BumpEvent): BlockSvg|null|\n    WorkspaceCommentSvg {\n  let object = null;\n  switch (e.type) {\n    case eventUtils.BLOCK_CREATE:\n    case eventUtils.BLOCK_MOVE:\n      object = workspace.getBlockById((e as BlockCreate | BlockMove).blockId!);\n      if (object) {\n        object = object.getRootBlock();\n      }\n      break;\n    case eventUtils.COMMENT_CREATE:\n    case eventUtils.COMMENT_MOVE:\n      object =\n          workspace.getCommentById((e as CommentCreate | CommentMove).commentId!\n                                   ) as WorkspaceCommentSvg |\n          null;\n      break;\n  }\n  return object;\n}\n\n/**\n * Bumps the top objects in the given workspace into bounds.\n *\n * @param workspace The workspace.\n */\nexport function bumpTopObjectsIntoBounds(workspace: WorkspaceSvg) {\n  const metricsManager = workspace.getMetricsManager();\n  if (!metricsManager.hasFixedEdges() || workspace.isDragging()) {\n    return;\n  }\n\n  const scrollMetricsInWsCoords = metricsManager.getScrollMetrics(true);\n  const topBlocks = workspace.getTopBoundedElements();\n  for (let i = 0, block; block = topBlocks[i]; i++) {\n    bumpObjectIntoBounds(workspace, scrollMetricsInWsCoords, block);\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a block visually.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BlockDragger');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_drag.js';\n\nimport * as blockAnimation from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Icon} from './icon.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport * as registry from './registry.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a block dragger.  It moves blocks around the workspace when they\n * are being dragged by a mouse or touch.\n */\nexport class BlockDragger implements IBlockDragger {\n  /** The top block in the stack that is being dragged. */\n  protected draggingBlock_: BlockSvg;\n  protected draggedConnectionManager_: InsertionMarkerManager;\n\n  /** The workspace on which the block is being dragged. */\n  protected workspace_: WorkspaceSvg;\n\n  /** Which drag area the mouse pointer is over, if any. */\n  private dragTarget_: IDragTarget|null = null;\n\n  /** Whether the block would be deleted if dropped immediately. */\n  protected wouldDeleteBlock_ = false;\n  protected startXY_: Coordinate;\n  protected dragIconData_: IconPositionData[];\n\n  /**\n   * @param block The block to drag.\n   * @param workspace The workspace to drag on.\n   */\n  constructor(block: BlockSvg, workspace: WorkspaceSvg) {\n    this.draggingBlock_ = block;\n\n    /** Object that keeps track of connections on dragged blocks. */\n    this.draggedConnectionManager_ =\n        new InsertionMarkerManager(this.draggingBlock_);\n\n    this.workspace_ = workspace;\n\n    /**\n     * The location of the top left corner of the dragging block at the\n     * beginning of the drag in workspace coordinates.\n     */\n    this.startXY_ = this.draggingBlock_.getRelativeToSurfaceXY();\n\n    /**\n     * A list of all of the icons (comment, warning, and mutator) that are\n     * on this block and its descendants.  Moving an icon moves the bubble that\n     * extends from it if that bubble is open.\n     */\n    this.dragIconData_ = initIconData(block);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.dragIconData_.length = 0;\n\n    if (this.draggedConnectionManager_) {\n      this.draggedConnectionManager_.dispose();\n    }\n  }\n\n  /**\n   * Start dragging a block.  This includes moving it to the drag surface.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   */\n  startDrag(currentDragDeltaXY: Coordinate, healStack: boolean) {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n    this.fireDragStartEvent_();\n\n    // Mutators don't have the same type of z-ordering as the normal workspace\n    // during a drag.  They have to rely on the order of the blocks in the SVG.\n    // For performance reasons that usually happens at the end of a drag,\n    // but do it at the beginning for mutators.\n    if (this.workspace_.isMutator) {\n      this.draggingBlock_.bringToFront();\n    }\n\n    // During a drag there may be a lot of rerenders, but not field changes.\n    // Turn the cache on so we don't do spurious remeasures during the drag.\n    dom.startTextWidthCache();\n    this.workspace_.setResizesEnabled(false);\n    blockAnimation.disconnectUiStop();\n\n    if (this.shouldDisconnect_(healStack)) {\n      this.disconnectBlock_(healStack, currentDragDeltaXY);\n    }\n    this.draggingBlock_.setDragging(true);\n    // For future consideration: we may be able to put moveToDragSurface inside\n    // the block dragger, which would also let the block not track the block\n    // drag surface.\n    this.draggingBlock_.moveToDragSurface();\n  }\n\n  /**\n   * Whether or not we should disconnect the block when a drag is started.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @returns True to disconnect the block, false otherwise.\n   */\n  protected shouldDisconnect_(healStack: boolean): boolean {\n    return !!(\n        this.draggingBlock_.getParent() ||\n        healStack && this.draggingBlock_.nextConnection &&\n            this.draggingBlock_.nextConnection.targetBlock());\n  }\n\n  /**\n   * Disconnects the block and moves it to a new location.\n   *\n   * @param healStack Whether or not to heal the stack after disconnecting.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   */\n  protected disconnectBlock_(\n      healStack: boolean, currentDragDeltaXY: Coordinate) {\n    this.draggingBlock_.unplug(healStack);\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n\n    this.draggingBlock_.translate(newLoc.x, newLoc.y);\n    blockAnimation.disconnectUiEffect(this.draggingBlock_);\n    this.draggedConnectionManager_.updateAvailableConnections();\n  }\n\n  /** Fire a UI event at the start of a block drag. */\n  protected fireDragStartEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n        this.draggingBlock_, true, this.draggingBlock_.getDescendants(false));\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Execute a step of block dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  drag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n    this.draggingBlock_.moveDuringDrag(newLoc);\n    this.dragIcons_(delta);\n\n    const oldDragTarget = this.dragTarget_;\n    this.dragTarget_ = this.workspace_.getDragTarget(e);\n\n    this.draggedConnectionManager_.update(delta, this.dragTarget_);\n    const oldWouldDeleteBlock = this.wouldDeleteBlock_;\n    this.wouldDeleteBlock_ = this.draggedConnectionManager_.wouldDeleteBlock;\n    if (oldWouldDeleteBlock !== this.wouldDeleteBlock_) {\n      // Prevent unnecessary add/remove class calls.\n      this.updateCursorDuringBlockDrag_();\n    }\n\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\n    // InsertionMarkerManager.update.\n    if (this.dragTarget_ !== oldDragTarget) {\n      oldDragTarget && oldDragTarget.onDragExit(this.draggingBlock_);\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.draggingBlock_);\n    }\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.draggingBlock_);\n  }\n\n  /**\n   * Finish a block drag and put the block back on the workspace.\n   *\n   * @param e The pointerup event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   */\n  endDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    // Make sure internal state is fresh.\n    this.drag(e, currentDragDeltaXY);\n    this.dragIconData_ = [];\n    this.fireDragEndEvent_();\n\n    dom.stopTextWidthCache();\n\n    blockAnimation.disconnectUiStop();\n\n    const preventMove = !!this.dragTarget_ &&\n        this.dragTarget_.shouldPreventMove(this.draggingBlock_);\n    let newLoc: Coordinate;\n    let delta: Coordinate|null = null;\n    if (preventMove) {\n      newLoc = this.startXY_;\n    } else {\n      const newValues = this.getNewLocationAfterDrag_(currentDragDeltaXY);\n      delta = newValues.delta;\n      newLoc = newValues.newLocation;\n    }\n    this.draggingBlock_.moveOffDragSurface(newLoc);\n\n    if (this.dragTarget_) {\n      this.dragTarget_.onDrop(this.draggingBlock_);\n    }\n\n    const deleted = this.maybeDeleteBlock_();\n    if (!deleted) {\n      // These are expensive and don't need to be done if we're deleting.\n      this.draggingBlock_.setDragging(false);\n      if (delta) {  // !preventMove\n        this.updateBlockAfterMove_();\n      } else {\n        // Blocks dragged directly from a flyout may need to be bumped into\n        // bounds.\n        bumpObjects.bumpIntoBounds(\n            this.draggingBlock_.workspace,\n            this.workspace_.getMetricsManager().getScrollMetrics(true),\n            this.draggingBlock_);\n      }\n    }\n    this.workspace_.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Calculates the drag delta and new location values after a block is dragged.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the start of\n   *     the drag, in pixel units.\n   * @returns New location after drag. delta is in workspace units. newLocation\n   *     is the new coordinate where the block should end up.\n   */\n  protected getNewLocationAfterDrag_(currentDragDeltaXY: Coordinate):\n      {delta: Coordinate, newLocation: Coordinate} {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLocation = Coordinate.sum(this.startXY_, delta);\n    return {\n      delta,\n      newLocation,\n    };\n  }\n\n  /**\n   * May delete the dragging block, if allowed. If `this.wouldDeleteBlock_` is\n   * not true, the block will not be deleted. This should be called at the end\n   * of a block drag.\n   *\n   * @returns True if the block was deleted.\n   */\n  protected maybeDeleteBlock_(): boolean {\n    if (this.wouldDeleteBlock_) {\n      // Fire a move event, so we know where to go back to for an undo.\n      this.fireMoveEvent_();\n      this.draggingBlock_.dispose(false, true);\n      common.draggingConnections.length = 0;\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Updates the necessary information to place a block at a certain location.\n   */\n  protected updateBlockAfterMove_() {\n    this.fireMoveEvent_();\n    if (this.draggedConnectionManager_.wouldConnectBlock()) {\n      // Applying connections also rerenders the relevant blocks.\n      this.draggedConnectionManager_.applyConnections();\n    } else {\n      this.draggingBlock_.queueRender();\n    }\n    this.draggingBlock_.scheduleSnapAndBump();\n  }\n\n  /** Fire a UI event at the end of a block drag. */\n  protected fireDragEndEvent_() {\n    const event = new (eventUtils.get(eventUtils.BLOCK_DRAG))(\n        this.draggingBlock_, false, this.draggingBlock_.getDescendants(false));\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Adds or removes the style of the cursor for the toolbox.\n   * This is what changes the cursor to display an x when a deletable block is\n   * held over the toolbox.\n   *\n   * @param isEnd True if we are at the end of a drag, false otherwise.\n   */\n  protected updateToolboxStyle_(isEnd: boolean) {\n    const toolbox = this.workspace_.getToolbox();\n\n    if (toolbox) {\n      const style = this.draggingBlock_.isDeletable() ? 'blocklyToolboxDelete' :\n                                                        'blocklyToolboxGrab';\n\n      // AnyDuringMigration because:  Property 'removeStyle' does not exist on\n      // type 'IToolbox'.\n      if (isEnd &&\n          typeof (toolbox as AnyDuringMigration).removeStyle === 'function') {\n        // AnyDuringMigration because:  Property 'removeStyle' does not exist on\n        // type 'IToolbox'.\n        (toolbox as AnyDuringMigration).removeStyle(style);\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\n        // type 'IToolbox'.\n      } else if (\n          !isEnd &&\n          typeof (toolbox as AnyDuringMigration).addStyle === 'function') {\n        // AnyDuringMigration because:  Property 'addStyle' does not exist on\n        // type 'IToolbox'.\n        (toolbox as AnyDuringMigration).addStyle(style);\n      }\n    }\n  }\n\n  /** Fire a move event at the end of a block drag. */\n  protected fireMoveEvent_() {\n    if (this.draggingBlock_.isDeadOrDying()) return;\n    const event = new (eventUtils.get(eventUtils.BLOCK_MOVE))(\n                      this.draggingBlock_) as BlockMove;\n    event.oldCoordinate = this.startXY_;\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\n   * dragging block would be deleted if released immediately.\n   */\n  protected updateCursorDuringBlockDrag_() {\n    this.draggingBlock_.setDeleteStyle(this.wouldDeleteBlock_);\n  }\n\n  /**\n   * Convert a coordinate object from pixels to workspace units, including a\n   * correction for mutator workspaces.\n   * This function does not consider differing origins.  It simply scales the\n   * input's x and y values.\n   *\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\n   * @returns The input coordinate divided by the workspace scale.\n   */\n  protected pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n        pixelCoord.x / this.workspace_.scale,\n        pixelCoord.y / this.workspace_.scale);\n    if (this.workspace_.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace_.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n\n  /**\n   * Move all of the icons connected to this drag.\n   *\n   * @param dxy How far to move the icons from their original positions, in\n   *     workspace units.\n   */\n  protected dragIcons_(dxy: Coordinate) {\n    // Moving icons moves their associated bubbles.\n    for (let i = 0; i < this.dragIconData_.length; i++) {\n      const data = this.dragIconData_[i];\n      data.icon.setIconLocation(Coordinate.sum(data.location, dxy));\n    }\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    // No insertion markers with the old style of dragged connection managers.\n    if (this.draggedConnectionManager_ &&\n        this.draggedConnectionManager_.getInsertionMarkers) {\n      return this.draggedConnectionManager_.getInsertionMarkers();\n    }\n    return [];\n  }\n}\n\n/** Data about the position of a given icon. */\nexport interface IconPositionData {\n  location: Coordinate;\n  icon: Icon;\n}\n\n/**\n * Make a list of all of the icons (comment, warning, and mutator) that are\n * on this block and its descendants.  Moving an icon moves the bubble that\n * extends from it if that bubble is open.\n *\n * @param block The root block that is being dragged.\n * @returns The list of all icons and their locations.\n */\nfunction initIconData(block: BlockSvg): IconPositionData[] {\n  // Build a list of icons that need to be moved and where they started.\n  const dragIconData = [];\n  const descendants = (block.getDescendants(false));\n\n  for (let i = 0, descendant; descendant = descendants[i]; i++) {\n    const icons = descendant.getIcons();\n    for (let j = 0; j < icons.length; j++) {\n      const data = {\n        // Coordinate with x and y properties (workspace\n        // coordinates).\n        location: icons[j].getIconLocation(),  // Blockly.Icon\n        icon: icons[j],\n      };\n      dragIconData.push(data);\n    }\n  }\n  // AnyDuringMigration because:  Type '{ location: Coordinate | null; icon:\n  // Icon; }[]' is not assignable to type 'IconPositionData[]'.\n  return dragIconData as AnyDuringMigration;\n}\n\nregistry.register(registry.Type.BLOCK_DRAGGER, registry.DEFAULT, BlockDragger);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.clipboard');\n\nimport type {CopyData, ICopyable} from './interfaces/i_copyable.js';\n\n\n/** Metadata about the object that is currently on the clipboard. */\nlet copyData: CopyData|null = null;\n\n/**\n * Copy a block or workspace comment onto the local clipboard.\n *\n * @param toCopy Block or Workspace Comment to be copied.\n * @internal\n */\nexport function copy(toCopy: ICopyable) {\n  TEST_ONLY.copyInternal(toCopy);\n}\n\n/**\n * Private version of copy for stubbing in tests.\n */\nfunction copyInternal(toCopy: ICopyable) {\n  copyData = toCopy.toCopyData();\n}\n\n/**\n * Paste a block or workspace comment on to the main workspace.\n *\n * @returns The pasted thing if the paste was successful, null otherwise.\n * @internal\n */\nexport function paste(): ICopyable|null {\n  if (!copyData) {\n    return null;\n  }\n  // Pasting always pastes to the main workspace, even if the copy\n  // started in a flyout workspace.\n  let workspace = copyData.source;\n  if (workspace.isFlyout) {\n    workspace = workspace.targetWorkspace!;\n  }\n  if (copyData.typeCounts &&\n      workspace.isCapacityAvailable(copyData.typeCounts)) {\n    return workspace.paste(copyData.saveInfo);\n  }\n  return null;\n}\n\n/**\n * Duplicate this block and its children, or a workspace comment.\n *\n * @param toDuplicate Block or Workspace Comment to be duplicated.\n * @returns The block or workspace comment that was duplicated, or null if the\n *     duplication failed.\n * @internal\n */\nexport function duplicate(toDuplicate: ICopyable): ICopyable|null {\n  return TEST_ONLY.duplicateInternal(toDuplicate);\n}\n\n/**\n * Private version of duplicate for stubbing in tests.\n */\nfunction duplicateInternal(toDuplicate: ICopyable): ICopyable|null {\n  const oldCopyData = copyData;\n  copy(toDuplicate);\n  const pastedThing =\n      toDuplicate.toCopyData()?.source?.paste(copyData!.saveInfo) ?? null;\n  copyData = oldCopyData;\n  return pastedThing;\n}\n\nexport const TEST_ONLY = {\n  duplicateInternal,\n  copyInternal,\n};\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ContextMenu');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as clipboard from './clipboard.js';\nimport {config} from './config.js';\nimport * as dom from './utils/dom.js';\nimport type {ContextMenuOption, LegacyContextMenuOption} from './contextmenu_registry.js';\nimport * as eventUtils from './events/utils.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\n\n\n/**\n * Which block is the context menu attached to?\n */\nlet currentBlock: Block|null = null;\n\nconst dummyOwner = {};\n\n/**\n * Gets the block the context menu is currently attached to.\n *\n * @returns The block the context menu is attached to.\n */\nexport function getCurrentBlock(): Block|null {\n  return currentBlock;\n}\n\n/**\n * Sets the block the context menu is currently attached to.\n *\n * @param block The block the context menu is attached to.\n */\nexport function setCurrentBlock(block: Block|null) {\n  currentBlock = block;\n}\n\n/**\n * Menu object.\n */\nlet menu_: Menu|null = null;\n\n/**\n * Construct the menu based on the list of options and show the menu.\n *\n * @param e Mouse event.\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n */\nexport function show(\n    e: Event, options: (ContextMenuOption|LegacyContextMenuOption)[],\n    rtl: boolean) {\n  WidgetDiv.show(dummyOwner, rtl, dispose);\n  if (!options.length) {\n    hide();\n    return;\n  }\n  const menu = populate_(options, rtl);\n  menu_ = menu;\n\n  position_(menu, e, rtl);\n  // 1ms delay is required for focusing on context menus because some other\n  // mouse event is still waiting in the queue and clears focus.\n  setTimeout(function() {\n    menu.focus();\n  }, 1);\n  currentBlock = null;  // May be set by Blockly.Block.\n}\n\n/**\n * Create the context menu object and populate it with the given options.\n *\n * @param options Array of menu options.\n * @param rtl True if RTL, false if LTR.\n * @returns The menu that will be shown on right click.\n */\nfunction populate_(\n    options: (ContextMenuOption|LegacyContextMenuOption)[],\n    rtl: boolean): Menu {\n  /* Here's what one option object looks like:\n      {text: 'Make It So',\n       enabled: true,\n       callback: Blockly.MakeItSo}\n    */\n  const menu = new Menu();\n  menu.setRole(aria.Role.MENU);\n  for (let i = 0; i < options.length; i++) {\n    const option = options[i];\n    const menuItem = new MenuItem(option.text);\n    menuItem.setRightToLeft(rtl);\n    menuItem.setRole(aria.Role.MENUITEM);\n    menu.addChild(menuItem);\n    menuItem.setEnabled(option.enabled);\n    if (option.enabled) {\n      const actionHandler = function() {\n        hide();\n        requestAnimationFrame(() => {\n          setTimeout(() => {\n            // If .scope does not exist on the option, then the callback\n            // will not be expecting a scope parameter, so there should be\n            // no problems. Just assume it is a ContextMenuOption and we'll\n            // pass undefined if it's not.\n            option.callback((option as ContextMenuOption).scope);\n          }, 0);\n        });\n      };\n      menuItem.onAction(actionHandler, {});\n    }\n  }\n  return menu;\n}\n\n/**\n * Add the menu to the page and position it correctly.\n *\n * @param menu The menu to add and position.\n * @param e Mouse event for the right click that is making the context\n *     menu appear.\n * @param rtl True if RTL, false if LTR.\n */\nfunction position_(menu: Menu, e: Event, rtl: boolean) {\n  // Record windowSize and scrollOffset before adding menu.\n  const viewportBBox = svgMath.getViewportBBox();\n  const mouseEvent = e as MouseEvent;\n  // This one is just a point, but we'll pretend that it's a rect so we can use\n  // some helper functions.\n  const anchorBBox = new Rect(\n      mouseEvent.clientY + viewportBBox.top,\n      mouseEvent.clientY + viewportBBox.top,\n      mouseEvent.clientX + viewportBBox.left,\n      mouseEvent.clientX + viewportBBox.left);\n\n  createWidget_(menu);\n  const menuSize = menu.getSize();\n\n  if (rtl) {\n    anchorBBox.left += menuSize.width;\n    anchorBBox.right += menuSize.width;\n    viewportBBox.left += menuSize.width;\n    viewportBBox.right += menuSize.width;\n  }\n\n  WidgetDiv.positionWithAnchor(viewportBBox, anchorBBox, menuSize, rtl);\n  // Calling menuDom.focus() has to wait until after the menu has been placed\n  // correctly.  Otherwise it will cause a page scroll to get the misplaced menu\n  // in view.  See issue #1329.\n  menu.focus();\n}\n\n/**\n * Create and render the menu widget inside Blockly's widget div.\n *\n * @param menu The menu to add to the widget div.\n */\nfunction createWidget_(menu: Menu) {\n  const div = WidgetDiv.getDiv();\n  if (!div) {\n    throw Error('Attempting to create a context menu when widget div is null');\n  }\n  const menuDom = menu.render(div);\n  dom.addClass(menuDom, 'blocklyContextMenu');\n  // Prevent system context menu when right-clicking a Blockly context menu.\n  browserEvents.conditionalBind(\n      (menuDom as EventTarget), 'contextmenu', null, haltPropagation);\n  // Focus only after the initial render to avoid issue #1329.\n  menu.focus();\n}\n/**\n * Halts the propagation of the event without doing anything else.\n *\n * @param e An event.\n */\nfunction haltPropagation(e: Event) {\n  // This event has been handled.  No need to bubble up to the document.\n  e.preventDefault();\n  e.stopPropagation();\n}\n\n/**\n * Hide the context menu.\n */\nexport function hide() {\n  WidgetDiv.hideIfOwner(dummyOwner);\n  currentBlock = null;\n}\n\n/**\n * Dispose of the menu.\n */\nexport function dispose() {\n  if (menu_) {\n    menu_.dispose();\n    menu_ = null;\n  }\n}\n\n/**\n * Create a callback function that creates and configures a block,\n *   then places the new block next to the original.\n *\n * @param block Original block.\n * @param xml XML representation of new block.\n * @returns Function that creates a block.\n */\nexport function callbackFactory(block: Block, xml: Element): Function {\n  return () => {\n    eventUtils.disable();\n    let newBlock;\n    try {\n      newBlock = Xml.domToBlock(xml, block.workspace!) as BlockSvg;\n      // Move the new block next to the old block.\n      const xy = block.getRelativeToSurfaceXY();\n      if (block.RTL) {\n        xy.x -= config.snapRadius;\n      } else {\n        xy.x += config.snapRadius;\n      }\n      xy.y += config.snapRadius * 2;\n      newBlock.moveBy(xy.x, xy.y);\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !newBlock.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    newBlock.select();\n  };\n}\n\n// Helper functions for creating context menu options.\n\n/**\n * Make a context menu option for deleting the current workspace comment.\n *\n * @param comment The workspace comment where the\n *     right-click originated.\n * @returns A menu option,\n *     containing text, enabled, and a callback.\n * @internal\n */\nexport function commentDeleteOption(comment: WorkspaceCommentSvg):\n    LegacyContextMenuOption {\n  const deleteOption = {\n    text: Msg['REMOVE_COMMENT'],\n    enabled: true,\n    callback: function() {\n      eventUtils.setGroup(true);\n      comment.dispose();\n      eventUtils.setGroup(false);\n    },\n  };\n  return deleteOption;\n}\n\n/**\n * Make a context menu option for duplicating the current workspace comment.\n *\n * @param comment The workspace comment where the\n *     right-click originated.\n * @returns A menu option,\n *     containing text, enabled, and a callback.\n * @internal\n */\nexport function commentDuplicateOption(comment: WorkspaceCommentSvg):\n    LegacyContextMenuOption {\n  const duplicateOption = {\n    text: Msg['DUPLICATE_COMMENT'],\n    enabled: true,\n    callback: function() {\n      clipboard.duplicate(comment);\n    },\n  };\n  return duplicateOption;\n}\n\n/**\n * Make a context menu option for adding a comment on the workspace.\n *\n * @param ws The workspace where the right-click\n *     originated.\n * @param e The right-click mouse event.\n * @returns A menu option, containing text, enabled, and a callback.\n * @suppress {strictModuleDepCheck,checkTypes} Suppress checks while workspace\n *     comments are not bundled in.\n * @internal\n */\nexport function workspaceCommentOption(\n    ws: WorkspaceSvg, e: Event): ContextMenuOption {\n  /**\n   * Helper function to create and position a comment correctly based on the\n   * location of the mouse event.\n   */\n  function addWsComment() {\n    const comment = new WorkspaceCommentSvg(\n        ws, Msg['WORKSPACE_COMMENT_DEFAULT_TEXT'],\n        WorkspaceCommentSvg.DEFAULT_SIZE, WorkspaceCommentSvg.DEFAULT_SIZE);\n\n    const injectionDiv = ws.getInjectionDiv();\n    // Bounding rect coordinates are in client coordinates, meaning that they\n    // are in pixels relative to the upper left corner of the visible browser\n    // window.  These coordinates change when you scroll the browser window.\n    const boundingRect = injectionDiv.getBoundingClientRect();\n\n    // The client coordinates offset by the injection div's upper left corner.\n    const mouseEvent = e as MouseEvent;\n    const clientOffsetPixels = new Coordinate(\n        mouseEvent.clientX - boundingRect.left,\n        mouseEvent.clientY - boundingRect.top);\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = ws.getOriginOffsetInPixels();\n\n    // The position of the new comment in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset =\n        Coordinate.difference(clientOffsetPixels, mainOffsetPixels);\n    // The position of the new comment in main workspace coordinates.\n    finalOffset.scale(1 / ws.scale);\n\n    const commentX = finalOffset.x;\n    const commentY = finalOffset.y;\n    comment.moveBy(commentX, commentY);\n    if (ws.rendered) {\n      comment.initSvg();\n      comment.render();\n      comment.select();\n    }\n  }\n\n  const wsCommentOption = {\n    enabled: true,\n  } as ContextMenuOption;\n  wsCommentOption.text = Msg['ADD_COMMENT'];\n  wsCommentOption.callback = function() {\n    addWsComment();\n  };\n  return wsCommentOption;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an AST node.\n * Used to traverse the Blockly AST.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ASTNode');\n\nimport type {Block} from '../block.js';\nimport type {Connection} from '../connection.js';\nimport {ConnectionType} from '../connection_type.js';\nimport type {Field} from '../field.js';\nimport type {Input} from '../input.js';\nimport type {IASTNodeLocation} from '../interfaces/i_ast_node_location.js';\nimport type {IASTNodeLocationWithBlock} from '../interfaces/i_ast_node_location_with_block.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for an AST node.\n * It is recommended that you use one of the createNode methods instead of\n * creating a node directly.\n */\nexport class ASTNode {\n  /**\n   * True to navigate to all fields. False to only navigate to clickable fields.\n   */\n  static NAVIGATE_ALL_FIELDS = false;\n\n  /**\n   * The default y offset to use when moving the cursor from a stack to the\n   * workspace.\n   */\n  private static readonly DEFAULT_OFFSET_Y: number = -20;\n  private readonly type_: string;\n  private readonly isConnection_: boolean;\n  private readonly location_: IASTNodeLocation;\n\n  /** The coordinate on the workspace. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'Coordinate'.\n  private wsCoordinate_: Coordinate = null as AnyDuringMigration;\n\n  /**\n   * @param type The type of the location.\n   *     Must be in ASTNode.types.\n   * @param location The position in the AST.\n   * @param opt_params Optional dictionary of options.\n   */\n  constructor(type: string, location: IASTNodeLocation, opt_params?: Params) {\n    if (!location) {\n      throw Error('Cannot create a node without a location.');\n    }\n\n    /**\n     * The type of the location.\n     * One of ASTNode.types\n     */\n    this.type_ = type;\n\n    /** Whether the location points to a connection. */\n    this.isConnection_ = ASTNode.isConnectionType_(type);\n\n    /** The location of the AST node. */\n    this.location_ = location;\n\n    this.processParams_(opt_params || null);\n  }\n\n  /**\n   * Parse the optional parameters.\n   *\n   * @param params The user specified parameters.\n   */\n  private processParams_(params: Params|null) {\n    if (!params) {\n      return;\n    }\n    if (params.wsCoordinate) {\n      this.wsCoordinate_ = params.wsCoordinate;\n    }\n  }\n\n  /**\n   * Gets the value pointed to by this node.\n   * It is the callers responsibility to check the node type to figure out what\n   * type of object they get back from this.\n   *\n   * @returns The current field, connection, workspace, or block the cursor is\n   *     on.\n   */\n  getLocation(): IASTNodeLocation {\n    return this.location_;\n  }\n\n  /**\n   * The type of the current location.\n   * One of ASTNode.types\n   *\n   * @returns The type of the location.\n   */\n  getType(): string {\n    return this.type_;\n  }\n\n  /**\n   * The coordinate on the workspace.\n   *\n   * @returns The workspace coordinate or null if the location is not a\n   *     workspace.\n   */\n  getWsCoordinate(): Coordinate {\n    return this.wsCoordinate_;\n  }\n\n  /**\n   * Whether the node points to a connection.\n   *\n   * @returns [description]\n   * @internal\n   */\n  isConnection(): boolean {\n    return this.isConnection_;\n  }\n\n  /**\n   * Given an input find the next editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the next field or connection or null if there\n   *     is no editable field or input connection after the given input.\n   */\n  private findNextForInput_(): ASTNode|null {\n    const location = this.location_ as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx + 1; i < block!.inputList.length; i++) {\n      const input = block!.inputList[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the next editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node pointing to the next field or connection or null if\n   *     there is no editable field or input connection after the given input.\n   */\n  private findNextForField_(): ASTNode|null {\n    const location = this.location_ as Field;\n    const input = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n          'The current AST location is not associated with a block');\n    }\n    const curIdx = block.inputList.indexOf(input);\n    let fieldIdx = input.fieldRow.indexOf(location) + 1;\n    for (let i = curIdx; i < block.inputList.length; i++) {\n      const newInput = block.inputList[i];\n      const fieldRow = newInput.fieldRow;\n      while (fieldIdx < fieldRow.length) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx++;\n      }\n      fieldIdx = 0;\n      if (newInput.connection) {\n        return ASTNode.createInputNode(newInput);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given an input find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be an input\n   * connection.\n   *\n   * @returns The AST node holding the previous field or connection.\n   */\n  private findPrevForInput_(): ASTNode|null {\n    const location = this.location_ as Connection;\n    const parentInput = location.getParentInput();\n    const block = parentInput!.getSourceBlock();\n    // AnyDuringMigration because:  Argument of type 'Input | null' is not\n    // assignable to parameter of type 'Input'.\n    const curIdx = block!.inputList.indexOf(parentInput as AnyDuringMigration);\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block!.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      for (let j = fieldRow.length - 1; j >= 0; j--) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Given a field find the previous editable field or an input with a non null\n   * connection in the same block. The current location must be a field.\n   *\n   * @returns The AST node holding the previous input or field.\n   */\n  private findPrevForField_(): ASTNode|null {\n    const location = this.location_ as Field;\n    const parentInput = location.getParentInput();\n    const block = location.getSourceBlock();\n    if (!block) {\n      throw new Error(\n          'The current AST location is not associated with a block');\n    }\n    const curIdx = block.inputList.indexOf(parentInput);\n    let fieldIdx = parentInput.fieldRow.indexOf(location) - 1;\n    for (let i = curIdx; i >= 0; i--) {\n      const input = block.inputList[i];\n      if (input.connection && input !== parentInput) {\n        return ASTNode.createInputNode(input);\n      }\n      const fieldRow = input.fieldRow;\n      while (fieldIdx > -1) {\n        if (fieldRow[fieldIdx].isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(fieldRow[fieldIdx]);\n        }\n        fieldIdx--;\n      }\n      // Reset the fieldIdx to the length of the field row of the previous\n      // input.\n      if (i - 1 >= 0) {\n        fieldIdx = block.inputList[i - 1].fieldRow.length - 1;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Navigate between stacks of blocks on the workspace.\n   *\n   * @param forward True to go forward. False to go backwards.\n   * @returns The first block of the next stack or null if there are no blocks\n   *     on the workspace.\n   */\n  private navigateBetweenStacks_(forward: boolean): ASTNode|null {\n    let curLocation = this.getLocation();\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    if ((curLocation as IASTNodeLocationWithBlock).getSourceBlock) {\n      const block = (curLocation as IASTNodeLocationWithBlock).getSourceBlock();\n      if (block) {\n        curLocation = block;\n      }\n    }\n    // TODO(#6097): Use instanceof checks to exit early for values of\n    // curLocation that don't make sense.\n    const curLocationAsBlock = curLocation as Block;\n    if (!curLocationAsBlock || curLocationAsBlock.isDeadOrDying()) {\n      return null;\n    }\n    const curRoot = curLocationAsBlock.getRootBlock();\n    const topBlocks = curRoot.workspace.getTopBlocks(true);\n    for (let i = 0; i < topBlocks.length; i++) {\n      const topBlock = topBlocks[i];\n      if (curRoot.id === topBlock.id) {\n        const offset = forward ? 1 : -1;\n        const resultIndex = i + offset;\n        if (resultIndex === -1 || resultIndex === topBlocks.length) {\n          return null;\n        }\n        return ASTNode.createStackNode(topBlocks[resultIndex]);\n      }\n    }\n    throw Error(\n        'Couldn\\'t find ' + (forward ? 'next' : 'previous') + ' stack?!');\n  }\n\n  /**\n   * Finds the top most AST node for a given block.\n   * This is either the previous connection, output connection or block\n   * depending on what kind of connections the block has.\n   *\n   * @param block The block that we want to find the top connection on.\n   * @returns The AST node containing the top connection.\n   */\n  private findTopASTNodeForBlock_(block: Block): ASTNode|null {\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      return ASTNode.createConnectionNode(topConnection);\n    } else {\n      return ASTNode.createBlockNode(block);\n    }\n  }\n\n  /**\n   * Get the AST node pointing to the input that the block is nested under or if\n   * the block is not nested then get the stack AST node.\n   *\n   * @param block The source block of the current location.\n   * @returns The AST node pointing to the input connection or the top block of\n   *     the stack this block is in.\n   */\n  private getOutAstNodeForBlock_(block: Block): ASTNode|null {\n    if (!block) {\n      return null;\n    }\n    // If the block doesn't have a previous connection then it is the top of the\n    // substack.\n    const topBlock = block.getTopStackBlock();\n    const topConnection = getParentConnection(topBlock);\n    // If the top connection has a parentInput, create an AST node pointing to\n    // that input.\n    if (topConnection && topConnection.targetConnection &&\n        topConnection.targetConnection.getParentInput()) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n          topConnection.targetConnection.getParentInput() as\n          AnyDuringMigration);\n    } else {\n      // Go to stack level if you are not underneath an input.\n      return ASTNode.createStackNode(topBlock);\n    }\n  }\n\n  /**\n   * Find the first editable field or input with a connection on a given block.\n   *\n   * @param block The source block of the current location.\n   * @returns An AST node pointing to the first field or input.\n   * Null if there are no editable fields or inputs with connections on the\n   * block.\n   */\n  private findFirstFieldOrInput_(block: Block): ASTNode|null {\n    const inputs = block.inputList;\n    for (let i = 0; i < inputs.length; i++) {\n      const input = inputs[i];\n      const fieldRow = input.fieldRow;\n      for (let j = 0; j < fieldRow.length; j++) {\n        const field = fieldRow[j];\n        if (field.isClickable() || ASTNode.NAVIGATE_ALL_FIELDS) {\n          return ASTNode.createFieldNode(field);\n        }\n      }\n      if (input.connection) {\n        return ASTNode.createInputNode(input);\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Finds the source block of the location of this node.\n   *\n   * @returns The source block of the location, or null if the node is of type\n   *     workspace.\n   */\n  getSourceBlock(): Block|null {\n    if (this.getType() === ASTNode.types.BLOCK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.STACK) {\n      return this.getLocation() as Block;\n    } else if (this.getType() === ASTNode.types.WORKSPACE) {\n      return null;\n    } else {\n      return (this.getLocation() as IASTNodeLocationWithBlock).getSourceBlock();\n    }\n  }\n\n  /**\n   * Find the element to the right of the current element in the AST.\n   *\n   * @returns An AST node that wraps the next field, connection, block, or\n   *     workspace. Or null if there is no node to the right.\n   */\n  next(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks_(true);\n\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD:\n        return this.findNextForField_();\n\n      case ASTNode.types.INPUT:\n        return this.findNextForInput_();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        const nextConnection = block.nextConnection;\n        if (!nextConnection) return null;\n        return ASTNode.createConnectionNode(nextConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location_ as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element one level below and all the way to the left of the current\n   * location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace, or\n   *     block. Or null if there is nothing below this node.\n   */\n  in(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.WORKSPACE: {\n        const workspace = this.location_ as Workspace;\n        const topBlocks = workspace.getTopBlocks(true);\n        if (topBlocks.length > 0) {\n          return ASTNode.createStackNode(topBlocks[0]);\n        }\n        break;\n      }\n      case ASTNode.types.STACK: {\n        const block = this.location_ as Block;\n        return this.findTopASTNodeForBlock_(block);\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        return this.findFirstFieldOrInput_(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location_ as Connection;\n        const targetConnection = connection.targetConnection;\n        return ASTNode.createConnectionNode(targetConnection!);\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the element to the left of the current element in the AST.\n   *\n   * @returns An AST node that wraps the previous field, connection, workspace\n   *     or block. Or null if no node exists to the left. null.\n   */\n  prev(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.STACK:\n        return this.navigateBetweenStacks_(false);\n\n      case ASTNode.types.OUTPUT:\n        return null;\n\n      case ASTNode.types.FIELD:\n        return this.findPrevForField_();\n\n      case ASTNode.types.INPUT:\n        return this.findPrevForInput_();\n\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        const topConnection = getParentConnection(block);\n        if (!topConnection) return null;\n        return ASTNode.createConnectionNode(topConnection);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location_ as Connection;\n        const targetConnection = connection.targetConnection;\n        if (targetConnection && !targetConnection.getParentInput()) {\n          return ASTNode.createConnectionNode(targetConnection);\n        }\n        break;\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Find the next element that is one position above and all the way to the\n   * left of the current location.\n   *\n   * @returns An AST node that wraps the next field, connection, workspace or\n   *     block. Or null if we are at the workspace level.\n   */\n  out(): ASTNode|null {\n    switch (this.type_) {\n      case ASTNode.types.STACK: {\n        const block = this.location_ as Block;\n        const blockPos = block.getRelativeToSurfaceXY();\n        // TODO: Make sure this is in the bounds of the workspace.\n        const wsCoordinate =\n            new Coordinate(blockPos.x, blockPos.y + ASTNode.DEFAULT_OFFSET_Y);\n        return ASTNode.createWorkspaceNode(block.workspace, wsCoordinate);\n      }\n      case ASTNode.types.OUTPUT: {\n        const connection = this.location_ as Connection;\n        const target = connection.targetConnection;\n        if (target) {\n          return ASTNode.createConnectionNode(target);\n        }\n        return ASTNode.createStackNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.FIELD: {\n        const field = this.location_ as Field;\n        const block = field.getSourceBlock();\n        if (!block) {\n          throw new Error(\n              'The current AST location is not associated with a block');\n        }\n        return ASTNode.createBlockNode(block);\n      }\n      case ASTNode.types.INPUT: {\n        const connection = this.location_ as Connection;\n        return ASTNode.createBlockNode(connection.getSourceBlock());\n      }\n      case ASTNode.types.BLOCK: {\n        const block = this.location_ as Block;\n        return this.getOutAstNodeForBlock_(block);\n      }\n      case ASTNode.types.PREVIOUS: {\n        const connection = this.location_ as Connection;\n        return this.getOutAstNodeForBlock_(connection.getSourceBlock());\n      }\n      case ASTNode.types.NEXT: {\n        const connection = this.location_ as Connection;\n        return this.getOutAstNodeForBlock_(connection.getSourceBlock());\n      }\n    }\n\n    return null;\n  }\n\n  /**\n   * Whether an AST node of the given type points to a connection.\n   *\n   * @param type The type to check.  One of ASTNode.types.\n   * @returns True if a node of the given type points to a connection.\n   */\n  private static isConnectionType_(type: string): boolean {\n    switch (type) {\n      case ASTNode.types.PREVIOUS:\n      case ASTNode.types.NEXT:\n      case ASTNode.types.INPUT:\n      case ASTNode.types.OUTPUT:\n        return true;\n    }\n    return false;\n  }\n\n  /**\n   * Create an AST node pointing to a field.\n   *\n   * @param field The location of the AST node.\n   * @returns An AST node pointing to a field.\n   */\n  static createFieldNode(field: Field): ASTNode|null {\n    if (!field) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.FIELD, field);\n  }\n\n  /**\n   * Creates an AST node pointing to a connection. If the connection has a\n   * parent input then create an AST node of type input that will hold the\n   * connection.\n   *\n   * @param connection This is the connection the node will point to.\n   * @returns An AST node pointing to a connection.\n   */\n  static createConnectionNode(connection: Connection): ASTNode|null {\n    if (!connection) {\n      return null;\n    }\n    const type = connection.type;\n    if (type === ConnectionType.INPUT_VALUE) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n          connection.getParentInput() as AnyDuringMigration);\n    } else if (\n        type === ConnectionType.NEXT_STATEMENT && connection.getParentInput()) {\n      // AnyDuringMigration because:  Argument of type 'Input | null' is not\n      // assignable to parameter of type 'Input'.\n      return ASTNode.createInputNode(\n          connection.getParentInput() as AnyDuringMigration);\n    } else if (type === ConnectionType.NEXT_STATEMENT) {\n      return new ASTNode(ASTNode.types.NEXT, connection);\n    } else if (type === ConnectionType.OUTPUT_VALUE) {\n      return new ASTNode(ASTNode.types.OUTPUT, connection);\n    } else if (type === ConnectionType.PREVIOUS_STATEMENT) {\n      return new ASTNode(ASTNode.types.PREVIOUS, connection);\n    }\n    return null;\n  }\n\n  /**\n   * Creates an AST node pointing to an input. Stores the input connection as\n   * the location.\n   *\n   * @param input The input used to create an AST node.\n   * @returns An AST node pointing to a input.\n   */\n  static createInputNode(input: Input): ASTNode|null {\n    if (!input || !input.connection) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.INPUT, input.connection);\n  }\n\n  /**\n   * Creates an AST node pointing to a block.\n   *\n   * @param block The block used to create an AST node.\n   * @returns An AST node pointing to a block.\n   */\n  static createBlockNode(block: Block): ASTNode|null {\n    if (!block) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.BLOCK, block);\n  }\n\n  /**\n   * Create an AST node of type stack. A stack, represented by its top block, is\n   *     the set of all blocks connected to a top block, including the top\n   * block.\n   *\n   * @param topBlock A top block has no parent and can be found in the list\n   *     returned by workspace.getTopBlocks().\n   * @returns An AST node of type stack that points to the top block on the\n   *     stack.\n   */\n  static createStackNode(topBlock: Block): ASTNode|null {\n    if (!topBlock) {\n      return null;\n    }\n    return new ASTNode(ASTNode.types.STACK, topBlock);\n  }\n\n  /**\n   * Creates an AST node pointing to a workspace.\n   *\n   * @param workspace The workspace that we are on.\n   * @param wsCoordinate The position on the workspace for this node.\n   * @returns An AST node pointing to a workspace and a position on the\n   *     workspace.\n   */\n  static createWorkspaceNode(\n      workspace: Workspace|null, wsCoordinate: Coordinate|null): ASTNode|null {\n    if (!wsCoordinate || !workspace) {\n      return null;\n    }\n    const params = {wsCoordinate};\n    return new ASTNode(ASTNode.types.WORKSPACE, workspace, params);\n  }\n\n  /**\n   * Creates an AST node for the top position on a block.\n   * This is either an output connection, previous connection, or block.\n   *\n   * @param block The block to find the top most AST node on.\n   * @returns The AST node holding the top most position on the block.\n   */\n  static createTopNode(block: Block): ASTNode|null {\n    let astNode;\n    const topConnection = getParentConnection(block);\n    if (topConnection) {\n      astNode = ASTNode.createConnectionNode(topConnection);\n    } else {\n      astNode = ASTNode.createBlockNode(block);\n    }\n    return astNode;\n  }\n}\n\nexport namespace ASTNode {\n  export interface Params {\n    wsCoordinate: Coordinate;\n  }\n\n  export enum types {\n    FIELD = 'field',\n    BLOCK = 'block',\n    INPUT = 'input',\n    OUTPUT = 'output',\n    NEXT = 'next',\n    PREVIOUS = 'previous',\n    STACK = 'stack',\n    WORKSPACE = 'workspace',\n  }\n}\n\nexport type Params = ASTNode.Params;\n// No need to export ASTNode.types from the module at this time because (1) it\n// wasn't automatically converted by the automatic migration script, (2) the\n// name doesn't follow the styleguide.\n\n\n/**\n * Gets the parent connection on a block.\n * This is either an output connection, previous connection or undefined.\n * If both connections exist return the one that is actually connected\n * to another block.\n *\n * @param block The block to find the parent connection on.\n * @returns The connection connecting to the parent of the block.\n */\nfunction getParentConnection(block: Block): Connection|null {\n  let topConnection = block.outputConnection;\n  if (!topConnection ||\n      block.previousConnection && block.previousConnection.isConnected()) {\n    topConnection = block.previousConnection;\n  }\n  return topConnection;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.svgPaths');\n\n\n/**\n * Create a string representing the given x, y pair.  It does not matter whether\n * the coordinate is relative or absolute.  The result has leading\n * and trailing spaces, and separates the x and y coordinates with a comma but\n * no space.\n *\n * @param x The x coordinate.\n * @param y The y coordinate.\n * @returns A string of the format ' x,y '\n */\nexport function point(x: number, y: number): string {\n  return ' ' + x + ',' + y + ' ';\n}\n\n/**\n * Draw a cubic or quadratic curve.  See\n * developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Cubic_B%C3%A9zier_Curve\n * These coordinates are unitless and hence in the user coordinate system.\n *\n * @param command The command to use.\n *     Should be one of: c, C, s, S, q, Q.\n * @param points  An array containing all of the points to pass to the curve\n *     command, in order.  The points are represented as strings of the format '\n *     x, y '.\n * @returns A string defining one or more Bezier curves.  See the MDN\n *     documentation for exact format.\n */\nexport function curve(command: string, points: string[]): string {\n  return ' ' + command + points.join('');\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * The coordinates are absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param x The absolute x coordinate.\n * @param y The absolute y coordinate.\n * @returns A string of the format ' M x,y '\n */\nexport function moveTo(x: number, y: number): string {\n  return ' M ' + x + ',' + y + ' ';\n}\n\n/**\n * Move the cursor to the given position without drawing a line.\n * Coordinates are relative.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' m dx,dy '\n */\nexport function moveBy(dx: number, dy: number): string {\n  return ' m ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw a line from the current point to the end point, which is the current\n * point shifted by dx along the x-axis and dy along the y-axis.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param dx The relative x coordinate.\n * @param dy The relative y coordinate.\n * @returns A string of the format ' l dx,dy '\n */\nexport function lineTo(dx: number, dy: number): string {\n  return ' l ' + dx + ',' + dy + ' ';\n}\n\n/**\n * Draw multiple lines connecting all of the given points in order.  This is\n * equivalent to a series of 'l' commands.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Tutorial/Paths#Line_commands\n *\n * @param points An array containing all of the points to draw lines to, in\n *     order.  The points are represented as strings of the format ' dx,dy '.\n * @returns A string of the format ' l (dx,dy)+ '\n */\nexport function line(points: string[]): string {\n  return ' l' + points.join('');\n}\n\n/**\n * Draw a horizontal or vertical line.\n * The first argument specifies the direction and whether the given position is\n * relative or absolute.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#LineTo_path_commands\n *\n * @param command The command to prepend to the coordinate.  This should be one\n *     of: V, v, H, h.\n * @param val The coordinate to pass to the command.  It may be absolute or\n *     relative.\n * @returns A string of the format ' command val '\n */\nexport function lineOnAxis(command: string, val: number): string {\n  return ' ' + command + ' ' + val + ' ';\n}\n\n/**\n * Draw an elliptical arc curve.\n * These coordinates are unitless and hence in the user coordinate system.\n * See developer.mozilla.org/en-US/docs/Web/SVG/Attribute/d#Elliptical_Arc_Curve\n *\n * @param command The command string.  Either 'a' or 'A'.\n * @param flags The flag string.  See the MDN documentation for a description\n *     and examples.\n * @param radius The radius of the arc to draw.\n * @param point The point to move the cursor to after drawing the arc, specified\n *     either in absolute or relative coordinates depending on the command.\n * @returns A string of the format 'command radius radius flags point'\n */\nexport function arc(\n    command: string, flags: string, radius: number, point: string): string {\n  return command + ' ' + radius + ' ' + radius + ' ' + flags + point;\n}\n", "/**\n * @license\n * Copyright 2023 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {BlockSvg} from './block_svg.js';\nimport {Coordinate} from './utils/coordinate.js';\n\n\nconst rootBlocks = new Set<BlockSvg>();\nlet dirtyBlocks = new WeakSet<BlockSvg>();\nlet pid = 0;\n\n/**\n * Registers that the given block and all of its parents need to be rerendered,\n * and registers a callback to do so after a delay, to allowf or batching.\n *\n * @param block The block to rerender.\n * @internal\n */\nexport function queueRender(block: BlockSvg) {\n  queueBlock(block);\n  if (!pid) pid = window.requestAnimationFrame(doRenders);\n}\n\n/**\n * Adds the given block and its parents to the render queue. Adds the root block\n * to the list of root blocks.\n *\n * @param block The block to queue.\n */\nfunction queueBlock(block: BlockSvg) {\n  dirtyBlocks.add(block);\n  const parent = block.getParent();\n  if (parent) {\n    queueBlock(parent);\n  } else {\n    rootBlocks.add(block);\n  }\n}\n\n/**\n * Rerenders all of the blocks in the queue.\n */\nfunction doRenders() {\n  const workspaces = new Set([...rootBlocks].map((block) => block.workspace));\n  for (const block of rootBlocks) {\n    // No need to render a dead block.\n    if (block.isDisposed()) continue;\n    // A render for this block may have been queued, and then the block was\n    // connected to a parent, so it is no longer a root block.\n    // Rendering will be triggered through the real root block.\n    if (block.getParent()) continue;\n\n    renderBlock(block);\n    updateConnectionLocations(block, block.getRelativeToSurfaceXY());\n    updateIconLocations(block);\n  }\n  for (const workspace of workspaces) {\n    workspace.resizeContents();\n  }\n\n  rootBlocks.clear();\n  dirtyBlocks = new Set();\n  pid = 0;\n}\n\n/**\n * Recursively renders all of the dirty children of the given block, and\n * then renders the block.\n *\n * @param block The block to rerender.\n */\nfunction renderBlock(block: BlockSvg) {\n  if (!dirtyBlocks.has(block)) return;\n  for (const child of block.getChildren(false)) {\n    renderBlock(child);\n  }\n  block.renderEfficiently();\n}\n\n/**\n * Updates the connection database with the new locations of all of the\n * connections that are children of the given block.\n *\n * @param block The block to update the connection locations of.\n * @param blockOrigin The top left of the given block in workspace coordinates.\n */\nfunction updateConnectionLocations(block: BlockSvg, blockOrigin: Coordinate) {\n  for (const conn of block.getConnections_(false)) {\n    const moved = conn.moveToOffset(blockOrigin);\n    const target = conn.targetBlock();\n    if (!conn.isSuperior()) continue;\n    if (!target) continue;\n    if (moved || dirtyBlocks.has(target)) {\n      updateConnectionLocations(\n          target, Coordinate.sum(blockOrigin, target.relativeCoords));\n    }\n  }\n}\n\n/**\n * Updates all icons that are children of the given block with their new\n * locations.\n *\n * @param block The block to update the icon locations of.\n */\nfunction updateIconLocations(block: BlockSvg) {\n  if (!block.getIcons) return;\n  for (const icon of block.getIcons()) {\n    icon.computeIconLocation();\n  }\n  for (const child of block.getChildren(false)) {\n    updateIconLocations(child);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ContextMenuItems');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport {ContextMenuRegistry, RegistryItem, Scope} from './contextmenu_registry.js';\nimport * as dialog from './dialog.js';\nimport * as Events from './events/events.js';\nimport * as eventUtils from './events/utils.js';\nimport {inputTypes} from './input_types.js';\nimport {Msg} from './msg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Option to undo previous action.\n */\nexport function registerUndo() {\n  const undoOption: RegistryItem = {\n    displayText() {\n      return Msg['UNDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getUndoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(false);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'undoWorkspace',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(undoOption);\n}\n\n/**\n * Option to redo previous action.\n */\nexport function registerRedo() {\n  const redoOption: RegistryItem = {\n    displayText() {\n      return Msg['REDO'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.getRedoStack().length > 0) {\n        return 'enabled';\n      }\n      return 'disabled';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.undo(true);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'redoWorkspace',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(redoOption);\n}\n\n/**\n * Option to clean up blocks.\n */\nexport function registerCleanup() {\n  const cleanOption: RegistryItem = {\n    displayText() {\n      return Msg['CLEAN_UP'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.isMovable()) {\n        if (scope.workspace!.getTopBlocks(false).length > 1) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.workspace!.cleanUp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'cleanWorkspace',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(cleanOption);\n}\n/**\n * Creates a callback to collapse or expand top blocks.\n *\n * @param shouldCollapse Whether a block should collapse.\n * @param topBlocks Top blocks in the workspace.\n */\nfunction toggleOption_(shouldCollapse: boolean, topBlocks: BlockSvg[]) {\n  const DELAY = 10;\n  let ms = 0;\n  let timeoutCounter = 0;\n  function timeoutFn(block: BlockSvg) {\n    timeoutCounter--;\n    block.setCollapsed(shouldCollapse);\n    if (timeoutCounter === 0) {\n      Events.setGroup(false);\n    }\n  }\n  Events.setGroup(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    let block: BlockSvg|null = topBlocks[i];\n    while (block) {\n      timeoutCounter++;\n      setTimeout(timeoutFn.bind(null, block), ms);\n      block = block.getNextBlock();\n      ms += DELAY;\n    }\n  }\n}\n\n/**\n * Option to collapse all blocks.\n */\nexport function registerCollapse() {\n  const collapseOption: RegistryItem = {\n    displayText() {\n      return Msg['COLLAPSE_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg|null = topBlocks[i];\n          while (block) {\n            if (!block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(true, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'collapseWorkspace',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseOption);\n}\n\n/**\n * Option to expand all blocks.\n */\nexport function registerExpand() {\n  const expandOption: RegistryItem = {\n    displayText() {\n      return Msg['EXPAND_ALL'];\n    },\n    preconditionFn(scope: Scope) {\n      if (scope.workspace!.options.collapse) {\n        const topBlocks = scope.workspace!.getTopBlocks(false);\n        for (let i = 0; i < topBlocks.length; i++) {\n          let block: BlockSvg|null = topBlocks[i];\n          while (block) {\n            if (block.isCollapsed()) {\n              return 'enabled';\n            }\n            block = block.getNextBlock();\n          }\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      toggleOption_(false, scope.workspace!.getTopBlocks(true));\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'expandWorkspace',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(expandOption);\n}\n/**\n * Adds a block and its children to a list of deletable blocks.\n *\n * @param block to delete.\n * @param deleteList list of blocks that can be deleted.\n *     This will be modified in place with the given block and its descendants.\n */\nfunction addDeletableBlocks_(block: BlockSvg, deleteList: BlockSvg[]) {\n  if (block.isDeletable()) {\n    Array.prototype.push.apply(deleteList, block.getDescendants(false));\n  } else {\n    const children = block.getChildren(false);\n    for (let i = 0; i < children.length; i++) {\n      addDeletableBlocks_(children[i], deleteList);\n    }\n  }\n}\n\n/**\n * Constructs a list of blocks that can be deleted in the given workspace.\n *\n * @param workspace to delete all blocks from.\n * @returns list of blocks to delete.\n */\nfunction getDeletableBlocks_(workspace: WorkspaceSvg): BlockSvg[] {\n  const deleteList: BlockSvg[] = [];\n  const topBlocks = workspace.getTopBlocks(true);\n  for (let i = 0; i < topBlocks.length; i++) {\n    addDeletableBlocks_(topBlocks[i], deleteList);\n  }\n  return deleteList;\n}\n\n/**\n * Deletes the given blocks. Used to delete all blocks in the workspace.\n *\n * @param deleteList List of blocks to delete.\n * @param eventGroup Event group ID with which all delete events should be\n *     associated.  If not specified, create a new group.\n */\nfunction deleteNext_(deleteList: BlockSvg[], eventGroup?: string) {\n  const DELAY = 10;\n  if (eventGroup) {\n    eventUtils.setGroup(eventGroup);\n  } else {\n    eventUtils.setGroup(true);\n    eventGroup = eventUtils.getGroup();\n  }\n  const block = deleteList.shift();\n  if (block) {\n    if (!block.isDeadOrDying()) {\n      block.dispose(false, true);\n      setTimeout(deleteNext_, DELAY, deleteList, eventGroup);\n    } else {\n      deleteNext_(deleteList, eventGroup);\n    }\n  }\n  eventUtils.setGroup(false);\n}\n\n/**\n * Option to delete all blocks.\n */\nexport function registerDeleteAll() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (!scope.workspace) {\n        return '';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      if (deletableBlocksLength === 1) {\n        return Msg['DELETE_BLOCK'];\n      }\n      return Msg['DELETE_X_BLOCKS'].replace('%1', `${deletableBlocksLength}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.workspace) {\n        return 'disabled';\n      }\n      const deletableBlocksLength = getDeletableBlocks_(scope.workspace).length;\n      return deletableBlocksLength > 0 ? 'enabled' : 'disabled';\n    },\n    callback(scope: Scope) {\n      if (!scope.workspace) {\n        return;\n      }\n      scope.workspace.cancelCurrentGesture();\n      const deletableBlocks = getDeletableBlocks_(scope.workspace);\n      if (deletableBlocks.length < 2) {\n        deleteNext_(deletableBlocks);\n      } else {\n        dialog.confirm(\n            Msg['DELETE_ALL_BLOCKS'].replace(\n                '%1', String(deletableBlocks.length)),\n            function(ok) {\n              if (ok) {\n                deleteNext_(deletableBlocks);\n              }\n            });\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.WORKSPACE,\n    id: 'workspaceDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n/** Registers all workspace-scoped context menu items. */\nfunction registerWorkspaceOptions_() {\n  registerUndo();\n  registerRedo();\n  registerCleanup();\n  registerCollapse();\n  registerExpand();\n  registerDeleteAll();\n}\n\n/**\n * Option to duplicate a block.\n */\nexport function registerDuplicate() {\n  const duplicateOption: RegistryItem = {\n    displayText() {\n      return Msg['DUPLICATE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isDeletable() && block!.isMovable()) {\n        if (block!.isDuplicatable()) {\n          return 'enabled';\n        }\n        return 'disabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        clipboard.duplicate(scope.block);\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDuplicate',\n    weight: 1,\n  };\n  ContextMenuRegistry.registry.register(duplicateOption);\n}\n\n/**\n * Option to add or remove block-level comment.\n */\nexport function registerComment() {\n  const commentOption: RegistryItem = {\n    displayText(scope: Scope) {\n      if (scope.block!.getCommentIcon()) {\n        // If there's already a comment,  option is to remove.\n        return Msg['REMOVE_COMMENT'];\n      }\n      // If there's no comment yet, option is to add.\n      return Msg['ADD_COMMENT'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.workspace.options.comments &&\n          !block!.isCollapsed() && block!.isEditable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      if (block!.getCommentIcon()) {\n        block!.setCommentText(null);\n      } else {\n        block!.setCommentText('');\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockComment',\n    weight: 2,\n  };\n  ContextMenuRegistry.registry.register(commentOption);\n}\n\n/**\n * Option to inline variables.\n */\nexport function registerInline() {\n  const inlineOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.getInputsInline() ? Msg['EXTERNAL_INPUTS'] :\n                                              Msg['INLINE_INPUTS'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() && !block!.isCollapsed()) {\n        for (let i = 1; i < block!.inputList.length; i++) {\n          // Only display this option if there are two value or dummy inputs\n          // next to each other.\n          if (block!.inputList[i - 1].type !== inputTypes.STATEMENT &&\n              block!.inputList[i].type !== inputTypes.STATEMENT) {\n            return 'enabled';\n          }\n        }\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setInputsInline(!scope.block!.getInputsInline());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockInline',\n    weight: 3,\n  };\n  ContextMenuRegistry.registry.register(inlineOption);\n}\n\n/**\n * Option to collapse or expand a block.\n */\nexport function registerCollapseExpandBlock() {\n  const collapseExpandOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isCollapsed() ? Msg['EXPAND_BLOCK'] :\n                                          Msg['COLLAPSE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.isMovable() &&\n          block!.workspace.options.collapse) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.setCollapsed(!scope.block!.isCollapsed());\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockCollapseExpand',\n    weight: 4,\n  };\n  ContextMenuRegistry.registry.register(collapseExpandOption);\n}\n\n/**\n * Option to disable or enable a block.\n */\nexport function registerDisable() {\n  const disableOption: RegistryItem = {\n    displayText(scope: Scope) {\n      return scope.block!.isEnabled() ? Msg['DISABLE_BLOCK'] :\n                                        Msg['ENABLE_BLOCK'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      if (!block!.isInFlyout && block!.workspace.options.disable &&\n          block!.isEditable()) {\n        if (block!.getInheritedDisabled()) {\n          return 'disabled';\n        }\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      const block = scope.block;\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      block!.setEnabled(!block!.isEnabled());\n      eventUtils.setGroup(existingGroup);\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDisable',\n    weight: 5,\n  };\n  ContextMenuRegistry.registry.register(disableOption);\n}\n\n/**\n * Option to delete a block.\n */\nexport function registerDelete() {\n  const deleteOption: RegistryItem = {\n    displayText(scope: Scope) {\n      const block = scope.block;\n      // Count the number of blocks that are nested in this block.\n      let descendantCount = block!.getDescendants(false).length;\n      const nextBlock = block!.getNextBlock();\n      if (nextBlock) {\n        // Blocks in the current stack would survive this block's deletion.\n        descendantCount -= nextBlock.getDescendants(false).length;\n      }\n      return descendantCount === 1 ?\n          Msg['DELETE_BLOCK'] :\n          Msg['DELETE_X_BLOCKS'].replace('%1', `${descendantCount}`);\n    },\n    preconditionFn(scope: Scope) {\n      if (!scope.block!.isInFlyout && scope.block!.isDeletable()) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      if (scope.block) {\n        scope.block.checkAndDelete();\n      }\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockDelete',\n    weight: 6,\n  };\n  ContextMenuRegistry.registry.register(deleteOption);\n}\n\n/**\n * Option to open help for a block.\n */\nexport function registerHelp() {\n  const helpOption: RegistryItem = {\n    displayText() {\n      return Msg['HELP'];\n    },\n    preconditionFn(scope: Scope) {\n      const block = scope.block;\n      const url = typeof block!.helpUrl === 'function' ? block!.helpUrl() :\n                                                         block!.helpUrl;\n      if (url) {\n        return 'enabled';\n      }\n      return 'hidden';\n    },\n    callback(scope: Scope) {\n      scope.block!.showHelp();\n    },\n    scopeType: ContextMenuRegistry.ScopeType.BLOCK,\n    id: 'blockHelp',\n    weight: 7,\n  };\n  ContextMenuRegistry.registry.register(helpOption);\n}\n\n/** Registers all block-scoped context menu items. */\nfunction registerBlockOptions_() {\n  registerDuplicate();\n  registerComment();\n  registerInline();\n  registerCollapseExpandBlock();\n  registerDisable();\n  registerDelete();\n  registerHelp();\n}\n\n/**\n * Registers all default context menu items. This should be called once per\n * instance of ContextMenuRegistry.\n *\n * @internal\n */\nexport function registerDefaultOptions() {\n  registerWorkspaceOptions_();\n  registerBlockOptions_();\n}\n\nregisterDefaultOptions();\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport type {Block} from '../block.js';\nimport {IProcedureModel} from './i_procedure_model.js';\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.procedures.IProcedureBlock');\n\n\n/** The interface for a block which models a procedure. */\nexport interface IProcedureBlock {\n  getProcedureModel(): IProcedureModel;\n  doProcedureUpdate(): void;\n  isProcedureDef(): boolean;\n}\n\n/** A type guard which checks if the given block is a procedure block. */\nexport function isProcedureBlock(block: Block|\n                                 IProcedureBlock): block is IProcedureBlock {\n  return (block as IProcedureBlock).getProcedureModel !== undefined &&\n      (block as IProcedureBlock).doProcedureUpdate !== undefined &&\n      (block as IProcedureBlock).isProcedureDef !== undefined;\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n\n/**\n * An object that fires events optionally.\n *\n * @internal\n */\nexport interface IObservable {\n  startPublishing(): void;\n  stopPublishing(): void;\n}\n\n/**\n * Type guard for checking if an object fulfills IObservable.\n *\n * @internal\n */\nexport function isObservable(obj: any): obj is IObservable {\n  return obj.startPublishing !== undefined && obj.stopPublishing !== undefined;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Procedures');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport {Blocks} from './blocks.js';\nimport * as common from './common.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BubbleOpen} from './events/events_bubble_open.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport {IParameterModel} from './interfaces/i_parameter_model.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {IProcedureBlock, isProcedureBlock} from './interfaces/i_procedure_block.js';\nimport {isLegacyProcedureCallBlock, isLegacyProcedureDefBlock, ProcedureBlock, ProcedureTuple} from './interfaces/i_legacy_procedure_blocks.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.VariablesDynamic.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'PROCEDURE';\n\n/**\n * The default argument for a procedures_mutatorarg block.\n */\nexport const DEFAULT_ARG = 'x';\n\n/**\n * Find all user-created procedure definitions in a workspace.\n *\n * @param root Root workspace.\n * @returns Pair of arrays, the first contains procedures without return\n *     variables, the second with. Each procedure is defined by a three-element\n *     list of name, parameter list, and return value boolean.\n */\nexport function allProcedures(root: Workspace):\n    [ProcedureTuple[], ProcedureTuple[]] {\n  const proceduresNoReturn: ProcedureTuple[] =\n      root.getProcedureMap()\n          .getProcedures()\n          .filter((p) => !p.getReturnTypes())\n          .map(\n              (p) =>\n                  [p.getName(),\n                   p.getParameters().map((pa) => pa.getName()),\n                   false,\n  ]);\n  root.getBlocksByType('procedures_defnoreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresNoReturn.push(b.getProcedureDef());\n    }\n  });\n\n  const proceduresReturn: ProcedureTuple[] =\n      root.getProcedureMap()\n          .getProcedures()\n          .filter((p) => !!p.getReturnTypes())\n          .map(\n              (p) =>\n                  [p.getName(),\n                   p.getParameters().map((pa) => pa.getName()),\n                   true,\n  ]);\n  root.getBlocksByType('procedures_defreturn', false).forEach((b) => {\n    if (!isProcedureBlock(b) && isLegacyProcedureDefBlock(b)) {\n      proceduresReturn.push(b.getProcedureDef());\n    }\n  });\n  proceduresNoReturn.sort(procTupleComparator);\n  proceduresReturn.sort(procTupleComparator);\n  return [proceduresNoReturn, proceduresReturn];\n}\n\n/**\n * Comparison function for case-insensitive sorting of the first element of\n * a tuple.\n *\n * @param ta First tuple.\n * @param tb Second tuple.\n * @returns -1, 0, or 1 to signify greater than, equality, or less than.\n */\nfunction procTupleComparator(ta: ProcedureTuple, tb: ProcedureTuple): number {\n  return ta[0].localeCompare(tb[0], undefined, {sensitivity: 'base'});\n}\n\n/**\n * Ensure two identically-named procedures don't exist.\n * Take the proposed procedure name, and return a legal name i.e. one that\n * is not empty and doesn't collide with other procedures.\n *\n * @param name Proposed procedure name.\n * @param block Block to disambiguate.\n * @returns Non-colliding name.\n */\nexport function findLegalName(name: string, block: Block): string {\n  if (block.isInFlyout) {\n    // Flyouts can have multiple procedures called 'do something'.\n    return name;\n  }\n  name = name || Msg['UNNAMED_KEY'] || 'unnamed';\n  while (!isLegalName(name, block.workspace, block)) {\n    // Collision with another procedure.\n    const r = name.match(/^(.*?)(\\d+)$/);\n    if (!r) {\n      name += '2';\n    } else {\n      name = r[1] + (parseInt(r[2]) + 1);\n    }\n  }\n  return name;\n}\n/**\n * Does this procedure have a legal name?  Illegal names include names of\n * procedures already defined.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is legal.\n */\nfunction isLegalName(\n    name: string, workspace: Workspace, opt_exclude?: Block): boolean {\n  return !isNameUsed(name, workspace, opt_exclude);\n}\n\n/**\n * Return if the given name is already a procedure name.\n *\n * @param name The questionable name.\n * @param workspace The workspace to scan for collisions.\n * @param opt_exclude Optional block to exclude from comparisons (one doesn't\n *     want to collide with oneself).\n * @returns True if the name is used, otherwise return false.\n */\nexport function isNameUsed(\n    name: string, workspace: Workspace, opt_exclude?: Block): boolean {\n  for (const block of workspace.getAllBlocks(false)) {\n    if (block === opt_exclude) continue;\n\n    if (isLegacyProcedureDefBlock(block) &&\n        Names.equals(block.getProcedureDef()[0], name)) {\n      return true;\n    }\n  }\n\n  const excludeModel = opt_exclude && isProcedureBlock(opt_exclude) ?\n      opt_exclude?.getProcedureModel() :\n      undefined;\n  for (const model of workspace.getProcedureMap().getProcedures()) {\n    if (model === excludeModel) continue;\n    if (Names.equals(model.getName(), name)) return true;\n  }\n  return false;\n}\n\n/**\n * Rename a procedure.  Called by the editable field.\n *\n * @param name The proposed new name.\n * @returns The accepted name.\n */\nexport function rename(this: Field, name: string): string {\n  const block = this.getSourceBlock();\n  if (!block) {\n    throw new UnattachedFieldError();\n  }\n\n  // Strip leading and trailing whitespace.  Beyond this, all names are legal.\n  name = name.trim();\n\n  const legalName = findLegalName(name, block);\n  if (isProcedureBlock(block) && !block.isInsertionMarker()) {\n    block.getProcedureModel().setName(legalName);\n  }\n  const oldName = this.getValue();\n  if (oldName !== name && oldName !== legalName) {\n    // Rename any callers.\n    const blocks = block.workspace.getAllBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      // Assume it is a procedure so we can check.\n      const procedureBlock = blocks[i] as unknown as ProcedureBlock;\n      if (procedureBlock.renameProcedure) {\n        procedureBlock.renameProcedure(oldName as string, legalName);\n      }\n    }\n  }\n  return legalName;\n}\n\n/**\n * Construct the blocks required by the flyout for the procedure category.\n *\n * @param workspace The workspace containing procedures.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  const xmlList = [];\n  if (Blocks['procedures_defnoreturn']) {\n    // <block type=\"procedures_defnoreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defnoreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n        utilsXml.createTextNode(Msg['PROCEDURES_DEFNORETURN_PROCEDURE']));\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_defreturn']) {\n    // <block type=\"procedures_defreturn\" gap=\"16\">\n    //     <field name=\"NAME\">do something</field>\n    // </block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_defreturn');\n    block.setAttribute('gap', '16');\n    const nameField = utilsXml.createElement('field');\n    nameField.setAttribute('name', 'NAME');\n    nameField.appendChild(\n        utilsXml.createTextNode(Msg['PROCEDURES_DEFRETURN_PROCEDURE']));\n    block.appendChild(nameField);\n    xmlList.push(block);\n  }\n  if (Blocks['procedures_ifreturn']) {\n    // <block type=\"procedures_ifreturn\" gap=\"16\"></block>\n    const block = utilsXml.createElement('block');\n    block.setAttribute('type', 'procedures_ifreturn');\n    block.setAttribute('gap', '16');\n    xmlList.push(block);\n  }\n  if (xmlList.length) {\n    // Add slightly larger gap between system blocks and user calls.\n    xmlList[xmlList.length - 1].setAttribute('gap', '24');\n  }\n\n  /**\n   * Add items to xmlList for each listed procedure.\n   *\n   * @param procedureList A list of procedures, each of which is defined by a\n   *     three-element list of name, parameter list, and return value boolean.\n   * @param templateName The type of the block to generate.\n   */\n  function populateProcedures(\n      procedureList: ProcedureTuple[], templateName: string) {\n    for (let i = 0; i < procedureList.length; i++) {\n      const name = procedureList[i][0];\n      const args = procedureList[i][1];\n      // <block type=\"procedures_callnoreturn\" gap=\"16\">\n      //   <mutation name=\"do something\">\n      //     <arg name=\"x\"></arg>\n      //   </mutation>\n      // </block>\n      const block = utilsXml.createElement('block');\n      block.setAttribute('type', templateName);\n      block.setAttribute('gap', '16');\n      const mutation = utilsXml.createElement('mutation');\n      mutation.setAttribute('name', name);\n      block.appendChild(mutation);\n      for (let j = 0; j < args.length; j++) {\n        const arg = utilsXml.createElement('arg');\n        arg.setAttribute('name', args[j]);\n        mutation.appendChild(arg);\n      }\n      xmlList.push(block);\n    }\n  }\n\n  const tuple = allProcedures(workspace);\n  populateProcedures(tuple[0], 'procedures_callnoreturn');\n  populateProcedures(tuple[1], 'procedures_callreturn');\n  return xmlList;\n}\n\n/**\n * Updates the procedure mutator's flyout so that the arg block is not a\n * duplicate of another arg.\n *\n * @param workspace The procedure mutator's workspace. This workspace's flyout\n *     is what is being updated.\n */\nfunction updateMutatorFlyout(workspace: WorkspaceSvg) {\n  const usedNames = [];\n  const blocks = workspace.getBlocksByType('procedures_mutatorarg', false);\n  for (let i = 0, block; block = blocks[i]; i++) {\n    usedNames.push(block.getFieldValue('NAME'));\n  }\n\n  const xmlElement = utilsXml.createElement('xml');\n  const argBlock = utilsXml.createElement('block');\n  argBlock.setAttribute('type', 'procedures_mutatorarg');\n  const nameField = utilsXml.createElement('field');\n  nameField.setAttribute('name', 'NAME');\n  const argValue =\n      Variables.generateUniqueNameFromOptions(DEFAULT_ARG, usedNames);\n  const fieldContent = utilsXml.createTextNode(argValue);\n\n  nameField.appendChild(fieldContent);\n  argBlock.appendChild(nameField);\n  xmlElement.appendChild(argBlock);\n\n  workspace.updateToolbox(xmlElement);\n}\n\n/**\n * Listens for when a procedure mutator is opened. Then it triggers a flyout\n * update and adds a mutator change listener to the mutator workspace.\n *\n * @param e The event that triggered this listener.\n * @internal\n */\nexport function mutatorOpenListener(e: Abstract) {\n  if (e.type !== eventUtils.BUBBLE_OPEN) {\n    return;\n  }\n  const bubbleEvent = e as BubbleOpen;\n  if (!(bubbleEvent.bubbleType === 'mutator' && bubbleEvent.isOpen) ||\n      !bubbleEvent.blockId) {\n    return;\n  }\n  const workspaceId = (bubbleEvent.workspaceId);\n  const block = common.getWorkspaceById(workspaceId)!.getBlockById(\n                    bubbleEvent.blockId) as BlockSvg;\n  const type = block.type;\n  if (type !== 'procedures_defnoreturn' && type !== 'procedures_defreturn') {\n    return;\n  }\n  const workspace = block.mutator!.getWorkspace() as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n  workspace.addChangeListener(mutatorChangeListener);\n}\n/**\n * Listens for changes in a procedure mutator and triggers flyout updates when\n * necessary.\n *\n * @param e The event that triggered this listener.\n */\nfunction mutatorChangeListener(e: Abstract) {\n  if (e.type !== eventUtils.BLOCK_CREATE &&\n      e.type !== eventUtils.BLOCK_DELETE &&\n      e.type !== eventUtils.BLOCK_CHANGE) {\n    return;\n  }\n  const workspaceId = e.workspaceId as string;\n  const workspace = common.getWorkspaceById(workspaceId) as WorkspaceSvg;\n  updateMutatorFlyout(workspace);\n}\n\n/**\n * Find all the callers of a named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to find callers in.\n * @returns Array of caller blocks.\n */\nexport function getCallers(name: string, workspace: Workspace): Block[] {\n  return workspace.getAllBlocks(false).filter((block) => {\n    return blockIsModernCallerFor(block, name) ||\n        (isLegacyProcedureCallBlock(block) &&\n         Names.equals(block.getProcedureCall(), name));\n  });\n}\n\n/**\n * @returns True if the given block is a modern-style caller block of the given\n *     procedure name.\n */\nfunction blockIsModernCallerFor(block: Block, procName: string): boolean {\n  return isProcedureBlock(block) && !block.isProcedureDef() &&\n      block.getProcedureModel() &&\n      Names.equals(block.getProcedureModel().getName(), procName);\n}\n\n/**\n * When a procedure definition changes its parameters, find and edit all its\n * callers.\n *\n * @param defBlock Procedure definition block.\n */\nexport function mutateCallers(defBlock: Block) {\n  const oldRecordUndo = eventUtils.getRecordUndo();\n  const procedureBlock = defBlock as unknown as ProcedureBlock;\n  const name = procedureBlock.getProcedureDef()[0];\n  const xmlElement = defBlock.mutationToDom!(true);\n  const callers = getCallers(name, defBlock.workspace);\n  for (let i = 0, caller; caller = callers[i]; i++) {\n    const oldMutationDom = caller.mutationToDom!();\n    const oldMutation = oldMutationDom && utilsXml.domToText(oldMutationDom);\n    if (caller.domToMutation) {\n      caller.domToMutation(xmlElement);\n    }\n    const newMutationDom = caller.mutationToDom!();\n    const newMutation = newMutationDom && utilsXml.domToText(newMutationDom);\n    if (oldMutation !== newMutation) {\n      // Fire a mutation on every caller block.  But don't record this as an\n      // undo action since it is deterministically tied to the procedure's\n      // definition mutation.\n      eventUtils.setRecordUndo(false);\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          caller, 'mutation', null, oldMutation, newMutation));\n      eventUtils.setRecordUndo(oldRecordUndo);\n    }\n  }\n}\n\n/**\n * Find the definition block for the named procedure.\n *\n * @param name Name of procedure.\n * @param workspace The workspace to search.\n * @returns The procedure definition block, or null not found.\n */\nexport function getDefinition(name: string, workspace: Workspace): Block|null {\n  // Do not assume procedure is a top block. Some languages allow nested\n  // procedures. Also do not assume it is one of the built-in blocks. Only\n  // rely on isProcedureDef and getProcedureDef.\n  for (const block of workspace.getAllBlocks(false)) {\n    if (isProcedureBlock(block) && block.isProcedureDef() &&\n        Names.equals(block.getProcedureModel().getName(), name)) {\n      return block;\n    }\n    if (isLegacyProcedureDefBlock(block) &&\n        Names.equals(block.getProcedureDef()[0], name)) {\n      return block;\n    }\n  }\n  return null;\n}\n\nexport {\n  ObservableProcedureMap,\n  IParameterModel,\n  IProcedureBlock,\n  isProcedureBlock,\n  IProcedureMap,\n  IProcedureModel,\n  ProcedureTuple,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.ConstantProvider');\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport * as parsing from '../../utils/parsing.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\n\n\n/** An object containing sizing and path information about outside corners. */\nexport interface OutsideCorners {\n  topLeft: string;\n  topRight: string;\n  bottomRight: string;\n  bottomLeft: string;\n  rightHeight: number;\n}\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  height: number;\n  width: number;\n  path: string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  type: number;\n  width: number;\n  height: number;\n  pathLeft: string;\n  pathRight: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  type: number;\n  width: number;\n  height: number;\n  pathDown: string|((p1: number) => string);\n  pathUp: string|((p1: number) => string);\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  path: string;\n}\n\nexport type BaseShape = {\n  type: number; width: number; height: number;\n};\n\n/** An object containing sizing and type information about a dynamic shape. */\nexport type DynamicShape = {\n  type: number; width: (p1: number) => number; height: (p1: number) => number;\n  isDynamic: true;\n  connectionOffsetY: (p1: number) => number;\n  connectionOffsetX: (p1: number) => number;\n  pathDown: (p1: number) => string;\n  pathUp: (p1: number) => string;\n  pathRightDown: (p1: number) => string;\n  pathRightUp: (p1: number) => string;\n};\n\n/** An object containing sizing and type information about a shape. */\nexport type Shape = BaseShape|DynamicShape;\n\n/**\n * Returns whether the shape is dynamic or not.\n *\n * @param shape The shape to check for dynamic-ness.\n * @returns Whether the shape is a dynamic shape or not.\n */\nexport function isDynamicShape(shape: Shape): shape is DynamicShape {\n  return (shape as DynamicShape).isDynamic;\n}\n\n/**\n * An object that provides constants for rendering blocks.\n */\nexport class ConstantProvider {\n  /** The size of an empty spacer. */\n  NO_PADDING = 0;\n\n  /** The size of small padding. */\n  SMALL_PADDING = 3;\n\n  /** The size of medium padding. */\n  MEDIUM_PADDING = 5;\n\n  /** The size of medium-large padding. */\n  MEDIUM_LARGE_PADDING = 8;\n\n  /** The size of large padding. */\n  LARGE_PADDING = 10;\n  TALL_INPUT_FIELD_OFFSET_Y: number;\n\n  /** The height of the puzzle tab used for input and output connections. */\n  TAB_HEIGHT = 15;\n\n  /**\n   * The offset from the top of the block at which a puzzle tab is positioned.\n   */\n  TAB_OFFSET_FROM_TOP = 5;\n\n  /**\n   * Vertical overlap of the puzzle tab, used to make it look more like a\n   * puzzle piece.\n   */\n  TAB_VERTICAL_OVERLAP = 2.5;\n\n  /** The width of the puzzle tab used for input and output connections. */\n  TAB_WIDTH = 8;\n\n  /** The width of the notch used for previous and next connections. */\n  NOTCH_WIDTH = 15;\n\n  /** The height of the notch used for previous and next connections. */\n  NOTCH_HEIGHT = 4;\n\n  /** The minimum width of the block. */\n  MIN_BLOCK_WIDTH = 12;\n  EMPTY_BLOCK_SPACER_HEIGHT = 16;\n  DUMMY_INPUT_MIN_HEIGHT: number;\n  DUMMY_INPUT_SHADOW_MIN_HEIGHT: number;\n\n  /** Rounded corner radius. */\n  CORNER_RADIUS = 8;\n\n  /**\n   * Offset from the left side of a block or the inside of a statement input\n   * to the left side of the notch.\n   */\n  NOTCH_OFFSET_LEFT = 15;\n  STATEMENT_INPUT_NOTCH_OFFSET: number;\n\n  STATEMENT_BOTTOM_SPACER = 0;\n  STATEMENT_INPUT_PADDING_LEFT = 20;\n\n  /** Vertical padding between consecutive statement inputs. */\n  BETWEEN_STATEMENT_PADDING_Y = 4;\n  TOP_ROW_MIN_HEIGHT: number;\n  TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT: number;\n  BOTTOM_ROW_MIN_HEIGHT: number;\n  BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT: number;\n\n  /**\n   * Whether to add a 'hat' on top of all blocks with no previous or output\n   * connections. Can be overridden by 'hat' property on Theme.BlockStyle.\n   */\n  ADD_START_HATS = false;\n\n  /** Height of the top hat. */\n  START_HAT_HEIGHT = 15;\n\n  /** Width of the top hat. */\n  START_HAT_WIDTH = 100;\n\n  SPACER_DEFAULT_HEIGHT = 15;\n\n  MIN_BLOCK_HEIGHT = 24;\n\n  EMPTY_INLINE_INPUT_PADDING = 14.5;\n  EMPTY_INLINE_INPUT_HEIGHT: number;\n\n  EXTERNAL_VALUE_INPUT_PADDING = 2;\n  EMPTY_STATEMENT_INPUT_HEIGHT: number;\n  START_POINT: string;\n\n  /** Height of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_HEIGHT = 12;\n\n  /** Width of SVG path for jagged teeth at the end of collapsed blocks. */\n  JAGGED_TEETH_WIDTH = 6;\n\n  /** Point size of text. */\n  FIELD_TEXT_FONTSIZE = 11;\n\n  /** Text font weight. */\n  FIELD_TEXT_FONTWEIGHT = 'normal';\n\n  /** Text font family. */\n  FIELD_TEXT_FONTFAMILY = 'sans-serif';\n\n  /**\n   * Height of text.  This constant is dynamically set in\n   * `setFontConstants_` to be the height of the text based on the font\n   * used.\n   */\n  FIELD_TEXT_HEIGHT = -1;  // Dynamically set.\n\n  /**\n   * Text baseline.  This constant is dynamically set in `setFontConstants_`\n   * to be the baseline of the text based on the font used.\n   */\n  FIELD_TEXT_BASELINE = -1;  // Dynamically set.\n\n  /** A field's border rect corner radius. */\n  FIELD_BORDER_RECT_RADIUS = 4;\n\n  /** A field's border rect default height. */\n  FIELD_BORDER_RECT_HEIGHT = 16;\n\n  /** A field's border rect X padding. */\n  FIELD_BORDER_RECT_X_PADDING = 5;\n\n  /** A field's border rect Y padding. */\n  FIELD_BORDER_RECT_Y_PADDING = 3;\n\n  /**\n   * The backing colour of a field's border rect.\n   */\n  FIELD_BORDER_RECT_COLOUR = '#fff';\n  FIELD_TEXT_BASELINE_CENTER: boolean;\n  FIELD_DROPDOWN_BORDER_RECT_HEIGHT: number;\n\n  /**\n   * Whether or not a dropdown field should add a border rect when in a shadow\n   * block.\n   */\n  FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = false;\n\n  /**\n   * Whether or not a dropdown field's div should be coloured to match the\n   * block colours.\n   */\n  FIELD_DROPDOWN_COLOURED_DIV = false;\n\n  /** Whether or not a dropdown field uses a text or SVG arrow. */\n  FIELD_DROPDOWN_SVG_ARROW = false;\n  FIELD_DROPDOWN_SVG_ARROW_PADDING: number;\n\n  /** A dropdown field's SVG arrow size. */\n  FIELD_DROPDOWN_SVG_ARROW_SIZE = 12;\n  FIELD_DROPDOWN_SVG_ARROW_DATAURI: string;\n\n  /**\n   * Whether or not to show a box shadow around the widget div. This is only a\n   * feature of full block fields.\n   */\n  FIELD_TEXTINPUT_BOX_SHADOW = false;\n\n  /**\n   * Whether or not the colour field should display its colour value on the\n   * entire block.\n   */\n  FIELD_COLOUR_FULL_BLOCK = false;\n\n  /** A colour field's default width. */\n  FIELD_COLOUR_DEFAULT_WIDTH = 26;\n  FIELD_COLOUR_DEFAULT_HEIGHT: number;\n  FIELD_CHECKBOX_X_OFFSET: number;\n  randomIdentifier: string;\n\n  /**\n   * The defs tag that contains all filters and patterns for this Blockly\n   * instance.\n   */\n  private defs_: SVGElement|null = null;\n\n  /**\n   * The ID of the emboss filter, or the empty string if no filter is set.\n   */\n  embossFilterId = '';\n\n  /** The <filter> element to use for highlighting, or null if not set. */\n  private embossFilter_: SVGElement|null = null;\n\n  /**\n   * The ID of the disabled pattern, or the empty string if no pattern is set.\n   */\n  disabledPatternId = '';\n\n  /**\n   * The <pattern> element to use for disabled blocks, or null if not set.\n   */\n  private disabledPattern_: SVGElement|null = null;\n\n  /**\n   * The ID of the debug filter, or the empty string if no pattern is set.\n   */\n  debugFilterId = '';\n\n  /**\n   * The <filter> element to use for a debug highlight, or null if not set.\n   */\n  private debugFilter_: SVGElement|null = null;\n\n  /** The <style> element to use for injecting renderer specific CSS. */\n  private cssNode_: HTMLStyleElement|null = null;\n\n  /**\n   * Cursor colour.\n   */\n  CURSOR_COLOUR = '#cc0a0a';\n\n  /**\n   * Immovable marker colour.\n   */\n  MARKER_COLOUR = '#4286f4';\n\n  /**\n   * Width of the horizontal cursor.\n   */\n  CURSOR_WS_WIDTH = 100;\n\n  /**\n   * Height of the horizontal cursor.\n   */\n  WS_CURSOR_HEIGHT = 5;\n\n  /**\n   * Padding around a stack.\n   */\n  CURSOR_STACK_PADDING = 10;\n\n  /**\n   * Padding around a block.\n   */\n  CURSOR_BLOCK_PADDING = 2;\n\n  /**\n   * Stroke of the cursor.\n   */\n  CURSOR_STROKE_WIDTH = 4;\n\n  /**\n   * Whether text input and colour fields fill up the entire source block.\n   */\n  FULL_BLOCK_FIELDS = false;\n\n  /**\n   * The main colour of insertion markers, in hex.  The block is rendered a\n   * transparent grey by changing the fill opacity in CSS.\n   */\n  INSERTION_MARKER_COLOUR = '#000000';\n\n  /**\n   * The insertion marker opacity.\n   */\n  INSERTION_MARKER_OPACITY = 0.2;\n\n  SHAPES: {[key: string]: number} = {PUZZLE: 1, NOTCH: 2};\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNERS!: InsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNERS!: OutsideCorners;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n\n  blockStyles!: {[key: string]: BlockStyle};\n\n  constructor() {\n    /**\n     * Offset from the top of the row for placing fields on inline input rows\n     * and statement input rows.\n     * Matches existing rendering (in 2019).\n     */\n    this.TALL_INPUT_FIELD_OFFSET_Y = this.MEDIUM_PADDING;\n\n    /** The minimum height of a dummy input row. */\n    this.DUMMY_INPUT_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /** The minimum height of a dummy input row in a shadow block. */\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = this.TAB_HEIGHT;\n\n    /**\n     * Additional offset added to the statement input's width to account for the\n     * notch.\n     */\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    /** The top row's minimum height. */\n    this.TOP_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The top row's minimum height if it precedes a statement. */\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The bottom row's minimum height. */\n    this.BOTTOM_ROW_MIN_HEIGHT = this.MEDIUM_PADDING;\n\n    /** The bottom row's minimum height if it follows a statement input. */\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    /** The height of an empty inline input. */\n    this.EMPTY_INLINE_INPUT_HEIGHT = this.TAB_HEIGHT + 11;\n\n    /**\n     * The height of an empty statement input.  Note that in the old rendering\n     * this varies slightly depending on whether the block has external or\n     * inline inputs. In the new rendering this is consistent.  It seems\n     * unlikely that the old behaviour was intentional.\n     */\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = this.MIN_BLOCK_HEIGHT;\n\n    this.START_POINT = svgPaths.moveBy(0, 0);\n\n    /**\n     * A field's text element's dominant baseline. Pre-2022 this could be false\n     * for certain browsers.\n     */\n    this.FIELD_TEXT_BASELINE_CENTER = true;\n\n    /** A dropdown field's border rect height. */\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A dropdown field's SVG arrow padding. */\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    /** A dropdown field's SVG arrow datauri. */\n    this.FIELD_DROPDOWN_SVG_ARROW_DATAURI =\n        'data:image/svg+xml;base64,PHN2ZyBpZD0iTGF5ZXJfMSIgZGF0YS1uYW1lPSJMYXllci' +\n        'AxIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMi43MSIgaG' +\n        'VpZ2h0PSI4Ljc5IiB2aWV3Qm94PSIwIDAgMTIuNzEgOC43OSI+PHRpdGxlPmRyb3Bkb3duLW' +\n        'Fycm93PC90aXRsZT48ZyBvcGFjaXR5PSIwLjEiPjxwYXRoIGQ9Ik0xMi43MSwyLjQ0QTIuND' +\n        'EsMi40MSwwLDAsMSwxMiw0LjE2TDguMDgsOC4wOGEyLjQ1LDIuNDUsMCwwLDEtMy40NSwwTD' +\n        'AuNzIsNC4xNkEyLjQyLDIuNDIsMCwwLDEsMCwyLjQ0LDIuNDgsMi40OCwwLDAsMSwuNzEuNz' +\n        'FDMSwwLjQ3LDEuNDMsMCw2LjM2LDBTMTEuNzUsMC40NiwxMiwuNzFBMi40NCwyLjQ0LDAsMC' +\n        'wxLDEyLjcxLDIuNDRaIiBmaWxsPSIjMjMxZjIwIi8+PC9nPjxwYXRoIGQ9Ik02LjM2LDcuNz' +\n        'lhMS40MywxLjQzLDAsMCwxLTEtLjQyTDEuNDIsMy40NWExLjQ0LDEuNDQsMCwwLDEsMC0yYz' +\n        'AuNTYtLjU2LDkuMzEtMC41Niw5Ljg3LDBhMS40NCwxLjQ0LDAsMCwxLDAsMkw3LjM3LDcuMz' +\n        'dBMS40MywxLjQzLDAsMCwxLDYuMzYsNy43OVoiIGZpbGw9IiNmZmYiLz48L3N2Zz4=';\n\n    /** A colour field's default height. */\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n\n    /** A checkbox field's X offset. */\n    this.FIELD_CHECKBOX_X_OFFSET = this.FIELD_BORDER_RECT_X_PADDING - 3;\n\n    /**\n     * A random identifier used to ensure a unique ID is used for each\n     * filter/pattern for the case of multiple Blockly instances on a page.\n     */\n    this.randomIdentifier = String(Math.random()).substring(2);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about collapsed block\n     * indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /** An object containing sizing and path information about notches. */\n    this.NOTCH = this.makeNotch();\n\n    /** An object containing sizing and path information about start hats */\n    this.START_HAT = this.makeStartHat();\n\n    /**\n     * An object containing sizing and path information about puzzle tabs.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about inside corners\n     */\n    this.INSIDE_CORNERS = this.makeInsideCorners();\n\n    /**\n     * An object containing sizing and path information about outside corners.\n     */\n    this.OUTSIDE_CORNERS = this.makeOutsideCorners();\n  }\n\n  /**\n   * Refresh constants properties that depend on the theme.\n   *\n   * @param theme The current workspace theme.\n   */\n  setTheme(theme: Theme) {\n    /** The block styles map. */\n    this.blockStyles = Object.create(null);\n\n    const blockStyles = theme.blockStyles;\n    for (const key in blockStyles) {\n      this.blockStyles[key] = this.validatedBlockStyle_(blockStyles[key]);\n    }\n\n    this.setDynamicProperties_(theme);\n  }\n\n  /**\n   * Sets dynamic properties that depend on other values or theme properties.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setDynamicProperties_(theme: Theme) {\n    this.setFontConstants_(theme);\n    this.setComponentConstants_(theme);\n\n    this.ADD_START_HATS =\n        theme.startHats !== undefined ? theme.startHats : this.ADD_START_HATS;\n  }\n\n  /**\n   * Set constants related to fonts.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setFontConstants_(theme: Theme) {\n    if (theme.fontStyle && theme.fontStyle['family']) {\n      this.FIELD_TEXT_FONTFAMILY = theme.fontStyle['family'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['weight']) {\n      this.FIELD_TEXT_FONTWEIGHT = theme.fontStyle['weight'];\n    }\n\n    if (theme.fontStyle && theme.fontStyle['size']) {\n      this.FIELD_TEXT_FONTSIZE = theme.fontStyle['size'];\n    }\n\n    const fontMetrics = dom.measureFontMetrics(\n        'Hg', this.FIELD_TEXT_FONTSIZE + 'pt', this.FIELD_TEXT_FONTWEIGHT,\n        this.FIELD_TEXT_FONTFAMILY);\n\n    this.FIELD_TEXT_HEIGHT = fontMetrics.height;\n    this.FIELD_TEXT_BASELINE = fontMetrics.baseline;\n  }\n\n  /**\n   * Set constants from a theme's component styles.\n   *\n   * @param theme The current workspace theme.\n   */\n  protected setComponentConstants_(theme: Theme) {\n    this.CURSOR_COLOUR =\n        theme.getComponentStyle('cursorColour') || this.CURSOR_COLOUR;\n    this.MARKER_COLOUR =\n        theme.getComponentStyle('markerColour') || this.MARKER_COLOUR;\n    this.INSERTION_MARKER_COLOUR =\n        theme.getComponentStyle('insertionMarkerColour') ||\n        this.INSERTION_MARKER_COLOUR;\n    this.INSERTION_MARKER_OPACITY =\n        Number(theme.getComponentStyle('insertionMarkerOpacity')) ||\n        this.INSERTION_MARKER_OPACITY;\n  }\n\n  /**\n   * Get or create a block style based on a single colour value.  Generate a\n   * name for the style based on the colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns An object containing the style and an autogenerated name for that\n   *     style.\n   */\n  getBlockStyleForColour(colour: string): {style: BlockStyle, name: string} {\n    const name = 'auto_' + colour;\n    if (!this.blockStyles[name]) {\n      this.blockStyles[name] = this.createBlockStyle_(colour);\n    }\n    return {style: this.blockStyles[name], name};\n  }\n\n  /**\n   * Gets the BlockStyle for the given block style name.\n   *\n   * @param blockStyleName The name of the block style.\n   * @returns The named block style, or a default style if no style with the\n   *     given name was found.\n   */\n  getBlockStyle(blockStyleName: string|null): BlockStyle {\n    return this.blockStyles[blockStyleName || ''] ||\n        (blockStyleName && blockStyleName.indexOf('auto_') === 0 ?\n             this.getBlockStyleForColour(blockStyleName.substring(5)).style :\n             this.createBlockStyle_('#000000'));\n  }\n\n  /**\n   * Create a block style object based on the given colour.\n   *\n   * @param colour #RRGGBB colour string.\n   * @returns A populated block style based on the given colour.\n   */\n  protected createBlockStyle_(colour: string): BlockStyle {\n    return this.validatedBlockStyle_({'colourPrimary': colour});\n  }\n\n  /**\n   * Get a full block style object based on the input style object.  Populate\n   * any missing values.\n   *\n   * @param blockStyle A full or partial block style object.\n   * @returns A full block style object, with all required properties populated.\n   */\n  protected validatedBlockStyle_(blockStyle: Partial<BlockStyle>): BlockStyle {\n    // Make a new object with all of the same properties.\n    const valid = {} as BlockStyle;\n    if (blockStyle) {\n      Object.assign(valid, blockStyle);\n    }\n    // Validate required properties.\n    const parsedColour =\n        parsing.parseBlockColour(valid['colourPrimary'] || '#000');\n    valid.colourPrimary = parsedColour.hex;\n    valid.colourSecondary = valid['colourSecondary'] ?\n        parsing.parseBlockColour(valid['colourSecondary']).hex :\n        this.generateSecondaryColour_(valid.colourPrimary);\n    valid.colourTertiary = valid['colourTertiary'] ?\n        parsing.parseBlockColour(valid['colourTertiary']).hex :\n        this.generateTertiaryColour_(valid.colourPrimary);\n\n    valid.hat = valid['hat'] || '';\n    return valid;\n  }\n\n  /**\n   * Generate a secondary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated secondary colour.\n   */\n  protected generateSecondaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.6) || inputColour;\n  }\n\n  /**\n   * Generate a tertiary colour from the passed in primary colour.\n   *\n   * @param inputColour Primary colour.\n   * @returns The generated tertiary colour.\n   */\n  protected generateTertiaryColour_(inputColour: string): string {\n    return colour.blend('#fff', inputColour, 0.3) || inputColour;\n  }\n\n  /**\n   * Dispose of this constants provider.\n   * Delete all DOM elements that this provider created.\n   */\n  dispose() {\n    if (this.embossFilter_) {\n      dom.removeNode(this.embossFilter_);\n    }\n    if (this.disabledPattern_) {\n      dom.removeNode(this.disabledPattern_);\n    }\n    if (this.debugFilter_) {\n      dom.removeNode(this.debugFilter_);\n    }\n    this.cssNode_ = null;\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block indicators.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const height = this.JAGGED_TEETH_HEIGHT;\n    const width = this.JAGGED_TEETH_WIDTH;\n\n    const mainPath = svgPaths.line([\n      svgPaths.point(width, height / 4),\n      svgPaths.point(-width * 2, height / 2),\n      svgPaths.point(width, height / 4),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start hats.\n   */\n  protected makeStartHat(): StartHat {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(30, -height),\n      svgPaths.point(70, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle\n   *     tabs.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.TAB_WIDTH;\n    const height = this.TAB_HEIGHT;\n\n    /**\n     * Make the main path for the puzzle tab made out of a few curves (c and s).\n     * Those curves are defined with relative positions.  The 'up' and 'down'\n     * versions of the paths are the same, but the Y sign flips.  Forward and\n     * back are the signs to use to move the cursor in the direction that the\n     * path is being drawn.\n     *\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @returns A path fragment describing a puzzle tab.\n     */\n    function makeMainPath(up: boolean): string {\n      const forward = up ? -1 : 1;\n      const back = -forward;\n\n      const overlap = 2.5;\n      const halfHeight = height / 2;\n      const control1Y = halfHeight + overlap;\n      const control2Y = halfHeight + 0.5;\n      const control3Y = overlap;  // 2.5\n\n      const endPoint1 = svgPaths.point(-width, forward * halfHeight);\n      const endPoint2 = svgPaths.point(width, forward * halfHeight);\n\n      return svgPaths.curve(\n                 'c',\n                 [\n                   svgPaths.point(0, forward * control1Y),\n                   svgPaths.point(-width, back * control2Y),\n                   endPoint1,\n                 ]) +\n          svgPaths.curve(\n              's', [svgPaths.point(width, back * control3Y), endPoint2]);\n    }\n\n    // c 0,-10  -8,8  -8,-7.5  s 8,2.5  8,-7.5\n    const pathUp = makeMainPath(true);\n    // c 0,10  -8,-8  -8,7.5  s 8,-2.5  8,7.5\n    const pathDown = makeMainPath(false);\n\n    return {\n      type: this.SHAPES.PUZZLE,\n      width,\n      height,\n      pathDown,\n      pathUp,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notches.\n   */\n  protected makeNotch(): Notch {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n    const innerWidth = 3;\n    const outerWidth = (width - innerWidth) / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.line([\n        svgPaths.point(dir * outerWidth, height),\n        svgPaths.point(dir * innerWidth, 0),\n        svgPaths.point(dir * outerWidth, -height),\n      ]);\n    }\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corners.\n   */\n  protected makeInsideCorners(): InsideCorners {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(-radius, radius));\n\n    const innerBottomLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(radius, radius));\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corners.\n   */\n  protected makeOutsideCorners(): OutsideCorners {\n    const radius = this.CORNER_RADIUS;\n    /** SVG path for drawing the rounded top-left corner. */\n    const topLeft = svgPaths.moveBy(0, radius) +\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, -radius));\n\n    /** SVG path for drawing the rounded top-right corner. */\n    const topRight =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, radius));\n\n    /** SVG path for drawing the rounded bottom-left corner. */\n    const bottomLeft =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(-radius, -radius));\n\n    /** SVG path for drawing the rounded bottom-right corner. */\n    const bottomRight =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(-radius, radius));\n\n    return {\n      topLeft,\n      topRight,\n      bottomRight,\n      bottomLeft,\n      rightHeight: radius,\n    };\n  }\n\n  /**\n   * Get an object with connection shape and sizing information based on the\n   * type of the connection.\n   *\n   * @param connection The connection to find a shape object for\n   * @returns The shape object for the connection.\n   */\n  shapeFor(connection: RenderedConnection): Shape {\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        return this.PUZZLE_TAB;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH;\n      default:\n        throw Error('Unknown connection type');\n    }\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs (filters, patterns, etc).\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param tagName The name to use for the CSS style tag.\n   * @param selector The CSS selector to use.\n   * @suppress {strictModuleDepCheck} Debug renderer only included in\n   * playground.\n   */\n  createDom(svg: SVGElement, tagName: string, selector: string) {\n    this.injectCSS_(tagName, selector);\n\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    this.defs_ = dom.createSvgElement(Svg.DEFS, {}, svg);\n    /*\n          <filter id=\"blocklyEmbossFilter837493\">\n            <feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"1\" result=\"blur\" />\n            <feSpecularLighting in=\"blur\" surfaceScale=\"1\"\n       specularConstant=\"0.5\" specularExponent=\"10\" lighting-color=\"white\"\n                                result=\"specOut\">\n              <fePointLight x=\"-5000\" y=\"-10000\" z=\"20000\" />\n            </feSpecularLighting>\n            <feComposite in=\"specOut\" in2=\"SourceAlpha\" operator=\"in\"\n                         result=\"specOut\" />\n            <feComposite in=\"SourceGraphic\" in2=\"specOut\" operator=\"arithmetic\"\n                         k1=\"0\" k2=\"1\" k3=\"1\" k4=\"0\" />\n          </filter>\n        */\n    const embossFilter = dom.createSvgElement(\n        Svg.FILTER, {'id': 'blocklyEmbossFilter' + this.randomIdentifier},\n        this.defs_);\n    dom.createSvgElement(\n        Svg.FEGAUSSIANBLUR,\n        {'in': 'SourceAlpha', 'stdDeviation': 1, 'result': 'blur'},\n        embossFilter);\n    const feSpecularLighting = dom.createSvgElement(\n        Svg.FESPECULARLIGHTING, {\n          'in': 'blur',\n          'surfaceScale': 1,\n          'specularConstant': 0.5,\n          'specularExponent': 10,\n          'lighting-color': 'white',\n          'result': 'specOut',\n        },\n        embossFilter);\n    dom.createSvgElement(\n        Svg.FEPOINTLIGHT, {'x': -5000, 'y': -10000, 'z': 20000},\n        feSpecularLighting);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'specOut',\n          'in2': 'SourceAlpha',\n          'operator': 'in',\n          'result': 'specOut',\n        },\n        embossFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'SourceGraphic',\n          'in2': 'specOut',\n          'operator': 'arithmetic',\n          'k1': 0,\n          'k2': 1,\n          'k3': 1,\n          'k4': 0,\n        },\n        embossFilter);\n    this.embossFilterId = embossFilter.id;\n    this.embossFilter_ = embossFilter;\n\n    /*\n          <pattern id=\"blocklyDisabledPattern837493\"\n       patternUnits=\"userSpaceOnUse\" width=\"10\" height=\"10\"> <rect width=\"10\"\n       height=\"10\" fill=\"#aaa\" /> <path d=\"M 0 0 L 10 10 M 10 0 L 0 10\"\n       stroke=\"#cc0\" />\n          </pattern>\n        */\n    const disabledPattern = dom.createSvgElement(\n        Svg.PATTERN, {\n          'id': 'blocklyDisabledPattern' + this.randomIdentifier,\n          'patternUnits': 'userSpaceOnUse',\n          'width': 10,\n          'height': 10,\n        },\n        this.defs_);\n    dom.createSvgElement(\n        Svg.RECT, {'width': 10, 'height': 10, 'fill': '#aaa'}, disabledPattern);\n    dom.createSvgElement(\n        Svg.PATH, {'d': 'M 0 0 L 10 10 M 10 0 L 0 10', 'stroke': '#cc0'},\n        disabledPattern);\n    this.disabledPatternId = disabledPattern.id;\n    this.disabledPattern_ = disabledPattern;\n\n    this.createDebugFilter();\n  }\n\n  /**\n   * Create a filter for highlighting the currently rendering block during\n   * render debugging.\n   */\n  private createDebugFilter() {\n    // Only create the debug filter once.\n    if (!this.debugFilter_) {\n      const debugFilter = dom.createSvgElement(\n          Svg.FILTER, {\n            'id': 'blocklyDebugFilter' + this.randomIdentifier,\n            'height': '160%',\n            'width': '180%',\n            'y': '-30%',\n            'x': '-40%',\n          },\n          this.defs_);\n      // Set all gaussian blur pixels to 1 opacity before applying flood\n      const debugComponentTransfer = dom.createSvgElement(\n          Svg.FECOMPONENTTRANSFER, {'result': 'outBlur'}, debugFilter);\n      dom.createSvgElement(\n          Svg.FEFUNCA,\n          {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n          debugComponentTransfer);\n      // Color the highlight\n      dom.createSvgElement(\n          Svg.FEFLOOD, {\n            'flood-color': '#ff0000',\n            'flood-opacity': 0.5,\n            'result': 'outColor',\n          },\n          debugFilter);\n      dom.createSvgElement(\n          Svg.FECOMPOSITE, {\n            'in': 'outColor',\n            'in2': 'outBlur',\n            'operator': 'in',\n            'result': 'outGlow',\n          },\n          debugFilter);\n      this.debugFilterId = debugFilter.id;\n      this.debugFilter_ = debugFilter;\n    }\n  }\n\n  /**\n   * Inject renderer specific CSS into the page.\n   *\n   * @param tagName The name of the style tag to use.\n   * @param selector The CSS selector to use.\n   */\n  protected injectCSS_(tagName: string, selector: string) {\n    const cssArray = this.getCSS_(selector);\n    const cssNodeId = 'blockly-renderer-style-' + tagName;\n    this.cssNode_ = document.getElementById(cssNodeId) as HTMLStyleElement;\n    const text = cssArray.join('\\n');\n    if (this.cssNode_) {\n      // Already injected, update if the theme changed.\n      this.cssNode_.firstChild!.textContent = text;\n      return;\n    }\n    // Inject CSS tag at start of head.\n    const cssNode = (document.createElement('style'));\n    cssNode.id = cssNodeId;\n    const cssTextNode = document.createTextNode(text);\n    cssNode.appendChild(cssTextNode);\n    document.head.insertBefore(cssNode, document.head.firstChild);\n    this.cssNode_ = cssNode;\n  }\n\n  /**\n   * Get any renderer specific CSS to inject when the renderer is initialized.\n   *\n   * @param selector CSS selector to use.\n   * @returns Array of CSS strings.\n   */\n  protected getCSS_(selector: string): string[] {\n    return [\n      /* eslint-disable indent */\n      /* clang-format off */\n      // Text.\n      `${selector} .blocklyText, `,\n      `${selector} .blocklyFlyoutLabelText {`,\n        `font: ${this.FIELD_TEXT_FONTWEIGHT} ` +\n            `${this.FIELD_TEXT_FONTSIZE}pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n        `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect,`,\n      `${selector} .blocklyEditableText>rect {`,\n        `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n        `fill-opacity: .6;`,\n        `stroke: none;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text {`,\n        `fill: #000;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n        `fill: #000;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyEditableText:not(.editing):hover>rect {`,\n        `stroke: #fff;`,\n        `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n        `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n        `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `}`,\n\n      // Selection highlight.\n      `${selector} .blocklySelected>.blocklyPath {`,\n        `stroke: #fc3;`,\n        `stroke-width: 3px;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n        `stroke: #fc3;`,\n      `}`,\n\n      // Replaceable highlight.\n      `${selector} .blocklyReplaceable .blocklyPath {`,\n        `fill-opacity: .5;`,\n      `}`,\n      `${selector} .blocklyReplaceable .blocklyPathLight,`,\n      `${selector} .blocklyReplaceable .blocklyPathDark {`,\n        `display: none;`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n        `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n        `stroke: none;`,\n      `}`,\n      /* clang-format on */\n      /* eslint-enable indent */\n    ];\n  }\n}\n/* clang-format on */\n/* eslint-enable indent */\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.debug');\n\nimport * as deprecation from '../../utils/deprecation.js';\n\n\n/** Whether or not the debugger is turned on. */\nlet useDebugger = false;\n/**\n * Returns whether the debugger is turned on.\n *\n * @returns Whether the debugger is turned on.\n * @internal\n */\nexport function isDebuggerEnabled(): boolean {\n  return useDebugger;\n}\n\n/**\n * Turn on the blocks debugger.\n *\n * @deprecated March 2022. Use the rendering debugger in @blockly/dev-tools.\n * See https://www.npmjs.com/package/@blockly/dev-tools for more information.\n * @internal\n */\nexport function startDebugger() {\n  deprecation.warn(\n      'Blockly.blockRendering.debug.startDebugger()', 'version 8', 'version 10',\n      'the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)');\n  useDebugger = true;\n}\n\n/**\n * Turn off the blocks debugger.\n *\n * @deprecated March 2022. Use the rendering debugger in @blockly/dev-tools.\n * See https://www.npmjs.com/package/@blockly/dev-tools for more information.\n * @internal\n */\nexport function stopDebugger() {\n  deprecation.warn(\n      'Blockly.blockRendering.debug.stopDebugger()', 'version 8', 'version 10',\n      'the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)');\n  useDebugger = false;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering');\n\nimport * as registry from '../../registry.js';\nimport type {Theme} from '../../theme.js';\nimport * as deprecation from '../../utils/deprecation.js';\nimport {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {Connection} from '../measurables/connection.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {ConstantProvider} from './constants.js';\nimport * as debug from './debug.js';\nimport {Debug} from './debugger.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n/**\n * Registers a new renderer.\n *\n * @param name The name of the renderer.\n * @param rendererClass The new renderer class to register.\n * @throws {Error} if a renderer with the same name has already been registered.\n */\nexport function register(name: string, rendererClass: Function) {\n  registry.register(registry.Type.RENDERER, name, rendererClass);\n}\n\n/**\n * Unregisters the renderer registered with the given name.\n *\n * @param name The name of the renderer.\n */\nexport function unregister(name: string) {\n  registry.unregister(registry.Type.RENDERER, name);\n}\n\n/**\n * Turn off the blocks debugger.\n *\n * @deprecated Use the debug renderer in **\\@blockly/dev-tools** (See {@link\n *     https://www.npmjs.com/package/@blockly/dev-tools}.)\n * @internal\n */\nexport function stopDebugger() {\n  deprecation.warn(\n      'Blockly.blockRendering.stopDebugger()', 'September 2021',\n      'September 2022',\n      'the debug renderer in @blockly/dev-tools (See https://www.npmjs.com/package/@blockly/dev-tools.)');\n  debug.stopDebugger();\n}\n\n/**\n * Initialize anything needed for rendering (constants, etc).\n *\n * @param name Name of the renderer to initialize.\n * @param theme The workspace theme object.\n * @param opt_rendererOverrides Rendering constant overrides.\n * @returns The new instance of a renderer.\n *     Already initialized.\n * @internal\n */\nexport function init(\n    name: string, theme: Theme,\n    opt_rendererOverrides?: {[rendererConstant: string]: any}): Renderer {\n  const rendererClass = registry.getClass(registry.Type.RENDERER, name);\n  const renderer = new rendererClass!(name);\n  renderer.init(theme, opt_rendererOverrides);\n  return renderer;\n}\nexport {BottomRow};\nexport {Connection};\nexport {ConstantProvider};\nexport {Debug};\nexport {Drawer};\nexport {ExternalValueInput};\nexport {Field};\nexport {Hat};\nexport {Icon};\nexport {InRowSpacer};\nexport {InlineInput};\nexport {InputConnection};\nexport {InputRow};\nexport {IPathObject};\nexport {JaggedEdge};\nexport {MarkerSvg};\nexport {Measurable};\nexport {NextConnection};\nexport {OutputConnection};\nexport {PathObject};\nexport {PreviousConnection};\nexport {Renderer};\nexport {RenderInfo};\nexport {RoundCorner};\nexport {Row};\nexport {SpacerRow};\nexport {SquareCorner};\nexport {StatementInput};\nexport {TopRow};\nexport {Types};\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VariablesDynamic');\n\nimport {Blocks} from './blocks.js';\nimport {Msg} from './msg.js';\nimport * as xml from './utils/xml.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport type {FlyoutButton} from './flyout_button.js';\n\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n * See also Blockly.Variables.CATEGORY_NAME and\n * Blockly.Procedures.CATEGORY_NAME.\n */\nexport const CATEGORY_NAME = 'VARIABLE_DYNAMIC';\n\n/**\n * Click handler for a button that creates String variables.\n *\n * @param button\n */\nfunction stringButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n      button.getTargetWorkspace(), undefined, 'String');\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_String = stringButtonClickHandler;\n\n/**\n * Click handler for a button that creates Number variables.\n *\n * @param button\n */\nfunction numberButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n      button.getTargetWorkspace(), undefined, 'Number');\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Number = numberButtonClickHandler;\n\n/**\n * Click handler for a button that creates Colour variables.\n *\n * @param button\n */\nfunction colourButtonClickHandler(button: FlyoutButton) {\n  Variables.createVariableButtonHandler(\n      button.getTargetWorkspace(), undefined, 'Colour');\n}\n// eslint-disable-next-line camelcase\nexport const onCreateVariableButtonClick_Colour = colourButtonClickHandler;\n\n/**\n * Construct the elements (blocks and button) required by the flyout for the\n * variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML elements.\n */\nexport function flyoutCategory(workspace: WorkspaceSvg): Element[] {\n  let xmlList = new Array<Element>();\n  let button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_STRING_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_STRING');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_NUMBER_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_NUMBER');\n  xmlList.push(button);\n  button = document.createElement('button');\n  button.setAttribute('text', Msg['NEW_COLOUR_VARIABLE']);\n  button.setAttribute('callbackKey', 'CREATE_VARIABLE_COLOUR');\n  xmlList.push(button);\n\n  workspace.registerButtonCallback(\n      'CREATE_VARIABLE_STRING', stringButtonClickHandler);\n  workspace.registerButtonCallback(\n      'CREATE_VARIABLE_NUMBER', numberButtonClickHandler);\n  workspace.registerButtonCallback(\n      'CREATE_VARIABLE_COLOUR', colourButtonClickHandler);\n\n  const blockList = flyoutCategoryBlocks(workspace);\n  xmlList = xmlList.concat(blockList);\n  return xmlList;\n}\n\n/**\n * Construct the blocks required by the flyout for the variable category.\n *\n * @param workspace The workspace containing variables.\n * @returns Array of XML block elements.\n */\nexport function flyoutCategoryBlocks(workspace: Workspace): Element[] {\n  const variableModelList = workspace.getAllVariables();\n\n  const xmlList = [];\n  if (variableModelList.length > 0) {\n    if (Blocks['variables_set_dynamic']) {\n      const firstVariable = variableModelList[variableModelList.length - 1];\n      const block = xml.createElement('block');\n      block.setAttribute('type', 'variables_set_dynamic');\n      block.setAttribute('gap', '24');\n      block.appendChild(Variables.generateVariableFieldDom(firstVariable));\n      xmlList.push(block);\n    }\n    if (Blocks['variables_get_dynamic']) {\n      variableModelList.sort(VariableModel.compareByName);\n      for (let i = 0, variable; variable = variableModelList[i]; i++) {\n        const block = xml.createElement('block');\n        block.setAttribute('type', 'variables_get_dynamic');\n        block.setAttribute('gap', '8');\n        block.appendChild(Variables.generateVariableFieldDom(variable));\n        xmlList.push(block);\n      }\n    }\n  }\n  return xmlList;\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.uiPosition');\n\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {Rect} from './utils/rect.js';\nimport type {Size} from './utils/size.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Enum for vertical positioning.\n *\n * @internal\n */\nexport enum verticalPosition {\n  TOP,\n  BOTTOM\n}\n\n/**\n * Enum for horizontal positioning.\n *\n * @internal\n */\nexport enum horizontalPosition {\n  LEFT,\n  RIGHT\n}\n\n/**\n * An object defining a horizontal and vertical positioning.\n *\n * @internal\n */\nexport interface Position {\n  horizontal: horizontalPosition;\n  vertical: verticalPosition;\n}\n\n/**\n * Enum for bump rules to use for dealing with collisions.\n *\n * @internal\n */\nexport enum bumpDirection {\n  UP,\n  DOWN\n}\n\n/**\n * Returns a rectangle representing reasonable position for where to place a UI\n * element of the specified size given the restraints and locations of the\n * scrollbars. This method does not take into account any already placed UI\n * elements.\n *\n * @param position The starting horizontal and vertical position.\n * @param size the size of the UI element to get a start position for.\n * @param horizontalPadding The horizontal padding to use.\n * @param verticalPadding The vertical padding to use.\n * @param metrics The workspace UI metrics.\n * @param workspace The workspace.\n * @returns The suggested start position.\n * @internal\n */\nexport function getStartPositionRect(\n    position: Position, size: Size, horizontalPadding: number,\n    verticalPadding: number, metrics: UiMetrics,\n    workspace: WorkspaceSvg): Rect {\n  // Horizontal positioning.\n  let left = 0;\n  const hasVerticalScrollbar =\n      workspace.scrollbar && workspace.scrollbar.canScrollVertically();\n  if (position.horizontal === horizontalPosition.LEFT) {\n    left = metrics.absoluteMetrics.left + horizontalPadding;\n    if (hasVerticalScrollbar && workspace.RTL) {\n      left += Scrollbar.scrollbarThickness;\n    }\n  } else {  // position.horizontal === horizontalPosition.RIGHT\n    left = metrics.absoluteMetrics.left + metrics.viewMetrics.width -\n        size.width - horizontalPadding;\n    if (hasVerticalScrollbar && !workspace.RTL) {\n      left -= Scrollbar.scrollbarThickness;\n    }\n  }\n  // Vertical positioning.\n  let top = 0;\n  if (position.vertical === verticalPosition.TOP) {\n    top = metrics.absoluteMetrics.top + verticalPadding;\n  } else {  // position.vertical === verticalPosition.BOTTOM\n    top = metrics.absoluteMetrics.top + metrics.viewMetrics.height -\n        size.height - verticalPadding;\n    if (workspace.scrollbar && workspace.scrollbar.canScrollHorizontally()) {\n      // The scrollbars are always positioned on the bottom if they exist.\n      top -= Scrollbar.scrollbarThickness;\n    }\n  }\n  return new Rect(top, top + size.height, left, left + size.width);\n}\n\n/**\n * Returns a corner position that is on the opposite side of the workspace from\n * the toolbox.\n * If in horizontal orientation, defaults to the bottom corner. If in vertical\n * orientation, defaults to the right corner.\n *\n * @param workspace The workspace.\n * @param metrics The workspace metrics.\n * @returns The suggested corner position.\n * @internal\n */\nexport function getCornerOppositeToolbox(\n    workspace: WorkspaceSvg, metrics: UiMetrics): Position {\n  const leftCorner =\n      metrics.toolboxMetrics.position !== toolbox.Position.LEFT &&\n      (!workspace.horizontalLayout || workspace.RTL);\n  const topCorner = metrics.toolboxMetrics.position === toolbox.Position.BOTTOM;\n  const hPosition =\n      leftCorner ? horizontalPosition.LEFT : horizontalPosition.RIGHT;\n  const vPosition = topCorner ? verticalPosition.TOP : verticalPosition.BOTTOM;\n  return {horizontal: hPosition, vertical: vPosition};\n}\n\n/**\n * Returns a position Rect based on a starting position that is bumped\n * so that it doesn't intersect with any of the provided savedPositions. This\n * method does not check that the bumped position is still within bounds.\n *\n * @param startRect The starting position to use.\n * @param margin The margin to use between elements when bumping.\n * @param bumpDir The direction to bump if there is a collision with an existing\n *     UI element.\n * @param savedPositions List of rectangles that represent the positions of UI\n *     elements already placed.\n * @returns The suggested position rectangle.\n * @internal\n */\nexport function bumpPositionRect(\n    startRect: Rect, margin: number, bumpDir: bumpDirection,\n    savedPositions: Rect[]): Rect {\n  let top = startRect.top;\n  const left = startRect.left;\n  const width = startRect.right - startRect.left;\n  const height = startRect.bottom - startRect.top;\n\n  // Check for collision and bump if needed.\n  let boundingRect = startRect;\n  for (let i = 0; i < savedPositions.length; i++) {\n    const otherEl = savedPositions[i];\n    if (boundingRect.intersects(otherEl)) {\n      if (bumpDir === bumpDirection.UP) {\n        top = otherEl.top - height - margin;\n      } else {  // bumpDir === bumpDirection.DOWN\n        top = otherEl.bottom + margin;\n      }\n      // Recheck other savedPositions\n      boundingRect = new Rect(top, top + height, left, left + width);\n      i = -1;\n    }\n  }\n  return boundingRect;\n}\n", "/**\n * @license\n * Copyright 2014 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace rendered as SVG.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_theme_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_viewport.js';\n\nimport type {Block} from './block.js';\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {ConnectionDB} from './connection_db.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Options} from './options.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport type {Renderer} from './renderers/common/renderer.js';\nimport type {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport {ThemeManager} from './theme_manager.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Trashcan} from './trashcan.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceDragSurfaceSvg} from './workspace_drag_surface_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\nimport {ContextMenuOption} from './contextmenu_registry.js';\n\n\n/** Margin around the top/bottom/left/right after a zoomToFit call. */\nconst ZOOM_TO_FIT_MARGIN = 20;\n\n/**\n * Class for a workspace.  This is an onscreen area with optional trashcan,\n * scrollbars, bubbles, and dragging.\n */\nexport class WorkspaceSvg extends Workspace implements IASTNodeLocationSvg {\n  /**\n   * A wrapper function called when a resize event occurs.\n   * You can pass the result to `eventHandling.unbind`.\n   */\n  private resizeHandlerWrapper: browserEvents.Data|null = null;\n\n  /**\n   * The render status of an SVG workspace.\n   * Returns `false` for headless workspaces and true for instances of\n   * `WorkspaceSvg`.\n   */\n  override rendered = true;\n\n  /**\n   * Whether the workspace is visible.  False if the workspace has been hidden\n   * by calling `setVisible(false)`.\n   */\n  private isVisible_ = true;\n\n  /**\n   * Whether this workspace has resizes enabled.\n   * Disable during batch operations for a performance improvement.\n   */\n  private resizesEnabled = true;\n\n  /**\n   * Current horizontal scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves right, this value becomes more positive, and\n   * the view is now \"seeing\" the left side of the canvas. As the canvas moves\n   * left, this value becomes more negative, and the view is now \"seeing\" the\n   * right side of the canvas.\n   *\n   * The confusing thing about this value is that it does not, and must not\n   * include the absoluteLeft offset. This is because it is used to calculate\n   * the viewLeft value.\n   *\n   * The viewLeft is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewLeft and workspace origin are at\n   * the same X location. As the canvas slides towards the right beneath the\n   * view this value (scrollX) becomes more positive, and the viewLeft becomes\n   * more negative relative to the workspace origin (imagine the workspace\n   * origin as a dot on the canvas sliding to the right as the canvas moves).\n   *\n   * So if the scrollX were to include the absoluteLeft this would in a way\n   * \"unshift\" the workspace origin. This means that the viewLeft would be\n   * representing the left edge of the blocklyDiv, rather than the left edge\n   * of the workspace.\n   */\n  scrollX = 0;\n\n  /**\n   * Current vertical scrolling offset in pixel units, relative to the\n   * workspace origin.\n   *\n   * It is useful to think about a view, and a canvas moving beneath that\n   * view. As the canvas moves down, this value becomes more positive, and the\n   * view is now \"seeing\" the upper part of the canvas. As the canvas moves\n   * up, this value becomes more negative, and the view is \"seeing\" the lower\n   * part of the canvas.\n   *\n   * This confusing thing about this value is that it does not, and must not\n   * include the absoluteTop offset. This is because it is used to calculate\n   * the viewTop value.\n   *\n   * The viewTop is relative to the workspace origin (although in pixel\n   * units). The workspace origin is the top-left corner of the workspace (at\n   * least when it is enabled). It is shifted from the top-left of the\n   * blocklyDiv so as not to be beneath the toolbox.\n   *\n   * When the workspace is enabled the viewTop and workspace origin are at the\n   * same Y location. As the canvas slides towards the bottom this value\n   * (scrollY) becomes more positive, and the viewTop becomes more negative\n   * relative to the workspace origin (image in the workspace origin as a dot\n   * on the canvas sliding downwards as the canvas moves).\n   *\n   * So if the scrollY were to include the absoluteTop this would in a way\n   * \"unshift\" the workspace origin. This means that the viewTop would be\n   * representing the top edge of the blocklyDiv, rather than the top edge of\n   * the workspace.\n   */\n  scrollY = 0;\n\n  /** Horizontal scroll value when scrolling started in pixel units. */\n  startScrollX = 0;\n\n  /** Vertical scroll value when scrolling started in pixel units. */\n  startScrollY = 0;\n\n  /** Distance from mouse to object being dragged. */\n  private dragDeltaXY: Coordinate|null = null;\n\n  /** Current scale. */\n  scale = 1;\n\n  /** Cached scale value. Used to detect changes in viewport. */\n  private oldScale = 1;\n\n  /** Cached viewport top value. Used to detect changes in viewport. */\n  private oldTop = 0;\n\n  /** Cached viewport left value. Used to detect changes in viewport. */\n  private oldLeft = 0;\n\n  /** The workspace's trashcan (if any). */\n  trashcan: Trashcan|null = null;\n\n  /** This workspace's scrollbars, if they exist. */\n  scrollbar: ScrollbarPair|null = null;\n\n  /**\n   * Fixed flyout providing blocks which may be dragged into this workspace.\n   */\n  private flyout: IFlyout|null = null;\n\n  /**\n   * Category-based toolbox providing blocks which may be dragged into this\n   * workspace.\n   */\n  private toolbox_: IToolbox|null = null;\n\n  /**\n   * The current gesture in progress on this workspace, if any.\n   *\n   * @internal\n   */\n  currentGesture_: Gesture|null = null;\n\n  /** This workspace's surface for dragging blocks, if it exists. */\n  private readonly blockDragSurface: BlockDragSurfaceSvg|null = null;\n\n  /** This workspace's drag surface, if it exists. */\n  private readonly workspaceDragSurface: WorkspaceDragSurfaceSvg|null = null;\n\n  /**\n   * Whether to move workspace to the drag surface when it is dragged.\n   * True if it should move, false if it should be translated directly.\n   */\n  private readonly useWorkspaceDragSurface;\n\n  /**\n   * Whether the drag surface is actively in use. When true, calls to\n   * translate will translate the drag surface instead of the translating the\n   * workspace directly.\n   * This is set to true in setupDragSurface and to false in resetDragSurface.\n   */\n  private isDragSurfaceActive = false;\n\n  /**\n   * The first parent div with 'injectionDiv' in the name, or null if not set.\n   * Access this with getInjectionDiv.\n   */\n  private injectionDiv: Element|null = null;\n\n  /**\n   * Last known position of the page scroll.\n   * This is used to determine whether we have recalculated screen coordinate\n   * stuff since the page scrolled.\n   */\n  private lastRecordedPageScroll: Coordinate|null = null;\n\n  /**\n   * Developers may define this function to add custom menu options to the\n   * workspace's context menu or edit the workspace-created set of menu\n   * options.\n   *\n   * @param options List of menu options to add to.\n   * @param e The right-click event that triggered the context menu.\n   */\n  configureContextMenu:\n      ((menuOptions: ContextMenuOption[], e: Event) => void)|null = null;\n\n  /**\n   * In a flyout, the target workspace where blocks should be placed after a\n   * drag. Otherwise null.\n   *\n   * @internal\n   */\n  targetWorkspace: WorkspaceSvg|null = null;\n\n  /** Inverted screen CTM, for use in mouseToSvg. */\n  private inverseScreenCTM: SVGMatrix|null = null;\n\n  /** Inverted screen CTM is dirty, recalculate it. */\n  private inverseScreenCTMDirty = true;\n  private metricsManager: IMetricsManager;\n  /** @internal */\n  getMetrics: () => Metrics;\n  /** @internal */\n  setMetrics: (p1: {x?: number, y?: number}) => void;\n  private readonly componentManager: ComponentManager;\n\n  /**\n   * List of currently highlighted blocks.  Block highlighting is often used\n   * to visually mark blocks currently being executed.\n   */\n  private readonly highlightedBlocks: BlockSvg[] = [];\n  private audioManager: WorkspaceAudio;\n  private grid: Grid|null;\n  private markerManager: MarkerManager;\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * custom toolbox category is opened.\n   */\n  private toolboxCategoryCallbacks =\n      new Map<string, (p1: WorkspaceSvg) => toolbox.FlyoutDefinition>();\n\n  /**\n   * Map from function names to callbacks, for deciding what to do when a\n   * button is clicked.\n   */\n  private flyoutButtonCallbacks = new Map<string, (p1: FlyoutButton) => void>();\n  protected themeManager_: ThemeManager;\n  private readonly renderer: Renderer;\n\n  /** Cached parent SVG. */\n  private cachedParentSvg: SVGElement|null = null;\n\n  /** True if keyboard accessibility mode is on, false otherwise. */\n  keyboardAccessibilityMode = false;\n\n  /** The list of top-level bounded elements on the workspace. */\n  private topBoundedElements: IBoundedElement[] = [];\n\n  /** The recorded drag targets. */\n  private dragTargetAreas: Array<{component: IDragTarget, clientRect: Rect}> =\n      [];\n  private readonly cachedParentSvgSize: Size;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgGroup_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBackground_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBlockCanvas_!: SVGElement;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  svgBubbleCanvas_!: SVGElement;\n  zoomControls_: ZoomControls|null = null;\n\n  /**\n   * @param options Dictionary of options.\n   * @param opt_blockDragSurface Drag surface for blocks.\n   * @param opt_wsDragSurface Drag surface for the workspace.\n   */\n  constructor(\n      options: Options, opt_blockDragSurface?: BlockDragSurfaceSvg,\n      opt_wsDragSurface?: WorkspaceDragSurfaceSvg) {\n    super(options);\n\n    const MetricsManagerClass = registry.getClassFromOptions(\n        registry.Type.METRICS_MANAGER, options, true);\n    /** Object in charge of calculating metrics for the workspace. */\n    this.metricsManager = new MetricsManagerClass!(this);\n\n    /** Method to get all the metrics that have to do with a workspace. */\n    this.getMetrics = options.getMetrics ||\n        this.metricsManager.getMetrics.bind(this.metricsManager);\n\n    /** Translates the workspace. */\n    this.setMetrics =\n        options.setMetrics || WorkspaceSvg.setTopLevelWorkspaceMetrics_;\n\n    this.componentManager = new ComponentManager();\n\n    this.connectionDBList = ConnectionDB.init(this.connectionChecker);\n\n    if (opt_blockDragSurface) {\n      this.blockDragSurface = opt_blockDragSurface;\n    }\n\n    if (opt_wsDragSurface) {\n      this.workspaceDragSurface = opt_wsDragSurface;\n    }\n\n    this.useWorkspaceDragSurface = !!this.workspaceDragSurface;\n\n    /**\n     * Object in charge of loading, storing, and playing audio for a workspace.\n     */\n    this.audioManager =\n        new WorkspaceAudio((options.parentWorkspace as WorkspaceSvg));\n\n    /** This workspace's grid object or null. */\n    this.grid = this.options.gridPattern ?\n        new Grid(this.options.gridPattern, options.gridOptions) :\n        null;\n\n    /** Manager in charge of markers and cursors. */\n    this.markerManager = new MarkerManager(this);\n\n    if (Variables && Variables.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n          Variables.CATEGORY_NAME, Variables.flyoutCategory);\n    }\n\n    if (VariablesDynamic && VariablesDynamic.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n          VariablesDynamic.CATEGORY_NAME, VariablesDynamic.flyoutCategory);\n    }\n\n    if (Procedures && Procedures.flyoutCategory) {\n      this.registerToolboxCategoryCallback(\n          Procedures.CATEGORY_NAME, Procedures.flyoutCategory);\n      this.addChangeListener(Procedures.mutatorOpenListener);\n    }\n\n    /** Object in charge of storing and updating the workspace theme. */\n    this.themeManager_ = this.options.parentWorkspace ?\n        this.options.parentWorkspace.getThemeManager() :\n        new ThemeManager(this, this.options.theme || Classic);\n    this.themeManager_.subscribeWorkspace(this);\n\n    /** The block renderer used for rendering blocks on this workspace. */\n    this.renderer = blockRendering.init(\n        this.options.renderer || 'geras', this.getTheme(),\n        this.options.rendererOverrides ?? undefined);\n\n    /**\n     * The cached size of the parent svg element.\n     * Used to compute svg metrics.\n     */\n    this.cachedParentSvgSize = new Size(0, 0);\n  }\n\n  /**\n   * Get the marker manager for this workspace.\n   *\n   * @returns The marker manager.\n   */\n  getMarkerManager(): MarkerManager {\n    return this.markerManager;\n  }\n\n  /**\n   * Gets the metrics manager for this workspace.\n   *\n   * @returns The metrics manager.\n   */\n  getMetricsManager(): IMetricsManager {\n    return this.metricsManager;\n  }\n\n  /**\n   * Sets the metrics manager for the workspace.\n   *\n   * @param metricsManager The metrics manager.\n   * @internal\n   */\n  setMetricsManager(metricsManager: IMetricsManager) {\n    this.metricsManager = metricsManager;\n    this.getMetrics = this.metricsManager.getMetrics.bind(this.metricsManager);\n  }\n\n  /**\n   * Gets the component manager for this workspace.\n   *\n   * @returns The component manager.\n   */\n  getComponentManager(): ComponentManager {\n    return this.componentManager;\n  }\n\n  /**\n   * Add the cursor SVG to this workspaces SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.markerManager.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.markerManager.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Get the marker with the given ID.\n   *\n   * @param id The ID of the marker.\n   * @returns The marker with the given ID or null if no marker with the given\n   *     ID exists.\n   * @internal\n   */\n  getMarker(id: string): Marker|null {\n    if (this.markerManager) {\n      return this.markerManager.getMarker(id);\n    }\n    return null;\n  }\n\n  /**\n   * The cursor for this workspace.\n   *\n   * @returns The cursor for the workspace.\n   */\n  getCursor(): Cursor|null {\n    if (this.markerManager) {\n      return this.markerManager.getCursor();\n    }\n    return null;\n  }\n\n  /**\n   * Get the block renderer attached to this workspace.\n   *\n   * @returns The renderer attached to this workspace.\n   */\n  getRenderer(): Renderer {\n    return this.renderer;\n  }\n\n  /**\n   * Get the theme manager for this workspace.\n   *\n   * @returns The theme manager for this workspace.\n   * @internal\n   */\n  getThemeManager(): ThemeManager {\n    return this.themeManager_;\n  }\n\n  /**\n   * Get the workspace theme object.\n   *\n   * @returns The workspace theme object.\n   */\n  getTheme(): Theme {\n    return this.themeManager_.getTheme();\n  }\n\n  /**\n   * Set the workspace theme object.\n   * If no theme is passed, default to the `Classic` theme.\n   *\n   * @param theme The workspace theme object.\n   */\n  setTheme(theme: Theme) {\n    if (!theme) {\n      theme = Classic as Theme;\n    }\n    this.themeManager_.setTheme(theme);\n  }\n\n  /**\n   * Refresh all blocks on the workspace after a theme update.\n   */\n  refreshTheme() {\n    if (this.svgGroup_) {\n      this.renderer.refreshDom(this.svgGroup_, this.getTheme());\n    }\n\n    // Update all blocks in workspace that have a style name.\n    this.updateBlockStyles_(this.getAllBlocks(false).filter(function(block) {\n      return !!block.getStyleName();\n    }));\n\n    // Update current toolbox selection.\n    this.refreshToolboxSelection();\n    if (this.toolbox_) {\n      this.toolbox_.refreshTheme();\n    }\n\n    // Re-render if workspace is visible\n    if (this.isVisible()) {\n      this.setVisible(true);\n    }\n\n    const event = new (eventUtils.get(eventUtils.THEME_CHANGE))(\n        this.getTheme().name, this.id);\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Updates all the blocks with new style.\n   *\n   * @param blocks List of blocks to update the style on.\n   */\n  private updateBlockStyles_(blocks: Block[]) {\n    for (let i = 0, block; block = blocks[i]; i++) {\n      const blockStyleName = block.getStyleName();\n      if (blockStyleName) {\n        const blockSvg = block as BlockSvg;\n        blockSvg.setStyle(blockStyleName);\n        if (blockSvg.mutator) {\n          blockSvg.mutator.updateBlockStyle();\n        }\n      }\n    }\n  }\n\n  /**\n   * Getter for the inverted screen CTM.\n   *\n   * @returns The matrix to use in mouseToSvg\n   */\n  getInverseScreenCTM(): SVGMatrix|null {\n    // Defer getting the screen CTM until we actually need it, this should\n    // avoid forced reflows from any calls to updateInverseScreenCTM.\n    if (this.inverseScreenCTMDirty) {\n      const ctm = this.getParentSvg().getScreenCTM();\n      if (ctm) {\n        this.inverseScreenCTM = (ctm).inverse();\n        this.inverseScreenCTMDirty = false;\n      }\n    }\n\n    return this.inverseScreenCTM;\n  }\n\n  /** Mark the inverse screen CTM as dirty. */\n  updateInverseScreenCTM() {\n    this.inverseScreenCTMDirty = true;\n  }\n\n  /**\n   * Getter for isVisible\n   *\n   * @returns Whether the workspace is visible.\n   *     False if the workspace has been hidden by calling `setVisible(false)`.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this element,\n   * scales that after canvas SVG element, if it's a descendant.\n   * The origin (0,0) is the top-left corner of the Blockly SVG.\n   *\n   * @param element SVG element to find the coordinates of.\n   * @returns Object with .x and .y properties.\n   * @internal\n   */\n  getSvgXY(element: SVGElement): Coordinate {\n    let x = 0;\n    let y = 0;\n    let scale = 1;\n    if (dom.containsNode(this.getCanvas(), element) ||\n        dom.containsNode(this.getBubbleCanvas(), element)) {\n      // Before the SVG canvas, scale the coordinates.\n      scale = this.scale;\n    }\n    do {\n      // Loop through this block and every parent.\n      const xy = svgMath.getRelativeXY(element);\n      if (element === this.getCanvas() || element === this.getBubbleCanvas()) {\n        // After the SVG canvas, don't scale the coordinates.\n        scale = 1;\n      }\n      x += xy.x * scale;\n      y += xy.y * scale;\n      element = element.parentNode as SVGElement;\n    } while (element && element !== this.getParentSvg());\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Gets the size of the workspace's parent SVG element.\n   *\n   * @returns The cached width and height of the workspace's parent SVG element.\n   * @internal\n   */\n  getCachedParentSvgSize(): Size {\n    const size = this.cachedParentSvgSize;\n    return new Size(size.width, size.height);\n  }\n\n  /**\n   * Return the position of the workspace origin relative to the injection div\n   * origin in pixels.\n   * The workspace origin is where a block would render at position (0, 0).\n   * It is not the upper left corner of the workspace SVG.\n   *\n   * @returns Offset in pixels.\n   * @internal\n   */\n  getOriginOffsetInPixels(): Coordinate {\n    return svgMath.getInjectionDivXY(this.getCanvas());\n  }\n\n  /**\n   * Return the injection div that is a parent of this workspace.\n   * Walks the DOM the first time it's called, then returns a cached value.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns The first parent div with 'injectionDiv' in the name.\n   * @internal\n   */\n  getInjectionDiv(): Element {\n    // NB: it would be better to pass this in at createDom, but is more likely\n    // to break existing uses of Blockly.\n    if (!this.injectionDiv) {\n      let element: Element = this.svgGroup_;\n      while (element) {\n        const classes = element.getAttribute('class') || '';\n        if ((' ' + classes + ' ').indexOf(' injectionDiv ') !== -1) {\n          this.injectionDiv = element;\n          break;\n        }\n        element = element.parentNode as Element;\n      }\n    }\n    return this.injectionDiv!;\n  }\n\n  /**\n   * Get the SVG block canvas for the workspace.\n   *\n   * @returns The SVG group for the workspace.\n   * @internal\n   */\n  getBlockCanvas(): SVGElement|null {\n    return this.svgBlockCanvas_;\n  }\n\n  /**\n   * Save resize handler data so we can delete it later in dispose.\n   *\n   * @param handler Data that can be passed to eventHandling.unbind.\n   */\n  setResizeHandlerWrapper(handler: browserEvents.Data) {\n    this.resizeHandlerWrapper = handler;\n  }\n\n  /**\n   * Create the workspace DOM elements.\n   *\n   * @param opt_backgroundClass Either 'blocklyMainBackground' or\n   *     'blocklyMutatorBackground'.\n   * @returns The workspace's SVG group.\n   */\n  createDom(opt_backgroundClass?: string): Element {\n    /**\n     * <g class=\"blocklyWorkspace\">\n     *   <rect class=\"blocklyMainBackground\" height=\"100%\" width=\"100%\"></rect>\n     *   [Trashcan and/or flyout may go here]\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\"></g>\n     * </g>\n     */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyWorkspace'});\n\n    // Note that a <g> alone does not receive mouse events--it must have a\n    // valid target inside it.  If no background class is specified, as in the\n    // flyout, the workspace will not receive mouse events.\n    if (opt_backgroundClass) {\n      this.svgBackground_ = dom.createSvgElement(\n          Svg.RECT,\n          {'height': '100%', 'width': '100%', 'class': opt_backgroundClass},\n          this.svgGroup_);\n\n      if (opt_backgroundClass === 'blocklyMainBackground' && this.grid) {\n        this.svgBackground_.style.fill =\n            'url(#' + this.grid.getPatternId() + ')';\n      } else {\n        this.themeManager_.subscribe(\n            this.svgBackground_, 'workspaceBackgroundColour', 'fill');\n      }\n    }\n    this.svgBlockCanvas_ = dom.createSvgElement(\n        Svg.G, {'class': 'blocklyBlockCanvas'}, this.svgGroup_);\n    this.svgBubbleCanvas_ = dom.createSvgElement(\n        Svg.G, {'class': 'blocklyBubbleCanvas'}, this.svgGroup_);\n\n    if (!this.isFlyout) {\n      browserEvents.conditionalBind(\n          this.svgGroup_, 'pointerdown', this, this.onMouseDown_, false);\n      // This no-op works around https://bugs.webkit.org/show_bug.cgi?id=226683,\n      // which otherwise prevents zoom/scroll events from being observed in\n      // Safari. Once that bug is fixed it should be removed.\n      document.body.addEventListener('wheel', function() {});\n      browserEvents.conditionalBind(\n          this.svgGroup_, 'wheel', this, this.onMouseWheel_);\n    }\n\n    // Determine if there needs to be a category tree, or a simple list of\n    // blocks.  This cannot be changed later, since the UI is very different.\n    if (this.options.hasCategories) {\n      const ToolboxClass = registry.getClassFromOptions(\n          registry.Type.TOOLBOX, this.options, true);\n      this.toolbox_ = new ToolboxClass!(this);\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n    this.recordDragTargets();\n    const CursorClass =\n        registry.getClassFromOptions(registry.Type.CURSOR, this.options);\n\n    CursorClass && this.markerManager.setCursor(new CursorClass());\n\n    this.renderer.createDom(this.svgGroup_, this.getTheme());\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  override dispose() {\n    // Stop rerendering.\n    this.rendered = false;\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.toolbox_) {\n      this.toolbox_.dispose();\n      this.toolbox_ = null;\n    }\n    if (this.flyout) {\n      this.flyout.dispose();\n      this.flyout = null;\n    }\n    if (this.trashcan) {\n      this.trashcan.dispose();\n      this.trashcan = null;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.dispose();\n      this.scrollbar = null;\n    }\n    if (this.zoomControls_) {\n      this.zoomControls_.dispose();\n    }\n\n    if (this.audioManager) {\n      this.audioManager.dispose();\n    }\n\n    if (this.grid) {\n      this.grid = null;\n    }\n\n    this.renderer.dispose();\n\n    if (this.markerManager) {\n      this.markerManager.dispose();\n    }\n\n    super.dispose();\n\n    // Dispose of theme manager after all blocks and mutators are disposed of.\n    if (this.themeManager_) {\n      this.themeManager_.unsubscribeWorkspace(this);\n      this.themeManager_.unsubscribe(this.svgBackground_);\n      if (!this.options.parentWorkspace) {\n        this.themeManager_.dispose();\n      }\n    }\n\n    this.connectionDBList.length = 0;\n\n    this.toolboxCategoryCallbacks.clear();\n    this.flyoutButtonCallbacks.clear();\n\n    if (!this.options.parentWorkspace) {\n      // Top-most workspace.  Dispose of the div that the\n      // SVG is injected into (i.e. injectionDiv).\n      const parentSvg = this.getParentSvg();\n      if (parentSvg && parentSvg.parentNode) {\n        dom.removeNode(parentSvg.parentNode);\n      }\n    }\n    if (this.resizeHandlerWrapper) {\n      browserEvents.unbind(this.resizeHandlerWrapper);\n      this.resizeHandlerWrapper = null;\n    }\n  }\n\n  /**\n   * Add a trashcan.\n   *\n   * @internal\n   */\n  addTrashcan() {\n    this.trashcan = WorkspaceSvg.newTrashcan(this);\n    const svgTrashcan = this.trashcan.createDom();\n    this.svgGroup_.insertBefore(svgTrashcan, this.svgBlockCanvas_);\n  }\n\n  /**\n   * @param _workspace\n   * @internal\n   */\n  static newTrashcan(_workspace: WorkspaceSvg): Trashcan {\n    throw new Error(\n        'The implementation of newTrashcan should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /**\n   * Add zoom controls.\n   *\n   * @internal\n   */\n  addZoomControls() {\n    this.zoomControls_ = new ZoomControls(this);\n    const svgZoomControls = this.zoomControls_.createDom();\n    this.svgGroup_.appendChild(svgZoomControls);\n  }\n\n  /**\n   * Add a flyout element in an element with the given tag name.\n   *\n   * @param tagName What type of tag the flyout belongs in.\n   * @returns The element containing the flyout DOM.\n   * @internal\n   */\n  addFlyout(tagName: string|Svg<SVGSVGElement>|Svg<SVGGElement>): Element {\n    const workspaceOptions = new Options(({\n      'parentWorkspace': this,\n      'rtl': this.RTL,\n      'oneBasedIndex': this.options.oneBasedIndex,\n      'horizontalLayout': this.horizontalLayout,\n      'renderer': this.options.renderer,\n      'rendererOverrides': this.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions));\n    workspaceOptions.toolboxPosition = this.options.toolboxPosition;\n    if (this.horizontalLayout) {\n      const HorizontalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, this.options, true);\n      this.flyout = new HorizontalFlyout!(workspaceOptions);\n    } else {\n      const VerticalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_VERTICAL_TOOLBOX, this.options, true);\n      this.flyout = new VerticalFlyout!(workspaceOptions);\n    }\n    this.flyout.autoClose = false;\n    this.flyout.getWorkspace().setVisible(true);\n\n    // Return the element so that callers can place it in their desired\n    // spot in the DOM.  For example, mutator flyouts do not go in the same\n    // place as main workspace flyouts.\n    return this.flyout.createDom(tagName);\n  }\n\n  /**\n   * Getter for the flyout associated with this workspace.  This flyout may be\n   * owned by either the toolbox or the workspace, depending on toolbox\n   * configuration.  It will be null if there is no flyout.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout.\n   * @returns The flyout on this workspace.\n   */\n  getFlyout(opt_own?: boolean): IFlyout|null {\n    if (this.flyout || opt_own) {\n      return this.flyout;\n    }\n    if (this.toolbox_) {\n      return this.toolbox_.getFlyout();\n    }\n    return null;\n  }\n\n  /**\n   * Getter for the toolbox associated with this workspace, if one exists.\n   *\n   * @returns The toolbox on this workspace.\n   */\n  getToolbox(): IToolbox|null {\n    return this.toolbox_;\n  }\n\n  /**\n   * Update items that use screen coordinate calculations\n   * because something has changed (e.g. scroll position, window size).\n   */\n  private updateScreenCalculations_() {\n    this.updateInverseScreenCTM();\n    this.recordDragTargets();\n  }\n\n  /**\n   * If enabled, resize the parts of the workspace that change when the\n   * workspace contents (e.g. block positions) change.  This will also scroll\n   * the workspace contents if needed.\n   *\n   * @internal\n   */\n  resizeContents() {\n    if (!this.resizesEnabled || !this.rendered) {\n      return;\n    }\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateInverseScreenCTM();\n  }\n\n  /**\n   * Resize and reposition all of the workspace chrome (toolbox,\n   * trash, scrollbars etc.)\n   * This should be called when something changes that\n   * requires recalculating dimensions and positions of the\n   * trash, zoom, toolbox, etc. (e.g. window resize).\n   */\n  resize() {\n    if (this.toolbox_) {\n      this.toolbox_.position();\n    }\n    if (this.flyout) {\n      this.flyout.position();\n    }\n\n    const positionables = this.componentManager.getComponents(\n        ComponentManager.Capability.POSITIONABLE, true);\n    const metrics = this.getMetricsManager().getUiMetrics();\n    const savedPositions = [];\n    for (let i = 0, positionable; positionable = positionables[i]; i++) {\n      positionable.position(metrics, savedPositions);\n      const boundingRect = positionable.getBoundingRectangle();\n      if (boundingRect) {\n        savedPositions.push(boundingRect);\n      }\n    }\n\n    if (this.scrollbar) {\n      this.scrollbar.resize();\n    }\n    this.updateScreenCalculations_();\n  }\n\n  /**\n   * Resizes and repositions workspace chrome if the page has a new\n   * scroll position.\n   *\n   * @internal\n   */\n  updateScreenCalculationsIfScrolled() {\n    /* eslint-disable indent */\n    const currScroll = svgMath.getDocumentScroll();\n    if (!Coordinate.equals(this.lastRecordedPageScroll, currScroll)) {\n      this.lastRecordedPageScroll = currScroll;\n      this.updateScreenCalculations_();\n    }\n  }\n  /* eslint-enable indent */\n\n  /**\n   * Get the SVG element that forms the drawing surface.\n   *\n   * @returns SVG group element.\n   */\n  getCanvas(): SVGGElement {\n    return this.svgBlockCanvas_ as SVGGElement;\n  }\n\n  /**\n   * Caches the width and height of the workspace's parent SVG element for use\n   * with getSvgMetrics.\n   *\n   * @param width The width of the parent SVG element.\n   * @param height The height of the parent SVG element\n   * @internal\n   */\n  setCachedParentSvgSize(width: number|null, height: number|null) {\n    const svg = this.getParentSvg();\n    if (width != null) {\n      this.cachedParentSvgSize.width = width;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-width', `${width}`);\n    }\n    if (height != null) {\n      this.cachedParentSvgSize.height = height;\n      // This is set to support the public (but deprecated) Blockly.svgSize\n      // method.\n      svg.setAttribute('data-cached-height', `${height}`);\n    }\n  }\n\n  /**\n   * Get the SVG element that forms the bubble surface.\n   *\n   * @returns SVG group element.\n   */\n  getBubbleCanvas(): SVGGElement {\n    return this.svgBubbleCanvas_ as SVGGElement;\n  }\n\n  /**\n   * Get the SVG element that contains this workspace.\n   * Note: We assume this is only called after the workspace has been injected\n   * into the DOM.\n   *\n   * @returns SVG element.\n   */\n  getParentSvg(): SVGSVGElement {\n    if (!this.cachedParentSvg) {\n      let element = this.svgGroup_;\n      while (element) {\n        if (element.tagName === 'svg') {\n          this.cachedParentSvg = element;\n          break;\n        }\n        element = element.parentNode as SVGSVGElement;\n      }\n    }\n    return this.cachedParentSvg as SVGSVGElement;\n  }\n\n  /**\n   * Fires a viewport event if events are enabled and there is a change in\n   * viewport values.\n   *\n   * @internal\n   */\n  maybeFireViewportChangeEvent() {\n    if (!eventUtils.isEnabled()) {\n      return;\n    }\n    const scale = this.scale;\n    const top = -this.scrollY;\n    const left = -this.scrollX;\n    if (scale === this.oldScale && Math.abs(top - this.oldTop) < 1 &&\n        Math.abs(left - this.oldLeft) < 1) {\n      // Ignore sub-pixel changes in top and left. Due to #4192 there are a lot\n      // of negligible changes in viewport top/left.\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.VIEWPORT_CHANGE))(\n        top, left, scale, this.id, this.oldScale);\n    this.oldScale = scale;\n    this.oldTop = top;\n    this.oldLeft = left;\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Translate this workspace to new coordinates.\n   *\n   * @param x Horizontal translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   * @param y Vertical translation, in pixel units relative to the top left of\n   *     the Blockly div.\n   */\n  translate(x: number, y: number) {\n    if (this.useWorkspaceDragSurface && this.isDragSurfaceActive) {\n      this.workspaceDragSurface?.translateSurface(x, y);\n    } else {\n      const translation = 'translate(' + x + ',' + y + ') ' +\n          'scale(' + this.scale + ')';\n      this.svgBlockCanvas_.setAttribute('transform', translation);\n      this.svgBubbleCanvas_.setAttribute('transform', translation);\n    }\n    // Now update the block drag surface if we're using one.\n    if (this.blockDragSurface) {\n      this.blockDragSurface.translateAndScaleGroup(x, y, this.scale);\n    }\n    // And update the grid if we're using one.\n    if (this.grid) {\n      this.grid.moveTo(x, y);\n    }\n\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Called at the end of a workspace drag to take the contents\n   * out of the drag surface and put them back into the workspace SVG.\n   * Does nothing if the workspace drag surface is not enabled.\n   *\n   * @internal\n   */\n  resetDragSurface() {\n    // Don't do anything if we aren't using a drag surface.\n    if (!this.useWorkspaceDragSurface) {\n      return;\n    }\n\n    this.isDragSurfaceActive = false;\n\n    const trans = this.workspaceDragSurface!.getSurfaceTranslation();\n    this.workspaceDragSurface!.clearAndHide(this.svgGroup_);\n    const translation = 'translate(' + trans.x + ',' + trans.y + ') ' +\n        'scale(' + this.scale + ')';\n    this.svgBlockCanvas_.setAttribute('transform', translation);\n    this.svgBubbleCanvas_.setAttribute('transform', translation);\n  }\n\n  /**\n   * Called at the beginning of a workspace drag to move contents of\n   * the workspace to the drag surface.\n   * Does nothing if the drag surface is not enabled.\n   *\n   * @internal\n   */\n  setupDragSurface() {\n    // Don't do anything if we aren't using a drag surface.\n    if (!this.useWorkspaceDragSurface) {\n      return;\n    }\n\n    // This can happen if the user starts a drag, mouses up outside of the\n    // document where the mouseup listener is registered (e.g. outside of an\n    // iframe) and then moves the mouse back in the workspace.  On mobile and\n    // ff, we get the mouseup outside the frame. On chrome and safari desktop we\n    // do not.\n    if (this.isDragSurfaceActive) {\n      return;\n    }\n\n    this.isDragSurfaceActive = true;\n\n    // Figure out where we want to put the canvas back.  The order\n    // in the is important because things are layered.\n    const previousElement = this.svgBlockCanvas_.previousSibling as Element;\n    const width = parseInt(this.getParentSvg().getAttribute('width') ?? '0');\n    const height = parseInt(this.getParentSvg().getAttribute('height') ?? '0');\n    const coord = svgMath.getRelativeXY(this.getCanvas());\n    this.workspaceDragSurface!.setContentsAndShow(\n        this.getCanvas(), this.getBubbleCanvas(), previousElement, width,\n        height, this.scale);\n    this.workspaceDragSurface!.translateSurface(coord.x, coord.y);\n  }\n\n  /**\n   * Gets the drag surface blocks are moved to when a drag is started.\n   *\n   * @returns This workspace's block drag surface, if one is in use.\n   * @internal\n   */\n  getBlockDragSurface(): BlockDragSurfaceSvg|null {\n    return this.blockDragSurface;\n  }\n\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   *\n   * @returns Width.\n   */\n  override getWidth(): number {\n    const metrics = this.getMetrics();\n    return metrics ? metrics.viewWidth / this.scale : 0;\n  }\n\n  /**\n   * Toggles the visibility of the workspace.\n   * Currently only intended for main workspace.\n   *\n   * @param isVisible True if workspace should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    this.isVisible_ = isVisible;\n    if (!this.svgGroup_) {\n      return;\n    }\n\n    // Tell the scrollbar whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.scrollbar) {\n      this.scrollbar.setContainerVisible(isVisible);\n    }\n\n    // Tell the flyout whether its container is visible so it can\n    // tell when to hide itself.\n    if (this.getFlyout()) {\n      this.getFlyout()!.setContainerVisible(isVisible);\n    }\n\n    this.getParentSvg().style.display = isVisible ? 'block' : 'none';\n    if (this.toolbox_) {\n      // Currently does not support toolboxes in mutators.\n      this.toolbox_.setVisible(isVisible);\n    }\n    if (isVisible) {\n      const blocks = this.getAllBlocks(false);\n      // Tell each block on the workspace to mark its fields as dirty.\n      for (let i = blocks.length - 1; i >= 0; i--) {\n        blocks[i].markDirty();\n      }\n\n      this.render();\n      if (this.toolbox_) {\n        this.toolbox_.position();\n      }\n    } else {\n      this.hideChaff(true);\n    }\n  }\n\n  /** Render all blocks in workspace. */\n  render() {\n    // Generate list of all blocks.\n    const blocks = this.getAllBlocks(false);\n    // Render each block.\n    for (let i = blocks.length - 1; i >= 0; i--) {\n      blocks[i].render(false);\n    }\n\n    if (this.currentGesture_) {\n      const imList = this.currentGesture_.getInsertionMarkers();\n      for (let i = 0; i < imList.length; i++) {\n        imList[i].render(false);\n      }\n    }\n\n    this.markerManager.updateMarkers();\n  }\n\n  /**\n   * Highlight or unhighlight a block in the workspace.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param id ID of block to highlight/unhighlight, or null for no block (used\n   *     to unhighlight all blocks).\n   * @param opt_state If undefined, highlight specified block and automatically\n   *     unhighlight all others.  If true or false, manually\n   *     highlight/unhighlight the specified block.\n   */\n  highlightBlock(id: string|null, opt_state?: boolean) {\n    if (opt_state === undefined) {\n      // Unhighlight all blocks.\n      for (let i = 0, block; block = this.highlightedBlocks[i]; i++) {\n        block.setHighlighted(false);\n      }\n      this.highlightedBlocks.length = 0;\n    }\n    // Highlight/unhighlight the specified block.\n    const block = id ? this.getBlockById(id) : null;\n    if (block) {\n      const state = opt_state === undefined || opt_state;\n      // Using Set here would be great, but at the cost of IE10 support.\n      if (!state) {\n        arrayUtils.removeElem(this.highlightedBlocks, block);\n      } else if (this.highlightedBlocks.indexOf(block) === -1) {\n        this.highlightedBlocks.push(block);\n      }\n      block.setHighlighted(state);\n    }\n  }\n\n  /**\n   * Pastes the provided block or workspace comment onto the workspace.\n   * Does not check whether there is remaining capacity for the object, that\n   * should be done before calling this method.\n   *\n   * @param state The representation of the thing to paste.\n   * @returns The pasted thing, or null if the paste was not successful.\n   */\n  paste(state: AnyDuringMigration|Element|DocumentFragment): ICopyable|null {\n    if (!this.rendered || !state['type'] && !state['tagName']) {\n      return null;\n    }\n    if (this.currentGesture_) {  // Dragging while pasting?  No.\n      this.currentGesture_.cancel();\n    }\n\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    let pastedThing;\n    try {\n      // Checks if this is JSON. JSON has a type property, while elements don't.\n      if (state['type']) {\n        pastedThing = this.pasteBlock_(null, state as blocks.State);\n      } else {\n        const xmlBlock = state as Element;\n        if (xmlBlock.tagName.toLowerCase() === 'comment') {\n          pastedThing = this.pasteWorkspaceComment_(xmlBlock);\n        } else {\n          pastedThing = this.pasteBlock_(xmlBlock, null);\n        }\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n    return pastedThing;\n  }\n\n  /**\n   * Paste the provided block onto the workspace.\n   *\n   * @param xmlBlock XML block element.\n   * @param jsonBlock JSON block representation.\n   * @returns The pasted block.\n   */\n  private pasteBlock_(xmlBlock: Element|null, jsonBlock: blocks.State|null):\n      BlockSvg {\n    eventUtils.disable();\n    let block: BlockSvg;\n    try {\n      let blockX = 0;\n      let blockY = 0;\n      if (xmlBlock) {\n        block = Xml.domToBlock(xmlBlock, this) as BlockSvg;\n        blockX = parseInt(xmlBlock.getAttribute('x') ?? '0');\n        if (this.RTL) {\n          blockX = -blockX;\n        }\n        blockY = parseInt(xmlBlock.getAttribute('y') ?? '0');\n      } else if (jsonBlock) {\n        block = blocks.append(jsonBlock, this) as BlockSvg;\n        blockX = jsonBlock['x'] || 10;\n        if (this.RTL) {\n          blockX = this.getWidth() - blockX;\n        }\n        blockY = jsonBlock['y'] || 10;\n      }\n\n      // Move the duplicate to original position.\n      if (!isNaN(blockX) && !isNaN(blockY)) {\n        // Offset block until not clobbering another block and not in connection\n        // distance with neighbouring blocks.\n        let collide;\n        do {\n          collide = false;\n          const allBlocks = this.getAllBlocks(false);\n          for (let i = 0, otherBlock; otherBlock = allBlocks[i]; i++) {\n            const otherXY = otherBlock.getRelativeToSurfaceXY();\n            if (Math.abs(blockX - otherXY.x) <= 1 &&\n                Math.abs(blockY - otherXY.y) <= 1) {\n              collide = true;\n              break;\n            }\n          }\n          if (!collide) {\n            // Check for blocks in snap range to any of its connections.\n            const connections = block!.getConnections_(false);\n            for (let i = 0, connection; connection = connections[i]; i++) {\n              const neighbour =\n                  (connection)\n                      .closest(\n                          config.snapRadius, new Coordinate(blockX, blockY));\n              if (neighbour.connection) {\n                collide = true;\n                break;\n              }\n            }\n          }\n          if (collide) {\n            if (this.RTL) {\n              blockX -= config.snapRadius;\n            } else {\n              blockX += config.snapRadius;\n            }\n            blockY += config.snapRadius * 2;\n          }\n        } while (collide);\n        block!.moveTo(new Coordinate(blockX, blockY));\n      }\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled() && !block!.isShadow()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(block!));\n    }\n    block!.select();\n    return block!;\n  }\n\n  /**\n   * Paste the provided comment onto the workspace.\n   *\n   * @param xmlComment XML workspace comment element.\n   * @returns The pasted workspace comment.\n   * @suppress {checkTypes} Suppress checks while workspace comments are not\n   * bundled in.\n   */\n  private pasteWorkspaceComment_(xmlComment: Element): WorkspaceCommentSvg {\n    eventUtils.disable();\n    let comment: WorkspaceCommentSvg;\n    try {\n      comment = WorkspaceCommentSvg.fromXmlRendered(xmlComment, this);\n      // Move the duplicate to original position.\n      let commentX = parseInt(xmlComment.getAttribute('x') ?? '0');\n      let commentY = parseInt(xmlComment.getAttribute('y') ?? '0');\n      if (!isNaN(commentX) && !isNaN(commentY)) {\n        if (this.RTL) {\n          commentX = -commentX;\n        }\n        // Offset workspace comment.\n        // TODO (#1719): Properly offset comment such that it's not interfering\n        // with any blocks.\n        commentX += 50;\n        commentY += 50;\n        comment.moveBy(commentX, commentY);\n      }\n    } finally {\n      eventUtils.enable();\n    }\n    if (eventUtils.isEnabled()) {\n      WorkspaceComment.fireCreateEvent(comment);\n    }\n    comment.select();\n    return comment;\n  }\n\n  /**\n   * Refresh the toolbox unless there's a drag in progress.\n   *\n   * @internal\n   */\n  refreshToolboxSelection() {\n    const ws = this.isFlyout ? this.targetWorkspace : this;\n    if (ws && !ws.currentGesture_ && ws.toolbox_ && ws.toolbox_.getFlyout()) {\n      ws.toolbox_.refreshSelection();\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map.  Update the\n   *     flyout to show the renamed variable immediately.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  override renameVariableById(id: string, newName: string) {\n    super.renameVariableById(id, newName);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Delete a variable by the passed in ID.   Update the flyout to show\n   *     immediately that the variable is deleted.\n   *\n   * @param id ID of variable to delete.\n   */\n  override deleteVariableById(id: string) {\n    super.deleteVariableById(id);\n    this.refreshToolboxSelection();\n  }\n\n  /**\n   * Create a new variable with the given name.  Update the flyout to show the\n   *     new variable immediately.\n   *\n   * @param name The new variable's name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  override createVariable(\n      name: string, opt_type?: string|null,\n      opt_id?: string|null): VariableModel {\n    const newVar = super.createVariable(name, opt_type, opt_id);\n    this.refreshToolboxSelection();\n    return newVar;\n  }\n\n  /** Make a list of all the delete areas for this workspace. */\n  recordDragTargets() {\n    const dragTargets = this.componentManager.getComponents(\n        ComponentManager.Capability.DRAG_TARGET, true);\n\n    this.dragTargetAreas = [];\n    for (let i = 0, targetArea; targetArea = dragTargets[i]; i++) {\n      const rect = targetArea.getClientRect();\n      if (rect) {\n        this.dragTargetAreas.push({\n          component: targetArea,\n          clientRect: rect,\n        });\n      }\n    }\n  }\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  override newBlock(prototypeName: string, opt_id?: string): BlockSvg {\n    throw new Error(\n        'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n  /* eslint-enable */\n\n  /**\n   * Returns the drag target the pointer event is over.\n   *\n   * @param e Pointer move event.\n   * @returns Null if not over a drag target, or the drag target the event is\n   *     over.\n   */\n  getDragTarget(e: PointerEvent): IDragTarget|null {\n    for (let i = 0, targetArea; targetArea = this.dragTargetAreas[i]; i++) {\n      if (targetArea.clientRect.contains(e.clientX, e.clientY)) {\n        return targetArea.component;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Handle a pointerdown on SVG drawing surface.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.getGesture(e);\n    if (gesture) {\n      gesture.handleWsStart(e, this);\n    }\n  }\n\n  /**\n   * Start tracking a drag of an object on this workspace.\n   *\n   * @param e Pointer down event.\n   * @param xy Starting location of object.\n   */\n  startDrag(e: PointerEvent, xy: Coordinate) {\n    // Record the starting offset between the bubble's location and the mouse.\n    const point = browserEvents.mouseToSvg(\n        e, this.getParentSvg(), this.getInverseScreenCTM());\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    this.dragDeltaXY = Coordinate.difference(xy, point);\n  }\n\n  /**\n   * Track a drag of an object on this workspace.\n   *\n   * @param e Pointer move event.\n   * @returns New location of object.\n   */\n  moveDrag(e: PointerEvent): Coordinate {\n    const point = browserEvents.mouseToSvg(\n        e, this.getParentSvg(), this.getInverseScreenCTM());\n    // Fix scale of mouse event.\n    point.x /= this.scale;\n    point.y /= this.scale;\n    return Coordinate.sum((this.dragDeltaXY!), point);\n  }\n\n  /**\n   * Is the user currently dragging a block or scrolling the flyout/workspace?\n   *\n   * @returns True if currently dragging or scrolling.\n   */\n  isDragging(): boolean {\n    return this.currentGesture_ !== null && this.currentGesture_.isDragging();\n  }\n\n  /**\n   * Is this workspace draggable?\n   *\n   * @returns True if this workspace may be dragged.\n   */\n  isDraggable(): boolean {\n    return this.options.moveOptions && this.options.moveOptions.drag;\n  }\n\n  /**\n   * Is this workspace movable?\n   *\n   * This means the user can reposition the X Y coordinates of the workspace\n   * through input. This can be through scrollbars, scroll wheel, dragging, or\n   * through zooming with the scroll wheel or pinch (since the zoom is centered\n   * on the mouse position). This does not include zooming with the zoom\n   * controls since the X Y coordinates are decided programmatically.\n   *\n   * @returns True if the workspace is movable, false otherwise.\n   */\n  isMovable(): boolean {\n    return this.options.moveOptions && !!this.options.moveOptions.scrollbars ||\n        this.options.moveOptions && this.options.moveOptions.wheel ||\n        this.options.moveOptions && this.options.moveOptions.drag ||\n        this.options.zoomOptions && this.options.zoomOptions.wheel ||\n        this.options.zoomOptions && this.options.zoomOptions.pinch;\n  }\n\n  /**\n   * Is this workspace movable horizontally?\n   *\n   * @returns True if the workspace is movable horizontally, false otherwise.\n   */\n  isMovableHorizontally(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return this.isMovable() &&\n        (!hasScrollbars ||\n         hasScrollbars && this.scrollbar!.canScrollHorizontally());\n  }\n\n  /**\n   * Is this workspace movable vertically?\n   *\n   * @returns True if the workspace is movable vertically, false otherwise.\n   */\n  isMovableVertically(): boolean {\n    const hasScrollbars = !!this.scrollbar;\n    return this.isMovable() &&\n        (!hasScrollbars ||\n         hasScrollbars && this.scrollbar!.canScrollVertically());\n  }\n\n  /**\n   * Handle a mouse-wheel on SVG drawing surface.\n   *\n   * @param e Mouse wheel event.\n   */\n  private onMouseWheel_(e: WheelEvent) {\n    // Don't scroll or zoom anything if drag is in progress.\n    if (Gesture.inProgress()) {\n      e.preventDefault();\n      e.stopPropagation();\n      return;\n    }\n    const canWheelZoom =\n        this.options.zoomOptions && this.options.zoomOptions.wheel;\n    const canWheelMove =\n        this.options.moveOptions && this.options.moveOptions.wheel;\n    if (!canWheelZoom && !canWheelMove) {\n      return;\n    }\n\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    // Zoom should also be enabled by the command key on Mac devices,\n    // but not super on Unix.\n    let commandKey;\n    if (userAgent.MAC) {\n      commandKey = e.metaKey;\n    }\n\n    if (canWheelZoom && (e.ctrlKey || commandKey || !canWheelMove)) {\n      // Zoom.\n      // The vertical scroll distance that corresponds to a click of a zoom\n      // button.\n      const PIXELS_PER_ZOOM_STEP = 50;\n      const delta = -scrollDelta.y / PIXELS_PER_ZOOM_STEP;\n      const position = browserEvents.mouseToSvg(\n          e, this.getParentSvg(), this.getInverseScreenCTM());\n      this.zoom(position.x, position.y, delta);\n    } else {\n      // Scroll.\n      let x = this.scrollX - scrollDelta.x;\n      let y = this.scrollY - scrollDelta.y;\n\n      if (e.shiftKey && !scrollDelta.x) {\n        // Scroll horizontally (based on vertical scroll delta).\n        // This is needed as for some browser/system combinations which do not\n        // set deltaX.\n        x = this.scrollX - scrollDelta.y;\n        y = this.scrollY;  // Don't scroll vertically.\n      }\n      this.scroll(x, y);\n    }\n    e.preventDefault();\n  }\n\n  /**\n   * Calculate the bounding box for the blocks on the workspace.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Contains the position and size of the bounding box containing the\n   *     blocks on the workspace.\n   */\n  getBlocksBoundingBox(): Rect {\n    const topElements = this.getTopBoundedElements();\n    // There are no blocks, return empty rectangle.\n    if (!topElements.length) {\n      return new Rect(0, 0, 0, 0);\n    }\n\n    // Initialize boundary using the first block.\n    const boundary = topElements[0].getBoundingRectangle();\n\n    // Start at 1 since the 0th block was used for initialization.\n    for (let i = 1; i < topElements.length; i++) {\n      const topElement = topElements[i];\n      if ((topElement as any).isInsertionMarker &&\n          (topElement as any).isInsertionMarker()) {\n        continue;\n      }\n      const blockBoundary = topElement.getBoundingRectangle();\n      if (blockBoundary.top < boundary.top) {\n        boundary.top = blockBoundary.top;\n      }\n      if (blockBoundary.bottom > boundary.bottom) {\n        boundary.bottom = blockBoundary.bottom;\n      }\n      if (blockBoundary.left < boundary.left) {\n        boundary.left = blockBoundary.left;\n      }\n      if (blockBoundary.right > boundary.right) {\n        boundary.right = blockBoundary.right;\n      }\n    }\n    return boundary;\n  }\n\n  /** Clean up the workspace by ordering all the blocks in a column. */\n  cleanUp() {\n    this.setResizesEnabled(false);\n    eventUtils.setGroup(true);\n    const topBlocks = this.getTopBlocks(true);\n    let cursorY = 0;\n    for (let i = 0, block; block = topBlocks[i]; i++) {\n      if (!block.isMovable()) {\n        continue;\n      }\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(-xy.x, cursorY - xy.y);\n      block.snapToGrid();\n      cursorY = block.getRelativeToSurfaceXY().y +\n          block.getHeightWidth().height +\n          this.renderer.getConstants().MIN_BLOCK_HEIGHT;\n    }\n    eventUtils.setGroup(false);\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Show the context menu for the workspace.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: Event) {\n    if (this.options.readOnly || this.isFlyout) {\n      return;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n        ContextMenuRegistry.ScopeType.WORKSPACE, {workspace: this});\n\n    // Allow the developer to add or modify menuOptions.\n    if (this.configureContextMenu) {\n      this.configureContextMenu(menuOptions, e);\n    }\n\n    ContextMenu.show(e, menuOptions, this.RTL);\n  }\n\n  /**\n   * Modify the block tree on the existing toolbox.\n   *\n   * @param toolboxDef DOM tree of toolbox contents, string of toolbox contents,\n   *     or JSON representing toolbox definition.\n   */\n  updateToolbox(toolboxDef: toolbox.ToolboxDefinition|null) {\n    const parsedToolboxDef = toolbox.convertToolboxDefToJson(toolboxDef);\n\n    if (!parsedToolboxDef) {\n      if (this.options.languageTree) {\n        throw Error('Can\\'t nullify an existing toolbox.');\n      }\n      return;  // No change (null to null).\n    }\n    if (!this.options.languageTree) {\n      throw Error('Existing toolbox is null.  Can\\'t create new toolbox.');\n    }\n\n    if (toolbox.hasCategories(parsedToolboxDef)) {\n      if (!this.toolbox_) {\n        throw Error('Existing toolbox has no categories.  Can\\'t change mode.');\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.toolbox_.render(parsedToolboxDef);\n    } else {\n      if (!this.flyout) {\n        throw Error('Existing toolbox has categories.  Can\\'t change mode.');\n      }\n      this.options.languageTree = parsedToolboxDef;\n      this.flyout.show(parsedToolboxDef);\n    }\n  }\n\n  /** Mark this workspace as the currently focused main workspace. */\n  markFocused() {\n    if (this.options.parentWorkspace) {\n      this.options.parentWorkspace.markFocused();\n    } else {\n      common.setMainWorkspace(this);\n      // We call e.preventDefault in many event handlers which means we\n      // need to explicitly grab focus (e.g from a textarea) because\n      // the browser will not do it for us.\n      this.getParentSvg().focus({preventScroll: true});\n    }\n  }\n\n  /**\n   * Zooms the workspace in or out relative to/centered on the given (x, y)\n   * coordinate.\n   *\n   * @param x X coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param y Y coordinate of center, in pixel units relative to the top-left\n   *     corner of the parentSVG.\n   * @param amount Amount of zooming. The formula for the new scale is newScale\n   *     = currentScale * (scaleSpeed^amount). scaleSpeed is set in the\n   *     workspace options. Negative amount values zoom out, and positive amount\n   *     values zoom in.\n   */\n  zoom(x: number, y: number, amount: number) {\n    // Scale factor.\n    const speed = this.options.zoomOptions.scaleSpeed;\n    let scaleChange = Math.pow(speed, amount);\n    const newScale = this.scale * scaleChange;\n    if (this.scale === newScale) {\n      return;  // No change in zoom.\n    }\n\n    // Clamp scale within valid range.\n    if (newScale > this.options.zoomOptions.maxScale) {\n      scaleChange = this.options.zoomOptions.maxScale / this.scale;\n    } else if (newScale < this.options.zoomOptions.minScale) {\n      scaleChange = this.options.zoomOptions.minScale / this.scale;\n    }\n\n    // Transform the x/y coordinates from the parentSVG's space into the\n    // canvas' space, so that they are in workspace units relative to the top\n    // left of the visible portion of the workspace.\n    let matrix = this.getCanvas().getCTM();\n    let center = (this.getParentSvg()).createSVGPoint();\n    center.x = x;\n    center.y = y;\n    center = center.matrixTransform(matrix!.inverse());\n    x = center.x;\n    y = center.y;\n\n    // Find the new scrollX/scrollY so that the center remains in the same\n    // position (relative to the center) after we zoom.\n    // newScale and matrix.a should be identical (within a rounding error).\n    matrix = matrix!.translate(x * (1 - scaleChange), y * (1 - scaleChange))\n                 .scale(scaleChange);\n    // scrollX and scrollY are in pixels.\n    // The scrollX and scrollY still need to have absoluteLeft and absoluteTop\n    // subtracted from them, but we'll leave that for setScale so that they're\n    // correctly updated for the new flyout size if we have a simple toolbox.\n    this.scrollX = matrix.e;\n    this.scrollY = matrix.f;\n    this.setScale(newScale);\n  }\n\n  /**\n   * Zooming the blocks centered in the center of view with zooming in or out.\n   *\n   * @param type Type of zooming (-1 zooming out and 1 zooming in).\n   */\n  zoomCenter(type: number) {\n    const metrics = this.getMetrics();\n    let x;\n    let y;\n    if (this.flyout) {\n      // If you want blocks in the center of the view (visible portion of the\n      // workspace) to stay centered when the size of the view decreases (i.e.\n      // when the size of the flyout increases) you need the center of the\n      // *blockly div* to stay in the same pixel-position.\n      // Note: This only works because of how scrollCenter positions blocks.\n      x = metrics.svgWidth ? metrics.svgWidth / 2 : 0;\n      y = metrics.svgHeight ? metrics.svgHeight / 2 : 0;\n    } else {\n      x = metrics.viewWidth / 2 + metrics.absoluteLeft;\n      y = metrics.viewHeight / 2 + metrics.absoluteTop;\n    }\n    this.zoom(x, y, type);\n  }\n\n  /** Zoom the blocks to fit in the workspace if possible. */\n  zoomToFit() {\n    if (!this.isMovable()) {\n      console.warn(\n          'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.');\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let workspaceWidth = metrics.viewWidth;\n    let workspaceHeight = metrics.viewHeight;\n    const blocksBox = this.getBlocksBoundingBox();\n    const doubleMargin = ZOOM_TO_FIT_MARGIN * 2;\n    let blocksWidth = blocksBox.right - blocksBox.left + doubleMargin;\n    let blocksHeight = blocksBox.bottom - blocksBox.top + doubleMargin;\n    if (!blocksWidth) {\n      return;  // Prevents zooming to infinity.\n    }\n    if (this.flyout) {\n      // We have to add the flyout size to both the workspace size and the\n      // block size because the blocks we want to resize include the blocks in\n      // the flyout, and the area we want to fit them includes the portion of\n      // the workspace that is behind the flyout.\n      if (this.horizontalLayout) {\n        workspaceHeight += this.flyout.getHeight();\n        // Convert from pixels to workspace coordinates.\n        blocksHeight += this.flyout.getHeight() / this.scale;\n      } else {\n        workspaceWidth += this.flyout.getWidth();\n        // Convert from pixels to workspace coordinates.\n        blocksWidth += this.flyout.getWidth() / this.scale;\n      }\n    }\n\n    // Scale Units: (pixels / workspaceUnit)\n    const ratioX = workspaceWidth / blocksWidth;\n    const ratioY = workspaceHeight / blocksHeight;\n    eventUtils.disable();\n    try {\n      this.setScale(Math.min(ratioX, ratioY));\n      this.scrollCenter();\n    } finally {\n      eventUtils.enable();\n    }\n    this.maybeFireViewportChangeEvent();\n  }\n\n  /**\n   * Add a transition class to the block and bubble canvas, to animate any\n   * transform changes.\n   *\n   * @internal\n   */\n  beginCanvasTransition() {\n    dom.addClass(this.svgBlockCanvas_, 'blocklyCanvasTransitioning');\n    dom.addClass(this.svgBubbleCanvas_, 'blocklyCanvasTransitioning');\n  }\n\n  /**\n   * Remove transition class from the block and bubble canvas.\n   *\n   * @internal\n   */\n  endCanvasTransition() {\n    dom.removeClass(this.svgBlockCanvas_, 'blocklyCanvasTransitioning');\n    dom.removeClass(this.svgBubbleCanvas_, 'blocklyCanvasTransitioning');\n  }\n\n  /** Center the workspace. */\n  scrollCenter() {\n    if (!this.isMovable()) {\n      console.warn(\n          'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.');\n      return;\n    }\n\n    const metrics = this.getMetrics();\n    let x = (metrics.scrollWidth - metrics.viewWidth) / 2;\n    let y = (metrics.scrollHeight - metrics.viewHeight) / 2;\n\n    // Convert from workspace directions to canvas directions.\n    x = -x - metrics.scrollLeft;\n    y = -y - metrics.scrollTop;\n    this.scroll(x, y);\n  }\n\n  /**\n   * Scroll the workspace to center on the given block. If the block has other\n   * blocks stacked below it, the workspace will be centered on the stack,\n   * unless blockOnly is true.\n   *\n   * @param id ID of block center on.\n   * @param blockOnly True to center only on the block itself, not its stack.\n   */\n  centerOnBlock(id: string|null, blockOnly?: boolean) {\n    if (!this.isMovable()) {\n      console.warn(\n          'Tried to move a non-movable workspace. This could result' +\n          ' in blocks becoming inaccessible.');\n      return;\n    }\n\n    const block = id ? this.getBlockById(id) : null;\n    if (!block) {\n      return;\n    }\n\n    // XY is in workspace coordinates.\n    const xy = block.getRelativeToSurfaceXY();\n    // Height/width is in workspace units.\n    const heightWidth = blockOnly ? {height: block.height, width: block.width} :\n                                    block.getHeightWidth();\n\n    // Find the enter of the block in workspace units.\n    const blockCenterY = xy.y + heightWidth.height / 2;\n\n    // In RTL the block's position is the top right of the block, not top left.\n    const multiplier = this.RTL ? -1 : 1;\n    const blockCenterX = xy.x + multiplier * heightWidth.width / 2;\n\n    // Workspace scale, used to convert from workspace coordinates to pixels.\n    const scale = this.scale;\n\n    // Center of block in pixels, relative to workspace origin (center 0,0).\n    // Scrolling to here would put the block in the top-left corner of the\n    // visible workspace.\n    const pixelX = blockCenterX * scale;\n    const pixelY = blockCenterY * scale;\n\n    const metrics = this.getMetrics();\n\n    // viewHeight and viewWidth are in pixels.\n    const halfViewWidth = metrics.viewWidth / 2;\n    const halfViewHeight = metrics.viewHeight / 2;\n\n    // Put the block in the center of the visible workspace instead.\n    const scrollToCenterX = pixelX - halfViewWidth;\n    const scrollToCenterY = pixelY - halfViewHeight;\n\n    // Convert from workspace directions to canvas directions.\n    const x = -scrollToCenterX;\n    const y = -scrollToCenterY;\n\n    this.scroll(x, y);\n  }\n\n  /**\n   * Set the workspace's zoom factor.\n   *\n   * @param newScale Zoom factor. Units: (pixels / workspaceUnit).\n   */\n  setScale(newScale: number) {\n    if (this.options.zoomOptions.maxScale &&\n        newScale > this.options.zoomOptions.maxScale) {\n      newScale = this.options.zoomOptions.maxScale;\n    } else if (\n        this.options.zoomOptions.minScale &&\n        newScale < this.options.zoomOptions.minScale) {\n      newScale = this.options.zoomOptions.minScale;\n    }\n    this.scale = newScale;\n\n    this.hideChaff(false);\n    // Get the flyout, if any, whether our own or owned by the toolbox.\n    const flyout = this.getFlyout(false);\n    if (flyout && flyout.isVisible()) {\n      flyout.reflow();\n      this.recordDragTargets();\n    }\n    if (this.grid) {\n      this.grid.update(this.scale);\n    }\n\n    // We call scroll instead of scrollbar.resize() so that we can center the\n    // zoom correctly without scrollbars, but scroll does not resize the\n    // scrollbars so we have to call resizeView/resizeContent as well.\n    const metrics = this.getMetrics();\n\n    this.scrollX -= metrics.absoluteLeft;\n    this.scrollY -= metrics.absoluteTop;\n    // The scroll values and the view values are additive inverses of\n    // each other, so when we subtract from one we have to add to the other.\n    metrics.viewLeft += metrics.absoluteLeft;\n    metrics.viewTop += metrics.absoluteTop;\n\n    this.scroll(this.scrollX, this.scrollY);\n    if (this.scrollbar) {\n      if (this.flyout) {\n        this.scrollbar.resizeView(metrics);\n      } else {\n        this.scrollbar.resizeContent(metrics);\n      }\n    }\n  }\n\n  /**\n   * Get the workspace's zoom factor.  If the workspace has a parent, we call\n   * into the parent to get the workspace scale.\n   *\n   * @returns The workspace zoom factor. Units: (pixels / workspaceUnit).\n   */\n  getScale(): number {\n    if (this.options.parentWorkspace) {\n      return this.options.parentWorkspace.getScale();\n    }\n    return this.scale;\n  }\n\n  /**\n   * Scroll the workspace to a specified offset (in pixels), keeping in the\n   * workspace bounds. See comment on workspaceSvg.scrollX for more detail on\n   * the meaning of these values.\n   *\n   * @param x Target X to scroll to.\n   * @param y Target Y to scroll to.\n   * @internal\n   */\n  scroll(x: number, y: number) {\n    this.hideChaff(/* opt_onlyClosePopups= */\n                   true);\n\n    // Keep scrolling within the bounds of the content.\n    const metrics = this.getMetrics();\n    // Canvas coordinates (aka scroll coordinates) have inverse directionality\n    // to workspace coordinates so we have to inverse them.\n    x = Math.min(x, -metrics.scrollLeft);\n    y = Math.min(y, -metrics.scrollTop);\n    const maxXDisplacement =\n        Math.max(0, metrics.scrollWidth - metrics.viewWidth);\n    const maxXScroll = metrics.scrollLeft + maxXDisplacement;\n    const maxYDisplacement =\n        Math.max(0, metrics.scrollHeight - metrics.viewHeight);\n    const maxYScroll = metrics.scrollTop + maxYDisplacement;\n    x = Math.max(x, -maxXScroll);\n    y = Math.max(y, -maxYScroll);\n    this.scrollX = x;\n    this.scrollY = y;\n\n    if (this.scrollbar) {\n      // The content position (displacement from the content's top-left to the\n      // origin) plus the scroll position (displacement from the view's top-left\n      // to the origin) gives us the distance from the view's top-left to the\n      // content's top-left. Then we negate this so we get the displacement from\n      // the content's top-left to the view's top-left, matching the\n      // directionality of the scrollbars.\n      this.scrollbar.set(\n          -(x + metrics.scrollLeft), -(y + metrics.scrollTop), false);\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    x += metrics.absoluteLeft;\n    y += metrics.absoluteTop;\n    this.translate(x, y);\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  override getBlockById(id: string): BlockSvg|null {\n    return super.getBlockById(id) as BlockSvg;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getAllBlocks(ordered: boolean): BlockSvg[] {\n    return super.getAllBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  override getTopBlocks(ordered: boolean): BlockSvg[] {\n    return super.getTopBlocks(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  override addTopBlock(block: Block) {\n    this.addTopBoundedElement(block as BlockSvg);\n    super.addTopBlock(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  override removeTopBlock(block: Block) {\n    this.removeTopBoundedElement(block as BlockSvg);\n    super.removeTopBlock(block);\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   */\n  override addTopComment(comment: WorkspaceComment) {\n    this.addTopBoundedElement(comment as WorkspaceCommentSvg);\n    super.addTopComment(comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   */\n  override removeTopComment(comment: WorkspaceComment) {\n    this.removeTopBoundedElement(comment as WorkspaceCommentSvg);\n    super.removeTopComment(comment);\n  }\n\n  /**\n   * Adds a bounded element to the list of top bounded elements.\n   *\n   * @param element Bounded element to add.\n   */\n  addTopBoundedElement(element: IBoundedElement) {\n    this.topBoundedElements.push(element);\n  }\n\n  /**\n   * Removes a bounded element from the list of top bounded elements.\n   *\n   * @param element Bounded element to remove.\n   */\n  removeTopBoundedElement(element: IBoundedElement) {\n    arrayUtils.removeElem(this.topBoundedElements, element);\n  }\n\n  /**\n   * Finds the top-level bounded elements and returns them.\n   *\n   * @returns The top-level bounded elements.\n   */\n  getTopBoundedElements(): IBoundedElement[] {\n    return (new Array<IBoundedElement>()).concat(this.topBoundedElements);\n  }\n\n  /**\n   * Update whether this workspace has resizes enabled.\n   * If enabled, workspace will resize when appropriate.\n   * If disabled, workspace will not resize until re-enabled.\n   * Use to avoid resizing during a batch operation, for performance.\n   *\n   * @param enabled Whether resizes should be enabled.\n   */\n  setResizesEnabled(enabled: boolean) {\n    const reenabled = !this.resizesEnabled && enabled;\n    this.resizesEnabled = enabled;\n    if (reenabled) {\n      // Newly enabled.  Trigger a resize.\n      this.resizeContents();\n    }\n  }\n\n  /**\n   * Dispose of all blocks in workspace, with an optimization to prevent\n   * resizes.\n   */\n  override clear() {\n    this.setResizesEnabled(false);\n    super.clear();\n    this.topBoundedElements = [];\n    this.setResizesEnabled(true);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   * For instance, a button specified by the XML\n   * <button text=\"create variable\" callbackKey=\"CREATE_VARIABLE\"></button>\n   * should be matched by a call to\n   * registerButtonCallback(\"CREATE_VARIABLE\", yourCallbackFunction).\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given button is clicked.\n   */\n  registerButtonCallback(key: string, func: (p1: FlyoutButton) => void) {\n    if (typeof func !== 'function') {\n      throw TypeError('Button callbacks must be functions.');\n    }\n    this.flyoutButtonCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for clicks on\n   * buttons and labels in the flyout.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace;\n   *     null if no callback is registered.\n   */\n  getButtonCallback(key: string): ((p1: FlyoutButton) => void)|null {\n    return this.flyoutButtonCallbacks.get(key) ?? null;\n  }\n\n  /**\n   * Remove a callback for a click on a button in the flyout.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeButtonCallback(key: string) {\n    this.flyoutButtonCallbacks.delete(key);\n  }\n\n  /**\n   * Register a callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.  See the variable and\n   * procedure categories as an example.\n   *\n   * @param key The name to use to look up this function.\n   * @param func The function to call when the given toolbox category is opened.\n   */\n  registerToolboxCategoryCallback(\n      key: string, func: (p1: WorkspaceSvg) => toolbox.FlyoutDefinition) {\n    if (typeof func !== 'function') {\n      throw TypeError('Toolbox category callbacks must be functions.');\n    }\n    this.toolboxCategoryCallbacks.set(key, func);\n  }\n\n  /**\n   * Get the callback function associated with a given key, for populating\n   * custom toolbox categories in this workspace.\n   *\n   * @param key The name to use to look up the function.\n   * @returns The function corresponding to the given key for this workspace, or\n   *     null if no function is registered.\n   */\n  getToolboxCategoryCallback(key: string):\n      ((p1: WorkspaceSvg) => toolbox.FlyoutDefinition)|null {\n    return this.toolboxCategoryCallbacks.get(key) || null;\n  }\n\n  /**\n   * Remove a callback for a click on a custom category's name in the toolbox.\n   *\n   * @param key The name associated with the callback function.\n   */\n  removeToolboxCategoryCallback(key: string) {\n    this.toolboxCategoryCallbacks.delete(key);\n  }\n\n  /**\n   * Look up the gesture that is tracking this touch stream on this workspace.\n   * May create a new gesture.\n   *\n   * @param e Pointer event.\n   * @returns The gesture that is tracking this touch stream, or null if no\n   *     valid gesture exists.\n   * @internal\n   */\n  getGesture(e: PointerEvent): Gesture|null {\n    const isStart = e.type === 'pointerdown';\n\n    const gesture = this.currentGesture_;\n    if (gesture) {\n      if (isStart && gesture.hasStarted()) {\n        console.warn('Tried to start the same gesture twice.');\n        // That's funny.  We must have missed a mouse up.\n        // Cancel it, rather than try to retrieve all of the state we need.\n        gesture.cancel();\n        return null;\n      }\n      return gesture;\n    }\n\n    // No gesture existed on this workspace, but this looks like the start of a\n    // new gesture.\n    if (isStart) {\n      this.currentGesture_ = new Gesture(e, this);\n      return this.currentGesture_;\n    }\n    // No gesture existed and this event couldn't be the start of a new gesture.\n    return null;\n  }\n\n  /**\n   * Clear the reference to the current gesture.\n   *\n   * @internal\n   */\n  clearGesture() {\n    this.currentGesture_ = null;\n  }\n\n  /**\n   * Cancel the current gesture, if one exists.\n   *\n   * @internal\n   */\n  cancelCurrentGesture() {\n    if (this.currentGesture_) {\n      this.currentGesture_.cancel();\n    }\n  }\n\n  /**\n   * Get the audio manager for this workspace.\n   *\n   * @returns The audio manager for this workspace.\n   */\n  getAudioManager(): WorkspaceAudio {\n    return this.audioManager;\n  }\n\n  /**\n   * Get the grid object for this workspace, or null if there is none.\n   *\n   * @returns The grid object for this workspace.\n   * @internal\n   */\n  getGrid(): Grid|null {\n    return this.grid;\n  }\n\n  /**\n   * Close tooltips, context menus, dropdown selections, etc.\n   *\n   * @param opt_onlyClosePopups Whether only popups should be closed.\n   */\n  hideChaff(opt_onlyClosePopups?: boolean) {\n    Tooltip.hide();\n    WidgetDiv.hide();\n    dropDownDiv.hideWithoutAnimation();\n\n    const onlyClosePopups = !!opt_onlyClosePopups;\n    const autoHideables = this.getComponentManager().getComponents(\n        ComponentManager.Capability.AUTOHIDEABLE, true);\n    autoHideables.forEach(\n        (autoHideable) => autoHideable.autoHide(onlyClosePopups));\n  }\n\n  /**\n   * Sets the X/Y translations of a top level workspace.\n   *\n   * @param xyRatio Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  private static setTopLevelWorkspaceMetrics_(\n      this: WorkspaceSvg, xyRatio: {x?: number, y?: number}) {\n    const metrics = this.getMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.scrollX =\n          -(metrics.scrollLeft +\n            (metrics.scrollWidth - metrics.viewWidth) * xyRatio.x);\n    }\n    if (typeof xyRatio.y === 'number') {\n      this.scrollY =\n          -(metrics.scrollTop +\n            (metrics.scrollHeight - metrics.viewHeight) * xyRatio.y);\n    }\n    // We have to shift the translation so that when the canvas is at 0, 0 the\n    // workspace origin is not underneath the toolbox.\n    const x = this.scrollX + metrics.absoluteLeft;\n    const y = this.scrollY + metrics.absoluteTop;\n    // We could call scroll here, but that has extra checks we don't need to do.\n    this.translate(x, y);\n  }\n}\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @internal\n */\nexport function resizeSvgContents(workspace: WorkspaceSvg) {\n  workspace.resizeContents();\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.inject');\n\nimport {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as common from './common.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Grid} from './grid.js';\nimport {Msg} from './msg.js';\nimport {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {WorkspaceDragSurfaceSvg} from './workspace_drag_surface_svg.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Inject a Blockly editor into the specified container element (usually a div).\n *\n * @param container Containing element, or its ID, or a CSS selector.\n * @param opt_options Optional dictionary of options.\n * @returns Newly created main workspace.\n */\nexport function inject(\n    container: Element|string, opt_options?: BlocklyOptions): WorkspaceSvg {\n  if (typeof container === 'string') {\n    // AnyDuringMigration because:  Type 'Element | null' is not assignable to\n    // type 'string | Element'.\n    container = (document.getElementById(container) ||\n                 document.querySelector(container)) as AnyDuringMigration;\n  }\n  // Verify that the container is in document.\n  // AnyDuringMigration because:  Argument of type 'string | Element' is not\n  // assignable to parameter of type 'Node'.\n  if (!container ||\n      !dom.containsNode(document, container as AnyDuringMigration)) {\n    throw Error('Error: container is not in current document.');\n  }\n  const options = new Options(opt_options || {} as BlocklyOptions);\n  const subContainer = (document.createElement('div'));\n  subContainer.className = 'injectionDiv';\n  subContainer.tabIndex = 0;\n  aria.setState(subContainer, aria.State.LABEL, Msg['WORKSPACE_ARIA_LABEL']);\n\n  // AnyDuringMigration because:  Property 'appendChild' does not exist on type\n  // 'string | Element'.\n  (container as AnyDuringMigration).appendChild(subContainer);\n  const svg = createDom(subContainer, options);\n\n  // Create surfaces for dragging things. These are optimizations\n  // so that the browser does not repaint during the drag.\n  const blockDragSurface = new BlockDragSurfaceSvg(subContainer);\n\n  const workspaceDragSurface = new WorkspaceDragSurfaceSvg(subContainer);\n\n  const workspace =\n      createMainWorkspace(svg, options, blockDragSurface, workspaceDragSurface);\n\n  init(workspace);\n\n  // Keep focus on the first workspace so entering keyboard navigation looks\n  // correct.\n  // AnyDuringMigration because:  Argument of type 'WorkspaceSvg' is not\n  // assignable to parameter of type 'Workspace'.\n  common.setMainWorkspace(workspace as AnyDuringMigration);\n\n  common.svgResize(workspace);\n\n  subContainer.addEventListener('focusin', function() {\n    // AnyDuringMigration because:  Argument of type 'WorkspaceSvg' is not\n    // assignable to parameter of type 'Workspace'.\n    common.setMainWorkspace(workspace as AnyDuringMigration);\n  });\n\n  return workspace;\n}\n\n/**\n * Create the SVG image.\n *\n * @param container Containing element.\n * @param options Dictionary of options.\n * @returns Newly created SVG image.\n */\nfunction createDom(container: Element, options: Options): SVGElement {\n  // Sadly browsers (Chrome vs Firefox) are currently inconsistent in laying\n  // out content in RTL mode.  Therefore Blockly forces the use of LTR,\n  // then manually positions content in RTL as needed.\n  container.setAttribute('dir', 'LTR');\n\n  // Load CSS.\n  Css.inject(options.hasCss, options.pathToMedia);\n\n  // Build the SVG DOM.\n  /*\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      xmlns:html=\"http://www.w3.org/1999/xhtml\"\n      xmlns:xlink=\"http://www.w3.org/1999/xlink\"\n      version=\"1.1\"\n      class=\"blocklySvg\">\n      ...\n    </svg>\n    */\n  const svg = dom.createSvgElement(\n      Svg.SVG, {\n        'xmlns': dom.SVG_NS,\n        'xmlns:html': dom.HTML_NS,\n        'xmlns:xlink': dom.XLINK_NS,\n        'version': '1.1',\n        'class': 'blocklySvg',\n        'tabindex': '0',\n      },\n      container);\n  /*\n    <defs>\n      ... filters go here ...\n    </defs>\n    */\n  const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n  // Each filter/pattern needs a unique ID for the case of multiple Blockly\n  // instances on a page.  Browser behaviour becomes undefined otherwise.\n  // https://neil.fraser.name/news/2015/11/01/\n  const rnd = String(Math.random()).substring(2);\n\n  options.gridPattern = Grid.createDom(rnd, options.gridOptions, defs);\n  return svg;\n}\n\n/**\n * Create a main workspace and add it to the SVG.\n *\n * @param svg SVG element with pattern defined.\n * @param options Dictionary of options.\n * @param blockDragSurface Drag surface SVG for the blocks.\n * @param workspaceDragSurface Drag surface SVG for the workspace.\n * @returns Newly created main workspace.\n */\nfunction createMainWorkspace(\n    svg: SVGElement, options: Options, blockDragSurface: BlockDragSurfaceSvg,\n    workspaceDragSurface: WorkspaceDragSurfaceSvg): WorkspaceSvg {\n  options.parentWorkspace = null;\n  const mainWorkspace =\n      new WorkspaceSvg(options, blockDragSurface, workspaceDragSurface);\n  const wsOptions = mainWorkspace.options;\n  mainWorkspace.scale = wsOptions.zoomOptions.startScale;\n  svg.appendChild(mainWorkspace.createDom('blocklyMainBackground'));\n\n  // Set the theme name and renderer name onto the injection div.\n  const injectionDiv = mainWorkspace.getInjectionDiv();\n  const rendererClassName = mainWorkspace.getRenderer().getClassName();\n  if (rendererClassName) {\n    dom.addClass(injectionDiv, rendererClassName);\n  }\n  const themeClassName = mainWorkspace.getTheme().getClassName();\n  if (themeClassName) {\n    dom.addClass(injectionDiv, themeClassName);\n  }\n\n  if (!wsOptions.hasCategories && wsOptions.languageTree) {\n    // Add flyout as an <svg> that is a sibling of the workspace SVG.\n    const flyout = mainWorkspace.addFlyout(Svg.SVG);\n    dom.insertAfter(flyout, svg);\n  }\n  if (wsOptions.hasTrashcan) {\n    mainWorkspace.addTrashcan();\n  }\n  if (wsOptions.zoomOptions && wsOptions.zoomOptions.controls) {\n    mainWorkspace.addZoomControls();\n  }\n  // Register the workspace svg as a UI component.\n  mainWorkspace.getThemeManager().subscribe(\n      svg, 'workspaceBackgroundColour', 'background-color');\n\n  // A null translation will also apply the correct initial scale.\n  mainWorkspace.translate(0, 0);\n\n  mainWorkspace.addChangeListener(\n      bumpObjects.bumpIntoBoundsHandler(mainWorkspace));\n\n  // The SVG is now fully assembled.\n  common.svgResize(mainWorkspace);\n  WidgetDiv.createDom();\n  dropDownDiv.createDom();\n  Tooltip.createDom();\n  return mainWorkspace;\n}\n\n/**\n * Initialize Blockly with various handlers.\n *\n * @param mainWorkspace Newly created main workspace.\n */\nfunction init(mainWorkspace: WorkspaceSvg) {\n  const options = mainWorkspace.options;\n  const svg = mainWorkspace.getParentSvg();\n\n  // Suppress the browser's context menu.\n  browserEvents.conditionalBind(\n      svg.parentNode as Element, 'contextmenu', null,\n      function(e: AnyDuringMigration) {\n        if (!browserEvents.isTargetInput(e)) {\n          e.preventDefault();\n        }\n      });\n\n  const workspaceResizeHandler =\n      browserEvents.conditionalBind(window, 'resize', null, function() {\n        mainWorkspace.hideChaff(true);\n        common.svgResize(mainWorkspace);\n        bumpObjects.bumpTopObjectsIntoBounds(mainWorkspace);\n      });\n  mainWorkspace.setResizeHandlerWrapper(workspaceResizeHandler);\n\n  bindDocumentEvents();\n\n  if (options.languageTree) {\n    const toolbox = mainWorkspace.getToolbox();\n    const flyout = mainWorkspace.getFlyout(true);\n    if (toolbox) {\n      toolbox.init();\n    } else if (flyout) {\n      // Build a fixed flyout with the root blocks.\n      flyout.init(mainWorkspace);\n      flyout.show(options.languageTree);\n      if (typeof flyout.scrollToStart === 'function') {\n        flyout.scrollToStart();\n      }\n    }\n  }\n\n  if (options.hasTrashcan) {\n    mainWorkspace.trashcan!.init();\n  }\n  if (options.zoomOptions && options.zoomOptions.controls) {\n    mainWorkspace.zoomControls_!.init();\n  }\n\n  if (options.moveOptions && options.moveOptions.scrollbars) {\n    const horizontalScroll = options.moveOptions.scrollbars === true ||\n        !!options.moveOptions.scrollbars.horizontal;\n    const verticalScroll = options.moveOptions.scrollbars === true ||\n        !!options.moveOptions.scrollbars.vertical;\n    mainWorkspace.scrollbar = new ScrollbarPair(\n        mainWorkspace, horizontalScroll, verticalScroll,\n        'blocklyMainWorkspaceScrollbar');\n    mainWorkspace.scrollbar.resize();\n  } else {\n    mainWorkspace.setMetrics({x: 0.5, y: 0.5});\n  }\n\n  // Load the sounds.\n  if (options.hasSounds) {\n    loadSounds(options.pathToMedia, mainWorkspace);\n  }\n}\n\n/**\n * Handle a key-down on SVG drawing surface. Does nothing if the main workspace\n * is not visible.\n *\n * @param e Key down event.\n */\n// TODO (https://github.com/google/blockly/issues/1998) handle cases where there\n// are multiple workspaces and non-main workspaces are able to accept input.\nfunction onKeyDown(e: KeyboardEvent) {\n  const mainWorkspace = common.getMainWorkspace() as WorkspaceSvg;\n  if (!mainWorkspace) {\n    return;\n  }\n\n  if (browserEvents.isTargetInput(e) ||\n      mainWorkspace.rendered && !mainWorkspace.isVisible()) {\n    // When focused on an HTML text input widget, don't trap any keys.\n    // Ignore keypresses on rendered workspaces that have been explicitly\n    // hidden.\n    return;\n  }\n  ShortcutRegistry.registry.onKeyDown(mainWorkspace, e);\n}\n\n/**\n * Whether event handlers have been bound. Document event handlers will only\n * be bound once, even if Blockly is destroyed and reinjected.\n */\nlet documentEventsBound = false;\n\n/**\n * Bind document events, but only once.  Destroying and reinjecting Blockly\n * should not bind again.\n * Bind events for scrolling the workspace.\n * Most of these events should be bound to the SVG's surface.\n * However, 'mouseup' has to be on the whole document so that a block dragged\n * out of bounds and released will know that it has been released.\n * Also, 'keydown' has to be on the whole document since the browser doesn't\n * understand a concept of focus on the SVG image.\n */\nfunction bindDocumentEvents() {\n  if (!documentEventsBound) {\n    browserEvents.conditionalBind(document, 'scroll', null, function() {\n      const workspaces = common.getAllWorkspaces();\n      for (let i = 0, workspace; workspace = workspaces[i]; i++) {\n        if (workspace instanceof WorkspaceSvg) {\n          workspace.updateInverseScreenCTM();\n        }\n      }\n    });\n    browserEvents.conditionalBind(document, 'keydown', null, onKeyDown);\n    // longStop needs to run to stop the context menu from showing up.  It\n    // should run regardless of what other touch event handlers have run.\n    browserEvents.bind(document, 'touchend', null, Touch.longStop);\n    browserEvents.bind(document, 'touchcancel', null, Touch.longStop);\n    // Some iPad versions don't fire resize after portrait to landscape change.\n    if (userAgent.IPAD) {\n      browserEvents.conditionalBind(\n          window, 'orientationchange', document, function() {\n            // TODO (#397): Fix for multiple Blockly workspaces.\n            common.svgResize(common.getMainWorkspace() as WorkspaceSvg);\n          });\n    }\n  }\n  documentEventsBound = true;\n}\n\n/**\n * Load sounds for the given workspace.\n *\n * @param pathToMedia The path to the media directory.\n * @param workspace The workspace to load sounds for.\n */\nfunction loadSounds(pathToMedia: string, workspace: WorkspaceSvg) {\n  const audioMgr = workspace.getAudioManager();\n  audioMgr.load(\n      [\n        pathToMedia + 'click.mp3',\n        pathToMedia + 'click.wav',\n        pathToMedia + 'click.ogg',\n      ],\n      'click');\n  audioMgr.load(\n      [\n        pathToMedia + 'disconnect.wav',\n        pathToMedia + 'disconnect.mp3',\n        pathToMedia + 'disconnect.ogg',\n      ],\n      'disconnect');\n  audioMgr.load(\n      [\n        pathToMedia + 'delete.mp3',\n        pathToMedia + 'delete.ogg',\n        pathToMedia + 'delete.wav',\n      ],\n      'delete');\n\n  // Bind temporary hooks that preload the sounds.\n  const soundBinds: AnyDuringMigration[] = [];\n  /**\n   *\n   */\n  function unbindSounds() {\n    while (soundBinds.length) {\n      browserEvents.unbind(soundBinds.pop());\n    }\n    audioMgr.preload();\n  }\n\n  // These are bound on mouse/touch events with\n  // Blockly.browserEvents.conditionalBind, so they restrict the touch\n  // identifier that will be recognized.  But this is really something that\n  // happens on a click, not a drag, so that's not necessary.\n\n  // Android ignores any sound not loaded as a result of a user action.\n  soundBinds.push(browserEvents.conditionalBind(\n      document, 'pointermove', null, unbindSounds, true));\n  soundBinds.push(browserEvents.conditionalBind(\n      document, 'touchstart', null, unbindSounds, true));\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IParameterModel} from '../interfaces/i_parameter_model.js';\nimport {IProcedureModel} from '../interfaces/i_procedure_model.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as priorities from './priorities.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Representation of a procedure data model.\n */\nexport interface State {\n  // TODO: This should also handle enabled.\n  id: string, name: string, returnTypes: string[]|null,\n      parameters?: ParameterState[],\n}\n\n/**\n * Representation of a parameter data model.\n */\nexport interface ParameterState {\n  id: string, name: string, types?: string[],\n}\n\n/**\n * A newable signature for an IProcedureModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\n * for what is going on with this.\n */\ntype ProcedureModelConstructor<ProcedureModel extends IProcedureModel> =\n    new (workspace: Workspace, name: string, id: string) => ProcedureModel;\n\n/**\n * A newable signature for an IParameterModel.\n *\n * Refer to\n * https://www.typescriptlang.org/docs/handbook/2/generics.html#using-class-types-in-generics\n * for what is going on with this.\n */\ntype ParameterModelConstructor<ParameterModel extends IParameterModel> =\n    new (workspace: Workspace, name: string, id: string) => ParameterModel;\n\n\n/**\n * Serializes the given IProcedureModel to JSON.\n *\n * @internal\n */\nexport function saveProcedure(proc: IProcedureModel): State {\n  const state: State = {\n    id: proc.getId(),\n    name: proc.getName(),\n    returnTypes: proc.getReturnTypes(),\n  };\n  if (!proc.getParameters().length) return state;\n  state.parameters = proc.getParameters().map((param) => saveParameter(param));\n  return state;\n}\n\n/**\n * Serializes the given IParameterModel to JSON.\n *\n * @internal\n */\nexport function saveParameter(param: IParameterModel): ParameterState {\n  const state: ParameterState = {\n    id: param.getId(),\n    name: param.getName(),\n  };\n  if (!param.getTypes().length) return state;\n  state.types = param.getTypes();\n  return state;\n}\n\n/**\n * Deserializes the given procedure model State from JSON.\n *\n * @internal\n */\nexport function\nloadProcedure<ProcedureModel extends IProcedureModel,\n                                     ParameterModel extends IParameterModel>(\n    procedureModelClass: ProcedureModelConstructor<ProcedureModel>,\n    parameterModelClass: ParameterModelConstructor<ParameterModel>,\n    state: State, workspace: Workspace): ProcedureModel {\n  const proc = new procedureModelClass(workspace, state.name, state.id)\n                   .setReturnTypes(state.returnTypes);\n  if (!state.parameters) return proc;\n  for (const [index, param] of state.parameters.entries()) {\n    proc.insertParameter(\n        loadParameter(parameterModelClass, param, workspace), index);\n  }\n  return proc;\n}\n\n/**\n * Deserializes the given ParameterState from JSON.\n *\n * @internal\n */\nexport function loadParameter<ParameterModel extends IParameterModel>(\n    parameterModelClass: ParameterModelConstructor<ParameterModel>,\n    state: ParameterState, workspace: Workspace): ParameterModel {\n  const model = new parameterModelClass(workspace, state.name, state.id);\n  if (state.types) model.setTypes(state.types);\n  return model;\n}\n\n/** Serializer for saving and loading procedure state. */\nexport class ProcedureSerializer<ProcedureModel extends IProcedureModel,\n                                                        ParameterModel extends\n                                     IParameterModel> implements ISerializer {\n  public priority = priorities.PROCEDURES;\n\n  /**\n   * Constructs the procedure serializer.\n   *\n   * Example usage:\n   *   new ProcedureSerializer(MyProcedureModelClass, MyParameterModelClass)\n   *\n   * @param procedureModelClass The class (implementing IProcedureModel) that\n   *     you want this serializer to deserialize.\n   * @param parameterModelClass The class (implementing IParameterModel) that\n   *     you want this serializer to deserialize.\n   */\n  constructor(\n      private readonly procedureModelClass:\n          ProcedureModelConstructor<ProcedureModel>,\n      private readonly parameterModelClass:\n          ParameterModelConstructor<ParameterModel>) {}\n\n  /** Serializes the procedure models of the given workspace. */\n  save(workspace: Workspace): State[]|null {\n    const save = workspace.getProcedureMap().getProcedures().map(\n        (proc) => saveProcedure(proc));\n    return save.length ? save : null;\n  }\n\n  /**\n   * Deserializes the procedures models defined by the given state into the\n   * workspace.\n   */\n  load(state: State[], workspace: Workspace) {\n    const map = workspace.getProcedureMap();\n    for (const procState of state) {\n      map.add(loadProcedure(\n          this.procedureModelClass, this.parameterModelClass, procState,\n          workspace));\n    }\n  }\n\n  /** Disposes of any procedure models that exist on the workspace. */\n  clear(workspace: Workspace) {\n    workspace.getProcedureMap().clear();\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.workspaces');\n\nimport * as eventUtils from '../events/utils.js';\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\n// eslint-disable-next-line no-unused-vars\nimport type {Workspace} from '../workspace.js';\nimport {WorkspaceSvg} from '../workspace_svg.js';\n\n\n/**\n * Returns the state of the workspace as a plain JavaScript object.\n *\n * @param workspace The workspace to serialize.\n * @returns The serialized state of the workspace.\n */\nexport function save(workspace: Workspace):\n    {[key: string]: AnyDuringMigration} {\n  const state = Object.create(null);\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  for (const key in serializerMap) {\n    const save = (serializerMap[key] as ISerializer)?.save(workspace);\n    if (save) {\n      state[key] = save;\n    }\n  }\n  return state;\n}\n\n/**\n * Loads the variable represented by the given state into the given workspace.\n *\n * @param state The state of the workspace to deserialize into the workspace.\n * @param workspace The workspace to add the new state to.\n * @param param1 recordUndo: If true, events triggered by this function will be\n *     undo-able by the user. False by default.\n */\nexport function load(\n    state: {[key: string]: AnyDuringMigration}, workspace: Workspace,\n    {recordUndo = false}: {recordUndo?: boolean} = {}) {\n  const serializerMap = registry.getAllItems(registry.Type.SERIALIZER, true);\n  if (!serializerMap) {\n    return;\n  }\n\n  const deserializers = Object.entries(serializerMap)\n                            .sort(\n                                (a, b) => (b[1] as ISerializer)!.priority -\n                                    (a[1] as ISerializer)!.priority);\n\n  const prevRecordUndo = eventUtils.getRecordUndo();\n  eventUtils.setRecordUndo(recordUndo);\n  const existingGroup = eventUtils.getGroup();\n  if (!existingGroup) {\n    eventUtils.setGroup(true);\n  }\n\n  dom.startTextWidthCache();\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(false);\n  }\n\n  // We want to trigger clearing in reverse priority order so plugins don't end\n  // up missing dependencies.\n  for (const [, deserializer] of deserializers.reverse()) {\n    (deserializer as ISerializer)?.clear(workspace);\n  }\n\n  // reverse() is destructive, so we have to re-reverse to correct the order.\n  for (let [name, deserializer] of deserializers.reverse()) {\n    name = name;\n    const pluginState = state[name];\n    if (pluginState) {\n      (deserializer as ISerializer)?.load(state[name], workspace);\n    }\n  }\n\n  if (workspace instanceof WorkspaceSvg) {\n    workspace.setResizesEnabled(true);\n  }\n  dom.stopTextWidthCache();\n\n  eventUtils.fire(new (eventUtils.get(eventUtils.FINISHED_LOADING))(workspace));\n\n  eventUtils.setGroup(existingGroup);\n  eventUtils.setRecordUndo(prevRecordUndo);\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ShortcutItems');\n\nimport {BlockSvg} from './block_svg.js';\nimport * as clipboard from './clipboard.js';\nimport * as common from './common.js';\nimport {Gesture} from './gesture.js';\nimport type {ICopyable} from './interfaces/i_copyable.js';\nimport {KeyboardShortcut, ShortcutRegistry} from './shortcut_registry.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Object holding the names of the default shortcut items.\n */\nexport enum names {\n  ESCAPE = 'escape',\n  DELETE = 'delete',\n  COPY = 'copy',\n  CUT = 'cut',\n  PASTE = 'paste',\n  UNDO = 'undo',\n  REDO = 'redo',\n}\n\n/**\n * Keyboard shortcut to hide chaff on escape.\n */\nexport function registerEscape() {\n  const escapeAction: KeyboardShortcut = {\n    name: names.ESCAPE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      return true;\n    },\n    keyCodes: [KeyCodes.ESC],\n  };\n  ShortcutRegistry.registry.register(escapeAction);\n}\n\n/**\n * Keyboard shortcut to delete a block on delete or backspace\n */\nexport function registerDelete() {\n  const deleteShortcut: KeyboardShortcut = {\n    name: names.DELETE,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return !workspace.options.readOnly && selected != null &&\n          selected.isDeletable();\n    },\n    callback(workspace, e) {\n      // Delete or backspace.\n      // Stop the browser from going back to the previous page.\n      // Do this first to prevent an error in the delete code from resulting in\n      // data loss.\n      e.preventDefault();\n      // Don't delete while dragging.  Jeez.\n      if (Gesture.inProgress()) {\n        return false;\n      }\n      (common.getSelected() as BlockSvg).checkAndDelete();\n      return true;\n    },\n    keyCodes: [KeyCodes.DELETE, KeyCodes.BACKSPACE],\n  };\n  ShortcutRegistry.registry.register(deleteShortcut);\n}\n\n/**\n * Keyboard shortcut to copy a block on ctrl+c, cmd+c, or alt+c.\n */\nexport function registerCopy() {\n  const ctrlC = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.C, [KeyCodes.CTRL]);\n  const altC =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.C, [KeyCodes.ALT]);\n  const metaC = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.C, [KeyCodes.META]);\n\n  const copyShortcut: KeyboardShortcut = {\n    name: names.COPY,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return !workspace.options.readOnly && !Gesture.inProgress() &&\n          selected != null && selected.isDeletable() && selected.isMovable();\n    },\n    callback(workspace, e) {\n      // Prevent the default copy behavior, which may beep or otherwise indicate\n      // an error due to the lack of a selection.\n      e.preventDefault();\n      // AnyDuringMigration because:  Property 'hideChaff' does not exist on\n      // type 'Workspace'.\n      (workspace as AnyDuringMigration).hideChaff();\n      clipboard.copy(common.getSelected() as ICopyable);\n      return true;\n    },\n    keyCodes: [ctrlC, altC, metaC],\n  };\n  ShortcutRegistry.registry.register(copyShortcut);\n}\n\n/**\n * Keyboard shortcut to copy and delete a block on ctrl+x, cmd+x, or alt+x.\n */\nexport function registerCut() {\n  const ctrlX = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.X, [KeyCodes.CTRL]);\n  const altX =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.X, [KeyCodes.ALT]);\n  const metaX = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.X, [KeyCodes.META]);\n\n  const cutShortcut: KeyboardShortcut = {\n    name: names.CUT,\n    preconditionFn(workspace) {\n      const selected = common.getSelected();\n      return !workspace.options.readOnly && !Gesture.inProgress() &&\n          selected != null && selected instanceof BlockSvg &&\n          selected.isDeletable() && selected.isMovable() &&\n          !selected.workspace!.isFlyout;\n    },\n    callback() {\n      const selected = common.getSelected();\n      if (!selected) {\n        // Shouldn't happen but appeases the type system\n        return false;\n      }\n      clipboard.copy(selected);\n      (selected as BlockSvg).checkAndDelete();\n      return true;\n    },\n    keyCodes: [ctrlX, altX, metaX],\n  };\n\n  ShortcutRegistry.registry.register(cutShortcut);\n}\n\n/**\n * Keyboard shortcut to paste a block on ctrl+v, cmd+v, or alt+v.\n */\nexport function registerPaste() {\n  const ctrlV = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.V, [KeyCodes.CTRL]);\n  const altV =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.V, [KeyCodes.ALT]);\n  const metaV = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.V, [KeyCodes.META]);\n\n  const pasteShortcut: KeyboardShortcut = {\n    name: names.PASTE,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback() {\n      return !!(clipboard.paste());\n    },\n    keyCodes: [ctrlV, altV, metaV],\n  };\n\n  ShortcutRegistry.registry.register(pasteShortcut);\n}\n\n/**\n * Keyboard shortcut to undo the previous action on ctrl+z, cmd+z, or alt+z.\n */\nexport function registerUndo() {\n  const ctrlZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.CTRL]);\n  const altZ =\n      ShortcutRegistry.registry.createSerializedKey(KeyCodes.Z, [KeyCodes.ALT]);\n  const metaZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.META]);\n\n  const undoShortcut: KeyboardShortcut = {\n    name: names.UNDO,\n    preconditionFn(workspace) {\n      return !workspace.options.readOnly && !Gesture.inProgress();\n    },\n    callback(workspace) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(false);\n      return true;\n    },\n    keyCodes: [ctrlZ, altZ, metaZ],\n  };\n  ShortcutRegistry.registry.register(undoShortcut);\n}\n\n/**\n * Keyboard shortcut to redo the previous action on ctrl+shift+z, cmd+shift+z,\n * or alt+shift+z.\n */\nexport function registerRedo() {\n  const ctrlShiftZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.SHIFT, KeyCodes.CTRL]);\n  const altShiftZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.SHIFT, KeyCodes.ALT]);\n  const metaShiftZ = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Z, [KeyCodes.SHIFT, KeyCodes.META]);\n  // Ctrl-y is redo in Windows.  Command-y is never valid on Macs.\n  const ctrlY = ShortcutRegistry.registry.createSerializedKey(\n      KeyCodes.Y, [KeyCodes.CTRL]);\n\n  const redoShortcut: KeyboardShortcut = {\n    name: names.REDO,\n    preconditionFn(workspace) {\n      return !Gesture.inProgress() && !workspace.options.readOnly;\n    },\n    callback(workspace) {\n      // 'z' for undo 'Z' is for redo.\n      (workspace as WorkspaceSvg).hideChaff();\n      workspace.undo(true);\n      return true;\n    },\n    keyCodes: [ctrlShiftZ, altShiftZ, metaShiftZ, ctrlY],\n  };\n  ShortcutRegistry.registry.register(redoShortcut);\n}\n\n/**\n * Registers all default keyboard shortcut item. This should be called once per\n * instance of KeyboardShortcutRegistry.\n *\n * @internal\n */\nexport function registerDefaultShortcuts() {\n  registerEscape();\n  registerDelete();\n  registerCopy();\n  registerCut();\n  registerPaste();\n  registerUndo();\n  registerRedo();\n}\n\nregisterDefaultShortcuts();\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\nimport type {FlyoutItemInfoArray} from '../utils/toolbox';\ngoog.declareModuleId('Blockly.ISelectableToolboxItem');\n\nimport type {IToolboxItem} from './i_toolbox_item.js';\n\n\n/**\n * Interface for an item in the toolbox that can be selected.\n */\nexport interface ISelectableToolboxItem extends IToolboxItem {\n  /**\n   * Gets the name of the toolbox item. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string;\n\n  /**\n   * Gets the contents of the toolbox item. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray|string;\n\n  /**\n   * Sets the current toolbox item as selected.\n   *\n   * @param _isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(_isSelected: boolean): void;\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  getClickTarget(): Element;\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event): void;\n}\n\n/**\n * Type guard that checks whether an IToolboxItem is an ISelectableToolboxItem.\n */\nexport function isSelectableToolboxItem(toolboxItem: IToolboxItem):\n    toolboxItem is ISelectableToolboxItem {\n  return toolboxItem.isSelectable();\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils');\n\nimport type {Block} from './block.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport * as extensions from './extensions.js';\nimport * as aria from './utils/aria.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as colour from './utils/colour.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as math from './utils/math.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as object from './utils/object.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as stringUtils from './utils/string.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as xml from './utils/xml.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\nexport {\n  aria,\n  arrayUtils as array,\n  browserEvents,\n  colour,\n  Coordinate,\n  deprecation,\n  dom,\n  extensions,\n  idGenerator,\n  KeyCodes,\n  math,\n  Metrics,\n  object,\n  parsing,\n  Rect,\n  Size,\n  stringUtils as string,\n  style,\n  Svg,\n  svgMath,\n  svgPaths,\n  toolbox,\n  userAgent,\n  xml,\n};\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * its parent.  Only for SVG elements and children (e.g. rect, g, path).\n *\n * @param element SVG element to find the coordinates of.\n * @returns Object with .x and .y properties.\n * @deprecated Use **Blockly.utils.svgMath.getRelativeXY** instead.\n */\nexport function getRelativeXY(element: Element): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.getRelativeXY', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getRelativeXY');\n  return svgMath.getRelativeXY(element);\n}\n\n/**\n * Return the coordinates of the top-left corner of this element relative to\n * the div Blockly was injected into.\n *\n * @param element SVG element to find the coordinates of. If this is not a child\n *     of the div Blockly was injected into, the behaviour is undefined.\n * @returns Object with .x and .y properties.\n * @deprecated Use **Blockly.utils.svgMath.getInjectionDivXY** instead.\n */\nfunction getInjectionDivXY(element: Element): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.getInjectionDivXY_', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getInjectionDivXY');\n  return svgMath.getInjectionDivXY(element);\n}\nexport const getInjectionDivXY_ = getInjectionDivXY;\n\n/**\n * Parse a string with any number of interpolation tokens (%1, %2, ...).\n * It will also replace string table references (e.g., %{bky_my_msg} and\n * %{BKY_MY_MSG} will both be replaced with the value in\n * Msg['MY_MSG']). Percentage sign characters '%' may be self-escaped\n * (e.g., '%%').\n *\n * @param message Text which might contain string table references and\n *     interpolation tokens.\n * @returns Array of strings and numbers.\n * @deprecated Use **Blockly.utils.parsing.tokenizeInterpolation** instead.\n */\nexport function tokenizeInterpolation(message: string): Array<string|number> {\n  deprecation.warn(\n      'Blockly.utils.tokenizeInterpolation', 'December 2021', 'December 2022',\n      'Blockly.utils.parsing.tokenizeInterpolation');\n  return parsing.tokenizeInterpolation(message);\n}\n\n/**\n * Replaces string table references in a message, if the message is a string.\n * For example, \"%{bky_my_msg}\" and \"%{BKY_MY_MSG}\" will both be replaced with\n * the value in Msg['MY_MSG'].\n *\n * @param message Message, which may be a string that contains string table\n *     references.\n * @returns String with message references replaced.\n * @deprecated Use **Blockly.utils.parsing.replaceMessageReferences** instead.\n */\nexport function replaceMessageReferences(message: string|any): string {\n  deprecation.warn(\n      'Blockly.utils.replaceMessageReferences', 'December 2021',\n      'December 2022', 'Blockly.utils.parsing.replaceMessageReferences');\n  return parsing.replaceMessageReferences(message);\n}\n\n/**\n * Validates that any %{MSG_KEY} references in the message refer to keys of\n * the Msg string table.\n *\n * @param message Text which might contain string table references.\n * @returns True if all message references have matching values.\n *     Otherwise, false.\n * @deprecated Use **Blockly.utils.parsing.checkMessageReferences** instead.\n */\nexport function checkMessageReferences(message: string): boolean {\n  deprecation.warn(\n      'Blockly.utils.checkMessageReferences', 'December 2021', 'December 2022',\n      'Blockly.utils.parsing.checkMessageReferences');\n  return parsing.checkMessageReferences(message);\n}\n\n/**\n * Check if 3D transforms are supported by adding an element\n * and attempting to set the property.\n *\n * @returns True if 3D transforms are supported.\n * @deprecated Use **Blockly.utils.svgMath.is3dSupported** instead.\n */\nexport function is3dSupported(): boolean {\n  deprecation.warn(\n      'Blockly.utils.is3dSupported', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.is3dSupported');\n  return svgMath.is3dSupported();\n}\n\n/**\n * Get the position of the current viewport in window coordinates.  This takes\n * scroll into account.\n *\n * @returns An object containing window width, height, and scroll position in\n *     window coordinates.\n * @deprecated Use **Blockly.utils.svgMath.getViewportBBox** instead.\n * @internal\n */\nexport function getViewportBBox(): Rect {\n  deprecation.warn(\n      'Blockly.utils.getViewportBBox', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getViewportBBox');\n  return svgMath.getViewportBBox();\n}\n\n/**\n * Removes the first occurrence of a particular value from an array.\n *\n * @param arr Array from which to remove value.\n * @param value Value to remove.\n * @returns True if an element was removed.\n * @deprecated Use **Blockly.array.removeElem** instead.\n * @internal\n */\nexport function arrayRemove<T>(arr: Array<T>, value: T): boolean {\n  deprecation.warn(\n      'Blockly.utils.arrayRemove', 'December 2021', 'December 2022',\n      'Blockly.array.removeElem');\n  return arrayUtils.removeElem(arr, value);\n}\n\n/**\n * Gets the document scroll distance as a coordinate object.\n * Copied from Closure's goog.dom.getDocumentScroll.\n *\n * @returns Object with values 'x' and 'y'.\n * @deprecated Use **Blockly.utils.svgMath.getDocumentScroll** instead.\n */\nexport function getDocumentScroll(): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.getDocumentScroll', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.getDocumentScroll');\n  return svgMath.getDocumentScroll();\n}\n\n/**\n * Get a map of all the block's descendants mapping their type to the number of\n *    children with that type.\n *\n * @param block The block to map.\n * @param opt_stripFollowing Optionally ignore all following statements (blocks\n *     that are not inside a value or statement input of the block).\n * @returns Map of types to type counts for descendants of the bock.\n * @deprecated Use **Blockly.common.getBlockTypeCounts** instead.\n */\nexport function getBlockTypeCounts(\n    block: Block, opt_stripFollowing?: boolean): {[key: string]: number} {\n  deprecation.warn(\n      'Blockly.utils.getBlockTypeCounts', 'December 2021', 'December 2022',\n      'Blockly.common.getBlockTypeCounts');\n  return common.getBlockTypeCounts(block, opt_stripFollowing);\n}\n\n/**\n * Converts screen coordinates to workspace coordinates.\n *\n * @param ws The workspace to find the coordinates on.\n * @param screenCoordinates The screen coordinates to be converted to workspace\n *     coordinates\n * @deprecated Use **Blockly.utils.svgMath.screenToWsCoordinates** instead.\n * @returns The workspace coordinates.\n */\nexport function screenToWsCoordinates(\n    ws: WorkspaceSvg, screenCoordinates: Coordinate): Coordinate {\n  deprecation.warn(\n      'Blockly.utils.screenToWsCoordinates', 'December 2021', 'December 2022',\n      'Blockly.utils.svgMath.screenToWsCoordinates');\n  return svgMath.screenToWsCoordinates(ws, screenCoordinates);\n}\n\n/**\n * Parse a block colour from a number or string, as provided in a block\n * definition.\n *\n * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n *     reference string pointing to one of those two values.\n * @returns An object containing the colour as a #RRGGBB string, and the hue if\n *     the input was an HSV hue value.\n * @throws {Error} If the colour cannot be parsed.\n * @deprecated Use **Blockly.utils.parsing.parseBlockColour** instead.\n */\nexport function parseBlockColour(colour: number|\n                                 string): {hue: number|null, hex: string} {\n  deprecation.warn(\n      'Blockly.utils.parseBlockColour', 'December 2021', 'December 2022',\n      'Blockly.utils.parsing.parseBlockColour');\n  return parsing.parseBlockColour(colour);\n}\n\n/**\n * Calls a function after the page has loaded, possibly immediately.\n *\n * @param fn Function to run.\n * @throws Error Will throw if no global document can be found (e.g., Node.js).\n * @deprecated No longer provided by Blockly.\n */\nexport function runAfterPageLoad(fn: () => void) {\n  deprecation.warn(\n      'Blockly.utils.runAfterPageLoad', 'December 2021', 'December 2022');\n  extensions.runAfterPageLoad(fn);\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/workspace_events.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_ui_base.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport {BlockDragger} from './block_dragger.js';\nimport {BlockSvg} from './block_svg.js';\nimport {BlocklyOptions} from './blockly_options.js';\nimport {Blocks} from './blocks.js';\nimport * as browserEvents from './browser_events.js';\nimport {Bubble} from './bubble.js';\nimport {BubbleDragger} from './bubble_dragger.js';\nimport * as bumpObjects from './bump_objects.js';\nimport * as clipboard from './clipboard.js';\nimport {Comment} from './comment.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport {ConnectionChecker} from './connection_checker.js';\nimport {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as ContextMenu from './contextmenu.js';\nimport * as ContextMenuItems from './contextmenu_items.js';\nimport {ContextMenuRegistry} from './contextmenu_registry.js';\nimport * as Css from './css.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as dialog from './dialog.js';\nimport {DragTarget} from './drag_target.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as Events from './events/events.js';\nimport * as Extensions from './extensions.js';\nimport {Field, FieldConfig, FieldValidator, UnattachedFieldError} from './field.js';\nimport {FieldAngle, FieldAngleConfig, FieldAngleFromJsonConfig, FieldAngleValidator} from './field_angle.js';\nimport {FieldCheckbox, FieldCheckboxConfig, FieldCheckboxFromJsonConfig, FieldCheckboxValidator} from './field_checkbox.js';\nimport {FieldColour, FieldColourConfig, FieldColourFromJsonConfig, FieldColourValidator} from './field_colour.js';\nimport {FieldDropdown, FieldDropdownConfig, FieldDropdownFromJsonConfig, FieldDropdownValidator, MenuGenerator, MenuGeneratorFunction, MenuOption} from './field_dropdown.js';\nimport {FieldImage, FieldImageConfig, FieldImageFromJsonConfig} from './field_image.js';\nimport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig} from './field_label.js';\nimport {FieldLabelSerializable} from './field_label_serializable.js';\nimport {FieldMultilineInput, FieldMultilineInputConfig, FieldMultilineInputFromJsonConfig, FieldMultilineInputValidator} from './field_multilineinput.js';\nimport {FieldNumber, FieldNumberConfig, FieldNumberFromJsonConfig, FieldNumberValidator} from './field_number.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldTextInput, FieldTextInputConfig, FieldTextInputFromJsonConfig, FieldTextInputValidator} from './field_textinput.js';\nimport {FieldVariable, FieldVariableConfig, FieldVariableFromJsonConfig, FieldVariableValidator} from './field_variable.js';\nimport {Flyout} from './flyout_base.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {HorizontalFlyout} from './flyout_horizontal.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport {VerticalFlyout} from './flyout_vertical.js';\nimport {CodeGenerator} from './generator.js';\nimport {Gesture} from './gesture.js';\nimport {Grid} from './grid.js';\nimport {Icon} from './icon.js';\nimport {inject} from './inject.js';\nimport {Align, Input} from './input.js';\nimport {inputTypes} from './input_types.js';\nimport {InsertionMarkerManager} from './insertion_marker_manager.js';\nimport {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport {IAutoHideable} from './interfaces/i_autohideable.js';\nimport {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport {IBubble} from './interfaces/i_bubble.js';\nimport {ICollapsibleToolboxItem} from './interfaces/i_collapsible_toolbox_item.js';\nimport {IComponent} from './interfaces/i_component.js';\nimport {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {IContextMenu} from './interfaces/i_contextmenu.js';\nimport {ICopyable} from './interfaces/i_copyable.js';\nimport {IDeletable} from './interfaces/i_deletable.js';\nimport {IDeleteArea} from './interfaces/i_delete_area.js';\nimport {IDragTarget} from './interfaces/i_drag_target.js';\nimport {IDraggable} from './interfaces/i_draggable.js';\nimport {IFlyout} from './interfaces/i_flyout.js';\nimport {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport {IMovable} from './interfaces/i_movable.js';\nimport {IObservable, isObservable} from './interfaces/i_observable.js';\nimport {IPositionable} from './interfaces/i_positionable.js';\nimport {IRegistrable} from './interfaces/i_registrable.js';\nimport {ISelectable} from './interfaces/i_selectable.js';\nimport {ISelectableToolboxItem} from './interfaces/i_selectable_toolbox_item.js';\nimport {IStyleable} from './interfaces/i_styleable.js';\nimport {IToolbox} from './interfaces/i_toolbox.js';\nimport {IToolboxItem} from './interfaces/i_toolbox_item.js';\nimport {IVariableBackedParameterModel, isVariableBackedParameterModel} from './interfaces/i_variable_backed_parameter_model.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {BasicCursor} from './keyboard_nav/basic_cursor.js';\nimport {Cursor} from './keyboard_nav/cursor.js';\nimport {Marker} from './keyboard_nav/marker.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Menu} from './menu.js';\nimport {MenuItem} from './menuitem.js';\nimport {MetricsManager} from './metrics_manager.js';\nimport {Msg, setLocale} from './msg.js';\nimport {Mutator} from './mutator.js';\nimport {Names} from './names.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as Procedures from './procedures.js';\nimport * as registry from './registry.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport * as blockRendering from './renderers/common/block_rendering.js';\nimport * as constants from './constants.js';\nimport * as geras from './renderers/geras/geras.js';\nimport * as minimalist from './renderers/minimalist/minimalist.js';\nimport * as thrasos from './renderers/thrasos/thrasos.js';\nimport * as zelos from './renderers/zelos/zelos.js';\nimport {Scrollbar} from './scrollbar.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as serialization from './serialization.js';\nimport * as ShortcutItems from './shortcut_items.js';\nimport {ShortcutRegistry} from './shortcut_registry.js';\nimport {Theme} from './theme.js';\nimport * as Themes from './theme/themes.js';\nimport {ThemeManager} from './theme_manager.js';\nimport {ToolboxCategory} from './toolbox/category.js';\nimport {CollapsibleToolboxCategory} from './toolbox/collapsible_category.js';\nimport {ToolboxSeparator} from './toolbox/separator.js';\nimport {Toolbox} from './toolbox/toolbox.js';\nimport {ToolboxItem} from './toolbox/toolbox_item.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Trashcan} from './trashcan.js';\nimport * as utils from './utils.js';\nimport * as colour from './utils/colour.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as VariablesDynamic from './variables_dynamic.js';\nimport {Warning} from './warning.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport {Workspace} from './workspace.js';\nimport {WorkspaceAudio} from './workspace_audio.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport {WorkspaceDragSurfaceSvg} from './workspace_drag_surface_svg.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport {resizeSvgContents as realResizeSvgContents, WorkspaceSvg} from './workspace_svg.js';\nimport * as Xml from './xml.js';\nimport {ZoomControls} from './zoom_controls.js';\n\n\n/**\n * Blockly core version.\n * This constant is overridden by the build script (npm run build) to the value\n * of the version in package.json. This is done by the Closure Compiler in the\n * buildCompressed gulp task.\n * For local builds, you can pass --define='Blockly.VERSION=X.Y.Z' to the\n * compiler to override this constant.\n *\n * @define {string}\n */\nexport const VERSION = 'uncompiled';\n\n/*\n * Top-level functions and properties on the Blockly namespace.\n * These are used only in external code. Do not reference these\n * from internal code as importing from this file can cause circular\n * dependencies. Do not add new functions here. There is probably a better\n * namespace to put new functions on.\n */\n\n/*\n * Aliases for input alignments used in block defintions.\n */\n\n/**\n * @see Blockly.Input.Align.LEFT\n */\nexport const ALIGN_LEFT = Align.LEFT;\n\n/**\n * @see Blockly.Input.Align.CENTRE\n */\nexport const ALIGN_CENTRE = Align.CENTRE;\n\n/**\n * @see Blockly.Input.Align.RIGHT\n */\nexport const ALIGN_RIGHT = Align.RIGHT;\n/*\n * Aliases for constants used for connection and input types.\n */\n\n/**\n * @see ConnectionType.INPUT_VALUE\n */\nexport const INPUT_VALUE = ConnectionType.INPUT_VALUE;\n\n/**\n * @see ConnectionType.OUTPUT_VALUE\n */\nexport const OUTPUT_VALUE = ConnectionType.OUTPUT_VALUE;\n\n/**\n * @see ConnectionType.NEXT_STATEMENT\n */\nexport const NEXT_STATEMENT = ConnectionType.NEXT_STATEMENT;\n\n/**\n * @see ConnectionType.PREVIOUS_STATEMENT\n */\nexport const PREVIOUS_STATEMENT = ConnectionType.PREVIOUS_STATEMENT;\n\n/**\n * @see inputTypes.DUMMY_INPUT\n */\nexport const DUMMY_INPUT = inputTypes.DUMMY;\n\n/** Aliases for toolbox positions. */\n\n/**\n * @see toolbox.Position.TOP\n */\nexport const TOOLBOX_AT_TOP = toolbox.Position.TOP;\n\n/**\n * @see toolbox.Position.BOTTOM\n */\nexport const TOOLBOX_AT_BOTTOM = toolbox.Position.BOTTOM;\n\n/**\n * @see toolbox.Position.LEFT\n */\nexport const TOOLBOX_AT_LEFT = toolbox.Position.LEFT;\n\n/**\n * @see toolbox.Position.RIGHT\n */\nexport const TOOLBOX_AT_RIGHT = toolbox.Position.RIGHT;\n\n/*\n * Other aliased functions.\n */\n\n/**\n * Size the SVG image to completely fill its container. Call this when the view\n * actually changes sizes (e.g. on a window resize/device orientation change).\n * See workspace.resizeContents to resize the workspace when the contents\n * change (e.g. when a block is added or removed).\n * Record the height/width of the SVG image.\n *\n * @param workspace Any workspace in the SVG.\n * @see Blockly.common.svgResize\n */\nexport const svgResize = common.svgResize;\n\n/**\n * Close tooltips, context menus, dropdown selections, etc.\n *\n * @param opt_onlyClosePopups Whether only popups should be closed.\n * @see Blockly.WorkspaceSvg.hideChaff\n */\nexport function hideChaff(opt_onlyClosePopups?: boolean) {\n  (common.getMainWorkspace() as WorkspaceSvg).hideChaff(opt_onlyClosePopups);\n}\n\n/**\n * Returns the main workspace.  Returns the last used main workspace (based on\n * focus).  Try not to use this function, particularly if there are multiple\n * Blockly instances on a page.\n *\n * @see Blockly.common.getMainWorkspace\n */\nexport const getMainWorkspace = common.getMainWorkspace;\n\n/**\n * Returns the currently selected copyable object.\n */\nexport const getSelected = common.getSelected;\n\n/**\n * Define blocks from an array of JSON block definitions, as might be generated\n * by the Blockly Developer Tools.\n *\n * @param jsonArray An array of JSON block definitions.\n * @see Blockly.common.defineBlocksWithJsonArray\n */\nexport const defineBlocksWithJsonArray = common.defineBlocksWithJsonArray;\n\n/**\n * Set the parent container.  This is the container element that the WidgetDiv,\n * dropDownDiv, and Tooltip are rendered into the first time `Blockly.inject`\n * is called.\n * This method is a NOP if called after the first `Blockly.inject`.\n *\n * @param container The container element.\n * @see Blockly.common.setParentContainer\n */\nexport const setParentContainer = common.setParentContainer;\n\n/**\n * Size the workspace when the contents change.  This also updates\n * scrollbars accordingly.\n *\n * @param workspace The workspace to resize.\n * @deprecated Use **workspace.resizeContents** instead.\n * @see Blockly.WorkspaceSvg.resizeContents\n */\nfunction resizeSvgContentsLocal(workspace: WorkspaceSvg) {\n  deprecation.warn(\n      'Blockly.resizeSvgContents', 'December 2021', 'December 2022',\n      'Blockly.WorkspaceSvg.resizeSvgContents');\n  realResizeSvgContents(workspace);\n}\nexport const resizeSvgContents = resizeSvgContentsLocal;\n\n/**\n * Copy a block or workspace comment onto the local clipboard.\n *\n * @param toCopy Block or Workspace Comment to be copied.\n * @deprecated Use **Blockly.clipboard.copy** instead.\n * @see Blockly.clipboard.copy\n */\nexport function copy(toCopy: ICopyable) {\n  deprecation.warn(\n      'Blockly.copy', 'December 2021', 'December 2022',\n      'Blockly.clipboard.copy');\n  clipboard.copy(toCopy);\n}\n\n/**\n * Paste a block or workspace comment on to the main workspace.\n *\n * @returns True if the paste was successful, false otherwise.\n * @deprecated Use **Blockly.clipboard.paste** instead.\n * @see Blockly.clipboard.paste\n */\nexport function paste(): boolean {\n  deprecation.warn(\n      'Blockly.paste', 'December 2021', 'December 2022',\n      'Blockly.clipboard.paste');\n  return !!clipboard.paste();\n}\n\n/**\n * Duplicate this block and its children, or a workspace comment.\n *\n * @param toDuplicate Block or Workspace Comment to be copied.\n * @deprecated Use **Blockly.clipboard.duplicate** instead.\n * @see Blockly.clipboard.duplicate\n */\nexport function duplicate(toDuplicate: ICopyable) {\n  deprecation.warn(\n      'Blockly.duplicate', 'December 2021', 'December 2022',\n      'Blockly.clipboard.duplicate');\n  clipboard.duplicate(toDuplicate);\n}\n\n/**\n * Is the given string a number (includes negative and decimals).\n *\n * @param str Input string.\n * @returns True if number, false otherwise.\n * @deprecated Use **Blockly.utils.string.isNumber** instead.\n * @see Blockly.utils.string.isNumber\n */\nexport function isNumber(str: string): boolean {\n  deprecation.warn(\n      'Blockly.isNumber', 'December 2021', 'December 2022',\n      'Blockly.utils.string.isNumber');\n  return utils.string.isNumber(str);\n}\n\n/**\n * Convert a hue (HSV model) into an RGB hex triplet.\n *\n * @param hue Hue on a colour wheel (0-360).\n * @returns RGB code, e.g. '#5ba65b'.\n * @deprecated Use **Blockly.utils.colour.hueToHex** instead.\n * @see Blockly.utils.colour.hueToHex\n */\nexport function hueToHex(hue: number): string {\n  deprecation.warn(\n      'Blockly.hueToHex', 'December 2021', 'December 2022',\n      'Blockly.utils.colour.hueToHex');\n  return colour.hueToHex(hue);\n}\n\n/**\n * Bind an event handler that should be called regardless of whether it is part\n * of the active touch stream.\n * Use this for events that are not part of a multi-part gesture (e.g.\n * mouseover for tooltips).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @returns Opaque data that can be passed to unbindEvent_.\n * @deprecated Use **Blockly.browserEvents.bind** instead.\n * @see Blockly.browserEvents.bind\n */\nexport function bindEvent_(\n    node: EventTarget, name: string, thisObject: Object|null,\n    func: Function): browserEvents.Data {\n  deprecation.warn(\n      'Blockly.bindEvent_', 'December 2021', 'December 2022',\n      'Blockly.browserEvents.bind');\n  return browserEvents.bind(node, name, thisObject, func);\n}\n\n/**\n * Unbind one or more events event from a function call.\n *\n * @param bindData Opaque data from bindEvent_.\n *     This list is emptied during the course of calling this function.\n * @returns The function call.\n * @deprecated Use **Blockly.browserEvents.unbind** instead.\n * @see browserEvents.unbind\n */\nexport function unbindEvent_(bindData: browserEvents.Data): Function {\n  deprecation.warn(\n      'Blockly.unbindEvent_', 'December 2021', 'December 2022',\n      'Blockly.browserEvents.unbind');\n  return browserEvents.unbind(bindData);\n}\n\n/**\n * Bind an event handler that can be ignored if it is not part of the active\n * touch stream.\n * Use this for events that either start or continue a multi-part gesture (e.g.\n * mousedown or mousemove, which may be part of a drag or click).\n *\n * @param node Node upon which to listen.\n * @param name Event name to listen to (e.g. 'mousedown').\n * @param thisObject The value of 'this' in the function.\n * @param func Function to call when event is triggered.\n * @param opt_noCaptureIdentifier True if triggering on this event should not\n *     block execution of other event handlers on this touch or other\n *     simultaneous touches.  False by default.\n * @param _opt_noPreventDefault No-op, deprecated and will be removed in v10.\n * @returns Opaque data that can be passed to unbindEvent_.\n * @deprecated Use **Blockly.browserEvents.conditionalBind** instead.\n * @see browserEvents.conditionalBind\n */\nexport function bindEventWithChecks_(\n    node: EventTarget, name: string, thisObject: Object|null, func: Function,\n    opt_noCaptureIdentifier?: boolean,\n    _opt_noPreventDefault?: boolean): browserEvents.Data {\n  deprecation.warn(\n      'Blockly.bindEventWithChecks_', 'December 2021', 'December 2022',\n      'Blockly.browserEvents.conditionalBind');\n  return browserEvents.conditionalBind(\n      node, name, thisObject, func, opt_noCaptureIdentifier);\n}\n\n// Aliases to allow external code to access these values for legacy reasons.\nexport const COLLAPSE_CHARS = internalConstants.COLLAPSE_CHARS;\nexport const DRAG_STACK = internalConstants.DRAG_STACK;\nexport const OPPOSITE_TYPE = internalConstants.OPPOSITE_TYPE;\nexport const RENAME_VARIABLE_ID = internalConstants.RENAME_VARIABLE_ID;\nexport const DELETE_VARIABLE_ID = internalConstants.DELETE_VARIABLE_ID;\nexport const COLLAPSED_INPUT_NAME = constants.COLLAPSED_INPUT_NAME;\nexport const COLLAPSED_FIELD_NAME = constants.COLLAPSED_FIELD_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_CATEGORY_NAME: string = Variables.CATEGORY_NAME;\n\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * variable blocks.\n */\nexport const VARIABLE_DYNAMIC_CATEGORY_NAME: string =\n    VariablesDynamic.CATEGORY_NAME;\n/**\n * String for use in the \"custom\" attribute of a category in toolbox XML.\n * This string indicates that the category should be dynamically populated with\n * procedure blocks.\n */\nexport const PROCEDURE_CATEGORY_NAME: string = Procedures.CATEGORY_NAME;\n\n\n// Context for why we need to monkey-patch in these functions (internal):\n//   https://docs.google.com/document/d/1MbO0LEA-pAyx1ErGLJnyUqTLrcYTo-5zga9qplnxeXo/edit?usp=sharing&resourcekey=0-5h_32-i-dHwHjf_9KYEVKg\n\n// clang-format off\nWorkspace.prototype.newBlock =\n    function(prototypeName: string, opt_id?: string): Block {\n      return new Block(this, prototypeName, opt_id);\n    };\n\nWorkspaceSvg.prototype.newBlock =\n    function(prototypeName: string, opt_id?: string): BlockSvg {\n      return new BlockSvg(this, prototypeName, opt_id);\n    };\n\nWorkspaceSvg.newTrashcan = function(workspace: WorkspaceSvg): Trashcan {\n  return new Trashcan(workspace);\n};\n\nWorkspaceCommentSvg.prototype.showContextMenu =\n    function(this: WorkspaceCommentSvg, e: Event) {\n      if (this.workspace.options.readOnly) {\n        return;\n      }\n      const menuOptions = [];\n\n      if (this.isDeletable() && this.isMovable()) {\n        menuOptions.push(ContextMenu.commentDuplicateOption(this));\n        menuOptions.push(ContextMenu.commentDeleteOption(this));\n      }\n\n      ContextMenu.show(e, menuOptions, this.RTL);\n    };\n\nMutator.prototype.newWorkspaceSvg =\n    function(options: Options): WorkspaceSvg {\n      return new WorkspaceSvg(options);\n    };\n\nNames.prototype.populateProcedures =\n    function(this: Names, workspace: Workspace) {\n      const procedures = Procedures.allProcedures(workspace);\n      // Flatten the return vs no-return procedure lists.\n      const flattenedProcedures: AnyDuringMigration[][] =\n          procedures[0].concat(procedures[1]);\n      for (let i = 0; i < flattenedProcedures.length; i++) {\n        this.getName(flattenedProcedures[i][0], Names.NameType.PROCEDURE);\n      }\n    };\n// clang-format on\n\n\n// Re-export submodules that no longer declareLegacyNamespace.\nexport {browserEvents};\nexport {ContextMenu};\nexport {ContextMenuItems};\nexport {Css};\nexport {Events};\nexport {Extensions};\nexport {Procedures};\nexport {Procedures as procedures};\nexport {ShortcutItems};\nexport {Themes};\nexport {Tooltip};\nexport {Touch};\nexport {Variables};\nexport {VariablesDynamic};\nexport {WidgetDiv};\nexport {Xml};\nexport {blockAnimations};\nexport {blockRendering};\nexport {bumpObjects};\nexport {clipboard};\nexport {common};\nexport {constants};\nexport {dialog};\nexport {fieldRegistry};\nexport {geras};\nexport {minimalist};\nexport {registry};\nexport {thrasos};\nexport {uiPosition};\nexport {utils};\nexport {zelos};\nexport {ASTNode};\nexport {BasicCursor};\nexport {Block};\nexport {BlocklyOptions};\nexport {BlockDragger};\nexport {BlockDragSurfaceSvg};\nexport {BlockSvg};\nexport {Blocks};\nexport {Bubble};\nexport {BubbleDragger};\nexport {CollapsibleToolboxCategory};\nexport {Comment};\nexport {ComponentManager};\nexport {Connection};\nexport {ConnectionType};\nexport {ConnectionChecker};\nexport {ConnectionDB};\nexport {ContextMenuRegistry};\nexport {Cursor};\nexport {DeleteArea};\nexport {DragTarget};\nexport const DropDownDiv = dropDownDiv;\nexport {Field, FieldConfig, FieldValidator, UnattachedFieldError};\nexport {\n  FieldAngle,\n  FieldAngleConfig,\n  FieldAngleFromJsonConfig,\n  FieldAngleValidator,\n};\nexport {\n  FieldCheckbox,\n  FieldCheckboxConfig,\n  FieldCheckboxFromJsonConfig,\n  FieldCheckboxValidator,\n};\nexport {\n  FieldColour,\n  FieldColourConfig,\n  FieldColourFromJsonConfig,\n  FieldColourValidator,\n};\nexport {\n  FieldDropdown,\n  FieldDropdownConfig,\n  FieldDropdownFromJsonConfig,\n  FieldDropdownValidator,\n  MenuGenerator,\n  MenuGeneratorFunction,\n  MenuOption,\n};\nexport {FieldImage, FieldImageConfig, FieldImageFromJsonConfig};\nexport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig};\nexport {FieldLabelSerializable};\nexport {\n  FieldMultilineInput,\n  FieldMultilineInputConfig,\n  FieldMultilineInputFromJsonConfig,\n  FieldMultilineInputValidator,\n};\nexport {\n  FieldNumber,\n  FieldNumberConfig,\n  FieldNumberFromJsonConfig,\n  FieldNumberValidator,\n};\nexport {\n  FieldTextInput,\n  FieldTextInputConfig,\n  FieldTextInputFromJsonConfig,\n  FieldTextInputValidator,\n};\nexport {\n  FieldVariable,\n  FieldVariableConfig,\n  FieldVariableFromJsonConfig,\n  FieldVariableValidator,\n};\nexport {Flyout};\nexport {FlyoutButton};\nexport {FlyoutMetricsManager};\nexport {CodeGenerator};\nexport {CodeGenerator as Generator};  // Deprecated name, October 2022.\nexport {Gesture};\nexport {Gesture as TouchGesture};  // Remove in v10.\nexport {Grid};\nexport {HorizontalFlyout};\nexport {IASTNodeLocation};\nexport {IASTNodeLocationSvg};\nexport {IASTNodeLocationWithBlock};\nexport {IAutoHideable};\nexport {IBlockDragger};\nexport {IBoundedElement};\nexport {IBubble};\nexport {ICollapsibleToolboxItem};\nexport {IComponent};\nexport {IConnectionChecker};\nexport {IContextMenu};\nexport {Icon};\nexport {ICopyable};\nexport {IDeletable};\nexport {IDeleteArea};\nexport {IDragTarget};\nexport {IDraggable};\nexport {IFlyout};\nexport {IKeyboardAccessible};\nexport {IMetricsManager};\nexport {IMovable};\nexport {Input};\nexport {InsertionMarkerManager};\nexport {IObservable, isObservable};\nexport {IPositionable};\nexport {IRegistrable};\nexport {ISelectable};\nexport {ISelectableToolboxItem};\nexport {IStyleable};\nexport {IToolbox};\nexport {IToolboxItem};\nexport {IVariableBackedParameterModel, isVariableBackedParameterModel};\nexport {Marker};\nexport {MarkerManager};\nexport {Menu};\nexport {MenuItem};\nexport {MetricsManager};\nexport {Mutator};\nexport {Msg, setLocale};\nexport {Names};\nexport {Options};\nexport {RenderedConnection};\nexport {Scrollbar};\nexport {ScrollbarPair};\nexport {ShortcutRegistry};\nexport {TabNavigateCursor};\nexport {Theme};\nexport {ThemeManager};\nexport {Toolbox};\nexport {ToolboxCategory};\nexport {ToolboxItem};\nexport {ToolboxSeparator};\nexport {Trashcan};\nexport {VariableMap};\nexport {VariableModel};\nexport {VerticalFlyout};\nexport {Warning};\nexport {Workspace};\nexport {WorkspaceAudio};\nexport {WorkspaceComment};\nexport {WorkspaceCommentSvg};\nexport {WorkspaceDragSurfaceSvg};\nexport {WorkspaceDragger};\nexport {WorkspaceSvg};\nexport {ZoomControls};\nexport {config};\n/** @deprecated Use Blockly.ConnectionType instead. */\nexport const connectionTypes = ConnectionType;\nexport {inject};\nexport {inputTypes};\nexport {serialization};\n", null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, "/**\n * @license\n * Copyright The Closure Library Authors.\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview A minimal implementation of base.js.\n *\n * This file is used in place of base.js (Closure library bootstrap\n * code) when building Blockly using the Closure Compiler.  Refer to\n * base.js for more information about items defined here.\n *\n * @provideGoog\n */\n\n/** @define {boolean} Overridden to true by the compiler. */\nvar COMPILED = false;\n\n/** @const */\nvar goog = goog || {};\n\n/**\n * Reference to the global object.  This is provided as 'root' by the\n * UMD wrapper, but prefer globalThis if it is defined.\n *\n * https://www.ecma-international.org/ecma-262/9.0/index.html#sec-global-object\n *\n * @const\n * @type {!Global}\n * @suppress {undefinedVars}\n */\ngoog.global = globalThis || root;\n\n/** @type {Object<string, (string|number|boolean)>|undefined} */\ngoog.global.CLOSURE_DEFINES;\n\n/**\n * Defines a named value.\n * When compiled the default can be overridden using the compiler options or the\n * value set in the CLOSURE_DEFINES object. Returns the defined value so that it\n * can be used safely in modules. Note that the value type MUST be either\n * boolean, number, or string.\n *\n * @param {string} name\n * @param {T} defaultValue\n * @return {T}\n * @template T\n */\ngoog.define = function(name, defaultValue) {\n  return defaultValue;\n};\n\n/** @define {boolean} */\ngoog.DEBUG = goog.define('goog.DEBUG', false);\n\n/** @define {boolean} */\ngoog.DISALLOW_TEST_ONLY_CODE =\n    goog.define('goog.DISALLOW_TEST_ONLY_CODE', COMPILED && !goog.DEBUG);\n\n/**\n * @param {string} name\n */\ngoog.provide = function(name) {};\n\n/**\n * @param {string} name\n * @return {void}\n */\ngoog.module = function(name) {};\n\n/**\n * @param {string} name\n * @return {?}\n * @suppress {missingProvide}\n */\ngoog.module.get = function(name) {};\n\n/** @suppress {missingProvide} */\ngoog.module.declareLegacyNamespace = function() {};\n\n/**\n * Marks that the current file should only be used for testing, and never for\n * live code in production.\n *\n * In the case of unit tests, the message may optionally be an exact namespace\n * for the test (e.g. 'goog.stringTest'). The linter will then ignore the extra\n * provide (if not explicitly defined in the code).\n *\n * @param {string=} opt_message Optional message to add to the error that's\n *     raised when used in production code.\n */\ngoog.setTestOnly = function(opt_message) {\n  if (goog.DISALLOW_TEST_ONLY_CODE) {\n    opt_message = opt_message || '';\n    throw new Error(\n        'Importing test-only code into non-debug environment' +\n        (opt_message ? ': ' + opt_message : '.'));\n  }\n};\n\n/**\n * @param {string} namespace\n * @return {?}\n */\ngoog.require = function(namespace) {};\n\n/**\n * @param {string} namespace\n * @return {?}\n */\ngoog.requireType = function(namespace) {};\n", "// Copyright 2018 The Closure Library Authors. All Rights Reserved.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//      http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS-IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n\n/**\n * @fileoverview ES6 module that exports symbols from base.js so that ES6\n * modules do not need to use globals and so that is clear if a project is using\n * Closure's base.js file. It is also a subset of properties in base.js, meaning\n * it should be clearer what should not be used in ES6 modules\n * (goog.module/provide are not exported here, for example). Though that is not\n * to say that everything in this file should be used in an ES6 module; some\n * depreciated functions are exported to make migration easier (e.g.\n * goog.scope).\n *\n * Note that this does not load Closure's base.js file, it is still up to the\n * programmer to include it. Nor does the fact that this is an ES6 module mean\n * that projects no longer require deps.js files for debug loading - they do.\n * Closure will need to load your ES6 modules for you if you have any Closure\n * file (goog.provide/goog.module) dependencies, as they need to be available\n * before the ES6 module evaluates.\n *\n * Also note that this file has special compiler handling! It is okay to export\n * anything from this file, but the name also needs to exist on the global goog.\n * This special compiler pass enforces that you always import this file as\n * `import * as goog`, as many tools use regex based parsing to find\n * goog.require calls.\n */\n\nexport const global = globalThis;\n// export const require = goog.require;\n// export const define = goog.define;\n// export const DEBUG = goog.DEBUG;\n// export const LOCALE = goog.LOCALE;\n// export const TRUSTED_SITE = goog.TRUSTED_SITE;\n// export const DISALLOW_TEST_ONLY_CODE = goog.DISALLOW_TEST_ONLY_CODE;\n// export const getGoogModule = goog.module.get;\n// export const setTestOnly = goog.setTestOnly;\n// export const forwardDeclare = goog.forwardDeclare;\n// export const getObjectByName = goog.getObjectByName;\n// export const basePath = goog.basePath;\n// export const addSingletonGetter = goog.addSingletonGetter;\n// export const typeOf = goog.typeOf;\n// export const isArrayLike = goog.isArrayLike;\n// export const isDateLike = goog.isDateLike;\n// export const isObject = goog.isObject;\n// export const getUid = goog.getUid;\n// export const hasUid = goog.hasUid;\n// export const removeUid = goog.removeUid;\n// export const now = Date.now;\n// export const globalEval = goog.globalEval;\n// export const getCssName = goog.getCssName;\n// export const setCssNameMapping = goog.setCssNameMapping;\n// export const getMsg = goog.getMsg;\n// export const getMsgWithFallback = goog.getMsgWithFallback;\n// export const exportSymbol = goog.exportSymbol;\n// export const exportProperty = goog.exportProperty;\n// export const abstractMethod = goog.abstractMethod;\n// export const cloneObject = goog.cloneObject;\n// export const bind = goog.bind;\n// export const partial = goog.partial;\n// export const inherits = goog.inherits;\n// export const scope = goog.scope;\n// export const defineClass = goog.defineClass;\nexport const declareModuleId = function(namespace) {\n  if (window.goog && window.goog.declareModuleId) {\n    window.goog.declareModuleId.call(this, namespace);\n  }\n};\n\n\n// Export select properties of module. Do not export the function itself or\n// goog.module.declareLegacyNamespace.\n// export const module = {\n//   get: goog.module.get,\n// };\n\n// Omissions include:\n// goog.ENABLE_DEBUG_LOADER - define only used in base.\n// goog.ENABLE_CHROME_APP_SAFE_SCRIPT_LOADING - define only used in base.\n// goog.provide - ES6 modules do not provide anything.\n// goog.module - ES6 modules cannot be goog.modules.\n// goog.module.declareLegacyNamespace - ES6 modules cannot declare namespaces.\n// goog.addDependency - meant to only be used by dependency files.\n// goog.DEPENDENCIES_ENABLED - constant only used in base.\n// goog.TRANSPILE - define only used in base.\n// goog.TRANSPILER - define only used in base.\n// goog.loadModule - should not be called by any ES6 module; exists for\n//   generated bundles.\n// goog.LOAD_MODULE_USING_EVAL - define only used in base.\n// goog.SEAL_MODULE_EXPORTS - define only used in base.\n// goog.DebugLoader - used rarely, only outside of compiled code.\n// goog.Transpiler - used rarely, only outside of compiled code.\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blocks');\n\n\n/**\n * A block definition.  For now this very loose, but it can potentially\n * be refined e.g. by replacing this typedef with a class definition.\n */\nexport type BlockDefinition = AnyDuringMigration;\n\n/**\n * A mapping of block type names to block prototype objects.\n */\nexport const Blocks: {[key: string]: BlockDefinition} = Object.create(null);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.inputTypes');\n\nimport {ConnectionType} from './connection_type.js';\n\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum inputTypes {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  VALUE = ConnectionType.INPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  STATEMENT = ConnectionType.NEXT_STATEMENT,\n  // A dummy input.  Used to add field(s) with no input.\n  DUMMY = 5\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for size calculation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Size');\n\n\n/**\n * Class for representing sizes consisting of a width and height.\n */\nexport class Size {\n  /**\n   * @param width Width.\n   * @param height Height.\n   */\n  constructor(public width: number, public height: number) {}\n\n  /**\n   * Compares sizes for equality.\n   *\n   * @param a A Size.\n   * @param b A Size.\n   * @returns True iff the sizes have equal widths and equal heights, or if both\n   *     are null.\n   */\n  static equals(a: Size|null, b: Size|null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.width === b.width && a.height === b.height;\n  }\n}\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Msg');\n\n\n/** A dictionary of localised messages. */\nexport const Msg: {[key: string]: string} = Object.create(null);\n\n/**\n * Sets the locale (i.e. the localized messages/block-text/etc) to the given\n * locale.\n *\n * This is not useful/necessary when loading from a script tag, because the\n * messages are automatically cluged into the Blockly.Msg object. But we provide\n * it in both the script-tag and non-script-tag contexts so that the tscompiler\n * can properly create our type definition files.\n *\n * @param locale An object defining the messages for a given language.\n */\nexport const setLocale = function(locale: {[key: string]: string}) {\n  Object.keys(locale).forEach(function(k) {\n    Msg[k] = locale[k];\n  });\n};\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for events fired as a result of actions in\n * Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Abstract');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as common from '../common.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Abstract class for an event.\n */\nexport abstract class Abstract {\n  /**\n   * Whether or not the event was constructed without necessary parameters\n   * (to be populated by fromJson).\n   */\n  abstract isBlank: boolean;\n\n  /** The workspace identifier for this event. */\n  workspaceId?: string = undefined;\n\n  /**\n   * An ID for the group of events this block is associated with.\n   *\n   * Groups define events that should be treated as an single action from the\n   * user's perspective, and should be undone together.\n   */\n  group: string;\n\n  /** Whether this event is undoable or not. */\n  recordUndo: boolean;\n\n  /** Whether or not the event is a UI event. */\n  isUiEvent = false;\n\n  /** Type of this event. */\n  type = '';\n\n  constructor() {\n    this.group = eventUtils.getGroup();\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  toJson(): AbstractEventJson {\n    return {\n      'type': this.type,\n      'group': this.group,\n    };\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  fromJson(json: AbstractEventJson) {\n    deprecation.warn(\n        'Blockly.Events.Abstract.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    this.isBlank = false;\n    this.group = json['group'] || '';\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Abstract (like all events), but we can't specify that due to the\n   *     fact that parameters to static methods in subclasses must be\n   *     supertypes of parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: AbstractEventJson, workspace: Workspace, event: any):\n      Abstract {\n    event.isBlank = false;\n    event.group = json['group'] || '';\n    event.workspaceId = workspace.id;\n    return event;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns True if null, false if something changed.\n   */\n  isNull(): boolean {\n    return false;\n  }\n\n  /**\n   * Run an event.\n   *\n   * @param _forward True if run forward, false if run backward (undo).\n   */\n  run(_forward: boolean) {\n    // Defined by subclasses. Cannot be abstract b/c UI events do /not/ define\n    // this.\n  }\n\n  /**\n   * Get workspace the event belongs to.\n   *\n   * @returns The workspace the event belongs to.\n   * @throws {Error} if workspace is null.\n   * @internal\n   */\n  getEventWorkspace_(): Workspace {\n    let workspace;\n    if (this.workspaceId) {\n      workspace = common.getWorkspaceById(this.workspaceId);\n    }\n    if (!workspace) {\n      throw Error(\n          'Workspace is null. Event must have been generated from real' +\n          ' Blockly events.');\n    }\n    return workspace;\n  }\n}\n\nexport interface AbstractEventJson {\n  type: string;\n  group: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Abstract class for a variable event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarBase');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Abstract class for a variable event.\n */\nexport class VarBase extends AbstractEvent {\n  override isBlank = true;\n  /** The ID of the variable this event references. */\n  varId?: string;\n\n  /**\n   * @param opt_variable The variable this event corresponds to.  Undefined for\n   *     a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super();\n    this.isBlank = typeof opt_variable === 'undefined';\n    if (!opt_variable) return;\n\n    this.varId = opt_variable.getId();\n    this.workspaceId = opt_variable.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarBaseJson {\n    const json = super.toJson() as VarBaseJson;\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    json['varId'] = this.varId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarBaseJson) {\n    deprecation.warn(\n        'Blockly.Events.VarBase.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.varId = json['varId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarBaseJson, workspace: Workspace, event?: any):\n      VarBase {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarBase()) as VarBase;\n    newEvent.varId = json['varId'];\n    return newEvent;\n  }\n}\n\nexport interface VarBaseJson extends AbstractEventJson {\n  varId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a variable creation event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarCreate');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a variable model has been created.\n */\nexport class VarCreate extends VarBase {\n  override type = eventUtils.VAR_CREATE;\n\n  /** The type of the variable that was created. */\n  varType?: string;\n\n  /** The name of the variable that was created. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The created variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarCreateJson {\n    const json = super.toJson() as VarCreateJson;\n    if (this.varType === undefined) {\n      throw new Error(\n          'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarCreateJson) {\n    deprecation.warn(\n        'Blockly.Events.VarCreate.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.varType = json['varType'];\n    this.varName = json['varName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarCreate, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarCreateJson, workspace: Workspace, event?: any):\n      VarCreate {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarCreate()) as VarCreate;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    } else {\n      workspace.deleteVariableById(this.varId);\n    }\n  }\n}\n\nexport interface VarCreateJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_CREATE, VarCreate);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for the variable model.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VariableModel');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_create.js';\n\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a variable model.\n * Holds information for the variable including name, ID, and type.\n *\n * @see {Blockly.FieldVariable}\n */\nexport class VariableModel {\n  type: string;\n  private readonly id_: string;\n\n  /**\n   * @param workspace The variable's workspace.\n   * @param name The name of the variable.  This is the user-visible name (e.g.\n   *     'my var' or ''), not the generated name.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   */\n  constructor(\n      public workspace: Workspace, public name: string, opt_type?: string,\n      opt_id?: string) {\n    /**\n     * The type of the variable, such as 'int' or 'sound_effect'. This may be\n     * used to build a list of variables of a specific type. By default this is\n     * the empty string '', which is a specific type.\n     *\n     * @see {Blockly.FieldVariable}\n     */\n    this.type = opt_type || '';\n\n    /**\n     * A unique ID for the variable. This should be defined at creation and\n     * not change, even if the name changes. In most cases this should be a\n     * UUID.\n     */\n    this.id_ = opt_id || idGenerator.genUid();\n  }\n\n  /** @returns The ID for the variable. */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * A custom compare function for the VariableModel objects.\n   *\n   * @param var1 First variable to compare.\n   * @param var2 Second variable to compare.\n   * @returns -1 if name of var1 is less than name of var2, 0 if equal, and 1 if\n   *     greater.\n   * @internal\n   */\n  static compareByName(var1: VariableModel, var2: VariableModel): number {\n    return var1.name.localeCompare(var2.name, undefined, {sensitivity: 'base'});\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for coordinate manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Coordinate');\n\n\n/**\n * Class for representing coordinates and positions.\n */\nexport class Coordinate {\n  /**\n   * @param x Left.\n   * @param y Top.\n   */\n  constructor(public x: number, public y: number) {}\n\n  /**\n   * Creates a new copy of this coordinate.\n   *\n   * @returns A copy of this coordinate.\n   */\n  clone(): Coordinate {\n    return new Coordinate(this.x, this.y);\n  }\n\n  /**\n   * Scales this coordinate by the given scale factor.\n   *\n   * @param s The scale factor to use for both x and y dimensions.\n   * @returns This coordinate after scaling.\n   */\n  scale(s: number): Coordinate {\n    this.x *= s;\n    this.y *= s;\n    return this;\n  }\n\n  /**\n   * Translates this coordinate by the given offsets.\n   * respectively.\n   *\n   * @param tx The value to translate x by.\n   * @param ty The value to translate y by.\n   * @returns This coordinate after translating.\n   */\n  translate(tx: number, ty: number): Coordinate {\n    this.x += tx;\n    this.y += ty;\n    return this;\n  }\n\n  /**\n   * Compares coordinates for equality.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns True iff the coordinates are equal, or if both are null.\n   */\n  static equals(a?: Coordinate|null, b?: Coordinate|null): boolean {\n    if (a === b) {\n      return true;\n    }\n    if (!a || !b) {\n      return false;\n    }\n    return a.x === b.x && a.y === b.y;\n  }\n\n  /**\n   * Returns the distance between two coordinates.\n   *\n   * @param a A Coordinate.\n   * @param b A Coordinate.\n   * @returns The distance between `a` and `b`.\n   */\n  static distance(a: Coordinate, b: Coordinate): number {\n    const dx = a.x - b.x;\n    const dy = a.y - b.y;\n    return Math.sqrt(dx * dx + dy * dy);\n  }\n\n  /**\n   * Returns the magnitude of a coordinate.\n   *\n   * @param a A Coordinate.\n   * @returns The distance between the origin and `a`.\n   */\n  static magnitude(a: Coordinate): number {\n    return Math.sqrt(a.x * a.x + a.y * a.y);\n  }\n\n  /**\n   * Returns the difference between two coordinates as a new\n   * Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the difference between `a` and `b`.\n   */\n  static difference(a: Coordinate|SVGPoint, b: Coordinate|SVGPoint):\n      Coordinate {\n    return new Coordinate(a.x - b.x, a.y - b.y);\n  }\n\n  /**\n   * Returns the sum of two coordinates as a new Coordinate.\n   *\n   * @param a An x/y coordinate.\n   * @param b An x/y coordinate.\n   * @returns A Coordinate representing the sum of the two coordinates.\n   */\n  static sum(a: Coordinate|SVGPoint, b: Coordinate|SVGPoint): Coordinate {\n    return new Coordinate(a.x + b.x, a.y + b.y);\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment on the workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceComment');\n\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as xml from './utils/xml.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a workspace comment.\n */\nexport class WorkspaceComment {\n  id: string;\n  protected xy_: Coordinate;\n  protected height_: number;\n  protected width_: number;\n  protected RTL: boolean;\n\n  private deletable_ = true;\n\n  private movable_ = true;\n\n  private editable_ = true;\n  protected content_: string;\n\n  /** Whether this comment has been disposed. */\n  protected disposed_ = false;\n  /** @internal */\n  isComment = true;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param content The content of this workspace comment.\n   * @param height Height of the comment.\n   * @param width Width of the comment.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(\n      public workspace: Workspace, content: string, height: number,\n      width: number, opt_id?: string) {\n    this.id = opt_id && !workspace.getCommentById(opt_id) ?\n        opt_id :\n        idGenerator.genUid();\n\n    workspace.addTopComment(this);\n\n    /**\n     * The comment's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n\n    /**\n     * The comment's height in workspace units.  Scale does not change this\n     * value.\n     */\n    this.height_ = height;\n\n    /**\n     * The comment's width in workspace units.  Scale does not change this\n     * value.\n     */\n    this.width_ = width;\n\n    this.RTL = workspace.RTL;\n\n    this.content_ = content;\n\n    WorkspaceComment.fireCreateEvent(this);\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * @internal\n   */\n  dispose() {\n    if (this.disposed_) {\n      return;\n    }\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n    // Remove from the list of top comments and the comment database.\n    this.workspace.removeTopComment(this);\n    this.disposed_ = true;\n  }\n\n  // Height, width, x, and y are all stored on even non-rendered comments, to\n  // preserve state if you pass the contents through a headless workspace.\n\n  /**\n   * Get comment height.\n   *\n   * @returns Comment height.\n   * @internal\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Set comment height.\n   *\n   * @param height Comment height.\n   * @internal\n   */\n  setHeight(height: number) {\n    this.height_ = height;\n  }\n\n  /**\n   * Get comment width.\n   *\n   * @returns Comment width.\n   * @internal\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Set comment width.\n   *\n   * @param width comment width.\n   * @internal\n   */\n  setWidth(width: number) {\n    this.width_ = width;\n  }\n\n  /**\n   * Get stored location.\n   *\n   * @returns The comment's stored location.\n   *   This is not valid if the comment is currently being dragged.\n   * @internal\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(this.xy_.x, this.xy_.y);\n  }\n\n  /**\n   * Move a comment by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @internal\n   */\n  moveBy(dx: number, dy: number) {\n    const event =\n        new (eventUtils.get(eventUtils.COMMENT_MOVE))(this) as CommentMove;\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get whether this comment is deletable or not.\n   *\n   * @returns True if deletable.\n   * @internal\n   */\n  isDeletable(): boolean {\n    return this.deletable_ &&\n        !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is deletable or not.\n   *\n   * @param deletable True if deletable.\n   * @internal\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable_ = deletable;\n  }\n\n  /**\n   * Get whether this comment is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return this.movable_ &&\n        !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is movable or not.\n   *\n   * @param movable True if movable.\n   * @internal\n   */\n  setMovable(movable: boolean) {\n    this.movable_ = movable;\n  }\n\n  /**\n   * Get whether this comment is editable or not.\n   *\n   * @returns True if editable.\n   */\n  isEditable(): boolean {\n    return this.editable_ &&\n        !(this.workspace && this.workspace.options.readOnly);\n  }\n\n  /**\n   * Set whether this comment is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable_ = editable;\n  }\n\n  /**\n   * Returns this comment's text.\n   *\n   * @returns Comment text.\n   * @internal\n   */\n  getContent(): string {\n    return this.content_;\n  }\n\n  /**\n   * Set this comment's content.\n   *\n   * @param content Comment content.\n   * @internal\n   */\n  setContent(content: string) {\n    if (this.content_ !== content) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_CHANGE))(\n          this, this.content_, content));\n      this.content_ = content;\n    }\n  }\n\n  /**\n   * Encode a comment subtree as XML with XY coordinates.\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  toXmlWithXY(opt_noId?: boolean): Element {\n    const element = this.toXml(opt_noId);\n    element.setAttribute('x', String(Math.round(this.xy_.x)));\n    element.setAttribute('y', String(Math.round(this.xy_.y)));\n    element.setAttribute('h', String(this.height_));\n    element.setAttribute('w', String(this.width_));\n    return element;\n  }\n\n  /**\n   * Encode a comment subtree as XML, but don't serialize the XY coordinates.\n   * This method avoids some expensive metrics-related calls that are made in\n   * toXmlWithXY().\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  toXml(opt_noId?: boolean): Element {\n    const commentElement = xml.createElement('comment');\n    if (!opt_noId) {\n      commentElement.id = this.id;\n    }\n    commentElement.textContent = this.getContent();\n    return commentElement;\n  }\n\n  /**\n   * Fire a create event for the given workspace comment, if comments are\n   * enabled.\n   *\n   * @param comment The comment that was just created.\n   * @internal\n   */\n  static fireCreateEvent(comment: WorkspaceComment) {\n    if (eventUtils.isEnabled()) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      try {\n        eventUtils.fire(\n            new (eventUtils.get(eventUtils.COMMENT_CREATE))(comment));\n      } finally {\n        eventUtils.setGroup(existingGroup);\n      }\n    }\n  }\n\n  /**\n   * Decode an XML comment tag and create a comment on the workspace.\n   *\n   * @param xmlComment XML comment element.\n   * @param workspace The workspace.\n   * @returns The created workspace comment.\n   * @internal\n   */\n  static fromXml(xmlComment: Element, workspace: Workspace): WorkspaceComment {\n    const info = WorkspaceComment.parseAttributes(xmlComment);\n\n    const comment =\n        new WorkspaceComment(workspace, info.content, info.h, info.w, info.id);\n\n    const xmlX = xmlComment.getAttribute('x');\n    const xmlY = xmlComment.getAttribute('y');\n    const commentX = xmlX ? parseInt(xmlX, 10) : NaN;\n    const commentY = xmlY ? parseInt(xmlY, 10) : NaN;\n    if (!isNaN(commentX) && !isNaN(commentY)) {\n      comment.moveBy(commentX, commentY);\n    }\n\n    WorkspaceComment.fireCreateEvent(comment);\n    return comment;\n  }\n\n  /**\n   * Decode an XML comment tag and return the results in an object.\n   *\n   * @param xml XML comment element.\n   * @returns An object containing the id, size, position, and comment string.\n   * @internal\n   */\n  static parseAttributes(xml: Element): {\n    id: string,\n    w: number,\n    h: number,\n    x: number,\n    y: number,\n    content: string\n  } {\n    const xmlH = xml.getAttribute('h');\n    const xmlW = xml.getAttribute('w');\n    const xmlX = xml.getAttribute('x');\n    const xmlY = xml.getAttribute('y');\n    const xmlId = xml.getAttribute('id');\n\n    if (!xmlId) {\n      throw new Error('No ID present in XML comment definition.');\n    }\n\n    return {\n      id: xmlId,\n      // The height of the comment in workspace units, or 100 if not specified.\n      h: xmlH ? parseInt(xmlH) : 100,\n      // The width of the comment in workspace units, or 100 if not specified.\n      w: xmlW ? parseInt(xmlW) : 100,\n      // The x position of the comment in workspace coordinates, or NaN if not\n      // specified in the XML.\n      x: xmlX ? parseInt(xmlX) : NaN,\n      // The y position of the comment in workspace coordinates, or NaN if not\n      // specified in the XML.\n      y: xmlY ? parseInt(xmlY) : NaN,\n      content: xml.textContent ?? '',\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.UiBase');\n\nimport {Abstract as AbstractEvent} from './events_abstract.js';\n\n\n/**\n * Base class for a UI event.\n * UI events are events that don't need to be sent over the wire for multi-user\n * editing to work (e.g. scrolling the workspace, zooming, opening toolbox\n * categories).\n * UI events do not undo or redo.\n */\nexport class UiBase extends AbstractEvent {\n  override isBlank = true;\n  override workspaceId: string;\n\n  // UI events do not undo or redo.\n  override recordUndo = false;\n\n  /** Whether or not the event is a UI event. */\n  override isUiEvent = true;\n\n  /**\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_workspaceId?: string) {\n    super();\n\n    /** Whether or not the event is blank (to be populated by fromJson). */\n    this.isBlank = typeof opt_workspaceId === 'undefined';\n\n    /** The workspace identifier for this event. */\n    this.workspaceId = opt_workspaceId ? opt_workspaceId : '';\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of element select action.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Selected');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a selected event.\n * Notifies listeners that a new element has been selected.\n */\nexport class Selected extends UiBase {\n  /** The id of the last selected selectable element. */\n  oldElementId?: string;\n\n  /**\n   * The id of the newly selected selectable element,\n   * or undefined if unselected.\n   */\n  newElementId?: string;\n\n  override type = eventUtils.SELECTED;\n\n  /**\n   * @param opt_oldElementId The ID of the previously selected element. Null if\n   *     no element last selected. Undefined for a blank event.\n   * @param opt_newElementId The ID of the selected element. Null if no element\n   *     currently selected (deselect). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Null if no element previously selected. Undefined for a blank event.\n   */\n  constructor(\n      opt_oldElementId?: string|null, opt_newElementId?: string|null,\n      opt_workspaceId?: string) {\n    super(opt_workspaceId);\n\n    this.oldElementId = opt_oldElementId ?? undefined;\n    this.newElementId = opt_newElementId ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): SelectedJson {\n    const json = super.toJson() as SelectedJson;\n    json['oldElementId'] = this.oldElementId;\n    json['newElementId'] = this.newElementId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: SelectedJson) {\n    deprecation.warn(\n        'Blockly.Events.Selected.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldElementId = json['oldElementId'];\n    this.newElementId = json['newElementId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Selected, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: SelectedJson, workspace: Workspace, event?: any):\n      Selected {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new Selected()) as Selected;\n    newEvent.oldElementId = json['oldElementId'];\n    newEvent.newElementId = json['newElementId'];\n    return newEvent;\n  }\n}\n\nexport interface SelectedJson extends AbstractEventJson {\n  oldElementId?: string;\n  newElementId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.SELECTED, Selected);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.userAgent');\n\n\n/** The raw useragent string. */\nlet rawUserAgent: string;\n\nlet isJavaFx: boolean;\n\nlet isWebKit: boolean;\n\nlet isGecko: boolean;\n\nlet isAndroid: boolean;\n\nlet isIPad: boolean;\n\nlet isIPhone: boolean;\n\nlet isMac: boolean;\n\nlet isTablet: boolean;\n\nlet isMobile: boolean;\n\n(function(raw) {\nrawUserAgent = raw;\nconst rawUpper = rawUserAgent.toUpperCase();\n/**\n * Case-insensitive test of whether name is in the useragent string.\n *\n * @param name Name to test.\n * @returns True if name is present.\n */\nfunction has(name: string): boolean {\n  return rawUpper.indexOf(name.toUpperCase()) !== -1;\n}\n\n// Browsers.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/browser.js\n// Useragent for JavaFX:\n// Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.44\n//     (KHTML, like Gecko) JavaFX/8.0 Safari/537.44\nisJavaFx = has('JavaFX');\n\n// Engines.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/engine.js\nisWebKit = has('WebKit');\nisGecko = has('Gecko') && !isWebKit;\n\n// Platforms.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/platform.js\n// and\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/extra.js\nisAndroid = has('Android');\nconst maxTouchPoints =\n    globalThis['navigator'] && globalThis['navigator']['maxTouchPoints'];\nisIPad = has('iPad') || has('Macintosh') && maxTouchPoints > 0;\nisIPhone = has('iPhone') && !isIPad;\nisMac = has('Macintosh');\n\n// Devices.  Logic from:\n// https://github.com/google/closure-library/blob/master/closure/goog/labs/useragent/device.js\nisTablet = isIPad || isAndroid && !has('Mobile') || has('Silk');\nisMobile = !isTablet && (isIPhone || isAndroid);\n})(globalThis['navigator'] && globalThis['navigator']['userAgent'] || '');\n\nexport const raw: string = rawUserAgent;\n\nexport const JavaFx: boolean = isJavaFx;\n\nexport const GECKO: boolean = isGecko;\n\nexport const ANDROID: boolean = isAndroid;\n\nexport const IPAD: boolean = isIPad;\n\nexport const IPHONE: boolean = isIPhone;\n\nexport const MAC: boolean = isMac;\n\nexport const MOBILE: boolean = isMobile;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility methods for rectangle manipulation.\n * These methods are not specific to Blockly, and could be factored out into\n * a JavaScript framework such as Closure.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Rect');\n\n\n/**\n * Class for representing rectangular regions.\n */\nexport class Rect {\n  /**\n   * @param top Top.\n   * @param bottom Bottom.\n   * @param left Left.\n   * @param right Right.\n   */\n  constructor(\n      public top: number, public bottom: number, public left: number,\n      public right: number) {}\n\n  /**\n   * Tests whether this rectangle contains a x/y coordinate.\n   *\n   * @param x The x coordinate to test for containment.\n   * @param y The y coordinate to test for containment.\n   * @returns Whether this rectangle contains given coordinate.\n   */\n  contains(x: number, y: number): boolean {\n    return x >= this.left && x <= this.right && y >= this.top &&\n        y <= this.bottom;\n  }\n\n  /**\n   * Tests whether this rectangle intersects the provided rectangle.\n   * Assumes that the coordinate system increases going down and left.\n   *\n   * @param other The other rectangle to check for intersection with.\n   * @returns Whether this rectangle intersects the provided rectangle.\n   */\n  intersects(other: Rect): boolean {\n    return !(\n        this.left > other.right || this.right < other.left ||\n        this.top > other.bottom || this.bottom < other.top);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Defines the Svg class. Its constants enumerate\n * all SVG tag names used by Blockly.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.Svg');\n\n\n/**\n * A name with the type of the SVG element stored in the generic.\n */\nexport class Svg<_T> {\n  /** @internal */\n  static ANIMATE = new Svg<SVGAnimateElement>('animate');\n  /** @internal */\n  static CIRCLE = new Svg<SVGCircleElement>('circle');\n  /** @internal */\n  static CLIPPATH = new Svg<SVGClipPathElement>('clipPath');\n  /** @internal */\n  static DEFS = new Svg<SVGDefsElement>('defs');\n  /** @internal */\n  static FECOMPOSITE = new Svg<SVGFECompositeElement>('feComposite');\n  /** @internal */\n  static FECOMPONENTTRANSFER =\n      new Svg<SVGFEComponentTransferElement>('feComponentTransfer');\n  /** @internal */\n  static FEFLOOD = new Svg<SVGFEFloodElement>('feFlood');\n  /** @internal */\n  static FEFUNCA = new Svg<SVGFEFuncAElement>('feFuncA');\n  /** @internal */\n  static FEGAUSSIANBLUR = new Svg<SVGFEGaussianBlurElement>('feGaussianBlur');\n  /** @internal */\n  static FEPOINTLIGHT = new Svg<SVGFEPointLightElement>('fePointLight');\n  /** @internal */\n  static FESPECULARLIGHTING =\n      new Svg<SVGFESpecularLightingElement>('feSpecularLighting');\n  /** @internal */\n  static FILTER = new Svg<SVGFilterElement>('filter');\n  /** @internal */\n  static FOREIGNOBJECT = new Svg<SVGForeignObjectElement>('foreignObject');\n  /** @internal */\n  static G = new Svg<SVGGElement>('g');\n  /** @internal */\n  static IMAGE = new Svg<SVGImageElement>('image');\n  /** @internal */\n  static LINE = new Svg<SVGLineElement>('line');\n  /** @internal */\n  static PATH = new Svg<SVGPathElement>('path');\n  /** @internal */\n  static PATTERN = new Svg<SVGPatternElement>('pattern');\n  /** @internal */\n  static POLYGON = new Svg<SVGPolygonElement>('polygon');\n  /** @internal */\n  static RECT = new Svg<SVGRectElement>('rect');\n  /** @internal */\n  static SVG = new Svg<SVGSVGElement>('svg');\n  /** @internal */\n  static TEXT = new Svg<SVGTextElement>('text');\n  /** @internal */\n  static TSPAN = new Svg<SVGTSpanElement>('tspan');\n\n  /**\n   * @param tagName The SVG element tag name.\n   * @internal\n   */\n  constructor(private readonly tagName: string) {}\n\n  /**\n   * Returns the SVG element tag name.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.tagName;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment on a rendered workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceCommentSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\n// import * as ContextMenu from './contextmenu.js';\nimport * as Css from './css.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {CopyData, ICopyable} from './interfaces/i_copyable.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {WorkspaceComment} from './workspace_comment.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** Size of the resize icon. */\nconst RESIZE_SIZE = 8;\n\n/** Radius of the border around the comment. */\nconst BORDER_RADIUS = 3;\n\n/** Offset from the foreignobject edge to the textarea edge. */\nconst TEXTAREA_OFFSET = 2;\n\n/**\n * Class for a workspace comment's SVG representation.\n */\nexport class WorkspaceCommentSvg extends WorkspaceComment implements\n    IBoundedElement, IBubble, ICopyable {\n  /**\n   * The width and height to use to size a workspace comment when it is first\n   * added, before it has been edited by the user.\n   *\n   * @internal\n   */\n  static DEFAULT_SIZE = 100;\n\n  /** Offset from the top to make room for a top bar. */\n  private static readonly TOP_OFFSET = 10;\n  override workspace: WorkspaceSvg;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper_: browserEvents.Data|null = null;\n\n  /** Mouse move event data. */\n  private onMouseMoveWrapper_: browserEvents.Data|null = null;\n\n  /** Whether event handlers have been initialized. */\n  private eventsInit_ = false;\n  private textarea_: HTMLTextAreaElement|null = null;\n\n  private svgRectTarget_: SVGRectElement|null = null;\n\n  private svgHandleTarget_: SVGRectElement|null = null;\n\n  private foreignObject_: SVGForeignObjectElement|null = null;\n\n  private resizeGroup_: SVGGElement|null = null;\n\n  private deleteGroup_: SVGGElement|null = null;\n\n  private deleteIconBorder_: SVGCircleElement|null = null;\n\n  private focused_ = false;\n  private autoLayout_ = false;\n  // Create core elements for the block.\n  private readonly svgGroup_: SVGElement;\n  svgRect_: SVGRectElement;\n\n  /** Whether the comment is rendered onscreen and is a part of the DOM. */\n  private rendered_ = false;\n  private readonly useDragSurface_: boolean;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param content The content of this workspace comment.\n   * @param height Height of the comment.\n   * @param width Width of the comment.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(\n      workspace: WorkspaceSvg, content: string, height: number, width: number,\n      opt_id?: string) {\n    super(workspace, content, height, width, opt_id);\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyComment'});\n    this.workspace = workspace;\n\n    this.svgRect_ = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentRect',\n      'x': 0,\n      'y': 0,\n      'rx': BORDER_RADIUS,\n      'ry': BORDER_RADIUS,\n    });\n    this.svgGroup_.appendChild(this.svgRect_);\n\n    /**\n     * Whether to move the comment to the drag surface when it is dragged.\n     * True if it should move, false if it should be translated directly.\n     */\n    this.useDragSurface_ = !!workspace.getBlockDragSurface();\n\n    this.render();\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * @internal\n   */\n  override dispose() {\n    if (this.disposed_) {\n      return;\n    }\n    // If this comment is being dragged, unlink the mouse events.\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.COMMENT_DELETE))(this));\n    }\n\n    dom.removeNode(this.svgGroup_);\n    // Dispose of any rendered components\n    this.disposeInternal_();\n\n    eventUtils.disable();\n    super.dispose();\n    eventUtils.enable();\n  }\n\n  /**\n   * Create and initialize the SVG representation of a workspace comment.\n   * May be called more than once.\n   *\n   * @param opt_noSelect Text inside text area will be selected if false\n   * @internal\n   */\n  initSvg(opt_noSelect?: boolean) {\n    if (!this.workspace.rendered) {\n      throw TypeError('Workspace is headless.');\n    }\n    if (!this.workspace.options.readOnly && !this.eventsInit_) {\n      browserEvents.conditionalBind(\n          this.svgRectTarget_ as SVGRectElement, 'pointerdown', this,\n          this.pathMouseDown_);\n      browserEvents.conditionalBind(\n          this.svgHandleTarget_ as SVGRectElement, 'pointerdown', this,\n          this.pathMouseDown_);\n    }\n    this.eventsInit_ = true;\n\n    this.updateMovable();\n    if (!this.getSvgRoot().parentNode) {\n      this.workspace.getBubbleCanvas().appendChild(this.getSvgRoot());\n    }\n\n    if (!opt_noSelect && this.textarea_) {\n      this.textarea_.select();\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG comment.\n   *\n   * @param e Pointer down event.\n   */\n  private pathMouseDown_(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBubbleStart(e, this);\n    }\n  }\n\n  /**\n   * Show the context menu for this workspace comment.\n   *\n   * @param e Pointer event.\n   * @internal\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  showContextMenu(e: PointerEvent) {\n    throw new Error(\n        'The implementation of showContextMenu should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /**\n   * Select this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  select() {\n    if (common.getSelected() === this) {\n      return;\n    }\n    let oldId = null;\n    if (common.getSelected()) {\n      oldId = common.getSelected()!.id;\n      // Unselect any previously selected block.\n      eventUtils.disable();\n      try {\n        common.getSelected()!.unselect();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        oldId, this.id, this.workspace.id);\n    eventUtils.fire(event);\n    common.setSelected(this);\n    this.addSelect();\n  }\n\n  /**\n   * Unselect this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  unselect() {\n    if (common.getSelected() !== this) {\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        this.id, null, this.workspace.id);\n    eventUtils.fire(event);\n    common.setSelected(null);\n    this.removeSelect();\n    this.blurFocus();\n  }\n\n  /**\n   * Select this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  addSelect() {\n    dom.addClass(this.svgGroup_, 'blocklySelected');\n    this.setFocus();\n  }\n\n  /**\n   * Unselect this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  removeSelect() {\n    dom.addClass(this.svgGroup_, 'blocklySelected');\n    this.blurFocus();\n  }\n\n  /**\n   * Focus this comment.  Highlight it visually.\n   *\n   * @internal\n   */\n  addFocus() {\n    dom.addClass(this.svgGroup_, 'blocklyFocused');\n  }\n\n  /**\n   * Unfocus this comment.  Remove its highlighting.\n   *\n   * @internal\n   */\n  removeFocus() {\n    dom.removeClass(this.svgGroup_, 'blocklyFocused');\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this comment relative to\n   * the drawing surface's origin (0,0), in workspace units.\n   * If the comment is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   * @internal\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    let x = 0;\n    let y = 0;\n\n    const dragSurfaceGroup = this.useDragSurface_ ?\n        this.workspace.getBlockDragSurface()!.getGroup() :\n        null;\n\n    let element: Node|null = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this comment and every parent.\n        const xy = svgMath.getRelativeXY(element as Element);\n        x += xy.x;\n        y += xy.y;\n        // If this element is the current element on the drag surface, include\n        // the translation of the drag surface itself.\n        if (this.useDragSurface_ &&\n            this.workspace.getBlockDragSurface()!.getCurrentBlock() ===\n                element) {\n          const surfaceTranslation =\n              this.workspace.getBlockDragSurface()!.getSurfaceTranslation();\n          x += surfaceTranslation.x;\n          y += surfaceTranslation.y;\n        }\n\n        element = element.parentNode;\n      } while (element && element !== this.workspace.getBubbleCanvas() &&\n               element !== dragSurfaceGroup);\n    }\n    this.xy_ = new Coordinate(x, y);\n    return this.xy_;\n  }\n\n  /**\n   * Move a comment by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   * @internal\n   */\n  override moveBy(dx: number, dy: number) {\n    const event =\n        new (eventUtils.get(eventUtils.COMMENT_MOVE))(this) as CommentMove;\n    // TODO: Do I need to look up the relative to surface XY position here?\n    const xy = this.getRelativeToSurfaceXY();\n    this.translate(xy.x + dx, xy.y + dy);\n    this.xy_ = new Coordinate(xy.x + dx, xy.y + dy);\n    event.recordNew();\n    eventUtils.fire(event);\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a comment by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   * @internal\n   */\n  translate(x: number, y: number) {\n    this.xy_ = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute(\n        'transform', 'translate(' + x + ',' + y + ')');\n  }\n\n  /**\n   * Move this comment to its workspace's drag surface, accounting for\n   * positioning.  Generally should be called at the same time as\n   * setDragging(true).  Does nothing if useDragSurface_ is false.\n   *\n   * @internal\n   */\n  moveToDragSurface() {\n    if (!this.useDragSurface_) {\n      return;\n    }\n    // The translation for drag surface blocks,\n    // is equal to the current relative-to-surface position,\n    // to keep the position in sync as it move on/off the surface.\n    // This is in workspace coordinates.\n    const xy = this.getRelativeToSurfaceXY();\n    this.clearTransformAttributes_();\n    this.workspace.getBlockDragSurface()!.translateSurface(xy.x, xy.y);\n    // Execute the move on the top-level SVG component\n    this.workspace.getBlockDragSurface()!.setBlocksAndShow(this.getSvgRoot());\n  }\n\n  /**\n   * Move this comment during a drag, taking into account whether we are using a\n   * drag surface to translate blocks.\n   *\n   * @param dragSurface The surface that carries rendered items during a drag,\n   *     or null if no drag surface is in use.\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(dragSurface: BlockDragSurfaceSvg, newLoc: Coordinate) {\n    if (dragSurface) {\n      dragSurface.translateSurface(newLoc.x, newLoc.y);\n    } else {\n      const translation = `translate(${newLoc.x}, ${newLoc.y})`;\n      this.getSvgRoot().setAttribute('transform', translation);\n    }\n  }\n\n  /**\n   * Move the bubble group to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.translate(x, y);\n  }\n\n  /**\n   * Clear the comment of transform=\"...\" attributes.\n   * Used when the comment is switching from 3d to 2d transform or vice versa.\n   */\n  private clearTransformAttributes_() {\n    this.getSvgRoot().removeAttribute('transform');\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * comment.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   * @internal\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const commentBounds = this.getHeightWidth();\n    const top = blockXY.y;\n    const bottom = blockXY.y + commentBounds.height;\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - commentBounds.width;\n      // Add the width of the tab/puzzle piece knob to the x coordinate\n      // since X is the corner of the rectangle, not the whole puzzle piece.\n      right = blockXY.x;\n    } else {\n      // Subtract the width of the tab/puzzle piece knob to the x coordinate\n      // since X is the corner of the rectangle, not the whole puzzle piece.\n      left = blockXY.x;\n      right = blockXY.x + commentBounds.width;\n    }\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Add or remove the UI indicating if this comment is movable or not.\n   *\n   * @internal\n   */\n  updateMovable() {\n    if (this.isMovable()) {\n      dom.addClass(this.svgGroup_, 'blocklyDraggable');\n    } else {\n      dom.removeClass(this.svgGroup_, 'blocklyDraggable');\n    }\n  }\n\n  /**\n   * Set whether this comment is movable or not.\n   *\n   * @param movable True if movable.\n   * @internal\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.updateMovable();\n  }\n\n  /**\n   * Set whether this comment is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    if (this.textarea_) {\n      this.textarea_.readOnly = !editable;\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (adding) {\n      dom.addClass(this.getSvgRoot(), 'blocklyDragging');\n    } else {\n      dom.removeClass(this.getSvgRoot(), 'blocklyDragging');\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   * @internal\n   */\n  getSvgRoot(): SVGElement {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Returns this comment's text.\n   *\n   * @returns Comment text.\n   * @internal\n   */\n  override getContent(): string {\n    return this.textarea_ ? this.textarea_.value : this.content_;\n  }\n\n  /**\n   * Set this comment's content.\n   *\n   * @param content Comment content.\n   * @internal\n   */\n  override setContent(content: string) {\n    super.setContent(content);\n    if (this.textarea_) {\n      this.textarea_.value = content;\n    }\n  }\n\n  /**\n   * Update the cursor over this comment by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    if (enable) {\n      dom.addClass(this.svgGroup_, 'blocklyDraggingDelete');\n    } else {\n      dom.removeClass(this.svgGroup_, 'blocklyDraggingDelete');\n    }\n  }\n\n  /**\n   * Set whether auto-layout of this bubble is enabled.  The first time a bubble\n   * is shown it positions itself to not cover any blocks.  Once a user has\n   * dragged it to reposition, it renders where the user put it.\n   *\n   * @param _enable True if auto-layout should be enabled, false otherwise.\n   * @internal\n   */\n  setAutoLayout(_enable: boolean) {}\n  // NOP for compatibility with the bubble dragger.\n\n  /**\n   * Encode a comment subtree as XML with XY coordinates.\n   *\n   * @param opt_noId True if the encoder should skip the comment ID.\n   * @returns Tree of XML elements.\n   * @internal\n   */\n  override toXmlWithXY(opt_noId?: boolean): Element {\n    let width = 0;  // Not used in LTR.\n    if (this.workspace.RTL) {\n      // Here be performance dragons: This calls getMetrics().\n      width = this.workspace.getWidth();\n    }\n    const element = this.toXml(opt_noId);\n    const xy = this.getRelativeToSurfaceXY();\n    element.setAttribute(\n        'x', String(Math.round(this.workspace.RTL ? width - xy.x : xy.x)));\n    element.setAttribute('y', String(Math.round(xy.y)));\n    element.setAttribute('h', String(this.getHeight()));\n    element.setAttribute('w', String(this.getWidth()));\n    return element;\n  }\n\n  /**\n   * Encode a comment for copying.\n   *\n   * @returns Copy metadata.\n   * @internal\n   */\n  toCopyData(): CopyData {\n    return {\n      saveInfo: this.toXmlWithXY(),\n      source: this.workspace,\n      typeCounts: null,\n    };\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this comment.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number, width: number} {\n    return {width: this.getWidth(), height: this.getHeight()};\n  }\n\n  /**\n   * Renders the workspace comment.\n   *\n   * @internal\n   */\n  render() {\n    if (this.rendered_) {\n      return;\n    }\n\n    const size = this.getHeightWidth();\n\n    // Add text area\n    const foreignObject = this.createEditor_();\n    this.svgGroup_.appendChild(foreignObject);\n\n    this.svgHandleTarget_ = dom.createSvgElement(\n        Svg.RECT, {'class': 'blocklyCommentHandleTarget', 'x': 0, 'y': 0});\n    this.svgGroup_.appendChild(this.svgHandleTarget_);\n    this.svgRectTarget_ = dom.createSvgElement(Svg.RECT, {\n      'class': 'blocklyCommentTarget',\n      'x': 0,\n      'y': 0,\n      'rx': BORDER_RADIUS,\n      'ry': BORDER_RADIUS,\n    });\n    this.svgGroup_.appendChild(this.svgRectTarget_);\n\n    // Add the resize icon\n    this.addResizeDom_();\n    if (this.isDeletable()) {\n      // Add the delete icon\n      this.addDeleteDom_();\n    }\n\n    this.setSize_(size.width, size.height);\n\n    // Set the content\n    this.textarea_!.value = this.content_;\n\n    this.rendered_ = true;\n\n    if (this.resizeGroup_) {\n      browserEvents.conditionalBind(\n          (this.resizeGroup_), 'pointerdown', this, this.resizeMouseDown_);\n    }\n\n    if (this.isDeletable()) {\n      browserEvents.conditionalBind(\n          this.deleteGroup_ as SVGGElement, 'pointerdown', this,\n          this.deleteMouseDown_);\n      browserEvents.conditionalBind(\n          this.deleteGroup_ as SVGGElement, 'pointerout', this,\n          this.deleteMouseOut_);\n      browserEvents.conditionalBind(\n          this.deleteGroup_ as SVGGElement, 'pointerup', this,\n          this.deleteMouseUp_);\n    }\n  }\n\n  /**\n   * Create the text area for the comment.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor_(): Element {\n    /* Create the editor.  Here's the markup that will be generated:\n          <foreignObject class=\"blocklyCommentForeignObject\" x=\"0\" y=\"10\"\n          width=\"164\" height=\"164\"> <body xmlns=\"http://www.w3.org/1999/xhtml\"\n          class=\"blocklyMinimalBody\"> <textarea\n       xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyCommentTextarea\"\n                  style=\"height: 164px; width: 164px;\"></textarea>\n            </body>\n          </foreignObject>\n        */\n    this.foreignObject_ = dom.createSvgElement(Svg.FOREIGNOBJECT, {\n      'x': 0,\n      'y': WorkspaceCommentSvg.TOP_OFFSET,\n      'class': 'blocklyCommentForeignObject',\n    });\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n    const textarea = document.createElementNS(dom.HTML_NS, 'textarea') as\n        HTMLTextAreaElement;\n    textarea.className = 'blocklyCommentTextarea';\n    textarea.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    textarea.readOnly = !this.isEditable();\n    body.appendChild(textarea);\n    this.textarea_ = textarea;\n    this.foreignObject_.appendChild(body);\n    // Don't zoom with mousewheel.\n    browserEvents.conditionalBind(\n        textarea, 'wheel', this, function(e: WheelEvent) {\n          e.stopPropagation();\n        });\n    browserEvents.conditionalBind(\n        textarea, 'change', this,\n        function(this: WorkspaceCommentSvg, _e: Event) {\n          this.setContent(textarea.value);\n        });\n    return this.foreignObject_;\n  }\n\n  /** Add the resize icon to the DOM */\n  private addResizeDom_() {\n    this.resizeGroup_ = dom.createSvgElement(\n        Svg.G, {'class': this.RTL ? 'blocklyResizeSW' : 'blocklyResizeSE'},\n        this.svgGroup_);\n    dom.createSvgElement(\n        Svg.POLYGON, {\n          'points':\n              `0,${RESIZE_SIZE} ${RESIZE_SIZE},${RESIZE_SIZE} ${RESIZE_SIZE},0`,\n        },\n        this.resizeGroup_);\n    dom.createSvgElement(\n        Svg.LINE, {\n          'class': 'blocklyResizeLine',\n          'x1': RESIZE_SIZE / 3,\n          'y1': RESIZE_SIZE - 1,\n          'x2': RESIZE_SIZE - 1,\n          'y2': RESIZE_SIZE / 3,\n        },\n        this.resizeGroup_);\n    dom.createSvgElement(\n        Svg.LINE, {\n          'class': 'blocklyResizeLine',\n          'x1': RESIZE_SIZE * 2 / 3,\n          'y1': RESIZE_SIZE - 1,\n          'x2': RESIZE_SIZE - 1,\n          'y2': RESIZE_SIZE * 2 / 3,\n        },\n        this.resizeGroup_);\n  }\n\n  /** Add the delete icon to the DOM */\n  private addDeleteDom_() {\n    this.deleteGroup_ = dom.createSvgElement(\n        Svg.G, {'class': 'blocklyCommentDeleteIcon'}, this.svgGroup_);\n    this.deleteIconBorder_ = dom.createSvgElement(\n        Svg.CIRCLE,\n        {'class': 'blocklyDeleteIconShape', 'r': '7', 'cx': '7.5', 'cy': '7.5'},\n        this.deleteGroup_);\n    // x icon.\n    dom.createSvgElement(\n        Svg.LINE, {\n          'x1': '5',\n          'y1': '10',\n          'x2': '10',\n          'y2': '5',\n          'stroke': '#fff',\n          'stroke-width': '2',\n        },\n        this.deleteGroup_);\n    dom.createSvgElement(\n        Svg.LINE, {\n          'x1': '5',\n          'y1': '5',\n          'x2': '10',\n          'y2': '10',\n          'stroke': '#fff',\n          'stroke-width': '2',\n        },\n        this.deleteGroup_);\n  }\n\n  /**\n   * Handle a pointerdown on comment's resize corner.\n   *\n   * @param e Pointer down event.\n   */\n  private resizeMouseDown_(e: PointerEvent) {\n    this.unbindDragEvents_();\n    if (browserEvents.isRightButton(e)) {\n      // No right-click.\n      e.stopPropagation();\n      return;\n    }\n    // Left-click (or middle click)\n    this.workspace.startDrag(\n        e,\n        new Coordinate(\n            this.workspace.RTL ? -this.width_ : this.width_, this.height_));\n\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n        document, 'pointerup', this, this.resizeMouseUp_);\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n        document, 'pointermove', this, this.resizeMouseMove_);\n    this.workspace.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown on comment's delete icon.\n   *\n   * @param e Pointer down event.\n   */\n  private deleteMouseDown_(e: PointerEvent) {\n    // Highlight the delete icon.\n    if (this.deleteIconBorder_) {\n      dom.addClass(this.deleteIconBorder_, 'blocklyDeleteIconHighlighted');\n    }\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerout on comment's delete icon.\n   *\n   * @param _e Pointer out event.\n   */\n  private deleteMouseOut_(_e: PointerEvent) {\n    // Restore highlight on the delete icon.\n    if (this.deleteIconBorder_) {\n      dom.removeClass(this.deleteIconBorder_, 'blocklyDeleteIconHighlighted');\n    }\n  }\n\n  /**\n   * Handle a pointerup on comment's delete icon.\n   *\n   * @param e Pointer up event.\n   */\n  private deleteMouseUp_(e: PointerEvent) {\n    // Delete this comment.\n    this.dispose();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /** Stop binding to the global pointerup and pointermove events. */\n  private unbindDragEvents_() {\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Handle a pointerup event while dragging a comment's border or resize\n   * handle.\n   *\n   * @param _e Pointer up event.\n   */\n  private resizeMouseUp_(_e: PointerEvent) {\n    Touch.clearTouchIdentifier();\n    this.unbindDragEvents_();\n  }\n\n  /**\n   * Resize this comment to follow the pointer.\n   *\n   * @param e Pointer move event.\n   */\n  private resizeMouseMove_(e: PointerEvent) {\n    this.autoLayout_ = false;\n    const newXY = this.workspace.moveDrag(e);\n    this.setSize_(this.RTL ? -newXY.x : newXY.x, newXY.y);\n  }\n\n  /**\n   * Callback function triggered when the comment has resized.\n   * Resize the text area accordingly.\n   */\n  private resizeComment_() {\n    const size = this.getHeightWidth();\n    const topOffset = WorkspaceCommentSvg.TOP_OFFSET;\n    const textOffset = TEXTAREA_OFFSET * 2;\n\n    this.foreignObject_?.setAttribute('width', String(size.width));\n    this.foreignObject_?.setAttribute(\n        'height', String(size.height - topOffset));\n    if (this.RTL) {\n      this.foreignObject_?.setAttribute('x', String(-size.width));\n    }\n\n    if (!this.textarea_) return;\n    this.textarea_.style.width = size.width - textOffset + 'px';\n    this.textarea_.style.height = size.height - textOffset - topOffset + 'px';\n  }\n\n  /**\n   * Set size\n   *\n   * @param width width of the container\n   * @param height height of the container\n   */\n  private setSize_(width: number, height: number) {\n    // Minimum size of a comment.\n    width = Math.max(width, 45);\n    height = Math.max(height, 20 + WorkspaceCommentSvg.TOP_OFFSET);\n    this.width_ = width;\n    this.height_ = height;\n    this.svgRect_.setAttribute('width', `${width}`);\n    this.svgRect_.setAttribute('height', `${height}`);\n    this.svgRectTarget_?.setAttribute('width', `${width}`);\n    this.svgRectTarget_?.setAttribute('height', `${height}`);\n    this.svgHandleTarget_?.setAttribute('width', `${width}`);\n    this.svgHandleTarget_?.setAttribute(\n        'height', String(WorkspaceCommentSvg.TOP_OFFSET));\n    if (this.RTL) {\n      this.svgRect_.setAttribute('transform', 'scale(-1 1)');\n      this.svgRectTarget_?.setAttribute('transform', 'scale(-1 1)');\n    }\n\n    if (this.resizeGroup_) {\n      if (this.RTL) {\n        // Mirror the resize group.\n        this.resizeGroup_.setAttribute(\n            'transform',\n            'translate(' + (-width + RESIZE_SIZE) + ',' +\n                (height - RESIZE_SIZE) + ') scale(-1 1)');\n        this.deleteGroup_?.setAttribute(\n            'transform',\n            'translate(' + (-width + RESIZE_SIZE) + ',' + -RESIZE_SIZE +\n                ') scale(-1 1)');\n      } else {\n        this.resizeGroup_.setAttribute(\n            'transform',\n            'translate(' + (width - RESIZE_SIZE) + ',' +\n                (height - RESIZE_SIZE) + ')');\n        this.deleteGroup_?.setAttribute(\n            'transform',\n            'translate(' + (width - RESIZE_SIZE) + ',' + -RESIZE_SIZE + ')');\n      }\n    }\n\n    // Allow the contents to resize.\n    this.resizeComment_();\n  }\n\n  /** Dispose of any rendered comment components. */\n  private disposeInternal_() {\n    this.textarea_ = null;\n    this.foreignObject_ = null;\n    this.svgRectTarget_ = null;\n    this.svgHandleTarget_ = null;\n    this.disposed_ = true;\n  }\n\n  /**\n   * Set the focus on the text area.\n   *\n   * @internal\n   */\n  setFocus() {\n    this.focused_ = true;\n    // Defer CSS changes.\n    setTimeout(() => {\n      if (this.disposed_) {\n        return;\n      }\n      this.textarea_!.focus();\n      this.addFocus();\n      if (this.svgRectTarget_) {\n        dom.addClass(this.svgRectTarget_, 'blocklyCommentTargetFocused');\n      }\n      if (this.svgHandleTarget_) {\n        dom.addClass(\n            this.svgHandleTarget_, 'blocklyCommentHandleTargetFocused');\n      }\n    }, 0);\n  }\n\n  /**\n   * Remove focus from the text area.\n   *\n   * @internal\n   */\n  blurFocus() {\n    this.focused_ = false;\n    // Defer CSS changes.\n    setTimeout(() => {\n      if (this.disposed_) {\n        return;\n      }\n\n      this.textarea_!.blur();\n      this.removeFocus();\n      if (this.svgRectTarget_) {\n        dom.removeClass(this.svgRectTarget_, 'blocklyCommentTargetFocused');\n      }\n      if (this.svgHandleTarget_) {\n        dom.removeClass(\n            this.svgHandleTarget_, 'blocklyCommentHandleTargetFocused');\n      }\n    }, 0);\n  }\n\n  /**\n   * Decode an XML comment tag and create a rendered comment on the workspace.\n   *\n   * @param xmlComment XML comment element.\n   * @param workspace The workspace.\n   * @param opt_wsWidth The width of the workspace, which is used to position\n   *     comments correctly in RTL.\n   * @returns The created workspace comment.\n   * @internal\n   */\n  static fromXmlRendered(\n      xmlComment: Element, workspace: WorkspaceSvg,\n      opt_wsWidth?: number): WorkspaceCommentSvg {\n    eventUtils.disable();\n    let comment;\n    try {\n      const info = WorkspaceComment.parseAttributes(xmlComment);\n\n      comment = new WorkspaceCommentSvg(\n          workspace, info.content, info.h, info.w, info.id);\n      if (workspace.rendered) {\n        comment.initSvg(true);\n        comment.render();\n      }\n      // Position the comment correctly, taking into account the width of a\n      // rendered RTL workspace.\n      if (!isNaN(info.x) && !isNaN(info.y)) {\n        if (workspace.RTL) {\n          const wsWidth = opt_wsWidth || workspace.getWidth();\n          comment.moveBy(wsWidth - info.x, info.y);\n        } else {\n          comment.moveBy(info.x, info.y);\n        }\n      }\n    } finally {\n      eventUtils.enable();\n    }\n\n    WorkspaceComment.fireCreateEvent(comment);\n    return comment;\n  }\n}\n\n/** CSS for workspace comment.  See css.js for use. */\nCss.register(`\n.blocklyCommentForeignObject {\n  position: relative;\n  z-index: 0;\n}\n\n.blocklyCommentRect {\n  fill: #E7DE8E;\n  stroke: #bcA903;\n  stroke-width: 1px;\n}\n\n.blocklyCommentTarget {\n  fill: transparent;\n  stroke: #bcA903;\n}\n\n.blocklyCommentTargetFocused {\n  fill: none;\n}\n\n.blocklyCommentHandleTarget {\n  fill: none;\n}\n\n.blocklyCommentHandleTargetFocused {\n  fill: transparent;\n}\n\n.blocklyFocused>.blocklyCommentRect {\n  fill: #B9B272;\n  stroke: #B9B272;\n}\n\n.blocklySelected>.blocklyCommentTarget {\n  stroke: #fc3;\n  stroke-width: 3px;\n}\n\n.blocklyCommentDeleteIcon {\n  cursor: pointer;\n  fill: #000;\n  display: none;\n}\n\n.blocklySelected > .blocklyCommentDeleteIcon {\n  display: block;\n}\n\n.blocklyDeleteIconShape {\n  fill: #000;\n  stroke: #000;\n  stroke-width: 1px;\n}\n\n.blocklyDeleteIconShape.blocklyDeleteIconHighlighted {\n  stroke: #fc3;\n}\n`);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.exceptions');\n\nimport type {Block} from '../block.js';\nimport type {State} from './blocks.js';\n\n\nexport class DeserializationError extends Error {}\n\n/**\n * Represents an error where the serialized state is expected to provide a\n * block type, but it is not provided.\n *\n */\nexport class MissingBlockType extends DeserializationError {\n  /**\n   * @param state The state object which is missing the block type.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Expected to find a 'type' property, defining the block type`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a block that did\n * not have a connection that was defined in the serialized state.\n */\nexport class MissingConnection extends DeserializationError {\n  /**\n   * @param connection The name of the connection that is missing. E.g.\n   *     'IF0', or 'next'.\n   * @param block The block missing the connection.\n   * @param state The state object containing the bad connection.\n   * @internal\n   */\n  constructor(connection: string, public block: Block, public state: State) {\n    super(`The block ${block.toDevString()} is missing a(n) ${connection}\nconnection`);\n  }\n}\n\n/**\n * Represents an error where deserialization tried to connect two connections\n * that were not compatible.\n */\nexport class BadConnectionCheck extends DeserializationError {\n  /**\n   * @param reason The reason the connections were not compatible.\n   * @param childConnection The name of the incompatible child connection. E.g.\n   *     'output' or 'previous'.\n   * @param childBlock The child block that could not connect to its parent.\n   * @param childState The state object representing the child block.\n   * @internal\n   */\n  constructor(\n      reason: string, childConnection: string, public childBlock: Block,\n      public childState: State) {\n    super(`The block ${childBlock.toDevString()} could not connect its\n${childConnection} to its parent, because: ${reason}`);\n  }\n}\n\n/**\n * Represents an error where deserialization encountered a real block as it\n * was deserializing children of a shadow.\n * This is an error because it is an invariant of Blockly that shadow blocks\n * do not have real children.\n */\nexport class RealChildOfShadow extends DeserializationError {\n  /**\n   * @param state The state object representing the real block.\n   * @internal\n   */\n  constructor(public state: State) {\n    super(`Encountered a real block which is defined as a child of a shadow\nblock. It is an invariant of Blockly that shadow blocks only have shadow\nchildren`);\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.priorities');\n\n\n/**\n * The priority for deserializing variables.\n */\nexport const VARIABLES = 100;\n\n/**\n * The priority for deserializing variable data.\n */\nexport const PROCEDURES = 75;\n\n/**\n * The priority for deserializing blocks.\n */\nexport const BLOCKS = 50;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for all types of block events.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockBase');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport type {Workspace} from '../workspace.js';\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\n\n\n/**\n * Abstract class for any event related to blocks.\n */\nexport class BlockBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the block associated with this event. */\n  blockId?: string;\n\n  /**\n   * @param opt_block The block this event corresponds to.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_block?: Block) {\n    super();\n    this.isBlank = !opt_block;\n\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.workspaceId = opt_block.workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockBaseJson {\n    const json = super.toJson() as BlockBaseJson;\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockBaseJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockBase.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.blockId = json['blockId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockBase, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockBaseJson, workspace: Workspace, event?: any):\n      BlockBase {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockBase()) as BlockBase;\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport interface BlockBaseJson extends AbstractEventJson {\n  blockId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block creation event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockCreate');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * created.\n */\nexport class BlockCreate extends BlockBase {\n  override type = eventUtils.BLOCK_CREATE;\n\n  /** The XML representation of the created block(s). */\n  xml?: Element|DocumentFragment;\n\n  /** The JSON respresentation of the created block(s). */\n  json?: blocks.State;\n\n  /** All of the IDs of created blocks. */\n  ids?: string[];\n\n  /** @param opt_block The created block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.xml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n\n    this.json = blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockCreateJson {\n    const json = super.toJson() as BlockCreateJson;\n    if (!this.xml) {\n      throw new Error(\n          'The block XML is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.json) {\n      throw new Error(\n          'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    json['ids'] = this.ids;\n    json['json'] = this.json;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockCreateJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockCreate.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.xml = utilsXml.textToDom(json['xml']);\n    this.ids = json['ids'];\n    this.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      this.recordUndo = json['recordUndo'];\n    }\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockCreateJson, workspace: Workspace, event?: any):\n      BlockCreate {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockCreate()) as\n        BlockCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    newEvent.ids = json['ids'];\n    newEvent.json = json['json'] as blocks.State;\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.json) {\n      throw new Error(\n          'The block JSON is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      blocks.append(this.json, workspace);\n    } else {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn('Can\\'t uncreate non-existent block: ' + id);\n        }\n      }\n    }\n  }\n}\n\nexport interface BlockCreateJson extends BlockBaseJson {\n  xml: string;\n  ids: string[];\n  json: object;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CREATE, BlockCreate);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a finished loading workspace event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.FinishedLoading');\n\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Notifies listeners when the workspace has finished deserializing from\n * JSON/XML.\n */\nexport class FinishedLoading extends AbstractEvent {\n  override isBlank = true;\n  override recordUndo = false;\n  override type = eventUtils.FINISHED_LOADING;\n\n  /**\n   * @param opt_workspace The workspace that has finished loading.  Undefined\n   *     for a blank event.\n   */\n  constructor(opt_workspace?: Workspace) {\n    super();\n    this.isBlank = !!opt_workspace;\n\n    if (!opt_workspace) return;\n\n    this.workspaceId = opt_workspace.id;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): FinishedLoadingJson {\n    const json = super.toJson() as FinishedLoadingJson;\n    if (!this.workspaceId) {\n      throw new Error(\n          'The workspace ID is undefined. Either pass a workspace to ' +\n          'the constructor, or call fromJson');\n    }\n    json['workspaceId'] = this.workspaceId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: FinishedLoadingJson) {\n    super.fromJson(json);\n    this.workspaceId = json['workspaceId'];\n  }\n}\n\nexport interface FinishedLoadingJson extends AbstractEventJson {\n  workspaceId: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.FINISHED_LOADING, FinishedLoading);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * (Deprecated) Events fired as a result of UI actions in\n * Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Ui');\n\nimport type {Block} from '../block.js';\nimport * as registry from '../registry.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Class for a UI event.\n *\n * @deprecated December 2020. Instead use a more specific UI event.\n */\nexport class Ui extends UiBase {\n  blockId: AnyDuringMigration;\n  element: AnyDuringMigration;\n  oldValue: AnyDuringMigration;\n  newValue: AnyDuringMigration;\n  override type = eventUtils.UI;\n\n  /**\n   * @param opt_block The affected block.  Null for UI events that do not have\n   *     an associated block.  Undefined for a blank event.\n   * @param opt_element One of 'selected', 'comment', 'mutatorOpen', etc.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n      opt_block?: Block|null, opt_element?: string,\n      opt_oldValue?: AnyDuringMigration, opt_newValue?: AnyDuringMigration) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : null;\n    this.element = typeof opt_element === 'undefined' ? '' : opt_element;\n    this.oldValue = typeof opt_oldValue === 'undefined' ? '' : opt_oldValue;\n    this.newValue = typeof opt_newValue === 'undefined' ? '' : opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): AnyDuringMigration {\n    const json = super.toJson() as AnyDuringMigration;\n    json['element'] = this.element;\n    if (this.newValue !== undefined) {\n      json['newValue'] = this.newValue;\n    }\n    if (this.blockId) {\n      json['blockId'] = this.blockId;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: AnyDuringMigration) {\n    super.fromJson(json);\n    this.element = json['element'];\n    this.newValue = json['newValue'];\n    this.blockId = json['blockId'];\n  }\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.UI, Ui);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block change event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockChange');\n\nimport type {Block} from '../block.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport * as utilsXml from '../utils/xml.js';\nimport {Workspace} from '../workspace.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Notifies listeners when some element of a block has changed (e.g.\n * field values, comments, etc).\n */\nexport class BlockChange extends BlockBase {\n  override type = eventUtils.BLOCK_CHANGE;\n  /**\n   * The element that changed; one of 'field', 'comment', 'collapsed',\n   * 'disabled', 'inline', or 'mutation'\n   */\n  element?: string;\n\n  /** The name of the field that changed, if this is a change to a field. */\n  name?: string;\n\n  /** The original value of the element. */\n  oldValue: unknown;\n\n  /** The new value of the element. */\n  newValue: unknown;\n\n  /**\n   * @param opt_block The changed block.  Undefined for a blank event.\n   * @param opt_element One of 'field', 'comment', 'disabled', etc.\n   * @param opt_name Name of input or field affected, or null.\n   * @param opt_oldValue Previous value of element.\n   * @param opt_newValue New value of element.\n   */\n  constructor(\n      opt_block?: Block, opt_element?: string, opt_name?: string|null,\n      opt_oldValue?: unknown, opt_newValue?: unknown) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.element = opt_element;\n    this.name = opt_name || undefined;\n    this.oldValue = opt_oldValue;\n    this.newValue = opt_newValue;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockChangeJson {\n    const json = super.toJson() as BlockChangeJson;\n    if (!this.element) {\n      throw new Error(\n          'The changed element is undefined. Either pass an ' +\n          'element to the constructor, or call fromJson');\n    }\n    json['element'] = this.element;\n    json['name'] = this.name;\n    json['oldValue'] = this.oldValue;\n    json['newValue'] = this.newValue;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockChange.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.element = json['element'];\n    this.name = json['name'];\n    this.oldValue = json['oldValue'];\n    this.newValue = json['newValue'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockChangeJson, workspace: Workspace, event?: any):\n      BlockChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockChange()) as\n        BlockChange;\n    newEvent.element = json['element'];\n    newEvent.name = json['name'];\n    newEvent.oldValue = json['oldValue'];\n    newEvent.newValue = json['newValue'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldValue === this.newValue;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n          'The associated block is undefined. Either pass a ' +\n          'block to the constructor, or call fromJson');\n    }\n    // Assume the block is rendered so that then we can check.\n    const blockSvg = block as BlockSvg;\n    if (blockSvg.mutator) {\n      // Close the mutator (if open) since we don't want to update it.\n      blockSvg.mutator.setVisible(false);\n    }\n    const value = forward ? this.newValue : this.oldValue;\n    switch (this.element) {\n      case 'field': {\n        const field = block.getField(this.name!);\n        if (field) {\n          field.setValue(value);\n        } else {\n          console.warn('Can\\'t set non-existent field: ' + this.name);\n        }\n        break;\n      }\n      case 'comment':\n        block.setCommentText(value as string || null);\n        break;\n      case 'collapsed':\n        block.setCollapsed(!!value);\n        break;\n      case 'disabled':\n        block.setEnabled(!value);\n        break;\n      case 'inline':\n        block.setInputsInline(!!value);\n        break;\n      case 'mutation': {\n        const oldState = BlockChange.getExtraBlockState_(block as BlockSvg);\n        if (block.loadExtraState) {\n          block.loadExtraState(JSON.parse(value as string || '{}'));\n        } else if (block.domToMutation) {\n          block.domToMutation(\n              utilsXml.textToDom(value as string || '<mutation/>'));\n        }\n        eventUtils.fire(\n            new BlockChange(block, 'mutation', null, oldState, value));\n        break;\n      }\n      default:\n        console.warn('Unknown change type: ' + this.element);\n    }\n  }\n\n  // TODO (#5397): Encapsulate this in the BlocklyMutationChange event when\n  //    refactoring change events.\n  /**\n   * Returns the extra state of the given block (either as XML or a JSO,\n   * depending on the block's definition).\n   *\n   * @param block The block to get the extra state of.\n   * @returns A stringified version of the extra state of the given block.\n   * @internal\n   */\n  static getExtraBlockState_(block: BlockSvg): string {\n    if (block.saveExtraState) {\n      const state = block.saveExtraState();\n      return state ? JSON.stringify(state) : '';\n    } else if (block.mutationToDom) {\n      const state = block.mutationToDom();\n      return state ? Xml.domToText(state) : '';\n    }\n    return '';\n  }\n}\n\nexport interface BlockChangeJson extends BlockBaseJson {\n  element: string;\n  name?: string;\n  newValue: unknown;\n  oldValue: unknown;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CHANGE, BlockChange);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block delete event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockDelete');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport * as blocks from '../serialization/blocks.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners when a block (or connected stack of blocks) is\n * deleted.\n */\nexport class BlockDelete extends BlockBase {\n  /** The XML representation of the deleted block(s). */\n  oldXml?: Element|DocumentFragment;\n\n  /** The JSON respresentation of the deleted block(s). */\n  oldJson?: blocks.State;\n\n  /** All of the IDs of deleted blocks. */\n  ids?: string[];\n\n  /** True if the deleted block was a shadow block, false otherwise. */\n  wasShadow?: boolean;\n\n  override type = eventUtils.BLOCK_DELETE;\n\n  /** @param opt_block The deleted block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    if (opt_block.getParent()) {\n      throw Error('Connected blocks cannot be deleted.');\n    }\n    if (opt_block.isShadow()) {\n      // Respawning shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    this.oldXml = Xml.blockToDomWithXY(opt_block);\n    this.ids = eventUtils.getDescendantIds(opt_block);\n    this.wasShadow = opt_block.isShadow();\n    this.oldJson =\n        blocks.save(opt_block, {addCoordinates: true}) as blocks.State;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDeleteJson {\n    const json = super.toJson() as BlockDeleteJson;\n    if (!this.oldXml) {\n      throw new Error(\n          'The old block XML is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson');\n    }\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.wasShadow === undefined) {\n      throw new Error(\n          'Whether the block was a shadow is undefined. Either ' +\n          'pass a block to the constructor, or call fromJson');\n    }\n    if (!this.oldJson) {\n      throw new Error(\n          'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson');\n    }\n    json['oldXml'] = Xml.domToText(this.oldXml);\n    json['ids'] = this.ids;\n    json['wasShadow'] = this.wasShadow;\n    json['oldJson'] = this.oldJson;\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockDeleteJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockDelete.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldXml = utilsXml.textToDom(json['oldXml']);\n    this.ids = json['ids'];\n    this.wasShadow =\n        json['wasShadow'] || this.oldXml.tagName.toLowerCase() === 'shadow';\n    this.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      this.recordUndo = json['recordUndo'];\n    }\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockDeleteJson, workspace: Workspace, event?: any):\n      BlockDelete {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockDelete()) as\n        BlockDelete;\n    newEvent.oldXml = utilsXml.textToDom(json['oldXml']);\n    newEvent.ids = json['ids'];\n    newEvent.wasShadow =\n        json['wasShadow'] || newEvent.oldXml.tagName.toLowerCase() === 'shadow';\n    newEvent.oldJson = json['oldJson'];\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /**\n   * Run a deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.ids) {\n      throw new Error(\n          'The block IDs are undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.oldJson) {\n      throw new Error(\n          'The old block JSON is undefined. Either pass a block ' +\n          'to the constructor, or call fromJson');\n    }\n    if (forward) {\n      for (let i = 0; i < this.ids.length; i++) {\n        const id = this.ids[i];\n        const block = workspace.getBlockById(id);\n        if (block) {\n          block.dispose(false);\n        } else if (id === this.blockId) {\n          // Only complain about root-level block.\n          console.warn('Can\\'t delete non-existent block: ' + id);\n        }\n      }\n    } else {\n      blocks.append(this.oldJson, workspace);\n    }\n  }\n}\n\nexport interface BlockDeleteJson extends BlockBaseJson {\n  oldXml: string;\n  ids: string[];\n  wasShadow: boolean;\n  oldJson: blocks.State;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.DELETE, BlockDelete);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ConnectionType');\n\n\n/**\n * Enum for the type of a connection or input.\n */\nexport enum ConnectionType {\n  // A right-facing value input.  E.g. 'set item to' or 'return'.\n  INPUT_VALUE = 1,\n  // A left-facing value output.  E.g. 'random fraction'.\n  OUTPUT_VALUE,\n  // A down-facing block stack.  E.g. 'if-do' or 'else'.\n  NEXT_STATEMENT,\n  // An up-facing block stack.  E.g. 'break out of loop'.\n  PREVIOUS_STATEMENT\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.constants');\n\n\n/**\n * The language-neutral ID given to the collapsed input.\n */\nexport const COLLAPSED_INPUT_NAME = '_TEMP_COLLAPSED_INPUT';\n\n/**\n * The language-neutral ID given to the collapsed field.\n */\nexport const COLLAPSED_FIELD_NAME = '_TEMP_COLLAPSED_FIELD';\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of managing markers and the cursor.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.MarkerManager');\n\nimport type {Cursor} from './keyboard_nav/cursor.js';\nimport type {Marker} from './keyboard_nav/marker.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class to manage the multiple markers and the cursor on a workspace.\n */\nexport class MarkerManager {\n  /** The name of the local marker. */\n  static readonly LOCAL_MARKER = 'local_marker_1';\n\n  /** The cursor. */\n  private cursor_: Cursor|null = null;\n\n  /** The cursor's SVG element. */\n  private cursorSvg_: SVGElement|null = null;\n\n  /** The map of markers for the workspace. */\n  private markers = new Map<string, Marker>();\n\n  /** The marker's SVG element. */\n  private markerSvg_: SVGElement|null = null;\n\n  /**\n   * @param workspace The workspace for the marker manager.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Register the marker by adding it to the map of markers.\n   *\n   * @param id A unique identifier for the marker.\n   * @param marker The marker to register.\n   */\n  registerMarker(id: string, marker: Marker) {\n    if (this.markers.has(id)) {\n      this.unregisterMarker(id);\n    }\n    marker.setDrawer(\n        this.workspace.getRenderer().makeMarkerDrawer(this.workspace, marker));\n    this.setMarkerSvg(marker.getDrawer().createDom());\n    this.markers.set(id, marker);\n  }\n\n  /**\n   * Unregister the marker by removing it from the map of markers.\n   *\n   * @param id The ID of the marker to unregister.\n   */\n  unregisterMarker(id: string) {\n    const marker = this.markers.get(id);\n    if (marker) {\n      marker.dispose();\n      this.markers.delete(id);\n    } else {\n      throw Error(\n          'Marker with ID ' + id + ' does not exist. ' +\n          'Can only unregister markers that exist.');\n    }\n  }\n\n  /**\n   * Get the cursor for the workspace.\n   *\n   * @returns The cursor for this workspace.\n   */\n  getCursor(): Cursor|null {\n    return this.cursor_;\n  }\n\n  /**\n   * Get a single marker that corresponds to the given ID.\n   *\n   * @param id A unique identifier for the marker.\n   * @returns The marker that corresponds to the given ID, or null if none\n   *     exists.\n   */\n  getMarker(id: string): Marker|null {\n    return this.markers.get(id) || null;\n  }\n\n  /**\n   * Sets the cursor and initializes the drawer for use with keyboard\n   * navigation.\n   *\n   * @param cursor The cursor used to move around this workspace.\n   */\n  setCursor(cursor: Cursor) {\n    if (this.cursor_ && this.cursor_.getDrawer()) {\n      this.cursor_.getDrawer().dispose();\n    }\n    this.cursor_ = cursor;\n    if (this.cursor_) {\n      const drawer = this.workspace.getRenderer().makeMarkerDrawer(\n          this.workspace, this.cursor_);\n      this.cursor_.setDrawer(drawer);\n      this.setCursorSvg(this.cursor_.getDrawer().createDom());\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this workspace SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement|null) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    this.workspace.getBlockCanvas()!.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this workspaces SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the workspace\n   *     SVG group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement|null) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (this.workspace.getBlockCanvas()) {\n      if (this.cursorSvg_) {\n        this.workspace.getBlockCanvas()!.insertBefore(\n            markerSvg, this.cursorSvg_);\n      } else {\n        this.workspace.getBlockCanvas()!.appendChild(markerSvg);\n      }\n    }\n  }\n\n  /**\n   * Redraw the attached cursor SVG if needed.\n   *\n   * @internal\n   */\n  updateMarkers() {\n    if (this.workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      this.workspace.getCursor()!.draw();\n    }\n  }\n\n  /**\n   * Dispose of the marker manager.\n   * Go through and delete all markers associated with this marker manager.\n   *\n   * @suppress {checkTypes}\n   * @internal\n   */\n  dispose() {\n    const markerIds = Object.keys(this.markers);\n    for (let i = 0, markerId; markerId = markerIds[i]; i++) {\n      this.unregisterMarker(markerId);\n    }\n    this.markers.clear();\n    if (this.cursor_) {\n      this.cursor_.dispose();\n      this.cursor_ = null;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Field.  Used for editable titles, variables, etc.\n * This is an abstract class that defines the UI on the block.  Actual\n * instances would be FieldTextInput, FieldDropdown, etc.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Field');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Input} from './input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IASTNodeLocationWithBlock} from './interfaces/i_ast_node_location_with_block.js';\nimport type {IKeyboardAccessible} from './interfaces/i_keyboard_accessible.js';\nimport type {IRegistrable} from './interfaces/i_registrable.js';\nimport {MarkerManager} from './marker_manager.js';\nimport type {ConstantProvider} from './renderers/common/constants.js';\nimport type {KeyboardShortcut} from './shortcut_registry.js';\nimport * as Tooltip from './tooltip.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldValidator<T = any> = (newValue: T) => T|null|undefined;\n\n/**\n * Abstract class for an editable field.\n *\n * @typeParam T - The value stored on the field.\n */\nexport abstract class Field<T = any> implements IASTNodeLocationSvg,\n                                                IASTNodeLocationWithBlock,\n                                                IKeyboardAccessible,\n                                                IRegistrable {\n  /**\n   * To overwrite the default value which is set in **Field**, directly update\n   * the prototype.\n   *\n   * Example:\n   * ```typescript\n   * FieldImage.prototype.DEFAULT_VALUE = null;\n   * ```\n   */\n  DEFAULT_VALUE: T|null = null;\n\n  /** Non-breaking space. */\n  static readonly NBSP = '\\u00A0';\n\n  /**\n   * A value used to signal when a field's constructor should *not* set the\n   * field's value or run configure_, and should allow a subclass to do that\n   * instead.\n   */\n  static readonly SKIP_SETUP = Symbol('SKIP_SETUP');\n\n  /**\n   * Name of field.  Unique within each block.\n   * Static labels are usually unnamed.\n   */\n  name?: string = undefined;\n  protected value_: T|null;\n\n  /** Validation function called when user edits an editable field. */\n  protected validator_: FieldValidator<T>|null = null;\n\n  /**\n   * Used to cache the field's tooltip value if setTooltip is called when the\n   * field is not yet initialized. Is *not* guaranteed to be accurate.\n   */\n  private tooltip_: Tooltip.TipInfo|null = null;\n  protected size_: Size;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the field.\n   * This is null if there is no cursor on the field.\n   */\n  private cursorSvg_: SVGElement|null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the field.\n   * This is null if there is no marker on the field.\n   */\n  private markerSvg_: SVGElement|null = null;\n\n  /** The rendered field's SVG group element. */\n  protected fieldGroup_: SVGGElement|null = null;\n\n  /** The rendered field's SVG border element. */\n  protected borderRect_: SVGRectElement|null = null;\n\n  /** The rendered field's SVG text element. */\n  protected textElement_: SVGTextElement|null = null;\n\n  /** The rendered field's text content element. */\n  protected textContent_: Text|null = null;\n\n  /** Mouse down event listener data. */\n  private mouseDownWrapper_: browserEvents.Data|null = null;\n\n  /** Constants associated with the source block's renderer. */\n  protected constants_: ConstantProvider|null = null;\n\n  /**\n   * Has this field been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /** Maximum characters of text to display before adding an ellipsis. */\n  maxDisplayLength = 50;\n\n  /** Block this field is attached to.  Starts as null, then set in init. */\n  protected sourceBlock_: Block|null = null;\n\n  /** Does this block need to be re-rendered? */\n  protected isDirty_ = true;\n\n  /** Is the field visible, or hidden due to the block being collapsed? */\n  protected visible_ = true;\n\n  /**\n   * Can the field value be changed using the editor on an editable block?\n   */\n  protected enabled_ = true;\n\n  /** The element the click handler is bound to. */\n  protected clickTarget_: Element|null = null;\n\n  /**\n   * The prefix field.\n   *\n   * @internal\n   */\n  prefixField: string|null = null;\n\n  /**\n   * The suffix field.\n   *\n   * @internal\n   */\n  suffixField: string|null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. They will also be saved by the serializer.\n   */\n  EDITABLE = true;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable. This is not the\n   * case by default so that SERIALIZABLE is backwards compatible.\n   */\n  SERIALIZABLE = false;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  CURSOR = '';\n\n  /**\n   * @param value The initial value of the field.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value & returns a validated value, or null to\n   *     abort the change.\n   * @param config A map of options used to configure the field.\n   *    Refer to the individual field's documentation for a list of properties\n   * this parameter supports.\n   */\n  constructor(\n      value: T|typeof Field.SKIP_SETUP, validator?: FieldValidator<T>|null,\n      config?: FieldConfig) {\n    /**\n     * A generic value possessed by the field.\n     * Should generally be non-null, only null when the field is created.\n     */\n    this.value_ = 'DEFAULT_VALUE' in new.target.prototype ?\n        new.target.prototype.DEFAULT_VALUE :\n        this.DEFAULT_VALUE;\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Process the configuration map passed to the field.\n   *\n   * @param config A map of options used to configure the field. See the\n   *     individual field's documentation for a list of properties this\n   *     parameter supports.\n   */\n  protected configure_(config: FieldConfig) {\n    // TODO (#2884): Possibly add CSS class config option.\n    // TODO (#2885): Possibly add cursor config option.\n    if (config.tooltip) {\n      this.setTooltip(parsing.replaceMessageReferences(config.tooltip));\n    }\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  setSourceBlock(block: Block) {\n    if (this.sourceBlock_) {\n      throw Error('Field already bound to a block');\n    }\n    this.sourceBlock_ = block;\n  }\n\n  /**\n   * Get the renderer constant provider.\n   *\n   * @returns The renderer constant provider.\n   */\n  getConstants(): ConstantProvider|null {\n    if (!this.constants_ && this.sourceBlock_ &&\n        !this.sourceBlock_.isDeadOrDying() &&\n        this.sourceBlock_.workspace.rendered) {\n      this.constants_ = (this.sourceBlock_.workspace as WorkspaceSvg)\n                            .getRenderer()\n                            .getConstants();\n    }\n    return this.constants_;\n  }\n\n  /**\n   * Get the block this field is attached to.\n   *\n   * @returns The block containing this field.\n   * @throws An error if the source block is not defined.\n   */\n  getSourceBlock(): Block|null {\n    return this.sourceBlock_;\n  }\n\n  /**\n   * Initialize everything to render this field. Override\n   * methods initModel and initView rather than this method.\n   *\n   * @sealed\n   * @internal\n   */\n  init() {\n    if (this.fieldGroup_) {\n      // Field has already been initialized once.\n      return;\n    }\n    this.fieldGroup_ = dom.createSvgElement(Svg.G, {});\n    if (!this.isVisible()) {\n      this.fieldGroup_.style.display = 'none';\n    }\n    const sourceBlockSvg = this.sourceBlock_ as BlockSvg;\n    sourceBlockSvg.getSvgRoot().appendChild(this.fieldGroup_);\n    this.initView();\n    this.updateEditable();\n    this.setTooltip(this.tooltip_);\n    this.bindEvents_();\n    this.initModel();\n  }\n\n  /**\n   * Create the block UI for this field.\n   *\n   * @internal\n   */\n  initView() {\n    this.createBorderRect_();\n    this.createTextElement_();\n  }\n\n  /**\n   * Initializes the model of the field after it has been installed on a block.\n   * No-op by default.\n   *\n   * @internal\n   */\n  initModel() {}\n\n  /**\n   * Create a field border rect element. Not to be overridden by subclasses.\n   * Instead modify the result of the function inside initView, or create a\n   * separate function to call.\n   */\n  protected createBorderRect_() {\n    this.borderRect_ = dom.createSvgElement(\n        Svg.RECT, {\n          'rx': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n          'ry': this.getConstants()!.FIELD_BORDER_RECT_RADIUS,\n          'x': 0,\n          'y': 0,\n          'height': this.size_.height,\n          'width': this.size_.width,\n          'class': 'blocklyFieldRect',\n        },\n        this.fieldGroup_);\n  }\n\n  /**\n   * Create a field text element. Not to be overridden by subclasses. Instead\n   * modify the result of the function inside initView, or create a separate\n   * function to call.\n   */\n  protected createTextElement_() {\n    this.textElement_ = dom.createSvgElement(\n        Svg.TEXT, {\n          'class': 'blocklyText',\n        },\n        this.fieldGroup_);\n    if (this.getConstants()!.FIELD_TEXT_BASELINE_CENTER) {\n      this.textElement_.setAttribute('dominant-baseline', 'central');\n    }\n    this.textContent_ = document.createTextNode('');\n    this.textElement_.appendChild(this.textContent_);\n  }\n\n  /**\n   * Bind events to the field. Can be overridden by subclasses if they need to\n   * do custom input handling.\n   */\n  protected bindEvents_() {\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    Tooltip.bindMouseEvents(clickTarget);\n    this.mouseDownWrapper_ = browserEvents.conditionalBind(\n        clickTarget, 'pointerdown', this, this.onMouseDown_);\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  fromXml(fieldElement: Element) {\n    // Any because gremlins live here. No touchie!\n    this.setValue(fieldElement.textContent as any);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  toXml(fieldElement: Element): Element {\n    // Any because gremlins live here. No touchie!\n    fieldElement.textContent = this.getValue() as any;\n    return fieldElement;\n  }\n\n  /**\n   * Saves this fields value as something which can be serialized to JSON.\n   * Should only be called by the serialization system.\n   *\n   * @param _doFullSerialization If true, this signals to the field that if it\n   *     normally just saves a reference to some state (eg variable fields) it\n   *     should instead serialize the full state of the thing being referenced.\n   * @returns JSON serializable state.\n   * @internal\n   */\n  saveState(_doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(Field);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's state based on the given state value. Should only be\n   * called by the serialization system.\n   *\n   * @param state The state we want to apply to the field.\n   * @internal\n   */\n  loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Returns a stringified version of the XML state, if it should be used.\n   * Otherwise this returns null, to signal the field should use its own\n   * serialization.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @returns The stringified version of the XML state, or null.\n   */\n  protected saveLegacyState(callingClass: FieldProto): string|null {\n    if (callingClass.prototype.saveState === this.saveState &&\n        callingClass.prototype.toXml !== this.toXml) {\n      const elem = utilsXml.createElement('field');\n      elem.setAttribute('name', this.name || '');\n      const text = utilsXml.domToText(this.toXml(elem));\n      return text.replace(\n          ' xmlns=\"https://developers.google.com/blockly/xml\"', '');\n    }\n    // Either they called this on purpose from their saveState, or they have\n    // no implementations of either hook. Just do our thing.\n    return null;\n  }\n\n  /**\n   * Loads the given state using either the old XML hooks, if they should be\n   * used. Returns true to indicate loading has been handled, false otherwise.\n   *\n   * @param callingClass The class calling this method.\n   *     Used to see if `this` has overridden any relevant hooks.\n   * @param state The state to apply to the field.\n   * @returns Whether the state was applied or not.\n   */\n  loadLegacyState(callingClass: FieldProto, state: AnyDuringMigration):\n      boolean {\n    if (callingClass.prototype.loadState === this.loadState &&\n        callingClass.prototype.fromXml !== this.fromXml) {\n      this.fromXml(utilsXml.textToDom(state as string));\n      return true;\n    }\n    // Either they called this on purpose from their loadState, or they have\n    // no implementations of either hook. Just do our thing.\n    return false;\n  }\n\n  /**\n   * Dispose of all DOM objects and events belonging to this editable field.\n   *\n   * @internal\n   */\n  dispose() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hideIfOwner(this);\n\n    if (!this.getSourceBlock()?.isDeadOrDying()) {\n      dom.removeNode(this.fieldGroup_);\n    }\n\n    this.disposed = true;\n  }\n\n  /** Add or remove the UI indicating if this field is editable or not. */\n  updateEditable() {\n    const group = this.fieldGroup_;\n    const block = this.getSourceBlock();\n    if (!this.EDITABLE || !group || !block) {\n      return;\n    }\n    if (this.enabled_ && block.isEditable()) {\n      dom.addClass(group, 'blocklyEditableText');\n      dom.removeClass(group, 'blocklyNonEditableText');\n      group.style.cursor = this.CURSOR;\n    } else {\n      dom.addClass(group, 'blocklyNonEditableText');\n      dom.removeClass(group, 'blocklyEditableText');\n      group.style.cursor = '';\n    }\n  }\n\n  /**\n   * Set whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled_ = enabled;\n    this.updateEditable();\n  }\n\n  /**\n   * Check whether this field's value can be changed using the editor when the\n   *     source block is editable.\n   *\n   * @returns Whether this field is enabled.\n   */\n  isEnabled(): boolean {\n    return this.enabled_;\n  }\n\n  /**\n   * Check whether this field defines the showEditor_ function.\n   *\n   * @returns Whether this field is clickable.\n   */\n  isClickable(): boolean {\n    return this.enabled_ && !!this.sourceBlock_ &&\n        this.sourceBlock_.isEditable() &&\n        this.showEditor_ !== Field.prototype.showEditor_;\n  }\n\n  /**\n   * Check whether this field is currently editable.  Some fields are never\n   * EDITABLE (e.g. text labels). Other fields may be EDITABLE but may exist on\n   * non-editable blocks or be currently disabled.\n   *\n   * @returns Whether this field is currently enabled, editable and on an\n   *     editable block.\n   */\n  isCurrentlyEditable(): boolean {\n    return this.enabled_ && this.EDITABLE && !!this.sourceBlock_ &&\n        this.sourceBlock_.isEditable();\n  }\n\n  /**\n   * Check whether this field should be serialized by the XML renderer.\n   * Handles the logic for backwards compatibility and incongruous states.\n   *\n   * @returns Whether this field should be serialized or not.\n   */\n  isSerializable(): boolean {\n    let isSerializable = false;\n    if (this.name) {\n      if (this.SERIALIZABLE) {\n        isSerializable = true;\n      } else if (this.EDITABLE) {\n        console.warn(\n            'Detected an editable field that was not serializable.' +\n            ' Please define SERIALIZABLE property as true on all editable custom' +\n            ' fields. Proceeding with serialization.');\n        isSerializable = true;\n      }\n    }\n    return isSerializable;\n  }\n\n  /**\n   * Gets whether this editable field is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible_;\n  }\n\n  /**\n   * Sets whether this editable field is visible or not. Should only be called\n   * by input.setVisible.\n   *\n   * @param visible True if visible.\n   * @internal\n   */\n  setVisible(visible: boolean) {\n    if (this.visible_ === visible) {\n      return;\n    }\n    this.visible_ = visible;\n    const root = this.fieldGroup_;\n    if (root) {\n      root.style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Sets a new validation function for editable fields, or clears a previously\n   * set validator.\n   *\n   * The validator function takes in the new field value, and returns\n   * validated value. The validated value could be the input value, a modified\n   * version of the input value, or null to abort the change.\n   *\n   * If the function does not return anything (or returns undefined) the new\n   * value is accepted as valid. This is to allow for fields using the\n   * validated function as a field-level change event notification.\n   *\n   * @param handler The validator function or null to clear a previous\n   *     validator.\n   */\n  setValidator(handler: FieldValidator<T>) {\n    this.validator_ = handler;\n  }\n\n  /**\n   * Gets the validation function for editable fields, or null if not set.\n   *\n   * @returns Validation function, or null.\n   */\n  getValidator(): FieldValidator<T>|null {\n    return this.validator_;\n  }\n\n  /**\n   * Gets the group element for this editable field.\n   * Used for measuring the size and for positioning.\n   *\n   * @returns The group element.\n   */\n  getSvgRoot(): SVGGElement|null {\n    return this.fieldGroup_;\n  }\n\n  /**\n   * Gets the border rectangle element.\n   *\n   * @returns The border rectangle element.\n   * @throws An error if the border rectangle element is not defined.\n   */\n  protected getBorderRect(): SVGRectElement {\n    if (!this.borderRect_) {\n      throw new Error(`The border rectangle is ${this.borderRect_}.`);\n    }\n    return this.borderRect_;\n  }\n\n  /**\n   * Gets the text element.\n   *\n   * @returns The text element.\n   * @throws An error if the text element is not defined.\n   */\n  protected getTextElement(): SVGTextElement {\n    if (!this.textElement_) {\n      throw new Error(`The text element is ${this.textElement_}.`);\n    }\n    return this.textElement_;\n  }\n\n  /**\n   * Gets the text content.\n   *\n   * @returns The text content.\n   * @throws An error if the text content is not defined.\n   */\n  protected getTextContent(): Text {\n    if (!this.textContent_) {\n      throw new Error(`The text content is ${this.textContent_}.`);\n    }\n    return this.textContent_;\n  }\n\n  /**\n   * Updates the field to match the colour/style of the block. Should only be\n   * called by BlockSvg.applyColour().\n   *\n   * @internal\n   */\n  applyColour() {}\n  // Non-abstract sub-classes may wish to implement this. See FieldDropdown.\n\n  /**\n   * Used by getSize() to move/resize any DOM elements, and get the new size.\n   *\n   * All rendering that has an effect on the size/shape of the block should be\n   * done here, and should be triggered by getSize().\n   */\n  protected render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_();\n  }\n\n  /**\n   * Calls showEditor_ when the field is clicked if the field is clickable.\n   * Do not override.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @sealed\n   * @internal\n   */\n  showEditor(e?: Event) {\n    if (this.isClickable()) {\n      this.showEditor_(e);\n    }\n  }\n\n  /**\n   * A developer hook to create an editor for the field. This is no-op by\n   * default, and must be overriden to create an editor.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   */\n  protected showEditor_(_e?: Event): void {}\n  // NOP\n\n  /**\n   * Updates the size of the field based on the text.\n   *\n   * @param margin margin to use when positioning the text element.\n   */\n  protected updateSize_(margin?: number) {\n    const constants = this.getConstants();\n    const xOffset = margin !== undefined ? margin :\n        this.borderRect_ ? this.getConstants()!.FIELD_BORDER_RECT_X_PADDING :\n                           0;\n    let totalWidth = xOffset * 2;\n    let totalHeight = constants!.FIELD_TEXT_HEIGHT;\n\n    let contentWidth = 0;\n    if (this.textElement_) {\n      contentWidth = dom.getFastTextWidth(\n          this.textElement_, constants!.FIELD_TEXT_FONTSIZE,\n          constants!.FIELD_TEXT_FONTWEIGHT, constants!.FIELD_TEXT_FONTFAMILY);\n      totalWidth += contentWidth;\n    }\n    if (this.borderRect_) {\n      totalHeight = Math.max(totalHeight, constants!.FIELD_BORDER_RECT_HEIGHT);\n    }\n\n    this.size_.height = totalHeight;\n    this.size_.width = totalWidth;\n\n    this.positionTextElement_(xOffset, contentWidth);\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Position a field's text element after a size change.  This handles both LTR\n   * and RTL positioning.\n   *\n   * @param xOffset x offset to use when positioning the text element.\n   * @param contentWidth The content width.\n   */\n  protected positionTextElement_(xOffset: number, contentWidth: number) {\n    if (!this.textElement_) {\n      return;\n    }\n    const constants = this.getConstants();\n    const halfHeight = this.size_.height / 2;\n\n    this.textElement_.setAttribute(\n        'x',\n        String(\n            this.getSourceBlock()?.RTL ?\n                this.size_.width - contentWidth - xOffset :\n                xOffset));\n    this.textElement_.setAttribute(\n        'y',\n        String(\n            constants!.FIELD_TEXT_BASELINE_CENTER ?\n                halfHeight :\n                halfHeight - constants!.FIELD_TEXT_HEIGHT / 2 +\n                    constants!.FIELD_TEXT_BASELINE));\n  }\n\n  /** Position a field's border rect after a size change. */\n  protected positionBorderRect_() {\n    if (!this.borderRect_) {\n      return;\n    }\n    this.borderRect_.setAttribute('width', String(this.size_.width));\n    this.borderRect_.setAttribute('height', String(this.size_.height));\n    this.borderRect_.setAttribute(\n        'rx', String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS));\n    this.borderRect_.setAttribute(\n        'ry', String(this.getConstants()!.FIELD_BORDER_RECT_RADIUS));\n  }\n\n  /**\n   * Returns the height and width of the field.\n   *\n   * This should *in general* be the only place render_ gets called from.\n   *\n   * @returns Height and width.\n   */\n  getSize(): Size {\n    if (!this.isVisible()) {\n      return new Size(0, 0);\n    }\n\n    if (this.isDirty_) {\n      this.render_();\n      this.isDirty_ = false;\n    } else if (this.visible_ && this.size_.width === 0) {\n      // If the field is not visible the width will be 0 as well, one of the\n      // problems with the old system.\n      this.render_();\n      // Don't issue a warning if the field is actually zero width.\n      if (this.size_.width !== 0) {\n        console.warn(\n            'Deprecated use of setting size_.width to 0 to rerender a' +\n            ' field. Set field.isDirty_ to true instead.');\n      }\n    }\n    return this.size_;\n  }\n\n  /**\n   * Returns the bounding box of the rendered field, accounting for workspace\n   * scaling.\n   *\n   * @returns An object with top, bottom, left, and right in pixels relative to\n   *     the top left corner of the page (window coordinates).\n   * @internal\n   */\n  getScaledBBox(): Rect {\n    let scaledWidth;\n    let scaledHeight;\n    let xy;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    if (!this.borderRect_) {\n      // Browsers are inconsistent in what they return for a bounding box.\n      // - Webkit / Blink: fill-box / object bounding box\n      // - Gecko: stroke-box\n      const bBox = (this.sourceBlock_ as BlockSvg).getHeightWidth();\n      const scale = (block.workspace as WorkspaceSvg).scale;\n      xy = this.getAbsoluteXY_();\n      scaledWidth = (bBox.width + 1) * scale;\n      scaledHeight = (bBox.height + 1) * scale;\n\n      if (userAgent.GECKO) {\n        xy.x += 1.5 * scale;\n        xy.y += 1.5 * scale;\n      } else {\n        xy.x -= 0.5 * scale;\n        xy.y -= 0.5 * scale;\n      }\n    } else {\n      const bBox = this.borderRect_.getBoundingClientRect();\n      xy = style.getPageOffset(this.borderRect_);\n      scaledWidth = bBox.width;\n      scaledHeight = bBox.height;\n    }\n    return new Rect(xy.y, xy.y + scaledHeight, xy.x, xy.x + scaledWidth);\n  }\n\n  /**\n   * Get the text from this field to display on the block. May differ from\n   * `getText` due to ellipsis, and other formatting.\n   *\n   * @returns Text to display.\n   */\n  protected getDisplayText_(): string {\n    let text = this.getText();\n    if (!text) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    if (text.length > this.maxDisplayLength) {\n      // Truncate displayed string and add an ellipsis ('...').\n      text = text.substring(0, this.maxDisplayLength - 2) + '';\n    }\n    // Replace whitespace with non-breaking spaces so the text doesn't collapse.\n    text = text.replace(/\\s/g, Field.NBSP);\n    if (this.sourceBlock_ && this.sourceBlock_.RTL) {\n      // The SVG is LTR, force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    return text;\n  }\n\n  /**\n   * Get the text from this field.\n   * Override getText_ to provide a different behavior than simply casting the\n   * value to a string.\n   *\n   * @returns Current text.\n   * @sealed\n   */\n  getText(): string {\n    // this.getText_ was intended so that devs don't have to remember to call\n    // super when overriding how the text of the field is generated. (#2910)\n    const text = this.getText_();\n    if (text !== null) {\n      return String(text);\n    }\n    return String(this.getValue());\n  }\n\n  /**\n   * A developer hook to override the returned text of this field.\n   * Override if the text representation of the value of this field\n   * is not just a string cast of its value.\n   * Return null to resort to a string cast.\n   *\n   * @returns Current text or null.\n   */\n  protected getText_(): string|null {\n    return null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  markDirty() {\n    this.isDirty_ = true;\n    this.constants_ = null;\n  }\n\n  /**\n   * Force a rerender of the block that this field is installed on, which will\n   * rerender this field and adjust for any sizing changes.\n   * Other fields on the same block will not rerender, because their sizes have\n   * already been recorded.\n   *\n   * @internal\n   */\n  forceRerender() {\n    this.isDirty_ = true;\n    if (this.sourceBlock_ && this.sourceBlock_.rendered) {\n      (this.sourceBlock_ as BlockSvg).queueRender();\n      (this.sourceBlock_ as BlockSvg).bumpNeighbours();\n    }\n  }\n\n  /**\n   * Used to change the value of the field. Handles validation and events.\n   * Subclasses should override doClassValidation_ and doValueUpdate_ rather\n   * than this method.\n   *\n   * @param newValue New value.\n   * @sealed\n   */\n  setValue(newValue: AnyDuringMigration) {\n    const doLogging = false;\n    if (newValue === null) {\n      doLogging && console.log('null, return');\n      // Not a valid value to check.\n      return;\n    }\n\n    const classValidation = this.doClassValidation_(newValue);\n    const classValue = this.processValidation_(newValue, classValidation);\n    if (classValue instanceof Error) {\n      doLogging && console.log('invalid class validation, return');\n      return;\n    }\n\n    const localValidation = this.getValidator()?.call(this, classValue);\n    const localValue = this.processValidation_(classValue, localValidation);\n    if (localValue instanceof Error) {\n      doLogging && console.log('invalid local validation, return');\n      return;\n    }\n\n    const source = this.sourceBlock_;\n    if (source && source.disposed) {\n      doLogging && console.log('source disposed, return');\n      return;\n    }\n\n    const oldValue = this.getValue();\n    if (oldValue === localValue) {\n      doLogging && console.log('same, doValueUpdate_, return');\n      this.doValueUpdate_(localValue);\n      return;\n    }\n\n    this.doValueUpdate_(localValue);\n    if (source && eventUtils.isEnabled()) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          source, 'field', this.name || null, oldValue, localValue));\n    }\n    if (this.isDirty_) {\n      this.forceRerender();\n    }\n    doLogging && console.log(this.value_);\n  }\n\n  /**\n   * Process the result of validation.\n   *\n   * @param newValue New value.\n   * @param validatedValue Validated value.\n   * @returns New value, or an Error object.\n   */\n  private processValidation_(\n      newValue: AnyDuringMigration, validatedValue: T|null|undefined): T|Error {\n    if (validatedValue === null) {\n      this.doValueInvalid_(newValue);\n      if (this.isDirty_) {\n        this.forceRerender();\n      }\n      return Error();\n    }\n    return validatedValue === undefined ? newValue as T : validatedValue;\n  }\n\n  /**\n   * Get the current value of the field.\n   *\n   * @returns Current value.\n   */\n  getValue(): T|null {\n    return this.value_;\n  }\n\n  /**\n   * Validate the changes to a field's value before they are set. See\n   * **FieldDropdown** for an example of subclass implementation.\n   *\n   * **NOTE:** Validation returns one option between `T`, `null`, and\n   * `undefined`. **Field**'s implementation will never return `undefined`, but\n   * it is valid for a subclass to return `undefined` if the new value is\n   * compatible with `T`.\n   *\n   * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n   * @param newValue - The value to be validated.\n   * @returns One of three instructions for setting the new value: `T`, `null`,\n   * or `undefined`.\n   *\n   * - `T` to set this function's returned value instead of `newValue`.\n   *\n   * - `null` to invoke `doValueInvalid_` and not set a value.\n   *\n   * - `undefined` to set `newValue` as is.\n   */\n  protected doClassValidation_(newValue: T): T|null|undefined;\n  protected doClassValidation_(newValue?: AnyDuringMigration): T|null;\n  protected doClassValidation_(newValue?: T|AnyDuringMigration): T|null\n      |undefined {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n\n    return newValue as T;\n  }\n\n  /**\n   * Used to update the value of a field. Can be overridden by subclasses to do\n   * custom storage of values/updating of external things.\n   *\n   * @param newValue The value to be saved.\n   */\n  protected doValueUpdate_(newValue: T) {\n    this.value_ = newValue;\n    this.isDirty_ = true;\n  }\n\n  /**\n   * Used to notify the field an invalid value was input. Can be overridden by\n   * subclasses, see FieldTextInput.\n   * No-op by default.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   */\n  protected doValueInvalid_(_invalidValue: AnyDuringMigration) {}\n  // NOP\n\n  /**\n   * Handle a pointerdown event on a field.\n   *\n   * @param e Pointer down event.\n   */\n  protected onMouseDown_(e: PointerEvent) {\n    if (!this.sourceBlock_ || this.sourceBlock_.isDeadOrDying()) {\n      return;\n    }\n    const gesture = (this.sourceBlock_.workspace as WorkspaceSvg).getGesture(e);\n    if (gesture) {\n      gesture.setStartField(this);\n    }\n  }\n\n  /**\n   * Sets the tooltip for this field.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, a parent object whose tooltip will be used, or null to\n   *     display the tooltip of the parent block. To not display a tooltip pass\n   *     the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo|null) {\n    if (!newTip && newTip !== '') {  // If null or undefined.\n      newTip = this.sourceBlock_;\n    }\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      (clickTarget as AnyDuringMigration).tooltip = newTip;\n    } else {\n      // Field has not been initialized yet.\n      this.tooltip_ = newTip;\n    }\n  }\n\n  /**\n   * Returns the tooltip text for this field.\n   *\n   * @returns The tooltip text for this field.\n   */\n  getTooltip(): string {\n    const clickTarget = this.getClickTarget_();\n    if (clickTarget) {\n      return Tooltip.getTooltipOfObject(clickTarget);\n    }\n    // Field has not been initialized yet. Return stashed this.tooltip_ value.\n    return Tooltip.getTooltipOfObject({tooltip: this.tooltip_});\n  }\n\n  /**\n   * The element to bind the click handler to. If not set explicitly, defaults\n   * to the SVG root of the field. When this element is\n   * clicked on an editable field, the editor will open.\n   *\n   * @returns Element to bind click handler to.\n   */\n  protected getClickTarget_(): Element|null {\n    return this.clickTarget_ || this.getSvgRoot();\n  }\n\n  /**\n   * Return the absolute coordinates of the top-left corner of this field.\n   * The origin (0,0) is the top-left corner of the page body.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  protected getAbsoluteXY_(): Coordinate {\n    return style.getPageOffset(this.getClickTarget_() as SVGRectElement);\n  }\n\n  /**\n   * Whether this field references any Blockly variables.  If true it may need\n   * to be handled differently during serialization and deserialization.\n   * Subclasses may override this.\n   *\n   * @returns True if this field has any variable references.\n   * @internal\n   */\n  referencesVariables(): boolean {\n    return false;\n  }\n\n  /**\n   * Refresh the variable name referenced by this field if this field references\n   * variables.\n   *\n   * @internal\n   */\n  refreshVariableName() {}\n  // NOP\n\n  /**\n   * Search through the list of inputs and their fields in order to find the\n   * parent input of a field.\n   *\n   * @returns The input that the field belongs to.\n   * @internal\n   */\n  getParentInput(): Input {\n    let parentInput = null;\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const inputs = block.inputList;\n\n    for (let idx = 0; idx < block.inputList.length; idx++) {\n      const input = inputs[idx];\n      const fieldRows = input.fieldRow;\n      for (let j = 0; j < fieldRows.length; j++) {\n        if (fieldRows[j] === this) {\n          parentInput = input;\n          break;\n        }\n      }\n    }\n    return parentInput!;\n  }\n\n  /**\n   * Returns whether or not we should flip the field in RTL.\n   *\n   * @returns True if we should flip in RTL.\n   */\n  getFlipRtl(): boolean {\n    return false;\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  isTabNavigable(): boolean {\n    return false;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /**\n   * Add the cursor SVG to this fields SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the field group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(cursorSvg);\n    this.cursorSvg_ = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this fields SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the field group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg_ = null;\n      return;\n    }\n\n    if (!this.fieldGroup_) {\n      throw new Error(`The field group is ${this.fieldGroup_}.`);\n    }\n    this.fieldGroup_.appendChild(markerSvg);\n    this.markerSvg_ = markerSvg;\n  }\n\n  /**\n   * Redraw any attached marker or cursor svgs if needed.\n   *\n   * @internal\n   */\n  updateMarkers_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const workspace = block.workspace as WorkspaceSvg;\n    if (workspace.keyboardAccessibilityMode && this.cursorSvg_) {\n      workspace.getCursor()!.draw();\n    }\n    if (workspace.keyboardAccessibilityMode && this.markerSvg_) {\n      // TODO(#4592): Update all markers on the field.\n      workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n  }\n}\n\n/**\n * Extra configuration options for the base field.\n */\nexport interface FieldConfig {\n  tooltip?: string;\n}\n\n/**\n * For use by Field and descendants of Field. Constructors can change\n * in descendants, though they should contain all of Field's prototype methods.\n *\n * @internal\n */\nexport type FieldProto = Pick<typeof Field, 'prototype'>;\n\n/**\n * Represents an error where the field is trying to access its block or\n * information about its block before it has actually been attached to said\n * block.\n */\nexport class UnattachedFieldError extends Error {\n  /** @internal */\n  constructor() {\n    super(\n        'The field has not yet been attached to its input. ' +\n        'Call appendField to attach it.');\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu similar to Closure's goog.ui.Menu\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Menu');\n\nimport * as browserEvents from './browser_events.js';\nimport type {MenuItem} from './menuitem.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Size} from './utils/size.js';\nimport * as style from './utils/style.js';\n\n\n/**\n * A basic menu class.\n */\nexport class Menu {\n  /**\n   * Array of menu items.\n   * (Nulls are never in the array, but typing the array as nullable prevents\n   * the compiler from objecting to .indexOf(null))\n   */\n  private readonly menuItems: MenuItem[] = [];\n\n  /**\n   * Coordinates of the mousedown event that caused this menu to open. Used to\n   * prevent the consequent mouseup event due to a simple click from\n   * activating a menu item immediately.\n   */\n  openingCoords: Coordinate|null = null;\n\n  /**\n   * This is the element that we will listen to the real focus events on.\n   * A value of null means no menu item is highlighted.\n   */\n  private highlightedItem: MenuItem|null = null;\n\n  /** Mouse over event data. */\n  private mouseOverHandler: browserEvents.Data|null = null;\n\n  /** Click event data. */\n  private clickHandler: browserEvents.Data|null = null;\n\n  /** Mouse enter event data. */\n  private mouseEnterHandler: browserEvents.Data|null = null;\n\n  /** Mouse leave event data. */\n  private mouseLeaveHandler: browserEvents.Data|null = null;\n\n  /** Key down event data. */\n  private onKeyDownHandler: browserEvents.Data|null = null;\n\n  /** The menu's root DOM element. */\n  private element: HTMLDivElement|null = null;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role|null = null;\n\n  /** Constructs a new Menu instance. */\n  constructor() {}\n\n  /**\n   * Add a new menu item to the bottom of this menu.\n   *\n   * @param menuItem Menu item to append.\n   * @internal\n   */\n  addChild(menuItem: MenuItem) {\n    this.menuItems.push(menuItem);\n  }\n\n  /**\n   * Creates the menu DOM.\n   *\n   * @param container Element upon which to append this menu.\n   * @returns The menu's root DOM element.\n   */\n  render(container: Element): HTMLDivElement {\n    const element = (document.createElement('div'));\n    // goog-menu is deprecated, use blocklyMenu.  May 2020.\n    element.className = 'blocklyMenu goog-menu blocklyNonSelectable';\n    element.tabIndex = 0;\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    this.element = element;\n\n    // Add menu items.\n    for (let i = 0, menuItem; menuItem = this.menuItems[i]; i++) {\n      element.appendChild(menuItem.createDom());\n    }\n\n    // Add event handlers.\n    this.mouseOverHandler = browserEvents.conditionalBind(\n        element, 'pointerover', this, this.handleMouseOver, true);\n    this.clickHandler = browserEvents.conditionalBind(\n        element, 'pointerup', this, this.handleClick, true);\n    this.mouseEnterHandler = browserEvents.conditionalBind(\n        element, 'pointerenter', this, this.handleMouseEnter, true);\n    this.mouseLeaveHandler = browserEvents.conditionalBind(\n        element, 'pointerleave', this, this.handleMouseLeave, true);\n    this.onKeyDownHandler = browserEvents.conditionalBind(\n        element, 'keydown', this, this.handleKeyEvent);\n\n    container.appendChild(element);\n    return element;\n  }\n\n  /**\n   * Gets the menu's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): HTMLDivElement|null {\n    return this.element;\n  }\n\n  /**\n   * Focus the menu element.\n   *\n   * @internal\n   */\n  focus() {\n    const el = this.getElement();\n    if (el) {\n      el.focus({preventScroll: true});\n      dom.addClass(el, 'blocklyFocused');\n    }\n  }\n\n  /** Blur the menu element. */\n  private blur() {\n    const el = this.getElement();\n    if (el) {\n      el.blur();\n      dom.removeClass(el, 'blocklyFocused');\n    }\n  }\n\n  /**\n   * Set the menu accessibility role.\n   *\n   * @param roleName role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /** Dispose of this menu. */\n  dispose() {\n    // Remove event handlers.\n    if (this.mouseOverHandler) {\n      browserEvents.unbind(this.mouseOverHandler);\n      this.mouseOverHandler = null;\n    }\n    if (this.clickHandler) {\n      browserEvents.unbind(this.clickHandler);\n      this.clickHandler = null;\n    }\n    if (this.mouseEnterHandler) {\n      browserEvents.unbind(this.mouseEnterHandler);\n      this.mouseEnterHandler = null;\n    }\n    if (this.mouseLeaveHandler) {\n      browserEvents.unbind(this.mouseLeaveHandler);\n      this.mouseLeaveHandler = null;\n    }\n    if (this.onKeyDownHandler) {\n      browserEvents.unbind(this.onKeyDownHandler);\n      this.onKeyDownHandler = null;\n    }\n\n    // Remove menu items.\n    for (let i = 0, menuItem; menuItem = this.menuItems[i]; i++) {\n      menuItem.dispose();\n    }\n    this.element = null;\n  }\n\n  // Child component management.\n\n  /**\n   * Returns the child menu item that owns the given DOM element,\n   * or null if no such menu item is found.\n   *\n   * @param elem DOM element whose owner is to be returned.\n   * @returns Menu item for which the DOM element belongs to.\n   */\n  private getMenuItem(elem: Element): MenuItem|null {\n    const menuElem = this.getElement();\n    // Node might be the menu border (resulting in no associated menu item), or\n    // a menu item's div, or some element within the menu item.\n    // Walk up parents until one meets either the menu's root element, or\n    // a menu item's div.\n    let currentElement: Element|null = elem;\n    while (currentElement && currentElement !== menuElem) {\n      if (currentElement.classList.contains('blocklyMenuItem')) {\n        // Having found a menu item's div, locate that menu item in this menu.\n        for (let i = 0, menuItem; menuItem = this.menuItems[i]; i++) {\n          if (menuItem.getElement() === currentElement) {\n            return menuItem;\n          }\n        }\n      }\n      currentElement = currentElement.parentElement;\n    }\n    return null;\n  }\n\n  // Highlight management.\n\n  /**\n   * Highlights the given menu item, or clears highlighting if null.\n   *\n   * @param item Item to highlight, or null.\n   * @internal\n   */\n  setHighlighted(item: MenuItem|null) {\n    const currentHighlighted = this.highlightedItem;\n    if (currentHighlighted) {\n      currentHighlighted.setHighlighted(false);\n      this.highlightedItem = null;\n    }\n    if (item) {\n      item.setHighlighted(true);\n      this.highlightedItem = item;\n      // Bring the highlighted item into view. This has no effect if the menu is\n      // not scrollable.\n      const el = this.getElement() as Element;\n      style.scrollIntoContainerView(item.getElement() as Element, el);\n\n      aria.setState(el, aria.State.ACTIVEDESCENDANT, item.getId());\n    }\n  }\n\n  /**\n   * Highlights the next highlightable item (or the first if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightNext() {\n    const index = this.highlightedItem ?\n        this.menuItems.indexOf(this.highlightedItem) :\n        -1;\n    this.highlightHelper(index, 1);\n  }\n\n  /**\n   * Highlights the previous highlightable item (or the last if nothing is\n   * currently highlighted).\n   *\n   * @internal\n   */\n  highlightPrevious() {\n    const index = this.highlightedItem ?\n        this.menuItems.indexOf(this.highlightedItem) :\n        -1;\n    this.highlightHelper(index < 0 ? this.menuItems.length : index, -1);\n  }\n\n  /** Highlights the first highlightable item. */\n  private highlightFirst() {\n    this.highlightHelper(-1, 1);\n  }\n\n  /** Highlights the last highlightable item. */\n  private highlightLast() {\n    this.highlightHelper(this.menuItems.length, -1);\n  }\n\n  /**\n   * Helper function that manages the details of moving the highlight among\n   * child menuitems in response to keyboard events.\n   *\n   * @param startIndex Start index.\n   * @param delta Step direction: 1 to go down, -1 to go up.\n   */\n  private highlightHelper(startIndex: number, delta: number) {\n    let index = startIndex + delta;\n    let menuItem;\n    while (menuItem = this.menuItems[index]) {\n      if (menuItem.isEnabled()) {\n        this.setHighlighted(menuItem);\n        break;\n      }\n      index += delta;\n    }\n  }\n\n  // Mouse events.\n\n  /**\n   * Handles mouseover events. Highlight menuitems as the user hovers over them.\n   *\n   * @param e Mouse event to handle.\n   */\n  private handleMouseOver(e: PointerEvent) {\n    const menuItem = this.getMenuItem(e.target as Element);\n\n    if (menuItem) {\n      if (menuItem.isEnabled()) {\n        if (this.highlightedItem !== menuItem) {\n          this.setHighlighted(menuItem);\n        }\n      } else {\n        this.setHighlighted(null);\n      }\n    }\n  }\n\n  /**\n   * Handles click events. Pass the event onto the child menuitem to handle.\n   *\n   * @param e Click event to handle.\n   */\n  private handleClick(e: PointerEvent) {\n    const oldCoords = this.openingCoords;\n    // Clear out the saved opening coords immediately so they're not used twice.\n    this.openingCoords = null;\n    if (oldCoords && typeof e.clientX === 'number') {\n      const newCoords = new Coordinate(e.clientX, e.clientY);\n      if (Coordinate.distance(oldCoords, newCoords) < 1) {\n        // This menu was opened by a mousedown and we're handling the consequent\n        // click event. The coords haven't changed, meaning this was the same\n        // opening event. Don't do the usual behavior because the menu just\n        // popped up under the mouse and the user didn't mean to activate this\n        // item.\n        return;\n      }\n    }\n\n    const menuItem = this.getMenuItem(e.target as Element);\n    if (menuItem) {\n      menuItem.performAction();\n    }\n  }\n\n  /**\n   * Handles mouse enter events. Focus the element.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseEnter(_e: PointerEvent) {\n    this.focus();\n  }\n\n  /**\n   * Handles mouse leave events. Blur and clear highlight.\n   *\n   * @param _e Mouse event to handle.\n   */\n  private handleMouseLeave(_e: PointerEvent) {\n    if (this.getElement()) {\n      this.blur();\n      this.setHighlighted(null);\n    }\n  }\n\n  // Keyboard events.\n\n  /**\n   * Attempts to handle a keyboard event, if the menu item is enabled, by\n   * calling\n   * {@link Menu#handleKeyEventInternal_}.\n   *\n   * @param e Key event to handle.\n   */\n  private handleKeyEvent(e: Event) {\n    if (!this.menuItems.length) {\n      // Empty menu.\n      return;\n    }\n    const keyboardEvent = e as KeyboardEvent;\n    if (keyboardEvent.shiftKey || keyboardEvent.ctrlKey ||\n        keyboardEvent.metaKey || keyboardEvent.altKey) {\n      // Do not handle the key event if any modifier key is pressed.\n      return;\n    }\n\n    const highlighted = this.highlightedItem;\n    switch (keyboardEvent.key) {\n      case 'Enter':\n      case ' ':\n        if (highlighted) {\n          highlighted.performAction();\n        }\n        break;\n\n      case 'ArrowUp':\n        this.highlightPrevious();\n        break;\n\n      case 'ArrowDown':\n        this.highlightNext();\n        break;\n\n      case 'PageUp':\n      case 'Home':\n        this.highlightFirst();\n        break;\n\n      case 'PageDown':\n      case 'End':\n        this.highlightLast();\n        break;\n\n      default:\n        // Not a key the menu is interested in.\n        return;\n    }\n    // The menu used this key, don't let it have secondary effects.\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Get the size of a rendered menu.\n   *\n   * @returns Object with width and height properties.\n   * @internal\n   */\n  getSize(): Size {\n    const menuDom = this.getElement() as HTMLDivElement;\n    const menuSize = style.getSize(menuDom);\n    // Recalculate height for the total content, not only box height.\n    menuSize.height = menuDom.scrollHeight;\n    return menuSize;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Blockly menu item similar to Closure's goog.ui.MenuItem\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.MenuItem');\n\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\n\n\n/**\n * Class representing an item in a menu.\n */\nexport class MenuItem {\n  /** Is the menu item clickable, as opposed to greyed-out. */\n  private enabled = true;\n\n  /** The DOM element for the menu item. */\n  private element: HTMLDivElement|null = null;\n\n  /** Whether the menu item is rendered right-to-left. */\n  private rightToLeft = false;\n\n  /** ARIA name for this menu. */\n  private roleName: aria.Role|null = null;\n\n  /** Is this menu item checkable. */\n  private checkable = false;\n\n  /** Is this menu item currently checked. */\n  private checked = false;\n\n  /** Is this menu item currently highlighted. */\n  private highlight = false;\n\n  /** Bound function to call when this menu item is clicked. */\n  private actionHandler: Function|null = null;\n\n  /**\n   * @param content Text caption to display as the content of the item, or a\n   *     HTML element to display.\n   * @param opt_value Data/model associated with the menu item.\n   */\n  constructor(\n      private readonly content: string|HTMLElement,\n      private readonly opt_value?: string) {}\n\n  /**\n   * Creates the menuitem's DOM.\n   *\n   * @returns Completed DOM.\n   */\n  createDom(): Element {\n    const element = (document.createElement('div'));\n    element.id = idGenerator.getNextUniqueId();\n    this.element = element;\n\n    // Set class and style\n    // goog-menuitem* is deprecated, use blocklyMenuItem*.  May 2020.\n    element.className = 'blocklyMenuItem goog-menuitem ' +\n        (this.enabled ? '' :\n                        'blocklyMenuItemDisabled goog-menuitem-disabled ') +\n        (this.checked ? 'blocklyMenuItemSelected goog-option-selected ' : '') +\n        (this.highlight ? 'blocklyMenuItemHighlight goog-menuitem-highlight ' :\n                          '') +\n        (this.rightToLeft ? 'blocklyMenuItemRtl goog-menuitem-rtl ' : '');\n\n    const content = (document.createElement('div'));\n    content.className = 'blocklyMenuItemContent goog-menuitem-content';\n    // Add a checkbox for checkable menu items.\n    if (this.checkable) {\n      const checkbox = (document.createElement('div'));\n      checkbox.className = 'blocklyMenuItemCheckbox goog-menuitem-checkbox';\n      content.appendChild(checkbox);\n    }\n\n    let contentDom: Node = this.content as HTMLElement;\n    if (typeof this.content === 'string') {\n      contentDom = document.createTextNode(this.content);\n    }\n    content.appendChild(contentDom);\n    element.appendChild(content);\n\n    // Initialize ARIA role and state.\n    if (this.roleName) {\n      aria.setRole(element, this.roleName);\n    }\n    aria.setState(\n        element, aria.State.SELECTED, this.checkable && this.checked || false);\n    aria.setState(element, aria.State.DISABLED, !this.enabled);\n\n    return element;\n  }\n\n  /** Dispose of this menu item. */\n  dispose() {\n    this.element = null;\n  }\n\n  /**\n   * Gets the menu item's element.\n   *\n   * @returns The DOM element.\n   * @internal\n   */\n  getElement(): Element|null {\n    return this.element;\n  }\n\n  /**\n   * Gets the unique ID for this menu item.\n   *\n   * @returns Unique component ID.\n   * @internal\n   */\n  getId(): string {\n    return this.element!.id;\n  }\n\n  /**\n   * Gets the value associated with the menu item.\n   *\n   * @returns value Value associated with the menu item.\n   * @internal\n   */\n  getValue(): string|null {\n    return this.opt_value ?? null;\n  }\n\n  /**\n   * Set menu item's rendering direction.\n   *\n   * @param rtl True if RTL, false if LTR.\n   * @internal\n   */\n  setRightToLeft(rtl: boolean) {\n    this.rightToLeft = rtl;\n  }\n\n  /**\n   * Set the menu item's accessibility role.\n   *\n   * @param roleName Role name.\n   * @internal\n   */\n  setRole(roleName: aria.Role) {\n    this.roleName = roleName;\n  }\n\n  /**\n   * Sets the menu item to be checkable or not. Set to true for menu items\n   * that represent checkable options.\n   *\n   * @param checkable Whether the menu item is checkable.\n   * @internal\n   */\n  setCheckable(checkable: boolean) {\n    this.checkable = checkable;\n  }\n\n  /**\n   * Checks or unchecks the component.\n   *\n   * @param checked Whether to check or uncheck the component.\n   * @internal\n   */\n  setChecked(checked: boolean) {\n    this.checked = checked;\n  }\n\n  /**\n   * Highlights or unhighlights the component.\n   *\n   * @param highlight Whether to highlight or unhighlight the component.\n   * @internal\n   */\n  setHighlighted(highlight: boolean) {\n    this.highlight = highlight;\n\n    const el = this.getElement();\n    if (el && this.isEnabled()) {\n      // goog-menuitem-highlight is deprecated, use blocklyMenuItemHighlight.\n      // May 2020.\n      const name = 'blocklyMenuItemHighlight';\n      const nameDep = 'goog-menuitem-highlight';\n      if (highlight) {\n        dom.addClass(el, name);\n        dom.addClass(el, nameDep);\n      } else {\n        dom.removeClass(el, name);\n        dom.removeClass(el, nameDep);\n      }\n    }\n  }\n\n  /**\n   * Returns true if the menu item is enabled, false otherwise.\n   *\n   * @returns Whether the menu item is enabled.\n   * @internal\n   */\n  isEnabled(): boolean {\n    return this.enabled;\n  }\n\n  /**\n   * Enables or disables the menu item.\n   *\n   * @param enabled Whether to enable or disable the menu item.\n   * @internal\n   */\n  setEnabled(enabled: boolean) {\n    this.enabled = enabled;\n  }\n\n  /**\n   * Performs the appropriate action when the menu item is activated\n   * by the user.\n   *\n   * @internal\n   */\n  performAction() {\n    if (this.isEnabled() && this.actionHandler) {\n      this.actionHandler(this);\n    }\n  }\n\n  /**\n   * Set the handler that's called when the menu item is activated by the user.\n   * `obj` will be used as the 'this' object in the function when called.\n   *\n   * @param fn The handler.\n   * @param obj Used as the 'this' object in fn when called.\n   * @internal\n   */\n  onAction(fn: (p1: MenuItem) => void, obj: object) {\n    this.actionHandler = fn.bind(obj);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of bubble open.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BubbleOpen');\n\nimport type {AbstractEventJson} from './events_abstract.js';\nimport type {BlockSvg} from '../block_svg.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Class for a bubble open event.\n */\nexport class BubbleOpen extends UiBase {\n  /** The ID of the block the bubble is attached to. */\n  blockId?: string;\n\n  /** True if the bubble is opening, false if closing. */\n  isOpen?: boolean;\n\n  /** The type of bubble; one of 'mutator', 'comment', or 'warning'. */\n  bubbleType?: BubbleType;\n\n  override type = eventUtils.BUBBLE_OPEN;\n\n  /**\n   * @param opt_block The associated block. Undefined for a blank event.\n   * @param opt_isOpen Whether the bubble is opening (false if closing).\n   *     Undefined for a blank event.\n   * @param opt_bubbleType The type of bubble. One of 'mutator', 'comment' or\n   *     'warning'. Undefined for a blank event.\n   */\n  constructor(\n      opt_block?: BlockSvg, opt_isOpen?: boolean, opt_bubbleType?: BubbleType) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isOpen = opt_isOpen;\n    this.bubbleType = opt_bubbleType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BubbleOpenJson {\n    const json = super.toJson() as BubbleOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n          'Whether this event is for opening the bubble is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson');\n    }\n    if (!this.bubbleType) {\n      throw new Error(\n          'The type of bubble is undefined. Either pass the ' +\n          'value to the constructor, or call fromJson');\n    }\n    json['isOpen'] = this.isOpen;\n    json['bubbleType'] = this.bubbleType;\n    json['blockId'] = this.blockId || '';\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BubbleOpenJson) {\n    deprecation.warn(\n        'Blockly.Events.BubbleOpen.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isOpen = json['isOpen'];\n    this.bubbleType = json['bubbleType'];\n    this.blockId = json['blockId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BubbleOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BubbleOpenJson, workspace: Workspace, event?: any):\n      BubbleOpen {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BubbleOpen()) as\n        BubbleOpen;\n    newEvent.isOpen = json['isOpen'];\n    newEvent.bubbleType = json['bubbleType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum BubbleType {\n  MUTATOR = 'mutator',\n  COMMENT = 'comment',\n  WARNING = 'warning',\n}\n\nexport interface BubbleOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n  bubbleType: BubbleType;\n  blockId: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BUBBLE_OPEN, BubbleOpen);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a scrollbar.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Scrollbar');\n\nimport * as browserEvents from './browser_events.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * A note on units: most of the numbers that are in CSS pixels are scaled if the\n * scrollbar is in a mutator.\n */\n\n/**\n * Class for a pure SVG scrollbar.\n * This technique offers a scrollbar that is guaranteed to work, but may not\n * look or behave like the system's scrollbars.\n */\nexport class Scrollbar {\n  /**\n   * Width of vertical scrollbar or height of horizontal scrollbar in CSS\n   * pixels. Scrollbars should be larger on touch devices.\n   */\n  static scrollbarThickness = Touch.TOUCH_ENABLED ? 25 : 15;\n\n  /**\n   * Default margin around the scrollbar (between the scrollbar and the edge of\n   * the viewport in pixels).\n   *\n   * @internal\n   */\n  static readonly DEFAULT_SCROLLBAR_MARGIN = 0.5;\n\n  /** Whether this scrollbar is part of a pair. */\n  private readonly pair: boolean;\n\n  /**\n   * Margin around the scrollbar (between the scrollbar and the edge of the\n   * viewport in pixels).\n   */\n  private readonly margin: number;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics: Metrics|null = null;\n\n  /**\n   * The ratio of handle position offset to workspace content displacement.\n   *\n   * @internal\n   */\n  ratio = 1;\n\n  /**\n   * The location of the origin of the workspace that the scrollbar is in,\n   * measured in CSS pixels relative to the injection div origin.  This is\n   * usually (0, 0).  When the scrollbar is in a flyout it may have a\n   * different origin.\n   */\n  private origin = new Coordinate(0, 0);\n\n  /**\n   * The position of the mouse along this scrollbar's major axis at the start\n   * of the most recent drag. Units are CSS pixels, with (0, 0) at the top\n   * left of the browser window. For a horizontal scrollbar this is the x\n   * coordinate of the mouse down event; for a vertical scrollbar it's the y\n   * coordinate of the mouse down event.\n   */\n  private startDragMouse = 0;\n\n  /**\n   * The length of the scrollbars (including the handle and the background),\n   * in CSS pixels. This is equivalent to scrollbar background length and the\n   * area within which the scrollbar handle can move.\n   */\n  private scrollbarLength = 0;\n\n  /** The length of the scrollbar handle in CSS pixels. */\n  private handleLength = 0;\n\n  /**\n   * The offset of the start of the handle from the scrollbar position, in CSS\n   * pixels.\n   */\n  private handlePosition = 0;\n\n  private startDragHandle = 0;\n\n  /** Whether the scrollbar handle is visible. */\n  private isHandleVisible = true;\n\n  /** Whether the workspace containing this scrollbar is visible. */\n  private containerVisible = true;\n\n  /** The transparent background behind the handle. */\n  private svgBackground: SVGRectElement;\n\n  /** The visible handle that can be dragged around. */\n  private svgHandle: SVGRectElement;\n\n  /** The outermost SVG element, which contains all parts of the scrollbar. */\n  private outerSvg: SVGSVGElement;\n\n  /**\n   * The upper left corner of the scrollbar's SVG group in CSS pixels relative\n   * to the scrollbar's origin.  This is usually relative to the injection div\n   * origin.\n   *\n   * @internal\n   */\n  position = new Coordinate(0, 0);\n\n  /**\n   * The DOM attribute that controls the length of the scrollbar. Different\n   * for horizontal and vertical scrollbars.\n   */\n  lengthAttribute_: string;\n\n  /**\n   * The DOM attribute that controls the position of the scrollbar.\n   * Different for horizontal and vertical scrollbars.\n   */\n  positionAttribute_: string;\n\n  /** Handler for mouse down events on the background of the scrollbar. */\n  onMouseDownBarWrapper_: browserEvents.Data;\n\n  /** Handler for mouse down events on the handle of the scrollbar. */\n  onMouseDownHandleWrapper_: browserEvents.Data;\n\n  /** Handler for mouse move events during scrollbar drags. */\n  onMouseUpWrapper_: browserEvents.Data|null = null;\n\n  /** Handler for mouse up events to end scrollbar drags. */\n  onMouseMoveWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbar to.\n   * @param horizontal True if horizontal, false if vertical.\n   * @param opt_pair True if scrollbar is part of a horiz/vert pair.\n   * @param opt_class A class to be applied to this scrollbar.\n   * @param opt_margin The margin to apply to this scrollbar.\n   */\n  constructor(\n      private workspace: WorkspaceSvg, private readonly horizontal: boolean,\n      opt_pair?: boolean, opt_class?: string, opt_margin?: number) {\n    this.pair = opt_pair || false;\n\n    this.margin = opt_margin !== undefined ? opt_margin :\n                                             Scrollbar.DEFAULT_SCROLLBAR_MARGIN;\n\n    let className =\n        'blocklyScrollbar' + (this.horizontal ? 'Horizontal' : 'Vertical');\n    if (opt_class) {\n      className += ' ' + opt_class;\n    }\n\n    /* Create the following DOM:\n      <svg class=\"blocklyScrollbarHorizontal optionalClass\">\n        <g>\n          <rect class=\"blocklyScrollbarBackground\" />\n          <rect class=\"blocklyScrollbarHandle\" rx=\"8\" ry=\"8\" />\n        </g>\n      </svg>\n    */\n    this.outerSvg = dom.createSvgElement(Svg.SVG, {'class': className});\n    // Child group to hold the handle and background together.\n    const group = dom.createSvgElement(Svg.G, {}, this.outerSvg);\n\n    this.svgBackground = dom.createSvgElement(\n        Svg.RECT, {'class': 'blocklyScrollbarBackground'}, group);\n\n    const radius = Math.floor((Scrollbar.scrollbarThickness - 5) / 2);\n    this.svgHandle = dom.createSvgElement(\n        Svg.RECT,\n        {'class': 'blocklyScrollbarHandle', 'rx': radius, 'ry': radius}, group);\n\n    this.workspace.getThemeManager().subscribe(\n        this.svgHandle, 'scrollbarColour', 'fill');\n    this.workspace.getThemeManager().subscribe(\n        this.svgHandle, 'scrollbarOpacity', 'fill-opacity');\n\n    // Add everything to the DOM.\n    dom.insertAfter(this.outerSvg, this.workspace.getParentSvg());\n\n    this.setInitialThickness();\n\n    if (horizontal) {\n      this.lengthAttribute_ = 'width';\n      this.positionAttribute_ = 'x';\n    } else {\n      this.lengthAttribute_ = 'height';\n      this.positionAttribute_ = 'y';\n    }\n\n    this.onMouseDownBarWrapper_ = browserEvents.conditionalBind(\n        this.svgBackground, 'pointerdown', this, this.onMouseDownBar);\n    this.onMouseDownHandleWrapper_ = browserEvents.conditionalBind(\n        this.svgHandle, 'pointerdown', this, this.onMouseDownHandle);\n  }\n\n  /**\n   * Set the size of the scrollbar DOM elements along the minor axis.\n   */\n  private setInitialThickness() {\n    const scrollbarThickness = Scrollbar.scrollbarThickness;\n    if (this.horizontal) {\n      this.svgBackground.setAttribute('height', String(scrollbarThickness));\n      this.outerSvg.setAttribute('height', String(scrollbarThickness));\n      this.svgHandle.setAttribute('height', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('y', '2.5');\n    } else {\n      this.svgBackground.setAttribute('width', String(scrollbarThickness));\n      this.outerSvg.setAttribute('width', String(scrollbarThickness));\n      this.svgHandle.setAttribute('width', String(scrollbarThickness - 5));\n      this.svgHandle.setAttribute('x', '2.5');\n    }\n  }\n\n  /**\n   * Dispose of this scrollbar. Remove DOM elements, event listeners,\n   * and theme subscriptions.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.cleanUp();\n    browserEvents.unbind(this.onMouseDownBarWrapper_);\n    browserEvents.unbind(this.onMouseDownHandleWrapper_);\n\n    dom.removeNode(this.outerSvg);\n    this.workspace.getThemeManager().unsubscribe(this.svgHandle);\n  }\n\n  /**\n   * Constrain the handle's length within the minimum (0) and maximum\n   * (scrollbar background) values allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandleLength(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      value = Math.min(value, this.scrollbarLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the length of the scrollbar's handle and change the SVG attribute\n   * accordingly.\n   *\n   * @param newLength The new scrollbar handle length in CSS pixels.\n   */\n  private setHandleLength(newLength: number) {\n    this.handleLength = newLength;\n    this.svgHandle.setAttribute(\n        this.lengthAttribute_, String(this.handleLength));\n  }\n\n  /**\n   * Constrain the handle's position within the minimum (0) and maximum values\n   * allowed for the scrollbar.\n   *\n   * @param value Value that is potentially out of bounds, in CSS pixels.\n   * @returns Constrained value, in CSS pixels.\n   */\n  private constrainHandlePosition(value: number): number {\n    if (value <= 0 || isNaN(value)) {\n      value = 0;\n    } else {\n      // Handle length should never be greater than this.scrollbarLength_.\n      // If the viewSize is greater than or equal to the scrollSize, the\n      // handleLength will end up equal to this.scrollbarLength_.\n      value = Math.min(value, this.scrollbarLength - this.handleLength);\n    }\n    return value;\n  }\n\n  /**\n   * Set the offset of the scrollbar's handle from the scrollbar's position, and\n   * change the SVG attribute accordingly.\n   *\n   * @param newPosition The new scrollbar handle offset in CSS pixels.\n   */\n  setHandlePosition(newPosition: number) {\n    this.handlePosition = newPosition;\n    this.svgHandle.setAttribute(\n        this.positionAttribute_, String(this.handlePosition));\n  }\n\n  /**\n   * Set the size of the scrollbar's background and change the SVG attribute\n   * accordingly.\n   *\n   * @param newSize The new scrollbar background length in CSS pixels.\n   */\n  private setScrollbarLength(newSize: number) {\n    this.scrollbarLength = newSize;\n    this.outerSvg.setAttribute(\n        this.lengthAttribute_, String(this.scrollbarLength));\n    this.svgBackground.setAttribute(\n        this.lengthAttribute_, String(this.scrollbarLength));\n  }\n\n  /**\n   * Set the position of the scrollbar's SVG group in CSS pixels relative to the\n   * scrollbar's origin.  This sets the scrollbar's location within the\n   * workspace.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   * @internal\n   */\n  setPosition(x: number, y: number) {\n    this.position.x = x;\n    this.position.y = y;\n\n    const tempX = this.position.x + this.origin.x;\n    const tempY = this.position.y + this.origin.y;\n    const transform = 'translate(' + tempX + 'px,' + tempY + 'px)';\n    dom.setCssTransform(this.outerSvg, transform);\n  }\n\n  /**\n   * Recalculate the scrollbar's location and its length.\n   *\n   * @param opt_metrics A data structure of from the describing all the required\n   *     dimensions.  If not provided, it will be fetched from the host object.\n   */\n  resize(opt_metrics?: Metrics) {\n    // Determine the location, height and width of the host element.\n    let hostMetrics = opt_metrics;\n    if (!hostMetrics) {\n      hostMetrics = this.workspace.getMetrics();\n      if (!hostMetrics) {\n        // Host element is likely not visible.\n        return;\n      }\n    }\n\n    if (this.oldHostMetrics &&\n        Scrollbar.metricsAreEquivalent(hostMetrics, this.oldHostMetrics)) {\n      return;\n    }\n\n    if (this.horizontal) {\n      this.resizeHorizontal(hostMetrics);\n    } else {\n      this.resizeVertical(hostMetrics);\n    }\n\n    this.oldHostMetrics = hostMetrics;\n\n    // Resizing may have caused some scrolling.\n    this.updateMetrics();\n  }\n\n  /**\n   * Returns whether the a resizeView is necessary by comparing the passed\n   * hostMetrics with cached old host metrics.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   * @returns Whether a resizeView is necessary.\n   */\n  private requiresViewResize(hostMetrics: Metrics): boolean {\n    if (!this.oldHostMetrics) {\n      return true;\n    }\n    return this.oldHostMetrics.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics.absoluteLeft !== hostMetrics.absoluteLeft ||\n        this.oldHostMetrics.absoluteTop !== hostMetrics.absoluteTop;\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeHorizontal(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewHorizontal(hostMetrics);\n    } else {\n      this.resizeContentHorizontal(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location on the screen and path\n   * length. This should be called when the layout or size of the window has\n   * changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewHorizontal(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewWidth - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    let xCoordinate = hostMetrics.absoluteLeft + this.margin;\n    if (this.pair && this.workspace.RTL) {\n      xCoordinate += Scrollbar.scrollbarThickness;\n    }\n\n    // Horizontal toolbar should always be just above the bottom of the\n    // workspace.\n    const yCoordinate = hostMetrics.absoluteTop + hostMetrics.viewHeight -\n        Scrollbar.scrollbarThickness - this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentHorizontal(hostMetrics);\n  }\n\n  /**\n   * Recalculate a horizontal scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentHorizontal(hostMetrics: Metrics) {\n    if (hostMetrics.viewWidth >= hostMetrics.scrollWidth) {\n      // viewWidth is often greater than scrollWidth in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength =\n        this.scrollbarLength * hostMetrics.viewWidth / hostMetrics.scrollWidth;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewLeft === scrollLeft\n    //     then the offset should be 0\n    // If viewRight === scrollRight\n    //     then viewLeft = scrollLeft + scrollWidth - viewWidth\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollWidth - hostMetrics.viewWidth;\n    const contentDisplacement = hostMetrics.viewLeft - hostMetrics.scrollLeft;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location and length.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  private resizeVertical(hostMetrics: Metrics) {\n    if (this.requiresViewResize(hostMetrics)) {\n      this.resizeViewVertical(hostMetrics);\n    } else {\n      this.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeViewVertical(hostMetrics: Metrics) {\n    let viewSize = hostMetrics.viewHeight - this.margin * 2;\n    if (this.pair) {\n      // Shorten the scrollbar to make room for the corner square.\n      viewSize -= Scrollbar.scrollbarThickness;\n    }\n    this.setScrollbarLength(Math.max(0, viewSize));\n\n    const xCoordinate = this.workspace.RTL ?\n        hostMetrics.absoluteLeft + this.margin :\n        hostMetrics.absoluteLeft + hostMetrics.viewWidth -\n            Scrollbar.scrollbarThickness - this.margin;\n\n    const yCoordinate = hostMetrics.absoluteTop + this.margin;\n    this.setPosition(xCoordinate, yCoordinate);\n\n    // If the view has been resized, a content resize will also be necessary.\n    // The reverse is not true.\n    this.resizeContentVertical(hostMetrics);\n  }\n\n  /**\n   * Recalculate a vertical scrollbar's location within its path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContentVertical(hostMetrics: Metrics) {\n    if (hostMetrics.viewHeight >= hostMetrics.scrollHeight) {\n      // viewHeight is often greater than scrollHeight in flyouts and\n      // non-scrollable workspaces.\n      this.setHandleLength(this.scrollbarLength);\n      this.setHandlePosition(0);\n      if (!this.pair) {\n        // The scrollbar isn't needed.\n        // This doesn't apply to scrollbar pairs because interactions with the\n        // corner square aren't handled.\n        this.setVisible(false);\n      }\n      return;\n    } else if (!this.pair) {\n      // The scrollbar is needed. Only non-paired scrollbars are hidden/shown.\n      this.setVisible(true);\n    }\n\n    // Resize the handle.\n    let handleLength = this.scrollbarLength * hostMetrics.viewHeight /\n        hostMetrics.scrollHeight;\n    handleLength = this.constrainHandleLength(handleLength);\n    this.setHandleLength(handleLength);\n\n    // Compute the handle offset.\n    // The position of the handle can be between:\n    //     0 and this.scrollbarLength_ - handleLength\n    // If viewTop === scrollTop\n    //     then the offset should be 0\n    // If viewBottom === scrollBottom\n    //     then viewTop = scrollTop + scrollHeight - viewHeight\n    //     then the offset should be max offset\n\n    const maxScrollDistance = hostMetrics.scrollHeight - hostMetrics.viewHeight;\n    const contentDisplacement = hostMetrics.viewTop - hostMetrics.scrollTop;\n    // Percent of content to the left of our current position.\n    const offsetRatio = contentDisplacement / maxScrollDistance;\n    // Area available to scroll * percent to the left\n    const maxHandleOffset = this.scrollbarLength - this.handleLength;\n    let handleOffset = maxHandleOffset * offsetRatio;\n    handleOffset = this.constrainHandlePosition(handleOffset);\n    this.setHandlePosition(handleOffset);\n\n    // Compute ratio (for use with set calls, which pass in content\n    // displacement).\n    this.ratio = maxHandleOffset / maxScrollDistance;\n  }\n\n  /**\n   * Is the scrollbar visible.  Non-paired scrollbars disappear when they aren't\n   * needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isHandleVisible;\n  }\n\n  /**\n   * Set whether the scrollbar's container is visible and update\n   * display accordingly if visibility has changed.\n   *\n   * @param visible Whether the container is visible\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible;\n\n    this.containerVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether the scrollbar is visible.\n   * Only applies to non-paired scrollbars.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    // Ideally this would also apply to scrollbar pairs, but that's a bigger\n    // headache (due to interactions with the corner square).\n    if (this.pair) {\n      throw Error('Unable to toggle visibility of paired scrollbars.');\n    }\n    this.isHandleVisible = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update visibility of scrollbar based on whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   * We cannot rely on the containing workspace being hidden to hide us\n   * because it is not necessarily our parent in the DOM.\n   */\n  updateDisplay_() {\n    let show = true;\n    // Check whether our parent/container is visible.\n    if (!this.containerVisible) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (show) {\n      this.outerSvg.setAttribute('display', 'block');\n    } else {\n      this.outerSvg.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Scroll by one pageful.\n   * Called when scrollbar background is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownBar(e: MouseEvent) {\n    this.workspace.markFocused();\n    Touch.clearTouchIdentifier();  // This is really a click.\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    const mouseXY = browserEvents.mouseToSvg(\n        e, this.workspace.getParentSvg(), this.workspace.getInverseScreenCTM());\n    const mouseLocation = this.horizontal ? mouseXY.x : mouseXY.y;\n\n    const handleXY = svgMath.getInjectionDivXY(this.svgHandle);\n    const handleStart = this.horizontal ? handleXY.x : handleXY.y;\n    let handlePosition = this.handlePosition;\n\n    const pageLength = this.handleLength * 0.95;\n    if (mouseLocation <= handleStart) {\n      // Decrease the scrollbar's value by a page.\n      handlePosition -= pageLength;\n    } else if (mouseLocation >= handleStart + this.handleLength) {\n      // Increase the scrollbar's value by a page.\n      handlePosition += pageLength;\n    }\n\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n\n    this.updateMetrics();\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Start a dragging operation.\n   * Called when scrollbar handle is clicked.\n   *\n   * @param e Mouse down event.\n   */\n  private onMouseDownHandle(e: PointerEvent) {\n    this.workspace.markFocused();\n    this.cleanUp();\n    if (browserEvents.isRightButton(e)) {\n      // Right-click.\n      // Scrollbars have no context menu.\n      e.stopPropagation();\n      return;\n    }\n    // Look up the current translation and record it.\n    this.startDragHandle = this.handlePosition;\n\n    // Tell the workspace to setup its drag surface since it is about to move.\n    // onMouseMoveHandle will call onScroll which actually tells the workspace\n    // to move.\n    this.workspace.setupDragSurface();\n\n    // Record the current mouse position.\n    this.startDragMouse = this.horizontal ? e.clientX : e.clientY;\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n        document, 'pointerup', this, this.onMouseUpHandle);\n    this.onMouseMoveWrapper_ = browserEvents.conditionalBind(\n        document, 'pointermove', this, this.onMouseMoveHandle);\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  /**\n   * Drag the scrollbar's handle.\n   *\n   * @param e Mouse move event.\n   */\n  private onMouseMoveHandle(e: PointerEvent) {\n    const currentMouse = this.horizontal ? e.clientX : e.clientY;\n    const mouseDelta = currentMouse - this.startDragMouse;\n    const handlePosition = this.startDragHandle + mouseDelta;\n    // Position the bar.\n    this.setHandlePosition(this.constrainHandlePosition(handlePosition));\n    this.updateMetrics();\n  }\n\n  /** Release the scrollbar handle and reset state accordingly. */\n  private onMouseUpHandle() {\n    // Tell the workspace to clean up now that the workspace is done moving.\n    this.workspace.resetDragSurface();\n    Touch.clearTouchIdentifier();\n    this.cleanUp();\n  }\n\n  /**\n   * Hide chaff and stop binding to mouseup and mousemove events.  Call this to\n   * wrap up loose ends associated with the scrollbar.\n   */\n  private cleanUp() {\n    this.workspace.hideChaff(true);\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n      this.onMouseUpWrapper_ = null;\n    }\n    if (this.onMouseMoveWrapper_) {\n      browserEvents.unbind(this.onMouseMoveWrapper_);\n      this.onMouseMoveWrapper_ = null;\n    }\n  }\n\n  /**\n   * Helper to calculate the ratio of handle position to scrollbar view size.\n   *\n   * @returns Ratio.\n   * @internal\n   */\n  getRatio_(): number {\n    const scrollHandleRange = this.scrollbarLength - this.handleLength;\n    let ratio = this.handlePosition / scrollHandleRange;\n    if (isNaN(ratio)) {\n      ratio = 0;\n    }\n    return ratio;\n  }\n\n  /**\n   * Updates workspace metrics based on new scroll ratio. Called when scrollbar\n   * is moved.\n   */\n  private updateMetrics() {\n    const ratio = this.getRatio_();\n    if (this.horizontal) {\n      this.workspace.setMetrics({x: ratio});\n    } else {\n      this.workspace.setMetrics({y: ratio});\n    }\n  }\n\n  /**\n   * Set the scrollbar handle's position.\n   *\n   * @param value The content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(value: number, updateMetrics?: boolean) {\n    this.setHandlePosition(this.constrainHandlePosition(value * this.ratio));\n    if (updateMetrics || updateMetrics === undefined) {\n      this.updateMetrics();\n    }\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   */\n  setOrigin(x: number, y: number) {\n    this.origin = new Coordinate(x, y);\n  }\n\n  /**\n   * @param first An object containing computed measurements of a workspace.\n   * @param second Another object containing computed measurements of a\n   *     workspace.\n   * @returns Whether the two sets of metrics are equivalent.\n   */\n  private static metricsAreEquivalent(first: Metrics, second: Metrics):\n      boolean {\n    return first.viewWidth === second.viewWidth &&\n        first.viewHeight === second.viewHeight &&\n        first.viewLeft === second.viewLeft &&\n        first.viewTop === second.viewTop &&\n        first.absoluteTop === second.absoluteTop &&\n        first.absoluteLeft === second.absoluteLeft &&\n        first.scrollWidth === second.scrollWidth &&\n        first.scrollHeight === second.scrollHeight &&\n        first.scrollLeft === second.scrollLeft &&\n        first.scrollTop === second.scrollTop;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a UI bubble.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Bubble');\n\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {ContainerRegion} from './metrics_manager.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as math from './utils/math.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for UI bubble.\n */\nexport class Bubble implements IBubble {\n  /** Width of the border around the bubble. */\n  static BORDER_WIDTH = 6;\n\n  /**\n   * Determines the thickness of the base of the arrow in relation to the size\n   * of the bubble.  Higher numbers result in thinner arrows.\n   */\n  static ARROW_THICKNESS = 5;\n\n  /** The number of degrees that the arrow bends counter-clockwise. */\n  static ARROW_ANGLE = 20;\n\n  /**\n   * The sharpness of the arrow's bend.  Higher numbers result in smoother\n   * arrows.\n   */\n  static ARROW_BEND = 4;\n\n  /** Distance between arrow point and anchor point. */\n  static ANCHOR_RADIUS = 8;\n\n  /** Mouse up event data. */\n  private static onMouseUpWrapper: browserEvents.Data|null = null;\n\n  /** Mouse move event data. */\n  private static onMouseMoveWrapper: browserEvents.Data|null = null;\n\n  workspace_: WorkspaceSvg;\n  content_: SVGElement;\n  shape_: SVGElement;\n\n  /** Flag to stop incremental rendering during construction. */\n  private readonly rendered: boolean;\n\n  /** The SVG group containing all parts of the bubble. */\n  private bubbleGroup: SVGGElement|null = null;\n\n  /**\n   * The SVG path for the arrow from the bubble to the icon on the block.\n   */\n  private bubbleArrow: SVGPathElement|null = null;\n\n  /** The SVG rect for the main body of the bubble. */\n  private bubbleBack: SVGRectElement|null = null;\n\n  /** The SVG group for the resize hash marks on some bubbles. */\n  private resizeGroup: SVGGElement|null = null;\n\n  /** Absolute coordinate of anchor point, in workspace coordinates. */\n  private anchorXY!: Coordinate;\n\n  /**\n   * Relative X coordinate of bubble with respect to the anchor's centre,\n   * in workspace units.\n   * In RTL mode the initial value is negated.\n   */\n  private relativeLeft = 0;\n\n  /**\n   * Relative Y coordinate of bubble with respect to the anchor's centre, in\n   * workspace units.\n   */\n  private relativeTop = 0;\n\n  /** Width of bubble, in workspace units. */\n  private width = 0;\n\n  /** Height of bubble, in workspace units. */\n  private height = 0;\n\n  /** Automatically position and reposition the bubble. */\n  private autoLayout = true;\n\n  /** Method to call on resize of bubble. */\n  private resizeCallback: (() => void)|null = null;\n\n  /** Method to call on move of bubble. */\n  private moveCallback: (() => void)|null = null;\n\n  /** Mouse down on bubbleBack event data. */\n  private onMouseDownBubbleWrapper: browserEvents.Data|null = null;\n\n  /** Mouse down on resizeGroup event data. */\n  private onMouseDownResizeWrapper: browserEvents.Data|null = null;\n\n  /**\n   * Describes whether this bubble has been disposed of (nodes and event\n   * listeners removed from the page) or not.\n   *\n   * @internal\n   */\n  disposed = false;\n  private arrowRadians: number;\n\n  /**\n   * @param workspace The workspace on which to draw the bubble.\n   * @param content SVG content for the bubble.\n   * @param shape SVG element to avoid eclipsing.\n   * @param anchorXY Absolute position of bubble's anchor point.\n   * @param bubbleWidth Width of bubble, or null if not resizable.\n   * @param bubbleHeight Height of bubble, or null if not resizable.\n   */\n  constructor(\n      workspace: WorkspaceSvg, content: SVGElement, shape: SVGElement,\n      anchorXY: Coordinate, bubbleWidth: number|null,\n      bubbleHeight: number|null) {\n    this.rendered = false;\n    this.workspace_ = workspace;\n    this.content_ = content;\n    this.shape_ = shape;\n\n    let angle = Bubble.ARROW_ANGLE;\n    if (this.workspace_.RTL) {\n      angle = -angle;\n    }\n    this.arrowRadians = math.toRadians(angle);\n\n    const canvas = workspace.getBubbleCanvas();\n    canvas.appendChild(\n        this.createDom(content, !!(bubbleWidth && bubbleHeight)));\n\n    this.setAnchorLocation(anchorXY);\n    if (!bubbleWidth || !bubbleHeight) {\n      const bBox = (this.content_ as SVGGraphicsElement).getBBox();\n      bubbleWidth = bBox.width + 2 * Bubble.BORDER_WIDTH;\n      bubbleHeight = bBox.height + 2 * Bubble.BORDER_WIDTH;\n    }\n    this.setBubbleSize(bubbleWidth, bubbleHeight);\n\n    // Render the bubble.\n    this.positionBubble();\n    this.renderArrow();\n    this.rendered = true;\n  }\n\n  /**\n   * Create the bubble's DOM.\n   *\n   * @param content SVG content for the bubble.\n   * @param hasResize Add diagonal resize gripper if true.\n   * @returns The bubble's SVG group.\n   */\n  private createDom(content: Element, hasResize: boolean): SVGElement {\n    /* Create the bubble.  Here's the markup that will be generated:\n        <g>\n          <g filter=\"url(#blocklyEmbossFilter837493)\">\n            <path d=\"... Z\" />\n            <rect class=\"blocklyDraggable\" rx=\"8\" ry=\"8\" width=\"180\"\n       height=\"180\"/>\n          </g>\n          <g transform=\"translate(165, 165)\" class=\"blocklyResizeSE\">\n            <polygon points=\"0,15 15,15 15,0\"/>\n            <line class=\"blocklyResizeLine\" x1=\"5\" y1=\"14\" x2=\"14\" y2=\"5\"/>\n            <line class=\"blocklyResizeLine\" x1=\"10\" y1=\"14\" x2=\"14\" y2=\"10\"/>\n          </g>\n          [...content goes here...]\n        </g>\n        */\n    this.bubbleGroup = dom.createSvgElement(Svg.G, {});\n    let filter: {filter?: string} = {\n      'filter': 'url(#' +\n          this.workspace_.getRenderer().getConstants().embossFilterId + ')',\n    };\n    if (userAgent.JavaFx) {\n      // Multiple reports that JavaFX can't handle filters.\n      // https://github.com/google/blockly/issues/99\n      filter = {};\n    }\n    const bubbleEmboss = dom.createSvgElement(Svg.G, filter, this.bubbleGroup);\n    this.bubbleArrow = dom.createSvgElement(Svg.PATH, {}, bubbleEmboss);\n    this.bubbleBack = dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyDraggable',\n          'x': 0,\n          'y': 0,\n          'rx': Bubble.BORDER_WIDTH,\n          'ry': Bubble.BORDER_WIDTH,\n        },\n        bubbleEmboss);\n    if (hasResize) {\n      this.resizeGroup = dom.createSvgElement(\n          Svg.G, {\n            'class': this.workspace_.RTL ? 'blocklyResizeSW' :\n                                           'blocklyResizeSE',\n          },\n          this.bubbleGroup);\n      const size = 2 * Bubble.BORDER_WIDTH;\n      dom.createSvgElement(\n          Svg.POLYGON, {'points': `0,${size} ${size},${size} ${size},0`},\n          this.resizeGroup);\n      dom.createSvgElement(\n          Svg.LINE, {\n            'class': 'blocklyResizeLine',\n            'x1': size / 3,\n            'y1': size - 1,\n            'x2': size - 1,\n            'y2': size / 3,\n          },\n          this.resizeGroup);\n      dom.createSvgElement(\n          Svg.LINE, {\n            'class': 'blocklyResizeLine',\n            'x1': size * 2 / 3,\n            'y1': size - 1,\n            'x2': size - 1,\n            'y2': size * 2 / 3,\n          },\n          this.resizeGroup);\n    } else {\n      this.resizeGroup = null;\n    }\n\n    if (!this.workspace_.options.readOnly) {\n      this.onMouseDownBubbleWrapper = browserEvents.conditionalBind(\n          this.bubbleBack, 'pointerdown', this, this.bubbleMouseDown);\n      if (this.resizeGroup) {\n        this.onMouseDownResizeWrapper = browserEvents.conditionalBind(\n            this.resizeGroup, 'pointerdown', this, this.resizeMouseDown);\n      }\n    }\n    this.bubbleGroup.appendChild(content);\n    return this.bubbleGroup;\n  }\n\n  /**\n   * Return the root node of the bubble's SVG group.\n   *\n   * @returns The root SVG node of the bubble's group.\n   */\n  getSvgRoot(): SVGElement {\n    return this.bubbleGroup as SVGElement;\n  }\n\n  /**\n   * Expose the block's ID on the bubble's top-level SVG group.\n   *\n   * @param id ID of block.\n   */\n  setSvgId(id: string) {\n    this.bubbleGroup?.setAttribute('data-block-id', id);\n  }\n\n  /**\n   * Handle a pointerdown on bubble's border.\n   *\n   * @param e Pointer down event.\n   */\n  private bubbleMouseDown(e: PointerEvent) {\n    const gesture = this.workspace_.getGesture(e);\n    if (gesture) {\n      gesture.handleBubbleStart(e, this);\n    }\n  }\n\n  /**\n   * Show the context menu for this bubble.\n   *\n   * @param _e Mouse event.\n   * @internal\n   */\n  showContextMenu(_e: Event) {}\n  // NOP on bubbles, but used by the bubble dragger to pass events to\n  // workspace comments.\n\n  /**\n   * Get whether this bubble is deletable or not.\n   *\n   * @returns True if deletable.\n   * @internal\n   */\n  isDeletable(): boolean {\n    return false;\n  }\n\n  /**\n   * Update the style of this bubble when it is dragged over a delete area.\n   *\n   * @param _enable True if the bubble is about to be deleted, false otherwise.\n   */\n  setDeleteStyle(_enable: boolean) {}\n  // NOP if bubble is not deletable.\n\n  /**\n   * Handle a pointerdown on bubble's resize corner.\n   *\n   * @param e Pointer down event.\n   */\n  private resizeMouseDown(e: PointerEvent) {\n    this.promote();\n    Bubble.unbindDragEvents();\n    if (browserEvents.isRightButton(e)) {\n      // No right-click.\n      e.stopPropagation();\n      return;\n    }\n    // Left-click (or middle click)\n    this.workspace_.startDrag(\n        e,\n        new Coordinate(\n            this.workspace_.RTL ? -this.width : this.width, this.height));\n\n    Bubble.onMouseUpWrapper = browserEvents.conditionalBind(\n        document, 'pointerup', this, Bubble.bubbleMouseUp);\n    Bubble.onMouseMoveWrapper = browserEvents.conditionalBind(\n        document, 'pointermove', this, this.resizeMouseMove);\n    this.workspace_.hideChaff();\n    // This event has been handled.  No need to bubble up to the document.\n    e.stopPropagation();\n  }\n\n  /**\n   * Resize this bubble to follow the pointer.\n   *\n   * @param e Pointer move event.\n   */\n  private resizeMouseMove(e: PointerEvent) {\n    this.autoLayout = false;\n    const newXY = this.workspace_.moveDrag(e);\n    this.setBubbleSize(this.workspace_.RTL ? -newXY.x : newXY.x, newXY.y);\n    if (this.workspace_.RTL) {\n      // RTL requires the bubble to move its left edge.\n      this.positionBubble();\n    }\n  }\n\n  /**\n   * Register a function as a callback event for when the bubble is resized.\n   *\n   * @param callback The function to call on resize.\n   */\n  registerResizeEvent(callback: () => void) {\n    this.resizeCallback = callback;\n  }\n\n  /**\n   * Register a function as a callback event for when the bubble is moved.\n   *\n   * @param callback The function to call on move.\n   */\n  registerMoveEvent(callback: () => void) {\n    this.moveCallback = callback;\n  }\n\n  /**\n   * Move this bubble to the top of the stack.\n   *\n   * @returns Whether or not the bubble has been moved.\n   * @internal\n   */\n  promote(): boolean {\n    const svgGroup = this.bubbleGroup?.parentNode;\n    if (svgGroup?.lastChild !== this.bubbleGroup && this.bubbleGroup) {\n      svgGroup?.appendChild(this.bubbleGroup);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Notification that the anchor has moved.\n   * Update the arrow and bubble accordingly.\n   *\n   * @param xy Absolute location.\n   */\n  setAnchorLocation(xy: Coordinate) {\n    this.anchorXY = xy;\n    if (this.rendered) {\n      this.positionBubble();\n    }\n  }\n\n  /** Position the bubble so that it does not fall off-screen. */\n  private layoutBubble() {\n    // Get the metrics in workspace units.\n    const viewMetrics =\n        this.workspace_.getMetricsManager().getViewMetrics(true);\n\n    const optimalLeft = this.getOptimalRelativeLeft(viewMetrics);\n    const optimalTop = this.getOptimalRelativeTop(viewMetrics);\n    const bbox = (this.shape_ as SVGGraphicsElement).getBBox();\n\n    const topPosition = {\n      x: optimalLeft,\n      y: -this.height -\n              this.workspace_.getRenderer().getConstants().MIN_BLOCK_HEIGHT as\n          number,\n    };\n    const startPosition = {x: -this.width - 30, y: optimalTop};\n    const endPosition = {x: bbox.width, y: optimalTop};\n    const bottomPosition = {x: optimalLeft, y: bbox.height};\n\n    const closerPosition =\n        bbox.width < bbox.height ? endPosition : bottomPosition;\n    const fartherPosition =\n        bbox.width < bbox.height ? bottomPosition : endPosition;\n\n    const topPositionOverlap = this.getOverlap(topPosition, viewMetrics);\n    const startPositionOverlap = this.getOverlap(startPosition, viewMetrics);\n    const closerPositionOverlap = this.getOverlap(closerPosition, viewMetrics);\n    const fartherPositionOverlap =\n        this.getOverlap(fartherPosition, viewMetrics);\n\n    // Set the position to whichever position shows the most of the bubble,\n    // with tiebreaks going in the order: top > start > close > far.\n    const mostOverlap = Math.max(\n        topPositionOverlap, startPositionOverlap, closerPositionOverlap,\n        fartherPositionOverlap);\n    if (topPositionOverlap === mostOverlap) {\n      this.relativeLeft = topPosition.x;\n      this.relativeTop = topPosition.y;\n      return;\n    }\n    if (startPositionOverlap === mostOverlap) {\n      this.relativeLeft = startPosition.x;\n      this.relativeTop = startPosition.y;\n      return;\n    }\n    if (closerPositionOverlap === mostOverlap) {\n      this.relativeLeft = closerPosition.x;\n      this.relativeTop = closerPosition.y;\n      return;\n    }\n    // TODO: I believe relativeLeft_ should actually be called relativeStart_\n    //  and then the math should be fixed to reflect this. (hopefully it'll\n    //  make it look simpler)\n    this.relativeLeft = fartherPosition.x;\n    this.relativeTop = fartherPosition.y;\n  }\n\n  /**\n   * Calculate the what percentage of the bubble overlaps with the visible\n   * workspace (what percentage of the bubble is visible).\n   *\n   * @param relativeMin The position of the top-left corner of the bubble\n   *     relative to the anchor point.\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The percentage of the bubble that is visible.\n   */\n  private getOverlap(\n      relativeMin: {x: number, y: number},\n      viewMetrics: ContainerRegion): number {\n    // The position of the top-left corner of the bubble in workspace units.\n    const bubbleMin = {\n      x: this.workspace_.RTL ? this.anchorXY.x - relativeMin.x - this.width :\n                               relativeMin.x + this.anchorXY.x,\n      y: relativeMin.y + this.anchorXY.y,\n    };\n    // The position of the bottom-right corner of the bubble in workspace units.\n    const bubbleMax = {\n      x: bubbleMin.x + this.width,\n      y: bubbleMin.y + this.height,\n    };\n\n    // We could adjust these values to account for the scrollbars, but the\n    // bubbles should have been adjusted to not collide with them anyway, so\n    // giving the workspace a slightly larger \"bounding box\" shouldn't affect\n    // the calculation.\n\n    // The position of the top-left corner of the workspace.\n    const workspaceMin = {x: viewMetrics.left, y: viewMetrics.top};\n    // The position of the bottom-right corner of the workspace.\n    const workspaceMax = {\n      x: viewMetrics.left + viewMetrics.width,\n      y: viewMetrics.top + viewMetrics.height,\n    };\n\n    const overlapWidth = Math.min(bubbleMax.x, workspaceMax.x) -\n        Math.max(bubbleMin.x, workspaceMin.x);\n    const overlapHeight = Math.min(bubbleMax.y, workspaceMax.y) -\n        Math.max(bubbleMin.y, workspaceMin.y);\n    return Math.max(\n        0,\n        Math.min(1, overlapWidth * overlapHeight / (this.width * this.height)));\n  }\n\n  /**\n   * Calculate what the optimal horizontal position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal horizontal position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeLeft(viewMetrics: ContainerRegion): number {\n    let relativeLeft = -this.width / 4;\n\n    // No amount of sliding left or right will give us a better overlap.\n    if (this.width > viewMetrics.width) {\n      return relativeLeft;\n    }\n\n    if (this.workspace_.RTL) {\n      // Bubble coordinates are flipped in RTL.\n      const bubbleRight = this.anchorXY.x - relativeLeft;\n      const bubbleLeft = bubbleRight - this.width;\n\n      const workspaceRight = viewMetrics.left + viewMetrics.width;\n      const workspaceLeft = viewMetrics.left +\n          // Thickness in workspace units.\n          Scrollbar.scrollbarThickness / this.workspace_.scale;\n\n      if (bubbleLeft < workspaceLeft) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = -(workspaceLeft - this.anchorXY.x + this.width);\n      } else if (bubbleRight > workspaceRight) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = -(workspaceRight - this.anchorXY.x);\n      }\n    } else {\n      const bubbleLeft = relativeLeft + this.anchorXY.x;\n      const bubbleRight = bubbleLeft + this.width;\n\n      const workspaceLeft = viewMetrics.left;\n      const workspaceRight = viewMetrics.left + viewMetrics.width -\n          // Thickness in workspace units.\n          Scrollbar.scrollbarThickness / this.workspace_.scale;\n\n      if (bubbleLeft < workspaceLeft) {\n        // Slide the bubble right until it is onscreen.\n        relativeLeft = workspaceLeft - this.anchorXY.x;\n      } else if (bubbleRight > workspaceRight) {\n        // Slide the bubble left until it is onscreen.\n        relativeLeft = workspaceRight - this.anchorXY.x - this.width;\n      }\n    }\n\n    return relativeLeft;\n  }\n\n  /**\n   * Calculate what the optimal vertical position of the top-left corner of\n   * the bubble is (relative to the anchor point) so that the most area of the\n   * bubble is shown.\n   *\n   * @param viewMetrics The view metrics of the workspace the bubble will appear\n   *     in.\n   * @returns The optimal vertical position of the top-left corner of the\n   *     bubble.\n   */\n  private getOptimalRelativeTop(viewMetrics: ContainerRegion): number {\n    let relativeTop = -this.height / 4;\n\n    // No amount of sliding up or down will give us a better overlap.\n    if (this.height > viewMetrics.height) {\n      return relativeTop;\n    }\n\n    const bubbleTop = this.anchorXY.y + relativeTop;\n    const bubbleBottom = bubbleTop + this.height;\n    const workspaceTop = viewMetrics.top;\n    const workspaceBottom = viewMetrics.top +\n        viewMetrics.height -  // Thickness in workspace units.\n        Scrollbar.scrollbarThickness / this.workspace_.scale;\n\n    const anchorY = this.anchorXY.y;\n    if (bubbleTop < workspaceTop) {\n      // Slide the bubble down until it is onscreen.\n      relativeTop = workspaceTop - anchorY;\n    } else if (bubbleBottom > workspaceBottom) {\n      // Slide the bubble up until it is onscreen.\n      relativeTop = workspaceBottom - anchorY - this.height;\n    }\n\n    return relativeTop;\n  }\n\n  /** Move the bubble to a location relative to the anchor's centre. */\n  private positionBubble() {\n    let left = this.anchorXY.x;\n    if (this.workspace_.RTL) {\n      left -= this.relativeLeft + this.width;\n    } else {\n      left += this.relativeLeft;\n    }\n    const top = this.relativeTop + this.anchorXY.y;\n    this.moveTo(left, top);\n  }\n\n  /**\n   * Move the bubble group to the specified location in workspace coordinates.\n   *\n   * @param x The x position to move to.\n   * @param y The y position to move to.\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.bubbleGroup?.setAttribute(\n        'transform', 'translate(' + x + ',' + y + ')');\n  }\n\n  /**\n   * Triggers a move callback if one exists at the end of a drag.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (!adding && this.moveCallback) {\n      this.moveCallback();\n    }\n  }\n\n  /**\n   * Get the dimensions of this bubble.\n   *\n   * @returns The height and width of the bubble.\n   */\n  getBubbleSize(): Size {\n    return new Size(this.width, this.height);\n  }\n\n  /**\n   * Size this bubble.\n   *\n   * @param width Width of the bubble.\n   * @param height Height of the bubble.\n   */\n  setBubbleSize(width: number, height: number) {\n    const doubleBorderWidth = 2 * Bubble.BORDER_WIDTH;\n    // Minimum size of a bubble.\n    width = Math.max(width, doubleBorderWidth + 45);\n    height = Math.max(height, doubleBorderWidth + 20);\n    this.width = width;\n    this.height = height;\n    this.bubbleBack?.setAttribute('width', `${width}`);\n    this.bubbleBack?.setAttribute('height', `${height}`);\n    if (this.resizeGroup) {\n      if (this.workspace_.RTL) {\n        // Mirror the resize group.\n        const resizeSize = 2 * Bubble.BORDER_WIDTH;\n        this.resizeGroup.setAttribute(\n            'transform',\n            'translate(' + resizeSize + ',' + (height - doubleBorderWidth) +\n                ') scale(-1 1)');\n      } else {\n        this.resizeGroup.setAttribute(\n            'transform',\n            'translate(' + (width - doubleBorderWidth) + ',' +\n                (height - doubleBorderWidth) + ')');\n      }\n    }\n    if (this.autoLayout) {\n      this.layoutBubble();\n    }\n    this.positionBubble();\n    this.renderArrow();\n\n    // Allow the contents to resize.\n    if (this.resizeCallback) {\n      this.resizeCallback();\n    }\n  }\n\n  /** Draw the arrow between the bubble and the origin. */\n  private renderArrow() {\n    const steps = [];\n    // Find the relative coordinates of the center of the bubble.\n    const relBubbleX = this.width / 2;\n    const relBubbleY = this.height / 2;\n    // Find the relative coordinates of the center of the anchor.\n    let relAnchorX = -this.relativeLeft;\n    let relAnchorY = -this.relativeTop;\n    if (relBubbleX === relAnchorX && relBubbleY === relAnchorY) {\n      // Null case.  Bubble is directly on top of the anchor.\n      // Short circuit this rather than wade through divide by zeros.\n      steps.push('M ' + relBubbleX + ',' + relBubbleY);\n    } else {\n      // Compute the angle of the arrow's line.\n      const rise = relAnchorY - relBubbleY;\n      let run = relAnchorX - relBubbleX;\n      if (this.workspace_.RTL) {\n        run *= -1;\n      }\n      const hypotenuse = Math.sqrt(rise * rise + run * run);\n      let angle = Math.acos(run / hypotenuse);\n      if (rise < 0) {\n        angle = 2 * Math.PI - angle;\n      }\n      // Compute a line perpendicular to the arrow.\n      let rightAngle = angle + Math.PI / 2;\n      if (rightAngle > Math.PI * 2) {\n        rightAngle -= Math.PI * 2;\n      }\n      const rightRise = Math.sin(rightAngle);\n      const rightRun = Math.cos(rightAngle);\n\n      // Calculate the thickness of the base of the arrow.\n      const bubbleSize = this.getBubbleSize();\n      let thickness =\n          (bubbleSize.width + bubbleSize.height) / Bubble.ARROW_THICKNESS;\n      thickness = Math.min(thickness, bubbleSize.width, bubbleSize.height) / 4;\n\n      // Back the tip of the arrow off of the anchor.\n      const backoffRatio = 1 - Bubble.ANCHOR_RADIUS / hypotenuse;\n      relAnchorX = relBubbleX + backoffRatio * run;\n      relAnchorY = relBubbleY + backoffRatio * rise;\n\n      // Coordinates for the base of the arrow.\n      const baseX1 = relBubbleX + thickness * rightRun;\n      const baseY1 = relBubbleY + thickness * rightRise;\n      const baseX2 = relBubbleX - thickness * rightRun;\n      const baseY2 = relBubbleY - thickness * rightRise;\n\n      // Distortion to curve the arrow.\n      let swirlAngle = angle + this.arrowRadians;\n      if (swirlAngle > Math.PI * 2) {\n        swirlAngle -= Math.PI * 2;\n      }\n      const swirlRise = Math.sin(swirlAngle) * hypotenuse / Bubble.ARROW_BEND;\n      const swirlRun = Math.cos(swirlAngle) * hypotenuse / Bubble.ARROW_BEND;\n\n      steps.push('M' + baseX1 + ',' + baseY1);\n      steps.push(\n          'C' + (baseX1 + swirlRun) + ',' + (baseY1 + swirlRise) + ' ' +\n          relAnchorX + ',' + relAnchorY + ' ' + relAnchorX + ',' + relAnchorY);\n      steps.push(\n          'C' + relAnchorX + ',' + relAnchorY + ' ' + (baseX2 + swirlRun) +\n          ',' + (baseY2 + swirlRise) + ' ' + baseX2 + ',' + baseY2);\n    }\n    steps.push('z');\n    this.bubbleArrow?.setAttribute('d', steps.join(' '));\n  }\n\n  /**\n   * Change the colour of a bubble.\n   *\n   * @param hexColour Hex code of colour.\n   */\n  setColour(hexColour: string) {\n    this.bubbleBack?.setAttribute('fill', hexColour);\n    this.bubbleArrow?.setAttribute('fill', hexColour);\n  }\n\n  /** Dispose of this bubble. */\n  dispose() {\n    if (this.onMouseDownBubbleWrapper) {\n      browserEvents.unbind(this.onMouseDownBubbleWrapper);\n    }\n    if (this.onMouseDownResizeWrapper) {\n      browserEvents.unbind(this.onMouseDownResizeWrapper);\n    }\n    Bubble.unbindDragEvents();\n    dom.removeNode(this.bubbleGroup);\n    this.disposed = true;\n  }\n\n  /**\n   * Move this bubble during a drag, taking into account whether or not there is\n   * a drag surface.\n   *\n   * @param dragSurface The surface that carries rendered items during a drag,\n   *     or null if no drag surface is in use.\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(dragSurface: BlockDragSurfaceSvg, newLoc: Coordinate) {\n    if (dragSurface) {\n      dragSurface.translateSurface(newLoc.x, newLoc.y);\n    } else {\n      this.moveTo(newLoc.x, newLoc.y);\n    }\n    if (this.workspace_.RTL) {\n      this.relativeLeft = this.anchorXY.x - newLoc.x - this.width;\n    } else {\n      this.relativeLeft = newLoc.x - this.anchorXY.x;\n    }\n    this.relativeTop = newLoc.y - this.anchorXY.y;\n    this.renderArrow();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this bubble's body\n   * relative to the drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return new Coordinate(\n        this.workspace_.RTL ?\n            -this.relativeLeft + this.anchorXY.x - this.width :\n            this.anchorXY.x + this.relativeLeft,\n        this.anchorXY.y + this.relativeTop);\n  }\n\n  /**\n   * Set whether auto-layout of this bubble is enabled.  The first time a bubble\n   * is shown it positions itself to not cover any blocks.  Once a user has\n   * dragged it to reposition, it renders where the user put it.\n   *\n   * @param enable True if auto-layout should be enabled, false otherwise.\n   * @internal\n   */\n  setAutoLayout(enable: boolean) {\n    this.autoLayout = enable;\n  }\n\n  /** Stop binding to the global mouseup and mousemove events. */\n  private static unbindDragEvents() {\n    if (Bubble.onMouseUpWrapper) {\n      browserEvents.unbind(Bubble.onMouseUpWrapper);\n      Bubble.onMouseUpWrapper = null;\n    }\n    if (Bubble.onMouseMoveWrapper) {\n      browserEvents.unbind(Bubble.onMouseMoveWrapper);\n      Bubble.onMouseMoveWrapper = null;\n    }\n  }\n\n  /**\n   * Handle a pointerup event while dragging a bubble's border or resize handle.\n   *\n   * @param _e Pointer up event.\n   */\n  private static bubbleMouseUp(_e: PointerEvent) {\n    Touch.clearTouchIdentifier();\n    Bubble.unbindDragEvents();\n  }\n\n  /**\n   * Create the text for a non editable bubble.\n   *\n   * @param text The text to display.\n   * @returns The top-level node of the text.\n   * @internal\n   */\n  static textToDom(text: string): SVGTextElement {\n    const paragraph = dom.createSvgElement(Svg.TEXT, {\n      'class': 'blocklyText blocklyBubbleText blocklyNoPointerEvents',\n      'y': Bubble.BORDER_WIDTH,\n    });\n    const lines = text.split('\\n');\n    for (let i = 0; i < lines.length; i++) {\n      const tspanElement = dom.createSvgElement(\n          Svg.TSPAN, {'dy': '1em', 'x': Bubble.BORDER_WIDTH}, paragraph);\n      const textNode = document.createTextNode(lines[i]);\n      tspanElement.appendChild(textNode);\n    }\n    return paragraph;\n  }\n\n  /**\n   * Creates a bubble that can not be edited.\n   *\n   * @param paragraphElement The text element for the non editable bubble.\n   * @param block The block that the bubble is attached to.\n   * @param iconXY The coordinate of the icon.\n   * @returns The non editable bubble.\n   * @internal\n   */\n  static createNonEditableBubble(\n      paragraphElement: SVGTextElement, block: BlockSvg,\n      iconXY: Coordinate): Bubble {\n    const bubble = new Bubble(\n        block.workspace!, paragraphElement, block.pathObject.svgPath, (iconXY),\n        null, null);\n    // Expose this bubble's block's ID on its top-level SVG group.\n    bubble.setSvgId(block.id);\n    if (block.RTL) {\n      // Right-align the paragraph.\n      // This cannot be done until the bubble is rendered on screen.\n      const maxWidth = paragraphElement.getBBox().width;\n      for (let i = 0, textElement;\n           textElement = paragraphElement.childNodes[i] as SVGTSpanElement;\n           i++) {\n        textElement.setAttribute('text-anchor', 'end');\n        textElement.setAttribute('x', String(maxWidth + Bubble.BORDER_WIDTH));\n      }\n    }\n    return bubble;\n  }\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.config');\n\n\n/**\n * All the values that we expect developers to be able to change\n * before injecting Blockly.\n */\ninterface Config {\n  dragRadius: number;\n  flyoutDragRadius: number;\n  snapRadius: number;\n  currentConnectionPreference: number;\n  bumpDelay: number;\n  connectingSnapRadius: number;\n}\n\n/** Default snap radius. */\nconst DEFAULT_SNAP_RADIUS = 28;\n\n/**\n * Object holding all the values on Blockly that we expect developers to be\n * able to change.\n */\nexport const config: Config = {\n  /**\n   * Number of pixels the mouse must move before a drag starts.\n   *\n   */\n  dragRadius: 5,\n  /**\n   * Number of pixels the mouse must move before a drag/scroll starts from the\n   * flyout.  Because the drag-intention is determined when this is reached, it\n   * is larger than dragRadius so that the drag-direction is clearer.\n   *\n   */\n  flyoutDragRadius: 10,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   *\n   */\n  snapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * Maximum misalignment between connections for them to snap together.\n   * This should be the same as the snap radius.\n   *\n   */\n  connectingSnapRadius: DEFAULT_SNAP_RADIUS,\n  /**\n   * How much to prefer staying connected to the current connection over moving\n   * to a new connection.  The current previewed connection is considered to be\n   * this much closer to the matching connection on the block than it actually\n   * is.\n   *\n   */\n  currentConnectionPreference: 8,\n  /**\n   * Delay in ms between trigger and bumping unconnected block out of alignment.\n   *\n   */\n  bumpDelay: 250,\n};\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an icon on a block.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Icon');\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport type {Bubble} from './bubble.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as deprecation from './utils/deprecation.js';\n\n\n/**\n * Class for an icon.\n */\nexport abstract class Icon {\n  protected block_: BlockSvg|null;\n  /** The icon SVG group. */\n  iconGroup_: SVGGElement|null = null;\n\n  /** Whether this icon gets hidden when the block is collapsed. */\n  collapseHidden = true;\n\n  /** Height and width of icons. */\n  readonly SIZE = 17;\n\n  /** Bubble UI (if visible). */\n  protected bubble_: Bubble|null = null;\n\n  /** Absolute coordinate of icon's center. */\n  protected iconXY_: Coordinate|null = null;\n\n  /** @param block The block associated with this icon. */\n  constructor(block: BlockSvg|null) {\n    if (!block) {\n      deprecation.warn(\n          'Calling the Icon constructor with a null block', 'version 9',\n          'version 10', 'a non-null block');\n    }\n    this.block_ = block;\n  }\n\n  /** Create the icon on the block. */\n  createIcon() {\n    if (this.iconGroup_) {\n      // Icon already exists.\n      return;\n    }\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyIconGroup\">\n          ...\n        </g>\n        */\n    this.iconGroup_ =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyIconGroup'});\n    if (this.getBlock().isInFlyout) {\n      dom.addClass(this.iconGroup_, 'blocklyIconGroupReadonly');\n    }\n    this.drawIcon_(this.iconGroup_);\n\n    this.getBlock().getSvgRoot().appendChild(this.iconGroup_);\n    browserEvents.conditionalBind(\n        this.iconGroup_, 'pointerup', this, this.iconClick_);\n    this.updateEditable();\n  }\n\n  /** Dispose of this icon. */\n  dispose() {\n    if (!this.getBlock().isDeadOrDying()) {\n      dom.removeNode(this.iconGroup_);\n    }\n    this.setVisible(false);  // Dispose of and unlink the bubble.\n  }\n\n  /** Add or remove the UI indicating if this icon may be clicked or not. */\n  updateEditable() {\n    // No-op on the base class.\n  }\n\n  /**\n   * Is the associated bubble visible?\n   *\n   * @returns True if the bubble is visible.\n   */\n  isVisible(): boolean {\n    return !!this.bubble_;\n  }\n\n  /**\n   * Clicking on the icon toggles if the bubble is visible.\n   *\n   * @param e Mouse click event.\n   */\n  protected iconClick_(e: PointerEvent) {\n    if (this.getBlock().workspace.isDragging()) {\n      // Drag operation is concluding.  Don't open the editor.\n      return;\n    }\n    if (!this.getBlock().isInFlyout && !browserEvents.isRightButton(e)) {\n      this.setVisible(!this.isVisible());\n    }\n  }\n\n  /** Change the colour of the associated bubble to match its block. */\n  applyColour() {\n    if (this.bubble_ && this.isVisible()) {\n      this.bubble_.setColour(this.getBlock().style.colourPrimary);\n    }\n  }\n\n  /**\n   * Notification that the icon has moved.  Update the arrow accordingly.\n   *\n   * @param xy Absolute location in workspace coordinates.\n   */\n  setIconLocation(xy: Coordinate) {\n    this.iconXY_ = xy;\n    if (this.bubble_ && this.isVisible()) {\n      this.bubble_.setAnchorLocation(xy);\n    }\n  }\n\n  /**\n   * Notification that the icon has moved, but we don't really know where.\n   * Recompute the icon's location from scratch.\n   */\n  computeIconLocation() {\n    // Find coordinates for the centre of the icon and update the arrow.\n    const blockXY = this.getBlock().getRelativeToSurfaceXY();\n    const iconXY = svgMath.getRelativeXY(this.iconGroup_ as SVGElement);\n    const newXY = new Coordinate(\n        blockXY.x + iconXY.x + this.SIZE / 2,\n        blockXY.y + iconXY.y + this.SIZE / 2);\n    if (!Coordinate.equals(this.getIconLocation(), newXY)) {\n      this.setIconLocation(newXY);\n    }\n  }\n\n  /**\n   * Returns the center of the block's icon relative to the surface.\n   *\n   * @returns Object with x and y properties in workspace coordinates.\n   */\n  getIconLocation(): Coordinate|null {\n    return this.iconXY_;\n  }\n\n  /**\n   * Get the size of the icon as used for rendering.\n   * This differs from the actual size of the icon, because it bulges slightly\n   * out of its row rather than increasing the height of its row.\n   *\n   * @returns Height and width.\n   */\n  getCorrectedSize(): Size {\n    // TODO (#2562): Remove getCorrectedSize.\n    return new Size(this.SIZE, this.SIZE - 2);\n  }\n\n  /**\n   * Draw the icon.\n   *\n   * @param _group The icon group.\n   */\n  protected drawIcon_(_group: Element) {}\n  // No-op on base class.\n\n  /**\n   * Show or hide the bubble.\n   *\n   * @param _visible True if the bubble should be visible.\n   */\n  setVisible(_visible: boolean) {}\n\n  /**\n   * @returns The block this icon is attached to.\n   */\n  protected getBlock(): BlockSvg {\n    if (!this.block_) {\n      throw new Error('Block is not set for this icon.');\n    }\n\n    return this.block_;\n  }\n}\n// No-op on base class\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a theme.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Theme');\n\nimport * as registry from './registry.js';\nimport * as object from './utils/object.js';\n\n\nexport interface ITheme {\n  blockStyles?: {[key: string]: Partial<BlockStyle>};\n  categoryStyles?: {[key: string]: CategoryStyle};\n  componentStyles?: ComponentStyle;\n  fontStyle?: FontStyle;\n  startHats?: boolean;\n  base?: string|Theme;\n  name: string;\n}\n\n/**\n * Class for a theme.\n */\nexport class Theme implements ITheme {\n  /** @internal */\n  blockStyles: {[key: string]: BlockStyle};\n  /** @internal */\n  categoryStyles: {[key: string]: CategoryStyle};\n  /** @internal */\n  componentStyles: ComponentStyle;\n  /** @internal */\n  fontStyle: FontStyle;\n\n  /**\n   * Whether or not to add a 'hat' on top of all blocks with no previous or\n   * output connections.\n   *\n   * @internal\n   */\n  startHats?: boolean = false;\n\n  /**\n   * @param name Theme name.\n   * @param opt_blockStyles A map from style names (strings) to objects with\n   *     style attributes for blocks.\n   * @param opt_categoryStyles A map from style names (strings) to objects with\n   *     style attributes for categories.\n   * @param opt_componentStyles A map of Blockly component names to style value.\n   */\n  constructor(\n      public name: string,\n      opt_blockStyles?: {[key: string]: Partial<BlockStyle>},\n      opt_categoryStyles?: {[key: string]: CategoryStyle},\n      opt_componentStyles?: ComponentStyle) {\n    /** The block styles map. */\n    this.blockStyles = opt_blockStyles || Object.create(null);\n\n    /** The category styles map. */\n    this.categoryStyles = opt_categoryStyles || Object.create(null);\n\n    /** The UI components styles map. */\n    this.componentStyles =\n        opt_componentStyles || Object.create(null) as ComponentStyle;\n\n    /** The font style. */\n    this.fontStyle = Object.create(null) as FontStyle;\n\n    // Register the theme by name.\n    registry.register(registry.Type.THEME, name, this);\n  }\n\n  /**\n   * Gets the class name that identifies this theme.\n   *\n   * @returns The CSS class name.\n   * @internal\n   */\n  getClassName(): string {\n    return this.name + '-theme';\n  }\n\n  /**\n   * Overrides or adds a style to the blockStyles map.\n   *\n   * @param blockStyleName The name of the block style.\n   * @param blockStyle The block style.\n   */\n  setBlockStyle(blockStyleName: string, blockStyle: BlockStyle) {\n    this.blockStyles[blockStyleName] = blockStyle;\n  }\n\n  /**\n   * Overrides or adds a style to the categoryStyles map.\n   *\n   * @param categoryStyleName The name of the category style.\n   * @param categoryStyle The category style.\n   */\n  setCategoryStyle(categoryStyleName: string, categoryStyle: CategoryStyle) {\n    this.categoryStyles[categoryStyleName] = categoryStyle;\n  }\n\n  /**\n   * Gets the style for a given Blockly UI component.  If the style value is a\n   * string, we attempt to find the value of any named references.\n   *\n   * @param componentName The name of the component.\n   * @returns The style value.\n   */\n  getComponentStyle(componentName: string): string|null {\n    const style = (this.componentStyles as AnyDuringMigration)[componentName];\n    if (!style) {\n      return null;\n    }\n    if (typeof style === 'string') {\n      const recursiveStyle = this.getComponentStyle(style);\n      if (recursiveStyle) {\n        return recursiveStyle;\n      }\n    }\n    return `${style}`;\n  }\n\n  /**\n   * Configure a specific Blockly UI component with a style value.\n   *\n   * @param componentName The name of the component.\n   * @param styleValue The style value.\n   */\n  setComponentStyle(componentName: string, styleValue: AnyDuringMigration) {\n    (this.componentStyles as AnyDuringMigration)[componentName] = styleValue;\n  }\n\n  /**\n   * Configure a theme's font style.\n   *\n   * @param fontStyle The font style.\n   */\n  setFontStyle(fontStyle: FontStyle) {\n    this.fontStyle = fontStyle;\n  }\n\n  /**\n   * Configure a theme's start hats.\n   *\n   * @param startHats True if the theme enables start hats, false otherwise.\n   */\n  setStartHats(startHats: boolean) {\n    this.startHats = startHats;\n  }\n\n  /**\n   * Define a new Blockly theme.\n   *\n   * @param name The name of the theme.\n   * @param themeObj An object containing theme properties.\n   * @returns A new Blockly theme.\n   */\n  static defineTheme(name: string, themeObj: ITheme): Theme {\n    name = name.toLowerCase();\n    const theme = new Theme(name);\n    let base = themeObj['base'];\n    if (base) {\n      if (typeof base === 'string') {\n        base = registry.getObject(registry.Type.THEME, base) ?? undefined;\n      }\n      if (base instanceof Theme) {\n        object.deepMerge(theme, base);\n        theme.name = name;\n      }\n    }\n\n    object.deepMerge(theme.blockStyles, themeObj['blockStyles']);\n    object.deepMerge(theme.categoryStyles, themeObj['categoryStyles']);\n    object.deepMerge(theme.componentStyles, themeObj['componentStyles']);\n    object.deepMerge(theme.fontStyle, themeObj['fontStyle']);\n    if (themeObj['startHats'] !== null) {\n      theme.startHats = themeObj['startHats'];\n    }\n\n    return theme;\n  }\n}\n\nexport namespace Theme {\n  export interface BlockStyle {\n    colourPrimary: string;\n    colourSecondary: string;\n    colourTertiary: string;\n    hat: string;\n  }\n\n  export interface CategoryStyle {\n    colour: string;\n  }\n\n  export interface ComponentStyle {\n    workspaceBackgroundColour?: string;\n    toolboxBackgroundColour?: string;\n    toolboxForegroundColour?: string;\n    flyoutBackgroundColour?: string;\n    flyoutForegroundColour?: string;\n    flyoutOpacity?: number;\n    scrollbarColour?: string;\n    scrollbarOpacity?: number;\n    insertionMarkerColour?: string;\n    insertionMarkerOpacity?: number;\n    markerColour?: string;\n    cursorColour?: string;\n    selectedGlowColour?: string;\n    selectedGlowOpacity?: number;\n    replacementGlowColour?: string;\n    replacementGlowOpacity?: number;\n  }\n\n  export interface FontStyle {\n    family?: string;\n    weight?: string;\n    size?: number;\n  }\n}\n\nexport type BlockStyle = Theme.BlockStyle;\nexport type CategoryStyle = Theme.CategoryStyle;\nexport type ComponentStyle = Theme.ComponentStyle;\nexport type FontStyle = Theme.FontStyle;\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Themes.Classic');\n\nimport {Theme} from '../theme.js';\n\n\nconst defaultBlockStyles = {\n  'colour_blocks': {'colourPrimary': '20'},\n  'list_blocks': {'colourPrimary': '260'},\n  'logic_blocks': {'colourPrimary': '210'},\n  'loop_blocks': {'colourPrimary': '120'},\n  'math_blocks': {'colourPrimary': '230'},\n  'procedure_blocks': {'colourPrimary': '290'},\n  'text_blocks': {'colourPrimary': '160'},\n  'variable_blocks': {'colourPrimary': '330'},\n  'variable_dynamic_blocks': {'colourPrimary': '310'},\n  'hat_blocks': {'colourPrimary': '330', 'hat': 'cap'},\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '20'},\n  'list_category': {'colour': '260'},\n  'logic_category': {'colour': '210'},\n  'loop_category': {'colour': '120'},\n  'math_category': {'colour': '230'},\n  'procedure_category': {'colour': '290'},\n  'text_category': {'colour': '160'},\n  'variable_category': {'colour': '330'},\n  'variable_dynamic_category': {'colour': '310'},\n};\n\n/**\n * Classic theme.\n * Contains multi-coloured border to create shadow effect.\n */\nexport const Classic = new Theme(\n    'classic', defaultBlockStyles as AnyDuringMigration, categoryStyles);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object that controls settings for the workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Options');\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as registry from './registry.js';\nimport {Theme} from './theme.js';\nimport {Classic} from './theme/classic.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport type {Metrics} from './utils/metrics.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Parse the user-specified options, using reasonable defaults where behaviour\n * is unspecified.\n */\nexport class Options {\n  RTL: boolean;\n  oneBasedIndex: boolean;\n  collapse: boolean;\n  comments: boolean;\n  disable: boolean;\n  readOnly: boolean;\n  maxBlocks: number;\n  maxInstances: {[key: string]: number}|null;\n  modalInputs: boolean;\n  pathToMedia: string;\n  hasCategories: boolean;\n  moveOptions: MoveOptions;\n  hasScrollbars: boolean;\n  hasTrashcan: boolean;\n  maxTrashcanContents: number;\n  hasSounds: boolean;\n  hasCss: boolean;\n  horizontalLayout: boolean;\n  languageTree: toolbox.ToolboxInfo|null;\n  gridOptions: GridOptions;\n  zoomOptions: ZoomOptions;\n  toolboxPosition: toolbox.Position;\n  theme: Theme;\n  renderer: string;\n  rendererOverrides: {[rendererConstant: string]: any}|null;\n\n  /**\n   * The SVG element for the grid pattern.\n   * Created during injection.\n   */\n  gridPattern: SVGElement|null = null;\n  parentWorkspace: WorkspaceSvg|null;\n  plugins: {[key: string]: (new(...p1: any[]) => any)|string};\n\n  /**\n   * If set, sets the translation of the workspace to match the scrollbars.\n   * A function that\n   *     sets the translation of the workspace to match the scrollbars. The\n   *     argument Contains an x and/or y property which is a float between 0\n   *     and 1 specifying the degree of scrolling.\n   */\n  setMetrics?: ((p1: {x?: number, y?: number}) => void) = undefined;\n\n  /**\n   * A function that returns a metrics\n   *     object that describes the current workspace.\n   */\n  getMetrics?: (() => Metrics) = undefined;\n\n  /**\n   * @param options Dictionary of options.\n   *     Specification:\n   * https://developers.google.com/blockly/guides/get-started/web#configuration\n   */\n  constructor(options: BlocklyOptions) {\n    let toolboxJsonDef = null;\n    let hasCategories = false;\n    let hasTrashcan = false;\n    let hasCollapse = false;\n    let hasComments = false;\n    let hasDisable = false;\n    let hasSounds = false;\n    const readOnly = !!options['readOnly'];\n    if (!readOnly) {\n      toolboxJsonDef =\n          toolbox.convertToolboxDefToJson(options['toolbox'] ?? null);\n      hasCategories = toolbox.hasCategories(toolboxJsonDef);\n      const rawHasTrashcan = options['trashcan'];\n      hasTrashcan =\n          rawHasTrashcan === undefined ? hasCategories : rawHasTrashcan;\n      const rawHasCollapse = options['collapse'];\n      hasCollapse =\n          rawHasCollapse === undefined ? hasCategories : rawHasCollapse;\n      const rawHasComments = options['comments'];\n      hasComments =\n          rawHasComments === undefined ? hasCategories : rawHasComments;\n      const rawHasDisable = options['disable'];\n      hasDisable = rawHasDisable === undefined ? hasCategories : rawHasDisable;\n      const rawHasSounds = options['sounds'];\n      hasSounds = rawHasSounds === undefined ? true : rawHasSounds;\n    }\n\n    let maxTrashcanContents = options['maxTrashcanContents'];\n    if (hasTrashcan) {\n      if (maxTrashcanContents === undefined) {\n        maxTrashcanContents = 32;\n      }\n    } else {\n      maxTrashcanContents = 0;\n    }\n    const rtl = !!options['rtl'];\n    let horizontalLayout = options['horizontalLayout'];\n    if (horizontalLayout === undefined) {\n      horizontalLayout = false;\n    }\n    const toolboxAtStart = options['toolboxPosition'] !== 'end';\n\n    let toolboxPosition: toolbox.Position;\n    if (horizontalLayout) {\n      toolboxPosition =\n          toolboxAtStart ? toolbox.Position.TOP : toolbox.Position.BOTTOM;\n    } else {\n      toolboxPosition = toolboxAtStart === rtl ? toolbox.Position.RIGHT :\n                                                 toolbox.Position.LEFT;\n    }\n\n    let hasCss = options['css'];\n    if (hasCss === undefined) {\n      hasCss = true;\n    }\n    let pathToMedia = 'https://blockly-demo.appspot.com/static/media/';\n    if (options['media']) {\n      pathToMedia = options['media'].endsWith('/') ? options['media'] :\n                                                     options['media'] + '/';\n    } else if ('path' in options) {\n      // 'path' is a deprecated option which has been replaced by 'media'.\n      deprecation.warn('path', 'Nov 2014', 'Jul 2023', 'media');\n      pathToMedia = (options as any)['path'] + 'media/';\n    }\n    const rawOneBasedIndex = options['oneBasedIndex'];\n    const oneBasedIndex =\n        rawOneBasedIndex === undefined ? true : rawOneBasedIndex;\n    const renderer = options['renderer'] || 'geras';\n\n    const plugins = options['plugins'] || {};\n\n    let modalInputs = options['modalInputs'];\n    if (modalInputs === undefined) {\n      modalInputs = true;\n    }\n\n    this.RTL = rtl;\n    this.oneBasedIndex = oneBasedIndex;\n    this.collapse = hasCollapse;\n    this.comments = hasComments;\n    this.disable = hasDisable;\n    this.readOnly = readOnly;\n    this.maxBlocks = options['maxBlocks'] || Infinity;\n    this.maxInstances = options['maxInstances'] ?? null;\n    this.modalInputs = modalInputs;\n    this.pathToMedia = pathToMedia;\n    this.hasCategories = hasCategories;\n    this.moveOptions = Options.parseMoveOptions_(options, hasCategories);\n    /** @deprecated  January 2019 */\n    this.hasScrollbars = !!this.moveOptions.scrollbars;\n    this.hasTrashcan = hasTrashcan;\n    this.maxTrashcanContents = maxTrashcanContents;\n    this.hasSounds = hasSounds;\n    this.hasCss = hasCss;\n    this.horizontalLayout = horizontalLayout;\n    this.languageTree = toolboxJsonDef;\n    this.gridOptions = Options.parseGridOptions_(options);\n    this.zoomOptions = Options.parseZoomOptions_(options);\n    this.toolboxPosition = toolboxPosition;\n    this.theme = Options.parseThemeOptions_(options);\n    this.renderer = renderer;\n    this.rendererOverrides = options['rendererOverrides'] ?? null;\n\n    /**\n     * The parent of the current workspace, or null if there is no parent\n     * workspace.  We can assert that this is of type WorkspaceSvg as opposed to\n     * Workspace as this is only used in a rendered workspace.\n     */\n    this.parentWorkspace = options['parentWorkspace'] ?? null;\n\n    /** Map of plugin type to name of registered plugin or plugin class. */\n    this.plugins = plugins;\n  }\n\n  /**\n   * Parse the user-specified move options, using reasonable defaults where\n   *    behaviour is unspecified.\n   *\n   * @param options Dictionary of options.\n   * @param hasCategories Whether the workspace has categories or not.\n   * @returns Normalized move options.\n   */\n  private static parseMoveOptions_(\n      options: BlocklyOptions, hasCategories: boolean): MoveOptions {\n    const move = options['move'] || {};\n    const moveOptions = {} as MoveOptions;\n    if (move['scrollbars'] === undefined &&\n        options['scrollbars'] === undefined) {\n      moveOptions.scrollbars = hasCategories;\n    } else if (typeof move['scrollbars'] === 'object') {\n      moveOptions.scrollbars = {\n        'horizontal': !!move['scrollbars']['horizontal'],\n        'vertical': !!move['scrollbars']['vertical'],\n      };\n      // Convert scrollbars object to boolean if they have the same value.\n      // This allows us to easily check for whether any scrollbars exist using\n      // !!moveOptions.scrollbars.\n      if (moveOptions.scrollbars.horizontal &&\n          moveOptions.scrollbars.vertical) {\n        moveOptions.scrollbars = true;\n      } else if (\n          !moveOptions.scrollbars.horizontal &&\n          !moveOptions.scrollbars.vertical) {\n        moveOptions.scrollbars = false;\n      }\n    } else {\n      moveOptions.scrollbars = !!move['scrollbars'] || !!options['scrollbars'];\n    }\n\n    if (!moveOptions.scrollbars || move['wheel'] === undefined) {\n      // Defaults to true if single-direction scroll is enabled.\n      moveOptions.wheel = typeof moveOptions.scrollbars === 'object';\n    } else {\n      moveOptions.wheel = !!move['wheel'];\n    }\n    if (!moveOptions.scrollbars) {\n      moveOptions.drag = false;\n    } else if (move['drag'] === undefined) {\n      // Defaults to true if scrollbars is true.\n      moveOptions.drag = true;\n    } else {\n      moveOptions.drag = !!move['drag'];\n    }\n    return moveOptions;\n  }\n\n  /**\n   * Parse the user-specified zoom options, using reasonable defaults where\n   * behaviour is unspecified.  See zoom documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/zoom\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized zoom options.\n   */\n  private static parseZoomOptions_(options: BlocklyOptions): ZoomOptions {\n    const zoom = options['zoom'] || {};\n    const zoomOptions = {} as ZoomOptions;\n    if (zoom['controls'] === undefined) {\n      zoomOptions.controls = false;\n    } else {\n      zoomOptions.controls = !!zoom['controls'];\n    }\n    if (zoom['wheel'] === undefined) {\n      zoomOptions.wheel = false;\n    } else {\n      zoomOptions.wheel = !!zoom['wheel'];\n    }\n    if (zoom['startScale'] === undefined) {\n      zoomOptions.startScale = 1;\n    } else {\n      zoomOptions.startScale = Number(zoom['startScale']);\n    }\n    if (zoom['maxScale'] === undefined) {\n      zoomOptions.maxScale = 3;\n    } else {\n      zoomOptions.maxScale = Number(zoom['maxScale']);\n    }\n    if (zoom['minScale'] === undefined) {\n      zoomOptions.minScale = 0.3;\n    } else {\n      zoomOptions.minScale = Number(zoom['minScale']);\n    }\n    if (zoom['scaleSpeed'] === undefined) {\n      zoomOptions.scaleSpeed = 1.2;\n    } else {\n      zoomOptions.scaleSpeed = Number(zoom['scaleSpeed']);\n    }\n    if (zoom['pinch'] === undefined) {\n      zoomOptions.pinch = zoomOptions.wheel || zoomOptions.controls;\n    } else {\n      zoomOptions.pinch = !!zoom['pinch'];\n    }\n    return zoomOptions;\n  }\n\n  /**\n   * Parse the user-specified grid options, using reasonable defaults where\n   * behaviour is unspecified. See grid documentation:\n   *   https://developers.google.com/blockly/guides/configure/web/grid\n   *\n   * @param options Dictionary of options.\n   * @returns Normalized grid options.\n   */\n  private static parseGridOptions_(options: BlocklyOptions): GridOptions {\n    const grid = options['grid'] || {};\n    const gridOptions = {} as GridOptions;\n    gridOptions.spacing = Number(grid['spacing']) || 0;\n    gridOptions.colour = grid['colour'] || '#888';\n    gridOptions.length =\n        grid['length'] === undefined ? 1 : Number(grid['length']);\n    gridOptions.snap = gridOptions.spacing > 0 && !!grid['snap'];\n    return gridOptions;\n  }\n\n  /**\n   * Parse the user-specified theme options, using the classic theme as a\n   * default. https://developers.google.com/blockly/guides/configure/web/themes\n   *\n   * @param options Dictionary of options.\n   * @returns A Blockly Theme.\n   */\n  private static parseThemeOptions_(options: BlocklyOptions): Theme {\n    const theme = options['theme'] || Classic;\n    if (typeof theme === 'string') {\n      return registry.getObject(registry.Type.THEME, theme) as Theme;\n    } else if (theme instanceof Theme) {\n      return theme;\n    }\n    return Theme.defineTheme(\n        theme.name || 'builtin' + idGenerator.getNextUniqueId(), theme);\n  }\n}\n\nexport namespace Options {\n  export interface GridOptions {\n    colour: string;\n    length: number;\n    snap: boolean;\n    spacing: number;\n  }\n\n  export interface MoveOptions {\n    drag: boolean;\n    scrollbars: boolean|ScrollbarOptions;\n    wheel: boolean;\n  }\n\n  export interface ScrollbarOptions {\n    horizontal: boolean;\n    vertical: boolean;\n  }\n\n  export interface ZoomOptions {\n    controls: boolean;\n    maxScale: number;\n    minScale: number;\n    pinch: boolean;\n    scaleSpeed: number;\n    startScale: number;\n    wheel: boolean;\n  }\n}\n\nexport type GridOptions = Options.GridOptions;\nexport type MoveOptions = Options.MoveOptions;\nexport type ScrollbarOptions = Options.ScrollbarOptions;\nexport type ZoomOptions = Options.ZoomOptions;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a mutator dialog.  A mutator allows the\n * user to change the shape of a block using a nested blocks editor.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Mutator');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_bubble_open.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport {Bubble} from './bubble.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport {BlockChange} from './events/events_block_change.js';\nimport * as eventUtils from './events/utils.js';\nimport {Icon} from './icon.js';\nimport {Options} from './options.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as xml from './utils/xml.js';\nimport * as deprecation from './utils/deprecation.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a mutator dialog.\n */\nexport class Mutator extends Icon {\n  private quarkNames: string[];\n\n  /**\n   * Workspace in the mutator's bubble.\n   * Due to legacy code in procedure block definitions, this name\n   * cannot change.\n   */\n  private workspace_: WorkspaceSvg|null = null;\n\n  /** Width of workspace. */\n  private workspaceWidth = 0;\n\n  /** Height of workspace. */\n  private workspaceHeight = 0;\n\n  /**\n   * The SVG element that is the parent of the mutator workspace, or null if\n   * not created.\n   */\n  private svgDialog: SVGSVGElement|null = null;\n\n  /**\n   * The root block of the mutator workspace, created by decomposing the\n   * source block.\n   */\n  private rootBlock: BlockSvg|null = null;\n\n  /**\n   * Function registered on the main workspace to update the mutator contents\n   * when the main workspace changes.\n   */\n  private sourceListener: Function|null = null;\n\n  /**\n   * The PID associated with the updateWorkpace_ timeout, or null if no timeout\n   * is currently running.\n   */\n  private updateWorkspacePid: ReturnType<typeof setTimeout>|null = null;\n\n  /** @param quarkNames List of names of sub-blocks for flyout. */\n  constructor(quarkNames: string[], block?: BlockSvg) {\n    if (!block) {\n      deprecation.warn(\n          'Calling the Mutator constructor without passing the block it is attached to',\n          'version 9', 'version 10',\n          'the constructor by passing the list of subblocks and the block instance to attach the mutator to');\n    }\n    super(block ?? null);\n    this.quarkNames = quarkNames;\n  }\n\n  /**\n   * Set the block this mutator is associated with.\n   *\n   * @param block The block associated with this mutator.\n   * @internal\n   */\n  setBlock(block: BlockSvg) {\n    this.block_ = block;\n  }\n\n  /**\n   * Returns the workspace inside this mutator icon's bubble.\n   *\n   * @returns The workspace inside this mutator icon's bubble or null if the\n   *     mutator isn't open.\n   * @internal\n   */\n  getWorkspace(): WorkspaceSvg|null {\n    return this.workspace_;\n  }\n\n  /**\n   * Draw the mutator icon.\n   *\n   * @param group The icon group.\n   */\n  protected override drawIcon_(group: Element) {\n    // Square with rounded corners.\n    dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyIconShape',\n          'rx': '4',\n          'ry': '4',\n          'height': '16',\n          'width': '16',\n        },\n        group);\n    // Gear teeth.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconSymbol',\n          'd': 'm4.203,7.296 0,1.368 -0.92,0.677 -0.11,0.41 0.9,1.559 0.41,' +\n              '0.11 1.043,-0.457 1.187,0.683 0.127,1.134 0.3,0.3 1.8,0 0.3,' +\n              '-0.299 0.127,-1.138 1.185,-0.682 1.046,0.458 0.409,-0.11 0.9,' +\n              '-1.559 -0.11,-0.41 -0.92,-0.677 0,-1.366 0.92,-0.677 0.11,' +\n              '-0.41 -0.9,-1.559 -0.409,-0.109 -1.046,0.458 -1.185,-0.682 ' +\n              '-0.127,-1.138 -0.3,-0.299 -1.8,0 -0.3,0.3 -0.126,1.135 -1.187,' +\n              '0.682 -1.043,-0.457 -0.41,0.11 -0.899,1.559 0.108,0.409z',\n        },\n        group);\n    // Axle hole.\n    dom.createSvgElement(\n        Svg.CIRCLE,\n        {'class': 'blocklyIconShape', 'r': '2.7', 'cx': '8', 'cy': '8'}, group);\n  }\n\n  /**\n   * Clicking on the icon toggles if the mutator bubble is visible.\n   * Disable if block is uneditable.\n   *\n   * @param e Mouse click event.\n   */\n  protected override iconClick_(e: PointerEvent) {\n    if (this.getBlock().isEditable()) {\n      super.iconClick_(e);\n    }\n  }\n\n  /**\n   * Create the editor for the mutator's bubble.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor(): SVGSVGElement {\n    /* Create the editor.  Here's the markup that will be generated:\n        <svg>\n          [Workspace]\n        </svg>\n        */\n    this.svgDialog = dom.createSvgElement(\n        Svg.SVG, {'x': Bubble.BORDER_WIDTH, 'y': Bubble.BORDER_WIDTH});\n    // Convert the list of names into a list of XML objects for the flyout.\n    let quarkXml;\n    if (this.quarkNames.length) {\n      quarkXml = xml.createElement('xml');\n      for (let i = 0, quarkName; quarkName = this.quarkNames[i]; i++) {\n        const element = xml.createElement('block');\n        element.setAttribute('type', quarkName);\n        quarkXml.appendChild(element);\n      }\n    } else {\n      quarkXml = null;\n    }\n    const block = this.getBlock();\n    const workspaceOptions = new Options(({\n      // If you want to enable disabling, also remove the\n      // event filter from workspaceChanged_ .\n      'disable': false,\n      'parentWorkspace': block.workspace,\n      'media': block.workspace.options.pathToMedia,\n      'rtl': block.RTL,\n      'horizontalLayout': false,\n      'renderer': block.workspace.options.renderer,\n      'rendererOverrides': block.workspace.options.rendererOverrides,\n    } as BlocklyOptions));\n    workspaceOptions.toolboxPosition =\n        block.RTL ? toolbox.Position.RIGHT : toolbox.Position.LEFT;\n    const hasFlyout = !!quarkXml;\n    if (hasFlyout) {\n      workspaceOptions.languageTree = toolbox.convertToolboxDefToJson(quarkXml);\n    }\n    this.workspace_ = this.newWorkspaceSvg(workspaceOptions);\n    this.workspace_.internalIsMutator = true;\n    this.workspace_.addChangeListener(eventUtils.disableOrphans);\n\n    // Mutator flyouts go inside the mutator workspace's <g> rather than in\n    // a top level SVG. Instead of handling scale themselves, mutators\n    // inherit scale from the parent workspace.\n    // To fix this, scale needs to be applied at a different level in the DOM.\n    const flyoutSvg = hasFlyout ? this.workspace_.addFlyout(Svg.G) : null;\n    const background = this.workspace_.createDom('blocklyMutatorBackground');\n\n    if (flyoutSvg) {\n      // Insert the flyout after the <rect> but before the block canvas so that\n      // the flyout is underneath in z-order.  This makes blocks layering during\n      // dragging work properly.\n      background.insertBefore(flyoutSvg, this.workspace_.svgBlockCanvas_);\n    }\n    this.svgDialog.appendChild(background);\n\n    return this.svgDialog;\n  }\n\n  /**\n   * @internal\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  newWorkspaceSvg(options: Options): WorkspaceSvg {\n    throw new Error(\n        'The implementation of newWorkspaceSvg should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /** Add or remove the UI indicating if this icon may be clicked or not. */\n  override updateEditable() {\n    super.updateEditable();\n    if (!this.getBlock().isInFlyout) {\n      if (this.getBlock().isEditable()) {\n        if (this.iconGroup_) {\n          dom.removeClass(this.iconGroup_, 'blocklyIconGroupReadonly');\n        }\n      } else {\n        // Close any mutator bubble.  Icon is not clickable.\n        this.setVisible(false);\n        if (this.iconGroup_) {\n          dom.addClass(this.iconGroup_, 'blocklyIconGroupReadonly');\n        }\n      }\n    }\n  }\n\n  /** Resize the bubble to match the size of the workspace. */\n  private resizeBubble() {\n    // If the bubble exists, the workspace also exists.\n    if (!this.workspace_) {\n      return;\n    }\n    const doubleBorderWidth = 2 * Bubble.BORDER_WIDTH;\n    const canvas = this.workspace_.getCanvas();\n    const workspaceSize = canvas.getBBox();\n    let width = workspaceSize.width + workspaceSize.x;\n    let height = workspaceSize.height + doubleBorderWidth * 3;\n    const flyout = this.workspace_.getFlyout();\n    if (flyout) {\n      const flyoutScrollMetrics =\n          flyout.getWorkspace().getMetricsManager().getScrollMetrics();\n      height = Math.max(height, flyoutScrollMetrics.height + 20);\n      width += flyout.getWidth();\n    }\n    const isRtl = this.getBlock().RTL;\n    if (isRtl) {\n      width = -workspaceSize.x;\n    }\n    width += doubleBorderWidth * 3;\n    // Only resize if the size difference is significant.  Eliminates\n    // shuddering.\n    if (Math.abs(this.workspaceWidth - width) > doubleBorderWidth ||\n        Math.abs(this.workspaceHeight - height) > doubleBorderWidth) {\n      // Record some layout information for workspace metrics.\n      this.workspaceWidth = width;\n      this.workspaceHeight = height;\n      // Resize the bubble.\n      this.bubble_!.setBubbleSize(\n          width + doubleBorderWidth, height + doubleBorderWidth);\n      this.svgDialog!.setAttribute('width', `${width}`);\n      this.svgDialog!.setAttribute('height', `${height}`);\n      this.workspace_.setCachedParentSvgSize(width, height);\n    }\n\n    if (isRtl) {\n      // Scroll the workspace to always left-align.\n      canvas.setAttribute('transform', `translate(${this.workspaceWidth}, 0)`);\n    }\n    this.workspace_.resize();\n  }\n\n  /** A method handler for when the bubble is moved. */\n  private onBubbleMove() {\n    if (this.workspace_) {\n      this.workspace_.recordDragTargets();\n    }\n  }\n\n  /**\n   * Show or hide the mutator bubble.\n   *\n   * @param visible True if the bubble should be visible.\n   */\n  override setVisible(visible: boolean) {\n    if (visible === this.isVisible()) {\n      // No change.\n      return;\n    }\n    const block = this.getBlock();\n    if (visible) {\n      // Create the bubble.\n      this.bubble_ = new Bubble(\n          block.workspace, this.createEditor(), block.pathObject.svgPath,\n          (this.iconXY_ as Coordinate), null, null);\n      // The workspace was created in createEditor.\n      const ws = this.workspace_!;\n      // Expose this mutator's block's ID on its top-level SVG group.\n      this.bubble_.setSvgId(block.id);\n      this.bubble_.registerMoveEvent(this.onBubbleMove.bind(this));\n      const tree = ws.options.languageTree;\n      const flyout = ws.getFlyout();\n      if (tree) {\n        flyout!.init(ws);\n        flyout!.show(tree);\n      }\n\n      this.rootBlock = block.decompose!(ws)!;\n      const blocks = this.rootBlock.getDescendants(false);\n      for (let i = 0, child; child = blocks[i]; i++) {\n        child.render();\n      }\n      // The root block should not be draggable or deletable.\n      this.rootBlock.setMovable(false);\n      this.rootBlock.setDeletable(false);\n      let margin;\n      let x;\n      if (flyout) {\n        margin = flyout.CORNER_RADIUS * 2;\n        x = this.rootBlock.RTL ? flyout.getWidth() + margin : margin;\n      } else {\n        margin = 16;\n        x = margin;\n      }\n      if (block.RTL) {\n        x = -x;\n      }\n      this.rootBlock.moveBy(x, margin);\n      // Save the initial connections, then listen for further changes.\n      if (block.saveConnections) {\n        const thisRootBlock = this.rootBlock;\n        block.saveConnections(thisRootBlock);\n        this.sourceListener = () => {\n          const currentBlock = this.getBlock();\n          if (currentBlock.saveConnections) {\n            currentBlock.saveConnections(thisRootBlock);\n          }\n        };\n        block.workspace.addChangeListener(this.sourceListener);\n      }\n      this.resizeBubble();\n      // When the mutator's workspace changes, update the source block.\n      const boundListener = this.workspaceChanged.bind(this);\n      ws.addChangeListener(boundListener);\n      if (flyout) flyout.getWorkspace().addChangeListener(boundListener);\n      // Update the source block immediately after the bubble becomes visible.\n      this.updateWorkspace();\n      this.applyColour();\n    } else {\n      // Dispose of the bubble.\n      this.svgDialog = null;\n      this.workspace_!.dispose();\n      this.workspace_ = null;\n      this.rootBlock = null;\n      this.bubble_?.dispose();\n      this.bubble_ = null;\n      this.workspaceWidth = 0;\n      this.workspaceHeight = 0;\n      if (this.sourceListener) {\n        block.workspace.removeChangeListener(this.sourceListener);\n        this.sourceListener = null;\n      }\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        block, visible, 'mutator'));\n  }\n\n  /**\n   * Fired whenever a change is made to the mutator's workspace.\n   *\n   * @param e Custom data for event.\n   */\n  private workspaceChanged(e: Abstract) {\n    if (!this.shouldIgnoreMutatorEvent_(e) && !this.updateWorkspacePid) {\n      this.updateWorkspacePid = setTimeout(() => {\n        this.updateWorkspacePid = null;\n        this.updateWorkspace();\n      }, 0);\n    }\n  }\n\n  /**\n   * Returns whether the given event in the mutator workspace should be ignored\n   * when deciding whether to update the workspace and compose the block or not.\n   *\n   * @param e The event.\n   * @returns Whether to ignore the event or not.\n   */\n  shouldIgnoreMutatorEvent_(e: Abstract) {\n    return e.isUiEvent || e.type === eventUtils.CREATE ||\n        e.type === eventUtils.CHANGE &&\n        (e as BlockChange).element === 'disabled';\n  }\n\n  /**\n   * Updates the source block when the mutator's blocks are changed.\n   * Bump down any block that's too high.\n   */\n  private updateWorkspace() {\n    if (!this.workspace_!.isDragging()) {\n      const blocks = this.workspace_!.getTopBlocks(false);\n      const MARGIN = 20;\n\n      for (let b = 0, block; block = blocks[b]; b++) {\n        const blockXY = block.getRelativeToSurfaceXY();\n\n        // Bump any block that's above the top back inside.\n        if (blockXY.y < MARGIN) {\n          block.moveBy(0, MARGIN - blockXY.y);\n        }\n        // Bump any block overlapping the flyout back inside.\n        if (block.RTL) {\n          let right = -MARGIN;\n          const flyout = this.workspace_!.getFlyout();\n          if (flyout) {\n            right -= flyout.getWidth();\n          }\n          if (blockXY.x > right) {\n            block.moveBy(right - blockXY.x, 0);\n          }\n        } else if (blockXY.x < MARGIN) {\n          block.moveBy(MARGIN - blockXY.x, 0);\n        }\n      }\n    }\n\n    // When the mutator's workspace changes, update the source block.\n    if (this.rootBlock && this.rootBlock.workspace === this.workspace_) {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      const block = this.getBlock();\n      const oldExtraState = BlockChange.getExtraBlockState_(block);\n\n      block.compose!(this.rootBlock);\n\n      const newExtraState = BlockChange.getExtraBlockState_(block);\n      if (oldExtraState !== newExtraState) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n            block, 'mutation', null, oldExtraState, newExtraState));\n        // Ensure that any bump is part of this mutation's event group.\n        const mutationGroup = eventUtils.getGroup();\n        setTimeout(function() {\n          const oldGroup = eventUtils.getGroup();\n          eventUtils.setGroup(mutationGroup);\n          block.bumpNeighbours();\n          eventUtils.setGroup(oldGroup);\n        }, config.bumpDelay);\n      }\n\n      // Don't update the bubble until the drag has ended, to avoid moving\n      // blocks under the cursor.\n      if (!this.workspace_!.isDragging()) {\n        setTimeout(() => this.resizeBubble(), 0);\n      }\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /** Dispose of this mutator. */\n  override dispose() {\n    this.getBlock().mutator = null;\n    super.dispose();\n  }\n\n  /** Update the styles on all blocks in the mutator. */\n  updateBlockStyle() {\n    const ws = this.workspace_;\n\n    if (ws && ws.getAllBlocks(false)) {\n      const workspaceBlocks = ws.getAllBlocks(false);\n      for (let i = 0, block; block = workspaceBlocks[i]; i++) {\n        block.setStyle(block.getStyleName());\n      }\n\n      const flyout = ws.getFlyout();\n      if (flyout) {\n        const flyoutBlocks = flyout.getWorkspace().getAllBlocks(false);\n        for (let i = 0, block; block = flyoutBlocks[i]; i++) {\n          block.setStyle(block.getStyleName());\n        }\n      }\n    }\n  }\n\n  /**\n   * Reconnect an block to a mutated input.\n   *\n   * @param connectionChild Connection on child block.\n   * @param block Parent block.\n   * @param inputName Name of input on parent block.\n   * @returns True iff a reconnection was made, false otherwise.\n   */\n  static reconnect(\n      connectionChild: Connection, block: Block, inputName: string): boolean {\n    if (!connectionChild || !connectionChild.getSourceBlock().workspace) {\n      return false;  // No connection or block has been deleted.\n    }\n    const connectionParent = block.getInput(inputName)!.connection;\n    const currentParent = connectionChild.targetBlock();\n    if ((!currentParent || currentParent === block) && connectionParent &&\n        connectionParent.targetConnection !== connectionChild) {\n      if (connectionParent.isConnected()) {\n        // There's already something connected here.  Get rid of it.\n        connectionParent.disconnect();\n      }\n      connectionParent.connect(connectionChild);\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Get the parent workspace of a workspace that is inside a mutator, taking\n   * into account whether it is a flyout.\n   *\n   * @param workspace The workspace that is inside a mutator.\n   * @returns The mutator's parent workspace or null.\n   */\n  static findParentWs(workspace: WorkspaceSvg): WorkspaceSvg|null {\n    let outerWs = null;\n    if (workspace && workspace.options) {\n      const parent = workspace.options.parentWorkspace;\n      // If we were in a flyout in a mutator, need to go up two levels to find\n      // the actual parent.\n      if (workspace.isFlyout) {\n        if (parent && parent.options) {\n          outerWs = parent.options.parentWorkspace;\n        }\n      } else if (parent) {\n        outerWs = parent;\n      }\n    }\n    return outerWs;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, non-serializable text field.  Used for titles,\n *    labels, etc.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldLabel');\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, non-serializable text field.\n */\nexport class FieldLabel extends Field<string> {\n  /** The HTML class name to use for this field. */\n  private class_: string|null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|typeof Field.SKIP_SETUP, textClass?: string,\n      config?: FieldLabelConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.class_ = textClass || null;\n    }\n    this.setValue(value);\n  }\n\n  protected override configure_(config: FieldLabelConfig) {\n    super.configure_(config);\n    if (config.class) this.class_ = config.class;\n  }\n\n  /**\n   * Create block UI for this label.\n   *\n   * @internal\n   */\n  override initView() {\n    this.createTextElement_();\n    if (this.class_) {\n      dom.addClass(this.getTextElement(), this.class_);\n    }\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: AnyDuringMigration): string\n      |null {\n    if (newValue === null || newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Set the CSS class applied to the field's textElement_.\n   *\n   * @param cssClass The new CSS class name, or null to remove.\n   */\n  setClass(cssClass: string|null) {\n    if (this.textElement_) {\n      if (this.class_) {\n        dom.removeClass(this.textElement_, this.class_);\n      }\n      if (cssClass) {\n        dom.addClass(this.textElement_, cssClass);\n      }\n    }\n    this.class_ = cssClass;\n  }\n\n  /**\n   * Construct a FieldLabel from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldLabelFromJsonConfig): FieldLabel {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabel if that class doesn't override\n    // the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label', FieldLabel);\n\nFieldLabel.prototype.DEFAULT_VALUE = '';\n\n// clang-format off\n// Clang does not like the 'class' keyword being used as a property.\n/**\n * Config options for the label field.\n */\nexport interface FieldLabelConfig extends FieldConfig {\n  class?: string;\n}\n// clang-format on\n\n\n/**\n * fromJson config options for the label field.\n */\nexport interface FieldLabelFromJsonConfig extends FieldLabelConfig {\n  text?: string;\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing an input (value, statement, or dummy).\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Input');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './field_label.js';\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport type {Connection} from './connection.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {inputTypes} from './input_types.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n\n/**\n * Class for an input with an optional field.\n */\nexport class Input {\n  private sourceBlock: Block;\n  fieldRow: Field[] = [];\n  /** Alignment of input's fields (left, right or centre). */\n  align = Align.LEFT;\n\n  /** Is the input visible? */\n  private visible = true;\n\n  /**\n   * @param type The type of the input.\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.\n   * @param block The block containing this input.\n   * @param connection Optional connection for this input.\n   */\n  constructor(\n      public type: number, public name: string, block: Block,\n      public connection: Connection|null) {\n    if (type !== inputTypes.DUMMY && !name) {\n      throw Error(\n          'Value inputs and statement inputs must have non-empty name.');\n    }\n    this.sourceBlock = block;\n  }\n\n  /**\n   * Get the source block for this input.\n   *\n   * @returns The block this input is part of.\n   */\n  getSourceBlock(): Block {\n    return this.sourceBlock;\n  }\n\n  /**\n   * Add a field (or label from string), and all prefix and suffix fields, to\n   * the end of the input's field row.\n   *\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The input being append to (to allow chaining).\n   */\n  appendField<T>(field: string|Field<T>, opt_name?: string): Input {\n    this.insertFieldAt(this.fieldRow.length, field, opt_name);\n    return this;\n  }\n\n  /**\n   * Inserts a field (or label from string), and all prefix and suffix fields,\n   * at the location of the input's field row.\n   *\n   * @param index The index at which to insert field.\n   * @param field Something to add as a field.\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     field again.  Should be unique to the host block.\n   * @returns The index following the last inserted field.\n   */\n  insertFieldAt<T>(index: number, field: string|Field<T>, opt_name?: string):\n      number {\n    if (index < 0 || index > this.fieldRow.length) {\n      throw Error('index ' + index + ' out of bounds.');\n    }\n    // Falsy field values don't generate a field, unless the field is an empty\n    // string and named.\n    if (!field && !(field === '' && opt_name)) {\n      return index;\n    }\n\n    // Generate a FieldLabel when given a plain text field.\n    if (typeof field === 'string') {\n      field = fieldRegistry.fromJson({\n        type: 'field_label',\n        text: field,\n      })!;\n    }\n\n    field.setSourceBlock(this.sourceBlock);\n    if (this.sourceBlock.rendered) {\n      field.init();\n      field.applyColour();\n    }\n    field.name = opt_name;\n    field.setVisible(this.isVisible());\n\n    if (field.prefixField) {\n      // Add any prefix.\n      index = this.insertFieldAt(index, field.prefixField);\n    }\n    // Add the field to the field row.\n    this.fieldRow.splice(index, 0, field as Field);\n    index++;\n    if (field.suffixField) {\n      // Add any suffix.\n      index = this.insertFieldAt(index, field.suffixField);\n    }\n\n    if (this.sourceBlock.rendered) {\n      (this.sourceBlock as BlockSvg).queueRender();\n      // Adding a field will cause the block to change shape.\n      this.sourceBlock.bumpNeighbours();\n    }\n    return index;\n  }\n\n  /**\n   * Remove a field from this input.\n   *\n   * @param name The name of the field.\n   * @param opt_quiet True to prevent an error if field is not present.\n   * @returns True if operation succeeds, false if field is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the field is not present and opt_quiet is false.\n   */\n  removeField(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, field; field = this.fieldRow[i]; i++) {\n      if (field.name === name) {\n        field.dispose();\n        this.fieldRow.splice(i, 1);\n        if (this.sourceBlock.rendered) {\n          (this.sourceBlock as BlockSvg).queueRender();\n          // Removing a field will cause the block to change shape.\n          this.sourceBlock.bumpNeighbours();\n        }\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Field \"' + name + '\" not found.');\n  }\n\n  /**\n   * Gets whether this input is visible or not.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.visible;\n  }\n\n  /**\n   * Sets whether this input is visible or not.\n   * Should only be used to collapse/uncollapse a block.\n   *\n   * @param visible True if visible.\n   * @returns List of blocks to render.\n   * @internal\n   */\n  setVisible(visible: boolean): BlockSvg[] {\n    // Note: Currently there are only unit tests for block.setCollapsed()\n    // because this function is package. If this function goes back to being a\n    // public API tests (lots of tests) should be added.\n    let renderList: AnyDuringMigration[] = [];\n    if (this.visible === visible) {\n      return renderList;\n    }\n    this.visible = visible;\n\n    for (let y = 0, field; field = this.fieldRow[y]; y++) {\n      field.setVisible(visible);\n    }\n    if (this.connection) {\n      const renderedConnection = this.connection as RenderedConnection;\n      // Has a connection.\n      if (visible) {\n        renderList = renderedConnection.startTrackingAll();\n      } else {\n        renderedConnection.stopTrackingAll();\n      }\n      const child = renderedConnection.targetBlock();\n      if (child) {\n        child.getSvgRoot().style.display = visible ? 'block' : 'none';\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Mark all fields on this input as dirty.\n   *\n   * @internal\n   */\n  markDirty() {\n    for (let y = 0, field; field = this.fieldRow[y]; y++) {\n      field.markDirty();\n    }\n  }\n\n  /**\n   * Change a connection's compatibility.\n   *\n   * @param check Compatible value type or list of value types.  Null if all\n   *     types are compatible.\n   * @returns The input being modified (to allow chaining).\n   */\n  setCheck(check: string|string[]|null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setCheck(check);\n    return this;\n  }\n\n  /**\n   * Change the alignment of the connection's field(s).\n   *\n   * @param align One of the values of Align.  In RTL mode directions\n   *     are reversed, and Align.RIGHT aligns to the left.\n   * @returns The input being modified (to allow chaining).\n   */\n  setAlign(align: Align): Input {\n    this.align = align;\n    if (this.sourceBlock.rendered) {\n      const sourceBlock = this.sourceBlock as BlockSvg;\n      sourceBlock.queueRender();\n    }\n    return this;\n  }\n\n  /**\n   * Changes the connection's shadow block.\n   *\n   * @param shadow DOM representation of a block or null.\n   * @returns The input being modified (to allow chaining).\n   */\n  setShadowDom(shadow: Element|null): Input {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    this.connection.setShadowDom(shadow);\n    return this;\n  }\n\n  /**\n   * Returns the XML representation of the connection's shadow block.\n   *\n   * @returns Shadow DOM representation of a block or null.\n   */\n  getShadowDom(): Element|null {\n    if (!this.connection) {\n      throw Error('This input does not have a connection.');\n    }\n    return this.connection.getShadowDom();\n  }\n\n  /** Initialize the fields on this input. */\n  init() {\n    if (!this.sourceBlock.workspace.rendered) {\n      return;  // Headless blocks don't need fields initialized.\n    }\n    for (let i = 0; i < this.fieldRow.length; i++) {\n      this.fieldRow[i].init();\n    }\n  }\n\n  /**\n   * Sever all links to this input.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    for (let i = 0, field; field = this.fieldRow[i]; i++) {\n      field.dispose();\n    }\n    if (this.connection) {\n      this.connection.dispose();\n    }\n  }\n}\n\nexport namespace Input {\n  /**\n   * Enum for alignment of inputs.\n   *\n   */\n  export enum Align {\n    LEFT = -1,\n    CENTRE = 0,\n    RIGHT = 1,\n  }\n}\n\nexport type Align = Input.Align;\nexport const Align = Input.Align;\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing one block.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Block');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_create.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_delete.js';\n\nimport {Blocks} from './blocks.js';\nimport type {Comment} from './comment.js';\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport * as Extensions from './extensions.js';\nimport type {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {Align, Input} from './input.js';\nimport {inputTypes} from './input_types.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IDeletable} from './interfaces/i_deletable.js';\nimport type {Mutator} from './mutator.js';\nimport * as Tooltip from './tooltip.js';\nimport * as arrayUtils from './utils/array.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for one block.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class Block implements IASTNodeLocation, IDeletable {\n  /**\n   * An optional callback method to use whenever the block's parent workspace\n   * changes. This is usually only called from the constructor, the block type\n   * initializer function, or an extension initializer function.\n   */\n  onchange?: ((p1: Abstract) => void)|null;\n\n  /** The language-neutral ID given to the collapsed input. */\n  static readonly COLLAPSED_INPUT_NAME: string = constants.COLLAPSED_INPUT_NAME;\n\n  /** The language-neutral ID given to the collapsed field. */\n  static readonly COLLAPSED_FIELD_NAME: string = constants.COLLAPSED_FIELD_NAME;\n\n  /**\n   * Optional text data that round-trips between blocks and XML.\n   * Has no effect. May be used by 3rd parties for meta information.\n   */\n  data: string|null = null;\n\n  /**\n   * Has this block been disposed of?\n   *\n   * @internal\n   */\n  disposed = false;\n\n  /**\n   * Colour of the block as HSV hue value (0-360)\n   * This may be null if the block colour was not set via a hue number.\n   */\n  private hue_: number|null = null;\n\n  /** Colour of the block in '#RRGGBB' format. */\n  protected colour_ = '#000000';\n\n  /** Name of the block style. */\n  protected styleName_ = '';\n\n  /** An optional method called during initialization. */\n  init?: (() => void);\n\n  /** An optional method called during disposal. */\n  destroy?: (() => void);\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * mutation state to XML. This must be coupled with defining\n   * `domToMutation`.\n   */\n  mutationToDom?: (...p1: AnyDuringMigration[]) => Element;\n\n  /**\n   * An optional deserialization method for defining how to deserialize the\n   * mutation state from XML. This must be coupled with defining\n   * `mutationToDom`.\n   */\n  domToMutation?: (p1: Element) => void;\n\n  /**\n   * An optional serialization method for defining how to serialize the\n   * block's extra state (eg mutation state) to something JSON compatible.\n   * This must be coupled with defining `loadExtraState`.\n   */\n  saveExtraState?: () => AnyDuringMigration;\n\n  /**\n   * An optional serialization method for defining how to deserialize the\n   * block's extra state (eg mutation state) from something JSON compatible.\n   * This must be coupled with defining `saveExtraState`.\n   */\n  loadExtraState?: (p1: AnyDuringMigration) => void;\n\n  /**\n   * An optional property for suppressing adding STATEMENT_PREFIX and\n   * STATEMENT_SUFFIX to generated code.\n   */\n  suppressPrefixSuffix: boolean|null = false;\n\n  /**\n   * An optional property for declaring developer variables.  Return a list of\n   * variable names for use by generators.  Developer variables are never\n   * shown to the user, but are declared as global variables in the generated\n   * code.\n   */\n  getDeveloperVariables?: () => string[];\n\n  /**\n   * An optional function that reconfigures the block based on the contents of\n   * the mutator dialog.\n   */\n  compose?: (p1: Block) => void;\n\n  /**\n   * An optional function that populates the mutator's dialog with\n   * this block's components.\n   */\n  decompose?: (p1: Workspace) => Block;\n  id: string;\n  outputConnection: Connection|null = null;\n  nextConnection: Connection|null = null;\n  previousConnection: Connection|null = null;\n  inputList: Input[] = [];\n  inputsInline?: boolean;\n  private disabled = false;\n  tooltip: Tooltip.TipInfo = '';\n  contextMenu = true;\n\n  protected parentBlock_: this|null = null;\n\n  protected childBlocks_: this[] = [];\n\n  private deletable_ = true;\n\n  private movable_ = true;\n\n  private editable_ = true;\n\n  private isShadow_ = false;\n\n  protected collapsed_ = false;\n  protected outputShape_: number|null = null;\n\n  /**\n   * Is the current block currently in the process of being disposed?\n   */\n  private disposing = false;\n\n  /**\n   * A string representing the comment attached to this block.\n   *\n   * @deprecated August 2019. Use getCommentText instead.\n   */\n  comment: string|Comment|null = null;\n  /** @internal */\n  commentModel: CommentModel;\n  private readonly xy_: Coordinate;\n  isInFlyout: boolean;\n  isInMutator: boolean;\n  RTL: boolean;\n\n  /** True if this block is an insertion marker. */\n  protected isInsertionMarker_ = false;\n\n  /** Name of the type of hat. */\n  hat?: string;\n\n  rendered: boolean|null = null;\n\n  /**\n   * String for block help, or function that returns a URL. Null for no help.\n   */\n  helpUrl: string|Function|null = null;\n\n  /** A bound callback function to use when the parent workspace changes. */\n  private onchangeWrapper_: ((p1: Abstract) => void)|null = null;\n\n  /**\n   * A count of statement inputs on the block.\n   *\n   * @internal\n   */\n  statementInputCount = 0;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  type!: string;\n  // Record initial inline state.\n  inputsInlineDefault?: boolean;\n  workspace: Workspace;\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @throws When the prototypeName is not valid or not allowed.\n   */\n  constructor(workspace: Workspace, prototypeName: string, opt_id?: string) {\n    this.workspace = workspace;\n\n    this.id = opt_id && !workspace.getBlockById(opt_id) ? opt_id :\n                                                          idGenerator.genUid();\n    workspace.setBlockById(this.id, this);\n\n    /** A model of the comment attached to this block. */\n    this.commentModel = {text: null, pinned: false, size: new Size(160, 80)};\n\n    /**\n     * The block's position in workspace units.  (0, 0) is at the workspace's\n     * origin; scale does not change this value.\n     */\n    this.xy_ = new Coordinate(0, 0);\n    this.isInFlyout = workspace.isFlyout;\n    this.isInMutator = workspace.isMutator;\n\n    this.RTL = workspace.RTL;\n\n    // Copy the type-specific functions and data from the prototype.\n    if (prototypeName) {\n      this.type = prototypeName;\n      const prototype = Blocks[prototypeName];\n      if (!prototype || typeof prototype !== 'object') {\n        throw TypeError('Invalid block definition for type: ' + prototypeName);\n      }\n      Object.assign(this, prototype);\n    }\n\n    workspace.addTopBlock(this);\n    workspace.addTypedBlock(this);\n\n    if (new.target === Block) {\n      this.doInit_();\n    }\n  }\n\n  /** Calls the init() function and handles associated event firing, etc. */\n  protected doInit_() {\n    // All events fired should be part of the same group.\n    // Any events fired during init should not be undoable,\n    // so that block creation is atomic.\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    const initialUndoFlag = eventUtils.getRecordUndo();\n\n    try {\n      // Call an initialization function, if it exists.\n      if (typeof this.init === 'function') {\n        eventUtils.setRecordUndo(false);\n        this.init();\n        eventUtils.setRecordUndo(initialUndoFlag);\n      }\n\n      // Fire a create event.\n      if (eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(this));\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n      // In case init threw, recordUndo flag should still be reset.\n      eventUtils.setRecordUndo(initialUndoFlag);\n    }\n    this.inputsInlineDefault = this.inputsInline;\n\n    // Bind an onchange function, if it exists.\n    if (typeof this.onchange === 'function') {\n      this.setOnChange(this.onchange);\n    }\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @suppress {checkTypes}\n   */\n  dispose(healStack: boolean) {\n    if (this.isDeadOrDying()) return;\n\n    // Dispose of this change listener before unplugging.\n    // Technically not necessary due to the event firing delay.\n    // But future-proofing.\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    this.unplug(healStack);\n    if (eventUtils.isEnabled()) {\n      // Constructing the delete event is costly. Only perform if necessary.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_DELETE))(this));\n    }\n    this.workspace.removeTopBlock(this);\n    this.disposeInternal();\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does not fire events, unplug the block, etc.\n   */\n  protected disposeInternal() {\n    if (this.isDeadOrDying()) return;\n\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n\n    eventUtils.disable();\n    try {\n      this.workspace.removeTypedBlock(this);\n      this.workspace.removeBlockById(this.id);\n      this.disposing = true;\n\n      this.childBlocks_.forEach((c) => c.disposeInternal());\n      this.inputList.forEach((i) => i.dispose());\n      this.inputList.length = 0;\n      this.getConnections_(true).forEach((c) => c.dispose());\n    } finally {\n      eventUtils.enable();\n      if (typeof this.destroy === 'function') {\n        this.destroy();\n      }\n      this.disposed = true;\n    }\n  }\n\n  /**\n   * Returns true if the block is either in the process of being disposed, or\n   * is disposed.\n   *\n   * @internal\n   */\n  isDeadOrDying(): boolean {\n    return this.disposing || this.disposed;\n  }\n\n  /**\n   * Call initModel on all fields on the block.\n   * May be called more than once.\n   * Either initModel or initSvg must be called after creating a block and\n   * before the first interaction with it.  Interactions include UI actions\n   * (e.g. clicking and dragging) and firing events (e.g. create, delete, and\n   * change).\n   */\n  initModel() {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.initModel) {\n          field.initModel();\n        }\n      }\n    }\n  }\n\n  /**\n   * Unplug this block from its superior block.  If this block is a statement,\n   * optionally reconnect the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  unplug(opt_healStack?: boolean) {\n    if (this.outputConnection) {\n      this.unplugFromRow_(opt_healStack);\n    }\n    if (this.previousConnection) {\n      this.unplugFromStack_(opt_healStack);\n    }\n  }\n\n  /**\n   * Unplug this block's output from an input on another block.  Optionally\n   * reconnect the block's parent to the only child block, if possible.\n   *\n   * @param opt_healStack Disconnect right-side block and connect to left-side\n   *     block.  Defaults to false.\n   */\n  private unplugFromRow_(opt_healStack?: boolean) {\n    let parentConnection = null;\n    if (this.outputConnection?.isConnected()) {\n      parentConnection = this.outputConnection.targetConnection;\n      // Disconnect from any superior block.\n      this.outputConnection.disconnect();\n    }\n\n    // Return early in obvious cases.\n    if (!parentConnection || !opt_healStack) {\n      return;\n    }\n\n    const thisConnection = this.getOnlyValueConnection_();\n    if (!thisConnection || !thisConnection.isConnected() ||\n        thisConnection.targetBlock()!.isShadow()) {\n      // Too many or too few possible connections on this block, or there's\n      // nothing on the other side of this connection.\n      return;\n    }\n\n    const childConnection = thisConnection.targetConnection;\n    // Disconnect the child block.\n    childConnection?.disconnect();\n    // Connect child to the parent if possible, otherwise bump away.\n    if (this.workspace.connectionChecker.canConnect(\n            childConnection, parentConnection, false)) {\n      parentConnection.connect(childConnection!);\n    } else {\n      childConnection?.onFailedConnect(parentConnection);\n    }\n  }\n\n  /**\n   * Returns the connection on the value input that is connected to another\n   * block. When an insertion marker is connected to a connection with a block\n   * already attached, the connected block is attached to the insertion marker.\n   * Since only one block can be displaced and attached to the insertion marker\n   * this should only ever return one connection.\n   *\n   * @returns The connection on the value input, or null.\n   */\n  private getOnlyValueConnection_(): Connection|null {\n    let connection = null;\n    for (let i = 0; i < this.inputList.length; i++) {\n      const thisConnection = this.inputList[i].connection;\n      if (thisConnection &&\n          thisConnection.type === ConnectionType.INPUT_VALUE &&\n          thisConnection.targetConnection) {\n        if (connection) {\n          return null;  // More than one value input found.\n        }\n        connection = thisConnection;\n      }\n    }\n    return connection;\n  }\n\n  /**\n   * Unplug this statement block from its superior block.  Optionally reconnect\n   * the block underneath with the block on top.\n   *\n   * @param opt_healStack Disconnect child statement and reconnect stack.\n   *     Defaults to false.\n   */\n  private unplugFromStack_(opt_healStack?: boolean) {\n    let previousTarget = null;\n    if (this.previousConnection?.isConnected()) {\n      // Remember the connection that any next statements need to connect to.\n      previousTarget = this.previousConnection.targetConnection;\n      // Detach this block from the parent's tree.\n      this.previousConnection.disconnect();\n    }\n    const nextBlock = this.getNextBlock();\n    if (opt_healStack && nextBlock && !nextBlock.isShadow()) {\n      // Disconnect the next statement.\n      const nextTarget = this.nextConnection?.targetConnection ?? null;\n      nextTarget?.disconnect();\n      if (previousTarget &&\n          this.workspace.connectionChecker.canConnect(\n              previousTarget, nextTarget, false)) {\n        // Attach the next statement to the previous statement.\n        previousTarget.connect(nextTarget!);\n      }\n    }\n  }\n\n  /**\n   * Returns all connections originating from this block.\n   *\n   * @param _all If true, return all connections even hidden ones.\n   * @returns Array of connections.\n   * @internal\n   */\n  getConnections_(_all: boolean): Connection[] {\n    const myConnections = [];\n    if (this.outputConnection) {\n      myConnections.push(this.outputConnection);\n    }\n    if (this.previousConnection) {\n      myConnections.push(this.previousConnection);\n    }\n    if (this.nextConnection) {\n      myConnections.push(this.nextConnection);\n    }\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection) {\n        myConnections.push(input.connection);\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  lastConnectionInStack(ignoreShadows: boolean): Connection|null {\n    let nextConnection = this.nextConnection;\n    while (nextConnection) {\n      const nextBlock = nextConnection.targetBlock();\n      if (!nextBlock || ignoreShadows && nextBlock.isShadow()) {\n        return nextConnection;\n      }\n      nextConnection = nextBlock.nextConnection;\n    }\n    return null;\n  }\n\n  /**\n   * Bump unconnected blocks out of alignment.  Two blocks which aren't actually\n   * connected should not coincidentally line up on screen.\n   */\n  bumpNeighbours() {}\n  // noop.\n\n  /**\n   * Return the parent block or null if this block is at the top level. The\n   * parent block is either the block connected to the previous connection (for\n   * a statement block) or the block connected to the output connection (for a\n   * value block).\n   *\n   * @returns The block (if any) that holds the current block.\n   */\n  getParent(): this|null {\n    return this.parentBlock_;\n  }\n\n  /**\n   * Return the input that connects to the specified block.\n   *\n   * @param block A block connected to an input on this block.\n   * @returns The input (if any) that connects to the specified block.\n   */\n  getInputWithBlock(block: Block): Input|null {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection && input.connection.targetBlock() === block) {\n        return input;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the parent block that surrounds the current block, or null if this\n   * block has no surrounding block.  A parent block might just be the previous\n   * statement, whereas the surrounding block is an if statement, while loop,\n   * etc.\n   *\n   * @returns The block (if any) that surrounds the current block.\n   */\n  getSurroundParent(): this|null {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this|null = this;\n    let prevBlock;\n    do {\n      prevBlock = block;\n      block = block.getParent();\n      if (!block) {\n        // Ran off the top.\n        return null;\n      }\n    } while (block.getNextBlock() === prevBlock);\n    // This block is an enclosing parent, not just a statement in a stack.\n    return block;\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  getNextBlock(): Block|null {\n    return this.nextConnection && this.nextConnection.targetBlock();\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  getPreviousBlock(): Block|null {\n    return this.previousConnection && this.previousConnection.targetBlock();\n  }\n\n  /**\n   * Return the connection on the first statement input on this block, or null\n   * if there are none.\n   *\n   * @returns The first statement connection or null.\n   * @internal\n   */\n  getFirstStatementConnection(): Connection|null {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection &&\n          input.connection.type === ConnectionType.NEXT_STATEMENT) {\n        return input.connection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return the top-most block in this block's tree.\n   * This will return itself if this block is at the top level.\n   *\n   * @returns The root block.\n   */\n  getRootBlock(): this {\n    let rootBlock: this;\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this|null = this;\n    do {\n      rootBlock = block;\n      block = rootBlock.parentBlock_;\n    } while (block);\n    return rootBlock;\n  }\n\n  /**\n   * Walk up from the given block up through the stack of blocks to find\n   * the top block of the sub stack. If we are nested in a statement input only\n   * find the top-most nested block. Do not go all the way to the root block.\n   *\n   * @returns The top block in a stack.\n   * @internal\n   */\n  getTopStackBlock(): this {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block = this;\n    let previous;\n    do {\n      previous = block.getPreviousBlock();\n      // AnyDuringMigration because:  Type 'Block' is not assignable to type\n      // 'this'.\n    } while (previous && previous.getNextBlock() === block &&\n             (block = previous as AnyDuringMigration));\n    return block;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getChildren(ordered: boolean): Block[] {\n    if (!ordered) {\n      return this.childBlocks_;\n    }\n    const blocks = [];\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          blocks.push(child);\n        }\n      }\n    }\n    const next = this.getNextBlock();\n    if (next) {\n      blocks.push(next);\n    }\n    return blocks;\n  }\n\n  /**\n   * Set parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  setParent(newParent: this|null) {\n    if (newParent === this.parentBlock_) {\n      return;\n    }\n\n    // Check that block is connected to new parent if new parent is not null and\n    //    that block is not connected to superior one if new parent is null.\n    const targetBlock =\n        this.previousConnection && this.previousConnection.targetBlock() ||\n        this.outputConnection && this.outputConnection.targetBlock();\n    const isConnected = !!targetBlock;\n\n    if (isConnected && newParent && targetBlock !== newParent) {\n      throw Error('Block connected to superior one that is not new parent.');\n    } else if (!isConnected && newParent) {\n      throw Error('Block not connected to new parent.');\n    } else if (isConnected && !newParent) {\n      throw Error(\n          'Cannot set parent to null while block is still connected to' +\n          ' superior block.');\n    }\n\n    // This block hasn't actually moved on-screen, so there's no need to\n    // update\n    //     its connection locations.\n    if (this.parentBlock_) {\n      // Remove this block from the old parent's child list.\n      arrayUtils.removeElem(this.parentBlock_.childBlocks_, this);\n    } else {\n      // New parent must be non-null so remove this block from the workspace's\n      //     list of top-most blocks.\n      this.workspace.removeTopBlock(this);\n    }\n\n    this.parentBlock_ = newParent;\n    if (newParent) {\n      // Add this block to the new parent's child list.\n      newParent.childBlocks_.push(this);\n    } else {\n      this.workspace.addTopBlock(this);\n    }\n  }\n\n  /**\n   * Find all the blocks that are directly or indirectly nested inside this one.\n   * Includes this block in the list.\n   * Includes value and statement inputs, as well as any following statements.\n   * Excludes any connection on an output tab or any preceding statements.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Flattened array of blocks.\n   */\n  getDescendants(ordered: boolean): this[] {\n    const blocks = [this];\n    const childBlocks = this.getChildren(ordered);\n    for (let child, i = 0; child = childBlocks[i]; i++) {\n      // AnyDuringMigration because:  Argument of type 'Block[]' is not\n      // assignable to parameter of type 'this[]'.\n      blocks.push(...child.getDescendants(ordered) as AnyDuringMigration);\n    }\n    return blocks;\n  }\n\n  /**\n   * Get whether this block is deletable or not.\n   *\n   * @returns True if deletable.\n   */\n  isDeletable(): boolean {\n    return this.deletable_ && !this.isShadow_ && !this.isDeadOrDying() &&\n        !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Return whether this block's own deletable property is true or false.\n   *\n   * @returns True if the block's deletable property is true, false otherwise.\n   */\n  isOwnDeletable(): boolean {\n    return this.deletable_;\n  }\n\n  /**\n   * Set whether this block is deletable or not.\n   *\n   * @param deletable True if deletable.\n   */\n  setDeletable(deletable: boolean) {\n    this.deletable_ = deletable;\n  }\n\n  /**\n   * Get whether this block is movable or not.\n   *\n   * @returns True if movable.\n   * @internal\n   */\n  isMovable(): boolean {\n    return this.movable_ && !this.isShadow_ && !this.isDeadOrDying() &&\n        !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Return whether this block's own movable property is true or false.\n   *\n   * @returns True if the block's movable property is true, false otherwise.\n   * @internal\n   */\n  isOwnMovable(): boolean {\n    return this.movable_;\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  setMovable(movable: boolean) {\n    this.movable_ = movable;\n  }\n\n  /**\n   * Get whether is block is duplicatable or not. If duplicating this block and\n   * descendants will put this block over the workspace's capacity this block is\n   * not duplicatable. If duplicating this block and descendants will put any\n   * type over their maxInstances this block is not duplicatable.\n   *\n   * @returns True if duplicatable.\n   */\n  isDuplicatable(): boolean {\n    if (!this.workspace.hasBlockLimits()) {\n      return true;\n    }\n    return this.workspace.isCapacityAvailable(\n        common.getBlockTypeCounts(this, true));\n  }\n\n  /**\n   * Get whether this block is a shadow block or not.\n   *\n   * @returns True if a shadow.\n   */\n  isShadow(): boolean {\n    return this.isShadow_;\n  }\n\n  /**\n   * Set whether this block is a shadow block or not.\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  setShadow(shadow: boolean) {\n    this.isShadow_ = shadow;\n  }\n\n  /**\n   * Get whether this block is an insertion marker block or not.\n   *\n   * @returns True if an insertion marker.\n   */\n  isInsertionMarker(): boolean {\n    return this.isInsertionMarker_;\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  setInsertionMarker(insertionMarker: boolean) {\n    this.isInsertionMarker_ = insertionMarker;\n  }\n\n  /**\n   * Get whether this block is editable or not.\n   *\n   * @returns True if editable.\n   * @internal\n   */\n  isEditable(): boolean {\n    return this.editable_ && !this.isDeadOrDying() &&\n        !this.workspace.options.readOnly;\n  }\n\n  /**\n   * Return whether this block's own editable property is true or false.\n   *\n   * @returns True if the block's editable property is true, false otherwise.\n   */\n  isOwnEditable(): boolean {\n    return this.editable_;\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  setEditable(editable: boolean) {\n    this.editable_ = editable;\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        field.updateEditable();\n      }\n    }\n  }\n\n  /**\n   * Returns if this block has been disposed of / deleted.\n   *\n   * @returns True if this block has been disposed of / deleted.\n   */\n  isDisposed(): boolean {\n    return this.disposed;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  getMatchingConnection(otherBlock: Block, conn: Connection): Connection|null {\n    const connections = this.getConnections_(true);\n    const otherConnections = otherBlock.getConnections_(true);\n    if (connections.length !== otherConnections.length) {\n      throw Error('Connection lists did not match in length.');\n    }\n    for (let i = 0; i < otherConnections.length; i++) {\n      if (otherConnections[i] === conn) {\n        return connections[i];\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the URL of this block's help page.\n   *\n   * @param url URL string for block help, or function that returns a URL.  Null\n   *     for no help.\n   */\n  setHelpUrl(url: string|Function) {\n    this.helpUrl = url;\n  }\n\n  /**\n   * Sets the tooltip for this block.\n   *\n   * @param newTip The text for the tooltip, a function that returns the text\n   *     for the tooltip, or a parent object whose tooltip will be used. To not\n   *     display a tooltip pass the empty string.\n   */\n  setTooltip(newTip: Tooltip.TipInfo) {\n    this.tooltip = newTip;\n  }\n\n  /**\n   * Returns the tooltip text for this block.\n   *\n   * @returns The tooltip text for this block.\n   */\n  getTooltip(): string {\n    return Tooltip.getTooltipOfObject(this);\n  }\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColour(): string {\n    return this.colour_;\n  }\n\n  /**\n   * Get the name of the block style.\n   *\n   * @returns Name of the block style.\n   */\n  getStyleName(): string {\n    return this.styleName_;\n  }\n\n  /**\n   * Get the HSV hue value of a block.  Null if hue not set.\n   *\n   * @returns Hue value (0-360).\n   */\n  getHue(): number|null {\n    return this.hue_;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   */\n  setColour(colour: number|string) {\n    const parsed = parsing.parseBlockColour(colour);\n    this.hue_ = parsed.hue;\n    this.colour_ = parsed.hex;\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   */\n  setStyle(blockStyleName: string) {\n    this.styleName_ = blockStyleName;\n  }\n\n  /**\n   * Sets a callback function to use whenever the block's parent workspace\n   * changes, replacing any prior onchange handler. This is usually only called\n   * from the constructor, the block type initializer function, or an extension\n   * initializer function.\n   *\n   * @param onchangeFn The callback to call when the block's workspace changes.\n   * @throws {Error} if onchangeFn is not falsey and not a function.\n   */\n  setOnChange(onchangeFn: (p1: Abstract) => void) {\n    if (onchangeFn && typeof onchangeFn !== 'function') {\n      throw Error('onchange must be a function.');\n    }\n    if (this.onchangeWrapper_) {\n      this.workspace.removeChangeListener(this.onchangeWrapper_);\n    }\n    this.onchange = onchangeFn;\n    this.onchangeWrapper_ = onchangeFn.bind(this);\n    this.workspace.addChangeListener(this.onchangeWrapper_);\n  }\n\n  /**\n   * Returns the named field from a block.\n   *\n   * @param name The name of the field.\n   * @returns Named field, or null if field does not exist.\n   */\n  getField(name: string): Field|null {\n    if (typeof name !== 'string') {\n      throw TypeError(\n          'Block.prototype.getField expects a string ' +\n          'with the field name but received ' +\n          (name === undefined ? 'nothing' : name + ' of type ' + typeof name) +\n          ' instead');\n    }\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.name === name) {\n          return field;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable ids.\n   */\n  getVars(): string[] {\n    const vars: string[] = [];\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables()) {\n          // NOTE: This only applies to `FieldVariable`, a `Field<string>`\n          vars.push(field.getValue() as string);\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Return all variables referenced by this block.\n   *\n   * @returns List of variable models.\n   * @internal\n   */\n  getVarModels(): VariableModel[] {\n    const vars = [];\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables()) {\n          const model =\n              this.workspace.getVariableById(field.getValue() as string);\n          // Check if the variable actually exists (and isn't just a potential\n          // variable).\n          if (model) {\n            vars.push(model);\n          }\n        }\n      }\n    }\n    return vars;\n  }\n\n  /**\n   * Notification that a variable is renaming but keeping the same ID.  If the\n   * variable is in use on this block, rerender to show the new name.\n   *\n   * @param variable The variable being renamed.\n   * @internal\n   */\n  updateVarName(variable: VariableModel) {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables() &&\n            variable.getId() === field.getValue()) {\n          field.refreshVariableName();\n        }\n      }\n    }\n  }\n\n  /**\n   * Notification that a variable is renaming.\n   * If the ID matches one of this block's variables, rename it.\n   *\n   * @param oldId ID of variable to rename.\n   * @param newId ID of new variable.  May be the same as oldId, but with an\n   *     updated name.\n   */\n  renameVarById(oldId: string, newId: string) {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        if (field.referencesVariables() && oldId === field.getValue()) {\n          field.setValue(newId);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns the language-neutral value of the given field.\n   *\n   * @param name The name of the field.\n   * @returns Value of the field or null if field does not exist.\n   */\n  getFieldValue(name: string): AnyDuringMigration {\n    const field = this.getField(name);\n    if (field) {\n      return field.getValue();\n    }\n    return null;\n  }\n\n  /**\n   * Sets the value of the given field for this block.\n   *\n   * @param newValue The value to set.\n   * @param name The name of the field to set the value of.\n   */\n  setFieldValue(newValue: AnyDuringMigration, name: string) {\n    const field = this.getField(name);\n    if (!field) {\n      throw Error('Field \"' + name + '\" not found.');\n    }\n    field.setValue(newValue);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setPreviousStatement(newBoolean: boolean, opt_check?: string|string[]|null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.previousConnection) {\n        this.previousConnection =\n            this.makeConnection_(ConnectionType.PREVIOUS_STATEMENT);\n      }\n      this.previousConnection.setCheck(opt_check);\n    } else {\n      if (this.previousConnection) {\n        if (this.previousConnection.isConnected()) {\n          throw Error(\n              'Must disconnect previous statement before removing ' +\n              'connection.');\n        }\n        this.previousConnection.dispose();\n        this.previousConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  setNextStatement(newBoolean: boolean, opt_check?: string|string[]|null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.nextConnection) {\n        this.nextConnection =\n            this.makeConnection_(ConnectionType.NEXT_STATEMENT);\n      }\n      this.nextConnection.setCheck(opt_check);\n    } else {\n      if (this.nextConnection) {\n        if (this.nextConnection.isConnected()) {\n          throw Error(\n              'Must disconnect next statement before removing ' +\n              'connection.');\n        }\n        this.nextConnection.dispose();\n        this.nextConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  setOutput(newBoolean: boolean, opt_check?: string|string[]|null) {\n    if (newBoolean) {\n      if (opt_check === undefined) {\n        opt_check = null;\n      }\n      if (!this.outputConnection) {\n        this.outputConnection =\n            this.makeConnection_(ConnectionType.OUTPUT_VALUE);\n      }\n      this.outputConnection.setCheck(opt_check);\n    } else {\n      if (this.outputConnection) {\n        if (this.outputConnection.isConnected()) {\n          throw Error(\n              'Must disconnect output value before removing connection.');\n        }\n        this.outputConnection.dispose();\n        this.outputConnection = null;\n      }\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  setInputsInline(newBoolean: boolean) {\n    if (this.inputsInline !== newBoolean) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this, 'inline', null, this.inputsInline, newBoolean));\n      this.inputsInline = newBoolean;\n    }\n  }\n\n  /**\n   * Get whether value inputs are arranged horizontally or vertically.\n   *\n   * @returns True if inputs are horizontal.\n   */\n  getInputsInline(): boolean {\n    if (this.inputsInline !== undefined) {\n      // Set explicitly.\n      return this.inputsInline;\n    }\n    // Not defined explicitly.  Figure out what would look best.\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (this.inputList[i - 1].type === inputTypes.DUMMY &&\n          this.inputList[i].type === inputTypes.DUMMY) {\n        // Two dummy inputs in a row.  Don't inline them.\n        return false;\n      }\n    }\n    for (let i = 1; i < this.inputList.length; i++) {\n      if (this.inputList[i - 1].type === inputTypes.VALUE &&\n          this.inputList[i].type === inputTypes.DUMMY) {\n        // Dummy input after a value input.  Inline them.\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Set the block's output shape.\n   *\n   * @param outputShape Value representing an output shape.\n   */\n  setOutputShape(outputShape: number|null) {\n    this.outputShape_ = outputShape;\n  }\n\n  /**\n   * Get the block's output shape.\n   *\n   * @returns Value representing output shape if one exists.\n   */\n  getOutputShape(): number|null {\n    return this.outputShape_;\n  }\n\n  /**\n   * Get whether this block is enabled or not.\n   *\n   * @returns True if enabled.\n   */\n  isEnabled(): boolean {\n    return !this.disabled;\n  }\n\n  /**\n   * Set whether the block is enabled or not.\n   *\n   * @param enabled True if enabled.\n   */\n  setEnabled(enabled: boolean) {\n    if (this.isEnabled() !== enabled) {\n      const oldValue = this.disabled;\n      this.disabled = !enabled;\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this, 'disabled', null, oldValue, !enabled));\n    }\n  }\n\n  /**\n   * Get whether the block is disabled or not due to parents.\n   * The block's own disabled property is not considered.\n   *\n   * @returns True if disabled.\n   */\n  getInheritedDisabled(): boolean {\n    let ancestor = this.getSurroundParent();\n    while (ancestor) {\n      if (ancestor.disabled) {\n        return true;\n      }\n      ancestor = ancestor.getSurroundParent();\n    }\n    // Ran off the top.\n    return false;\n  }\n\n  /**\n   * Get whether the block is collapsed or not.\n   *\n   * @returns True if collapsed.\n   */\n  isCollapsed(): boolean {\n    return this.collapsed_;\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ !== collapsed) {\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n          this, 'collapsed', null, this.collapsed_, collapsed));\n      this.collapsed_ = collapsed;\n    }\n  }\n\n  /**\n   * Create a human-readable text representation of this block and any children.\n   *\n   * @param opt_maxLength Truncate the string to this length.\n   * @param opt_emptyToken The placeholder string used to denote an empty input.\n   *     If not specified, '?' is used.\n   * @returns Text of block.\n   */\n  toString(opt_maxLength?: number, opt_emptyToken?: string): string {\n    const tokens = this.toTokens(opt_emptyToken);\n\n    // Run through our tokens array and simplify expression to remove\n    // parentheses around single field blocks.\n    // E.g. ['repeat', '(', '10', ')', 'times', 'do', '?']\n    for (let i = 2; i < tokens.length; i++) {\n      if (tokens[i - 2] === '(' && tokens[i] === ')') {\n        tokens[i - 2] = tokens[i - 1];\n        tokens.splice(i - 1, 2);\n      }\n    }\n\n    // Join the text array, removing the spaces around added parentheses.\n    let prev = '';\n    let text: string = tokens.reduce((acc, curr) => {\n      const val = acc + ((prev === '(' || curr === ')') ? '' : ' ') + curr;\n      prev = curr[curr.length - 1];\n      return val;\n    }, '');\n\n    text = text.trim() || '???';\n    if (opt_maxLength) {\n      // TODO: Improve truncation so that text from this block is given\n      // priority. E.g. \"1+2+3+4+5+6+7+8+9=0\" should be \"...6+7+8+9=0\", not\n      // \"1+2+3+4+5...\". E.g. \"1+2+3+4+5=6+7+8+9+0\" should be \"...4+5=6+7...\".\n      if (text.length > opt_maxLength) {\n        text = text.substring(0, opt_maxLength - 3) + '...';\n      }\n    }\n    return text;\n  }\n\n  /**\n   * Converts this block into string tokens.\n   *\n   * @param emptyToken The token to use in place of an empty input.\n   *     Defaults to '?'.\n   * @returns The array of string tokens representing this block.\n   */\n  private toTokens(emptyToken = '?'): string[] {\n    const tokens = [];\n    /**\n     * Whether or not to add parentheses around an input.\n     *\n     * @param connection The connection.\n     * @returns True if we should add parentheses around the input.\n     */\n    function shouldAddParentheses(connection: Connection): boolean {\n      let checks = connection.getCheck();\n      if (!checks && connection.targetConnection) {\n        checks = connection.targetConnection.getCheck();\n      }\n      return !!checks &&\n          (checks.indexOf('Boolean') !== -1 || checks.indexOf('Number') !== -1);\n    }\n\n    for (const input of this.inputList) {\n      if (input.name == constants.COLLAPSED_INPUT_NAME) {\n        continue;\n      }\n      for (const field of input.fieldRow) {\n        tokens.push(field.getText());\n      }\n      if (input.connection) {\n        const child = input.connection.targetBlock();\n        if (child) {\n          const shouldAddParens = shouldAddParentheses(input.connection);\n          if (shouldAddParens) tokens.push('(');\n          tokens.push(...child.toTokens(emptyToken));\n          if (shouldAddParens) tokens.push(')');\n        } else {\n          tokens.push(emptyToken);\n        }\n      }\n    }\n    return tokens;\n  }\n\n  /**\n   * Shortcut for appending a value input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendValueInput(name: string): Input {\n    return this.appendInput_(inputTypes.VALUE, name);\n  }\n\n  /**\n   * Shortcut for appending a statement input row.\n   *\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendStatementInput(name: string): Input {\n    return this.appendInput_(inputTypes.STATEMENT, name);\n  }\n\n  /**\n   * Shortcut for appending a dummy input row.\n   *\n   * @param opt_name Language-neutral identifier which may used to find this\n   *     input again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  appendDummyInput(opt_name?: string): Input {\n    return this.appendInput_(inputTypes.DUMMY, opt_name || '');\n  }\n\n  /**\n   * Initialize this block using a cross-platform, internationalization-friendly\n   * JSON description.\n   *\n   * @param json Structured data describing the block.\n   */\n  jsonInit(json: AnyDuringMigration) {\n    const warningPrefix = json['type'] ? 'Block \"' + json['type'] + '\": ' : '';\n\n    // Validate inputs.\n    if (json['output'] && json['previousStatement']) {\n      throw Error(\n          warningPrefix +\n          'Must not have both an output and a previousStatement.');\n    }\n\n    // Set basic properties of block.\n    // Makes styles backward compatible with old way of defining hat style.\n    if (json['style'] && json['style'].hat) {\n      this.hat = json['style'].hat;\n      // Must set to null so it doesn't error when checking for style and\n      // colour.\n      json['style'] = null;\n    }\n\n    if (json['style'] && json['colour']) {\n      throw Error(warningPrefix + 'Must not have both a colour and a style.');\n    } else if (json['style']) {\n      this.jsonInitStyle_(json, warningPrefix);\n    } else {\n      this.jsonInitColour_(json, warningPrefix);\n    }\n\n    // Interpolate the message blocks.\n    let i = 0;\n    while (json['message' + i] !== undefined) {\n      this.interpolate_(\n          json['message' + i], json['args' + i] || [],\n          json['lastDummyAlign' + i], warningPrefix);\n      i++;\n    }\n\n    if (json['inputsInline'] !== undefined) {\n      this.setInputsInline(json['inputsInline']);\n    }\n    // Set output and previous/next connections.\n    if (json['output'] !== undefined) {\n      this.setOutput(true, json['output']);\n    }\n    if (json['outputShape'] !== undefined) {\n      this.setOutputShape(json['outputShape']);\n    }\n    if (json['previousStatement'] !== undefined) {\n      this.setPreviousStatement(true, json['previousStatement']);\n    }\n    if (json['nextStatement'] !== undefined) {\n      this.setNextStatement(true, json['nextStatement']);\n    }\n    if (json['tooltip'] !== undefined) {\n      const rawValue = json['tooltip'];\n      const localizedText = parsing.replaceMessageReferences(rawValue);\n      this.setTooltip(localizedText);\n    }\n    if (json['enableContextMenu'] !== undefined) {\n      this.contextMenu = !!json['enableContextMenu'];\n    }\n    if (json['suppressPrefixSuffix'] !== undefined) {\n      this.suppressPrefixSuffix = !!json['suppressPrefixSuffix'];\n    }\n    if (json['helpUrl'] !== undefined) {\n      const rawValue = json['helpUrl'];\n      const localizedValue = parsing.replaceMessageReferences(rawValue);\n      this.setHelpUrl(localizedValue);\n    }\n    if (typeof json['extensions'] === 'string') {\n      console.warn(\n          warningPrefix +\n          'JSON attribute \\'extensions\\' should be an array of' +\n          ' strings. Found raw string in JSON for \\'' + json['type'] +\n          '\\' block.');\n      json['extensions'] = [json['extensions']];  // Correct and continue.\n    }\n\n    // Add the mutator to the block.\n    if (json['mutator'] !== undefined) {\n      Extensions.apply(json['mutator'], this, true);\n    }\n\n    const extensionNames = json['extensions'];\n    if (Array.isArray(extensionNames)) {\n      for (let j = 0; j < extensionNames.length; j++) {\n        Extensions.apply(extensionNames[j], this, false);\n      }\n    }\n  }\n\n  /**\n   * Initialize the colour of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitColour_(json: AnyDuringMigration, warningPrefix: string) {\n    if ('colour' in json) {\n      if (json['colour'] === undefined) {\n        console.warn(warningPrefix + 'Undefined colour value.');\n      } else {\n        const rawValue = json['colour'];\n        try {\n          this.setColour(rawValue);\n        } catch (e) {\n          console.warn(warningPrefix + 'Illegal colour value: ', rawValue);\n        }\n      }\n    }\n  }\n\n  /**\n   * Initialize the style of this block from the JSON description.\n   *\n   * @param json Structured data describing the block.\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private jsonInitStyle_(json: AnyDuringMigration, warningPrefix: string) {\n    const blockStyleName = json['style'];\n    try {\n      this.setStyle(blockStyleName);\n    } catch (styleError) {\n      console.warn(warningPrefix + 'Style does not exist: ', blockStyleName);\n    }\n  }\n\n  /**\n   * Add key/values from mixinObj to this block object. By default, this method\n   * will check that the keys in mixinObj will not overwrite existing values in\n   * the block, including prototype values. This provides some insurance against\n   * mixin / extension incompatibilities with future block features. This check\n   * can be disabled by passing true as the second argument.\n   *\n   * @param mixinObj The key/values pairs to add to this block object.\n   * @param opt_disableCheck Option flag to disable overwrite checks.\n   */\n  mixin(mixinObj: AnyDuringMigration, opt_disableCheck?: boolean) {\n    if (opt_disableCheck !== undefined &&\n        typeof opt_disableCheck !== 'boolean') {\n      throw Error('opt_disableCheck must be a boolean if provided');\n    }\n    if (!opt_disableCheck) {\n      const overwrites = [];\n      for (const key in mixinObj) {\n        if ((this as AnyDuringMigration)[key] !== undefined) {\n          overwrites.push(key);\n        }\n      }\n      if (overwrites.length) {\n        throw Error(\n            'Mixin will overwrite block members: ' +\n            JSON.stringify(overwrites));\n      }\n    }\n    Object.assign(this, mixinObj);\n  }\n\n  /**\n   * Interpolate a message description onto the block.\n   *\n   * @param message Text contains interpolation tokens (%1, %2, ...) that match\n   *     with fields or inputs defined in the args array.\n   * @param args Array of arguments to be interpolated.\n   * @param lastDummyAlign If a dummy input is added at the end, how should it\n   *     be aligned?\n   * @param warningPrefix Warning prefix string identifying block.\n   */\n  private interpolate_(\n      message: string, args: AnyDuringMigration[],\n      lastDummyAlign: string|undefined, warningPrefix: string) {\n    const tokens = parsing.tokenizeInterpolation(message);\n    this.validateTokens_(tokens, args.length);\n    const elements = this.interpolateArguments_(tokens, args, lastDummyAlign);\n\n    // An array of [field, fieldName] tuples.\n    const fieldStack = [];\n    for (let i = 0, element; element = elements[i]; i++) {\n      if (this.isInputKeyword_(element['type'])) {\n        const input = this.inputFromJson_(element, warningPrefix);\n        // Should never be null, but just in case.\n        if (input) {\n          for (let j = 0, tuple; tuple = fieldStack[j]; j++) {\n            input.appendField(tuple[0], tuple[1]);\n          }\n          fieldStack.length = 0;\n        }\n      } else {\n        // All other types, including ones starting with 'input_' get routed\n        // here.\n        const field = this.fieldFromJson_(element);\n        if (field) {\n          fieldStack.push([field, element['name']]);\n        }\n      }\n    }\n  }\n\n  /**\n   * Validates that the tokens are within the correct bounds, with no\n   * duplicates, and that all of the arguments are referred to. Throws errors if\n   * any of these things are not true.\n   *\n   * @param tokens An array of tokens to validate\n   * @param argsCount The number of args that need to be referred to.\n   */\n  private validateTokens_(tokens: Array<string|number>, argsCount: number) {\n    const visitedArgsHash = [];\n    let visitedArgsCount = 0;\n    for (let i = 0; i < tokens.length; i++) {\n      const token = tokens[i];\n      if (typeof token !== 'number') {\n        continue;\n      }\n      if (token < 1 || token > argsCount) {\n        throw Error(\n            'Block \"' + this.type + '\": ' +\n            'Message index %' + token + ' out of range.');\n      }\n      if (visitedArgsHash[token]) {\n        throw Error(\n            'Block \"' + this.type + '\": ' +\n            'Message index %' + token + ' duplicated.');\n      }\n      visitedArgsHash[token] = true;\n      visitedArgsCount++;\n    }\n    if (visitedArgsCount !== argsCount) {\n      throw Error(\n          'Block \"' + this.type + '\": ' +\n          'Message does not reference all ' + argsCount + ' arg(s).');\n    }\n  }\n\n  /**\n   * Inserts args in place of numerical tokens. String args are converted to\n   * JSON that defines a label field. If necessary an extra dummy input is added\n   * to the end of the elements.\n   *\n   * @param tokens The tokens to interpolate\n   * @param args The arguments to insert.\n   * @param lastDummyAlign The alignment the added dummy input should have, if\n   *     we are required to add one.\n   * @returns The JSON definitions of field and inputs to add to the block.\n   */\n  private interpolateArguments_(\n      tokens: Array<string|number>, args: Array<AnyDuringMigration|string>,\n      lastDummyAlign: string|undefined): AnyDuringMigration[] {\n    const elements = [];\n    for (let i = 0; i < tokens.length; i++) {\n      let element = tokens[i];\n      if (typeof element === 'number') {\n        element = args[element - 1];\n      }\n      // Args can be strings, which is why this isn't elseif.\n      if (typeof element === 'string') {\n        // AnyDuringMigration because:  Type '{ text: string; type: string; } |\n        // null' is not assignable to type 'string | number'.\n        element = this.stringToFieldJson_(element) as AnyDuringMigration;\n        if (!element) {\n          continue;\n        }\n      }\n      elements.push(element);\n    }\n\n    const length = elements.length;\n    if (length &&\n        !this.isInputKeyword_(\n            (elements as AnyDuringMigration)[length - 1]['type'])) {\n      const dummyInput = {'type': 'input_dummy'};\n      if (lastDummyAlign) {\n        (dummyInput as AnyDuringMigration)['align'] = lastDummyAlign;\n      }\n      elements.push(dummyInput);\n    }\n\n    return elements;\n  }\n\n  /**\n   * Creates a field from the JSON definition of a field. If a field with the\n   * given type cannot be found, this attempts to create a different field using\n   * the 'alt' property of the JSON definition (if it exists).\n   *\n   * @param element The element to try to turn into a field.\n   * @returns The field defined by the JSON, or null if one couldn't be created.\n   */\n  private fieldFromJson_(element: {alt?: string, type: string, text?: string}):\n      Field|null {\n    const field = fieldRegistry.fromJson(element);\n    if (!field && element['alt']) {\n      if (typeof element['alt'] === 'string') {\n        const json = this.stringToFieldJson_(element['alt']);\n        return json ? this.fieldFromJson_(json) : null;\n      }\n      return this.fieldFromJson_(element['alt']);\n    }\n    return field;\n  }\n\n  /**\n   * Creates an input from the JSON definition of an input. Sets the input's\n   * check and alignment if they are provided.\n   *\n   * @param element The JSON to turn into an input.\n   * @param warningPrefix The prefix to add to warnings to help the developer\n   *     debug.\n   * @returns The input that has been created, or null if one could not be\n   *     created for some reason (should never happen).\n   */\n  private inputFromJson_(element: AnyDuringMigration, warningPrefix: string):\n      Input|null {\n    const alignmentLookup = {\n      'LEFT': Align.LEFT,\n      'RIGHT': Align.RIGHT,\n      'CENTRE': Align.CENTRE,\n      'CENTER': Align.CENTRE,\n    };\n\n    let input = null;\n    switch (element['type']) {\n      case 'input_value':\n        input = this.appendValueInput(element['name']);\n        break;\n      case 'input_statement':\n        input = this.appendStatementInput(element['name']);\n        break;\n      case 'input_dummy':\n        input = this.appendDummyInput(element['name']);\n        break;\n    }\n    // Should never be hit because of interpolate_'s checks, but just in case.\n    if (!input) {\n      return null;\n    }\n\n    if (element['check']) {\n      input.setCheck(element['check']);\n    }\n    if (element['align']) {\n      const alignment =\n          (alignmentLookup as\n           AnyDuringMigration)[element['align'].toUpperCase()];\n      if (alignment === undefined) {\n        console.warn(warningPrefix + 'Illegal align value: ', element['align']);\n      } else {\n        input.setAlign(alignment);\n      }\n    }\n    return input;\n  }\n\n  /**\n   * Returns true if the given string matches one of the input keywords.\n   *\n   * @param str The string to check.\n   * @returns True if the given string matches one of the input keywords, false\n   *     otherwise.\n   */\n  private isInputKeyword_(str: string): boolean {\n    return str === 'input_value' || str === 'input_statement' ||\n        str === 'input_dummy';\n  }\n\n  /**\n   * Turns a string into the JSON definition of a label field. If the string\n   * becomes an empty string when trimmed, this returns null.\n   *\n   * @param str String to turn into the JSON definition of a label field.\n   * @returns The JSON definition or null.\n   */\n  private stringToFieldJson_(str: string): {text: string, type: string}|null {\n    str = str.trim();\n    if (str) {\n      return {\n        'type': 'field_label',\n        'text': str,\n      };\n    }\n    return null;\n  }\n\n  /**\n   * Add a value input, statement input or local variable to this block.\n   *\n   * @param type One of Blockly.inputTypes.\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  protected appendInput_(type: number, name: string): Input {\n    let connection = null;\n    if (type === inputTypes.VALUE || type === inputTypes.STATEMENT) {\n      connection = this.makeConnection_(type);\n    }\n    if (type === inputTypes.STATEMENT) {\n      this.statementInputCount++;\n    }\n    const input = new Input(type, name, this, connection);\n    // Append input to list.\n    this.inputList.push(input);\n    return input;\n  }\n\n  /**\n   * Move a named input to a different location on this block.\n   *\n   * @param name The name of the input to move.\n   * @param refName Name of input that should be after the moved input, or null\n   *     to be the input at the end.\n   */\n  moveInputBefore(name: string, refName: string|null) {\n    if (name === refName) {\n      return;\n    }\n    // Find both inputs.\n    let inputIndex = -1;\n    let refIndex = refName ? -1 : this.inputList.length;\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name === name) {\n        inputIndex = i;\n        if (refIndex !== -1) {\n          break;\n        }\n      } else if (refName && input.name === refName) {\n        refIndex = i;\n        if (inputIndex !== -1) {\n          break;\n        }\n      }\n    }\n    if (inputIndex === -1) {\n      throw Error('Named input \"' + name + '\" not found.');\n    }\n    if (refIndex === -1) {\n      throw Error('Reference input \"' + refName + '\" not found.');\n    }\n    this.moveNumberedInputBefore(inputIndex, refIndex);\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    // Validate arguments.\n    if (inputIndex === refIndex) {\n      throw Error('Can\\'t move input to itself.');\n    }\n    if (inputIndex >= this.inputList.length) {\n      throw RangeError('Input index ' + inputIndex + ' out of bounds.');\n    }\n    if (refIndex > this.inputList.length) {\n      throw RangeError('Reference input ' + refIndex + ' out of bounds.');\n    }\n    // Remove input.\n    const input = this.inputList[inputIndex];\n    this.inputList.splice(inputIndex, 1);\n    if (inputIndex < refIndex) {\n      refIndex--;\n    }\n    // Reinsert input.\n    this.inputList.splice(refIndex, 0, input);\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent an error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true.\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  removeInput(name: string, opt_quiet?: boolean): boolean {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name === name) {\n        if (input.type === inputTypes.STATEMENT) {\n          this.statementInputCount--;\n        }\n        input.dispose();\n        this.inputList.splice(i, 1);\n        return true;\n      }\n    }\n    if (opt_quiet) {\n      return false;\n    }\n    throw Error('Input not found: ' + name);\n  }\n\n  /**\n   * Fetches the named input object.\n   *\n   * @param name The name of the input.\n   * @returns The input object, or null if input does not exist.\n   */\n  getInput(name: string): Input|null {\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name === name) {\n        return input;\n      }\n    }\n    // This input does not exist.\n    return null;\n  }\n\n  /**\n   * Fetches the block attached to the named input.\n   *\n   * @param name The name of the input.\n   * @returns The attached value block, or null if the input is either\n   *     disconnected or if the input does not exist.\n   */\n  getInputTargetBlock(name: string): Block|null {\n    const input = this.getInput(name);\n    return input && input.connection && input.connection.targetBlock();\n  }\n\n  /**\n   * Returns the comment on this block (or null if there is no comment).\n   *\n   * @returns Block's comment.\n   */\n  getCommentText(): string|null {\n    return this.commentModel.text;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  setCommentText(text: string|null) {\n    if (this.commentModel.text === text) {\n      return;\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n        this, 'comment', null, this.commentModel.text, text));\n    this.commentModel.text = text;\n    this.comment = text;  // For backwards compatibility.\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param _text The text, or null to delete.\n   * @param _opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  setWarningText(_text: string|null, _opt_id?: string) {}\n  // NOP.\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param _mutator A mutator dialog instance or null to remove.\n   */\n  setMutator(_mutator: Mutator) {}\n  // NOP.\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   *\n   * @returns Object with .x and .y properties.\n   */\n  getRelativeToSurfaceXY(): Coordinate {\n    return this.xy_;\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset, in workspace units.\n   * @param dy Vertical offset, in workspace units.\n   */\n  moveBy(dx: number, dy: number) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent.');\n    }\n    const event =\n        new (eventUtils.get(eventUtils.BLOCK_MOVE))(this) as BlockMove;\n    this.xy_.translate(dx, dy);\n    event.recordNew();\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   */\n  protected makeConnection_(type: number): Connection {\n    return new Connection(this, type);\n  }\n\n  /**\n   * Recursively checks whether all statement and value inputs are filled with\n   * blocks. Also checks all following statement blocks in this stack.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    // Account for the shadow block filledness toggle.\n    if (opt_shadowBlocksAreFilled === undefined) {\n      opt_shadowBlocksAreFilled = true;\n    }\n    if (!opt_shadowBlocksAreFilled && this.isShadow()) {\n      return false;\n    }\n\n    // Recursively check each input block of the current block.\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (!input.connection) {\n        continue;\n      }\n      const target = input.connection.targetBlock();\n      if (!target || !target.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n\n    // Recursively check the next block after the current block.\n    const next = this.getNextBlock();\n    if (next) {\n      return next.allInputsFilled(opt_shadowBlocksAreFilled);\n    }\n\n    return true;\n  }\n\n  /**\n   * This method returns a string describing this Block in developer terms (type\n   * name and ID; English only).\n   *\n   * Intended to on be used in console logs and errors. If you need a string\n   * that uses the user's native language (including block text, field values,\n   * and child blocks), use [toString()]{@link Block#toString}.\n   *\n   * @returns The description.\n   */\n  toDevString(): string {\n    let msg = this.type ? '\"' + this.type + '\" block' : 'Block';\n    if (this.id) {\n      msg += ' (id=\"' + this.id + '\")';\n    }\n    return msg;\n  }\n}\n\nexport namespace Block {\n  export interface CommentModel {\n    text: string|null;\n    pinned: boolean;\n    size: Size;\n  }\n}\n\nexport type CommentModel = Block.CommentModel;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A class that manages a surface for dragging blocks.  When a\n * block drag is started, we move the block (and children) to a separate DOM\n * element that we move around using translate3d. At the end of the drag, the\n * blocks are put back in into the SVG they came from. This helps\n * performance by avoiding repainting the entire SVG on every mouse move\n * while dragging blocks.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BlockDragSurfaceSvg');\n\nimport {Coordinate} from './utils/coordinate.js';\nimport * as deprecation from './utils/deprecation.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\n\n\n/**\n * Class for a drag surface for the currently dragged block. This is a separate\n * SVG that contains only the currently moving block, or nothing.\n *\n * @alias Blockly.BlockDragSurfaceSvg\n */\nexport class BlockDragSurfaceSvg {\n  /**\n   * The root element of the drag surface.\n   */\n  private svg: SVGElement;\n\n  /**\n   * This is where blocks live while they are being dragged if the drag\n   * surface is enabled.\n   */\n  private dragGroup: SVGElement;\n\n  /**\n   * Cached value for the scale of the drag surface.\n   * Used to set/get the correct translation during and after a drag.\n   */\n  private scale = 1;\n\n  /**\n   * Cached value for the translation of the drag surface.\n   * This translation is in pixel units, because the scale is applied to the\n   * drag group rather than the top-level SVG.\n   */\n  private surfaceXY = new Coordinate(0, 0);\n\n  /**\n   * Cached value for the translation of the child drag surface in pixel\n   * units. Since the child drag surface tracks the translation of the\n   * workspace this is ultimately the translation of the workspace.\n   */\n  private readonly childSurfaceXY = new Coordinate(0, 0);\n\n  /** @param container Containing element. */\n  constructor(private readonly container: Element) {\n    this.svg = dom.createSvgElement(\n        Svg.SVG, {\n          'xmlns': dom.SVG_NS,\n          'xmlns:html': dom.HTML_NS,\n          'xmlns:xlink': dom.XLINK_NS,\n          'version': '1.1',\n          'class': 'blocklyBlockDragSurface',\n        },\n        this.container);\n\n    this.dragGroup = dom.createSvgElement(Svg.G, {}, this.svg);\n  }\n\n  /**\n   * Create the drag surface and inject it into the container.\n   *\n   * @deprecated The DOM is automatically created by the constructor.\n   */\n  createDom() {\n    // No alternative provided, because now the dom is just automatically\n    // created in the constructor now.\n    deprecation.warn('BlockDragSurfaceSvg createDom', 'June 2022', 'June 2023');\n  }\n\n  /**\n   * Set the SVG blocks on the drag surface's group and show the surface.\n   * Only one block group should be on the drag surface at a time.\n   *\n   * @param blocks Block or group of blocks to place on the drag surface.\n   */\n  setBlocksAndShow(blocks: SVGElement) {\n    if (this.dragGroup.childNodes.length) {\n      throw Error('Already dragging a block.');\n    }\n    // appendChild removes the blocks from the previous parent\n    this.dragGroup.appendChild(blocks);\n    this.svg.style.display = 'block';\n    this.surfaceXY = new Coordinate(0, 0);\n  }\n\n  /**\n   * Translate and scale the entire drag surface group to the given position, to\n   * keep in sync with the workspace.\n   *\n   * @param x X translation in pixel coordinates.\n   * @param y Y translation in pixel coordinates.\n   * @param scale Scale of the group.\n   */\n  translateAndScaleGroup(x: number, y: number, scale: number) {\n    this.scale = scale;\n    // Make sure the svg exists on a pixel boundary so that it is not fuzzy.\n    const roundX = Math.round(x);\n    const roundY = Math.round(y);\n    this.childSurfaceXY.x = roundX;\n    this.childSurfaceXY.y = roundY;\n    this.dragGroup.setAttribute(\n        'transform',\n        'translate(' + roundX + ',' + roundY + ') scale(' + scale + ')');\n  }\n\n  /**\n   * Translate the drag surface's SVG based on its internal state.\n   *\n   * @internal\n   */\n  translateSurfaceInternal_() {\n    // Make sure the svg exists on a pixel boundary so that it is not fuzzy.\n    const x = Math.round(this.surfaceXY.x);\n    const y = Math.round(this.surfaceXY.y);\n    this.svg.style.display = 'block';\n    dom.setCssTransform(this.svg, 'translate3d(' + x + 'px, ' + y + 'px, 0)');\n  }\n\n  /**\n   * Translates the entire surface by a relative offset.\n   *\n   * @param deltaX Horizontal offset in pixel units.\n   * @param deltaY Vertical offset in pixel units.\n   */\n  translateBy(deltaX: number, deltaY: number) {\n    const x = this.surfaceXY.x + deltaX;\n    const y = this.surfaceXY.y + deltaY;\n    this.surfaceXY = new Coordinate(x, y);\n    this.translateSurfaceInternal_();\n  }\n\n  /**\n   * Translate the entire drag surface during a drag.\n   * We translate the drag surface instead of the blocks inside the surface\n   * so that the browser avoids repainting the SVG.\n   * Because of this, the drag coordinates must be adjusted by scale.\n   *\n   * @param x X translation for the entire surface.\n   * @param y Y translation for the entire surface.\n   */\n  translateSurface(x: number, y: number) {\n    this.surfaceXY = new Coordinate(x * this.scale, y * this.scale);\n    this.translateSurfaceInternal_();\n  }\n\n  /**\n   * Reports the surface translation in scaled workspace coordinates.\n   * Use this when finishing a drag to return blocks to the correct position.\n   *\n   * @returns Current translation of the surface.\n   */\n  getSurfaceTranslation(): Coordinate {\n    const xy = svgMath.getRelativeXY(this.svg);\n    return new Coordinate(xy.x / this.scale, xy.y / this.scale);\n  }\n\n  /**\n   * Provide a reference to the drag group (primarily for\n   * BlockSvg.getRelativeToSurfaceXY).\n   *\n   * @returns Drag surface group element.\n   */\n  getGroup(): SVGElement {\n    return this.dragGroup;\n  }\n\n  /**\n   * Returns the SVG drag surface.\n   *\n   * @returns The SVG drag surface.\n   */\n  getSvgRoot(): SVGElement {\n    return this.svg;\n  }\n\n  /**\n   * Get the current blocks on the drag surface, if any (primarily\n   * for BlockSvg.getRelativeToSurfaceXY).\n   *\n   * @returns Drag surface block DOM element, or null if no blocks exist.\n   */\n  getCurrentBlock(): Element|null {\n    return this.dragGroup.firstChild as Element;\n  }\n\n  /**\n   * Gets the translation of the child block surface\n   * This surface is in charge of keeping track of how much the workspace has\n   * moved.\n   *\n   * @returns The amount the workspace has been moved.\n   */\n  getWsTranslation(): Coordinate {\n    // Returning a copy so the coordinate can not be changed outside this class.\n    return this.childSurfaceXY.clone();\n  }\n\n  /**\n   * Clear the group and hide the surface; move the blocks off onto the provided\n   * element.\n   * If the block is being deleted it doesn't need to go back to the original\n   * surface, since it would be removed immediately during dispose.\n   *\n   * @param opt_newSurface Surface the dragging blocks should be moved to, or\n   *     null if the blocks should be removed from this surface without being\n   *     moved to a different surface.\n   */\n  clearAndHide(opt_newSurface?: Element) {\n    const currentBlockElement = this.getCurrentBlock();\n    if (currentBlockElement) {\n      if (opt_newSurface) {\n        // appendChild removes the node from this.dragGroup\n        opt_newSurface.appendChild(currentBlockElement);\n      } else {\n        this.dragGroup.removeChild(currentBlockElement);\n      }\n    }\n    this.svg.style.display = 'none';\n    if (this.dragGroup.childNodes.length) {\n      throw Error('Drag group was not cleared.');\n    }\n    this.surfaceXY = new Coordinate(0, 0);\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a block drag.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockDrag');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners when a block is being manually dragged/dropped.\n */\nexport class BlockDrag extends UiBase {\n  /** The ID of the top-level block being dragged. */\n  blockId?: string;\n\n  /** True if this is the start of a drag, false if this is the end of one. */\n  isStart?: boolean;\n\n  /**\n   * A list of all of the blocks (i.e. all descendants of the block associated\n   * with the block ID) being dragged.\n   */\n  blocks?: Block[];\n\n  override type = eventUtils.BLOCK_DRAG;\n\n  /**\n   * @param opt_block The top block in the stack that is being dragged.\n   *     Undefined for a blank event.\n   * @param opt_isStart Whether this is the start of a block drag.\n   *    Undefined for a blank event.\n   * @param opt_blocks The blocks affected by this drag. Undefined for a blank\n   *     event.\n   */\n  constructor(opt_block?: Block, opt_isStart?: boolean, opt_blocks?: Block[]) {\n    const workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    super(workspaceId);\n    if (!opt_block) return;\n\n    this.blockId = opt_block.id;\n    this.isStart = opt_isStart;\n    this.blocks = opt_blocks;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockDragJson {\n    const json = super.toJson() as BlockDragJson;\n    if (this.isStart === undefined) {\n      throw new Error(\n          'Whether this event is the start of a drag is undefined. ' +\n          'Either pass the value to the constructor, or call fromJson');\n    }\n    if (this.blockId === undefined) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['isStart'] = this.isStart;\n    json['blockId'] = this.blockId;\n    // TODO: I don't think we should actually apply the blocks array to the JSON\n    //   object b/c they have functions and aren't actually serializable.\n    json['blocks'] = this.blocks;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockDragJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockDrag.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isStart = json['isStart'];\n    this.blockId = json['blockId'];\n    this.blocks = json['blocks'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockDrag, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses..\n   * @internal\n   */\n  static fromJson(json: BlockDragJson, workspace: Workspace, event?: any):\n      BlockDrag {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockDrag()) as BlockDrag;\n    newEvent.isStart = json['isStart'];\n    newEvent.blockId = json['blockId'];\n    newEvent.blocks = json['blocks'];\n    return newEvent;\n  }\n}\n\nexport interface BlockDragJson extends AbstractEventJson {\n  isStart: boolean;\n  blockId: string;\n  blocks?: Block[];\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.BLOCK_DRAG, BlockDrag);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Manager for all items registered with the workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ComponentManager');\n\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IComponent} from './interfaces/i_component.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport * as arrayUtils from './utils/array.js';\n\n\nclass Capability<_T> {\n  static POSITIONABLE = new Capability<IPositionable>('positionable');\n  static DRAG_TARGET = new Capability<IDragTarget>('drag_target');\n  static DELETE_AREA = new Capability<IDeleteArea>('delete_area');\n  static AUTOHIDEABLE = new Capability<IAutoHideable>('autohideable');\n  private readonly name_: string;\n  /** @param name The name of the component capability. */\n  constructor(name: string) {\n    this.name_ = name;\n  }\n\n  /**\n   * Returns the name of the capability.\n   *\n   * @returns The name.\n   */\n  toString(): string {\n    return this.name_;\n  }\n}\n\n/**\n * Manager for all items registered with the workspace.\n */\nexport class ComponentManager {\n  static Capability = Capability;\n\n  /**\n   * A map of the components registered with the workspace, mapped to id.\n   */\n  private readonly componentData = new Map<string, ComponentDatum>();\n\n  /** A map of capabilities to component IDs. */\n  private readonly capabilityToComponentIds = new Map<string, string[]>();\n\n  /**\n   * Adds a component.\n   *\n   * @param componentInfo The data for the component to register.\n   * @param opt_allowOverrides True to prevent an error when overriding an\n   *     already registered item.\n   */\n  addComponent(componentInfo: ComponentDatum, opt_allowOverrides?: boolean) {\n    // Don't throw an error if opt_allowOverrides is true.\n    const id = componentInfo.component.id;\n    if (!opt_allowOverrides && this.componentData.has(id)) {\n      throw Error(\n          'Plugin \"' + id + '\" with capabilities \"' +\n          this.componentData.get(id)?.capabilities + '\" already added.');\n    }\n    this.componentData.set(id, componentInfo);\n    const stringCapabilities = [];\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      stringCapabilities.push(capability);\n      if (!this.capabilityToComponentIds.has(capability)) {\n        this.capabilityToComponentIds.set(capability, [id]);\n      } else {\n        this.capabilityToComponentIds.get(capability)?.push(id);\n      }\n    }\n    this.componentData.get(id)!.capabilities = stringCapabilities;\n  }\n\n  /**\n   * Removes a component.\n   *\n   * @param id The ID of the component to remove.\n   */\n  removeComponent(id: string) {\n    const componentInfo = this.componentData.get(id);\n    if (!componentInfo) {\n      return;\n    }\n    for (let i = 0; i < componentInfo.capabilities.length; i++) {\n      const capability = String(componentInfo.capabilities[i]).toLowerCase();\n      arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n    }\n    this.componentData.delete(id);\n  }\n\n  /**\n   * Adds a capability to a existing registered component.\n   *\n   * @param id The ID of the component to add the capability to.\n   * @param capability The capability to add.\n   */\n  addCapability<T>(id: string, capability: string|Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n          'Cannot add capability, \"' + capability + '\". Plugin \"' + id +\n          '\" has not been added to the ComponentManager');\n    }\n    if (this.hasCapability(id, capability)) {\n      console.warn(\n          'Plugin \"' + id + 'already has capability \"' + capability + '\"');\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    this.componentData.get(id)?.capabilities.push(capability);\n    this.capabilityToComponentIds.get(capability)?.push(id);\n  }\n\n  /**\n   * Removes a capability from an existing registered component.\n   *\n   * @param id The ID of the component to remove the capability from.\n   * @param capability The capability to remove.\n   */\n  removeCapability<T>(id: string, capability: string|Capability<T>) {\n    if (!this.getComponent(id)) {\n      throw Error(\n          'Cannot remove capability, \"' + capability + '\". Plugin \"' + id +\n          '\" has not been added to the ComponentManager');\n    }\n    if (!this.hasCapability(id, capability)) {\n      console.warn(\n          'Plugin \"' + id + 'doesn\\'t have capability \"' + capability +\n          '\" to remove');\n      return;\n    }\n    capability = `${capability}`.toLowerCase();\n    arrayUtils.removeElem(this.componentData.get(id)!.capabilities, capability);\n    arrayUtils.removeElem(this.capabilityToComponentIds.get(capability)!, id);\n  }\n\n  /**\n   * Returns whether the component with this id has the specified capability.\n   *\n   * @param id The ID of the component to check.\n   * @param capability The capability to check for.\n   * @returns Whether the component has the capability.\n   */\n  hasCapability<T>(id: string, capability: string|Capability<T>): boolean {\n    capability = `${capability}`.toLowerCase();\n    return this.componentData.has(id) &&\n        this.componentData.get(id)!.capabilities.indexOf(capability) !== -1;\n  }\n\n  /**\n   * Gets the component with the given ID.\n   *\n   * @param id The ID of the component to get.\n   * @returns The component with the given name or undefined if not found.\n   */\n  getComponent(id: string): IComponent|undefined {\n    return this.componentData.get(id)?.component;\n  }\n\n  /**\n   * Gets all the components with the specified capability.\n   *\n   * @param capability The capability of the component.\n   * @param sorted Whether to return list ordered by weights.\n   * @returns The components that match the specified capability.\n   */\n  getComponents<T extends IComponent>(\n      capability: string|Capability<T>, sorted: boolean): T[] {\n    capability = `${capability}`.toLowerCase();\n    const componentIds = this.capabilityToComponentIds.get(capability);\n    if (!componentIds) {\n      return [];\n    }\n    const components: T[] = [];\n    if (sorted) {\n      const componentDataList: ComponentDatum[] = [];\n      componentIds.forEach((id) => {\n        componentDataList.push(this.componentData.get(id)!);\n      });\n      componentDataList.sort(function(a, b) {\n        return a.weight - b.weight;\n      });\n      componentDataList.forEach(function(componentDatum) {\n        components.push(componentDatum.component as T);\n      });\n    } else {\n      componentIds.forEach((id) => {\n        components.push(this.componentData.get(id)!.component as T);\n      });\n    }\n    return components;\n  }\n}\n\nexport namespace ComponentManager {\n  /** An object storing component information. */\n  export interface ComponentDatum {\n    component: IComponent;\n    capabilities: Array<string|Capability<IComponent>>;\n    weight: number;\n  }\n}\n\nexport type ComponentDatum = ComponentManager.ComponentDatum;\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class that controls updates to connections during drags.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.InsertionMarkerManager');\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {config} from './config.js';\nimport * as constants from './constants.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/** Represents a nearby valid connection. */\ninterface CandidateConnection {\n  /**\n   * A nearby valid connection that is compatible with local.\n   * This is not on any of the blocks that are being dragged.\n   */\n  closest: RenderedConnection;\n  /**\n   * A connection on the dragging stack that is compatible with closest. This is\n   * on the top block that is being dragged or the last block in the dragging\n   * stack.\n   */\n  local: RenderedConnection;\n  radius: number;\n}\n\n/**\n * An error message to throw if the block created by createMarkerBlock_ is\n * missing any components.\n */\nconst DUPLICATE_BLOCK_ERROR = 'The insertion marker ' +\n    'manager tried to create a marker but the result is missing %1. If ' +\n    'you are using a mutator, make sure your domToMutation method is ' +\n    'properly defined.';\n\n/**\n * Class that controls updates to connections during drags.  It is primarily\n * responsible for finding the closest eligible connection and highlighting or\n * unhighlighting it as needed during a drag.\n */\nexport class InsertionMarkerManager {\n  /**\n   * The top block in the stack being dragged.\n   * Does not change during a drag.\n   */\n  private readonly topBlock: BlockSvg;\n\n  /**\n   * The workspace on which these connections are being dragged.\n   * Does not change during a drag.\n   */\n  private readonly workspace: WorkspaceSvg;\n\n  /**\n   * The last connection on the stack, if it's not the last connection on the\n   * first block.\n   * Set in initAvailableConnections, if at all.\n   */\n  private lastOnStack: RenderedConnection|null = null;\n\n  /**\n   * The insertion marker corresponding to the last block in the stack, if\n   * that's not the same as the first block in the stack.\n   * Set in initAvailableConnections, if at all\n   */\n  private lastMarker: BlockSvg|null = null;\n\n  /**\n   * The insertion marker that shows up between blocks to show where a block\n   * would go if dropped immediately.\n   */\n  private firstMarker: BlockSvg;\n\n  /**\n   * Information about the connection that would be made if the dragging block\n   * were released immediately. Updated on every mouse move.\n   */\n  private activeCandidate: CandidateConnection|null = null;\n\n  /**\n   * Whether the block would be deleted if it were dropped immediately.\n   * Updated on every mouse move.\n   *\n   * @internal\n   */\n  public wouldDeleteBlock = false;\n\n  /**\n   * Connection on the insertion marker block that corresponds to\n   * the active candidate's local connection on the currently dragged block.\n   */\n  private markerConnection: RenderedConnection|null = null;\n\n  /** The block that currently has an input being highlighted, or null. */\n  private highlightedBlock: BlockSvg|null = null;\n\n  /** The block being faded to indicate replacement, or null. */\n  private fadedBlock: BlockSvg|null = null;\n\n  /**\n   * The connections on the dragging blocks that are available to connect to\n   * other blocks.  This includes all open connections on the top block, as\n   * well as the last connection on the block stack.\n   */\n  private availableConnections: RenderedConnection[];\n\n  /** @param block The top block in the stack being dragged. */\n  constructor(block: BlockSvg) {\n    common.setSelected(block);\n    this.topBlock = block;\n\n    this.workspace = block.workspace;\n\n    this.firstMarker = this.createMarkerBlock(this.topBlock);\n\n    this.availableConnections = this.initAvailableConnections();\n\n    if (this.lastOnStack) {\n      this.lastMarker =\n          this.createMarkerBlock(this.lastOnStack.getSourceBlock());\n    }\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    this.availableConnections.length = 0;\n    this.disposeInsertionMarker(this.firstMarker);\n    this.disposeInsertionMarker(this.lastMarker);\n  }\n\n  /**\n   * Update the available connections for the top block. These connections can\n   * change if a block is unplugged and the stack is healed.\n   *\n   * @internal\n   */\n  updateAvailableConnections() {\n    this.availableConnections = this.initAvailableConnections();\n  }\n\n  /**\n   * Return whether the block would be connected if dropped immediately, based\n   * on information from the most recent move event.\n   *\n   * @returns True if the block would be connected if dropped immediately.\n   * @internal\n   */\n  wouldConnectBlock(): boolean {\n    return !!this.activeCandidate;\n  }\n\n  /**\n   * Connect to the closest connection and render the results.\n   * This should be called at the end of a drag.\n   *\n   * @internal\n   */\n  applyConnections() {\n    if (!this.activeCandidate) return;\n    eventUtils.disable();\n    this.hidePreview();\n    eventUtils.enable();\n    const {local, closest} = this.activeCandidate;\n    local.connect(closest);\n    if (this.topBlock.rendered) {\n      const inferiorConnection = local.isSuperior() ? closest : local;\n      const rootBlock = this.topBlock.getRootBlock();\n\n      // bringToFront is incredibly expensive. Delay by at least a frame.\n      requestAnimationFrame(() => {\n        blockAnimations.connectionUiEffect(inferiorConnection.getSourceBlock());\n        setTimeout(() => {\n          rootBlock.bringToFront();\n        }, 0);\n      });\n    }\n  }\n\n  /**\n   * Update connections based on the most recent move location.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @param dragTarget The drag target that the block is currently over.\n   * @internal\n   */\n  update(dxy: Coordinate, dragTarget: IDragTarget|null) {\n    const newCandidate = this.getCandidate(dxy);\n\n    this.wouldDeleteBlock = this.shouldDelete(!!newCandidate, dragTarget);\n\n    const shouldUpdate =\n        this.wouldDeleteBlock || this.shouldUpdatePreviews(newCandidate, dxy);\n\n    if (shouldUpdate) {\n      // Don't fire events for insertion marker creation or movement.\n      eventUtils.disable();\n      this.maybeHidePreview(newCandidate);\n      this.maybeShowPreview(newCandidate);\n      eventUtils.enable();\n    }\n  }\n\n  /**\n   * Create an insertion marker that represents the given block.\n   *\n   * @param sourceBlock The block that the insertion marker will represent.\n   * @returns The insertion marker that represents the given block.\n   */\n  private createMarkerBlock(sourceBlock: BlockSvg): BlockSvg {\n    const imType = sourceBlock.type;\n\n    eventUtils.disable();\n    let result: BlockSvg;\n    try {\n      result = this.workspace.newBlock(imType);\n      result.setInsertionMarker(true);\n      if (sourceBlock.saveExtraState) {\n        const state = sourceBlock.saveExtraState();\n        if (state && result.loadExtraState) {\n          result.loadExtraState(state);\n        }\n      } else if (sourceBlock.mutationToDom) {\n        const oldMutationDom = sourceBlock.mutationToDom();\n        if (oldMutationDom && result.domToMutation) {\n          result.domToMutation(oldMutationDom);\n        }\n      }\n      // Copy field values from the other block.  These values may impact the\n      // rendered size of the insertion marker.  Note that we do not care about\n      // child blocks here.\n      for (let i = 0; i < sourceBlock.inputList.length; i++) {\n        const sourceInput = sourceBlock.inputList[i];\n        if (sourceInput.name === constants.COLLAPSED_INPUT_NAME) {\n          continue;  // Ignore the collapsed input.\n        }\n        const resultInput = result.inputList[i];\n        if (!resultInput) {\n          throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'an input'));\n        }\n        for (let j = 0; j < sourceInput.fieldRow.length; j++) {\n          const sourceField = sourceInput.fieldRow[j];\n          const resultField = resultInput.fieldRow[j];\n          if (!resultField) {\n            throw new Error(DUPLICATE_BLOCK_ERROR.replace('%1', 'a field'));\n          }\n          resultField.setValue(sourceField.getValue());\n        }\n      }\n\n      result.setCollapsed(sourceBlock.isCollapsed());\n      result.setInputsInline(sourceBlock.getInputsInline());\n\n      result.initSvg();\n      result.getSvgRoot().setAttribute('visibility', 'hidden');\n    } finally {\n      eventUtils.enable();\n    }\n\n    return result;\n  }\n\n  /**\n   * Populate the list of available connections on this block stack. If the\n   * stack has more than one block, this function will also update lastOnStack.\n   *\n   * @returns A list of available connections.\n   */\n  private initAvailableConnections(): RenderedConnection[] {\n    const available = this.topBlock.getConnections_(false);\n    // Also check the last connection on this stack\n    const lastOnStack = this.topBlock.lastConnectionInStack(true);\n    if (lastOnStack && lastOnStack !== this.topBlock.nextConnection) {\n      available.push(lastOnStack);\n      this.lastOnStack = lastOnStack;\n    }\n    return available;\n  }\n\n  /**\n   * Whether the previews (insertion marker and replacement marker) should be\n   * updated based on the closest candidate and the current drag distance.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns Whether the preview should be updated.\n   */\n  private shouldUpdatePreviews(\n      newCandidate: CandidateConnection|null, dxy: Coordinate): boolean {\n    // Only need to update if we were showing a preview before.\n    if (!newCandidate) return !!this.activeCandidate;\n\n    // We weren't showing a preview before, but we should now.\n    if (!this.activeCandidate) return true;\n\n    // We're already showing an insertion marker.\n    // Decide whether the new connection has higher priority.\n    const {local: activeLocal, closest: activeClosest} = this.activeCandidate;\n    if (activeClosest === newCandidate.closest &&\n        activeLocal === newCandidate.local) {\n      // The connection was the same as the current connection.\n      return false;\n    }\n\n    const xDiff = activeLocal.x + dxy.x - activeClosest.x;\n    const yDiff = activeLocal.y + dxy.y - activeClosest.y;\n    const curDistance = Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n    // Slightly prefer the existing preview over a new preview.\n    return (\n        newCandidate.radius < curDistance - config.currentConnectionPreference);\n  }\n\n  /**\n   * Find the nearest valid connection, which may be the same as the current\n   * closest connection.\n   *\n   * @param dxy Position relative to drag start, in workspace units.\n   * @returns An object containing a local connection, a closest connection, and\n   *     a radius.\n   */\n  private getCandidate(dxy: Coordinate): CandidateConnection|null {\n    // It's possible that a block has added or removed connections during a\n    // drag, (e.g. in a drag/move event handler), so let's update the available\n    // connections. Note that this will be called on every move while dragging,\n    // so it might cause slowness, especially if the block stack is large.  If\n    // so, maybe it could be made more efficient. Also note that we won't update\n    // the connections if we've already connected the insertion marker to a\n    // block.\n    if (!this.markerConnection || !this.markerConnection.isConnected()) {\n      this.updateAvailableConnections();\n    }\n\n    let radius = this.getStartRadius();\n    let candidate = null;\n    for (let i = 0; i < this.availableConnections.length; i++) {\n      const myConnection = this.availableConnections[i];\n      const neighbour = myConnection.closest(radius, dxy);\n      if (neighbour.connection) {\n        candidate = {\n          closest: neighbour.connection,\n          local: myConnection,\n          radius: neighbour.radius,\n        };\n        radius = neighbour.radius;\n      }\n    }\n    return candidate;\n  }\n\n  /**\n   * Decide the radius at which to start searching for the closest connection.\n   *\n   * @returns The radius at which to start the search for the closest\n   *     connection.\n   */\n  private getStartRadius(): number {\n    // If there is already a connection highlighted,\n    // increase the radius we check for making new connections.\n    // When a connection is highlighted, blocks move around when the\n    // insertion marker is created, which could cause the connection became out\n    // of range. By increasing radiusConnection when a connection already\n    // exists, we never \"lose\" the connection from the offset.\n    return this.activeCandidate ? config.connectingSnapRadius :\n                                  config.snapRadius;\n  }\n\n  /**\n   * Whether ending the drag would delete the block.\n   *\n   * @param newCandidate Whether there is a candidate connection that the\n   *     block could connect to if the drag ended immediately.\n   * @param dragTarget The drag target that the block is currently over.\n   * @returns Whether dropping the block immediately would delete the block.\n   */\n  private shouldDelete(newCandidate: boolean, dragTarget: IDragTarget|null):\n      boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n          dragTarget.id, ComponentManager.Capability.DELETE_AREA);\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea)\n            .wouldDelete(this.topBlock, newCandidate);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Show an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the beginning of this function, this.activeConnection should be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeShowPreview(newCandidate: CandidateConnection|null) {\n    if (this.wouldDeleteBlock) return;  // Nope, don't add a marker.\n    if (!newCandidate) return;          // Nothing to connect to.\n\n    const closest = newCandidate.closest;\n\n    // Something went wrong and we're trying to connect to an invalid\n    // connection.\n    if (closest === this.activeCandidate?.closest ||\n        closest.getSourceBlock().isInsertionMarker()) {\n      console.log('Trying to connect to an insertion marker');\n      return;\n    }\n    this.activeCandidate = newCandidate;\n    // Add an insertion marker or replacement marker.\n    this.showPreview(this.activeCandidate);\n  }\n\n  /**\n   * A preview should be shown.  This function figures out if it should be a\n   * block highlight or an insertion marker, and shows the appropriate one.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showPreview(activeCandidate: CandidateConnection) {\n    const renderer = this.workspace.getRenderer();\n    const method = renderer.getConnectionPreviewMethod(\n        activeCandidate.closest, activeCandidate.local, this.topBlock);\n\n    switch (method) {\n      case InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE:\n        this.showInsertionInputOutline(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER:\n        this.showInsertionMarker(activeCandidate);\n        break;\n      case InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE:\n        this.showReplacementFade(activeCandidate);\n        break;\n    }\n\n    // Optionally highlight the actual connection, as a nod to previous\n    // behaviour.\n    if (renderer.shouldHighlightConnection(activeCandidate.closest)) {\n      activeCandidate.closest.highlight();\n    }\n  }\n\n  /**\n   * Hide an insertion marker or replacement highlighting during a drag, if\n   * needed.\n   * At the end of this function, this.activeCandidate will be null.\n   *\n   * @param newCandidate A new candidate connection that may replace the current\n   *     best candidate.\n   */\n  private maybeHidePreview(newCandidate: CandidateConnection|null) {\n    // If there's no new preview, remove the old one but don't bother deleting\n    // it. We might need it later, and this saves disposing of it and recreating\n    // it.\n    if (!newCandidate) {\n      this.hidePreview();\n    } else {\n      if (this.activeCandidate) {\n        const closestChanged =\n            this.activeCandidate.closest !== newCandidate.closest;\n        const localChanged = this.activeCandidate.local !== newCandidate.local;\n\n        // If there's a new preview and there was a preview before, and either\n        // connection has changed, remove the old preview.\n        // Also hide if we had a preview before but now we're going to delete\n        // instead.\n        if ((closestChanged || localChanged || this.wouldDeleteBlock)) {\n          this.hidePreview();\n        }\n      }\n    }\n\n    // Either way, clear out old state.\n    this.markerConnection = null;\n    this.activeCandidate = null;\n  }\n\n  /**\n   * A preview should be hidden. Loop through all possible preview modes\n   * and hide everything.\n   */\n  private hidePreview() {\n    const closest = this.activeCandidate?.closest;\n    if (closest && closest.targetBlock() &&\n        this.workspace.getRenderer().shouldHighlightConnection(closest)) {\n      closest.unhighlight();\n    }\n    this.hideReplacementFade();\n    this.hideInsertionInputOutline();\n    this.hideInsertionMarker();\n  }\n\n  /**\n   * Shows an insertion marker connected to the appropriate blocks (based on\n   * manager state).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionMarker(activeCandidate: CandidateConnection) {\n    const {local, closest} = activeCandidate;\n\n    const isLastInStack = this.lastOnStack && local === this.lastOnStack;\n    let insertionMarker = isLastInStack ? this.lastMarker : this.firstMarker;\n    if (!insertionMarker) {\n      throw new Error(\n          'Cannot show the insertion marker because there is no insertion ' +\n          'marker block');\n    }\n    let imConn;\n    try {\n      imConn =\n          insertionMarker.getMatchingConnection(local.getSourceBlock(), local);\n    } catch (e) {\n      // It's possible that the number of connections on the local block has\n      // changed since the insertion marker was originally created.  Let's\n      // recreate the insertion marker and try again. In theory we could\n      // probably recreate the marker block (e.g. in getCandidate_), which is\n      // called more often during the drag, but creating a block that often\n      // might be too slow, so we only do it if necessary.\n      if (isLastInStack && this.lastOnStack) {\n        this.disposeInsertionMarker(this.lastMarker);\n        this.lastMarker =\n            this.createMarkerBlock(this.lastOnStack.getSourceBlock());\n        insertionMarker = this.lastMarker;\n      } else {\n        this.disposeInsertionMarker(this.firstMarker);\n        this.firstMarker = this.createMarkerBlock(this.topBlock);\n        insertionMarker = this.firstMarker;\n      }\n\n      if (!insertionMarker) {\n        throw new Error(\n            'Cannot show the insertion marker because there is no insertion ' +\n            'marker block');\n      }\n      imConn =\n          insertionMarker.getMatchingConnection(local.getSourceBlock(), local);\n    }\n\n    if (!imConn) {\n      throw new Error(\n          'Cannot show the insertion marker because there is no ' +\n          'associated connection');\n    }\n\n    if (imConn === this.markerConnection) {\n      throw new Error(\n          'Made it to showInsertionMarker_ even though the marker isn\\'t ' +\n          'changing');\n    }\n\n    // Render disconnected from everything else so that we have a valid\n    // connection location.\n    insertionMarker.render();\n    insertionMarker.rendered = true;\n    insertionMarker.getSvgRoot().setAttribute('visibility', 'visible');\n\n    if (imConn && closest) {\n      // Position so that the existing block doesn't move.\n      insertionMarker.positionNearConnection(imConn, closest);\n    }\n    if (closest) {\n      // Connect() also renders the insertion marker.\n      imConn.connect(closest);\n    }\n\n    this.markerConnection = imConn;\n  }\n\n  /**\n   * Disconnects and hides the current insertion marker. Should return the\n   * blocks to their original state.\n   */\n  private hideInsertionMarker() {\n    if (!this.markerConnection) return;\n\n    const markerConn = this.markerConnection;\n    const imBlock = markerConn.getSourceBlock();\n    const markerPrev = imBlock.previousConnection;\n    const markerOutput = imBlock.outputConnection;\n\n    if (!markerPrev?.targetConnection && !markerOutput?.targetConnection) {\n      // If we are the top block, unplugging doesn't do anything.\n      // The marker connection may not have a target block if we are hiding\n      // as part of applying connections.\n      markerConn.targetBlock()?.unplug(false);\n    } else {\n      imBlock.unplug(true);\n    }\n\n    if (markerConn.targetConnection) {\n      throw Error(\n          'markerConnection still connected at the end of ' +\n          'disconnectInsertionMarker');\n    }\n\n    this.markerConnection = null;\n    const svg = imBlock.getSvgRoot();\n    if (svg) {\n      svg.setAttribute('visibility', 'hidden');\n    }\n  }\n\n  /**\n   * Shows an outline around the input the closest connection belongs to.\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showInsertionInputOutline(activeCandidate: CandidateConnection) {\n    const closest = activeCandidate.closest;\n    this.highlightedBlock = closest.getSourceBlock();\n    this.highlightedBlock.highlightShapeForInput(closest, true);\n  }\n\n  /** Hides any visible input outlines. */\n  private hideInsertionInputOutline() {\n    if (!this.highlightedBlock) return;\n\n    if (!this.activeCandidate) {\n      throw new Error(\n          'Cannot hide the insertion marker outline because ' +\n          'there is no active candidate');\n    }\n    this.highlightedBlock.highlightShapeForInput(\n        this.activeCandidate.closest, false);\n    this.highlightedBlock = null;\n  }\n\n  /**\n   * Shows a replacement fade affect on the closest connection's target block\n   * (the block that is currently connected to it).\n   *\n   * @param activeCandidate The connection that will be made if the drag ends\n   *     immediately.\n   */\n  private showReplacementFade(activeCandidate: CandidateConnection) {\n    this.fadedBlock = activeCandidate.closest.targetBlock();\n    if (!this.fadedBlock) {\n      throw new Error(\n          'Cannot show the replacement fade because the ' +\n          'closest connection does not have a target block');\n    }\n    this.fadedBlock.fadeForReplacement(true);\n  }\n\n  /**\n   * Hides/Removes any visible fade affects.\n   */\n  private hideReplacementFade() {\n    if (!this.fadedBlock) return;\n\n    this.fadedBlock.fadeForReplacement(false);\n    this.fadedBlock = null;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Drags have 0, 1,\n   * or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    const result = [];\n    if (this.firstMarker) {\n      result.push(this.firstMarker);\n    }\n    if (this.lastMarker) {\n      result.push(this.lastMarker);\n    }\n    return result;\n  }\n\n  /**\n   * Safely disposes of an insertion marker.\n   */\n  private disposeInsertionMarker(marker: BlockSvg|null) {\n    if (marker) {\n      eventUtils.disable();\n      try {\n        marker.dispose();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n  }\n}\n\nexport namespace InsertionMarkerManager {\n  /**\n   * An enum describing different kinds of previews the InsertionMarkerManager\n   * could display.\n   */\n  export enum PREVIEW_TYPE {\n    INSERTION_MARKER = 0,\n    INPUT_OUTLINE = 1,\n    REPLACEMENT_FADE = 2,\n  }\n}\n\nexport type PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\nexport const PreviewType = InsertionMarkerManager.PREVIEW_TYPE;\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a code comment.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Comment');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_bubble_open.js';\n\nimport type {CommentModel} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {Bubble} from './bubble.js';\nimport * as Css from './css.js';\nimport * as eventUtils from './events/utils.js';\nimport {Icon} from './icon.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport type {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n\n/**\n * Class for a comment.\n */\nexport class Comment extends Icon {\n  private readonly model: CommentModel;\n\n  /**\n   * The model's text value at the start of an edit.\n   * Used to tell if an event should be fired at the end of an edit.\n   */\n  private cachedText: string|null = '';\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * The SVG element that contains the text edit area, or null if not created.\n   */\n  private foreignObject: SVGForeignObjectElement|null = null;\n\n  /** The editable text area, or null if not created. */\n  private textarea_: HTMLTextAreaElement|null = null;\n\n  /** The top-level node of the comment text, or null if not created. */\n  private paragraphElement_: SVGTextElement|null = null;\n\n  /** @param block The block associated with this comment. */\n  constructor(block: BlockSvg) {\n    super(block);\n\n    /** The model for this comment. */\n    this.model = block.commentModel;\n    // If someone creates the comment directly instead of calling\n    // block.setCommentText we want to make sure the text is non-null;\n    this.model.text = this.model.text ?? '';\n\n    this.createIcon();\n  }\n\n  /**\n   * Draw the comment icon.\n   *\n   * @param group The icon group.\n   */\n  protected override drawIcon_(group: Element) {\n    // Circle.\n    dom.createSvgElement(\n        Svg.CIRCLE,\n        {'class': 'blocklyIconShape', 'r': '8', 'cx': '8', 'cy': '8'}, group);\n    // Can't use a real '?' text character since different browsers and\n    // operating systems render it differently. Body of question mark.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconSymbol',\n          'd': 'm6.8,10h2c0.003,-0.617 0.271,-0.962 0.633,-1.266 2.875,-2.405' +\n              '0.607,-5.534 -3.765,-3.874v1.7c3.12,-1.657 3.698,0.118 2.336,1.25' +\n              '-1.201,0.998 -1.201,1.528 -1.204,2.19z',\n        },\n        group);\n    // Dot of question mark.\n    dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyIconSymbol',\n          'x': '6.8',\n          'y': '10.78',\n          'height': '2',\n          'width': '2',\n        },\n        group);\n  }\n\n  /**\n   * Create the editor for the comment's bubble.\n   *\n   * @returns The top-level node of the editor.\n   */\n  private createEditor(): SVGElement {\n    /* Create the editor.  Here's the markup that will be generated in\n         * editable mode:\n          <foreignObject x=\"8\" y=\"8\" width=\"164\" height=\"164\">\n            <body xmlns=\"http://www.w3.org/1999/xhtml\"\n       class=\"blocklyMinimalBody\"> <textarea\n       xmlns=\"http://www.w3.org/1999/xhtml\" class=\"blocklyCommentTextarea\"\n                  style=\"height: 164px; width: 164px;\"></textarea>\n            </body>\n          </foreignObject>\n         * For non-editable mode see Warning.textToDom_.\n         */\n\n    this.foreignObject = dom.createSvgElement(\n        Svg.FOREIGNOBJECT,\n        {'x': Bubble.BORDER_WIDTH, 'y': Bubble.BORDER_WIDTH});\n\n    const body = document.createElementNS(dom.HTML_NS, 'body');\n    body.setAttribute('xmlns', dom.HTML_NS);\n    body.className = 'blocklyMinimalBody';\n\n    this.textarea_ = document.createElementNS(dom.HTML_NS, 'textarea') as\n        HTMLTextAreaElement;\n    const textarea = this.textarea_;\n    textarea.className = 'blocklyCommentTextarea';\n    textarea.setAttribute('dir', this.getBlock().RTL ? 'RTL' : 'LTR');\n    textarea.value = this.model.text ?? '';\n    this.resizeTextarea();\n\n    body.appendChild(textarea);\n    this.foreignObject!.appendChild(body);\n\n    this.boundEvents.push(browserEvents.conditionalBind(\n        textarea, 'focus', this, this.startEdit, true));\n    // Don't zoom with mousewheel.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        textarea, 'wheel', this, function(e: Event) {\n          e.stopPropagation();\n        }));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        textarea, 'change', this,\n        /**\n         * @param _e Unused event parameter.\n         */\n        function(this: Comment, _e: Event) {\n          if (this.cachedText !== this.model.text) {\n            eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n                this.getBlock(), 'comment', null, this.cachedText,\n                this.model.text));\n          }\n        }));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        textarea, 'input', this,\n        /**\n         * @param _e Unused event parameter.\n         */\n        function(this: Comment, _e: Event) {\n          this.model.text = textarea.value;\n        }));\n\n    setTimeout(textarea.focus.bind(textarea), 0);\n\n    return this.foreignObject;\n  }\n\n  /** Add or remove editability of the comment. */\n  override updateEditable() {\n    super.updateEditable();\n    if (this.isVisible()) {\n      // Recreate the bubble with the correct UI.\n      this.disposeBubble();\n      this.createBubble();\n    }\n  }\n\n  /**\n   * Callback function triggered when the bubble has resized.\n   * Resize the text area accordingly.\n   */\n  private onBubbleResize() {\n    if (!this.isVisible() || !this.bubble_) {\n      return;\n    }\n\n    this.model.size = this.bubble_.getBubbleSize();\n    this.resizeTextarea();\n  }\n\n  /**\n   * Resizes the text area to match the size defined on the model (which is\n   * the size of the bubble).\n   */\n  private resizeTextarea() {\n    if (!this.textarea_ || !this.foreignObject) {\n      return;\n    }\n    const size = this.model.size;\n    const doubleBorderWidth = 2 * Bubble.BORDER_WIDTH;\n    const widthMinusBorder = size.width - doubleBorderWidth;\n    const heightMinusBorder = size.height - doubleBorderWidth;\n    this.foreignObject.setAttribute('width', `${widthMinusBorder}`);\n    this.foreignObject.setAttribute('height', `${heightMinusBorder}`);\n    this.textarea_.style.width = widthMinusBorder - 4 + 'px';\n    this.textarea_.style.height = heightMinusBorder - 4 + 'px';\n  }\n\n  /**\n   * Show or hide the comment bubble.\n   *\n   * @param visible True if the bubble should be visible.\n   */\n  override setVisible(visible: boolean) {\n    if (visible === this.isVisible()) {\n      return;\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.getBlock(), visible, 'comment'));\n    this.model.pinned = visible;\n    if (visible) {\n      this.createBubble();\n    } else {\n      this.disposeBubble();\n    }\n  }\n\n  /** Show the bubble. Handles deciding if it should be editable or not. */\n  private createBubble() {\n    if (!this.getBlock().isEditable()) {\n      this.createNonEditableBubble();\n    } else {\n      this.createEditableBubble();\n    }\n  }\n\n  /** Show an editable bubble. */\n  private createEditableBubble() {\n    const block = this.getBlock();\n    this.bubble_ = new Bubble(\n        block.workspace, this.createEditor(), block.pathObject.svgPath,\n        (this.iconXY_ as Coordinate), this.model.size.width,\n        this.model.size.height);\n    // Expose this comment's block's ID on its top-level SVG group.\n    this.bubble_.setSvgId(block.id);\n    this.bubble_.registerResizeEvent(this.onBubbleResize.bind(this));\n    this.applyColour();\n  }\n\n  /**\n   * Show a non-editable bubble.\n   */\n  private createNonEditableBubble() {\n    // TODO (#2917): It would be great if the comment could support line breaks.\n    this.paragraphElement_ = Bubble.textToDom(this.model.text ?? '');\n    this.bubble_ = Bubble.createNonEditableBubble(\n        this.paragraphElement_, this.getBlock(), this.iconXY_ as Coordinate);\n    this.applyColour();\n  }\n\n  /**\n   * Dispose of the bubble.\n   */\n  private disposeBubble() {\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    if (this.bubble_) {\n      this.bubble_.dispose();\n      this.bubble_ = null;\n    }\n    this.textarea_ = null;\n    this.foreignObject = null;\n    this.paragraphElement_ = null;\n  }\n\n  /**\n   * Callback fired when an edit starts.\n   *\n   * Bring the comment to the top of the stack when clicked on. Also cache the\n   * current text so it can be used to fire a change event.\n   *\n   * @param _e Mouse up event.\n   */\n  private startEdit(_e: PointerEvent) {\n    if (this.bubble_?.promote()) {\n      // Since the act of moving this node within the DOM causes a loss of\n      // focus, we need to reapply the focus.\n      this.textarea_!.focus();\n    }\n\n    this.cachedText = this.model.text;\n  }\n\n  /**\n   * Get the dimensions of this comment's bubble.\n   *\n   * @returns Object with width and height properties.\n   */\n  getBubbleSize(): Size {\n    return this.model.size;\n  }\n\n  /**\n   * Size this comment's bubble.\n   *\n   * @param width Width of the bubble.\n   * @param height Height of the bubble.\n   */\n  setBubbleSize(width: number, height: number) {\n    if (this.bubble_) {\n      this.bubble_.setBubbleSize(width, height);\n    } else {\n      this.model.size.width = width;\n      this.model.size.height = height;\n    }\n  }\n\n  /**\n   * Update the comment's view to match the model.\n   *\n   * @internal\n   */\n  updateText() {\n    if (this.textarea_) {\n      this.textarea_.value = this.model.text ?? '';\n    } else if (this.paragraphElement_) {\n      // Non-Editable mode.\n      // TODO (#2917): If 2917 gets added this will probably need to be updated.\n      this.paragraphElement_.firstChild!.textContent = this.model.text;\n    }\n  }\n\n  /**\n   * Dispose of this comment.\n   *\n   * If you want to receive a comment \"delete\" event (newValue: null), then this\n   * should not be called directly. Instead call block.setCommentText(null);\n   */\n  override dispose() {\n    this.getBlock().comment = null;\n    super.dispose();\n  }\n}\n\n/** CSS for block comment.  See css.js for use. */\nCss.register(`\n.blocklyCommentTextarea {\n  background-color: #fef49c;\n  border: 0;\n  display: block;\n  margin: 0;\n  outline: 0;\n  padding: 3px;\n  resize: none;\n  text-overflow: hidden;\n}\n`);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Registry for context menu option items.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ContextMenuRegistry');\n\nimport type {BlockSvg} from './block_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for the registry of context menu items. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ContextMenuRegistry.registry.\n */\nexport class ContextMenuRegistry {\n  static registry: ContextMenuRegistry;\n  /** Registry of all registered RegistryItems, keyed by ID. */\n  private registry_ = new Map<string, RegistryItem>();\n\n  /** Resets the existing singleton instance of ContextMenuRegistry. */\n  constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry. */\n  reset() {\n    this.registry_.clear();\n  }\n\n  /**\n   * Registers a RegistryItem.\n   *\n   * @param item Context menu item to register.\n   * @throws {Error} if an item with the given ID already exists.\n   */\n  register(item: RegistryItem) {\n    if (this.registry_.has(item.id)) {\n      throw Error('Menu item with ID \"' + item.id + '\" is already registered.');\n    }\n    this.registry_.set(item.id, item);\n  }\n\n  /**\n   * Unregisters a RegistryItem with the given ID.\n   *\n   * @param id The ID of the RegistryItem to remove.\n   * @throws {Error} if an item with the given ID does not exist.\n   */\n  unregister(id: string) {\n    if (!this.registry_.has(id)) {\n      throw new Error('Menu item with ID \"' + id + '\" not found.');\n    }\n    this.registry_.delete(id);\n  }\n\n  /**\n   * @param id The ID of the RegistryItem to get.\n   * @returns RegistryItem or null if not found\n   */\n  getItem(id: string): RegistryItem|null {\n    return this.registry_.get(id) ?? null;\n  }\n\n  /**\n   * Gets the valid context menu options for the given scope type (e.g. block or\n   * workspace) and scope. Blocks are only shown if the preconditionFn shows\n   * they should not be hidden.\n   *\n   * @param scopeType Type of scope where menu should be shown (e.g. on a block\n   *     or on a workspace)\n   * @param scope Current scope of context menu (i.e., the exact workspace or\n   *     block being clicked on)\n   * @returns the list of ContextMenuOptions\n   */\n  getContextMenuOptions(scopeType: ScopeType, scope: Scope):\n      ContextMenuOption[] {\n    const menuOptions: ContextMenuOption[] = [];\n    for (const item of this.registry_.values()) {\n      if (scopeType === item.scopeType) {\n        const precondition = item.preconditionFn(scope);\n        if (precondition !== 'hidden') {\n          const displayText = typeof item.displayText === 'function' ?\n              item.displayText(scope) :\n              item.displayText;\n          const menuOption: ContextMenuOption = {\n            text: displayText,\n            enabled: precondition === 'enabled',\n            callback: item.callback,\n            scope,\n            weight: item.weight,\n          };\n          menuOptions.push(menuOption);\n        }\n      }\n    }\n    menuOptions.sort(function(a, b) {\n      return a.weight - b.weight;\n    });\n    return menuOptions;\n  }\n}\n\nexport namespace ContextMenuRegistry {\n  /**\n   * Where this menu item should be rendered. If the menu item should be\n   * rendered in multiple scopes, e.g. on both a block and a workspace, it\n   * should be registered for each scope.\n   */\n  export enum ScopeType {\n    BLOCK = 'block',\n    WORKSPACE = 'workspace',\n  }\n\n  /**\n   * The actual workspace/block where the menu is being rendered. This is passed\n   * to callback and displayText functions that depend on this information.\n   */\n  export interface Scope {\n    block?: BlockSvg;\n    workspace?: WorkspaceSvg;\n  }\n\n  /**\n   * A menu item as entered in the registry.\n   */\n  export interface RegistryItem {\n    callback: (p1: Scope) => void;\n    scopeType: ScopeType;\n    displayText: ((p1: Scope) => string)|string;\n    preconditionFn: (p1: Scope) => string;\n    weight: number;\n    id: string;\n  }\n\n  /**\n   * A menu item as presented to contextmenu.js.\n   */\n  export interface ContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n    scope: Scope;\n    weight: number;\n  }\n\n  /**\n   * A subset of ContextMenuOption corresponding to what was publicly\n   * documented.  ContextMenuOption should be preferred for new code.\n   */\n  export interface LegacyContextMenuOption {\n    text: string;\n    enabled: boolean;\n    callback: (p1: Scope) => void;\n  }\n\n  /**\n   * Singleton instance of this class. All interactions with this class should\n   * be done on this object.\n   */\n  ContextMenuRegistry.registry = new ContextMenuRegistry();\n}\n\nexport type ScopeType = ContextMenuRegistry.ScopeType;\nexport const ScopeType = ContextMenuRegistry.ScopeType;\nexport type Scope = ContextMenuRegistry.Scope;\nexport type RegistryItem = ContextMenuRegistry.RegistryItem;\nexport type ContextMenuOption = ContextMenuRegistry.ContextMenuOption;\nexport type LegacyContextMenuOption =\n    ContextMenuRegistry.LegacyContextMenuOption;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.internalConstants');\n\nimport {ConnectionType} from './connection_type.js';\n\n\n/**\n * Number of characters to truncate a collapsed block to.\n *\n * @internal\n */\nexport const COLLAPSE_CHARS = 30;\n\n/**\n * When dragging a block out of a stack, split the stack in two (true), or drag\n * out the block healing the stack (false).\n *\n * @internal\n */\nexport const DRAG_STACK = true;\n\n/**\n * Lookup table for determining the opposite type of a connection.\n *\n * @internal\n */\nexport const OPPOSITE_TYPE: number[] = [];\nOPPOSITE_TYPE[ConnectionType.INPUT_VALUE] = ConnectionType.OUTPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.OUTPUT_VALUE] = ConnectionType.INPUT_VALUE;\nOPPOSITE_TYPE[ConnectionType.NEXT_STATEMENT] =\n    ConnectionType.PREVIOUS_STATEMENT;\nOPPOSITE_TYPE[ConnectionType.PREVIOUS_STATEMENT] =\n    ConnectionType.NEXT_STATEMENT;\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Rename\n * variable...' and if selected, should trigger the prompt to rename a variable.\n *\n * @internal\n */\nexport const RENAME_VARIABLE_ID = 'RENAME_VARIABLE_ID';\n\n/**\n * String for use in the dropdown created in field_variable.\n * This string indicates that this option in the dropdown is 'Delete the \"%1\"\n * variable' and if selected, should trigger the prompt to delete a variable.\n *\n * @internal\n */\nexport const DELETE_VARIABLE_ID = 'DELETE_VARIABLE_ID';\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a marker.\n * Used primarily for keyboard navigation to show a marked location.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Marker');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {MarkerSvg} from '../renderers/common/marker_svg.js';\n\nimport type {ASTNode} from './ast_node.js';\n\n\n/**\n * Class for a marker.\n * This is used in keyboard navigation to save a location in the Blockly AST.\n */\nexport class Marker {\n  /** The colour of the marker. */\n  colour: string|null = null;\n\n  /** The current location of the marker. */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'ASTNode'.\n  private curNode_: ASTNode = null as AnyDuringMigration;\n\n  /**\n   * The object in charge of drawing the visual representation of the current\n   * node.\n   */\n  // AnyDuringMigration because:  Type 'null' is not assignable to type\n  // 'MarkerSvg'.\n  private drawer_: MarkerSvg = null as AnyDuringMigration;\n\n  /** The type of the marker. */\n  type = 'marker';\n\n  /** Constructs a new Marker instance. */\n  constructor() {}\n\n  /**\n   * Sets the object in charge of drawing the marker.\n   *\n   * @param drawer The object in charge of drawing the marker.\n   */\n  setDrawer(drawer: MarkerSvg) {\n    this.drawer_ = drawer;\n  }\n\n  /**\n   * Get the current drawer for the marker.\n   *\n   * @returns The object in charge of drawing the marker.\n   */\n  getDrawer(): MarkerSvg {\n    return this.drawer_;\n  }\n\n  /**\n   * Gets the current location of the marker.\n   *\n   * @returns The current field, connection, or block the marker is on.\n   */\n  getCurNode(): ASTNode {\n    return this.curNode_;\n  }\n\n  /**\n   * Set the location of the marker and call the update method.\n   * Setting isStack to true will only work if the newLocation is the top most\n   * output or previous connection on a stack.\n   *\n   * @param newNode The new location of the marker.\n   */\n  setCurNode(newNode: ASTNode) {\n    const oldNode = this.curNode_;\n    this.curNode_ = newNode;\n    if (this.drawer_) {\n      this.drawer_.draw(oldNode, this.curNode_);\n    }\n  }\n\n  /**\n   * Redraw the current marker.\n   *\n   * @internal\n   */\n  draw() {\n    if (this.drawer_) {\n      this.drawer_.draw(this.curNode_, this.curNode_);\n    }\n  }\n\n  /** Hide the marker SVG. */\n  hide() {\n    if (this.drawer_) {\n      this.drawer_.hide();\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.getDrawer()) {\n      this.getDrawer().dispose();\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor.\n * Used primarily for keyboard navigation.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Cursor');\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Marker} from './marker.js';\n\n\n/**\n * Class for a cursor.\n * A cursor controls how a user navigates the Blockly AST.\n */\nexport class Cursor extends Marker {\n  override type = 'cursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next connection, field, or block.\n   *\n   * @returns The next element, or null if the current node is not set or there\n   *     is no next value.\n   */\n  next(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n\n    let newNode = curNode.next();\n    while (newNode && newNode.next() &&\n           (newNode.getType() === ASTNode.types.NEXT ||\n            newNode.getType() === ASTNode.types.BLOCK)) {\n      newNode = newNode.next();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the in connection or field.\n   *\n   * @returns The in element, or null if the current node is not set or there is\n   *     no in value.\n   */\n  in(): ASTNode|null {\n    let curNode: ASTNode|null = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    // If we are on a previous or output connection, go to the block level\n    // before performing next operation.\n    if (curNode.getType() === ASTNode.types.PREVIOUS ||\n        curNode.getType() === ASTNode.types.OUTPUT) {\n      curNode = curNode.next();\n    }\n    const newNode = curNode?.in() ?? null;\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the previous connection, field, or block.\n   *\n   * @returns The previous element, or null if the current node is not set or\n   *     there is no previous value.\n   */\n  prev(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.prev();\n\n    while (newNode && newNode.prev() &&\n           (newNode.getType() === ASTNode.types.NEXT ||\n            newNode.getType() === ASTNode.types.BLOCK)) {\n      newNode = newNode.prev();\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * Find the out connection, field, or block.\n   *\n   * @returns The out element, or null if the current node is not set or there\n   *     is no out value.\n   */\n  out(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    let newNode = curNode.out();\n\n    if (newNode && newNode.getType() === ASTNode.types.BLOCK) {\n      newNode = newNode.prev() || newNode;\n    }\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n}\n\nregistry.register(registry.Type.CURSOR, registry.DEFAULT, Cursor);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a basic cursor.\n * Used to demo switching between different cursors.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BasicCursor');\n\nimport * as registry from '../registry.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {Cursor} from './cursor.js';\n\n\n/**\n * Class for a basic cursor.\n * This will allow the user to get to all nodes in the AST by hitting next or\n * previous.\n */\nexport class BasicCursor extends Cursor {\n  /** Name used for registering a basic cursor. */\n  static readonly registrationName = 'basicCursor';\n\n  constructor() {\n    super();\n  }\n\n  /**\n   * Find the next node in the pre order traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override next(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getNextNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * in will also allow the user to get to the next node in the pre order\n   * traversal.\n   *\n   * @returns The next node, or null if the current node is not set or there is\n   *     no next value.\n   */\n  override in(): ASTNode|null {\n    return this.next();\n  }\n\n  /**\n   * Find the previous node in the pre order traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override prev(): ASTNode|null {\n    const curNode = this.getCurNode();\n    if (!curNode) {\n      return null;\n    }\n    const newNode = this.getPreviousNode_(curNode, this.validNode_);\n\n    if (newNode) {\n      this.setCurNode(newNode);\n    }\n    return newNode;\n  }\n\n  /**\n   * For a basic cursor we only have the ability to go next and previous, so\n   * out will allow the user to get to the previous node in the pre order\n   * traversal.\n   *\n   * @returns The previous node, or null if the current node is not set or there\n   *     is no previous value.\n   */\n  override out(): ASTNode|null {\n    return this.prev();\n  }\n\n  /**\n   * Uses pre order traversal to navigate the Blockly AST. This will allow\n   * a user to easily navigate the entire Blockly AST without having to go in\n   * and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The next node in the traversal.\n   */\n  protected getNextNode_(\n      node: ASTNode|null, isValid: (p1: ASTNode|null) => boolean): ASTNode\n      |null {\n    if (!node) {\n      return null;\n    }\n    const newNode = node.in() || node.next();\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getNextNode_(newNode, isValid);\n    }\n    const siblingOrParent = this.findSiblingOrParent_(node.out());\n    if (isValid(siblingOrParent)) {\n      return siblingOrParent;\n    } else if (siblingOrParent) {\n      return this.getNextNode_(siblingOrParent, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Reverses the pre order traversal in order to find the previous node. This\n   * will allow a user to easily navigate the entire Blockly AST without having\n   * to go in and out levels on the tree.\n   *\n   * @param node The current position in the AST.\n   * @param isValid A function true/false depending on whether the given node\n   *     should be traversed.\n   * @returns The previous node in the traversal or null if no previous node\n   *     exists.\n   */\n  protected getPreviousNode_(\n      node: ASTNode|null, isValid: (p1: ASTNode|null) => boolean): ASTNode\n      |null {\n    if (!node) {\n      return null;\n    }\n    let newNode: ASTNode|null = node.prev();\n\n    if (newNode) {\n      newNode = this.getRightMostChild_(newNode);\n    } else {\n      newNode = node.out();\n    }\n    if (isValid(newNode)) {\n      return newNode;\n    } else if (newNode) {\n      return this.getPreviousNode_(newNode, isValid);\n    }\n    return null;\n  }\n\n  /**\n   * Decides what nodes to traverse and which ones to skip. Currently, it\n   * skips output, stack and workspace nodes.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  protected validNode_(node: ASTNode|null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (type === ASTNode.types.OUTPUT || type === ASTNode.types.INPUT ||\n        type === ASTNode.types.FIELD || type === ASTNode.types.NEXT ||\n        type === ASTNode.types.PREVIOUS || type === ASTNode.types.WORKSPACE) {\n      isValid = true;\n    }\n    return isValid;\n  }\n\n  /**\n   * From the given node find either the next valid sibling or parent.\n   *\n   * @param node The current position in the AST.\n   * @returns The parent AST node or null if there are no valid parents.\n   */\n  private findSiblingOrParent_(node: ASTNode|null): ASTNode|null {\n    if (!node) {\n      return null;\n    }\n    const nextNode = node.next();\n    if (nextNode) {\n      return nextNode;\n    }\n    return this.findSiblingOrParent_(node.out());\n  }\n\n  /**\n   * Get the right most child of a node.\n   *\n   * @param node The node to find the right most child of.\n   * @returns The right most child of the given node, or the node if no child\n   *     exists.\n   */\n  private getRightMostChild_(node: ASTNode|null): ASTNode|null {\n    if (!node!.in()) {\n      return node;\n    }\n    let newNode = node!.in();\n    while (newNode && newNode.next()) {\n      newNode = newNode.next();\n    }\n    return this.getRightMostChild_(newNode);\n  }\n}\n\nregistry.register(\n    registry.Type.CURSOR, BasicCursor.registrationName, BasicCursor);\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing a cursor that is used to navigate\n * between tab navigable fields.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.TabNavigateCursor');\n\nimport type {Field} from '../field.js';\n\nimport {ASTNode} from './ast_node.js';\nimport {BasicCursor} from './basic_cursor.js';\n\n\n/**\n * A cursor for navigating between tab navigable fields.\n */\nexport class TabNavigateCursor extends BasicCursor {\n  /**\n   * Skip all nodes except for tab navigable fields.\n   *\n   * @param node The AST node to check whether it is valid.\n   * @returns True if the node should be visited, false otherwise.\n   */\n  override validNode_(node: ASTNode|null): boolean {\n    let isValid = false;\n    const type = node && node.getType();\n    if (node) {\n      const location = node.getLocation() as Field;\n      if (type === ASTNode.types.FIELD && location &&\n          location.isTabNavigable() && location.isClickable()) {\n        isValid = true;\n      }\n    }\n    return isValid;\n  }\n}\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Components for creating connections between blocks.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.RenderedConnection');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport {Connection} from './connection.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as eventUtils from './events/utils.js';\nimport * as internalConstants from './internal_constants.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport * as svgPaths from './utils/svg_paths.js';\n\n\n/** A shape that has a pathDown property. */\ninterface PathDownShape {\n  pathDown: string;\n}\n\n/** A shape that has a pathLeft property. */\ninterface PathLeftShape {\n  pathLeft: string;\n}\n\n/** Maximum randomness in workspace units for bumping a block. */\nconst BUMP_RANDOMNESS = 10;\n\n/**\n * Class for a connection between blocks that may be rendered on screen.\n */\nexport class RenderedConnection extends Connection {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  sourceBlock_!: BlockSvg;\n  private readonly db_: ConnectionDB;\n  private readonly dbOpposite_: ConnectionDB;\n  private readonly offsetInBlock_: Coordinate;\n  private trackedState_: TrackedState;\n  private highlightPath: SVGPathElement|null = null;\n\n  /** Connection this connection connects to.  Null if not connected. */\n  override targetConnection: RenderedConnection|null = null;\n\n  /**\n   * @param source The block establishing this connection.\n   * @param type The type of the connection.\n   */\n  constructor(source: BlockSvg, type: number) {\n    super(source, type);\n\n    /**\n     * Connection database for connections of this type on the current\n     * workspace.\n     */\n    this.db_ = source.workspace.connectionDBList[type];\n\n    /**\n     * Connection database for connections compatible with this type on the\n     * current workspace.\n     */\n    this.dbOpposite_ =\n        source.workspace\n            .connectionDBList[internalConstants.OPPOSITE_TYPE[type]];\n\n    /** Workspace units, (0, 0) is top left of block. */\n    this.offsetInBlock_ = new Coordinate(0, 0);\n\n    /** Describes the state of this connection's tracked-ness. */\n    this.trackedState_ = RenderedConnection.TrackedState.WILL_TRACK;\n  }\n\n  /**\n   * Dispose of this connection. Remove it from the database (if it is\n   * tracked) and call the super-function to deal with connected blocks.\n   *\n   * @internal\n   */\n  override dispose() {\n    super.dispose();\n    if (this.trackedState_ === RenderedConnection.TrackedState.TRACKED) {\n      this.db_.removeConnection(this, this.y);\n    }\n  }\n\n  /**\n   * Get the source block for this connection.\n   *\n   * @returns The source block.\n   */\n  override getSourceBlock(): BlockSvg {\n    return super.getSourceBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block that this connection connects to.\n   *\n   * @returns The connected block or null if none is connected.\n   */\n  override targetBlock(): BlockSvg|null {\n    return super.targetBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the distance between this connection and another connection in\n   * workspace units.\n   *\n   * @param otherConnection The other connection to measure the distance to.\n   * @returns The distance between connections, in workspace units.\n   */\n  distanceFrom(otherConnection: Connection): number {\n    const xDiff = this.x - otherConnection.x;\n    const yDiff = this.y - otherConnection.y;\n    return Math.sqrt(xDiff * xDiff + yDiff * yDiff);\n  }\n\n  /**\n   * Move the block(s) belonging to the connection to a point where they don't\n   * visually interfere with the specified connection.\n   *\n   * @param staticConnection The connection to move away from.\n   * @internal\n   */\n  bumpAwayFrom(staticConnection: RenderedConnection) {\n    if (this.sourceBlock_.workspace.isDragging()) {\n      // Don't move blocks around while the user is doing the same.\n      return;\n    }\n    // Move the root block.\n    let rootBlock = this.sourceBlock_.getRootBlock();\n    if (rootBlock.isInFlyout) {\n      // Don't move blocks around in a flyout.\n      return;\n    }\n    let reverse = false;\n    if (!rootBlock.isMovable()) {\n      // Can't bump an uneditable block away.\n      // Check to see if the other block is movable.\n      rootBlock = staticConnection.getSourceBlock().getRootBlock();\n      if (!rootBlock.isMovable()) {\n        return;\n      }\n      // Swap the connections and move the 'static' connection instead.\n      /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n      staticConnection = this;\n      reverse = true;\n    }\n    // Raise it to the top for extra visibility.\n    const selected = common.getSelected() == rootBlock;\n    selected || rootBlock.addSelect();\n    let dx = staticConnection.x + config.snapRadius +\n        Math.floor(Math.random() * BUMP_RANDOMNESS) - this.x;\n    let dy = staticConnection.y + config.snapRadius +\n        Math.floor(Math.random() * BUMP_RANDOMNESS) - this.y;\n    if (reverse) {\n      // When reversing a bump due to an uneditable block, bump up.\n      dy = -dy;\n    }\n    if (rootBlock.RTL) {\n      dx = staticConnection.x - config.snapRadius -\n          Math.floor(Math.random() * BUMP_RANDOMNESS) - this.x;\n    }\n    rootBlock.moveBy(dx, dy);\n    selected || rootBlock.removeSelect();\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param x New absolute x coordinate, in workspace coordinates.\n   * @param y New absolute y coordinate, in workspace coordinates.\n   * @return True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveTo(x: number, y: number): boolean {\n    // TODO(#6922): Readd this optimization.\n    // const moved = this.x !== x || this.y !== y;\n    const moved = true;\n    let updated = false;\n\n    if (this.trackedState_ === RenderedConnection.TrackedState.WILL_TRACK) {\n      this.db_.addConnection(this, y);\n      this.trackedState_ = RenderedConnection.TrackedState.TRACKED;\n      updated = true;\n    } else if (\n        this.trackedState_ === RenderedConnection.TrackedState.TRACKED &&\n        moved) {\n      this.db_.removeConnection(this, this.y);\n      this.db_.addConnection(this, y);\n      updated = true;\n    }\n\n    this.x = x;\n    this.y = y;\n\n    return updated;\n  }\n\n  /**\n   * Change the connection's coordinates.\n   *\n   * @param dx Change to x coordinate, in workspace units.\n   * @param dy Change to y coordinate, in workspace units.\n   * @return True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveBy(dx: number, dy: number): boolean {\n    return this.moveTo(this.x + dx, this.y + dy);\n  }\n\n  /**\n   * Move this connection to the location given by its offset within the block\n   * and the location of the block's top left corner.\n   *\n   * @param blockTL The location of the top left corner of the block, in\n   *     workspace coordinates.\n   * @return True if the position of the connection in the connection db\n   *     was updated.\n   */\n  moveToOffset(blockTL: Coordinate): boolean {\n    return this.moveTo(\n        blockTL.x + this.offsetInBlock_.x, blockTL.y + this.offsetInBlock_.y);\n  }\n\n  /**\n   * Set the offset of this connection relative to the top left of its block.\n   *\n   * @param x The new relative x, in workspace units.\n   * @param y The new relative y, in workspace units.\n   */\n  setOffsetInBlock(x: number, y: number) {\n    this.offsetInBlock_.x = x;\n    this.offsetInBlock_.y = y;\n  }\n\n  /**\n   * Get the offset of this connection relative to the top left of its block.\n   *\n   * @returns The offset of the connection.\n   * @internal\n   */\n  getOffsetInBlock(): Coordinate {\n    return this.offsetInBlock_;\n  }\n\n  /**\n   * Move the blocks on either side of this connection right next to each other.\n   *\n   * @internal\n   */\n  tighten() {\n    const dx = this.targetConnection!.x - this.x;\n    const dy = this.targetConnection!.y - this.y;\n    if (dx !== 0 || dy !== 0) {\n      const block = this.targetBlock();\n      const svgRoot = block!.getSvgRoot();\n      if (!svgRoot) {\n        throw Error('block is not rendered.');\n      }\n      // Workspace coordinates.\n      const xy = svgMath.getRelativeXY(svgRoot);\n      block!.translate(xy.x - dx, xy.y - dy);\n      block!.moveConnections(-dx, -dy);\n    }\n  }\n\n  /**\n   * Moves the blocks on either side of this connection right next to\n   * each other, based on their local offsets, not global positions.\n   *\n   * @internal\n   */\n  tightenEfficiently() {\n    const target = this.targetConnection;\n    const block = this.targetBlock();\n    if (!target || !block) return;\n    const offset =\n        Coordinate.difference(this.offsetInBlock_, target.offsetInBlock_);\n    block.translate(offset.x, offset.y);\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   * All parameters are in workspace units.\n   *\n   * @param maxLimit The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  closest(maxLimit: number, dxy: Coordinate):\n      {connection: RenderedConnection|null, radius: number} {\n    return this.dbOpposite_.searchForClosest(this, maxLimit, dxy);\n  }\n\n  /** Add highlighting around this connection. */\n  highlight() {\n    if (this.highlightPath) {\n      // This connection is already highlighted\n      return;\n    }\n    let steps;\n    const sourceBlockSvg = (this.sourceBlock_);\n    const renderConstants =\n        sourceBlockSvg.workspace.getRenderer().getConstants();\n    const shape = renderConstants.shapeFor(this);\n    if (this.type === ConnectionType.INPUT_VALUE ||\n        this.type === ConnectionType.OUTPUT_VALUE) {\n      // Vertical line, puzzle tab, vertical line.\n      const yLen = renderConstants.TAB_OFFSET_FROM_TOP;\n      steps = svgPaths.moveBy(0, -yLen) + svgPaths.lineOnAxis('v', yLen) +\n          (shape as unknown as PathDownShape).pathDown +\n          svgPaths.lineOnAxis('v', yLen);\n    } else {\n      const xLen =\n          renderConstants.NOTCH_OFFSET_LEFT - renderConstants.CORNER_RADIUS;\n      // Horizontal line, notch, horizontal line.\n      steps = svgPaths.moveBy(-xLen, 0) + svgPaths.lineOnAxis('h', xLen) +\n          (shape as unknown as PathLeftShape).pathLeft +\n          svgPaths.lineOnAxis('h', xLen);\n    }\n    const offset = this.offsetInBlock_;\n    this.highlightPath = dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyHighlightedConnectionPath',\n          'd': steps,\n          'transform': `translate(${offset.x}, ${offset.y})` +\n              (this.sourceBlock_.RTL ? ' scale(-1 1)' : ''),\n        },\n        this.sourceBlock_.getSvgRoot());\n  }\n\n  /** Remove the highlighting around this connection. */\n  unhighlight() {\n    if (this.highlightPath) {\n      dom.removeNode(this.highlightPath);\n      this.highlightPath = null;\n    }\n  }\n\n  /**\n   * Set whether this connections is tracked in the database or not.\n   *\n   * @param doTracking If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setTracking(doTracking: boolean) {\n    if (doTracking &&\n            this.trackedState_ === RenderedConnection.TrackedState.TRACKED ||\n        !doTracking &&\n            this.trackedState_ === RenderedConnection.TrackedState.UNTRACKED) {\n      return;\n    }\n    if (this.sourceBlock_.isInFlyout) {\n      // Don't bother maintaining a database of connections in a flyout.\n      return;\n    }\n    if (doTracking) {\n      this.db_.addConnection(this, this.y);\n      this.trackedState_ = RenderedConnection.TrackedState.TRACKED;\n      return;\n    }\n    if (this.trackedState_ === RenderedConnection.TrackedState.TRACKED) {\n      this.db_.removeConnection(this, this.y);\n    }\n    this.trackedState_ = RenderedConnection.TrackedState.UNTRACKED;\n  }\n\n  /**\n   * Stop tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * collapsed.\n   *\n   * Also closes down-stream icons/bubbles.\n   *\n   * @internal\n   */\n  stopTrackingAll() {\n    this.setTracking(false);\n    if (this.targetConnection) {\n      const blocks = this.targetBlock()!.getDescendants(false);\n      for (let i = 0; i < blocks.length; i++) {\n        const block = blocks[i];\n        // Stop tracking connections of all children.\n        const connections = block.getConnections_(true);\n        for (let j = 0; j < connections.length; j++) {\n          (connections[j]).setTracking(false);\n        }\n        // Close all bubbles of all children.\n        const icons = block.getIcons();\n        for (let j = 0; j < icons.length; j++) {\n          icons[j].setVisible(false);\n        }\n      }\n    }\n  }\n\n  /**\n   * Start tracking this connection, as well as all down-stream connections on\n   * any block attached to this connection. This happens when a block is\n   * expanded.\n   *\n   * @returns List of blocks to render.\n   */\n  startTrackingAll(): Block[] {\n    this.setTracking(true);\n    // All blocks that are not tracked must start tracking before any\n    // rendering takes place, since rendering requires knowing the dimensions\n    // of lower blocks. Also, since rendering a block renders all its parents,\n    // we only need to render the leaf nodes.\n    let renderList: Block[] = [];\n    if (this.type !== ConnectionType.INPUT_VALUE &&\n        this.type !== ConnectionType.NEXT_STATEMENT) {\n      // Only spider down.\n      return renderList;\n    }\n    const block = this.targetBlock();\n    if (block) {\n      let connections;\n      if (block.isCollapsed()) {\n        // This block should only be partially revealed since it is collapsed.\n        connections = [];\n        block.outputConnection && connections.push(block.outputConnection);\n        block.nextConnection && connections.push(block.nextConnection);\n        block.previousConnection && connections.push(block.previousConnection);\n      } else {\n        // Show all connections of this block.\n        connections = block.getConnections_(true);\n      }\n      for (let i = 0; i < connections.length; i++) {\n        renderList.push(...connections[i].startTrackingAll());\n      }\n      if (!renderList.length) {\n        // Leaf block.\n        renderList = [block];\n      }\n    }\n    return renderList;\n  }\n\n  /**\n   * Behaviour after a connection attempt fails.\n   * Bumps this connection away from the other connection. Called when an\n   * attempted connection fails.\n   *\n   * @param otherConnection Connection that this connection failed to connect\n   *     to.\n   * @internal\n   */\n  override onFailedConnect(otherConnection: Connection) {\n    const block = this.getSourceBlock();\n    if (eventUtils.getRecordUndo()) {\n      const group = eventUtils.getGroup();\n      setTimeout(function(this: RenderedConnection) {\n        if (!block.isDisposed() && !block.getParent()) {\n          eventUtils.setGroup(group);\n          this.bumpAwayFrom(otherConnection as RenderedConnection);\n          eventUtils.setGroup(false);\n        }\n      }.bind(this), config.bumpDelay);\n    }\n  }\n\n  /**\n   * Disconnect two blocks that are connected by this connection.\n   *\n   * @param setParent Whether to set the parent of the disconnected block or\n   *     not, defaults to true.\n   *     If you do not set the parent, ensure that a subsequent action does,\n   *     otherwise the view and model will be out of sync.\n   */\n  override disconnectInternal(setParent = true) {\n    const {parentConnection, childConnection} =\n        this.getParentAndChildConnections();\n    if (!parentConnection || !childConnection) return;\n    const parent = parentConnection.getSourceBlock() as BlockSvg;\n    const child = childConnection.getSourceBlock() as BlockSvg;\n    super.disconnectInternal(setParent);\n    // Rerender the parent so that it may reflow.\n    if (parent.rendered) {\n      parent.queueRender();\n    }\n    if (child.rendered) {\n      child.updateDisabled();\n      child.queueRender();\n      // Reset visibility, since the child is now a top block.\n      child.getSvgRoot().style.display = 'block';\n    }\n  }\n\n  /**\n   * Respawn the shadow block if there was one connected to the this connection.\n   * Render/rerender blocks as needed.\n   */\n  protected override respawnShadow_() {\n    super.respawnShadow_();\n    const blockShadow = this.targetBlock();\n    if (!blockShadow) {\n      return;\n    }\n    blockShadow.initSvg();\n    blockShadow.render(false);\n\n    const parentBlock = this.getSourceBlock();\n    if (parentBlock.rendered) {\n      parentBlock.queueRender();\n    }\n  }\n\n  /**\n   * Find all nearby compatible connections to this connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param maxLimit The maximum radius to another connection, in workspace\n   *     units.\n   * @returns List of connections.\n   * @internal\n   */\n  override neighbours(maxLimit: number): RenderedConnection[] {\n    return this.dbOpposite_.getNeighbours(this, maxLimit);\n  }\n\n  /**\n   * Connect two connections together.  This is the connection on the superior\n   * block.  Rerender blocks as needed.\n   *\n   * @param childConnection Connection on inferior block.\n   */\n  protected override connect_(childConnection: Connection) {\n    super.connect_(childConnection);\n\n    const renderedChildConnection = childConnection as RenderedConnection;\n\n    const parentBlock = this.getSourceBlock();\n    const childBlock = renderedChildConnection.getSourceBlock();\n    const parentRendered = parentBlock.rendered;\n    const childRendered = childBlock.rendered;\n\n    if (parentRendered) {\n      parentBlock.updateDisabled();\n    }\n    if (childRendered) {\n      childBlock.updateDisabled();\n    }\n    if (parentRendered && childRendered) {\n      if (this.type === ConnectionType.NEXT_STATEMENT ||\n          this.type === ConnectionType.PREVIOUS_STATEMENT) {\n        // Child block may need to square off its corners if it is in a stack.\n        // Rendering a child will render its parent.\n        childBlock.queueRender();\n      } else {\n        // Child block does not change shape.  Rendering the parent node will\n        // move its connected children into position.\n        parentBlock.queueRender();\n      }\n    }\n\n    // The input the child block is connected to (if any).\n    const parentInput = parentBlock.getInputWithBlock(childBlock);\n    if (parentInput) {\n      const visible = parentInput.isVisible();\n      childBlock.getSvgRoot().style.display = visible ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Function to be called when this connection's compatible types have changed.\n   */\n  protected override onCheckChanged_() {\n    // The new value type may not be compatible with the existing connection.\n    if (this.isConnected() &&\n        (!this.targetConnection ||\n         !this.getConnectionChecker().canConnect(\n             this, this.targetConnection, false))) {\n      const child = this.isSuperior() ? this.targetBlock() : this.sourceBlock_;\n      child!.unplug();\n      // Bump away.\n      this.sourceBlock_.bumpNeighbours();\n    }\n  }\n}\n\nexport namespace RenderedConnection {\n  /**\n   * Enum for different kinds of tracked states.\n   *\n   * WILL_TRACK means that this connection will add itself to\n   * the db on the next moveTo call it receives.\n   *\n   * UNTRACKED means that this connection will not add\n   * itself to the database until setTracking(true) is explicitly called.\n   *\n   * TRACKED means that this connection is currently being tracked.\n   */\n  export enum TrackedState {\n    WILL_TRACK = -1,\n    UNTRACKED = 0,\n    TRACKED = 1,\n  }\n}\n\nexport type TrackedState = RenderedConnection.TrackedState;\nexport const TrackedState = RenderedConnection.TrackedState;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a warning.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Warning');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_bubble_open.js';\n\nimport type {BlockSvg} from './block_svg.js';\nimport {Bubble} from './bubble.js';\nimport * as eventUtils from './events/utils.js';\nimport {Icon} from './icon.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\n\n\n/**\n * Class for a warning.\n */\nexport class Warning extends Icon {\n  private text: {[key: string]: string};\n\n  /** The top-level node of the warning text, or null if not created. */\n  private paragraphElement: SVGTextElement|null = null;\n\n  /** Does this icon get hidden when the block is collapsed? */\n  override collapseHidden = false;\n\n  /** @param block The block associated with this warning. */\n  constructor(block: BlockSvg) {\n    super(block);\n    this.createIcon();\n    // The text object can contain multiple warnings.\n    this.text = Object.create(null);\n  }\n\n  /**\n   * Draw the warning icon.\n   *\n   * @param group The icon group.\n   */\n  protected override drawIcon_(group: Element) {\n    // Triangle with rounded corners.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconShape',\n          'd': 'M2,15Q-1,15 0.5,12L6.5,1.7Q8,-1 9.5,1.7L15.5,12Q17,15 14,15z',\n        },\n        group);\n    // Can't use a real '!' text character since different browsers and\n    // operating systems render it differently. Body of exclamation point.\n    dom.createSvgElement(\n        Svg.PATH, {\n          'class': 'blocklyIconSymbol',\n          'd': 'm7,4.8v3.16l0.27,2.27h1.46l0.27,-2.27v-3.16z',\n        },\n        group);\n    // Dot of exclamation point.\n    dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyIconSymbol',\n          'x': '7',\n          'y': '11',\n          'height': '2',\n          'width': '2',\n        },\n        group);\n  }\n\n  /**\n   * Show or hide the warning bubble.\n   *\n   * @param visible True if the bubble should be visible.\n   */\n  override setVisible(visible: boolean) {\n    if (visible === this.isVisible()) {\n      return;\n    }\n    eventUtils.fire(new (eventUtils.get(eventUtils.BUBBLE_OPEN))(\n        this.getBlock(), visible, 'warning'));\n    if (visible) {\n      this.createBubble();\n    } else {\n      this.disposeBubble();\n    }\n  }\n\n  /** Show the bubble. */\n  private createBubble() {\n    this.paragraphElement = Bubble.textToDom(this.getText());\n    this.bubble_ = Bubble.createNonEditableBubble(\n        this.paragraphElement, this.getBlock(), this.iconXY_ as Coordinate);\n    this.applyColour();\n  }\n\n  /** Dispose of the bubble and references to it. */\n  private disposeBubble() {\n    if (this.bubble_) {\n      this.bubble_.dispose();\n      this.bubble_ = null;\n    }\n    this.paragraphElement = null;\n  }\n\n  /**\n   * Set this warning's text.\n   *\n   * @param text Warning text (or '' to delete). This supports linebreaks.\n   * @param id An ID for this text entry to be able to maintain multiple\n   *     warnings.\n   */\n  setText(text: string, id: string) {\n    if (this.text[id] === text) {\n      return;\n    }\n    if (text) {\n      this.text[id] = text;\n    } else {\n      delete this.text[id];\n    }\n    if (this.isVisible()) {\n      this.setVisible(false);\n      this.setVisible(true);\n    }\n  }\n\n  /**\n   * Get this warning's texts.\n   *\n   * @returns All texts concatenated into one string.\n   */\n  getText(): string {\n    const allWarnings = [];\n    for (const id in this.text) {\n      allWarnings.push(this.text[id]);\n    }\n    return allWarnings.join('\\n');\n  }\n\n  /** Dispose of this warning. */\n  override dispose() {\n    this.getBlock().warning = null;\n    super.dispose();\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for graphically rendering a block as SVG.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BlockSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_selected.js';\n\nimport {Block} from './block.js';\nimport * as blockAnimations from './block_animations.js';\nimport * as browserEvents from './browser_events.js';\nimport {Comment} from './comment.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport type {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport * as constants from './constants.js';\nimport * as ContextMenu from './contextmenu.js';\nimport {ContextMenuOption, ContextMenuRegistry, LegacyContextMenuOption} from './contextmenu_registry.js';\nimport type {BlockMove} from './events/events_block_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport {FieldLabel} from './field_label.js';\nimport type {Icon} from './icon.js';\nimport type {Input} from './input.js';\nimport type {IASTNodeLocationSvg} from './interfaces/i_ast_node_location_svg.js';\nimport type {IBoundedElement} from './interfaces/i_bounded_element.js';\nimport type {CopyData, ICopyable} from './interfaces/i_copyable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport * as internalConstants from './internal_constants.js';\nimport {ASTNode} from './keyboard_nav/ast_node.js';\nimport {TabNavigateCursor} from './keyboard_nav/tab_navigate_cursor.js';\nimport {MarkerManager} from './marker_manager.js';\nimport {Msg} from './msg.js';\nimport type {Mutator} from './mutator.js';\nimport {RenderedConnection} from './rendered_connection.js';\nimport type {Debug as BlockRenderingDebug} from './renderers/common/debugger.js';\nimport type {IPathObject} from './renderers/common/i_path_object.js';\nimport * as blocks from './serialization/blocks.js';\nimport type {BlockStyle} from './theme.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\nimport {Warning} from './warning.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\nimport {queueRender} from './render_management.js';\n\n\n/**\n * Class for a block's SVG representation.\n * Not normally called directly, workspace.newBlock() is preferred.\n */\nexport class BlockSvg extends Block implements IASTNodeLocationSvg,\n                                               IBoundedElement, ICopyable,\n                                               IDraggable {\n  /**\n   * Constant for identifying rows that are to be rendered inline.\n   * Don't collide with Blockly.inputTypes.\n   */\n  static readonly INLINE = -1;\n\n  /**\n   * ID to give the \"collapsed warnings\" warning. Allows us to remove the\n   * \"collapsed warnings\" warning without removing any warnings that belong to\n   * the block.\n   */\n  static readonly COLLAPSED_WARNING_ID = 'TEMP_COLLAPSED_WARNING_';\n  override decompose?: (p1: Workspace) => BlockSvg;\n  // override compose?: ((p1: BlockSvg) => void)|null;\n  saveConnections?: (p1: BlockSvg) => void;\n  customContextMenu?:\n      (p1: Array<ContextMenuOption|LegacyContextMenuOption>) => void;\n\n  /**\n   * An property used internally to reference the block's rendering debugger.\n   *\n   * @internal\n   */\n  renderingDebugger: BlockRenderingDebug|null = null;\n\n  /**\n   * Height of this block, not including any statement blocks above or below.\n   * Height is in workspace units.\n   */\n  height = 0;\n\n  /**\n   * Width of this block, including any connected value blocks.\n   * Width is in workspace units.\n   */\n  width = 0;\n\n  /**\n   * Map from IDs for warnings text to PIDs of functions to apply them.\n   * Used to be able to maintain multiple warnings.\n   */\n  private warningTextDb = new Map<string, ReturnType<typeof setTimeout>>();\n\n  /** Block's mutator icon (if any). */\n  mutator: Mutator|null = null;\n\n  /** Block's comment icon (if any). */\n  private commentIcon_: Comment|null = null;\n\n  /** Block's warning icon (if any). */\n  warning: Warning|null = null;\n\n  private svgGroup_: SVGGElement;\n  style: BlockStyle;\n  /** @internal */\n  pathObject: IPathObject;\n  override rendered = false;\n  private visuallyDisabled = false;\n\n  /**\n   * Is this block currently rendering? Used to stop recursive render calls\n   * from actually triggering a re-render.\n   */\n  private renderIsInProgress_ = false;\n\n  /** Whether mousedown events have been bound yet. */\n  private eventsInit_ = false;\n\n  override workspace: WorkspaceSvg;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override outputConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override nextConnection!: RenderedConnection;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override previousConnection!: RenderedConnection;\n  private readonly useDragSurface_: boolean;\n\n  private translation = '';\n\n  /**\n   * The ID of the setTimeout callback for bumping neighbours, or 0 if no bump\n   * is currently scheduled.\n   */\n  private bumpNeighboursPid = 0;\n\n  /**\n   * The location of the top left of this block (in workspace coordinates)\n   * relative to either its parent block, or the workspace origin if it has no\n   * parent.\n   *\n   * @internal\n   */\n  relativeCoords = new Coordinate(0, 0);\n\n\n  /**\n   * @param workspace The block's workspace.\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   */\n  constructor(workspace: WorkspaceSvg, prototypeName: string, opt_id?: string) {\n    super(workspace, prototypeName, opt_id);\n    this.workspace = workspace;\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {});\n\n    /** A block style object. */\n    this.style = workspace.getRenderer().getConstants().getBlockStyle(null);\n\n    /** The renderer's path object. */\n    this.pathObject =\n        workspace.getRenderer().makePathObject(this.svgGroup_, this.style);\n\n    /**\n     * Whether to move the block to the drag surface when it is dragged.\n     * True if it should move, false if it should be translated directly.\n     */\n    this.useDragSurface_ = !!workspace.getBlockDragSurface();\n\n    const svgPath = this.pathObject.svgPath;\n    (svgPath as any).tooltip = this;\n    Tooltip.bindMouseEvents(svgPath);\n\n    // Expose this block's ID on its top-level SVG group.\n    this.svgGroup_.setAttribute('data-id', this.id);\n\n    this.doInit_();\n  }\n\n  /**\n   * Create and initialize the SVG representation of the block.\n   * May be called more than once.\n   */\n  initSvg() {\n    if (!this.workspace.rendered) {\n      throw TypeError('Workspace is headless.');\n    }\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      input.init();\n    }\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].createIcon();\n    }\n    this.applyColour();\n    this.pathObject.updateMovable(this.isMovable());\n    const svg = this.getSvgRoot();\n    if (!this.workspace.options.readOnly && !this.eventsInit_ && svg) {\n      browserEvents.conditionalBind(\n          svg, 'pointerdown', this, this.onMouseDown_);\n    }\n    this.eventsInit_ = true;\n\n    if (!svg.parentNode) {\n      this.workspace.getCanvas().appendChild(svg);\n    }\n  }\n\n  /**\n   * Get the secondary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourSecondary(): string|undefined {\n    return this.style.colourSecondary;\n  }\n\n  /**\n   * Get the tertiary colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  getColourTertiary(): string|undefined {\n    return this.style.colourTertiary;\n  }\n\n  /**\n   * Selects this block. Highlights the block visually and fires a select event\n   * if the block is not already selected.\n   */\n  select() {\n    if (this.isShadow() && this.getParent()) {\n      // Shadow blocks should not be selected.\n      this.getParent()!.select();\n      return;\n    }\n    if (common.getSelected() === this) {\n      return;\n    }\n    let oldId = null;\n    if (common.getSelected()) {\n      oldId = common.getSelected()!.id;\n      // Unselect any previously selected block.\n      eventUtils.disable();\n      try {\n        common.getSelected()!.unselect();\n      } finally {\n        eventUtils.enable();\n      }\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        oldId, this.id, this.workspace.id);\n    eventUtils.fire(event);\n    common.setSelected(this);\n    this.addSelect();\n  }\n\n  /**\n   * Unselects this block. Unhighlights the block and fires a select (false)\n   * event if the block is currently selected.\n   */\n  unselect() {\n    if (common.getSelected() !== this) {\n      return;\n    }\n    const event = new (eventUtils.get(eventUtils.SELECTED))(\n        this.id, null, this.workspace.id);\n    event.workspaceId = this.workspace.id;\n    eventUtils.fire(event);\n    common.setSelected(null);\n    this.removeSelect();\n  }\n\n  /**\n   * Returns a list of mutator, comment, and warning icons.\n   *\n   * @returns List of icons.\n   */\n  getIcons(): Icon[] {\n    const icons = [];\n    if (this.mutator) {\n      icons.push(this.mutator);\n    }\n    if (this.commentIcon_) {\n      icons.push(this.commentIcon_);\n    }\n    if (this.warning) {\n      icons.push(this.warning);\n    }\n    return icons;\n  }\n\n  /**\n   * Sets the parent of this block to be a new block or null.\n   *\n   * @param newParent New parent block.\n   * @internal\n   */\n  override setParent(newParent: this|null) {\n    const oldParent = this.parentBlock_;\n    if (newParent === oldParent) {\n      return;\n    }\n\n    dom.startTextWidthCache();\n    super.setParent(newParent);\n    dom.stopTextWidthCache();\n\n    const svgRoot = this.getSvgRoot();\n\n    // Bail early if workspace is clearing, or we aren't rendered.\n    // We won't need to reattach ourselves anywhere.\n    if (this.workspace.isClearing || !svgRoot) {\n      return;\n    }\n\n    const oldXY = this.getRelativeToSurfaceXY();\n    if (newParent) {\n      (newParent as BlockSvg).getSvgRoot().appendChild(svgRoot);\n    } else if (oldParent) {\n      // If we are losing a parent, we want to move our DOM element to the\n      // root of the workspace.\n      this.workspace.getCanvas().appendChild(svgRoot);\n      this.translate(oldXY.x, oldXY.y);\n    }\n\n    this.applyColour();\n  }\n\n  /**\n   * Return the coordinates of the top-left corner of this block relative to the\n   * drawing surface's origin (0,0), in workspace units.\n   * If the block is on the workspace, (0, 0) is the origin of the workspace\n   * coordinate system.\n   * This does not change with workspace scale.\n   *\n   * @returns Object with .x and .y properties in workspace coordinates.\n   */\n  override getRelativeToSurfaceXY(): Coordinate {\n    let x = 0;\n    let y = 0;\n\n    const dragSurfaceGroup = this.useDragSurface_ ?\n        this.workspace.getBlockDragSurface()!.getGroup() :\n        null;\n\n    let element: SVGElement = this.getSvgRoot();\n    if (element) {\n      do {\n        // Loop through this block and every parent.\n        const xy = svgMath.getRelativeXY(element);\n        x += xy.x;\n        y += xy.y;\n        // If this element is the current element on the drag surface, include\n        // the translation of the drag surface itself.\n        if (this.useDragSurface_ &&\n            this.workspace.getBlockDragSurface()!.getCurrentBlock() ===\n                element) {\n          const surfaceTranslation =\n              this.workspace.getBlockDragSurface()!.getSurfaceTranslation();\n          x += surfaceTranslation.x;\n          y += surfaceTranslation.y;\n        }\n        element = element.parentNode as SVGElement;\n      } while (element && element !== this.workspace.getCanvas() &&\n               element !== dragSurfaceGroup);\n    }\n    return new Coordinate(x, y);\n  }\n\n  /**\n   * Move a block by a relative offset.\n   *\n   * @param dx Horizontal offset in workspace units.\n   * @param dy Vertical offset in workspace units.\n   */\n  override moveBy(dx: number, dy: number) {\n    if (this.parentBlock_) {\n      throw Error('Block has parent.');\n    }\n    const eventsEnabled = eventUtils.isEnabled();\n    let event: BlockMove|null = null;\n    if (eventsEnabled) {\n      event = new (eventUtils.get(eventUtils.BLOCK_MOVE))!(this) as BlockMove;\n    }\n    const xy = this.getRelativeToSurfaceXY();\n    this.translate(xy.x + dx, xy.y + dy);\n    this.moveConnections(dx, dy);\n    if (eventsEnabled && event) {\n      event!.recordNew();\n      eventUtils.fire(event);\n    }\n    this.workspace.resizeContents();\n  }\n\n  /**\n   * Transforms a block by setting the translation on the transform attribute\n   * of the block's SVG.\n   *\n   * @param x The x coordinate of the translation in workspace units.\n   * @param y The y coordinate of the translation in workspace units.\n   */\n  translate(x: number, y: number) {\n    this.translation = `translate(${x}, ${y})`;\n    this.relativeCoords = new Coordinate(x, y);\n    this.getSvgRoot().setAttribute('transform', this.getTranslation());\n  }\n\n  /**\n   * Returns the SVG translation of this block.\n   *\n   * @internal\n   */\n  getTranslation(): string {\n    return this.translation;\n  }\n\n  /**\n   * Move this block to its workspace's drag surface, accounting for\n   * positioning. Generally should be called at the same time as\n   * setDragging_(true). Does nothing if useDragSurface_ is false.\n   *\n   * @internal\n   */\n  moveToDragSurface() {\n    if (!this.useDragSurface_) {\n      return;\n    }\n    // The translation for drag surface blocks,\n    // is equal to the current relative-to-surface position,\n    // to keep the position in sync as it move on/off the surface.\n    // This is in workspace coordinates.\n    const xy = this.getRelativeToSurfaceXY();\n    this.clearTransformAttributes_();\n    this.workspace.getBlockDragSurface()!.translateSurface(xy.x, xy.y);\n    // Execute the move on the top-level SVG component\n    const svg = this.getSvgRoot();\n    if (svg) {\n      this.workspace.getBlockDragSurface()!.setBlocksAndShow(svg);\n    }\n  }\n\n  /**\n   * Move a block to a position.\n   *\n   * @param xy The position to move to in workspace units.\n   */\n  moveTo(xy: Coordinate) {\n    const curXY = this.getRelativeToSurfaceXY();\n    this.moveBy(xy.x - curXY.x, xy.y - curXY.y);\n  }\n\n  /**\n   * Move this block back to the workspace block canvas.\n   * Generally should be called at the same time as setDragging_(false).\n   * Does nothing if useDragSurface_ is false.\n   *\n   * @param newXY The position the block should take on on the workspace canvas,\n   *     in workspace coordinates.\n   * @internal\n   */\n  moveOffDragSurface(newXY: Coordinate) {\n    if (!this.useDragSurface_) {\n      return;\n    }\n    // Translate to current position, turning off 3d.\n    this.translate(newXY.x, newXY.y);\n    this.workspace.getBlockDragSurface()!.clearAndHide(\n        this.workspace.getCanvas());\n  }\n\n  /**\n   * Move this block during a drag, taking into account whether we are using a\n   * drag surface to translate blocks.\n   * This block must be a top-level block.\n   *\n   * @param newLoc The location to translate to, in workspace coordinates.\n   * @internal\n   */\n  moveDuringDrag(newLoc: Coordinate) {\n    if (this.useDragSurface_) {\n      this.workspace.getBlockDragSurface()!.translateSurface(\n          newLoc.x, newLoc.y);\n    } else {\n      this.translate(newLoc.x, newLoc.y);\n      this.getSvgRoot().setAttribute('transform', this.getTranslation());\n    }\n  }\n\n  /**\n   * Clear the block of transform=\"...\" attributes.\n   * Used when the block is switching from 3d to 2d transform or vice versa.\n   */\n  private clearTransformAttributes_() {\n    this.getSvgRoot().removeAttribute('transform');\n  }\n\n  /** Snap this block to the nearest grid point. */\n  snapToGrid() {\n    if (this.isDeadOrDying()) {\n      return;  // Deleted block.\n    }\n    if (this.workspace.isDragging()) {\n      return;  // Don't bump blocks during a drag.;\n    }\n\n    if (this.getParent()) {\n      return;  // Only snap top-level blocks.\n    }\n    if (this.isInFlyout) {\n      return;  // Don't move blocks around in a flyout.\n    }\n    const grid = this.workspace.getGrid();\n    if (!grid || !grid.shouldSnap()) {\n      return;  // Config says no snapping.\n    }\n    const spacing = grid.getSpacing();\n    const half = spacing / 2;\n    const xy = this.getRelativeToSurfaceXY();\n    const dx =\n        Math.round(Math.round((xy.x - half) / spacing) * spacing + half - xy.x);\n    const dy =\n        Math.round(Math.round((xy.y - half) / spacing) * spacing + half - xy.y);\n    if (dx || dy) {\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * Returns the coordinates of a bounding box describing the dimensions of this\n   * block and any blocks stacked below it.\n   * Coordinate system: workspace coordinates.\n   *\n   * @returns Object with coordinates of the bounding box.\n   */\n  getBoundingRectangle(): Rect {\n    const blockXY = this.getRelativeToSurfaceXY();\n    const blockBounds = this.getHeightWidth();\n    let left;\n    let right;\n    if (this.RTL) {\n      left = blockXY.x - blockBounds.width;\n      right = blockXY.x;\n    } else {\n      left = blockXY.x;\n      right = blockXY.x + blockBounds.width;\n    }\n    return new Rect(blockXY.y, blockXY.y + blockBounds.height, left, right);\n  }\n\n  /**\n   * Notify every input on this block to mark its fields as dirty.\n   * A dirty field is a field that needs to be re-rendered.\n   */\n  markDirty() {\n    this.pathObject.constants = this.workspace.getRenderer().getConstants();\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      input.markDirty();\n    }\n  }\n\n  /**\n   * Set whether the block is collapsed or not.\n   *\n   * @param collapsed True if collapsed.\n   */\n  override setCollapsed(collapsed: boolean) {\n    if (this.collapsed_ === collapsed) {\n      return;\n    }\n    super.setCollapsed(collapsed);\n    this.updateCollapsed_();\n  }\n\n  /**\n   * Makes sure that when the block is collapsed, it is rendered correctly\n   * for that state.\n   */\n  private updateCollapsed_() {\n    const collapsed = this.isCollapsed();\n    const collapsedInputName = constants.COLLAPSED_INPUT_NAME;\n    const collapsedFieldName = constants.COLLAPSED_FIELD_NAME;\n\n    for (let i = 0, input; input = this.inputList[i]; i++) {\n      if (input.name !== collapsedInputName) {\n        input.setVisible(!collapsed);\n      }\n    }\n\n    if (!collapsed) {\n      this.updateDisabled();\n      this.removeInput(collapsedInputName);\n      return;\n    }\n\n    const icons = this.getIcons();\n    for (let i = 0, icon; icon = icons[i]; i++) {\n      icon.setVisible(false);\n    }\n\n    const text = this.toString(internalConstants.COLLAPSE_CHARS);\n    const field = this.getField(collapsedFieldName);\n    if (field) {\n      field.setValue(text);\n      return;\n    }\n    const input = this.getInput(collapsedInputName) ||\n        this.appendDummyInput(collapsedInputName);\n    input.appendField(new FieldLabel(text), collapsedFieldName);\n  }\n\n  /**\n   * Open the next (or previous) FieldTextInput.\n   *\n   * @param start Current field.\n   * @param forward If true go forward, otherwise backward.\n   */\n  tab(start: Field, forward: boolean) {\n    const tabCursor = new TabNavigateCursor();\n    tabCursor.setCurNode(ASTNode.createFieldNode(start)!);\n    const currentNode = tabCursor.getCurNode();\n\n    if (forward) {\n      tabCursor.next();\n    } else {\n      tabCursor.prev();\n    }\n\n    const nextNode = tabCursor.getCurNode();\n    if (nextNode && nextNode !== currentNode) {\n      const nextField = nextNode.getLocation() as Field;\n      nextField.showEditor();\n\n      // Also move the cursor if we're in keyboard nav mode.\n      if (this.workspace.keyboardAccessibilityMode) {\n        this.workspace.getCursor()!.setCurNode(nextNode);\n      }\n    }\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.workspace.getGesture(e);\n    if (gesture) {\n      gesture.handleBlockStart(e, this);\n    }\n  }\n\n  /**\n   * Load the block's help page in a new window.\n   *\n   * @internal\n   */\n  showHelp() {\n    const url =\n        typeof this.helpUrl === 'function' ? this.helpUrl() : this.helpUrl;\n    if (url) {\n      window.open(url);\n    }\n  }\n\n  /**\n   * Generate the context menu for this block.\n   *\n   * @returns Context menu options or null if no menu.\n   */\n  protected generateContextMenu():\n      Array<ContextMenuOption|LegacyContextMenuOption>|null {\n    if (this.workspace.options.readOnly || !this.contextMenu) {\n      return null;\n    }\n    const menuOptions = ContextMenuRegistry.registry.getContextMenuOptions(\n        ContextMenuRegistry.ScopeType.BLOCK, {block: this});\n\n    // Allow the block to add or modify menuOptions.\n    if (this.customContextMenu) {\n      this.customContextMenu(menuOptions);\n    }\n\n    return menuOptions;\n  }\n\n  /**\n   * Show the context menu for this block.\n   *\n   * @param e Mouse event.\n   * @internal\n   */\n  showContextMenu(e: Event) {\n    const menuOptions = this.generateContextMenu();\n\n    if (menuOptions && menuOptions.length) {\n      ContextMenu.show(e, menuOptions, this.RTL);\n      ContextMenu.setCurrentBlock(this);\n    }\n  }\n\n  /**\n   * Move the connections for this block and all blocks attached under it.\n   * Also update any attached bubbles.\n   *\n   * @param dx Horizontal offset from current location, in workspace units.\n   * @param dy Vertical offset from current location, in workspace units.\n   * @internal\n   */\n  moveConnections(dx: number, dy: number) {\n    if (!this.rendered) {\n      // Rendering is required to lay out the blocks.\n      // This is probably an invisible block attached to a collapsed block.\n      return;\n    }\n    const myConnections = this.getConnections_(false);\n    for (let i = 0; i < myConnections.length; i++) {\n      myConnections[i].moveBy(dx, dy);\n    }\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].computeIconLocation();\n    }\n\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).moveConnections(dx, dy);\n    }\n  }\n\n  /**\n   * Recursively adds or removes the dragging class to this node and its\n   * children.\n   *\n   * @param adding True if adding, false if removing.\n   * @internal\n   */\n  setDragging(adding: boolean) {\n    if (adding) {\n      this.translation = '';\n      common.draggingConnections.push(...this.getConnections_(true));\n      dom.addClass(this.svgGroup_, 'blocklyDragging');\n    } else {\n      common.draggingConnections.length = 0;\n      dom.removeClass(this.svgGroup_, 'blocklyDragging');\n    }\n    // Recurse through all blocks attached under this one.\n    for (let i = 0; i < this.childBlocks_.length; i++) {\n      (this.childBlocks_[i] as BlockSvg).setDragging(adding);\n    }\n  }\n\n  /**\n   * Set whether this block is movable or not.\n   *\n   * @param movable True if movable.\n   */\n  override setMovable(movable: boolean) {\n    super.setMovable(movable);\n    this.pathObject.updateMovable(movable);\n  }\n\n  /**\n   * Set whether this block is editable or not.\n   *\n   * @param editable True if editable.\n   */\n  override setEditable(editable: boolean) {\n    super.setEditable(editable);\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].updateEditable();\n    }\n  }\n\n  /**\n   * Sets whether this block is a shadow block or not.\n   *\n   * @param shadow True if a shadow.\n   * @internal\n   */\n  override setShadow(shadow: boolean) {\n    super.setShadow(shadow);\n    this.applyColour();\n  }\n\n  /**\n   * Set whether this block is an insertion marker block or not.\n   * Once set this cannot be unset.\n   *\n   * @param insertionMarker True if an insertion marker.\n   * @internal\n   */\n  override setInsertionMarker(insertionMarker: boolean) {\n    if (this.isInsertionMarker_ === insertionMarker) {\n      return;  // No change.\n    }\n    this.isInsertionMarker_ = insertionMarker;\n    if (this.isInsertionMarker_) {\n      this.setColour(\n          this.workspace.getRenderer().getConstants().INSERTION_MARKER_COLOUR);\n      this.pathObject.updateInsertionMarker(true);\n    }\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node (probably a group).\n   */\n  getSvgRoot(): SVGGElement {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Dispose of this block.\n   *\n   * @param healStack If true, then try to heal any gap by connecting the next\n   *     statement with the previous statement.  Otherwise, dispose of all\n   *     children of this block.\n   * @param animate If true, show a disposal animation and sound.\n   * @suppress {checkTypes}\n   */\n  override dispose(healStack?: boolean, animate?: boolean) {\n    if (this.isDeadOrDying()) return;\n\n    Tooltip.dispose();\n    ContextMenu.hide();\n\n    if (animate && this.rendered) {\n      this.unplug(healStack);\n      blockAnimations.disposeUiEffect(this);\n    }\n\n    super.dispose(!!healStack);\n    dom.removeNode(this.svgGroup_);\n  }\n\n  /**\n   * Disposes of this block without doing things required by the top block.\n   * E.g. does trigger UI effects, remove nodes, etc.\n   */\n  override disposeInternal() {\n    if (this.isDeadOrDying()) return;\n    super.disposeInternal();\n\n    this.rendered = false;\n\n    if (common.getSelected() === this) {\n      this.unselect();\n      this.workspace.cancelCurrentGesture();\n    }\n\n    [...this.warningTextDb.values()].forEach((n) => clearTimeout(n));\n    this.warningTextDb.clear();\n\n    this.getIcons().forEach((i) => i.dispose());\n  }\n\n  /**\n   * Delete a block and hide chaff when doing so. The block will not be deleted\n   * if it's in a flyout. This is called from the context menu and keyboard\n   * shortcuts as the full delete action. If you are disposing of a block from\n   * the workspace and don't need to perform flyout checks, handle event\n   * grouping, or hide chaff, then use `block.dispose()` directly.\n   */\n  checkAndDelete() {\n    if (this.workspace.isFlyout) {\n      return;\n    }\n    eventUtils.setGroup(true);\n    this.workspace.hideChaff();\n    if (this.outputConnection) {\n      // Do not attempt to heal rows\n      // (https://github.com/google/blockly/issues/4832)\n      this.dispose(false, true);\n    } else {\n      this.dispose(/* heal */\n                   true, true);\n    }\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Encode a block for copying.\n   *\n   * @returns Copy metadata, or null if the block is an insertion marker.\n   * @internal\n   */\n  toCopyData(): CopyData|null {\n    if (this.isInsertionMarker_) {\n      return null;\n    }\n    return {\n      saveInfo:\n          blocks.save(this, {addCoordinates: true, addNextBlocks: false}) as\n          blocks.State,\n      source: this.workspace,\n      typeCounts: common.getBlockTypeCounts(this, true),\n    };\n  }\n\n  /**\n   * Updates the colour of the block to match the block's state.\n   *\n   * @internal\n   */\n  applyColour() {\n    this.pathObject.applyColour(this);\n\n    const icons = this.getIcons();\n    for (let i = 0; i < icons.length; i++) {\n      icons[i].applyColour();\n    }\n\n    for (let x = 0, input; input = this.inputList[x]; x++) {\n      for (let y = 0, field; field = input.fieldRow[y]; y++) {\n        field.applyColour();\n      }\n    }\n  }\n\n  /**\n   * Updates the colour of the block (and children) to match the current\n   * disabled state.\n   *\n   * @internal\n   */\n  updateDisabled() {\n    const disabled = !this.isEnabled() || this.getInheritedDisabled();\n    if (this.visuallyDisabled === disabled) return;\n    this.applyColour();\n    this.visuallyDisabled = disabled;\n    for (const child of this.getChildren(false)) {\n      child.updateDisabled();\n    }\n  }\n\n  /**\n   * Get the comment icon attached to this block, or null if the block has no\n   * comment.\n   *\n   * @returns The comment icon attached to this block, or null.\n   */\n  getCommentIcon(): Comment|null {\n    return this.commentIcon_;\n  }\n\n  /**\n   * Set this block's comment text.\n   *\n   * @param text The text, or null to delete.\n   */\n  override setCommentText(text: string|null) {\n    if (this.commentModel.text === text) {\n      return;\n    }\n    super.setCommentText(text);\n\n    const shouldHaveComment = text !== null;\n    if (!!this.commentIcon_ === shouldHaveComment) {\n      // If the comment's state of existence is correct, but the text is new\n      // that means we're just updating a comment.\n      this.commentIcon_!.updateText();\n      return;\n    }\n    if (shouldHaveComment) {\n      this.commentIcon_ = new Comment(this);\n      this.comment = this.commentIcon_;  // For backwards compatibility.\n    } else {\n      this.commentIcon_!.dispose();\n      this.commentIcon_ = null;\n      this.comment = null;  // For backwards compatibility.\n    }\n    if (this.rendered) {\n      this.render();\n      // Adding or removing a comment icon will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set this block's warning text.\n   *\n   * @param text The text, or null to delete.\n   * @param opt_id An optional ID for the warning text to be able to maintain\n   *     multiple warnings.\n   */\n  override setWarningText(text: string|null, opt_id?: string) {\n    const id = opt_id || '';\n    if (!id) {\n      // Kill all previous pending processes, this edit supersedes them all.\n      for (const timeout of this.warningTextDb.values()) {\n        clearTimeout(timeout);\n      }\n      this.warningTextDb.clear();\n    } else if (this.warningTextDb.has(id)) {\n      // Only queue up the latest change.  Kill any earlier pending process.\n      clearTimeout(this.warningTextDb.get(id)!);\n      this.warningTextDb.delete(id);\n    }\n    if (this.workspace.isDragging()) {\n      // Don't change the warning text during a drag.\n      // Wait until the drag finishes.\n      this.warningTextDb.set(id, setTimeout(() => {\n                               if (!this.isDeadOrDying()) {\n                                 this.warningTextDb.delete(id);\n                                 this.setWarningText(text, id);\n                               }\n                             }, 100));\n      return;\n    }\n    if (this.isInFlyout) {\n      text = null;\n    }\n\n    let changedState = false;\n    if (typeof text === 'string') {\n      // Bubble up to add a warning on top-most collapsed block.\n      let parent = this.getSurroundParent();\n      let collapsedParent = null;\n      while (parent) {\n        if (parent.isCollapsed()) {\n          collapsedParent = parent;\n        }\n        parent = parent.getSurroundParent();\n      }\n      if (collapsedParent) {\n        collapsedParent.setWarningText(\n            Msg['COLLAPSED_WARNINGS_WARNING'], BlockSvg.COLLAPSED_WARNING_ID);\n      }\n\n      if (!this.warning) {\n        this.warning = new Warning(this);\n        changedState = true;\n      }\n      this.warning!.setText((text), id);\n    } else {\n      // Dispose all warnings if no ID is given.\n      if (this.warning && !id) {\n        this.warning.dispose();\n        changedState = true;\n      } else if (this.warning) {\n        const oldText = this.warning.getText();\n        this.warning.setText('', id);\n        const newText = this.warning.getText();\n        if (!newText) {\n          this.warning.dispose();\n        }\n        changedState = oldText !== newText;\n      }\n    }\n    if (changedState && this.rendered) {\n      this.render();\n      // Adding or removing a warning icon will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Give this block a mutator dialog.\n   *\n   * @param mutator A mutator dialog instance or null to remove.\n   */\n  override setMutator(mutator: Mutator|null) {\n    if (this.mutator && this.mutator !== mutator) {\n      this.mutator.dispose();\n    }\n    if (mutator) {\n      mutator.setBlock(this);\n      this.mutator = mutator;\n      mutator.createIcon();\n    }\n    if (this.rendered) {\n      this.render();\n      // Adding or removing a mutator icon will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether the block is enabled or not.\n   *\n   * @param enabled True if enabled.\n   */\n  override setEnabled(enabled: boolean) {\n    if (this.isEnabled() !== enabled) {\n      super.setEnabled(enabled);\n      if (this.rendered && !this.getInheritedDisabled()) {\n        this.updateDisabled();\n      }\n    }\n  }\n\n  /**\n   * Set whether the block is highlighted or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param highlighted True if highlighted.\n   */\n  setHighlighted(highlighted: boolean) {\n    if (!this.rendered) {\n      return;\n    }\n    this.pathObject.updateHighlighted(highlighted);\n  }\n\n  /**\n   * Adds the visual \"select\" effect to the block, but does not actually select\n   * it or fire an event.\n   *\n   * @see BlockSvg#select\n   */\n  addSelect() {\n    this.pathObject.updateSelected(true);\n  }\n\n  /**\n   * Removes the visual \"select\" effect from the block, but does not actually\n   * unselect it or fire an event.\n   *\n   * @see BlockSvg#unselect\n   */\n  removeSelect() {\n    this.pathObject.updateSelected(false);\n  }\n\n  /**\n   * Update the cursor over this block by adding or removing a class.\n   *\n   * @param enable True if the delete cursor should be shown, false otherwise.\n   * @internal\n   */\n  setDeleteStyle(enable: boolean) {\n    this.pathObject.updateDraggingDelete(enable);\n  }\n\n  // Overrides of functions on Blockly.Block that take into account whether the\n\n  // block has been rendered.\n\n  /**\n   * Get the colour of a block.\n   *\n   * @returns #RRGGBB string.\n   */\n  override getColour(): string {\n    return this.style.colourPrimary;\n  }\n\n  /**\n   * Change the colour of a block.\n   *\n   * @param colour HSV hue value, or #RRGGBB string.\n   */\n  override setColour(colour: number|string) {\n    super.setColour(colour);\n    const styleObj =\n        this.workspace.getRenderer().getConstants().getBlockStyleForColour(\n            this.colour_);\n\n    this.pathObject.setStyle(styleObj.style);\n    this.style = styleObj.style;\n    this.styleName_ = styleObj.name;\n\n    this.applyColour();\n  }\n\n  /**\n   * Set the style and colour values of a block.\n   *\n   * @param blockStyleName Name of the block style.\n   * @throws {Error} if the block style does not exist.\n   */\n  override setStyle(blockStyleName: string) {\n    const blockStyle =\n        this.workspace.getRenderer().getConstants().getBlockStyle(\n            blockStyleName);\n    this.styleName_ = blockStyleName;\n\n    if (blockStyle) {\n      this.hat = blockStyle.hat;\n      this.pathObject.setStyle(blockStyle);\n      // Set colour to match Block.\n      this.colour_ = blockStyle.colourPrimary;\n      this.style = blockStyle;\n\n      this.applyColour();\n    } else {\n      throw Error('Invalid style name: ' + blockStyleName);\n    }\n  }\n\n  /**\n   * Move this block to the front of the visible workspace.\n   * <g> tags do not respect z-index so SVG renders them in the\n   * order that they are in the DOM.  By placing this block first within the\n   * block group's <g>, it will render on top of any other blocks.\n   *\n   * @internal\n   */\n  bringToFront() {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let block: this|null = this;\n    do {\n      const root = block.getSvgRoot();\n      const parent = root.parentNode;\n      const childNodes = parent!.childNodes;\n      // Avoid moving the block if it's already at the bottom.\n      if (childNodes[childNodes.length - 1] !== root) {\n        parent!.appendChild(root);\n      }\n      block = block.getParent();\n    } while (block);\n  }\n\n  /**\n   * Set whether this block can chain onto the bottom of another block.\n   *\n   * @param newBoolean True if there can be a previous statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setPreviousStatement(\n      newBoolean: boolean, opt_check?: string|string[]|null) {\n    super.setPreviousStatement(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether another block can chain onto the bottom of this block.\n   *\n   * @param newBoolean True if there can be a next statement.\n   * @param opt_check Statement type or list of statement types.  Null/undefined\n   *     if any type could be connected.\n   */\n  override setNextStatement(\n      newBoolean: boolean, opt_check?: string|string[]|null) {\n    super.setNextStatement(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether this block returns a value.\n   *\n   * @param newBoolean True if there is an output.\n   * @param opt_check Returned type or list of returned types.  Null or\n   *     undefined if any type could be returned (e.g. variable get).\n   */\n  override setOutput(newBoolean: boolean, opt_check?: string|string[]|null) {\n    super.setOutput(newBoolean, opt_check);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Set whether value inputs are arranged horizontally or vertically.\n   *\n   * @param newBoolean True if inputs are horizontal.\n   */\n  override setInputsInline(newBoolean: boolean) {\n    super.setInputsInline(newBoolean);\n\n    if (this.rendered) {\n      this.queueRender();\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Remove an input from this block.\n   *\n   * @param name The name of the input.\n   * @param opt_quiet True to prevent error if input is not present.\n   * @returns True if operation succeeds, false if input is not present and\n   *     opt_quiet is true\n   * @throws {Error} if the input is not present and opt_quiet is not true.\n   */\n  override removeInput(name: string, opt_quiet?: boolean): boolean {\n    const removed = super.removeInput(name, opt_quiet);\n\n    if (this.rendered) {\n      this.queueRender();\n      // Removing an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n\n    return removed;\n  }\n\n  /**\n   * Move a numbered input to a different location on this block.\n   *\n   * @param inputIndex Index of the input to move.\n   * @param refIndex Index of input that should be after the moved input.\n   */\n  override moveNumberedInputBefore(inputIndex: number, refIndex: number) {\n    super.moveNumberedInputBefore(inputIndex, refIndex);\n\n    if (this.rendered) {\n      this.queueRender();\n      // Moving an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n  }\n\n  /**\n   * Add a value input, statement input or local variable to this block.\n   *\n   * @param type One of Blockly.inputTypes.\n   * @param name Language-neutral identifier which may used to find this input\n   *     again.  Should be unique to this block.\n   * @returns The input object created.\n   */\n  protected override appendInput_(type: number, name: string): Input {\n    const input = super.appendInput_(type, name);\n\n    if (this.rendered) {\n      this.queueRender();\n      // Adding an input will cause the block to change shape.\n      this.bumpNeighbours();\n    }\n    return input;\n  }\n\n  /**\n   * Sets whether this block's connections are tracked in the database or not.\n   *\n   * Used by the deserializer to be more efficient. Setting a connection's\n   * tracked_ value to false keeps it from adding itself to the db when it\n   * gets its first moveTo call, saving expensive ops for later.\n   *\n   * @param track If true, start tracking. If false, stop tracking.\n   * @internal\n   */\n  setConnectionTracking(track: boolean) {\n    if (this.previousConnection) {\n      (this.previousConnection).setTracking(track);\n    }\n    if (this.outputConnection) {\n      (this.outputConnection).setTracking(track);\n    }\n    if (this.nextConnection) {\n      (this.nextConnection).setTracking(track);\n      const child = (this.nextConnection).targetBlock();\n      if (child) {\n        child.setConnectionTracking(track);\n      }\n    }\n\n    if (this.collapsed_) {\n      // When track is true, we don't want to start tracking collapsed\n      // connections. When track is false, we're already not tracking\n      // collapsed connections, so no need to update.\n      return;\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.setTracking(track);\n\n        // Pass tracking on down the chain.\n        const block = conn.targetBlock();\n        if (block) {\n          block.setConnectionTracking(track);\n        }\n      }\n    }\n  }\n\n  /**\n   * Returns connections originating from this block.\n   *\n   * @param all If true, return all connections even hidden ones.\n   *     Otherwise, for a non-rendered block return an empty list, and for a\n   *     collapsed block don't return inputs connections.\n   * @returns Array of connections.\n   * @internal\n   */\n  override getConnections_(all: boolean): RenderedConnection[] {\n    const myConnections = [];\n    if (all || this.rendered) {\n      if (this.outputConnection) {\n        myConnections.push(this.outputConnection);\n      }\n      if (this.previousConnection) {\n        myConnections.push(this.previousConnection);\n      }\n      if (this.nextConnection) {\n        myConnections.push(this.nextConnection);\n      }\n      if (all || !this.collapsed_) {\n        for (let i = 0, input; input = this.inputList[i]; i++) {\n          if (input.connection) {\n            myConnections.push(input.connection as RenderedConnection);\n          }\n        }\n      }\n    }\n    return myConnections;\n  }\n\n  /**\n   * Walks down a stack of blocks and finds the last next connection on the\n   * stack.\n   *\n   * @param ignoreShadows If true,the last connection on a non-shadow block will\n   *     be returned. If false, this will follow shadows to find the last\n   *     connection.\n   * @returns The last next connection on the stack, or null.\n   * @internal\n   */\n  override lastConnectionInStack(ignoreShadows: boolean): RenderedConnection\n      |null {\n    return super.lastConnectionInStack(ignoreShadows) as RenderedConnection;\n  }\n\n  /**\n   * Find the connection on this block that corresponds to the given connection\n   * on the other block.\n   * Used to match connections between a block and its insertion marker.\n   *\n   * @param otherBlock The other block to match against.\n   * @param conn The other connection to match.\n   * @returns The matching connection on this block, or null.\n   * @internal\n   */\n  override getMatchingConnection(otherBlock: Block, conn: Connection):\n      RenderedConnection|null {\n    return super.getMatchingConnection(otherBlock, conn) as RenderedConnection;\n  }\n\n  /**\n   * Create a connection of the specified type.\n   *\n   * @param type The type of the connection to create.\n   * @returns A new connection of the specified type.\n   */\n  protected override makeConnection_(type: number): RenderedConnection {\n    return new RenderedConnection(this, type);\n  }\n\n  /**\n   * Return the next statement block directly connected to this block.\n   *\n   * @returns The next statement block or null.\n   */\n  override getNextBlock(): BlockSvg|null {\n    return super.getNextBlock() as BlockSvg;\n  }\n\n  /**\n   * Returns the block connected to the previous connection.\n   *\n   * @returns The previous statement block or null.\n   */\n  override getPreviousBlock(): BlockSvg|null {\n    return super.getPreviousBlock() as BlockSvg;\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   *\n   * Two blocks which aren't actually connected should not coincidentally line\n   * up on screen, because that creates confusion for end-users.\n   */\n  override bumpNeighbours() {\n    if (this.bumpNeighboursPid) return;\n    const group = eventUtils.getGroup();\n\n    this.bumpNeighboursPid = setTimeout(() => {\n      const oldGroup = eventUtils.getGroup();\n      eventUtils.setGroup(group);\n      this.getRootBlock().bumpNeighboursInternal();\n      eventUtils.setGroup(oldGroup);\n      this.bumpNeighboursPid = 0;\n    }, config.bumpDelay);\n  }\n\n  /**\n   * Bumps unconnected blocks out of alignment.\n   */\n  private bumpNeighboursInternal() {\n    const root = this.getRootBlock();\n    if (this.isDeadOrDying() || this.workspace.isDragging() ||\n        root.isInFlyout) {\n      return;\n    }\n\n    function neighbourIsInStack(neighbour: RenderedConnection) {\n      return neighbour.getSourceBlock().getRootBlock() === root;\n    }\n\n    for (const conn of this.getConnections_(false)) {\n      if (conn.isSuperior()) {\n        // Recurse down the block stack.\n        conn.targetBlock()?.bumpNeighboursInternal();\n      }\n\n      for (const neighbour of conn.neighbours(config.snapRadius)) {\n        // Don't bump away from things that are in our stack.\n        if (neighbourIsInStack(neighbour)) continue;\n        // If both connections are connected, that's fine.\n        if (conn.isConnected() && neighbour.isConnected()) continue;\n\n        // Always bump the inferior connection.\n        if (conn.isSuperior()) {\n          neighbour.bumpAwayFrom(conn);\n        } else {\n          conn.bumpAwayFrom(neighbour);\n        }\n      }\n    }\n  }\n\n  /**\n   * Schedule snapping to grid and bumping neighbours to occur after a brief\n   * delay.\n   *\n   * @internal\n   */\n  scheduleSnapAndBump() {\n    // Ensure that any snap and bump are part of this move's event group.\n    const group = eventUtils.getGroup();\n\n    setTimeout(() => {\n      eventUtils.setGroup(group);\n      this.snapToGrid();\n      eventUtils.setGroup(false);\n    }, config.bumpDelay / 2);\n\n    this.bumpNeighbours();\n  }\n\n  /**\n   * Position a block so that it doesn't move the target block when connected.\n   * The block to position is usually either the first block in a dragged stack\n   * or an insertion marker.\n   *\n   * @param sourceConnection The connection on the moving block's stack.\n   * @param targetConnection The connection that should stay stationary as this\n   *     block is positioned.\n   * @internal\n   */\n  positionNearConnection(\n      sourceConnection: RenderedConnection,\n      targetConnection: RenderedConnection) {\n    // We only need to position the new block if it's before the existing one,\n    // otherwise its position is set by the previous block.\n    if (sourceConnection.type === ConnectionType.NEXT_STATEMENT ||\n        sourceConnection.type === ConnectionType.INPUT_VALUE) {\n      const dx = targetConnection.x - sourceConnection.x;\n      const dy = targetConnection.y - sourceConnection.y;\n\n      this.moveBy(dx, dy);\n    }\n  }\n\n  /**\n   * @returns The first statement connection or null.\n   * @internal\n   */\n  override getFirstStatementConnection(): RenderedConnection|null {\n    return super.getFirstStatementConnection() as RenderedConnection | null;\n  }\n\n  /**\n   * Find all the blocks that are directly nested inside this one.\n   * Includes value and statement inputs, as well as any following statement.\n   * Excludes any connection on an output tab or any preceding statement.\n   * Blocks are optionally sorted by position; top to bottom.\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  override getChildren(ordered: boolean): BlockSvg[] {\n    return super.getChildren(ordered) as BlockSvg[];\n  }\n\n  /**\n   * Triggers a rerender after a delay to allow for batching.\n   *\n   * @internal\n   */\n  queueRender() {\n    queueRender(this);\n  }\n\n  /**\n   * Immediately lays out and reflows a block based on its contents and\n   * settings.\n   *\n   * @param opt_bubble If false, just render this block.\n   *   If true, also render block's parent, grandparent, etc.  Defaults to true.\n   */\n  render(opt_bubble?: boolean) {\n    if (this.renderIsInProgress_) {\n      return;  // Don't allow recursive renders.\n    }\n    this.renderIsInProgress_ = true;\n    try {\n      this.rendered = true;\n      dom.startTextWidthCache();\n\n      if (this.isCollapsed()) {\n        this.updateCollapsed_();\n      }\n      this.workspace.getRenderer().render(this);\n      this.updateConnectionLocations();\n\n      if (opt_bubble !== false) {\n        const parentBlock = this.getParent();\n        if (parentBlock) {\n          parentBlock.render(true);\n        } else {\n          // Top-most block. Fire an event to allow scrollbars to resize.\n          this.workspace.resizeContents();\n        }\n      }\n\n      dom.stopTextWidthCache();\n      this.updateMarkers_();\n    } finally {\n      this.renderIsInProgress_ = false;\n    }\n  }\n\n  /**\n   * Renders this block in a way that's compatible with the more efficient\n   * render management system.\n   *\n   * @internal\n   */\n  renderEfficiently() {\n    this.rendered = true;\n    dom.startTextWidthCache();\n\n    if (this.isCollapsed()) {\n      this.updateCollapsed_();\n    }\n    this.workspace.getRenderer().render(this);\n    this.tightenChildrenEfficiently();\n\n    dom.stopTextWidthCache();\n    this.updateMarkers_();\n  }\n\n  /**\n   * Tightens all children of this block so they are snuggly rendered against\n   * their parent connections.\n   *\n   * Does not update connection locations, so that they can be updated more\n   * efficiently by the render management system.\n   *\n   * @internal\n   */\n  tightenChildrenEfficiently() {\n    for (const input of this.inputList) {\n      const conn = input.connection as RenderedConnection;\n      if (conn) conn.tightenEfficiently();\n    }\n    if (this.nextConnection) this.nextConnection.tightenEfficiently();\n  }\n\n  /** Redraw any attached marker or cursor svgs if needed. */\n  protected updateMarkers_() {\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.cursorSvg) {\n      this.workspace.getCursor()!.draw();\n    }\n    if (this.workspace.keyboardAccessibilityMode && this.pathObject.markerSvg) {\n      // TODO(#4592): Update all markers on the block.\n      this.workspace.getMarker(MarkerManager.LOCAL_MARKER)!.draw();\n    }\n    for (const input of this.inputList) {\n      for (const field of input.fieldRow) {\n        field.updateMarkers_();\n      }\n    }\n  }\n\n  /**\n   * Update all of the connections on this block with the new locations\n   * calculated during rendering.  Also move all of the connected blocks based\n   * on the new connection locations.\n   *\n   * @internal\n   */\n  updateConnectionLocations() {\n    const blockTL = this.getRelativeToSurfaceXY();\n    // Don't tighten previous or output connections because they are inferior\n    // connections.\n    if (this.previousConnection) {\n      this.previousConnection.moveToOffset(blockTL);\n    }\n    if (this.outputConnection) {\n      this.outputConnection.moveToOffset(blockTL);\n    }\n\n    for (let i = 0; i < this.inputList.length; i++) {\n      const conn = this.inputList[i].connection as RenderedConnection;\n      if (conn) {\n        conn.moveToOffset(blockTL);\n        if (conn.isConnected()) {\n          conn.tighten();\n        }\n      }\n    }\n\n    if (this.nextConnection) {\n      this.nextConnection.moveToOffset(blockTL);\n      if (this.nextConnection.isConnected()) {\n        this.nextConnection.tighten();\n      }\n    }\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    this.pathObject.setCursorSvg(cursorSvg);\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   * @internal\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    this.pathObject.setMarkerSvg(markerSvg);\n  }\n\n  /**\n   * Returns a bounding box describing the dimensions of this block\n   * and any blocks stacked below it.\n   *\n   * @returns Object with height and width properties in workspace units.\n   * @internal\n   */\n  getHeightWidth(): {height: number, width: number} {\n    let height = this.height;\n    let width = this.width;\n    // Recursively add size of subsequent blocks.\n    const nextBlock = this.getNextBlock();\n    if (nextBlock) {\n      const nextHeightWidth = nextBlock.getHeightWidth();\n      const tabHeight =\n          this.workspace.getRenderer().getConstants().NOTCH_HEIGHT;\n      height += nextHeightWidth.height - tabHeight;\n      width = Math.max(width, nextHeightWidth.width);\n    }\n    return {height, width};\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped, this block\n   * will be replaced.  If a shadow block, it will disappear.  Otherwise it will\n   * bump.\n   *\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  fadeForReplacement(add: boolean) {\n    this.pathObject.updateReplacementFade(add);\n  }\n\n  /**\n   * Visual effect to show that if the dragging block is dropped it will connect\n   * to this input.\n   *\n   * @param conn The connection on the input to highlight.\n   * @param add True if highlighting should be added.\n   * @internal\n   */\n  highlightShapeForInput(conn: RenderedConnection, add: boolean) {\n    this.pathObject.updateShapeForInputHighlight(conn, add);\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a bubble visually.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.BubbleDragger');\n\nimport type {BlockDragSurfaceSvg} from './block_drag_surface.js';\nimport {ComponentManager} from './component_manager.js';\nimport type {CommentMove} from './events/events_comment_move.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a bubble dragger.  It moves things on the bubble canvas around the\n * workspace when they are being dragged by a mouse or touch.  These can be\n * block comments, mutators, warnings, or workspace comments.\n */\nexport class BubbleDragger {\n  /** Which drag target the mouse pointer is over, if any. */\n  private dragTarget_: IDragTarget|null = null;\n\n  /** Whether the bubble would be deleted if dropped immediately. */\n  private wouldDeleteBubble_ = false;\n  private readonly startXY_: Coordinate;\n  private dragSurface_: BlockDragSurfaceSvg|null;\n\n  /**\n   * @param bubble The item on the bubble canvas to drag.\n   * @param workspace The workspace to drag on.\n   */\n  constructor(private bubble: IBubble, private workspace: WorkspaceSvg) {\n    /**\n     * The location of the top left corner of the dragging bubble's body at the\n     * beginning of the drag, in workspace coordinates.\n     */\n    this.startXY_ = this.bubble.getRelativeToSurfaceXY();\n\n    /**\n     * The drag surface to move bubbles to during a drag, or null if none should\n     * be used.  Block dragging and bubble dragging use the same surface.\n     */\n    this.dragSurface_ = workspace.getBlockDragSurface();\n  }\n\n  /**\n   * Start dragging a bubble.  This includes moving it to the drag surface.\n   *\n   * @internal\n   */\n  startBubbleDrag() {\n    if (!eventUtils.getGroup()) {\n      eventUtils.setGroup(true);\n    }\n\n    this.workspace.setResizesEnabled(false);\n    this.bubble.setAutoLayout(false);\n    if (this.dragSurface_) {\n      this.bubble.moveTo(0, 0);\n      this.dragSurface_.translateSurface(this.startXY_.x, this.startXY_.y);\n      // Execute the move on the top-level SVG component.\n      this.dragSurface_.setBlocksAndShow(this.bubble.getSvgRoot());\n    }\n\n    this.bubble.setDragging && this.bubble.setDragging(true);\n  }\n\n  /**\n   * Execute a step of bubble dragging, based on the given event.  Update the\n   * display accordingly.\n   *\n   * @param e The most recent move event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   * @internal\n   */\n  dragBubble(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n    const newLoc = Coordinate.sum(this.startXY_, delta);\n    this.bubble.moveDuringDrag(this.dragSurface_, newLoc);\n\n    const oldDragTarget = this.dragTarget_;\n    this.dragTarget_ = this.workspace.getDragTarget(e);\n\n    const oldWouldDeleteBubble = this.wouldDeleteBubble_;\n    this.wouldDeleteBubble_ = this.shouldDelete_(this.dragTarget_);\n    if (oldWouldDeleteBubble !== this.wouldDeleteBubble_) {\n      // Prevent unnecessary add/remove class calls.\n      this.updateCursorDuringBubbleDrag_();\n    }\n    // Call drag enter/exit/over after wouldDeleteBlock is called in\n    // shouldDelete_\n    if (this.dragTarget_ !== oldDragTarget) {\n      oldDragTarget && oldDragTarget.onDragExit(this.bubble);\n      this.dragTarget_ && this.dragTarget_.onDragEnter(this.bubble);\n    }\n    this.dragTarget_ && this.dragTarget_.onDragOver(this.bubble);\n  }\n\n  /**\n   * Whether ending the drag would delete the bubble.\n   *\n   * @param dragTarget The drag target that the bubblee is currently over.\n   * @returns Whether dropping the bubble immediately would delete the block.\n   */\n  private shouldDelete_(dragTarget: IDragTarget|null): boolean {\n    if (dragTarget) {\n      const componentManager = this.workspace.getComponentManager();\n      const isDeleteArea = componentManager.hasCapability(\n          dragTarget.id, ComponentManager.Capability.DELETE_AREA);\n      if (isDeleteArea) {\n        return (dragTarget as IDeleteArea).wouldDelete(this.bubble, false);\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Update the cursor (and possibly the trash can lid) to reflect whether the\n   * dragging bubble would be deleted if released immediately.\n   */\n  private updateCursorDuringBubbleDrag_() {\n    this.bubble.setDeleteStyle(this.wouldDeleteBubble_);\n  }\n\n  /**\n   * Finish a bubble drag and put the bubble back on the workspace.\n   *\n   * @param e The pointerup event.\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel units.\n   * @internal\n   */\n  endBubbleDrag(e: PointerEvent, currentDragDeltaXY: Coordinate) {\n    // Make sure internal state is fresh.\n    this.dragBubble(e, currentDragDeltaXY);\n\n    const preventMove =\n        this.dragTarget_ && this.dragTarget_.shouldPreventMove(this.bubble);\n    let newLoc;\n    if (preventMove) {\n      newLoc = this.startXY_;\n    } else {\n      const delta = this.pixelsToWorkspaceUnits_(currentDragDeltaXY);\n      newLoc = Coordinate.sum(this.startXY_, delta);\n    }\n    // Move the bubble to its final location.\n    this.bubble.moveTo(newLoc.x, newLoc.y);\n\n    if (this.dragTarget_) {\n      this.dragTarget_.onDrop(this.bubble);\n    }\n\n    if (this.wouldDeleteBubble_) {\n      // Fire a move event, so we know where to go back to for an undo.\n      this.fireMoveEvent_();\n      this.bubble.dispose();\n    } else {\n      // Put everything back onto the bubble canvas.\n      if (this.dragSurface_) {\n        this.dragSurface_.clearAndHide(this.workspace.getBubbleCanvas());\n      }\n      if (this.bubble.setDragging) {\n        this.bubble.setDragging(false);\n      }\n      this.fireMoveEvent_();\n    }\n    this.workspace.setResizesEnabled(true);\n\n    eventUtils.setGroup(false);\n  }\n\n  /** Fire a move event at the end of a bubble drag. */\n  private fireMoveEvent_() {\n    if (this.bubble instanceof WorkspaceCommentSvg) {\n      const event = new (eventUtils.get(eventUtils.COMMENT_MOVE))(\n                        this.bubble) as CommentMove;\n      event.setOldCoordinate(this.startXY_);\n      event.recordNew();\n      eventUtils.fire(event);\n    }\n    // TODO (fenichel): move events for comments.\n    return;\n  }\n\n  /**\n   * Convert a coordinate object from pixels to workspace units, including a\n   * correction for mutator workspaces.\n   * This function does not consider differing origins.  It simply scales the\n   * input's x and y values.\n   *\n   * @param pixelCoord A coordinate with x and y values in CSS pixel units.\n   * @returns The input coordinate divided by the workspace scale.\n   */\n  private pixelsToWorkspaceUnits_(pixelCoord: Coordinate): Coordinate {\n    const result = new Coordinate(\n        pixelCoord.x / this.workspace.scale,\n        pixelCoord.y / this.workspace.scale);\n    if (this.workspace.isMutator) {\n      // If we're in a mutator, its scale is always 1, purely because of some\n      // oddities in our rendering optimizations.  The actual scale is the same\n      // as the scale on the parent workspace. Fix that for dragging.\n      const mainScale = this.workspace.options.parentWorkspace!.scale;\n      result.scale(1 / mainScale);\n    }\n    return result;\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An object that encapsulates logic for checking whether a\n * potential connection is safe and valid.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ConnectionChecker');\n\nimport * as common from './common.js';\nimport {Connection} from './connection.js';\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport type {RenderedConnection} from './rendered_connection.js';\n\n\n/**\n * Class for connection type checking logic.\n */\nexport class ConnectionChecker implements IConnectionChecker {\n  /**\n   * Check whether the current connection can connect with the target\n   * connection.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Whether the connection is legal.\n   */\n  canConnect(\n      a: Connection|null, b: Connection|null, isDragging: boolean,\n      opt_distance?: number): boolean {\n    return this.canConnectWithReason(a, b, isDragging, opt_distance) ===\n        Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Checks whether the current connection can connect with the target\n   * connection, and return an error code if there are problems.\n   *\n   * @param a Connection to check compatibility with.\n   * @param b Connection to check compatibility with.\n   * @param isDragging True if the connection is being made by dragging a block.\n   * @param opt_distance The max allowable distance between the connections for\n   *     drag checks.\n   * @returns Connection.CAN_CONNECT if the connection is legal, an error code\n   *     otherwise.\n   */\n  canConnectWithReason(\n      a: Connection|null, b: Connection|null, isDragging: boolean,\n      opt_distance?: number): number {\n    const safety = this.doSafetyChecks(a, b);\n    if (safety !== Connection.CAN_CONNECT) {\n      return safety;\n    }\n\n    // If the safety checks passed, both connections are non-null.\n    const connOne = a!;\n    const connTwo = b!;\n    if (!this.doTypeChecks(connOne, connTwo)) {\n      return Connection.REASON_CHECKS_FAILED;\n    }\n\n    if (isDragging &&\n        !this.doDragChecks(\n            a as RenderedConnection, b as RenderedConnection,\n            opt_distance || 0)) {\n      return Connection.REASON_DRAG_CHECKS_FAILED;\n    }\n\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Helper method that translates a connection error code into a string.\n   *\n   * @param errorCode The error code.\n   * @param a One of the two connections being checked.\n   * @param b The second of the two connections being checked.\n   * @returns A developer-readable error string.\n   */\n  getErrorMessage(errorCode: number, a: Connection|null, b: Connection|null):\n      string {\n    switch (errorCode) {\n      case Connection.REASON_SELF_CONNECTION:\n        return 'Attempted to connect a block to itself.';\n      case Connection.REASON_DIFFERENT_WORKSPACES:\n        // Usually this means one block has been deleted.\n        return 'Blocks not on same workspace.';\n      case Connection.REASON_WRONG_TYPE:\n        return 'Attempt to connect incompatible types.';\n      case Connection.REASON_TARGET_NULL:\n        return 'Target connection is null.';\n      case Connection.REASON_CHECKS_FAILED: {\n        const connOne = a!;\n        const connTwo = b!;\n        let msg = 'Connection checks failed. ';\n        msg += connOne + ' expected ' + connOne.getCheck() + ', found ' +\n            connTwo.getCheck();\n        return msg;\n      }\n      case Connection.REASON_SHADOW_PARENT:\n        return 'Connecting non-shadow to shadow block.';\n      case Connection.REASON_DRAG_CHECKS_FAILED:\n        return 'Drag checks failed.';\n      case Connection.REASON_PREVIOUS_AND_OUTPUT:\n        return 'Block would have an output and a previous connection.';\n      default:\n        return 'Unknown connection failure: this should never happen!';\n    }\n  }\n\n  /**\n   * Check that connecting the given connections is safe, meaning that it would\n   * not break any of Blockly's basic assumptions (e.g. no self connections).\n   *\n   * @param a The first of the connections to check.\n   * @param b The second of the connections to check.\n   * @returns An enum with the reason this connection is safe or unsafe.\n   */\n  doSafetyChecks(a: Connection|null, b: Connection|null): number {\n    if (!a || !b) {\n      return Connection.REASON_TARGET_NULL;\n    }\n    let superiorBlock;\n    let inferiorBlock;\n    let superiorConnection;\n    let inferiorConnection;\n    if (a.isSuperior()) {\n      superiorBlock = a.getSourceBlock();\n      inferiorBlock = b.getSourceBlock();\n      superiorConnection = a;\n      inferiorConnection = b;\n    } else {\n      inferiorBlock = a.getSourceBlock();\n      superiorBlock = b.getSourceBlock();\n      inferiorConnection = a;\n      superiorConnection = b;\n    }\n    if (superiorBlock === inferiorBlock) {\n      return Connection.REASON_SELF_CONNECTION;\n    } else if (\n        inferiorConnection.type !==\n        internalConstants.OPPOSITE_TYPE[superiorConnection.type]) {\n      return Connection.REASON_WRONG_TYPE;\n    } else if (superiorBlock.workspace !== inferiorBlock.workspace) {\n      return Connection.REASON_DIFFERENT_WORKSPACES;\n    } else if (superiorBlock.isShadow() && !inferiorBlock.isShadow()) {\n      return Connection.REASON_SHADOW_PARENT;\n    } else if (\n        inferiorConnection.type === ConnectionType.OUTPUT_VALUE &&\n        inferiorBlock.previousConnection &&\n        inferiorBlock.previousConnection.isConnected()) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    } else if (\n        inferiorConnection.type === ConnectionType.PREVIOUS_STATEMENT &&\n        inferiorBlock.outputConnection &&\n        inferiorBlock.outputConnection.isConnected()) {\n      return Connection.REASON_PREVIOUS_AND_OUTPUT;\n    }\n    return Connection.CAN_CONNECT;\n  }\n\n  /**\n   * Check whether this connection is compatible with another connection with\n   * respect to the value type system.  E.g. square_root(\"Hello\") is not\n   * compatible.\n   *\n   * @param a Connection to compare.\n   * @param b Connection to compare against.\n   * @returns True if the connections share a type.\n   */\n  doTypeChecks(a: Connection, b: Connection): boolean {\n    const checkArrayOne = a.getCheck();\n    const checkArrayTwo = b.getCheck();\n\n    if (!checkArrayOne || !checkArrayTwo) {\n      // One or both sides are promiscuous enough that anything will fit.\n      return true;\n    }\n    // Find any intersection in the check lists.\n    for (let i = 0; i < checkArrayOne.length; i++) {\n      if (checkArrayTwo.indexOf(checkArrayOne[i]) !== -1) {\n        return true;\n      }\n    }\n    // No intersection.\n    return false;\n  }\n\n  /**\n   * Check whether this connection can be made by dragging.\n   *\n   * @param a Connection to compare (on the block that's being dragged).\n   * @param b Connection to compare against.\n   * @param distance The maximum allowable distance between connections.\n   * @returns True if the connection is allowed during a drag.\n   */\n  doDragChecks(a: RenderedConnection, b: RenderedConnection, distance: number):\n      boolean {\n    if (a.distanceFrom(b) > distance) {\n      return false;\n    }\n\n    // Don't consider insertion markers.\n    if (b.getSourceBlock().isInsertionMarker()) {\n      return false;\n    }\n\n    switch (b.type) {\n      case ConnectionType.PREVIOUS_STATEMENT:\n        return this.canConnectToPrevious_(a, b);\n      case ConnectionType.OUTPUT_VALUE: {\n        // Don't offer to connect an already connected left (male) value plug to\n        // an available right (female) value plug.\n        if (b.isConnected() && !b.targetBlock()!.isInsertionMarker() ||\n            a.isConnected()) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.INPUT_VALUE: {\n        // Offering to connect the left (male) of a value block to an already\n        // connected value pair is ok, we'll splice it in.\n        // However, don't offer to splice into an immovable block.\n        if (b.isConnected() && !b.targetBlock()!.isMovable() &&\n            !b.targetBlock()!.isShadow()) {\n          return false;\n        }\n        break;\n      }\n      case ConnectionType.NEXT_STATEMENT: {\n        // Don't let a block with no next connection bump other blocks out of\n        // the stack.  But covering up a shadow block or stack of shadow blocks\n        // is fine.  Similarly, replacing a terminal statement with another\n        // terminal statement is allowed.\n        if (b.isConnected() && !a.getSourceBlock().nextConnection &&\n            !b.targetBlock()!.isShadow() && b.targetBlock()!.nextConnection) {\n          return false;\n        }\n\n        // Don't offer to splice into a stack where the connected block is\n        // immovable, unless the block is a shadow block.\n        if (b.targetBlock() && !b.targetBlock()!.isMovable() &&\n            !b.targetBlock()!.isShadow()) {\n          return false;\n        }\n        break;\n      }\n      default:\n        // Unexpected connection type.\n        return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.indexOf(b) !== -1) {\n      return false;\n    }\n\n    return true;\n  }\n\n  /**\n   * Helper function for drag checking.\n   *\n   * @param a The connection to check, which must be a statement input or next\n   *     connection.\n   * @param b A nearby connection to check, which must be a previous connection.\n   * @returns True if the connection is allowed, false otherwise.\n   */\n  protected canConnectToPrevious_(a: Connection, b: Connection): boolean {\n    if (a.targetConnection) {\n      // This connection is already occupied.\n      // A next connection will never disconnect itself mid-drag.\n      return false;\n    }\n\n    // Don't let blocks try to connect to themselves or ones they nest.\n    if (common.draggingConnections.indexOf(b) !== -1) {\n      return false;\n    }\n\n    if (!b.targetConnection) {\n      return true;\n    }\n\n    const targetBlock = b.targetBlock();\n    // If it is connected to a real block, game over.\n    if (!targetBlock!.isInsertionMarker()) {\n      return false;\n    }\n    // If it's connected to an insertion marker but that insertion marker\n    // is the first block in a stack, it's still fine.  If that insertion\n    // marker is in the middle of a stack, it won't work.\n    return !targetBlock!.getPreviousBlock();\n  }\n}\n\nregistry.register(\n    registry.Type.CONNECTION_CHECKER, registry.DEFAULT, ConnectionChecker);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A database of all the rendered connections that could\n *    possibly be connected to (i.e. not collapsed, etc).\n *    Sorted by y coordinate.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ConnectionDB');\n\nimport {ConnectionType} from './connection_type.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport type {RenderedConnection} from './rendered_connection.js';\nimport type {Coordinate} from './utils/coordinate.js';\n\n\n/**\n * Database of connections.\n * Connections are stored in order of their vertical component.  This way\n * connections in an area may be looked up quickly using a binary search.\n */\nexport class ConnectionDB {\n  /** Array of connections sorted by y position in workspace units. */\n  private readonly connections_: RenderedConnection[] = [];\n\n  /**\n   * @param connectionChecker The workspace's connection type checker, used to\n   *     decide if connections are valid during a drag.\n   */\n  constructor(private readonly connectionChecker: IConnectionChecker) {}\n\n  /**\n   * Add a connection to the database. Should not already exist in the database.\n   *\n   * @param connection The connection to be added.\n   * @param yPos The y position used to decide where to insert the connection.\n   * @internal\n   */\n  addConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.calculateIndexForYPos_(yPos);\n    this.connections_.splice(index, 0, connection);\n  }\n\n  /**\n   * Finds the index of the given connection.\n   *\n   * Starts by doing a binary search to find the approximate location, then\n   * linearly searches nearby for the exact connection.\n   *\n   * @param conn The connection to find.\n   * @param yPos The y position used to find the index of the connection.\n   * @returns The index of the connection, or -1 if the connection was not\n   *     found.\n   */\n  private findIndexOfConnection_(conn: RenderedConnection, yPos: number):\n      number {\n    if (!this.connections_.length) {\n      return -1;\n    }\n\n    const bestGuess = this.calculateIndexForYPos_(yPos);\n    if (bestGuess >= this.connections_.length) {\n      // Not in list\n      return -1;\n    }\n\n    yPos = conn.y;\n    // Walk forward and back on the y axis looking for the connection.\n    let pointer = bestGuess;\n    while (pointer >= 0 && this.connections_[pointer].y === yPos) {\n      if (this.connections_[pointer] === conn) {\n        return pointer;\n      }\n      pointer--;\n    }\n\n    pointer = bestGuess;\n    while (pointer < this.connections_.length &&\n           this.connections_[pointer].y === yPos) {\n      if (this.connections_[pointer] === conn) {\n        return pointer;\n      }\n      pointer++;\n    }\n    return -1;\n  }\n\n  /**\n   * Finds the correct index for the given y position.\n   *\n   * @param yPos The y position used to decide where to insert the connection.\n   * @returns The candidate index.\n   */\n  private calculateIndexForYPos_(yPos: number): number {\n    if (!this.connections_.length) {\n      return 0;\n    }\n    let pointerMin = 0;\n    let pointerMax = this.connections_.length;\n    while (pointerMin < pointerMax) {\n      const pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n      if (this.connections_[pointerMid].y < yPos) {\n        pointerMin = pointerMid + 1;\n      } else if (this.connections_[pointerMid].y > yPos) {\n        pointerMax = pointerMid;\n      } else {\n        pointerMin = pointerMid;\n        break;\n      }\n    }\n    return pointerMin;\n  }\n\n  /**\n   * Remove a connection from the database.  Must already exist in DB.\n   *\n   * @param connection The connection to be removed.\n   * @param yPos The y position used to find the index of the connection.\n   * @throws {Error} If the connection cannot be found in the database.\n   */\n  removeConnection(connection: RenderedConnection, yPos: number) {\n    const index = this.findIndexOfConnection_(connection, yPos);\n    if (index === -1) {\n      throw Error('Unable to find connection in connectionDB.');\n    }\n    this.connections_.splice(index, 1);\n  }\n\n  /**\n   * Find all nearby connections to the given connection.\n   * Type checking does not apply, since this function is used for bumping.\n   *\n   * @param connection The connection whose neighbours should be returned.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns List of connections.\n   */\n  getNeighbours(connection: RenderedConnection, maxRadius: number):\n      RenderedConnection[] {\n    const db = this.connections_;\n    const currentX = connection.x;\n    const currentY = connection.y;\n\n    // Binary search to find the closest y location.\n    let pointerMin = 0;\n    let pointerMax = db.length - 2;\n    let pointerMid = pointerMax;\n    while (pointerMin < pointerMid) {\n      if (db[pointerMid].y < currentY) {\n        pointerMin = pointerMid;\n      } else {\n        pointerMax = pointerMid;\n      }\n      pointerMid = Math.floor((pointerMin + pointerMax) / 2);\n    }\n\n    const neighbours: RenderedConnection[] = [];\n    /**\n     * Computes if the current connection is within the allowed radius of\n     * another connection. This function is a closure and has access to outside\n     * variables.\n     *\n     * @param yIndex The other connection's index in the database.\n     * @returns True if the current connection's vertical distance from the\n     *     other connection is less than the allowed radius.\n     */\n    function checkConnection_(yIndex: number): boolean {\n      const dx = currentX - db[yIndex].x;\n      const dy = currentY - db[yIndex].y;\n      const r = Math.sqrt(dx * dx + dy * dy);\n      if (r <= maxRadius) {\n        neighbours.push(db[yIndex]);\n      }\n      return dy < maxRadius;\n    }\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    pointerMin = pointerMid;\n    pointerMax = pointerMid;\n    if (db.length) {\n      while (pointerMin >= 0 && checkConnection_(pointerMin)) {\n        pointerMin--;\n      }\n      do {\n        pointerMax++;\n      } while (pointerMax < db.length && checkConnection_(pointerMax));\n    }\n\n    return neighbours;\n  }\n\n  /**\n   * Is the candidate connection close to the reference connection.\n   * Extremely fast; only looks at Y distance.\n   *\n   * @param index Index in database of candidate connection.\n   * @param baseY Reference connection's Y value.\n   * @param maxRadius The maximum radius to another connection.\n   * @returns True if connection is in range.\n   */\n  private isInYRange_(index: number, baseY: number, maxRadius: number):\n      boolean {\n    return Math.abs(this.connections_[index].y - baseY) <= maxRadius;\n  }\n\n  /**\n   * Find the closest compatible connection to this connection.\n   *\n   * @param conn The connection searching for a compatible mate.\n   * @param maxRadius The maximum radius to another connection.\n   * @param dxy Offset between this connection's location in the database and\n   *     the current location (as a result of dragging).\n   * @returns Contains two properties: 'connection' which is either another\n   *     connection or null, and 'radius' which is the distance.\n   */\n  searchForClosest(\n      conn: RenderedConnection, maxRadius: number,\n      dxy: Coordinate): {connection: RenderedConnection|null, radius: number} {\n    if (!this.connections_.length) {\n      // Don't bother.\n      return {connection: null, radius: maxRadius};\n    }\n\n    // Stash the values of x and y from before the drag.\n    const baseY = conn.y;\n    const baseX = conn.x;\n\n    conn.x = baseX + dxy.x;\n    conn.y = baseY + dxy.y;\n\n    // calculateIndexForYPos_ finds an index for insertion, which is always\n    // after any block with the same y index.  We want to search both forward\n    // and back, so search on both sides of the index.\n    const closestIndex = this.calculateIndexForYPos_(conn.y);\n\n    let bestConnection = null;\n    let bestRadius = maxRadius;\n    let temp;\n\n    // Walk forward and back on the y axis looking for the closest x,y point.\n    let pointerMin = closestIndex - 1;\n    while (pointerMin >= 0 && this.isInYRange_(pointerMin, conn.y, maxRadius)) {\n      temp = this.connections_[pointerMin];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMin--;\n    }\n\n    let pointerMax = closestIndex;\n    while (pointerMax < this.connections_.length &&\n           this.isInYRange_(pointerMax, conn.y, maxRadius)) {\n      temp = this.connections_[pointerMax];\n      if (this.connectionChecker.canConnect(conn, temp, true, bestRadius)) {\n        bestConnection = temp;\n        bestRadius = temp.distanceFrom(conn);\n      }\n      pointerMax++;\n    }\n\n    // Reset the values of x and y.\n    conn.x = baseX;\n    conn.y = baseY;\n    // If there were no valid connections, bestConnection will be null.\n    return {connection: bestConnection, radius: bestRadius};\n  }\n\n  /**\n   * Initialize a set of connection DBs for a workspace.\n   *\n   * @param checker The workspace's connection checker, used to decide if\n   *     connections are valid during a drag.\n   * @returns Array of databases.\n   */\n  static init(checker: IConnectionChecker): ConnectionDB[] {\n    // Create four databases, one for each connection type.\n    const dbList = [];\n    dbList[ConnectionType.INPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.OUTPUT_VALUE] = new ConnectionDB(checker);\n    dbList[ConnectionType.NEXT_STATEMENT] = new ConnectionDB(checker);\n    dbList[ConnectionType.PREVIOUS_STATEMENT] = new ConnectionDB(checker);\n    return dbList;\n  }\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a block move event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.BlockMove');\n\nimport type {Block} from '../block.js';\nimport {ConnectionType} from '../connection_type.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\n\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\ninterface BlockLocation {\n  parentId?: string;\n  inputName?: string;\n  coordinate?: Coordinate;\n}\n\n/**\n * Notifies listeners when a block is moved. This could be from one\n * connection to another, or from one location on the workspace to another.\n */\nexport class BlockMove extends BlockBase {\n  override type = eventUtils.BLOCK_MOVE;\n\n  /** The ID of the old parent block. Undefined if it was a top-level block. */\n  oldParentId?: string;\n\n  /**\n   * The name of the old input. Undefined if it was a top-level block or the\n   * parent's next block.\n   */\n  oldInputName?: string;\n\n  /**\n   * The old X and Y workspace coordinates of the block if it was a top level\n   * block. Undefined if it was not a top level block.\n   */\n  oldCoordinate?: Coordinate;\n\n  /** The ID of the new parent block. Undefined if it is a top-level block. */\n  newParentId?: string;\n\n  /**\n   * The name of the new input. Undefined if it is a top-level block or the\n   * parent's next block.\n   */\n  newInputName?: string;\n\n  /**\n   * The new X and Y workspace coordinates of the block if it is a top level\n   * block. Undefined if it is not a top level block.\n   */\n  newCoordinate?: Coordinate;\n\n  /** @param opt_block The moved block.  Undefined for a blank event. */\n  constructor(opt_block?: Block) {\n    super(opt_block);\n\n    if (!opt_block) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    if (opt_block.isShadow()) {\n      // Moving shadow blocks is handled via disconnection.\n      this.recordUndo = false;\n    }\n\n    const location = this.currentLocation_();\n    this.oldParentId = location.parentId;\n    this.oldInputName = location.inputName;\n    this.oldCoordinate = location.coordinate;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): BlockMoveJson {\n    const json = super.toJson() as BlockMoveJson;\n    json['oldParentId'] = this.oldParentId;\n    json['oldInputName'] = this.oldInputName;\n    if (this.oldCoordinate) {\n      json['oldCoordinate'] = `${Math.round(this.oldCoordinate.x)}, ` +\n          `${Math.round(this.oldCoordinate.y)}`;\n    }\n    json['newParentId'] = this.newParentId;\n    json['newInputName'] = this.newInputName;\n    if (this.newCoordinate) {\n      json['newCoordinate'] = `${Math.round(this.newCoordinate.x)}, ` +\n          `${Math.round(this.newCoordinate.y)}`;\n    }\n    if (!this.recordUndo) {\n      json['recordUndo'] = this.recordUndo;\n    }\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: BlockMoveJson) {\n    deprecation.warn(\n        'Blockly.Events.BlockMove.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldParentId = json['oldParentId'];\n    this.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      this.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    this.newParentId = json['newParentId'];\n    this.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      this.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['recordUndo'] !== undefined) {\n      this.recordUndo = json['recordUndo'];\n    }\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of BlockMove, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: BlockMoveJson, workspace: Workspace, event?: any):\n      BlockMove {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new BlockMove()) as BlockMove;\n    newEvent.oldParentId = json['oldParentId'];\n    newEvent.oldInputName = json['oldInputName'];\n    if (json['oldCoordinate']) {\n      const xy = json['oldCoordinate'].split(',');\n      newEvent.oldCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    newEvent.newParentId = json['newParentId'];\n    newEvent.newInputName = json['newInputName'];\n    if (json['newCoordinate']) {\n      const xy = json['newCoordinate'].split(',');\n      newEvent.newCoordinate = new Coordinate(Number(xy[0]), Number(xy[1]));\n    }\n    if (json['recordUndo'] !== undefined) {\n      newEvent.recordUndo = json['recordUndo'];\n    }\n    return newEvent;\n  }\n\n  /** Record the block's new location.  Called after the move. */\n  recordNew() {\n    const location = this.currentLocation_();\n    this.newParentId = location.parentId;\n    this.newInputName = location.inputName;\n    this.newCoordinate = location.coordinate;\n  }\n\n  /**\n   * Returns the parentId and input if the block is connected,\n   *   or the XY location if disconnected.\n   *\n   * @returns Collection of location info.\n   */\n  private currentLocation_(): BlockLocation {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      throw new Error(\n          'The block associated with the block move event ' +\n          'could not be found');\n    }\n    const location = {} as BlockLocation;\n    const parent = block.getParent();\n    if (parent) {\n      location.parentId = parent.id;\n      const input = parent.getInputWithBlock(block);\n      if (input) {\n        location.inputName = input.name;\n      }\n    } else {\n      location.coordinate = block.getRelativeToSurfaceXY();\n    }\n    return location;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldParentId === this.newParentId &&\n        this.oldInputName === this.newInputName &&\n        Coordinate.equals(this.oldCoordinate, this.newCoordinate);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.blockId) {\n      throw new Error(\n          'The block ID is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    const block = workspace.getBlockById(this.blockId);\n    if (!block) {\n      console.warn('Can\\'t move non-existent block: ' + this.blockId);\n      return;\n    }\n    const parentId = forward ? this.newParentId : this.oldParentId;\n    const inputName = forward ? this.newInputName : this.oldInputName;\n    const coordinate = forward ? this.newCoordinate : this.oldCoordinate;\n    let parentBlock: Block|null;\n    if (parentId) {\n      parentBlock = workspace.getBlockById(parentId);\n      if (!parentBlock) {\n        console.warn('Can\\'t connect to non-existent block: ' + parentId);\n        return;\n      }\n    }\n    if (block.getParent()) {\n      block.unplug();\n    }\n    if (coordinate) {\n      const xy = block.getRelativeToSurfaceXY();\n      block.moveBy(coordinate.x - xy.x, coordinate.y - xy.y);\n    } else {\n      let blockConnection = block.outputConnection;\n      if (!blockConnection ||\n          block.previousConnection && block.previousConnection.isConnected()) {\n        blockConnection = block.previousConnection;\n      }\n      let parentConnection;\n      const connectionType = blockConnection?.type;\n      if (inputName) {\n        const input = parentBlock!.getInput(inputName);\n        if (input) {\n          parentConnection = input.connection;\n        }\n      } else if (connectionType === ConnectionType.PREVIOUS_STATEMENT) {\n        parentConnection = parentBlock!.nextConnection;\n      }\n      if (parentConnection && blockConnection) {\n        blockConnection.connect(parentConnection);\n      } else {\n        console.warn('Can\\'t connect to non-existent input: ' + inputName);\n      }\n    }\n  }\n}\n\nexport interface BlockMoveJson extends BlockBaseJson {\n  oldParentId?: string;\n  oldInputName?: string;\n  oldCoordinate?: string;\n  newParentId?: string;\n  newInputName?: string;\n  newCoordinate?: string;\n  recordUndo?: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MOVE, BlockMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of UI click in Blockly's editor.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.Click');\n\nimport type {Block} from '../block.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that ome blockly element was clicked.\n */\nexport class Click extends UiBase {\n  /** The ID of the block that was clicked, if a block was clicked. */\n  blockId?: string;\n\n  /**\n   * The type of element that was clicked; one of 'block', 'workspace',\n   * or 'zoom_controls'.\n   */\n  targetType?: ClickTarget;\n  override type = eventUtils.CLICK;\n\n  /**\n   * @param opt_block The affected block. Null for click events that do not have\n   *     an associated block (i.e. workspace click). Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Not used if block is passed. Undefined for a blank event.\n   * @param opt_targetType The type of element targeted by this click event.\n   *     Undefined for a blank event.\n   */\n  constructor(\n      opt_block?: Block|null, opt_workspaceId?: string|null,\n      opt_targetType?: ClickTarget) {\n    let workspaceId = opt_block ? opt_block.workspace.id : opt_workspaceId;\n    if (workspaceId === null) {\n      workspaceId = undefined;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block ? opt_block.id : undefined;\n    this.targetType = opt_targetType;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ClickJson {\n    const json = super.toJson() as ClickJson;\n    if (!this.targetType) {\n      throw new Error(\n          'The click target type is undefined. Either pass a block to ' +\n          'the constructor, or call fromJson');\n    }\n    json['targetType'] = this.targetType;\n    json['blockId'] = this.blockId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ClickJson) {\n    deprecation.warn(\n        'Blockly.Events.Click.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.targetType = json['targetType'];\n    this.blockId = json['blockId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Click, but we can't specify that due to the fact that parameters to\n   *     static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ClickJson, workspace: Workspace, event?: any): Click {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new Click()) as Click;\n    newEvent.targetType = json['targetType'];\n    newEvent.blockId = json['blockId'];\n    return newEvent;\n  }\n}\n\nexport enum ClickTarget {\n  BLOCK = 'block',\n  WORKSPACE = 'workspace',\n  ZOOM_CONTROLS = 'zoom_controls',\n}\n\nexport interface ClickJson extends AbstractEventJson {\n  targetType: ClickTarget;\n  blockId?: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.CLICK, Click);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Base class for comment events.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentBase');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as utilsXml from '../utils/xml.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\nimport * as Xml from '../xml.js';\n\nimport {Abstract as AbstractEvent, AbstractEventJson} from './events_abstract.js';\nimport type {CommentCreate} from './events_comment_create.js';\nimport type {CommentDelete} from './events_comment_delete.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Abstract class for a comment event.\n */\nexport class CommentBase extends AbstractEvent {\n  override isBlank = true;\n\n  /** The ID of the comment that this event references. */\n  commentId?: string;\n\n  /**\n   * @param opt_comment The comment this event corresponds to.  Undefined for a\n   *     blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super();\n    /** Whether or not an event is blank. */\n    this.isBlank = !opt_comment;\n\n    if (!opt_comment) return;\n\n    this.commentId = opt_comment.id;\n    this.workspaceId = opt_comment.workspace.id;\n    this.group = eventUtils.getGroup();\n    this.recordUndo = eventUtils.getRecordUndo();\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentBaseJson {\n    const json = super.toJson() as CommentBaseJson;\n    if (!this.commentId) {\n      throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    json['commentId'] = this.commentId;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentBaseJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentBase.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.commentId = json['commentId'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentBase, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentBaseJson, workspace: Workspace, event?: any):\n      CommentBase {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentBase()) as\n        CommentBase;\n    newEvent.commentId = json['commentId'];\n    return newEvent;\n  }\n\n  /**\n   * Helper function for Comment[Create|Delete]\n   *\n   * @param event The event to run.\n   * @param create if True then Create, if False then Delete\n   */\n  static CommentCreateDeleteHelper(\n      event: CommentCreate|CommentDelete, create: boolean) {\n    const workspace = event.getEventWorkspace_();\n    if (create) {\n      const xmlElement = utilsXml.createElement('xml');\n      if (!event.xml) {\n        throw new Error('Ecountered a comment event without proper xml');\n      }\n      xmlElement.appendChild(event.xml);\n      Xml.domToWorkspace(xmlElement, workspace);\n    } else {\n      if (!event.commentId) {\n        throw new Error(\n            'The comment ID is undefined. Either pass a comment to ' +\n            'the constructor, or call fromJson');\n      }\n      const comment = workspace.getCommentById(event.commentId);\n      if (comment) {\n        comment.dispose();\n      } else {\n        // Only complain about root-level block.\n        console.warn(\n            'Can\\'t uncreate non-existent comment: ' + event.commentId);\n      }\n    }\n  }\n}\n\nexport interface CommentBaseJson extends AbstractEventJson {\n  commentId: string;\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment change event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentChange');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that the contents of a workspace comment has changed.\n */\nexport class CommentChange extends CommentBase {\n  override type = eventUtils.COMMENT_CHANGE;\n\n  // TODO(#6774): We should remove underscores.\n  /** The previous contents of the comment. */\n  oldContents_?: string;\n\n  /** The new contents of the comment. */\n  newContents_?: string;\n\n  /**\n   * @param opt_comment The comment that is being changed.  Undefined for a\n   *     blank event.\n   * @param opt_oldContents Previous contents of the comment.\n   * @param opt_newContents New contents of the comment.\n   */\n  constructor(\n      opt_comment?: WorkspaceComment, opt_oldContents?: string,\n      opt_newContents?: string) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    this.oldContents_ =\n        typeof opt_oldContents === 'undefined' ? '' : opt_oldContents;\n    this.newContents_ =\n        typeof opt_newContents === 'undefined' ? '' : opt_newContents;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentChangeJson {\n    const json = super.toJson() as CommentChangeJson;\n    if (!this.oldContents_) {\n      throw new Error(\n          'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newContents_) {\n      throw new Error(\n          'The new contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    json['oldContents'] = this.oldContents_;\n    json['newContents'] = this.newContents_;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentChange.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldContents_ = json['oldContents'];\n    this.newContents_ = json['newContents'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentChangeJson, workspace: Workspace, event?: any):\n      CommentChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentChange()) as\n        CommentChange;\n    newEvent.oldContents_ = json['oldContents'];\n    newEvent.newContents_ = json['newContents'];\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return this.oldContents_ === this.newContents_;\n  }\n\n  /**\n   * Run a change event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn('Can\\'t change non-existent comment: ' + this.commentId);\n      return;\n    }\n    const contents = forward ? this.newContents_ : this.oldContents_;\n    if (!contents) {\n      if (forward) {\n        throw new Error(\n            'The new contents is undefined. Either pass a value to ' +\n            'the constructor, or call fromJson');\n      }\n      throw new Error(\n          'The old contents is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    comment.setContent(contents);\n  }\n}\n\nexport interface CommentChangeJson extends CommentBaseJson {\n  oldContents: string;\n  newContents: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.COMMENT_CHANGE, CommentChange);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment creation event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentCreate');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a workspace comment was created.\n */\nexport class CommentCreate extends CommentBase {\n  override type = eventUtils.COMMENT_CREATE;\n\n  /** The XML representation of the created workspace comment. */\n  xml?: Element|DocumentFragment;\n\n  /**\n   * @param opt_comment The created comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;\n    }\n    // Blank event to be populated by fromJson.\n    this.xml = opt_comment.toXmlWithXY();\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentCreateJson {\n    const json = super.toJson() as CommentCreateJson;\n    if (!this.xml) {\n      throw new Error(\n          'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentCreateJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentCreate.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.xml = utilsXml.textToDom(json['xml']);\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentCreate, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentCreateJson, workspace: Workspace, event?: any):\n      CommentCreate {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentCreate()) as\n        CommentCreate;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    return newEvent;\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, forward);\n  }\n}\n\nexport interface CommentCreateJson extends CommentBaseJson {\n  xml: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.COMMENT_CREATE, CommentCreate);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment deletion event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentDelete');\n\nimport * as registry from '../registry.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport * as utilsXml from '../utils/xml.js';\nimport * as Xml from '../xml.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a workspace comment has been deleted.\n */\nexport class CommentDelete extends CommentBase {\n  override type = eventUtils.COMMENT_DELETE;\n\n  /** The XML representation of the deleted workspace comment. */\n  xml?: Element;\n\n  /**\n   * @param opt_comment The deleted comment.\n   *     Undefined for a blank event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    this.xml = opt_comment.toXmlWithXY();\n  }\n\n  /**\n   * Run a creation event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    CommentBase.CommentCreateDeleteHelper(this, !forward);\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentDeleteJson {\n    const json = super.toJson() as CommentDeleteJson;\n    if (!this.xml) {\n      throw new Error(\n          'The comment XML is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    json['xml'] = Xml.domToText(this.xml);\n    return json;\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentDelete, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentDeleteJson, workspace: Workspace, event?: any):\n      CommentDelete {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentDelete()) as\n        CommentDelete;\n    newEvent.xml = utilsXml.textToDom(json['xml']);\n    return newEvent;\n  }\n}\n\nexport interface CommentDeleteJson extends CommentBaseJson {\n  xml: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.COMMENT_DELETE, CommentDelete);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for comment move event.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.CommentMove');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {Coordinate} from '../utils/coordinate.js';\nimport type {WorkspaceComment} from '../workspace_comment.js';\n\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a workspace comment has moved.\n */\nexport class CommentMove extends CommentBase {\n  override type = eventUtils.COMMENT_MOVE;\n\n  /** The comment that is being moved. */\n  comment_?: WorkspaceComment;\n\n  // TODO(#6774): We should remove underscores.\n  /** The location of the comment before the move, in workspace coordinates. */\n  oldCoordinate_?: Coordinate;\n\n  /** The location of the comment after the move, in workspace coordinates. */\n  newCoordinate_?: Coordinate;\n\n  /**\n   * @param opt_comment The comment that is being moved.  Undefined for a blank\n   *     event.\n   */\n  constructor(opt_comment?: WorkspaceComment) {\n    super(opt_comment);\n\n    if (!opt_comment) {\n      return;  // Blank event to be populated by fromJson.\n    }\n\n    this.comment_ = opt_comment;\n    this.oldCoordinate_ = opt_comment.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Record the comment's new location.  Called after the move.  Can only be\n   * called once.\n   */\n  recordNew() {\n    if (this.newCoordinate_) {\n      throw Error(\n          'Tried to record the new position of a comment on the ' +\n          'same event twice.');\n    }\n    if (!this.comment_) {\n      throw new Error(\n          'The comment is undefined. Pass a comment to ' +\n          'the constructor if you want to use the record functionality');\n    }\n    this.newCoordinate_ = this.comment_.getRelativeToSurfaceXY();\n  }\n\n  /**\n   * Override the location before the move.  Use this if you don't create the\n   * event until the end of the move, but you know the original location.\n   *\n   * @param xy The location before the move, in workspace coordinates.\n   */\n  setOldCoordinate(xy: Coordinate) {\n    this.oldCoordinate_ = xy;\n  }\n\n  // TODO (#1266): \"Full\" and \"minimal\" serialization.\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): CommentMoveJson {\n    const json = super.toJson() as CommentMoveJson;\n    if (!this.oldCoordinate_) {\n      throw new Error(\n          'The old comment position is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newCoordinate_) {\n      throw new Error(\n          'The new comment position is undefined. Either call recordNew, or ' +\n          'call fromJson');\n    }\n    json['oldCoordinate'] = `${Math.round(this.oldCoordinate_.x)}, ` +\n        `${Math.round(this.oldCoordinate_.y)}`;\n    json['newCoordinate'] = Math.round(this.newCoordinate_.x) + ',' +\n        Math.round(this.newCoordinate_.y);\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: CommentMoveJson) {\n    deprecation.warn(\n        'Blockly.Events.CommentMove.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    let xy = json['oldCoordinate'].split(',');\n    this.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    this.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of CommentMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: CommentMoveJson, workspace: Workspace, event?: any):\n      CommentMove {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new CommentMove()) as\n        CommentMove;\n    let xy = json['oldCoordinate'].split(',');\n    newEvent.oldCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    xy = json['newCoordinate'].split(',');\n    newEvent.newCoordinate_ = new Coordinate(Number(xy[0]), Number(xy[1]));\n    return newEvent;\n  }\n\n  /**\n   * Does this event record any change of state?\n   *\n   * @returns False if something changed.\n   */\n  override isNull(): boolean {\n    return Coordinate.equals(this.oldCoordinate_, this.newCoordinate_);\n  }\n\n  /**\n   * Run a move event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.commentId) {\n      throw new Error(\n          'The comment ID is undefined. Either pass a comment to ' +\n          'the constructor, or call fromJson');\n    }\n    const comment = workspace.getCommentById(this.commentId);\n    if (!comment) {\n      console.warn('Can\\'t move non-existent comment: ' + this.commentId);\n      return;\n    }\n\n    const target = forward ? this.newCoordinate_ : this.oldCoordinate_;\n    if (!target) {\n      throw new Error(\n          'Either oldCoordinate_ or newCoordinate_ is undefined. ' +\n          'Either pass a comment to the constructor and call recordNew, ' +\n          'or call fromJson');\n    }\n    // TODO: Check if the comment is being dragged, and give up if so.\n    const current = comment.getRelativeToSurfaceXY();\n    comment.moveBy(target.x - current.x, target.y - current.y);\n  }\n}\n\nexport interface CommentMoveJson extends CommentBaseJson {\n  oldCoordinate: string;\n  newCoordinate: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.COMMENT_MOVE, CommentMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a marker move.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.MarkerMove');\n\nimport type {Block} from '../block.js';\nimport {ASTNode} from '../keyboard_nav/ast_node.js';\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {Workspace} from '../workspace.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\n\n\n/**\n * Notifies listeners that a marker (used for keyboard navigation) has\n * moved.\n */\nexport class MarkerMove extends UiBase {\n  /** The ID of the block the marker is now on, if any. */\n  blockId?: string;\n\n  /** The old node the marker used to be on, if any. */\n  oldNode?: ASTNode;\n\n  /** The new node the marker is now on. */\n  newNode?: ASTNode;\n\n  /**\n   * True if this is a cursor event, false otherwise.\n   * For information about cursors vs markers see {@link\n   * https://blocklycodelabs.dev/codelabs/keyboard-navigation/index.html?index=..%2F..index#1}.\n   */\n  isCursor?: boolean;\n\n  override type = eventUtils.MARKER_MOVE;\n\n  /**\n   * @param opt_block The affected block. Null if current node is of type\n   *     workspace. Undefined for a blank event.\n   * @param isCursor Whether this is a cursor event. Undefined for a blank\n   *     event.\n   * @param opt_oldNode The old node the marker used to be on.\n   *    Undefined for a blank event.\n   * @param opt_newNode The new node the marker is now on.\n   *    Undefined for a blank event.\n   */\n  constructor(\n      opt_block?: Block|null, isCursor?: boolean, opt_oldNode?: ASTNode|null,\n      opt_newNode?: ASTNode) {\n    let workspaceId = opt_block ? opt_block.workspace.id : undefined;\n    if (opt_newNode && opt_newNode.getType() === ASTNode.types.WORKSPACE) {\n      workspaceId = (opt_newNode.getLocation() as Workspace).id;\n    }\n    super(workspaceId);\n\n    this.blockId = opt_block?.id;\n    this.oldNode = opt_oldNode || undefined;\n    this.newNode = opt_newNode;\n    this.isCursor = isCursor;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): MarkerMoveJson {\n    const json = super.toJson() as MarkerMoveJson;\n    if (this.isCursor === undefined) {\n      throw new Error(\n          'Whether this is a cursor event or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson');\n    }\n    if (!this.newNode) {\n      throw new Error(\n          'The new node is undefined. Either pass a node to ' +\n          'the constructor, or call fromJson');\n    }\n    json['isCursor'] = this.isCursor;\n    json['blockId'] = this.blockId;\n    json['oldNode'] = this.oldNode;\n    json['newNode'] = this.newNode;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: MarkerMoveJson) {\n    deprecation.warn(\n        'Blockly.Events.MarkerMove.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isCursor = json['isCursor'];\n    this.blockId = json['blockId'];\n    this.oldNode = json['oldNode'];\n    this.newNode = json['newNode'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of MarkerMove, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: MarkerMoveJson, workspace: Workspace, event?: any):\n      MarkerMove {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new MarkerMove()) as\n        MarkerMove;\n    newEvent.isCursor = json['isCursor'];\n    newEvent.blockId = json['blockId'];\n    newEvent.oldNode = json['oldNode'];\n    newEvent.newNode = json['newNode'];\n    return newEvent;\n  }\n}\n\nexport interface MarkerMoveJson extends AbstractEventJson {\n  isCursor: boolean;\n  blockId?: string;\n  oldNode?: ASTNode;\n  newNode: ASTNode;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.MARKER_MOVE, MarkerMove);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a theme update.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.ThemeChange');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that the workspace theme has changed.\n */\nexport class ThemeChange extends UiBase {\n  /** The name of the new theme that has been set. */\n  themeName?: string;\n\n  override type = eventUtils.THEME_CHANGE;\n\n  /**\n   * @param opt_themeName The theme name. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    event. Undefined for a blank event.\n   */\n  constructor(opt_themeName?: string, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.themeName = opt_themeName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ThemeChangeJson {\n    const json = super.toJson() as ThemeChangeJson;\n    if (!this.themeName) {\n      throw new Error(\n          'The theme name is undefined. Either pass a theme name to ' +\n          'the constructor, or call fromJson');\n    }\n    json['themeName'] = this.themeName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ThemeChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.ThemeChange.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.themeName = json['themeName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ThemeChange, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ThemeChangeJson, workspace: Workspace, event?: any):\n      ThemeChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new ThemeChange()) as\n        ThemeChange;\n    newEvent.themeName = json['themeName'];\n    return newEvent;\n  }\n}\n\nexport interface ThemeChangeJson extends AbstractEventJson {\n  themeName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.THEME_CHANGE, ThemeChange);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of selecting an item on the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.ToolboxItemSelect');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a toolbox item has been selected.\n */\nexport class ToolboxItemSelect extends UiBase {\n  /** The previously selected toolbox item. */\n  oldItem?: string;\n\n  /** The newly selected toolbox item. */\n  newItem?: string;\n\n  override type = eventUtils.TOOLBOX_ITEM_SELECT;\n\n  /**\n   * @param opt_oldItem The previously selected toolbox item.\n   *     Undefined for a blank event.\n   * @param opt_newItem The newly selected toolbox item. Undefined for a blank\n   *     event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(\n      opt_oldItem?: string|null, opt_newItem?: string|null,\n      opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.oldItem = opt_oldItem ?? undefined;\n    this.newItem = opt_newItem ?? undefined;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ToolboxItemSelectJson {\n    const json = super.toJson() as ToolboxItemSelectJson;\n    json['oldItem'] = this.oldItem;\n    json['newItem'] = this.newItem;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ToolboxItemSelectJson) {\n    deprecation.warn(\n        'Blockly.Events.ToolboxItemSelect.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldItem = json['oldItem'];\n    this.newItem = json['newItem'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of ToolboxItemSelect, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(\n      json: ToolboxItemSelectJson, workspace: Workspace,\n      event?: any): ToolboxItemSelect {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new ToolboxItemSelect()) as\n        ToolboxItemSelect;\n    newEvent.oldItem = json['oldItem'];\n    newEvent.newItem = json['newItem'];\n    return newEvent;\n  }\n}\n\nexport interface ToolboxItemSelectJson extends AbstractEventJson {\n  oldItem?: string;\n  newItem?: string;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.TOOLBOX_ITEM_SELECT, ToolboxItemSelect);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of trashcan flyout open and close.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.TrashcanOpen');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\n\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners when the trashcan is opening or closing.\n */\nexport class TrashcanOpen extends UiBase {\n  /**\n   * True if the trashcan is currently opening (previously closed).\n   * False if it is currently closing (previously open).\n   */\n  isOpen?: boolean;\n  override type = eventUtils.TRASHCAN_OPEN;\n\n  /**\n   * @param opt_isOpen Whether the trashcan flyout is opening (false if\n   *     opening). Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   */\n  constructor(opt_isOpen?: boolean, opt_workspaceId?: string) {\n    super(opt_workspaceId);\n    this.isOpen = opt_isOpen;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): TrashcanOpenJson {\n    const json = super.toJson() as TrashcanOpenJson;\n    if (this.isOpen === undefined) {\n      throw new Error(\n          'Whether this is already open or not is undefined. Either pass ' +\n          'a value to the constructor, or call fromJson');\n    }\n    json['isOpen'] = this.isOpen;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: TrashcanOpenJson) {\n    deprecation.warn(\n        'Blockly.Events.TrashcanOpen.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.isOpen = json['isOpen'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of TrashcanOpen, but we can't specify that due to the fact that\n   *     parameters to static methods in subclasses must be supertypes of\n   *     parameters to static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: TrashcanOpenJson, workspace: Workspace, event?: any):\n      TrashcanOpen {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new TrashcanOpen()) as\n        TrashcanOpen;\n    newEvent.isOpen = json['isOpen'];\n    return newEvent;\n  }\n}\n\nexport interface TrashcanOpenJson extends AbstractEventJson {\n  isOpen: boolean;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.TRASHCAN_OPEN, TrashcanOpen);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarDelete');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a variable model has been deleted.\n *\n * @class\n */\nexport class VarDelete extends VarBase {\n  override type = eventUtils.VAR_DELETE;\n  /** The type of the variable that was deleted. */\n  varType?: string;\n  /** The name of the variable that was deleted. */\n  varName?: string;\n\n  /**\n   * @param opt_variable The deleted variable. Undefined for a blank event.\n   */\n  constructor(opt_variable?: VariableModel) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.varType = opt_variable.type;\n    this.varName = opt_variable.name;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarDeleteJson {\n    const json = super.toJson() as VarDeleteJson;\n    if (this.varType === undefined) {\n      throw new Error(\n          'The var type is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    json['varType'] = this.varType;\n    json['varName'] = this.varName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarDeleteJson) {\n    deprecation.warn(\n        'Blockly.Events.VarDelete.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.varType = json['varType'];\n    this.varName = json['varName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarDelete, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarDeleteJson, workspace: Workspace, event?: any):\n      VarDelete {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarDelete()) as VarDelete;\n    newEvent.varType = json['varType'];\n    newEvent.varName = json['varName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable deletion event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.varName) {\n      throw new Error(\n          'The var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      workspace.deleteVariableById(this.varId);\n    } else {\n      workspace.createVariable(this.varName, this.varType, this.varId);\n    }\n  }\n}\n\nexport interface VarDeleteJson extends VarBaseJson {\n  varType: string;\n  varName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_DELETE, VarDelete);\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.VarRename');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport type {VariableModel} from '../variable_model.js';\n\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that a variable model was renamed.\n *\n * @class\n */\nexport class VarRename extends VarBase {\n  override type = eventUtils.VAR_RENAME;\n\n  /** The previous name of the variable. */\n  oldName?: string;\n\n  /** The new name of the variable. */\n  newName?: string;\n\n  /**\n   * @param opt_variable The renamed variable. Undefined for a blank event.\n   * @param newName The new name the variable will be changed to.\n   */\n  constructor(opt_variable?: VariableModel, newName?: string) {\n    super(opt_variable);\n\n    if (!opt_variable) {\n      return;  // Blank event to be populated by fromJson.\n    }\n    this.oldName = opt_variable.name;\n    this.newName = typeof newName === 'undefined' ? '' : newName;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): VarRenameJson {\n    const json = super.toJson() as VarRenameJson;\n    if (!this.oldName) {\n      throw new Error(\n          'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newName) {\n      throw new Error(\n          'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    json['oldName'] = this.oldName;\n    json['newName'] = this.newName;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: VarRenameJson) {\n    deprecation.warn(\n        'Blockly.Events.VarRename.prototype.fromJson', 'version 9',\n        'version 10', 'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.oldName = json['oldName'];\n    this.newName = json['newName'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of VarRename, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: VarRenameJson, workspace: Workspace, event?: any):\n      VarRename {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new VarRename()) as VarRename;\n    newEvent.oldName = json['oldName'];\n    newEvent.newName = json['newName'];\n    return newEvent;\n  }\n\n  /**\n   * Run a variable rename event.\n   *\n   * @param forward True if run forward, false if run backward (undo).\n   */\n  override run(forward: boolean) {\n    const workspace = this.getEventWorkspace_();\n    if (!this.varId) {\n      throw new Error(\n          'The var ID is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.oldName) {\n      throw new Error(\n          'The old var name is undefined. Either pass a variable to ' +\n          'the constructor, or call fromJson');\n    }\n    if (!this.newName) {\n      throw new Error(\n          'The new var name is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (forward) {\n      workspace.renameVariableById(this.varId, this.newName);\n    } else {\n      workspace.renameVariableById(this.varId, this.oldName);\n    }\n  }\n}\n\nexport interface VarRenameJson extends VarBaseJson {\n  oldName: string;\n  newName: string;\n}\n\nregistry.register(registry.Type.EVENT, eventUtils.VAR_RENAME, VarRename);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Events fired as a result of a viewport change.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events.ViewportChange');\n\nimport * as deprecation from '../utils/deprecation.js';\nimport * as registry from '../registry.js';\nimport {AbstractEventJson} from './events_abstract.js';\nimport {UiBase} from './events_ui_base.js';\nimport * as eventUtils from './utils.js';\nimport type {Workspace} from '../workspace.js';\n\n\n/**\n * Notifies listeners that the workspace surface's position or scale has\n * changed.\n *\n * Does not notify when the workspace itself resizes.\n */\nexport class ViewportChange extends UiBase {\n  /**\n   * Top edge of the visible portion of the workspace, relative to the\n   * workspace origin.\n   */\n  viewTop?: number;\n\n  /**\n   * The left edge of the visible portion of the workspace, relative to\n   * the workspace origin.\n   */\n  viewLeft?: number;\n\n  /** The scale of the workpace. */\n  scale?: number;\n\n  /** The previous scale of the workspace. */\n  oldScale?: number;\n\n  override type = eventUtils.VIEWPORT_CHANGE;\n\n  /**\n   * @param opt_top Top-edge of the visible portion of the workspace, relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_left Left-edge of the visible portion of the workspace relative\n   *     to the workspace origin. Undefined for a blank event.\n   * @param opt_scale The scale of the workspace. Undefined for a blank event.\n   * @param opt_workspaceId The workspace identifier for this event.\n   *    Undefined for a blank event.\n   * @param opt_oldScale The old scale of the workspace. Undefined for a blank\n   *     event.\n   */\n  constructor(\n      opt_top?: number, opt_left?: number, opt_scale?: number,\n      opt_workspaceId?: string, opt_oldScale?: number) {\n    super(opt_workspaceId);\n\n    this.viewTop = opt_top;\n    this.viewLeft = opt_left;\n    this.scale = opt_scale;\n    this.oldScale = opt_oldScale;\n  }\n\n  /**\n   * Encode the event as JSON.\n   *\n   * @returns JSON representation.\n   */\n  override toJson(): ViewportChangeJson {\n    const json = super.toJson() as ViewportChangeJson;\n    if (this.viewTop === undefined) {\n      throw new Error(\n          'The view top is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.viewLeft === undefined) {\n      throw new Error(\n          'The view left is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.scale === undefined) {\n      throw new Error(\n          'The scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    if (this.oldScale === undefined) {\n      throw new Error(\n          'The old scale is undefined. Either pass a value to ' +\n          'the constructor, or call fromJson');\n    }\n    json['viewTop'] = this.viewTop;\n    json['viewLeft'] = this.viewLeft;\n    json['scale'] = this.scale;\n    json['oldScale'] = this.oldScale;\n    return json;\n  }\n\n  /**\n   * Decode the JSON event.\n   *\n   * @param json JSON representation.\n   */\n  override fromJson(json: ViewportChangeJson) {\n    deprecation.warn(\n        'Blockly.Events.Viewport.prototype.fromJson', 'version 9', 'version 10',\n        'Blockly.Events.fromJson');\n    super.fromJson(json);\n    this.viewTop = json['viewTop'];\n    this.viewLeft = json['viewLeft'];\n    this.scale = json['scale'];\n    this.oldScale = json['oldScale'];\n  }\n\n  /**\n   * Deserializes the JSON event.\n   *\n   * @param event The event to append new properties to. Should be a subclass\n   *     of Viewport, but we can't specify that due to the fact that parameters\n   *     to static methods in subclasses must be supertypes of parameters to\n   *     static methods in superclasses.\n   * @internal\n   */\n  static fromJson(json: ViewportChangeJson, workspace: Workspace, event?: any):\n      ViewportChange {\n    const newEvent =\n        super.fromJson(json, workspace, event ?? new ViewportChange()) as\n        ViewportChange;\n    newEvent.viewTop = json['viewTop'];\n    newEvent.viewLeft = json['viewLeft'];\n    newEvent.scale = json['scale'];\n    newEvent.oldScale = json['oldScale'];\n    return newEvent;\n  }\n}\n\nexport interface ViewportChangeJson extends AbstractEventJson {\n  viewTop: number;\n  viewLeft: number;\n  scale: number;\n  oldScale: number;\n}\n\nregistry.register(\n    registry.Type.EVENT, eventUtils.VIEWPORT_CHANGE, ViewportChange);\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Events');\n\n\nimport {Abstract, AbstractEventJson} from './events_abstract.js';\nimport {BlockBase, BlockBaseJson} from './events_block_base.js';\nimport {BlockChange, BlockChangeJson} from './events_block_change.js';\nimport {BlockCreate, BlockCreateJson} from './events_block_create.js';\nimport {BlockDelete, BlockDeleteJson} from './events_block_delete.js';\nimport {BlockDrag, BlockDragJson} from './events_block_drag.js';\nimport {BlockMove, BlockMoveJson} from './events_block_move.js';\nimport {BubbleOpen, BubbleOpenJson, BubbleType} from './events_bubble_open.js';\nimport {Click, ClickJson, ClickTarget} from './events_click.js';\nimport {CommentBase, CommentBaseJson} from './events_comment_base.js';\nimport {CommentChange, CommentChangeJson} from './events_comment_change.js';\nimport {CommentCreate, CommentCreateJson} from './events_comment_create.js';\nimport {CommentDelete} from './events_comment_delete.js';\nimport {CommentMove, CommentMoveJson} from './events_comment_move.js';\nimport {MarkerMove, MarkerMoveJson} from './events_marker_move.js';\nimport {Selected, SelectedJson} from './events_selected.js';\nimport {ThemeChange, ThemeChangeJson} from './events_theme_change.js';\nimport {ToolboxItemSelect, ToolboxItemSelectJson} from './events_toolbox_item_select.js';\nimport {TrashcanOpen, TrashcanOpenJson} from './events_trashcan_open.js';\nimport {Ui} from './events_ui.js';\nimport {UiBase} from './events_ui_base.js';\nimport {VarBase, VarBaseJson} from './events_var_base.js';\nimport {VarCreate, VarCreateJson} from './events_var_create.js';\nimport {VarDelete, VarDeleteJson} from './events_var_delete.js';\nimport {VarRename, VarRenameJson} from './events_var_rename.js';\nimport {ViewportChange, ViewportChangeJson} from './events_viewport.js';\nimport * as eventUtils from './utils.js';\nimport {FinishedLoading, FinishedLoadingJson} from './workspace_events.js';\n\n\n// Events.\nexport {Abstract};\nexport {AbstractEventJson};\nexport {BubbleOpen};\nexport {BubbleOpenJson};\nexport {BubbleType};\nexport {BlockBase};\nexport {BlockBaseJson};\nexport {BlockChange};\nexport {BlockChangeJson};\nexport {BlockCreate};\nexport {BlockCreateJson};\nexport {BlockDelete};\nexport {BlockDeleteJson};\nexport {BlockDrag};\nexport {BlockDragJson};\nexport {BlockMove};\nexport {BlockMoveJson};\nexport {Click};\nexport {ClickJson};\nexport {ClickTarget};\nexport {CommentBase};\nexport {CommentBaseJson};\nexport {CommentChange};\nexport {CommentChangeJson};\nexport {CommentCreate};\nexport {CommentCreateJson};\nexport {CommentDelete};\nexport {CommentMove};\nexport {CommentMoveJson};\nexport {FinishedLoading};\nexport {FinishedLoadingJson};\nexport {MarkerMove};\nexport {MarkerMoveJson};\nexport {Selected};\nexport {SelectedJson};\nexport {ThemeChange};\nexport {ThemeChangeJson};\nexport {ToolboxItemSelect};\nexport {ToolboxItemSelectJson};\nexport {TrashcanOpen};\nexport {TrashcanOpenJson};\nexport {Ui};\nexport {UiBase};\nexport {VarBase};\nexport {VarBaseJson};\nexport {VarCreate};\nexport {VarCreateJson};\nexport {VarDelete};\nexport {VarDeleteJson};\nexport {VarRename};\nexport {VarRenameJson};\nexport {ViewportChange};\nexport {ViewportChangeJson};\n\n// Event types.\nexport const BLOCK_CHANGE = eventUtils.BLOCK_CHANGE;\nexport const BLOCK_CREATE = eventUtils.BLOCK_CREATE;\nexport const BLOCK_DELETE = eventUtils.BLOCK_DELETE;\nexport const BLOCK_DRAG = eventUtils.BLOCK_DRAG;\nexport const BLOCK_MOVE = eventUtils.BLOCK_MOVE;\nexport const BUBBLE_OPEN = eventUtils.BUBBLE_OPEN;\nexport type BumpEvent = eventUtils.BumpEvent;\nexport const BUMP_EVENTS = eventUtils.BUMP_EVENTS;\nexport const CHANGE = eventUtils.CHANGE;\nexport const CLICK = eventUtils.CLICK;\nexport const COMMENT_CHANGE = eventUtils.COMMENT_CHANGE;\nexport const COMMENT_CREATE = eventUtils.COMMENT_CREATE;\nexport const COMMENT_DELETE = eventUtils.COMMENT_DELETE;\nexport const COMMENT_MOVE = eventUtils.COMMENT_MOVE;\nexport const CREATE = eventUtils.CREATE;\nexport const DELETE = eventUtils.DELETE;\nexport const FINISHED_LOADING = eventUtils.FINISHED_LOADING;\nexport const MARKER_MOVE = eventUtils.MARKER_MOVE;\nexport const MOVE = eventUtils.MOVE;\nexport const SELECTED = eventUtils.SELECTED;\nexport const THEME_CHANGE = eventUtils.THEME_CHANGE;\nexport const TOOLBOX_ITEM_SELECT = eventUtils.TOOLBOX_ITEM_SELECT;\nexport const TRASHCAN_OPEN = eventUtils.TRASHCAN_OPEN;\nexport const UI = eventUtils.UI;\nexport const VAR_CREATE = eventUtils.VAR_CREATE;\nexport const VAR_DELETE = eventUtils.VAR_DELETE;\nexport const VAR_RENAME = eventUtils.VAR_RENAME;\nexport const VIEWPORT_CHANGE = eventUtils.VIEWPORT_CHANGE;\n\n// Event utils.\nexport const clearPendingUndo = eventUtils.clearPendingUndo;\nexport const disable = eventUtils.disable;\nexport const enable = eventUtils.enable;\nexport const filter = eventUtils.filter;\nexport const fire = eventUtils.fire;\nexport const fromJson = eventUtils.fromJson;\nexport const getDescendantIds = eventUtils.getDescendantIds;\nexport const get = eventUtils.get;\nexport const getGroup = eventUtils.getGroup;\nexport const getRecordUndo = eventUtils.getRecordUndo;\nexport const isEnabled = eventUtils.isEnabled;\nexport const setGroup = eventUtils.setGroup;\nexport const setRecordUndo = eventUtils.setRecordUndo;\nexport const disableOrphans = eventUtils.disableOrphans;\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component with custom behaviour when a\n * block or bubble is dragged over or dropped on top of it.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.DragTarget');\n\nimport type {IDragTarget} from './interfaces/i_drag_target.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {Rect} from './utils/rect.js';\n\n\n/**\n * Abstract class for a component with custom behaviour when a block or bubble\n * is dragged over or dropped on top of it.\n */\nexport class DragTarget implements IDragTarget {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  id!: string;\n\n  /**\n   * Constructor for DragTarget. It exists to add the id property and should not\n   * be called directly, only by a subclass.\n   */\n  constructor() {}\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragEnter(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragOver(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDragExit(_dragElement: IDraggable) {}\n  // no-op\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  onDrop(_dragElement: IDraggable) {}\n  // no-op\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to the Blockly injection div.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  getClientRect(): Rect|null {\n    return null;\n  }\n\n  /**\n   * Returns whether the provided block or bubble should not be moved after\n   * being dropped on this component. If true, the element will return to where\n   * it was when the drag started.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   * @returns Whether the block or bubble provided should be returned to drag\n   *     start.\n   */\n  shouldPreventMove(_dragElement: IDraggable): boolean {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The abstract class for a component that can delete a block or\n * bubble that is dropped on top of it.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.DeleteArea');\n\nimport {BlockSvg} from './block_svg.js';\nimport {DragTarget} from './drag_target.js';\nimport type {IDeleteArea} from './interfaces/i_delete_area.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\n\n\n/**\n * Abstract class for a component that can delete a block or bubble that is\n * dropped on top of it.\n */\nexport class DeleteArea extends DragTarget implements IDeleteArea {\n  /**\n   * Whether the last block or bubble dragged over this delete area would be\n   * deleted if dropped on this component.\n   * This property is not updated after the block or bubble is deleted.\n   */\n  protected wouldDelete_ = false;\n\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override id!: string;\n\n  /**\n   * Constructor for DeleteArea. Should not be called directly, only by a\n   * subclass.\n   */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  wouldDelete(element: IDraggable, couldConnect: boolean): boolean {\n    if (element instanceof BlockSvg) {\n      const block = (element);\n      const couldDeleteBlock = !block.getParent() && block.isDeletable();\n      this.updateWouldDelete_(couldDeleteBlock && !couldConnect);\n    } else {\n      this.updateWouldDelete_(element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected updateWouldDelete_(wouldDelete: boolean) {\n    this.wouldDelete_ = wouldDelete;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldInput');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as dialog from './dialog.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport {Field, FieldConfig, FieldValidator, UnattachedFieldError} from './field.js';\nimport {Msg} from './msg.js';\nimport * as aria from './utils/aria.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n/**\n * Supported types for FieldInput subclasses.\n *\n * @internal\n */\ntype InputTypes = string|number;\n\n/**\n * Abstract class for an editable input field.\n *\n * @typeParam T - The value stored on the field.\n * @internal\n */\nexport abstract class FieldInput<T extends InputTypes> extends Field<string|T> {\n  /**\n   * Pixel size of input border radius.\n   * Should match blocklyText's border-radius in CSS.\n   */\n  static BORDERRADIUS = 4;\n\n  /** Allow browser to spellcheck this field. */\n  protected spellcheck_ = true;\n\n  /** The HTML input element. */\n  protected htmlInput_: HTMLInputElement|null = null;\n\n  /** True if the field's value is currently being edited via the UI. */\n  protected isBeingEdited_ = false;\n\n  /**\n   * True if the value currently displayed in the field's editory UI is valid.\n   */\n  protected isTextValid_ = false;\n\n  /** Key down event data. */\n  private onKeyDownWrapper_: browserEvents.Data|null = null;\n\n  /** Key input event data. */\n  private onKeyInputWrapper_: browserEvents.Data|null = null;\n\n  /**\n   * Whether the field should consider the whole parent block to be its click\n   * target.\n   */\n  fullBlockClickTarget_: boolean|null = false;\n\n  /** The workspace that this field belongs to. */\n  protected workspace_: WorkspaceSvg|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'text';\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|typeof Field.SKIP_SETUP,\n      validator?: FieldInputValidator<T>|null, config?: FieldInputConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  protected override configure_(config: FieldInputConfig) {\n    super.configure_(config);\n    if (config.spellcheck !== undefined) {\n      this.spellcheck_ = config.spellcheck;\n    }\n  }\n\n  /** @internal */\n  override initView() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.getConstants()!.FULL_BLOCK_FIELDS) {\n      // Step one: figure out if this is the only field on this block.\n      // Rendering is quite different in that case.\n      let nFields = 0;\n      let nConnections = 0;\n      // Count the number of fields, excluding text fields\n      for (let i = 0, input; input = block.inputList[i]; i++) {\n        for (let j = 0; input.fieldRow[j]; j++) {\n          nFields++;\n        }\n        if (input.connection) {\n          nConnections++;\n        }\n      }\n      // The special case is when this is the only non-label field on the block\n      // and it has an output but no inputs.\n      this.fullBlockClickTarget_ =\n          nFields <= 1 && block.outputConnection && !nConnections;\n    } else {\n      this.fullBlockClickTarget_ = false;\n    }\n\n    if (this.fullBlockClickTarget_) {\n      this.clickTarget_ = (this.sourceBlock_ as BlockSvg).getSvgRoot();\n    } else {\n      this.createBorderRect_();\n    }\n    this.createTextElement_();\n  }\n\n  /**\n   * Called by setValue if the text input is not valid. If the field is\n   * currently being edited it reverts value of the field to the previous\n   * value while allowing the display text to be handled by the htmlInput_.\n   *\n   * @param _invalidValue The input value that was determined to be invalid.\n   *    This is not used by the text input because its display value is stored\n   * on the htmlInput_.\n   */\n  protected override doValueInvalid_(_invalidValue: AnyDuringMigration) {\n    if (this.isBeingEdited_) {\n      this.isDirty_ = true;\n      this.isTextValid_ = false;\n      const oldValue = this.value_;\n      // Revert value when the text becomes invalid.\n      this.value_ = this.htmlInput_!.getAttribute('data-untyped-default-value');\n      if (this.sourceBlock_ && eventUtils.isEnabled()) {\n        eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CHANGE))(\n            this.sourceBlock_, 'field', this.name || null, oldValue,\n            this.value_));\n      }\n    }\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_).\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string|T) {\n    this.isDirty_ = true;\n    this.isTextValid_ = true;\n    this.value_ = newValue;\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   *\n   * @internal\n   */\n  override applyColour() {\n    if (!this.sourceBlock_ || !this.getConstants()!.FULL_BLOCK_FIELDS) return;\n\n    const source = this.sourceBlock_ as BlockSvg;\n\n    if (this.borderRect_) {\n      this.borderRect_.setAttribute('stroke', source.style.colourTertiary);\n    } else {\n      source.pathObject.svgPath.setAttribute(\n          'fill', this.getConstants()!.FIELD_BORDER_RECT_COLOUR);\n    }\n  }\n\n  /**\n   * Updates the colour of the htmlInput given the current validity of the\n   * field's value.\n   */\n  protected override render_() {\n    super.render_();\n    // This logic is done in render_ rather than doValueInvalid_ or\n    // doValueUpdate_ so that the code is more centralized.\n    if (this.isBeingEdited_) {\n      this.resizeEditor_();\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n  }\n\n  /**\n   * Set whether this field is spellchecked by the browser.\n   *\n   * @param check True if checked.\n   */\n  setSpellcheck(check: boolean) {\n    if (check === this.spellcheck_) {\n      return;\n    }\n    this.spellcheck_ = check;\n    if (this.htmlInput_) {\n      // AnyDuringMigration because:  Argument of type 'boolean' is not\n      // assignable to parameter of type 'string'.\n      this.htmlInput_.setAttribute(\n          'spellcheck', this.spellcheck_ as AnyDuringMigration);\n    }\n  }\n\n  /**\n   * Show an editor for the field.\n   * Shows the inline free-text editor on top of the text by default.\n   * Shows a prompt editor for mobile browsers if the modalInputs option is\n   * enabled.\n   *\n   * @param _e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  protected override showEditor_(_e?: Event, quietInput = false) {\n    this.workspace_ = (this.sourceBlock_ as BlockSvg).workspace;\n    if (!quietInput && this.workspace_.options.modalInputs &&\n        (userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD)) {\n      this.showPromptEditor_();\n    } else {\n      this.showInlineEditor_(quietInput);\n    }\n  }\n\n  /**\n   * Create and show a text input editor that is a prompt (usually a popup).\n   * Mobile browsers may have issues with in-line textareas (focus and\n   * keyboards).\n   */\n  private showPromptEditor_() {\n    dialog.prompt(\n        Msg['CHANGE_VALUE_TITLE'], this.getText(), (text: string|null) => {\n          // Text is null if user pressed cancel button.\n          if (text !== null) {\n            this.setValue(this.getValueFromEditorText_(text));\n          }\n        });\n  }\n\n  /**\n   * Create and show a text input editor that sits directly over the text input.\n   *\n   * @param quietInput True if editor should be created without focus.\n   */\n  private showInlineEditor_(quietInput: boolean) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    WidgetDiv.show(this, block.RTL, this.widgetDispose_.bind(this));\n    this.htmlInput_ = this.widgetCreate_() as HTMLInputElement;\n    this.isBeingEdited_ = true;\n\n    if (!quietInput) {\n      (this.htmlInput_ as HTMLElement).focus({\n        preventScroll: true,\n      });\n      this.htmlInput_.select();\n    }\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected widgetCreate_(): HTMLElement {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    eventUtils.setGroup(true);\n    const div = WidgetDiv.getDiv();\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.addClass(clickTarget, 'editing');\n\n    const htmlInput = (document.createElement('input'));\n    htmlInput.className = 'blocklyHtmlInput';\n    // AnyDuringMigration because:  Argument of type 'boolean' is not assignable\n    // to parameter of type 'string'.\n    htmlInput.setAttribute(\n        'spellcheck', this.spellcheck_ as AnyDuringMigration);\n    const scale = this.workspace_!.getScale();\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    let borderRadius = FieldInput.BORDERRADIUS * scale + 'px';\n\n    if (this.fullBlockClickTarget_) {\n      const bBox = this.getScaledBBox();\n\n      // Override border radius.\n      borderRadius = (bBox.bottom - bBox.top) / 2 + 'px';\n      // Pull stroke colour from the existing shadow block\n      const strokeColour = block.getParent() ?\n          (block.getParent() as BlockSvg).style.colourTertiary :\n          (this.sourceBlock_ as BlockSvg).style.colourTertiary;\n      htmlInput.style.border = 1 * scale + 'px solid ' + strokeColour;\n      div!.style.borderRadius = borderRadius;\n      div!.style.transition = 'box-shadow 0.25s ease 0s';\n      if (this.getConstants()!.FIELD_TEXTINPUT_BOX_SHADOW) {\n        div!.style.boxShadow =\n            'rgba(255, 255, 255, 0.3) 0 0 0 ' + (4 * scale) + 'px';\n      }\n    }\n    htmlInput.style.borderRadius = borderRadius;\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\n\n    this.resizeEditor_();\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Closes the editor, saves the results, and disposes of any events or\n   * DOM-references belonging to the editor.\n   */\n  protected widgetDispose_() {\n    // Non-disposal related things that we do when the editor closes.\n    this.isBeingEdited_ = false;\n    this.isTextValid_ = true;\n    // Make sure the field's node matches the field's internal value.\n    this.forceRerender();\n    this.onFinishEditing_(this.value_);\n    eventUtils.setGroup(false);\n\n    // Actual disposal.\n    this.unbindInputEvents_();\n    const style = WidgetDiv.getDiv()!.style;\n    style.width = 'auto';\n    style.height = 'auto';\n    style.fontSize = '';\n    style.transition = '';\n    style.boxShadow = '';\n    this.htmlInput_ = null;\n\n    const clickTarget = this.getClickTarget_();\n    if (!clickTarget) throw new Error('A click target has not been set.');\n    dom.removeClass(clickTarget, 'editing');\n  }\n\n  /**\n   * A callback triggered when the user is done editing the field via the UI.\n   *\n   * @param _value The new value of the field.\n   */\n  onFinishEditing_(_value: AnyDuringMigration) {}\n  // NOP by default.\n  // TODO(#2496): Support people passing a func into the field.\n\n  /**\n   * Bind handlers for user input on the text input field's editor.\n   *\n   * @param htmlInput The htmlInput to which event handlers will be bound.\n   */\n  protected bindInputEvents_(htmlInput: HTMLElement) {\n    // Trap Enter without IME and Esc to hide.\n    this.onKeyDownWrapper_ = browserEvents.conditionalBind(\n        htmlInput, 'keydown', this, this.onHtmlInputKeyDown_);\n    // Resize after every input change.\n    this.onKeyInputWrapper_ = browserEvents.conditionalBind(\n        htmlInput, 'input', this, this.onHtmlInputChange_);\n  }\n\n  /** Unbind handlers for user input and workspace size changes. */\n  protected unbindInputEvents_() {\n    if (this.onKeyDownWrapper_) {\n      browserEvents.unbind(this.onKeyDownWrapper_);\n      this.onKeyDownWrapper_ = null;\n    }\n    if (this.onKeyInputWrapper_) {\n      browserEvents.unbind(this.onKeyInputWrapper_);\n      this.onKeyInputWrapper_ = null;\n    }\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected onHtmlInputKeyDown_(e: KeyboardEvent) {\n    if (e.key === 'Enter') {\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Escape') {\n      this.setValue(\n          this.htmlInput_!.getAttribute('data-untyped-default-value'));\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    } else if (e.key === 'Tab') {\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n      (this.sourceBlock_ as BlockSvg).tab(this, !e.shiftKey);\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a change to the editor.\n   *\n   * @param _e Keyboard event.\n   */\n  private onHtmlInputChange_(_e: Event) {\n    this.setValue(this.getValueFromEditorText_(this.htmlInput_!.value));\n  }\n\n  /**\n   * Set the HTML input value and the field's internal value. The difference\n   * between this and `setValue` is that this also updates the HTML input\n   * value whilst editing.\n   *\n   * @param newValue New value.\n   */\n  protected setEditorValue_(newValue: AnyDuringMigration) {\n    this.isDirty_ = true;\n    if (this.isBeingEdited_) {\n      // In the case this method is passed an invalid value, we still\n      // pass it through the transformation method `getEditorText` to deal\n      // with. Otherwise, the internal field's state will be inconsistent\n      // with what's shown to the user.\n      this.htmlInput_!.value = this.getEditorText_(newValue);\n    }\n    this.setValue(newValue);\n  }\n\n  /** Resize the editor to fit the text. */\n  protected resizeEditor_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const div = WidgetDiv.getDiv();\n    const bBox = this.getScaledBBox();\n    div!.style.width = bBox.right - bBox.left + 'px';\n    div!.style.height = bBox.bottom - bBox.top + 'px';\n\n    // In RTL mode block fields and LTR input fields the left edge moves,\n    // whereas the right edge is fixed.  Reposition the editor.\n    const x = block.RTL ? bBox.right - div!.offsetWidth : bBox.left;\n    const xy = new Coordinate(x, bBox.top);\n\n    div!.style.left = xy.x + 'px';\n    div!.style.top = xy.y + 'px';\n  }\n\n  /**\n   * Returns whether or not the field is tab navigable.\n   *\n   * @returns True if the field is tab navigable.\n   */\n  override isTabNavigable(): boolean {\n    return true;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation. When we're currently editing, return the current HTML value\n   * instead. Otherwise, return null which tells the field to use the default\n   * behaviour (which is a string cast of the field's value).\n   *\n   * @returns The HTML value if we're editing, otherwise null.\n   */\n  protected override getText_(): string|null {\n    if (this.isBeingEdited_ && this.htmlInput_) {\n      // We are currently editing, return the HTML input value instead.\n      return this.htmlInput_.value;\n    }\n    return null;\n  }\n\n  /**\n   * Transform the provided value into a text to show in the HTML input.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getValueFromEditorText_`.\n   *\n   * @param value The value stored in this field.\n   * @returns The text to show on the HTML input.\n   */\n  protected getEditorText_(value: AnyDuringMigration): string {\n    return `${value}`;\n  }\n\n  /**\n   * Transform the text received from the HTML input into a value to store\n   * in this field.\n   * Override this method if the field's HTML input representation is different\n   * than the field's value. This should be coupled with an override of\n   * `getEditorText_`.\n   *\n   * @param text Text received from the HTML input.\n   * @returns The value to store.\n   */\n  protected getValueFromEditorText_(text: string): AnyDuringMigration {\n    return text;\n  }\n}\n\n/**\n * Config options for the input field.\n *\n * @internal\n */\nexport interface FieldInputConfig extends FieldConfig {\n  spellcheck?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n * @internal\n */\nexport type FieldInputValidator<T extends InputTypes> =\n    FieldValidator<string|T>;\n", "/**\n * @license\n * Copyright 2013 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Angle input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldAngle');\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldInput, FieldInputConfig, FieldInputValidator} from './field_input.js';\nimport * as dom from './utils/dom.js';\nimport * as math from './utils/math.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for an editable angle field.\n */\nexport class FieldAngle extends FieldInput<number> {\n  /** Half the width of protractor image. */\n  static readonly HALF = 100 / 2;\n\n  /**\n   * Radius of protractor circle.  Slightly smaller than protractor size since\n   * otherwise SVG crops off half the border at the edges.\n   */\n  static readonly RADIUS: number = FieldAngle.HALF - 1;\n\n  /**\n   * Default property describing which direction makes an angle field's value\n   * increase. Angle increases clockwise (true) or counterclockwise (false).\n   */\n  static readonly CLOCKWISE = false;\n\n  /**\n   * The default offset of 0 degrees (and all angles). Always offsets in the\n   * counterclockwise direction, regardless of the field's clockwise property.\n   * Usually either 0 (0 = right) or 90 (0 = up).\n   */\n  static readonly OFFSET = 0;\n\n  /**\n   * The default maximum angle to allow before wrapping.\n   * Usually either 360 (for 0 to 359.9) or 180 (for -179.9 to 180).\n   */\n  static readonly WRAP = 360;\n\n  /**\n   * The default amount to round angles to when using a mouse or keyboard nav\n   * input. Must be a positive integer to support keyboard navigation.\n   */\n  static readonly ROUND = 15;\n\n  /**\n   * Whether the angle should increase as the angle picker is moved clockwise\n   * (true) or counterclockwise (false).\n   */\n  private clockwise = FieldAngle.CLOCKWISE;\n\n  /**\n   * The offset of zero degrees (and all other angles).\n   */\n  private offset = FieldAngle.OFFSET;\n\n  /**\n   * The maximum angle to allow before wrapping.\n   */\n  private wrap = FieldAngle.WRAP;\n\n  /**\n   * The amount to round angles to when using a mouse or keyboard nav input.\n   */\n  private round = FieldAngle.ROUND;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** Dynamic red line pointing at the value's angle. */\n  private line: SVGLineElement|null = null;\n\n  /** Dynamic pink area extending from 0 to the value's angle. */\n  private gauge: SVGPathElement|null = null;\n\n  /** The degree symbol for this field. */\n  protected symbol_: SVGTSpanElement|null = null;\n\n  /**\n   * @param value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/angle#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|number|typeof Field.SKIP_SETUP,\n      validator?: FieldAngleValidator, config?: FieldAngleConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldAngleConfig) {\n    super.configure_(config);\n\n    switch (config.mode) {\n      case Mode.COMPASS:\n        this.clockwise = true;\n        this.offset = 90;\n        break;\n      case Mode.PROTRACTOR:\n        // This is the default mode, so we could do nothing. But just to\n        // future-proof, we'll set it anyway.\n        this.clockwise = false;\n        this.offset = 0;\n        break;\n    }\n\n    // Allow individual settings to override the mode setting.\n    if (config.clockwise) this.clockwise = config.clockwise;\n    if (config.offset) this.offset = config.offset;\n    if (config.wrap) this.wrap = config.wrap;\n    if (config.round) this.round = config.round;\n  }\n\n  /**\n   * Create the block UI for this field.\n   *\n   * @internal\n   */\n  override initView() {\n    super.initView();\n    // Add the degree symbol to the left of the number,\n    // even in RTL (issue #2380).\n    this.symbol_ = dom.createSvgElement(Svg.TSPAN, {});\n    this.symbol_.appendChild(document.createTextNode(''));\n    this.getTextElement().appendChild(this.symbol_);\n  }\n\n  /** Updates the angle when the field rerenders. */\n  protected override render_() {\n    super.render_();\n    this.updateGraph();\n  }\n\n  /**\n   * Create and show the angle field's editor.\n   *\n   * @param e Optional mouse event that triggered the field to open,\n   *     or undefined if triggered programmatically.\n   */\n  protected override showEditor_(e?: Event) {\n    // Mobile browsers have issues with in-line textareas (focus & keyboards).\n    const noFocus = userAgent.MOBILE || userAgent.ANDROID || userAgent.IPAD;\n    super.showEditor_(e, noFocus);\n\n    const editor = this.dropdownCreate();\n    dropDownDiv.getContentDiv().appendChild(editor);\n\n    if (this.sourceBlock_ instanceof BlockSvg) {\n      dropDownDiv.setColour(\n          this.sourceBlock_.style.colourPrimary,\n          this.sourceBlock_.style.colourTertiary);\n    }\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose.bind(this));\n\n    this.updateGraph();\n  }\n\n  /**\n   * Creates the angle dropdown editor.\n   *\n   * @returns The newly created slider.\n   */\n  private dropdownCreate(): SVGSVGElement {\n    const svg = dom.createSvgElement(Svg.SVG, {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'height': FieldAngle.HALF * 2 + 'px',\n      'width': FieldAngle.HALF * 2 + 'px',\n      'style': 'touch-action: none',\n    });\n    const circle = dom.createSvgElement(\n        Svg.CIRCLE, {\n          'cx': FieldAngle.HALF,\n          'cy': FieldAngle.HALF,\n          'r': FieldAngle.RADIUS,\n          'class': 'blocklyAngleCircle',\n        },\n        svg);\n    this.gauge =\n        dom.createSvgElement(Svg.PATH, {'class': 'blocklyAngleGauge'}, svg);\n    this.line = dom.createSvgElement(\n        Svg.LINE, {\n          'x1': FieldAngle.HALF,\n          'y1': FieldAngle.HALF,\n          'class': 'blocklyAngleLine',\n        },\n        svg);\n    // Draw markers around the edge.\n    for (let angle = 0; angle < 360; angle += 15) {\n      dom.createSvgElement(\n          Svg.LINE, {\n            'x1': FieldAngle.HALF + FieldAngle.RADIUS,\n            'y1': FieldAngle.HALF,\n            'x2': FieldAngle.HALF + FieldAngle.RADIUS -\n                (angle % 45 === 0 ? 10 : 5),\n            'y2': FieldAngle.HALF,\n            'class': 'blocklyAngleMarks',\n            'transform': 'rotate(' + angle + ',' + FieldAngle.HALF + ',' +\n                FieldAngle.HALF + ')',\n          },\n          svg);\n    }\n\n    // The angle picker is different from other fields in that it updates on\n    // mousemove even if it's not in the middle of a drag.  In future we may\n    // change this behaviour.\n    this.boundEvents.push(\n        browserEvents.conditionalBind(svg, 'click', this, this.hide));\n    // On touch devices, the picker's value is only updated with a drag. Add\n    // a click handler on the drag surface to update the value if the surface\n    // is clicked.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        circle, 'pointerdown', this, this.onMouseMove_, true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        circle, 'pointermove', this, this.onMouseMove_, true));\n    return svg;\n  }\n\n  /** Disposes of events and DOM-references belonging to the angle editor. */\n  private dropdownDispose() {\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    this.gauge = null;\n    this.line = null;\n  }\n\n  /** Hide the editor. */\n  private hide() {\n    dropDownDiv.hideIfOwner(this);\n    WidgetDiv.hide();\n  }\n\n  /**\n   * Set the angle to match the mouse's position.\n   *\n   * @param e Mouse move event.\n   */\n  protected onMouseMove_(e: PointerEvent) {\n    // Calculate angle.\n    const bBox = this.gauge!.ownerSVGElement!.getBoundingClientRect();\n    const dx = e.clientX - bBox.left - FieldAngle.HALF;\n    const dy = e.clientY - bBox.top - FieldAngle.HALF;\n    let angle = Math.atan(-dy / dx);\n    if (isNaN(angle)) {\n      // This shouldn't happen, but let's not let this error propagate further.\n      return;\n    }\n    angle = math.toDegrees(angle);\n    // 0: East, 90: North, 180: West, 270: South.\n    if (dx < 0) {\n      angle += 180;\n    } else if (dy > 0) {\n      angle += 360;\n    }\n\n    // Do offsetting.\n    if (this.clockwise) {\n      angle = this.offset + 360 - angle;\n    } else {\n      angle = 360 - (this.offset - angle);\n    }\n\n    this.displayMouseOrKeyboardValue(angle);\n  }\n\n  /**\n   * Handles and displays values that are input via mouse or arrow key input.\n   * These values need to be rounded and wrapped before being displayed so\n   * that the text input's value is appropriate.\n   *\n   * @param angle New angle.\n   */\n  private displayMouseOrKeyboardValue(angle: number) {\n    if (this.round) {\n      angle = Math.round(angle / this.round) * this.round;\n    }\n    angle = this.wrapValue(angle);\n    if (angle !== this.value_) {\n      this.setEditorValue_(angle);\n    }\n  }\n\n  /** Redraw the graph with the current angle. */\n  private updateGraph() {\n    if (!this.gauge || !this.line) {\n      return;\n    }\n    // Always display the input (i.e. getText) even if it is invalid.\n    let angleDegrees = Number(this.getText()) + this.offset;\n    angleDegrees %= 360;\n    let angleRadians = math.toRadians(angleDegrees);\n    const path = ['M ', FieldAngle.HALF, ',', FieldAngle.HALF];\n    let x2 = FieldAngle.HALF;\n    let y2 = FieldAngle.HALF;\n    if (!isNaN(angleRadians)) {\n      const clockwiseFlag = Number(this.clockwise);\n      const angle1 = math.toRadians(this.offset);\n      const x1 = Math.cos(angle1) * FieldAngle.RADIUS;\n      const y1 = Math.sin(angle1) * -FieldAngle.RADIUS;\n      if (clockwiseFlag) {\n        angleRadians = 2 * angle1 - angleRadians;\n      }\n      x2 += Math.cos(angleRadians) * FieldAngle.RADIUS;\n      y2 -= Math.sin(angleRadians) * FieldAngle.RADIUS;\n      // Don't ask how the flag calculations work.  They just do.\n      let largeFlag =\n          Math.abs(Math.floor((angleRadians - angle1) / Math.PI) % 2);\n      if (clockwiseFlag) {\n        largeFlag = 1 - largeFlag;\n      }\n      path.push(\n          ' l ', x1, ',', y1, ' A ', FieldAngle.RADIUS, ',', FieldAngle.RADIUS,\n          ' 0 ', largeFlag, ' ', clockwiseFlag, ' ', x2, ',', y2, ' z');\n    }\n    this.gauge.setAttribute('d', path.join(''));\n    this.line.setAttribute('x2', `${x2}`);\n    this.line.setAttribute('y2', `${y2}`);\n  }\n\n  /**\n   * Handle key down to the editor.\n   *\n   * @param e Keyboard event.\n   */\n  protected override onHtmlInputKeyDown_(e: KeyboardEvent) {\n    super.onHtmlInputKeyDown_(e);\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n\n    let multiplier = 0;\n    switch (e.key) {\n      case 'ArrowLeft':\n        // decrement (increment in RTL)\n        multiplier = block.RTL ? 1 : -1;\n        break;\n      case 'ArrowRight':\n        // increment (decrement in RTL)\n        multiplier = block.RTL ? -1 : 1;\n        break;\n      case 'ArrowDown':\n        // decrement\n        multiplier = -1;\n        break;\n      case 'ArrowUp':\n        // increment\n        multiplier = 1;\n        break;\n    }\n    if (multiplier) {\n      const value = this.getValue() as number;\n      this.displayMouseOrKeyboardValue(value + multiplier * this.round);\n      e.preventDefault();\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Ensure that the input value is a valid angle.\n   *\n   * @param newValue The input value.\n   * @returns A valid angle, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): number|null {\n    const value = Number(newValue);\n    if (isNaN(value) || !isFinite(value)) {\n      return null;\n    }\n    return this.wrapValue(value);\n  }\n\n  /**\n   * Wraps the value so that it is in the range (-360 + wrap, wrap).\n   *\n   * @param value The value to wrap.\n   * @returns The wrapped value.\n   */\n  private wrapValue(value: number): number {\n    value %= 360;\n    if (value < 0) {\n      value += 360;\n    }\n    if (value > this.wrap) {\n      value -= 360;\n    }\n    return value;\n  }\n\n  /**\n   * Construct a FieldAngle from a JSON arg object.\n   *\n   * @param options A JSON object with options (angle).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldAngleFromJsonConfig): FieldAngle {\n    // `this` might be a subclass of FieldAngle if that class doesn't override\n    // the static fromJson method.\n    return new this(options.angle, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_angle', FieldAngle);\n\nFieldAngle.prototype.DEFAULT_VALUE = 0;\n\n\n/**\n * CSS for angle field.\n */\nCss.register(`\n.blocklyAngleCircle {\n  stroke: #444;\n  stroke-width: 1;\n  fill: #ddd;\n  fill-opacity: 0.8;\n}\n\n.blocklyAngleMarks {\n  stroke: #444;\n  stroke-width: 1;\n}\n\n.blocklyAngleGauge {\n  fill: #f88;\n  fill-opacity: 0.8;\n  pointer-events: none;\n}\n\n.blocklyAngleLine {\n  stroke: #f00;\n  stroke-width: 2;\n  stroke-linecap: round;\n  pointer-events: none;\n}\n`);\n\n/**\n * The two main modes of the angle field.\n * Compass specifies:\n *   - clockwise: true\n *   - offset: 90\n *   - wrap: 0\n *   - round: 15\n *\n * Protractor specifies:\n *   - clockwise: false\n *   - offset: 0\n *   - wrap: 0\n *   - round: 15\n */\nexport enum Mode {\n  COMPASS = 'compass',\n  PROTRACTOR = 'protractor',\n}\n\n/**\n * Extra configuration options for the angle field.\n */\nexport interface FieldAngleConfig extends FieldInputConfig {\n  mode?: Mode;\n  clockwise?: boolean;\n  offset?: number;\n  wrap?: number;\n  round?: number;\n}\n\n/**\n * fromJson configuration options for the angle field.\n */\nexport interface FieldAngleFromJsonConfig extends FieldAngleConfig {\n  angle?: number;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldAngleValidator = FieldInputValidator<number>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Checkbox field.  Checked or not checked.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldCheckbox');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport * as dom from './utils/dom.js';\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\n\ntype BoolString = 'TRUE'|'FALSE';\ntype CheckboxBool = BoolString|boolean;\n\n/**\n * Class for a checkbox field.\n */\nexport class FieldCheckbox extends Field<CheckboxBool> {\n  /** Default character for the checkmark. */\n  static readonly CHECK_CHAR = '';\n  private checkChar_: string;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * Mouse cursor style when over the hotspot that initiates editability.\n   */\n  override CURSOR = 'default';\n\n  /**\n   * NOTE: The default value is set in `Field`, so maintain that value instead\n   * of overwriting it here or in the constructor.\n   */\n  override value_: boolean|null = this.value_;\n\n  /**\n   * @param value The initial value of the field. Should either be 'TRUE',\n   *     'FALSE' or a boolean. Defaults to 'FALSE'. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator  A function that is called to validate changes to the\n   *     field's value. Takes in a value ('TRUE' or 'FALSE') & returns a\n   *     validated value ('TRUE' or 'FALSE'), or null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/checkbox#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: CheckboxBool|typeof Field.SKIP_SETUP,\n      validator?: FieldCheckboxValidator, config?: FieldCheckboxConfig) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * Character for the check mark. Used to apply a different check mark\n     * character to individual fields.\n     */\n    this.checkChar_ = FieldCheckbox.CHECK_CHAR;\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldCheckboxConfig) {\n    super.configure_(config);\n    if (config.checkCharacter) this.checkChar_ = config.checkCharacter;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @returns The boolean value held by this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldCheckbox);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValueBoolean();\n  }\n\n  /**\n   * Create the block UI for this checkbox.\n   *\n   * @internal\n   */\n  override initView() {\n    super.initView();\n\n    const textElement = this.getTextElement();\n    dom.addClass(textElement, 'blocklyCheckbox');\n    textElement.style.display = this.value_ ? 'block' : 'none';\n  }\n\n  override render_() {\n    if (this.textContent_) {\n      this.textContent_.nodeValue = this.getDisplayText_();\n    }\n    this.updateSize_(this.getConstants()!.FIELD_CHECKBOX_X_OFFSET);\n  }\n\n  override getDisplayText_() {\n    return this.checkChar_;\n  }\n\n  /**\n   * Set the character used for the check mark.\n   *\n   * @param character The character to use for the check mark, or null to use\n   *     the default.\n   */\n  setCheckCharacter(character: string|null) {\n    this.checkChar_ = character || FieldCheckbox.CHECK_CHAR;\n    this.forceRerender();\n  }\n\n  /** Toggle the state of the checkbox on click. */\n  protected override showEditor_() {\n    this.setValue(!this.value_);\n  }\n\n  /**\n   * Ensure that the input value is valid ('TRUE' or 'FALSE').\n   *\n   * @param newValue The input value.\n   * @returns A valid value ('TRUE' or 'FALSE), or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: AnyDuringMigration):\n      BoolString|null {\n    if (newValue === true || newValue === 'TRUE') {\n      return 'TRUE';\n    }\n    if (newValue === false || newValue === 'FALSE') {\n      return 'FALSE';\n    }\n    return null;\n  }\n\n  /**\n   * Update the value of the field, and update the checkElement.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a either 'TRUE' or 'FALSE'.\n   */\n  protected override doValueUpdate_(newValue: BoolString) {\n    this.value_ = this.convertValueToBool_(newValue);\n    // Update visual.\n    if (this.textElement_) {\n      this.textElement_.style.display = this.value_ ? 'block' : 'none';\n    }\n  }\n\n  /**\n   * Get the value of this field, either 'TRUE' or 'FALSE'.\n   *\n   * @returns The value of this field.\n   */\n  override getValue(): BoolString {\n    return this.value_ ? 'TRUE' : 'FALSE';\n  }\n\n  /**\n   * Get the boolean value of this field.\n   *\n   * @returns The boolean value of this field.\n   */\n  getValueBoolean(): boolean|null {\n    return this.value_;\n  }\n\n  /**\n   * Get the text of this field. Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field ('true' or 'false').\n   */\n  override getText(): string {\n    return String(this.convertValueToBool_(this.value_));\n  }\n\n  /**\n   * Convert a value into a pure boolean.\n   *\n   * Converts 'TRUE' to true and 'FALSE' to false correctly, everything else\n   * is cast to a boolean.\n   *\n   * @param value The value to convert.\n   * @returns The converted value.\n   */\n  private convertValueToBool_(value: CheckboxBool|null): boolean {\n    if (typeof value === 'string') return value === 'TRUE';\n    return !!value;\n  }\n\n  /**\n   * Construct a FieldCheckbox from a JSON arg object.\n   *\n   * @param options A JSON object with options (checked).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldCheckboxFromJsonConfig): FieldCheckbox {\n    // `this` might be a subclass of FieldCheckbox if that class doesn't\n    // 'override' the static fromJson method.\n    return new this(options.checked, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_checkbox', FieldCheckbox);\n\nFieldCheckbox.prototype.DEFAULT_VALUE = false;\n\n/**\n * Config options for the checkbox field.\n */\nexport interface FieldCheckboxConfig extends FieldConfig {\n  checkCharacter?: string;\n}\n\n/**\n * fromJson config options for the checkbox field.\n */\nexport interface FieldCheckboxFromJsonConfig extends FieldCheckboxConfig {\n  checked?: boolean;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldCheckboxValidator = FieldValidator<CheckboxBool>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Colour input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldColour');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport * as dom from './utils/dom.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Field, FieldConfig, FieldValidator} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as aria from './utils/aria.js';\nimport * as colour from './utils/colour.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Size} from './utils/size.js';\n\n/**\n * Class for a colour input field.\n */\nexport class FieldColour extends Field<string> {\n  /**\n   * An array of colour strings for the palette.\n   * Copied from goog.ui.ColorPicker.SIMPLE_GRID_COLORS\n   * All colour pickers use this unless overridden with setColours.\n   */\n  static COLOURS: string[] = [\n    // grays\n    '#ffffff', '#cccccc', '#c0c0c0', '#999999',\n    '#666666', '#333333', '#000000',  // reds\n    '#ffcccc', '#ff6666', '#ff0000', '#cc0000',\n    '#990000', '#660000', '#330000',  // oranges\n    '#ffcc99', '#ff9966', '#ff9900', '#ff6600',\n    '#cc6600', '#993300', '#663300',  // yellows\n    '#ffff99', '#ffff66', '#ffcc66', '#ffcc33',\n    '#cc9933', '#996633', '#663333',  // olives\n    '#ffffcc', '#ffff33', '#ffff00', '#ffcc00',\n    '#999900', '#666600', '#333300',  // greens\n    '#99ff99', '#66ff99', '#33ff33', '#33cc00',\n    '#009900', '#006600', '#003300',  // turquoises\n    '#99ffff', '#33ffff', '#66cccc', '#00cccc',\n    '#339999', '#336666', '#003333',  // blues\n    '#ccffff', '#66ffff', '#33ccff', '#3366ff',\n    '#3333ff', '#000099', '#000066',  // purples\n    '#ccccff', '#9999ff', '#6666cc', '#6633ff',\n    '#6600cc', '#333399', '#330099',  // violets\n    '#ffccff', '#ff99ff', '#cc66cc', '#cc33cc',\n    '#993399', '#663366', '#330033',\n  ];\n\n  /**\n   * An array of tooltip strings for the palette.  If not the same length as\n   * COLOURS, the colour's hex code will be used for any missing titles.\n   * All colour pickers use this unless overridden with setColours.\n   */\n  static TITLES: string[] = [];\n\n  /**\n   * Number of columns in the palette.\n   * All colour pickers use this unless overridden with setColumns.\n   */\n  static COLUMNS = 7;\n\n  /** The field's colour picker element. */\n  private picker: HTMLElement|null = null;\n\n  /** Index of the currently highlighted element. */\n  private highlightedIndex: number|null = null;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /** Mouse cursor style when over the hotspot that initiates the editor. */\n  override CURSOR = 'default';\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Colour fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Array of colours used by this field.  If null, use the global list. */\n  private colours: string[]|null = null;\n\n  /**\n   * Array of colour tooltips used by this field.  If null, use the global\n   * list.\n   */\n  private titles: string[]|null = null;\n\n  /**\n   * Number of colour columns used by this field.  If 0, use the global\n   * setting. By default use the global constants for columns.\n   */\n  private columns = 0;\n\n  /**\n   * @param value The initial value of the field. Should be in '#rrggbb'\n   *     format. Defaults to the first value in the default colour array. Also\n   *     accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   *     subclasses that want to handle configuration and setting the field\n   *     value after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a colour string & returns a validated colour\n   *     string ('#rrggbb' format), or null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/colour}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|typeof Field.SKIP_SETUP, validator?: FieldColourValidator,\n      config?: FieldColourConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldColourConfig) {\n    super.configure_(config);\n    if (config.colourOptions) this.colours = config.colourOptions;\n    if (config.colourTitles) this.titles = config.colourTitles;\n    if (config.columns) this.columns = config.columns;\n  }\n\n  /**\n   * Create the block UI for this colour field.\n   *\n   * @internal\n   */\n  override initView() {\n    this.size_ = new Size(\n        this.getConstants()!.FIELD_COLOUR_DEFAULT_WIDTH,\n        this.getConstants()!.FIELD_COLOUR_DEFAULT_HEIGHT);\n    if (!this.getConstants()!.FIELD_COLOUR_FULL_BLOCK) {\n      this.createBorderRect_();\n      this.getBorderRect().style['fillOpacity'] = '1';\n    } else if (this.sourceBlock_ instanceof BlockSvg) {\n      this.clickTarget_ = this.sourceBlock_.getSvgRoot();\n    }\n  }\n\n  /**\n   * Updates text field to match the colour/style of the block.\n   *\n   * @internal\n   */\n  override applyColour() {\n    if (!this.getConstants()!.FIELD_COLOUR_FULL_BLOCK) {\n      if (this.borderRect_) {\n        this.borderRect_.style.fill = this.getValue() as string;\n      }\n    } else if (this.sourceBlock_ instanceof BlockSvg) {\n      this.sourceBlock_.pathObject.svgPath.setAttribute(\n          'fill', this.getValue() as string);\n      this.sourceBlock_.pathObject.svgPath.setAttribute('stroke', '#fff');\n    }\n  }\n\n  /**\n   * Ensure that the input value is a valid colour.\n   *\n   * @param newValue The input value.\n   * @returns A valid colour, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): string|null {\n    if (typeof newValue !== 'string') {\n      return null;\n    }\n    return colour.parse(newValue);\n  }\n\n  /**\n   * Update the value of this colour field, and update the displayed colour.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a colour in '#rrggbb' format.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    this.value_ = newValue;\n    if (this.borderRect_) {\n      this.borderRect_.style.fill = newValue;\n    } else if (\n        this.sourceBlock_ && this.sourceBlock_.rendered &&\n        this.sourceBlock_ instanceof BlockSvg) {\n      this.sourceBlock_.pathObject.svgPath.setAttribute('fill', newValue);\n      this.sourceBlock_.pathObject.svgPath.setAttribute('stroke', '#fff');\n    }\n  }\n\n  /**\n   * Get the text for this field.  Used when the block is collapsed.\n   *\n   * @returns Text representing the value of this field.\n   */\n  override getText(): string {\n    let colour = this.value_ as string;\n    // Try to use #rgb format if possible, rather than #rrggbb.\n    if (/^#(.)\\1(.)\\2(.)\\3$/.test(colour)) {\n      colour = '#' + colour[1] + colour[3] + colour[5];\n    }\n    return colour;\n  }\n\n  /**\n   * Set a custom colour grid for this field.\n   *\n   * @param colours Array of colours for this block, or null to use default\n   *     (FieldColour.COLOURS).\n   * @param titles Optional array of colour tooltips, or null to use default\n   *     (FieldColour.TITLES).\n   * @returns Returns itself (for method chaining).\n   */\n  setColours(colours: string[], titles?: string[]): FieldColour {\n    this.colours = colours;\n    if (titles) {\n      this.titles = titles;\n    }\n    return this;\n  }\n\n  /**\n   * Set a custom grid size for this field.\n   *\n   * @param columns Number of columns for this block, or 0 to use default\n   *     (FieldColour.COLUMNS).\n   * @returns Returns itself (for method chaining).\n   */\n  setColumns(columns: number): FieldColour {\n    this.columns = columns;\n    return this;\n  }\n\n  /** Create and show the colour field's editor. */\n  protected override showEditor_() {\n    this.dropdownCreate();\n    dropDownDiv.getContentDiv().appendChild(this.picker!);\n\n    dropDownDiv.showPositionedByField(this, this.dropdownDispose.bind(this));\n\n    // Focus so we can start receiving keyboard events.\n    this.picker!.focus({preventScroll: true});\n  }\n\n  /**\n   * Handle a click on a colour cell.\n   *\n   * @param e Mouse event.\n   */\n  private onClick(e: PointerEvent) {\n    const cell = e.target as Element;\n    const colour = cell && cell.getAttribute('data-colour');\n    if (colour !== null) {\n      this.setValue(colour);\n      dropDownDiv.hideIfOwner(this);\n    }\n  }\n\n  /**\n   * Handle a key down event. Navigate around the grid with the\n   * arrow keys. Enter selects the highlighted colour.\n   *\n   * @param e Keyboard event.\n   */\n  private onKeyDown(e: KeyboardEvent) {\n    let handled = true;\n    let highlighted: HTMLElement|null;\n    switch (e.key) {\n      case 'ArrowUp':\n        this.moveHighlightBy(0, -1);\n        break;\n      case 'ArrowDown':\n        this.moveHighlightBy(0, 1);\n        break;\n      case 'ArrowLeft':\n        this.moveHighlightBy(-1, 0);\n        break;\n      case 'ArrowRight':\n        this.moveHighlightBy(1, 0);\n        break;\n      case 'Enter':\n        // Select the highlighted colour.\n        highlighted = this.getHighlighted();\n        if (highlighted) {\n          const colour = highlighted.getAttribute('data-colour');\n          if (colour !== null) {\n            this.setValue(colour);\n          }\n        }\n        dropDownDiv.hideWithoutAnimation();\n        break;\n      default:\n        handled = false;\n    }\n    if (handled) {\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Move the currently highlighted position by dx and dy.\n   *\n   * @param dx Change of x.\n   * @param dy Change of y.\n   */\n  private moveHighlightBy(dx: number, dy: number) {\n    if (!this.highlightedIndex) {\n      return;\n    }\n\n    const colours = this.colours || FieldColour.COLOURS;\n    const columns = this.columns || FieldColour.COLUMNS;\n\n    // Get the current x and y coordinates.\n    let x = this.highlightedIndex % columns;\n    let y = Math.floor(this.highlightedIndex / columns);\n\n    // Add the offset.\n    x += dx;\n    y += dy;\n\n    if (dx < 0) {\n      // Move left one grid cell, even in RTL.\n      // Loop back to the end of the previous row if we have room.\n      if (x < 0 && y > 0) {\n        x = columns - 1;\n        y--;\n      } else if (x < 0) {\n        x = 0;\n      }\n    } else if (dx > 0) {\n      // Move right one grid cell, even in RTL.\n      // Loop to the start of the next row, if there's room.\n      if (x > columns - 1 && y < Math.floor(colours.length / columns) - 1) {\n        x = 0;\n        y++;\n      } else if (x > columns - 1) {\n        x--;\n      }\n    } else if (dy < 0) {\n      // Move up one grid cell, stop at the top.\n      if (y < 0) {\n        y = 0;\n      }\n    } else if (dy > 0) {\n      // Move down one grid cell, stop at the bottom.\n      if (y > Math.floor(colours.length / columns) - 1) {\n        y = Math.floor(colours.length / columns) - 1;\n      }\n    }\n\n    // Move the highlight to the new coordinates.\n    const cell = this.picker!.childNodes[y].childNodes[x] as Element;\n    const index = y * columns + x;\n    this.setHighlightedCell(cell, index);\n  }\n\n  /**\n   * Handle a mouse move event. Highlight the hovered colour.\n   *\n   * @param e Mouse event.\n   */\n  private onMouseMove(e: PointerEvent) {\n    const cell = e.target as Element;\n    const index = cell && Number(cell.getAttribute('data-index'));\n    if (index !== null && index !== this.highlightedIndex) {\n      this.setHighlightedCell(cell, index);\n    }\n  }\n\n  /** Handle a mouse enter event. Focus the picker. */\n  private onMouseEnter() {\n    this.picker?.focus({preventScroll: true});\n  }\n\n  /**\n   * Handle a mouse leave event. Blur the picker and unhighlight\n   * the currently highlighted colour.\n   */\n  private onMouseLeave() {\n    this.picker?.blur();\n    const highlighted = this.getHighlighted();\n    if (highlighted) {\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\n    }\n  }\n\n  /**\n   * Returns the currently highlighted item (if any).\n   *\n   * @returns Highlighted item (null if none).\n   */\n  private getHighlighted(): HTMLElement|null {\n    if (!this.highlightedIndex) {\n      return null;\n    }\n\n    const columns = this.columns || FieldColour.COLUMNS;\n    const x = this.highlightedIndex % columns;\n    const y = Math.floor(this.highlightedIndex / columns);\n    const row = this.picker!.childNodes[y];\n    if (!row) {\n      return null;\n    }\n    return row.childNodes[x] as HTMLElement;\n  }\n\n  /**\n   * Update the currently highlighted cell.\n   *\n   * @param cell The new cell to highlight.\n   * @param index The index of the new cell.\n   */\n  private setHighlightedCell(cell: Element, index: number) {\n    // Unhighlight the current item.\n    const highlighted = this.getHighlighted();\n    if (highlighted) {\n      dom.removeClass(highlighted, 'blocklyColourHighlighted');\n    }\n    // Highlight new item.\n    dom.addClass(cell, 'blocklyColourHighlighted');\n    // Set new highlighted index.\n    this.highlightedIndex = index;\n\n    // Update accessibility roles.\n    const cellId = cell.getAttribute('id');\n    if (cellId && this.picker) {\n      aria.setState(this.picker, aria.State.ACTIVEDESCENDANT, cellId);\n    }\n  }\n\n  /** Create a colour picker dropdown editor. */\n  private dropdownCreate() {\n    const columns = this.columns || FieldColour.COLUMNS;\n    const colours = this.colours || FieldColour.COLOURS;\n    const titles = this.titles || FieldColour.TITLES;\n    const selectedColour = this.getValue();\n    // Create the palette.\n    const table = document.createElement('table');\n    table.className = 'blocklyColourTable';\n    table.tabIndex = 0;\n    table.dir = 'ltr';\n    aria.setRole(table, aria.Role.GRID);\n    aria.setState(table, aria.State.EXPANDED, true);\n    aria.setState(\n        table, aria.State.ROWCOUNT, Math.floor(colours.length / columns));\n    aria.setState(table, aria.State.COLCOUNT, columns);\n    let row: Element;\n    for (let i = 0; i < colours.length; i++) {\n      if (i % columns === 0) {\n        row = document.createElement('tr');\n        aria.setRole(row, aria.Role.ROW);\n        table.appendChild(row);\n      }\n      const cell = (document.createElement('td'));\n      row!.appendChild(cell);\n      // This becomes the value, if clicked.\n      cell.setAttribute('data-colour', colours[i]);\n      cell.title = titles[i] || colours[i];\n      cell.id = idGenerator.getNextUniqueId();\n      cell.setAttribute('data-index', `${i}`);\n      aria.setRole(cell, aria.Role.GRIDCELL);\n      aria.setState(cell, aria.State.LABEL, colours[i]);\n      aria.setState(cell, aria.State.SELECTED, colours[i] === selectedColour);\n      cell.style.backgroundColor = colours[i];\n      if (colours[i] === selectedColour) {\n        cell.className = 'blocklyColourSelected';\n        this.highlightedIndex = i;\n      }\n    }\n\n    // Configure event handler on the table to listen for any event in a cell.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        table, 'pointerdown', this, this.onClick, true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        table, 'pointermove', this, this.onMouseMove, true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        table, 'pointerenter', this, this.onMouseEnter, true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        table, 'pointerleave', this, this.onMouseLeave, true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        table, 'keydown', this, this.onKeyDown, false));\n\n    this.picker = table;\n  }\n\n  /** Disposes of events and DOM-references belonging to the colour editor. */\n  private dropdownDispose() {\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    this.picker = null;\n    this.highlightedIndex = null;\n  }\n\n  /**\n   * Construct a FieldColour from a JSON arg object.\n   *\n   * @param options A JSON object with options (colour).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldColourFromJsonConfig): FieldColour {\n    // `this` might be a subclass of FieldColour if that class doesn't override\n    // the static fromJson method.\n    return new this(options.colour, undefined, options);\n  }\n}\n\n/** The default value for this field. */\nFieldColour.prototype.DEFAULT_VALUE = FieldColour.COLOURS[0];\n\nfieldRegistry.register('field_colour', FieldColour);\n\n\n/**\n * CSS for colour picker.\n */\nCss.register(`\n.blocklyColourTable {\n  border-collapse: collapse;\n  display: block;\n  outline: none;\n  padding: 1px;\n}\n\n.blocklyColourTable>tr>td {\n  border: 0.5px solid #888;\n  box-sizing: border-box;\n  cursor: pointer;\n  display: inline-block;\n  height: 20px;\n  padding: 0;\n  width: 20px;\n}\n\n.blocklyColourTable>tr>td.blocklyColourHighlighted {\n  border-color: #eee;\n  box-shadow: 2px 2px 7px 2px rgba(0, 0, 0, 0.3);\n  position: relative;\n}\n\n.blocklyColourSelected, .blocklyColourSelected:hover {\n  border-color: #eee !important;\n  outline: 1px solid #333;\n  position: relative;\n}\n`);\n\n/**\n * Config options for the colour field.\n */\nexport interface FieldColourConfig extends FieldConfig {\n  colourOptions?: string[];\n  colourTitles?: string[];\n  columns?: number;\n}\n\n/**\n * fromJson config options for the colour field.\n */\nexport interface FieldColourFromJsonConfig extends FieldColourConfig {\n  colour?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldColourValidator = FieldValidator<string>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Image field.  Used for pictures, icons, etc.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldImage');\n\nimport {Field, FieldConfig} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\n\n/**\n * Class for an image on a block.\n */\nexport class FieldImage extends Field<string> {\n  /**\n   * Vertical padding below the image, which is included in the reported height\n   * of the field.\n   */\n  private static readonly Y_PADDING = 1;\n  protected override size_: Size;\n  private readonly imageHeight_: number;\n\n  /** The function to be called when this field is clicked. */\n  private clickHandler_: ((p1: FieldImage) => void)|null = null;\n\n  /** The rendered field's image element. */\n  private imageElement_: SVGImageElement|null = null;\n\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override readonly EDITABLE = false;\n\n  /**\n   * Used to tell if the field needs to be rendered the next time the block is\n   * rendered. Image fields are statically sized, and only need to be\n   * rendered at initialization.\n   */\n  protected override isDirty_ = false;\n\n  /** Whether to flip this image in RTL. */\n  private flipRtl_ = false;\n\n  /** Alt text of this image. */\n  private altText_ = '';\n\n  /**\n   * @param src The URL of the image.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param width Width of the image.\n   * @param height Height of the image.\n   * @param alt Optional alt text for when block is collapsed.\n   * @param onClick Optional function to be called when the image is\n   *     clicked. If onClick is defined, alt must also be defined.\n   * @param flipRtl Whether to flip the icon in RTL.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/image#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      src: string|typeof Field.SKIP_SETUP, width: string|number,\n      height: string|number, alt?: string, onClick?: (p1: FieldImage) => void,\n      flipRtl?: boolean, config?: FieldImageConfig) {\n    super(Field.SKIP_SETUP);\n\n    const imageHeight = Number(parsing.replaceMessageReferences(height));\n    const imageWidth = Number(parsing.replaceMessageReferences(width));\n    if (isNaN(imageHeight) || isNaN(imageWidth)) {\n      throw Error(\n          'Height and width values of an image field must cast to' +\n          ' numbers.');\n    }\n    if (imageHeight <= 0 || imageWidth <= 0) {\n      throw Error(\n          'Height and width values of an image field must be greater' +\n          ' than 0.');\n    }\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(imageWidth, imageHeight + FieldImage.Y_PADDING);\n\n    /**\n     * Store the image height, since it is different from the field height.\n     */\n    this.imageHeight_ = imageHeight;\n\n    if (typeof onClick === 'function') {\n      this.clickHandler_ = onClick;\n    }\n\n    if (src === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.flipRtl_ = !!flipRtl;\n      this.altText_ = parsing.replaceMessageReferences(alt) || '';\n    }\n    this.setValue(parsing.replaceMessageReferences(src));\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldImageConfig) {\n    super.configure_(config);\n    if (config.flipRtl) this.flipRtl_ = config.flipRtl;\n    if (config.alt) {\n      this.altText_ = parsing.replaceMessageReferences(config.alt);\n    }\n  }\n\n  /**\n   * Create the block UI for this image.\n   *\n   * @internal\n   */\n  override initView() {\n    this.imageElement_ = dom.createSvgElement(\n        Svg.IMAGE, {\n          'height': this.imageHeight_ + 'px',\n          'width': this.size_.width + 'px',\n          'alt': this.altText_,\n        },\n        this.fieldGroup_);\n    this.imageElement_.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href', this.value_ as string);\n\n    if (this.clickHandler_) {\n      this.imageElement_.style.cursor = 'pointer';\n    }\n  }\n\n  override updateSize_() {}\n  // NOP\n\n  /**\n   * Ensure that the input value (the source URL) is a string.\n   *\n   * @param newValue The input value.\n   * @returns A string, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: any): string|null {\n    if (typeof newValue !== 'string') {\n      return null;\n    }\n    return newValue;\n  }\n\n  /**\n   * Update the value of this image field, and update the displayed image.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    this.value_ = newValue;\n    if (this.imageElement_) {\n      this.imageElement_.setAttributeNS(\n          dom.XLINK_NS, 'xlink:href', this.value_);\n    }\n  }\n\n  /**\n   * Get whether to flip this image in RTL\n   *\n   * @returns True if we should flip in RTL.\n   */\n  override getFlipRtl(): boolean {\n    return this.flipRtl_;\n  }\n\n  /**\n   * Set the alt text of this image.\n   *\n   * @param alt New alt text.\n   */\n  setAlt(alt: string|null) {\n    if (alt === this.altText_) {\n      return;\n    }\n    this.altText_ = alt || '';\n    if (this.imageElement_) {\n      this.imageElement_.setAttribute('alt', this.altText_);\n    }\n  }\n\n  /**\n   * If field click is called, and click handler defined,\n   * call the handler.\n   */\n  protected override showEditor_() {\n    if (this.clickHandler_) {\n      this.clickHandler_(this);\n    }\n  }\n\n  /**\n   * Set the function that is called when this image  is clicked.\n   *\n   * @param func The function that is called when the image is clicked, or null\n   *     to remove.\n   */\n  setOnClickHandler(func: ((p1: FieldImage) => void)|null) {\n    this.clickHandler_ = func;\n  }\n\n  /**\n   * Use the `getText_` developer hook to override the field's text\n   * representation.\n   * Return the image alt text instead.\n   *\n   * @returns The image alt text.\n   */\n  protected override getText_(): string|null {\n    return this.altText_;\n  }\n\n  /**\n   * Construct a FieldImage from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (src, width, height, alt, and\n   *     flipRtl).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldImageFromJsonConfig): FieldImage {\n    if (!options.src || !options.width || !options.height) {\n      throw new Error(\n          'src, width, and height values for an image field are' +\n          'required. The width and height must be non-zero.');\n    }\n    // `this` might be a subclass of FieldImage if that class doesn't override\n    // the static fromJson method.\n    return new this(\n        options.src, options.width, options.height, undefined, undefined,\n        undefined, options);\n  }\n}\n\nfieldRegistry.register('field_image', FieldImage);\n\nFieldImage.prototype.DEFAULT_VALUE = '';\n\n/**\n * Config options for the image field.\n */\nexport interface FieldImageConfig extends FieldConfig {\n  flipRtl?: boolean;\n  alt?: string;\n}\n\n/**\n * fromJson config options for the colour field.\n */\nexport interface FieldImageFromJsonConfig extends FieldImageConfig {\n  src?: string;\n  width?: number;\n  height?: number;\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Non-editable, serializable text field. Behaves like a\n *    normal label but is serialized to XML. It may only be\n *    edited programmatically.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldLabelSerializable');\n\nimport {FieldLabel, FieldLabelConfig, FieldLabelFromJsonConfig} from './field_label.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for a non-editable, serializable text field.\n */\nexport class FieldLabelSerializable extends FieldLabel {\n  /**\n   * Editable fields usually show some sort of UI indicating they are\n   * editable. This field should not.\n   */\n  override EDITABLE = false;\n\n  /**\n   * Serializable fields are saved by the XML renderer, non-serializable\n   * fields are not.  This field should be serialized, but only edited\n   * programmatically.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined.\n   * @param textClass Optional CSS class for the field's text.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/label-serializable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(value?: string, textClass?: string, config?: FieldLabelConfig) {\n    super(String(value ?? ''), textClass, config);\n  }\n\n  /**\n   * Construct a FieldLabelSerializable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and class).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldLabelFromJsonConfig):\n      FieldLabelSerializable {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldLabelSerializable if that class\n    // doesn't override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_label_serializable', FieldLabelSerializable);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldTextInput');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport {Field} from './field.js';\nimport {FieldInput, FieldInputConfig, FieldInputValidator} from './field_input.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as parsing from './utils/parsing.js';\n\n/**\n * Class for an editable text field.\n */\nexport class FieldTextInput extends FieldInput<string> {\n  /**\n   * @param value The initial value of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a string & returns a validated string, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|typeof Field.SKIP_SETUP,\n      validator?: FieldTextInputValidator|null, config?: FieldTextInputConfig) {\n    super(value, validator, config);\n  }\n\n  /**\n   * Ensure that the input value casts to a valid string.\n   *\n   * @param newValue The input value.\n   * @returns A valid string, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: AnyDuringMigration): string\n      |null {\n    if (newValue === undefined) {\n      return null;\n    }\n    return `${newValue}`;\n  }\n\n  /**\n   * Construct a FieldTextInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldTextInputFromJsonConfig): FieldTextInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldTextInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_input', FieldTextInput);\n\nFieldTextInput.prototype.DEFAULT_VALUE = '';\n\n/**\n *  Config options for the text input field.\n */\nexport type FieldTextInputConfig = FieldInputConfig;\n\n/**\n * fromJson config options for the text input field.\n */\nexport interface FieldTextInputFromJsonConfig extends FieldTextInputConfig {\n  text?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldTextInputValidator = FieldInputValidator<string>;\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Text Area field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldMultilineInput');\n\nimport * as Css from './css.js';\nimport {Field, UnattachedFieldError} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldTextInput, FieldTextInputConfig, FieldTextInputValidator} from './field_textinput.js';\nimport * as aria from './utils/aria.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport {Svg} from './utils/svg.js';\nimport * as userAgent from './utils/useragent.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n/**\n * Class for an editable text area field.\n */\nexport class FieldMultilineInput extends FieldTextInput {\n  /**\n   * The SVG group element that will contain a text element for each text row\n   *     when initialized.\n   */\n  textGroup: SVGGElement|null = null;\n\n  /**\n   * Defines the maximum number of lines of field.\n   * If exceeded, scrolling functionality is enabled.\n   */\n  protected maxLines_ = Infinity;\n\n  /** Whether Y overflow is currently occurring. */\n  protected isOverflowedY_ = false;\n\n  /**\n   * @param value The initial content of the field. Should cast to a string.\n   *     Defaults to an empty string if null or undefined. Also accepts\n   *     Field.SKIP_SETUP if you wish to skip setup (only used by subclasses\n   *     that want to handle configuration and setting the field value after\n   *     their own constructors have run).\n   * @param validator An optional function that is called to validate any\n   *     constraints on what the user entered.  Takes the new text as an\n   *     argument and returns either the accepted text, a replacement text, or\n   *     null to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/multiline-text-input#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|typeof Field.SKIP_SETUP,\n      validator?: FieldMultilineInputValidator,\n      config?: FieldMultilineInputConfig) {\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldMultilineInputConfig) {\n    super.configure_(config);\n    if (config.maxLines) this.setMaxLines(config.maxLines);\n  }\n\n  /**\n   * Serializes this field's value to XML. Should only be called by Blockly.Xml.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   * @internal\n   */\n  override toXml(fieldElement: Element): Element {\n    // Replace '\\n' characters with HTML-escaped equivalent '&#10'. This is\n    // needed so the plain-text representation of the XML produced by\n    // `Blockly.Xml.domToText` will appear on a single line (this is a\n    // limitation of the plain-text format).\n    fieldElement.textContent =\n        (this.getValue() as string).replace(/\\n/g, '&#10;');\n    return fieldElement;\n  }\n\n  /**\n   * Sets the field's value based on the given XML element. Should only be\n   * called by Blockly.Xml.\n   *\n   * @param fieldElement The element containing info about the field's state.\n   * @internal\n   */\n  override fromXml(fieldElement: Element) {\n    this.setValue(fieldElement.textContent!.replace(/&#10;/g, '\\n'));\n  }\n\n  /**\n   * Saves this field's value.\n   * This function only exists for subclasses of FieldMultilineInput which\n   * predate the load/saveState API and only define to/fromXml.\n   *\n   * @returns The state of this field.\n   * @internal\n   */\n  override saveState(): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldMultilineInput);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    return this.getValue();\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   * This function only exists for subclasses of FieldMultilineInput which\n   * predate the load/saveState API and only define to/fromXml.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    if (this.loadLegacyState(Field, state)) {\n      return;\n    }\n    this.setValue(state);\n  }\n\n  /**\n   * Create the block UI for this field.\n   *\n   * @internal\n   */\n  override initView() {\n    this.createBorderRect_();\n    this.textGroup = dom.createSvgElement(\n        Svg.G, {\n          'class': 'blocklyEditableText',\n        },\n        this.fieldGroup_);\n  }\n\n  /**\n   * Get the text from this field as displayed on screen.  May differ from\n   * getText due to ellipsis, and other formatting.\n   *\n   * @returns Currently displayed text.\n   */\n  protected override getDisplayText_(): string {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    let textLines = this.getText();\n    if (!textLines) {\n      // Prevent the field from disappearing if empty.\n      return Field.NBSP;\n    }\n    const lines = textLines.split('\\n');\n    textLines = '';\n    const displayLinesNumber =\n        this.isOverflowedY_ ? this.maxLines_ : lines.length;\n    for (let i = 0; i < displayLinesNumber; i++) {\n      let text = lines[i];\n      if (text.length > this.maxDisplayLength) {\n        // Truncate displayed string and add an ellipsis ('...').\n        text = text.substring(0, this.maxDisplayLength - 4) + '...';\n      } else if (this.isOverflowedY_ && i === displayLinesNumber - 1) {\n        text = text.substring(0, text.length - 3) + '...';\n      }\n      // Replace whitespace with non-breaking spaces so the text doesn't\n      // collapse.\n      text = text.replace(/\\s/g, Field.NBSP);\n\n      textLines += text;\n      if (i !== displayLinesNumber - 1) {\n        textLines += '\\n';\n      }\n    }\n    if (block.RTL) {\n      // The SVG is LTR, force value to be RTL.\n      textLines += '\\u200F';\n    }\n    return textLines;\n  }\n\n  /**\n   * Called by setValue if the text input is valid. Updates the value of the\n   * field, and updates the text of the field if it is not currently being\n   * edited (i.e. handled by the htmlInput_). Is being redefined here to update\n   * overflow state of the field.\n   *\n   * @param newValue The value to be saved. The default validator guarantees\n   *     that this is a string.\n   */\n  protected override doValueUpdate_(newValue: string) {\n    super.doValueUpdate_(newValue);\n    if (this.value_ !== null) {\n      this.isOverflowedY_ = this.value_.split('\\n').length > this.maxLines_;\n    }\n  }\n\n  /** Updates the text of the textElement. */\n  protected override render_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    // Remove all text group children.\n    let currentChild;\n    const textGroup = this.textGroup;\n    while (currentChild = textGroup!.firstChild) {\n      textGroup!.removeChild(currentChild);\n    }\n\n    // Add in text elements into the group.\n    const lines = this.getDisplayText_().split('\\n');\n    let y = 0;\n    for (let i = 0; i < lines.length; i++) {\n      const lineHeight = this.getConstants()!.FIELD_TEXT_HEIGHT +\n          this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\n      const span = dom.createSvgElement(\n          Svg.TEXT, {\n            'class': 'blocklyText blocklyMultilineText',\n            'x': this.getConstants()!.FIELD_BORDER_RECT_X_PADDING,\n            'y': y + this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING,\n            'dy': this.getConstants()!.FIELD_TEXT_BASELINE,\n          },\n          textGroup);\n      span.appendChild(document.createTextNode(lines[i]));\n      y += lineHeight;\n    }\n\n    if (this.isBeingEdited_) {\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (this.isOverflowedY_) {\n        dom.addClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\n      } else {\n        dom.removeClass(htmlInput, 'blocklyHtmlTextAreaInputOverflowedY');\n      }\n    }\n\n    this.updateSize_();\n\n    if (this.isBeingEdited_) {\n      if (block.RTL) {\n        // in RTL, we need to let the browser reflow before resizing\n        // in order to get the correct bounding box of the borderRect\n        // avoiding issue #2777.\n        setTimeout(this.resizeEditor_.bind(this), 0);\n      } else {\n        this.resizeEditor_();\n      }\n      const htmlInput = this.htmlInput_ as HTMLElement;\n      if (!this.isTextValid_) {\n        dom.addClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, true);\n      } else {\n        dom.removeClass(htmlInput, 'blocklyInvalidInput');\n        aria.setState(htmlInput, aria.State.INVALID, false);\n      }\n    }\n  }\n\n  /** Updates the size of the field based on the text. */\n  protected override updateSize_() {\n    const nodes = (this.textGroup as SVGElement).childNodes;\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE;\n    const fontWeight = this.getConstants()!.FIELD_TEXT_FONTWEIGHT;\n    const fontFamily = this.getConstants()!.FIELD_TEXT_FONTFAMILY;\n    let totalWidth = 0;\n    let totalHeight = 0;\n    for (let i = 0; i < nodes.length; i++) {\n      const tspan = nodes[i] as SVGTextElement;\n      const textWidth =\n          dom.getFastTextWidth(tspan, fontSize, fontWeight, fontFamily);\n      if (textWidth > totalWidth) {\n        totalWidth = textWidth;\n      }\n      totalHeight += this.getConstants()!.FIELD_TEXT_HEIGHT +\n          (i > 0 ? this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING : 0);\n    }\n    if (this.isBeingEdited_) {\n      // The default width is based on the longest line in the display text,\n      // but when it's being edited, width should be calculated based on the\n      // absolute longest line, even if it would be truncated after editing.\n      // Otherwise we would get wrong editor width when there are more\n      // lines than this.maxLines_.\n      const actualEditorLines = String(this.value_).split('\\n');\n      const dummyTextElement = dom.createSvgElement(\n          Svg.TEXT, {'class': 'blocklyText blocklyMultilineText'});\n\n      for (let i = 0; i < actualEditorLines.length; i++) {\n        if (actualEditorLines[i].length > this.maxDisplayLength) {\n          actualEditorLines[i] =\n              actualEditorLines[i].substring(0, this.maxDisplayLength);\n        }\n        dummyTextElement.textContent = actualEditorLines[i];\n        const lineWidth = dom.getFastTextWidth(\n            dummyTextElement, fontSize, fontWeight, fontFamily);\n        if (lineWidth > totalWidth) {\n          totalWidth = lineWidth;\n        }\n      }\n\n      const scrollbarWidth =\n          this.htmlInput_!.offsetWidth - this.htmlInput_!.clientWidth;\n      totalWidth += scrollbarWidth;\n    }\n    if (this.borderRect_) {\n      totalHeight += this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * 2;\n      totalWidth += this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * 2;\n      this.borderRect_.setAttribute('width', `${totalWidth}`);\n      this.borderRect_.setAttribute('height', `${totalHeight}`);\n    }\n    this.size_.width = totalWidth;\n    this.size_.height = totalHeight;\n\n    this.positionBorderRect_();\n  }\n\n  /**\n   * Show the inline free-text editor on top of the text.\n   * Overrides the default behaviour to force rerender in order to\n   * correct block size, based on editor text.\n   *\n   * @param e Optional mouse event that triggered the field to open, or\n   *     undefined if triggered programmatically.\n   * @param quietInput True if editor should be created without focus.\n   *     Defaults to false.\n   */\n  override showEditor_(e?: Event, quietInput?: boolean) {\n    super.showEditor_(e, quietInput);\n    this.forceRerender();\n  }\n\n  /**\n   * Create the text input editor widget.\n   *\n   * @returns The newly created text input editor.\n   */\n  protected override widgetCreate_(): HTMLTextAreaElement {\n    const div = WidgetDiv.getDiv();\n    const scale = this.workspace_!.getScale();\n\n    const htmlInput = (document.createElement('textarea'));\n    htmlInput.className = 'blocklyHtmlInput blocklyHtmlTextAreaInput';\n    htmlInput.setAttribute('spellcheck', String(this.spellcheck_));\n    const fontSize = this.getConstants()!.FIELD_TEXT_FONTSIZE * scale + 'pt';\n    div!.style.fontSize = fontSize;\n    htmlInput.style.fontSize = fontSize;\n    const borderRadius = FieldTextInput.BORDERRADIUS * scale + 'px';\n    htmlInput.style.borderRadius = borderRadius;\n    const paddingX = this.getConstants()!.FIELD_BORDER_RECT_X_PADDING * scale;\n    const paddingY =\n        this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING * scale / 2;\n    htmlInput.style.padding = paddingY + 'px ' + paddingX + 'px ' + paddingY +\n        'px ' + paddingX + 'px';\n    const lineHeight = this.getConstants()!.FIELD_TEXT_HEIGHT +\n        this.getConstants()!.FIELD_BORDER_RECT_Y_PADDING;\n    htmlInput.style.lineHeight = lineHeight * scale + 'px';\n\n    div!.appendChild(htmlInput);\n\n    htmlInput.value = htmlInput.defaultValue = this.getEditorText_(this.value_);\n    htmlInput.setAttribute('data-untyped-default-value', String(this.value_));\n    htmlInput.setAttribute('data-old-value', '');\n    if (userAgent.GECKO) {\n      // In FF, ensure the browser reflows before resizing to avoid issue #2777.\n      setTimeout(this.resizeEditor_.bind(this), 0);\n    } else {\n      this.resizeEditor_();\n    }\n\n    this.bindInputEvents_(htmlInput);\n\n    return htmlInput;\n  }\n\n  /**\n   * Sets the maxLines config for this field.\n   *\n   * @param maxLines Defines the maximum number of lines allowed, before\n   *     scrolling functionality is enabled.\n   */\n  setMaxLines(maxLines: number) {\n    if (typeof maxLines === 'number' && maxLines > 0 &&\n        maxLines !== this.maxLines_) {\n      this.maxLines_ = maxLines;\n      this.forceRerender();\n    }\n  }\n\n  /**\n   * Returns the maxLines config of this field.\n   *\n   * @returns The maxLines config value.\n   */\n  getMaxLines(): number {\n    return this.maxLines_;\n  }\n\n  /**\n   * Handle key down to the editor. Override the text input definition of this\n   * so as to not close the editor when enter is typed in.\n   *\n   * @param e Keyboard event.\n   */\n  protected override onHtmlInputKeyDown_(e: KeyboardEvent) {\n    if (e.key !== 'Enter') {\n      super.onHtmlInputKeyDown_(e);\n    }\n  }\n\n  /**\n   * Construct a FieldMultilineInput from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (text, and spellcheck).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldMultilineInputFromJsonConfig):\n      FieldMultilineInput {\n    const text = parsing.replaceMessageReferences(options.text);\n    // `this` might be a subclass of FieldMultilineInput if that class doesn't\n    // override the static fromJson method.\n    return new this(text, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_multilinetext', FieldMultilineInput);\n\n\n/**\n * CSS for multiline field.\n */\nCss.register(`\n.blocklyHtmlTextAreaInput {\n  font-family: monospace;\n  resize: none;\n  overflow: hidden;\n  height: 100%;\n  text-align: left;\n}\n\n.blocklyHtmlTextAreaInputOverflowedY {\n  overflow-y: scroll;\n}\n`);\n\n/**\n * Config options for the multiline input field.\n */\nexport interface FieldMultilineInputConfig extends FieldTextInputConfig {\n  maxLines?: number;\n}\n\n/**\n * fromJson config options for the multiline input field.\n */\nexport interface FieldMultilineInputFromJsonConfig extends\n    FieldMultilineInputConfig {\n  text?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldMultilineInputValidator = FieldTextInputValidator;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Number input field\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldNumber');\n\nimport {Field} from './field.js';\nimport * as fieldRegistry from './field_registry.js';\nimport {FieldInput, FieldInputConfig, FieldInputValidator} from './field_input.js';\nimport * as aria from './utils/aria.js';\n\n/**\n * Class for an editable number field.\n */\nexport class FieldNumber extends FieldInput<number> {\n  /** The minimum value this number field can contain. */\n  protected min_ = -Infinity;\n\n  /** The maximum value this number field can contain. */\n  protected max_ = Infinity;\n\n  /** The multiple to which this fields value is rounded. */\n  protected precision_ = 0;\n\n  /**\n   * The number of decimal places to allow, or null to allow any number of\n   * decimal digits.\n   */\n  private decimalPlaces_: number|null = null;\n\n  /** Don't spellcheck numbers.  Our validator does a better job. */\n  protected override spellcheck_ = false;\n\n  /**\n   * @param value The initial value of the field. Should cast to a number.\n   *     Defaults to 0. Also accepts Field.SKIP_SETUP if you wish to skip setup\n   *     (only used by subclasses that want to handle configuration and setting\n   *     the field value after their own constructors have run).\n   * @param min Minimum value. Will only be used if config is not\n   *     provided.\n   * @param max Maximum value. Will only be used if config is not\n   *     provided.\n   * @param precision Precision for value. Will only be used if config\n   *     is not provided.\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a number & returns a validated number, or null\n   *     to abort the change.\n   * @param config A map of options used to configure the field.\n   *     See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/number#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      value?: string|number|typeof Field.SKIP_SETUP, min?: string|number|null,\n      max?: string|number|null, precision?: string|number|null,\n      validator?: FieldNumberValidator|null, config?: FieldNumberConfig) {\n    // Pass SENTINEL so that we can define properties before value validation.\n    super(Field.SKIP_SETUP);\n\n    if (value === Field.SKIP_SETUP) return;\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setConstraints(min, max, precision);\n    }\n    this.setValue(value);\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldNumberConfig) {\n    super.configure_(config);\n    this.setMinInternal_(config.min);\n    this.setMaxInternal_(config.max);\n    this.setPrecisionInternal_(config.precision);\n  }\n\n  /**\n   * Set the maximum, minimum and precision constraints on this field.\n   * Any of these properties may be undefined or NaN to be disabled.\n   * Setting precision (usually a power of 10) enforces a minimum step between\n   * values. That is, the user's value will rounded to the closest multiple of\n   * precision. The least significant digit place is inferred from the\n   * precision. Integers values can be enforces by choosing an integer\n   * precision.\n   *\n   * @param min Minimum value.\n   * @param max Maximum value.\n   * @param precision Precision for value.\n   */\n  setConstraints(\n      min: number|string|undefined|null, max: number|string|undefined|null,\n      precision: number|string|undefined|null) {\n    this.setMinInternal_(min);\n    this.setMaxInternal_(max);\n    this.setPrecisionInternal_(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param min Minimum value.\n   */\n  setMin(min: number|string|undefined|null) {\n    this.setMinInternal_(min);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the minimum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param min Minimum value.\n   */\n  private setMinInternal_(min: number|string|undefined|null) {\n    if (min == null) {\n      this.min_ = -Infinity;\n    } else {\n      min = Number(min);\n      if (!isNaN(min)) {\n        this.min_ = min;\n      }\n    }\n  }\n\n  /**\n   * Returns the current minimum value this field can contain. Default is\n   * -Infinity.\n   *\n   * @returns The current minimum value this field can contain.\n   */\n  getMin(): number {\n    return this.min_;\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Updates the value to\n   * reflect.\n   *\n   * @param max Maximum value.\n   */\n  setMax(max: number|string|undefined|null) {\n    this.setMaxInternal_(max);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the maximum value this field can contain. Called internally to avoid\n   * value updates.\n   *\n   * @param max Maximum value.\n   */\n  private setMaxInternal_(max: number|string|undefined|null) {\n    if (max == null) {\n      this.max_ = Infinity;\n    } else {\n      max = Number(max);\n      if (!isNaN(max)) {\n        this.max_ = max;\n      }\n    }\n  }\n\n  /**\n   * Returns the current maximum value this field can contain. Default is\n   * Infinity.\n   *\n   * @returns The current maximum value this field can contain.\n   */\n  getMax(): number {\n    return this.max_;\n  }\n\n  /**\n   * Sets the precision of this field's value, i.e. the number to which the\n   * value is rounded. Updates the field to reflect.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  setPrecision(precision: number|string|undefined|null) {\n    this.setPrecisionInternal_(precision);\n    this.setValue(this.getValue());\n  }\n\n  /**\n   * Sets the precision of this field's value. Called internally to avoid\n   * value updates.\n   *\n   * @param precision The number to which the field's value is rounded.\n   */\n  private setPrecisionInternal_(precision: number|string|undefined|null) {\n    this.precision_ = Number(precision) || 0;\n    let precisionString = String(this.precision_);\n    if (precisionString.indexOf('e') !== -1) {\n      // String() is fast.  But it turns .0000001 into '1e-7'.\n      // Use the much slower toLocaleString to access all the digits.\n      precisionString =\n          this.precision_.toLocaleString('en-US', {maximumFractionDigits: 20});\n    }\n    const decimalIndex = precisionString.indexOf('.');\n    if (decimalIndex === -1) {\n      // If the precision is 0 (float) allow any number of decimals,\n      // otherwise allow none.\n      this.decimalPlaces_ = precision ? 0 : null;\n    } else {\n      this.decimalPlaces_ = precisionString.length - decimalIndex - 1;\n    }\n  }\n\n  /**\n   * Returns the current precision of this field. The precision being the\n   * number to which the field's value is rounded. A precision of 0 means that\n   * the value is not rounded.\n   *\n   * @returns The number to which this field's value is rounded.\n   */\n  getPrecision(): number {\n    return this.precision_;\n  }\n\n  /**\n   * Ensure that the input value is a valid number (must fulfill the\n   * constraints placed on the field).\n   *\n   * @param newValue The input value.\n   * @returns A valid number, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: AnyDuringMigration): number\n      |null {\n    if (newValue === null) {\n      return null;\n    }\n\n    // Clean up text.\n    newValue = `${newValue}`;\n    // TODO: Handle cases like 'ten', '1.203,14', etc.\n    // 'O' is sometimes mistaken for '0' by inexperienced users.\n    newValue = newValue.replace(/O/ig, '0');\n    // Strip out thousands separators.\n    newValue = newValue.replace(/,/g, '');\n    // Ignore case of 'Infinity'.\n    newValue = newValue.replace(/infinity/i, 'Infinity');\n\n    // Clean up number.\n    let n = Number(newValue || 0);\n    if (isNaN(n)) {\n      // Invalid number.\n      return null;\n    }\n    // Get the value in range.\n    n = Math.min(Math.max(n, this.min_), this.max_);\n    // Round to nearest multiple of precision.\n    if (this.precision_ && isFinite(n)) {\n      n = Math.round(n / this.precision_) * this.precision_;\n    }\n    // Clean up floating point errors.\n    if (this.decimalPlaces_ !== null) {\n      n = Number(n.toFixed(this.decimalPlaces_));\n    }\n    return n;\n  }\n\n  /**\n   * Create the number input editor widget.\n   *\n   * @returns The newly created number input editor.\n   */\n  protected override widgetCreate_(): HTMLInputElement {\n    const htmlInput = super.widgetCreate_() as HTMLInputElement;\n    htmlInput.type = 'number';\n\n    // Set the accessibility state\n    if (this.min_ > -Infinity) {\n      htmlInput.min = `${this.min_}`;\n      aria.setState(htmlInput, aria.State.VALUEMIN, this.min_);\n    }\n    if (this.max_ < Infinity) {\n      htmlInput.max = `${this.max_}`;\n      aria.setState(htmlInput, aria.State.VALUEMAX, this.max_);\n    }\n    return htmlInput;\n  }\n\n  /**\n   * Construct a FieldNumber from a JSON arg object.\n   *\n   * @param options A JSON object with options (value, min, max, and precision).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static fromJson(options: FieldNumberFromJsonConfig): FieldNumber {\n    // `this` might be a subclass of FieldNumber if that class doesn't override\n    // the static fromJson method.\n    return new this(\n        options.value, undefined, undefined, undefined, undefined, options);\n  }\n}\n\nfieldRegistry.register('field_number', FieldNumber);\n\nFieldNumber.prototype.DEFAULT_VALUE = 0;\n\n/**\n * Config options for the number field.\n */\nexport interface FieldNumberConfig extends FieldInputConfig {\n  min?: number;\n  max?: number;\n  precision?: number;\n}\n\n/**\n * fromJson config options for the number field.\n */\nexport interface FieldNumberFromJsonConfig extends FieldNumberConfig {\n  value?: number;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldNumberValidator = FieldInputValidator<number>;\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Variable input field.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FieldVariable');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_block_change.js';\n\nimport type {Block} from './block.js';\nimport {Field, FieldConfig, UnattachedFieldError} from './field.js';\nimport {FieldDropdown, FieldDropdownValidator, MenuGenerator, MenuOption} from './field_dropdown.js';\nimport * as fieldRegistry from './field_registry.js';\nimport * as internalConstants from './internal_constants.js';\nimport type {Menu} from './menu.js';\nimport type {MenuItem} from './menuitem.js';\nimport {Msg} from './msg.js';\nimport * as parsing from './utils/parsing.js';\nimport {Size} from './utils/size.js';\nimport {VariableModel} from './variable_model.js';\nimport * as Variables from './variables.js';\nimport * as Xml from './xml.js';\n\n/**\n * Class for a variable's dropdown field.\n */\nexport class FieldVariable extends FieldDropdown {\n  protected override menuGenerator_: MenuGenerator|undefined;\n  defaultVariableName: string;\n\n  /** The type of the default variable for this field. */\n  private defaultType_ = '';\n\n  /**\n   * All of the types of variables that will be available in this field's\n   * dropdown.\n   */\n  variableTypes: string[]|null = [];\n  protected override size_: Size;\n\n  /** The variable model associated with this field. */\n  private variable_: VariableModel|null = null;\n\n  /**\n   * Serializable fields are saved by the serializer, non-serializable fields\n   * are not. Editable fields should also be serializable.\n   */\n  override SERIALIZABLE = true;\n\n  /**\n   * @param varName The default name for the variable.\n   *     If null, a unique variable name will be generated.\n   *     Also accepts Field.SKIP_SETUP if you wish to skip setup (only used by\n   * subclasses that want to handle configuration and setting the field value\n   * after their own constructors have run).\n   * @param validator A function that is called to validate changes to the\n   *     field's value. Takes in a variable ID  & returns a validated variable\n   *     ID, or null to abort the change.\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown. Will only be used if config is not provided.\n   * @param defaultType The type of variable to create if this field's value\n   *     is not explicitly set.  Defaults to ''. Will only be used if config\n   *     is not provided.\n   * @param config A map of options used to configure the field.\n   *    See the [field creation documentation]{@link\n   * https://developers.google.com/blockly/guides/create-custom-blocks/fields/built-in-fields/variable#creation}\n   * for a list of properties this parameter supports.\n   */\n  constructor(\n      varName: string|null|typeof Field.SKIP_SETUP,\n      validator?: FieldVariableValidator, variableTypes?: string[],\n      defaultType?: string, config?: FieldVariableConfig) {\n    super(Field.SKIP_SETUP);\n\n    /**\n     * An array of options for a dropdown list,\n     * or a function which generates these options.\n     */\n    this.menuGenerator_ = FieldVariable.dropdownCreate as MenuGenerator;\n\n    /**\n     * The initial variable name passed to this field's constructor, or an\n     * empty string if a name wasn't provided. Used to create the initial\n     * variable.\n     */\n    this.defaultVariableName = typeof varName === 'string' ? varName : '';\n\n    /** The size of the area rendered by the field. */\n    this.size_ = new Size(0, 0);\n\n    if (varName === Field.SKIP_SETUP) return;\n\n    if (config) {\n      this.configure_(config);\n    } else {\n      this.setTypes_(variableTypes, defaultType);\n    }\n    if (validator) {\n      this.setValidator(validator);\n    }\n  }\n\n  /**\n   * Configure the field based on the given map of options.\n   *\n   * @param config A map of options to configure the field based on.\n   */\n  protected override configure_(config: FieldVariableConfig) {\n    super.configure_(config);\n    this.setTypes_(config.variableTypes, config.defaultType);\n  }\n\n  /**\n   * Initialize the model for this field if it has not already been initialized.\n   * If the value has not been set to a variable by the first render, we make up\n   * a variable rather than let the value be invalid.\n   *\n   * @internal\n   */\n  override initModel() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.variable_) {\n      return;  // Initialization already happened.\n    }\n    const variable = Variables.getOrCreateVariablePackage(\n        block.workspace, null, this.defaultVariableName, this.defaultType_);\n    // Don't call setValue because we don't want to cause a rerender.\n    this.doValueUpdate_(variable.getId());\n  }\n\n  override shouldAddBorderRect_() {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    return super.shouldAddBorderRect_() &&\n        (!this.getConstants()!.FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW ||\n         block.type !== 'variables_get');\n  }\n\n  /**\n   * Initialize this field based on the given XML.\n   *\n   * @param fieldElement The element containing information about the variable\n   *     field's state.\n   */\n  override fromXml(fieldElement: Element) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const id = fieldElement.getAttribute('id');\n    const variableName = fieldElement.textContent;\n    // 'variabletype' should be lowercase, but until July 2019 it was sometimes\n    // recorded as 'variableType'.  Thus we need to check for both.\n    const variableType = fieldElement.getAttribute('variabletype') ||\n        fieldElement.getAttribute('variableType') || '';\n\n    // AnyDuringMigration because:  Argument of type 'string | null' is not\n    // assignable to parameter of type 'string | undefined'.\n    const variable = Variables.getOrCreateVariablePackage(\n        block.workspace, id, variableName as AnyDuringMigration, variableType);\n\n    // This should never happen :)\n    if (variableType !== null && variableType !== variable.type) {\n      throw Error(\n          'Serialized variable type with id \\'' + variable.getId() +\n          '\\' had type ' + variable.type + ', and ' +\n          'does not match variable field that references it: ' +\n          Xml.domToText(fieldElement) + '.');\n    }\n\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Serialize this field to XML.\n   *\n   * @param fieldElement The element to populate with info about the field's\n   *     state.\n   * @returns The element containing info about the field's state.\n   */\n  override toXml(fieldElement: Element): Element {\n    // Make sure the variable is initialized.\n    this.initModel();\n\n    fieldElement.id = this.variable_!.getId();\n    fieldElement.textContent = this.variable_!.name;\n    if (this.variable_!.type) {\n      fieldElement.setAttribute('variabletype', this.variable_!.type);\n    }\n    return fieldElement;\n  }\n\n  /**\n   * Saves this field's value.\n   *\n   * @param doFullSerialization If true, the variable field will serialize the\n   *     full state of the field being referenced (ie ID, name, and type) rather\n   *     than just a reference to it (ie ID).\n   * @returns The state of the variable field.\n   * @internal\n   */\n  override saveState(doFullSerialization?: boolean): AnyDuringMigration {\n    const legacyState = this.saveLegacyState(FieldVariable);\n    if (legacyState !== null) {\n      return legacyState;\n    }\n    // Make sure the variable is initialized.\n    this.initModel();\n    const state = {'id': this.variable_!.getId()};\n    if (doFullSerialization) {\n      (state as AnyDuringMigration)['name'] = this.variable_!.name;\n      (state as AnyDuringMigration)['type'] = this.variable_!.type;\n    }\n    return state;\n  }\n\n  /**\n   * Sets the field's value based on the given state.\n   *\n   * @param state The state of the variable to assign to this variable field.\n   * @internal\n   */\n  override loadState(state: AnyDuringMigration) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    if (this.loadLegacyState(FieldVariable, state)) {\n      return;\n    }\n    // This is necessary so that blocks in the flyout can have custom var names.\n    const variable = Variables.getOrCreateVariablePackage(\n        block.workspace, state['id'] || null, state['name'],\n        state['type'] || '');\n    this.setValue(variable.getId());\n  }\n\n  /**\n   * Attach this field to a block.\n   *\n   * @param block The block containing this field.\n   */\n  override setSourceBlock(block: Block) {\n    if (block.isShadow()) {\n      throw Error('Variable fields are not allowed to exist on shadow blocks.');\n    }\n    super.setSourceBlock(block);\n  }\n\n  /**\n   * Get the variable's ID.\n   *\n   * @returns Current variable's ID.\n   */\n  override getValue(): string|null {\n    return this.variable_ ? this.variable_.getId() : null;\n  }\n\n  /**\n   * Get the text from this field, which is the selected variable's name.\n   *\n   * @returns The selected variable's name, or the empty string if no variable\n   *     is selected.\n   */\n  override getText(): string {\n    return this.variable_ ? this.variable_.name : '';\n  }\n\n  /**\n   * Get the variable model for the selected variable.\n   * Not guaranteed to be in the variable map on the workspace (e.g. if accessed\n   * after the variable has been deleted).\n   *\n   * @returns The selected variable, or null if none was selected.\n   * @internal\n   */\n  getVariable(): VariableModel|null {\n    return this.variable_;\n  }\n\n  /**\n   * Gets the validation function for this field, or null if not set.\n   * Returns null if the variable is not set, because validators should not\n   * run on the initial setValue call, because the field won't be attached to\n   * a block and workspace at that point.\n   *\n   * @returns Validation function, or null.\n   */\n  override getValidator(): FieldVariableValidator|null {\n    // Validators shouldn't operate on the initial setValue call.\n    // Normally this is achieved by calling setValidator after setValue, but\n    // this is not a possibility with variable fields.\n    if (this.variable_) {\n      return this.validator_;\n    }\n    return null;\n  }\n\n  /**\n   * Ensure that the ID belongs to a valid variable of an allowed type.\n   *\n   * @param newValue The ID of the new variable to set.\n   * @returns The validated ID, or null if invalid.\n   */\n  protected override doClassValidation_(newValue?: AnyDuringMigration): string\n      |null {\n    if (newValue === null) {\n      return null;\n    }\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    const newId = newValue as string;\n    const variable = Variables.getVariable(block.workspace, newId);\n    if (!variable) {\n      console.warn(\n          'Variable id doesn\\'t point to a real variable! ' +\n          'ID was ' + newId);\n      return null;\n    }\n    // Type Checks.\n    const type = variable.type;\n    if (!this.typeIsAllowed_(type)) {\n      console.warn(\n          'Variable type doesn\\'t match this field!  Type was ' + type);\n      return null;\n    }\n    return newId;\n  }\n\n  /**\n   * Update the value of this variable field, as well as its variable and text.\n   *\n   * The variable ID should be valid at this point, but if a variable field\n   * validator returns a bad ID, this could break.\n   *\n   * @param newId The value to be saved.\n   */\n  protected override doValueUpdate_(newId: string) {\n    const block = this.getSourceBlock();\n    if (!block) {\n      throw new UnattachedFieldError();\n    }\n    this.variable_ = Variables.getVariable(block.workspace, newId as string);\n    super.doValueUpdate_(newId);\n  }\n\n  /**\n   * Check whether the given variable type is allowed on this field.\n   *\n   * @param type The type to check.\n   * @returns True if the type is in the list of allowed types.\n   */\n  private typeIsAllowed_(type: string): boolean {\n    const typeList = this.getVariableTypes_();\n    if (!typeList) {\n      return true;  // If it's null, all types are valid.\n    }\n    for (let i = 0; i < typeList.length; i++) {\n      if (type === typeList[i]) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Return a list of variable types to include in the dropdown.\n   *\n   * @returns Array of variable types.\n   * @throws {Error} if variableTypes is an empty array.\n   */\n  private getVariableTypes_(): string[] {\n    // TODO (#1513): Try to avoid calling this every time the field is edited.\n    let variableTypes = this.variableTypes;\n    if (variableTypes === null) {\n      // If variableTypes is null, return all variable types.\n      if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n        return this.sourceBlock_.workspace.getVariableTypes();\n      }\n    }\n    variableTypes = variableTypes || [''];\n    if (variableTypes.length === 0) {\n      // Throw an error if variableTypes is an empty list.\n      const name = this.getText();\n      throw Error(\n          '\\'variableTypes\\' of field variable ' + name + ' was an empty list');\n    }\n    return variableTypes;\n  }\n\n  /**\n   * Parse the optional arguments representing the allowed variable types and\n   * the default variable type.\n   *\n   * @param variableTypes A list of the types of variables to include in the\n   *     dropdown.  If null or undefined, variables of all types will be\n   *     displayed in the dropdown.\n   * @param defaultType The type of the variable to create if this field's\n   *     value is not explicitly set.  Defaults to ''.\n   */\n  private setTypes_(variableTypes: string[]|null = null, defaultType = '') {\n    // If you expected that the default type would be the same as the only entry\n    // in the variable types array, tell the Blockly team by commenting on\n    // #1499.\n    // Set the allowable variable types.  Null means all types on the workspace.\n    if (Array.isArray(variableTypes)) {\n      variableTypes = variableTypes;\n      // Make sure the default type is valid.\n      let isInArray = false;\n      for (let i = 0; i < variableTypes.length; i++) {\n        if (variableTypes[i] === defaultType) {\n          isInArray = true;\n        }\n      }\n      if (!isInArray) {\n        throw Error(\n            'Invalid default type \\'' + defaultType + '\\' in ' +\n            'the definition of a FieldVariable');\n      }\n    } else if (variableTypes !== null) {\n      throw Error(\n          '\\'variableTypes\\' was not an array in the definition of ' +\n          'a FieldVariable');\n    }\n    // Only update the field once all checks pass.\n    this.defaultType_ = defaultType;\n    this.variableTypes = variableTypes;\n  }\n\n  /**\n   * Refreshes the name of the variable by grabbing the name of the model.\n   * Used when a variable gets renamed, but the ID stays the same. Should only\n   * be called by the block.\n   *\n   * @internal\n   */\n  override refreshVariableName() {\n    this.forceRerender();\n  }\n\n  /**\n   * Handle the selection of an item in the variable dropdown menu.\n   * Special case the 'Rename variable...' and 'Delete variable...' options.\n   * In the rename case, prompt the user for a new name.\n   *\n   * @param menu The Menu component clicked.\n   * @param menuItem The MenuItem selected within menu.\n   */\n  protected override onItemSelected_(menu: Menu, menuItem: MenuItem) {\n    const id = menuItem.getValue();\n    // Handle special cases.\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      if (id === internalConstants.RENAME_VARIABLE_ID) {\n        // Rename variable.\n        Variables.renameVariable(\n            this.sourceBlock_.workspace, this.variable_ as VariableModel);\n        return;\n      } else if (id === internalConstants.DELETE_VARIABLE_ID) {\n        // Delete variable.\n        this.sourceBlock_.workspace.deleteVariableById(this.variable_!.getId());\n        return;\n      }\n    }\n    // Handle unspecial case.\n    this.setValue(id);\n  }\n\n  /**\n   * Overrides referencesVariables(), indicating this field refers to a\n   * variable.\n   *\n   * @returns True.\n   * @internal\n   */\n  override referencesVariables(): boolean {\n    return true;\n  }\n\n  /**\n   * Construct a FieldVariable from a JSON arg object,\n   * dereferencing any string table references.\n   *\n   * @param options A JSON object with options (variable, variableTypes, and\n   *     defaultType).\n   * @returns The new field instance.\n   * @nocollapse\n   * @internal\n   */\n  static override fromJson(options: FieldVariableFromJsonConfig):\n      FieldVariable {\n    const varName = parsing.replaceMessageReferences(options.variable);\n    // `this` might be a subclass of FieldVariable if that class doesn't\n    // override the static fromJson method.\n    return new this(varName, undefined, undefined, undefined, options);\n  }\n\n  /**\n   * Return a sorted list of variable names for variable dropdown menus.\n   * Include a special option at the end for creating a new variable name.\n   *\n   * @returns Array of variable names/id tuples.\n   */\n  static dropdownCreate(this: FieldVariable): MenuOption[] {\n    if (!this.variable_) {\n      throw Error(\n          'Tried to call dropdownCreate on a variable field with no' +\n          ' variable selected.');\n    }\n    const name = this.getText();\n    let variableModelList: VariableModel[] = [];\n    if (this.sourceBlock_ && !this.sourceBlock_.isDeadOrDying()) {\n      const variableTypes = this.getVariableTypes_();\n      // Get a copy of the list, so that adding rename and new variable options\n      // doesn't modify the workspace's list.\n      for (let i = 0; i < variableTypes.length; i++) {\n        const variableType = variableTypes[i];\n        const variables =\n            this.sourceBlock_.workspace.getVariablesOfType(variableType);\n        variableModelList = variableModelList.concat(variables);\n      }\n    }\n    variableModelList.sort(VariableModel.compareByName);\n\n    const options: [string, string][] = [];\n    for (let i = 0; i < variableModelList.length; i++) {\n      // Set the UUID as the internal representation of the variable.\n      options[i] = [variableModelList[i].name, variableModelList[i].getId()];\n    }\n    options.push(\n        [Msg['RENAME_VARIABLE'], internalConstants.RENAME_VARIABLE_ID]);\n    if (Msg['DELETE_VARIABLE']) {\n      options.push([\n        Msg['DELETE_VARIABLE'].replace('%1', name),\n        internalConstants.DELETE_VARIABLE_ID,\n      ]);\n    }\n\n    return options;\n  }\n}\n\nfieldRegistry.register('field_variable', FieldVariable);\n\n/**\n * Config options for the variable field.\n */\nexport interface FieldVariableConfig extends FieldConfig {\n  variableTypes?: string[];\n  defaultType?: string;\n}\n\n/**\n * fromJson config options for the variable field.\n */\nexport interface FieldVariableFromJsonConfig extends FieldVariableConfig {\n  variable?: string;\n}\n\n/**\n * A function that is called to validate changes to the field's value before\n * they are set.\n *\n * @see {@link https://developers.google.com/blockly/guides/create-custom-blocks/fields/validators#return_values}\n * @param newValue The value to be validated.\n * @returns One of three instructions for setting the new value: `T`, `null`,\n * or `undefined`.\n *\n * - `T` to set this function's returned value instead of `newValue`.\n *\n * - `null` to invoke `doValueInvalid_` and not set a value.\n *\n * - `undefined` to set `newValue` as is.\n */\nexport type FieldVariableValidator = FieldDropdownValidator;\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Class for a button in the flyout.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FlyoutButton');\n\nimport * as browserEvents from './browser_events.js';\nimport * as Css from './css.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as parsing from './utils/parsing.js';\nimport * as style from './utils/style.js';\nimport {Svg} from './utils/svg.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a button or label in the flyout.\n */\nexport class FlyoutButton {\n  /** The horizontal margin around the text in the button. */\n  static TEXT_MARGIN_X = 5;\n\n  /** The vertical margin around the text in the button. */\n  static TEXT_MARGIN_Y = 2;\n\n  /** The radius of the flyout button's borders. */\n  static BORDER_RADIUS = 4;\n\n  private readonly text_: string;\n  private readonly position_: Coordinate;\n  private readonly callbackKey_: string;\n  private readonly cssClass_: string|null;\n\n  /** Mouse up event data. */\n  private onMouseUpWrapper_: browserEvents.Data|null = null;\n  info: toolbox.ButtonOrLabelInfo;\n\n  /** The width of the button's rect. */\n  width = 0;\n\n  /** The height of the button's rect. */\n  height = 0;\n\n  /** The root SVG group for the button or label. */\n  private svgGroup_: SVGGElement|null = null;\n\n  /** The SVG element with the text of the label or button. */\n  private svgText_: SVGTextElement|null = null;\n\n  /**\n   * @param workspace The workspace in which to place this button.\n   * @param targetWorkspace The flyout's target workspace.\n   * @param json The JSON specifying the label/button.\n   * @param isLabel_ Whether this button should be styled as a label.\n   * @internal\n   */\n  constructor(\n      private readonly workspace: WorkspaceSvg,\n      private readonly targetWorkspace: WorkspaceSvg,\n      json: toolbox.ButtonOrLabelInfo, private readonly isLabel_: boolean) {\n    this.text_ = json['text'];\n\n    this.position_ = new Coordinate(0, 0);\n\n    /** The key to the function called when this button is clicked. */\n    this.callbackKey_ =\n        (json as\n         AnyDuringMigration)['callbackKey'] || /* Check the lower case version\n                                                   too to satisfy IE */\n        (json as AnyDuringMigration)['callbackkey'];\n\n    /** If specified, a CSS class to add to this button. */\n    this.cssClass_ = (json as AnyDuringMigration)['web-class'] || null;\n\n    /** The JSON specifying the label / button. */\n    this.info = json;\n  }\n\n  /**\n   * Create the button elements.\n   *\n   * @returns The button's SVG group.\n   */\n  createDom(): SVGElement {\n    let cssClass = this.isLabel_ ? 'blocklyFlyoutLabel' : 'blocklyFlyoutButton';\n    if (this.cssClass_) {\n      cssClass += ' ' + this.cssClass_;\n    }\n\n    this.svgGroup_ = dom.createSvgElement(\n        Svg.G, {'class': cssClass}, this.workspace.getCanvas());\n\n    let shadow;\n    if (!this.isLabel_) {\n      // Shadow rectangle (light source does not mirror in RTL).\n      shadow = dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'blocklyFlyoutButtonShadow',\n            'rx': FlyoutButton.BORDER_RADIUS,\n            'ry': FlyoutButton.BORDER_RADIUS,\n            'x': 1,\n            'y': 1,\n          },\n          this.svgGroup_!);\n    }\n    // Background rectangle.\n    const rect = dom.createSvgElement(\n        Svg.RECT, {\n          'class': this.isLabel_ ? 'blocklyFlyoutLabelBackground' :\n                                   'blocklyFlyoutButtonBackground',\n          'rx': FlyoutButton.BORDER_RADIUS,\n          'ry': FlyoutButton.BORDER_RADIUS,\n        },\n        this.svgGroup_!);\n\n    const svgText = dom.createSvgElement(\n        Svg.TEXT, {\n          'class': this.isLabel_ ? 'blocklyFlyoutLabelText' : 'blocklyText',\n          'x': 0,\n          'y': 0,\n          'text-anchor': 'middle',\n        },\n        this.svgGroup_!);\n    let text = parsing.replaceMessageReferences(this.text_);\n    if (this.workspace.RTL) {\n      // Force text to be RTL by adding an RLM.\n      text += '\\u200F';\n    }\n    svgText.textContent = text;\n    if (this.isLabel_) {\n      this.svgText_ = svgText;\n      this.workspace.getThemeManager().subscribe(\n          this.svgText_, 'flyoutForegroundColour', 'fill');\n    }\n\n    const fontSize = style.getComputedStyle(svgText, 'fontSize');\n    const fontWeight = style.getComputedStyle(svgText, 'fontWeight');\n    const fontFamily = style.getComputedStyle(svgText, 'fontFamily');\n    this.width = dom.getFastTextWidthWithSizeString(\n        svgText, fontSize, fontWeight, fontFamily);\n    const fontMetrics =\n        dom.measureFontMetrics(text, fontSize, fontWeight, fontFamily);\n    this.height = fontMetrics.height;\n\n    if (!this.isLabel_) {\n      this.width += 2 * FlyoutButton.TEXT_MARGIN_X;\n      this.height += 2 * FlyoutButton.TEXT_MARGIN_Y;\n      shadow?.setAttribute('width', String(this.width));\n      shadow?.setAttribute('height', String(this.height));\n    }\n    rect.setAttribute('width', String(this.width));\n    rect.setAttribute('height', String(this.height));\n\n    svgText.setAttribute('x', String(this.width / 2));\n    svgText.setAttribute(\n        'y',\n        String(\n            this.height / 2 - fontMetrics.height / 2 + fontMetrics.baseline));\n\n    this.updateTransform_();\n\n    // AnyDuringMigration because:  Argument of type 'SVGGElement | null' is not\n    // assignable to parameter of type 'EventTarget'.\n    this.onMouseUpWrapper_ = browserEvents.conditionalBind(\n        this.svgGroup_ as AnyDuringMigration, 'pointerup', this,\n        this.onMouseUp_);\n    return this.svgGroup_!;\n  }\n\n  /** Correctly position the flyout button and make it visible. */\n  show() {\n    this.updateTransform_();\n    this.svgGroup_!.setAttribute('display', 'block');\n  }\n\n  /** Update SVG attributes to match internal state. */\n  private updateTransform_() {\n    this.svgGroup_!.setAttribute(\n        'transform',\n        'translate(' + this.position_.x + ',' + this.position_.y + ')');\n  }\n\n  /**\n   * Move the button to the given x, y coordinates.\n   *\n   * @param x The new x coordinate.\n   * @param y The new y coordinate.\n   */\n  moveTo(x: number, y: number) {\n    this.position_.x = x;\n    this.position_.y = y;\n    this.updateTransform_();\n  }\n\n  /** @returns Whether or not the button is a label. */\n  isLabel(): boolean {\n    return this.isLabel_;\n  }\n\n  /**\n   * Location of the button.\n   *\n   * @returns x, y coordinates.\n   * @internal\n   */\n  getPosition(): Coordinate {\n    return this.position_;\n  }\n\n  /** @returns Text of the button. */\n  getButtonText(): string {\n    return this.text_;\n  }\n\n  /**\n   * Get the button's target workspace.\n   *\n   * @returns The target workspace of the flyout where this button resides.\n   */\n  getTargetWorkspace(): WorkspaceSvg {\n    return this.targetWorkspace;\n  }\n\n  /** Dispose of this button. */\n  dispose() {\n    if (this.onMouseUpWrapper_) {\n      browserEvents.unbind(this.onMouseUpWrapper_);\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n    if (this.svgText_) {\n      this.workspace.getThemeManager().unsubscribe(this.svgText_);\n    }\n  }\n\n  /**\n   * Do something when the button is clicked.\n   *\n   * @param e Pointer up event.\n   */\n  private onMouseUp_(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.cancel();\n    }\n\n    if (this.isLabel_ && this.callbackKey_) {\n      console.warn(\n          'Labels should not have callbacks. Label text: ' + this.text_);\n    } else if (\n        !this.isLabel_ &&\n        !(this.callbackKey_ &&\n          this.targetWorkspace.getButtonCallback(this.callbackKey_))) {\n      console.warn('Buttons should have callbacks. Button text: ' + this.text_);\n    } else if (!this.isLabel_) {\n      const callback =\n          this.targetWorkspace.getButtonCallback(this.callbackKey_);\n      if (callback) {\n        callback(this);\n      }\n    }\n  }\n}\n\n/** CSS for buttons and labels. See css.js for use. */\nCss.register(`\n.blocklyFlyoutButton {\n  fill: #888;\n  cursor: default;\n}\n\n.blocklyFlyoutButtonShadow {\n  fill: #666;\n}\n\n.blocklyFlyoutButton:hover {\n  fill: #aaa;\n}\n\n.blocklyFlyoutLabel {\n  cursor: default;\n}\n\n.blocklyFlyoutLabelBackground {\n  opacity: 0;\n}\n`);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports workspace metrics.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.MetricsManager');\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IMetricsManager} from './interfaces/i_metrics_manager.js';\nimport type {IToolbox} from './interfaces/i_toolbox.js';\nimport * as registry from './registry.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Size} from './utils/size.js';\nimport * as toolboxUtils from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * The manager for all workspace metrics calculations.\n */\nexport class MetricsManager implements IMetricsManager {\n  /** The workspace to calculate metrics for. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace to calculate metrics for. */\n  constructor(workspace: WorkspaceSvg) {\n    this.workspace_ = workspace;\n  }\n\n  /**\n   * Gets the dimensions of the given workspace component, in pixel coordinates.\n   *\n   * @param elem The element to get the dimensions of, or null.  It should be a\n   *     toolbox or flyout, and should implement getWidth() and getHeight().\n   * @returns An object containing width and height attributes, which will both\n   *     be zero if elem did not exist.\n   */\n  protected getDimensionsPx_(elem: IToolbox|null|IFlyout): Size {\n    let width = 0;\n    let height = 0;\n    if (elem) {\n      width = elem.getWidth();\n      height = elem.getHeight();\n    }\n    return new Size(width, height);\n  }\n\n  /**\n   * Gets the width and the height of the flyout in pixel\n   * coordinates. By default, will get metrics for either a simple flyout (owned\n   * directly by the workspace) or for the flyout owned by the toolbox. If you\n   * pass `opt_own` as `true` then only metrics for the simple flyout will be\n   * returned, and it will return 0 for the width and height if the workspace\n   * has a category toolbox instead of a simple toolbox.\n   *\n   * @param opt_own Whether to only return the workspace's own flyout metrics.\n   * @returns The width and height of the flyout.\n   */\n  getFlyoutMetrics(opt_own?: boolean): ToolboxMetrics {\n    const flyoutDimensions =\n        this.getDimensionsPx_(this.workspace_.getFlyout(opt_own));\n    return {\n      width: flyoutDimensions.width,\n      height: flyoutDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width, height and position of the toolbox on the workspace in\n   * pixel coordinates. Returns 0 for the width and height if the workspace has\n   * a simple toolbox instead of a category toolbox. To get the width and height\n   * of a simple toolbox, see {@link MetricsManager#getFlyoutMetrics}.\n   *\n   * @returns The object with the width, height and position of the toolbox.\n   */\n  getToolboxMetrics(): ToolboxMetrics {\n    const toolboxDimensions =\n        this.getDimensionsPx_(this.workspace_.getToolbox());\n\n    return {\n      width: toolboxDimensions.width,\n      height: toolboxDimensions.height,\n      position: this.workspace_.toolboxPosition,\n    };\n  }\n\n  /**\n   * Gets the width and height of the workspace's parent SVG element in pixel\n   * coordinates. This area includes the toolbox and the visible workspace area.\n   *\n   * @returns The width and height of the workspace's parent SVG element.\n   */\n  getSvgMetrics(): Size {\n    return this.workspace_.getCachedParentSvgSize();\n  }\n\n  /**\n   * Gets the absolute left and absolute top in pixel coordinates.\n   * This is where the visible workspace starts in relation to the SVG\n   * container.\n   *\n   * @returns The absolute metrics for the workspace.\n   */\n  getAbsoluteMetrics(): AbsoluteMetrics {\n    let absoluteLeft = 0;\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const doesToolboxExist = !!this.workspace_.getToolbox();\n    const doesFlyoutExist = !!this.workspace_.getFlyout(true);\n    const toolboxPosition =\n        doesToolboxExist ? toolboxMetrics.position : flyoutMetrics.position;\n\n    const atLeft = toolboxPosition === toolboxUtils.Position.LEFT;\n    const atTop = toolboxPosition === toolboxUtils.Position.TOP;\n    if (doesToolboxExist && atLeft) {\n      absoluteLeft = toolboxMetrics.width;\n    } else if (doesFlyoutExist && atLeft) {\n      absoluteLeft = flyoutMetrics.width;\n    }\n    let absoluteTop = 0;\n    if (doesToolboxExist && atTop) {\n      absoluteTop = toolboxMetrics.height;\n    } else if (doesFlyoutExist && atTop) {\n      absoluteTop = flyoutMetrics.height;\n    }\n\n    return {\n      top: absoluteTop,\n      left: absoluteLeft,\n    };\n  }\n\n  /**\n   * Gets the metrics for the visible workspace in either pixel or workspace\n   * coordinates. The visible workspace does not include the toolbox or flyout.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the view metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The width, height, top and left of the viewport in either\n   *     workspace coordinates or pixel coordinates.\n   */\n  getViewMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const svgMetrics = this.getSvgMetrics();\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const doesToolboxExist = !!this.workspace_.getToolbox();\n    const toolboxPosition =\n        doesToolboxExist ? toolboxMetrics.position : flyoutMetrics.position;\n\n    if (this.workspace_.getToolbox()) {\n      if (toolboxPosition === toolboxUtils.Position.TOP ||\n          toolboxPosition === toolboxUtils.Position.BOTTOM) {\n        svgMetrics.height -= toolboxMetrics.height;\n      } else if (\n          toolboxPosition === toolboxUtils.Position.LEFT ||\n          toolboxPosition === toolboxUtils.Position.RIGHT) {\n        svgMetrics.width -= toolboxMetrics.width;\n      }\n    } else if (this.workspace_.getFlyout(true)) {\n      if (toolboxPosition === toolboxUtils.Position.TOP ||\n          toolboxPosition === toolboxUtils.Position.BOTTOM) {\n        svgMetrics.height -= flyoutMetrics.height;\n      } else if (\n          toolboxPosition === toolboxUtils.Position.LEFT ||\n          toolboxPosition === toolboxUtils.Position.RIGHT) {\n        svgMetrics.width -= flyoutMetrics.width;\n      }\n    }\n    return {\n      height: svgMetrics.height / scale,\n      width: svgMetrics.width / scale,\n      top: -this.workspace_.scrollY / scale,\n      left: -this.workspace_.scrollX / scale,\n    };\n  }\n\n  /**\n   * Gets content metrics in either pixel or workspace coordinates.\n   * The content area is a rectangle around all the top bounded elements on the\n   * workspace (workspace comments and blocks).\n   *\n   * @param opt_getWorkspaceCoordinates True to get the content metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @returns The metrics for the content container.\n   */\n  getContentMetrics(opt_getWorkspaceCoordinates?: boolean): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n    // Block bounding box is in workspace coordinates.\n    const blockBox = this.workspace_.getBlocksBoundingBox();\n\n    return {\n      height: (blockBox.bottom - blockBox.top) * scale,\n      width: (blockBox.right - blockBox.left) * scale,\n      top: blockBox.top * scale,\n      left: blockBox.left * scale,\n    };\n  }\n\n  /**\n   * Returns whether the scroll area has fixed edges.\n   *\n   * @returns Whether the scroll area has fixed edges.\n   * @internal\n   */\n  hasFixedEdges(): boolean {\n    // This exists for optimization of bump logic.\n    return !this.workspace_.isMovableHorizontally() ||\n        !this.workspace_.isMovableVertically();\n  }\n\n  /**\n   * Computes the fixed edges of the scroll area.\n   *\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @returns The fixed edges of the scroll area.\n   */\n  protected getComputedFixedEdges_(opt_viewMetrics?: ContainerRegion):\n      FixedEdges {\n    if (!this.hasFixedEdges()) {\n      // Return early if there are no edges.\n      return {};\n    }\n\n    const hScrollEnabled = this.workspace_.isMovableHorizontally();\n    const vScrollEnabled = this.workspace_.isMovableVertically();\n\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n\n    const edges = {} as FixedEdges;\n    if (!vScrollEnabled) {\n      edges.top = viewMetrics.top;\n      edges.bottom = viewMetrics.top + viewMetrics.height;\n    }\n    if (!hScrollEnabled) {\n      edges.left = viewMetrics.left;\n      edges.right = viewMetrics.left + viewMetrics.width;\n    }\n    return edges;\n  }\n\n  /**\n   * Returns the content area with added padding.\n   *\n   * @param viewMetrics The view metrics.\n   * @param contentMetrics The content metrics.\n   * @returns The padded content area.\n   */\n  protected getPaddedContent_(\n      viewMetrics: ContainerRegion, contentMetrics: ContainerRegion):\n      {top: number, bottom: number, left: number, right: number} {\n    const contentBottom = contentMetrics.top + contentMetrics.height;\n    const contentRight = contentMetrics.left + contentMetrics.width;\n\n    const viewWidth = viewMetrics.width;\n    const viewHeight = viewMetrics.height;\n    const halfWidth = viewWidth / 2;\n    const halfHeight = viewHeight / 2;\n\n    // Add a padding around the content that is at least half a screen wide.\n    // Ensure padding is wide enough that blocks can scroll over entire screen.\n    const top =\n        Math.min(contentMetrics.top - halfHeight, contentBottom - viewHeight);\n    const left =\n        Math.min(contentMetrics.left - halfWidth, contentRight - viewWidth);\n    const bottom =\n        Math.max(contentBottom + halfHeight, contentMetrics.top + viewHeight);\n    const right =\n        Math.max(contentRight + halfWidth, contentMetrics.left + viewWidth);\n\n    return {top, bottom, left, right};\n  }\n\n  /**\n   * Returns the metrics for the scroll area of the workspace.\n   *\n   * @param opt_getWorkspaceCoordinates True to get the scroll metrics in\n   *     workspace coordinates, false to get them in pixel coordinates.\n   * @param opt_viewMetrics The view metrics if they have been previously\n   *     computed. Passing in null may cause the view metrics to be computed\n   *     again, if it is needed.\n   * @param opt_contentMetrics The content metrics if they have been previously\n   *     computed. Passing in null may cause the content metrics to be computed\n   *     again, if it is needed.\n   * @returns The metrics for the scroll container.\n   */\n  getScrollMetrics(\n      opt_getWorkspaceCoordinates?: boolean, opt_viewMetrics?: ContainerRegion,\n      opt_contentMetrics?: ContainerRegion): ContainerRegion {\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n    const viewMetrics = opt_viewMetrics || this.getViewMetrics(false);\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const fixedEdges = this.getComputedFixedEdges_(viewMetrics);\n\n    // Add padding around content.\n    const paddedContent = this.getPaddedContent_(viewMetrics, contentMetrics);\n\n    // Use combination of fixed bounds and padded content to make scroll area.\n    const top =\n        fixedEdges.top !== undefined ? fixedEdges.top : paddedContent.top;\n    const left =\n        fixedEdges.left !== undefined ? fixedEdges.left : paddedContent.left;\n    const bottom = fixedEdges.bottom !== undefined ? fixedEdges.bottom :\n                                                     paddedContent.bottom;\n    const right =\n        fixedEdges.right !== undefined ? fixedEdges.right : paddedContent.right;\n\n    return {\n      top: top / scale,\n      left: left / scale,\n      width: (right - left) / scale,\n      height: (bottom - top) / scale,\n    };\n  }\n\n  /**\n   * Returns common metrics used by UI elements.\n   *\n   * @returns The UI metrics.\n   */\n  getUiMetrics(): UiMetrics {\n    return {\n      viewMetrics: this.getViewMetrics(),\n      absoluteMetrics: this.getAbsoluteMetrics(),\n      toolboxMetrics: this.getToolboxMetrics(),\n    };\n  }\n\n  /**\n   * Returns an object with all the metrics required to size scrollbars for a\n   * top level workspace.  The following properties are computed:\n   * Coordinate system: pixel coordinates, -left, -up, +right, +down\n   * .viewHeight: Height of the visible portion of the workspace.\n   * .viewWidth: Width of the visible portion of the workspace.\n   * .contentHeight: Height of the content.\n   * .contentWidth: Width of the content.\n   * .scrollHeight: Height of the scroll area.\n   * .scrollWidth: Width of the scroll area.\n   * .svgHeight: Height of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .svgWidth: Width of the Blockly div (the view + the toolbox,\n   *    simple or otherwise),\n   * .viewTop: Top-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .viewLeft: Left-edge of the visible portion of the workspace, relative to\n   *     the workspace origin.\n   * .contentTop: Top-edge of the content, relative to the workspace origin.\n   * .contentLeft: Left-edge of the content relative to the workspace origin.\n   * .scrollTop: Top-edge of the scroll area, relative to the workspace origin.\n   * .scrollLeft: Left-edge of the scroll area relative to the workspace origin.\n   * .absoluteTop: Top-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .absoluteLeft: Left-edge of the visible portion of the workspace, relative\n   *     to the blocklyDiv.\n   * .toolboxWidth: Width of the toolbox, if it exists.  Otherwise zero.\n   * .toolboxHeight: Height of the toolbox, if it exists.  Otherwise zero.\n   * .flyoutWidth: Width of the flyout if it is always open.  Otherwise zero.\n   * .flyoutHeight: Height of the flyout if it is always open.  Otherwise zero.\n   * .toolboxPosition: Top, bottom, left or right. Use TOOLBOX_AT constants to\n   *     compare.\n   *\n   * @returns Contains size and position metrics of a top level workspace.\n   */\n  getMetrics(): Metrics {\n    const toolboxMetrics = this.getToolboxMetrics();\n    const flyoutMetrics = this.getFlyoutMetrics(true);\n    const svgMetrics = this.getSvgMetrics();\n    const absoluteMetrics = this.getAbsoluteMetrics();\n    const viewMetrics = this.getViewMetrics();\n    const contentMetrics = this.getContentMetrics();\n    const scrollMetrics =\n        this.getScrollMetrics(false, viewMetrics, contentMetrics);\n\n    return {\n      contentHeight: contentMetrics.height,\n      contentWidth: contentMetrics.width,\n      contentTop: contentMetrics.top,\n      contentLeft: contentMetrics.left,\n\n      scrollHeight: scrollMetrics.height,\n      scrollWidth: scrollMetrics.width,\n      scrollTop: scrollMetrics.top,\n      scrollLeft: scrollMetrics.left,\n\n      viewHeight: viewMetrics.height,\n      viewWidth: viewMetrics.width,\n      viewTop: viewMetrics.top,\n      viewLeft: viewMetrics.left,\n\n      absoluteTop: absoluteMetrics.top,\n      absoluteLeft: absoluteMetrics.left,\n\n      svgHeight: svgMetrics.height,\n      svgWidth: svgMetrics.width,\n\n      toolboxWidth: toolboxMetrics.width,\n      toolboxHeight: toolboxMetrics.height,\n      toolboxPosition: toolboxMetrics.position,\n\n      flyoutWidth: flyoutMetrics.width,\n      flyoutHeight: flyoutMetrics.height,\n    };\n  }\n}\n\nexport namespace MetricsManager {\n  /**\n   * Describes the width, height and location of the toolbox on the main\n   * workspace.\n   */\n  export interface ToolboxMetrics {\n    width: number;\n    height: number;\n    position: toolboxUtils.Position;\n  }\n\n  /** Describes where the viewport starts in relation to the workspace SVG. */\n  export interface AbsoluteMetrics {\n    left: number;\n    top: number;\n  }\n\n  /**\n   * All the measurements needed to describe the size and location of a\n   * container.\n   */\n  export interface ContainerRegion {\n    height: number;\n    width: number;\n    top: number;\n    left: number;\n  }\n\n  /** Describes fixed edges of the workspace. */\n  export interface FixedEdges {\n    top?: number;\n    bottom?: number;\n    left?: number;\n    right?: number;\n  }\n\n  /** Common metrics used for UI elements. */\n  export interface UiMetrics {\n    viewMetrics: ContainerRegion;\n    absoluteMetrics: AbsoluteMetrics;\n    toolboxMetrics: ToolboxMetrics;\n  }\n}\n\nexport type ToolboxMetrics = MetricsManager.ToolboxMetrics;\nexport type AbsoluteMetrics = MetricsManager.AbsoluteMetrics;\nexport type ContainerRegion = MetricsManager.ContainerRegion;\nexport type FixedEdges = MetricsManager.FixedEdges;\nexport type UiMetrics = MetricsManager.UiMetrics;\n\nregistry.register(\n    registry.Type.METRICS_MANAGER, registry.DEFAULT, MetricsManager);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Calculates and reports flyout workspace metrics.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.FlyoutMetricsManager');\n\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport {ContainerRegion, MetricsManager} from './metrics_manager.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Calculates metrics for a flyout's workspace.\n * The metrics are mainly used to size scrollbars for the flyout.\n */\nexport class FlyoutMetricsManager extends MetricsManager {\n  /** The flyout that owns the workspace to calculate metrics for. */\n  protected flyout_: IFlyout;\n\n  /**\n   * @param workspace The flyout's workspace.\n   * @param flyout The flyout.\n   */\n  constructor(workspace: WorkspaceSvg, flyout: IFlyout) {\n    super(workspace);\n    this.flyout_ = flyout;\n  }\n\n  /**\n   * Gets the bounding box of the blocks on the flyout's workspace.\n   * This is in workspace coordinates.\n   *\n   * @returns The bounding box of the blocks on the workspace.\n   */\n  private getBoundingBox_(): SVGRect|\n      {height: number, y: number, width: number, x: number} {\n    let blockBoundingBox;\n    try {\n      blockBoundingBox = this.workspace_.getCanvas().getBBox();\n    } catch (e) {\n      // Firefox has trouble with hidden elements (Bug 528969).\n      // 2021 Update: It looks like this was fixed around Firefox 77 released in\n      // 2020.\n      blockBoundingBox = {height: 0, y: 0, width: 0, x: 0};\n    }\n    return blockBoundingBox;\n  }\n\n  override getContentMetrics(opt_getWorkspaceCoordinates?: boolean) {\n    // The bounding box is in workspace coordinates.\n    const blockBoundingBox = this.getBoundingBox_();\n    const scale = opt_getWorkspaceCoordinates ? 1 : this.workspace_.scale;\n\n    return {\n      height: blockBoundingBox.height * scale,\n      width: blockBoundingBox.width * scale,\n      top: blockBoundingBox.y * scale,\n      left: blockBoundingBox.x * scale,\n    };\n  }\n\n  override getScrollMetrics(\n      opt_getWorkspaceCoordinates?: boolean, opt_viewMetrics?: ContainerRegion,\n      opt_contentMetrics?: ContainerRegion) {\n    const contentMetrics = opt_contentMetrics || this.getContentMetrics();\n    const margin = this.flyout_.MARGIN * this.workspace_.scale;\n    const scale = opt_getWorkspaceCoordinates ? this.workspace_.scale : 1;\n\n    // The left padding isn't just the margin. Some blocks are also offset by\n    // tabWidth so that value and statement blocks line up.\n    // The contentMetrics.left value is equivalent to the variable left padding.\n    const leftPadding = contentMetrics.left;\n\n    return {\n      height: (contentMetrics.height + 2 * margin) / scale,\n      width: (contentMetrics.width + leftPadding + margin) / scale,\n      top: 0,\n      left: 0,\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a pair of scrollbars.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ScrollbarPair');\n\nimport * as eventUtils from './events/utils.js';\nimport {Scrollbar} from './scrollbar.js';\nimport * as dom from './utils/dom.js';\nimport type {Metrics} from './utils/metrics.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a pair of scrollbars.  Horizontal and vertical.\n */\nexport class ScrollbarPair {\n  hScroll: Scrollbar|null = null;\n  vScroll: Scrollbar|null = null;\n  corner_: SVGRectElement|null = null;\n\n  /** Previously recorded metrics from the workspace. */\n  private oldHostMetrics_: Metrics|null = null;\n\n  /**\n   * @param workspace Workspace to bind the scrollbars to.\n   * @param addHorizontal Whether to add a horizontal scrollbar.\n   *    Defaults to true.\n   * @param addVertical Whether to add a vertical scrollbar. Defaults to true.\n   * @param opt_class A class to be applied to these scrollbars.\n   * @param opt_margin The margin to apply to these scrollbars.\n   */\n  constructor(\n      private workspace: WorkspaceSvg, addHorizontal?: boolean,\n      addVertical?: boolean, opt_class?: string, opt_margin?: number) {\n    addHorizontal = addHorizontal === undefined ? true : addHorizontal;\n    addVertical = addVertical === undefined ? true : addVertical;\n    const isPair = addHorizontal && addVertical;\n\n    if (addHorizontal) {\n      this.hScroll =\n          new Scrollbar(workspace, true, isPair, opt_class, opt_margin);\n    }\n    if (addVertical) {\n      this.vScroll =\n          new Scrollbar(workspace, false, isPair, opt_class, opt_margin);\n    }\n\n    if (isPair) {\n      this.corner_ = dom.createSvgElement(Svg.RECT, {\n        'height': Scrollbar.scrollbarThickness,\n        'width': Scrollbar.scrollbarThickness,\n        'class': 'blocklyScrollbarBackground',\n      });\n      dom.insertAfter(this.corner_, workspace.getBubbleCanvas());\n    }\n  }\n\n  /**\n   * Dispose of this pair of scrollbars.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    dom.removeNode(this.corner_);\n    this.corner_ = null;\n    this.oldHostMetrics_ = null;\n    if (this.hScroll) {\n      this.hScroll.dispose();\n      this.hScroll = null;\n    }\n    if (this.vScroll) {\n      this.vScroll.dispose();\n      this.vScroll = null;\n    }\n  }\n\n  /**\n   * Recalculate both of the scrollbars' locations and lengths.\n   * Also reposition the corner rectangle.\n   */\n  resize() {\n    // Look up the host metrics once, and use for both scrollbars.\n    const hostMetrics = this.workspace.getMetrics();\n    if (!hostMetrics) {\n      // Host element is likely not visible.\n      return;\n    }\n\n    // Only change the scrollbars if there has been a change in metrics.\n    let resizeH = false;\n    let resizeV = false;\n    if (!this.oldHostMetrics_ ||\n        this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n        this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n        this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop ||\n        this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft) {\n      // The window has been resized or repositioned.\n      resizeH = true;\n      resizeV = true;\n    } else {\n      // Has the content been resized or moved?\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.scrollWidth !== hostMetrics.scrollWidth ||\n          this.oldHostMetrics_.viewLeft !== hostMetrics.viewLeft ||\n          this.oldHostMetrics_.scrollLeft !== hostMetrics.scrollLeft) {\n        resizeH = true;\n      }\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.scrollHeight !== hostMetrics.scrollHeight ||\n          this.oldHostMetrics_.viewTop !== hostMetrics.viewTop ||\n          this.oldHostMetrics_.scrollTop !== hostMetrics.scrollTop) {\n        resizeV = true;\n      }\n    }\n\n    if (resizeH || resizeV) {\n      try {\n        eventUtils.disable();\n        if (this.hScroll && resizeH) {\n          this.hScroll.resize(hostMetrics);\n        }\n        if (this.vScroll && resizeV) {\n          this.vScroll.resize(hostMetrics);\n        }\n      } finally {\n        eventUtils.enable();\n      }\n      this.workspace.maybeFireViewportChangeEvent();\n    }\n\n    if (this.hScroll && this.vScroll) {\n      // Reposition the corner square.\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.viewWidth !== hostMetrics.viewWidth ||\n          this.oldHostMetrics_.absoluteLeft !== hostMetrics.absoluteLeft) {\n        this.corner_?.setAttribute('x', String(this.vScroll.position.x));\n      }\n      if (!this.oldHostMetrics_ ||\n          this.oldHostMetrics_.viewHeight !== hostMetrics.viewHeight ||\n          this.oldHostMetrics_.absoluteTop !== hostMetrics.absoluteTop) {\n        this.corner_?.setAttribute('y', String(this.hScroll.position.y));\n      }\n    }\n\n    // Cache the current metrics to potentially short-cut the next resize event.\n    this.oldHostMetrics_ = hostMetrics;\n  }\n\n  /**\n   * Returns whether scrolling horizontally is enabled.\n   *\n   * @returns True if horizontal scroll is enabled.\n   */\n  canScrollHorizontally(): boolean {\n    return !!this.hScroll;\n  }\n\n  /**\n   * Returns whether scrolling vertically is enabled.\n   *\n   * @returns True if vertical scroll is enabled.\n   */\n  canScrollVertically(): boolean {\n    return !!this.vScroll;\n  }\n\n  /**\n   * Record the origin of the workspace that the scrollbar is in, in pixels\n   * relative to the injection div origin. This is for times when the scrollbar\n   * is used in an object whose origin isn't the same as the main workspace\n   * (e.g. in a flyout.)\n   *\n   * @param x The x coordinate of the scrollbar's origin, in CSS pixels.\n   * @param y The y coordinate of the scrollbar's origin, in CSS pixels.\n   * @internal\n   */\n  setOrigin(x: number, y: number) {\n    if (this.hScroll) {\n      this.hScroll.setOrigin(x, y);\n    }\n    if (this.vScroll) {\n      this.vScroll.setOrigin(x, y);\n    }\n  }\n\n  /**\n   * Set the handles of both scrollbars.\n   *\n   * @param x The horizontal content displacement, relative to the view in\n   *     pixels.\n   * @param y The vertical content displacement, relative to the view in pixels.\n   * @param updateMetrics Whether to update metrics on this set call.\n   *    Defaults to true.\n   */\n  set(x: number, y: number, updateMetrics: boolean) {\n    // This function is equivalent to:\n    //   this.hScroll.set(x);\n    //   this.vScroll.set(y);\n    // However, that calls setMetrics twice which causes a chain of\n    // getAttribute->setAttribute->getAttribute resulting in an extra layout\n    // pass. Combining them speeds up rendering.\n    if (this.hScroll) {\n      this.hScroll.set(x, false);\n    }\n    if (this.vScroll) {\n      this.vScroll.set(y, false);\n    }\n\n    if (updateMetrics || updateMetrics === undefined) {\n      // Update metrics.\n      const xyRatio: {x?: number, y?: number} = {};\n      if (this.hScroll) {\n        xyRatio.x = this.hScroll.getRatio_();\n      }\n      if (this.vScroll) {\n        xyRatio.y = this.vScroll.getRatio_();\n      }\n      this.workspace.setMetrics(xyRatio);\n    }\n  }\n\n  /**\n   * Set the handle of the horizontal scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param x Horizontal scroll value.\n   */\n  setX(x: number) {\n    if (this.hScroll) {\n      this.hScroll.set(x, true);\n    }\n  }\n\n  /**\n   * Set the handle of the vertical scrollbar to be at a certain position in\n   *    CSS pixels relative to its parents.\n   *\n   * @param y Vertical scroll value.\n   */\n  setY(y: number) {\n    if (this.vScroll) {\n      this.vScroll.set(y, true);\n    }\n  }\n\n  /**\n   * Set whether this scrollbar's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    if (this.hScroll) {\n      this.hScroll.setContainerVisible(visible);\n    }\n    if (this.vScroll) {\n      this.vScroll.setContainerVisible(visible);\n    }\n  }\n\n  /**\n   * If any of the scrollbars are visible. Non-paired scrollbars may disappear\n   * when they aren't needed.\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    let isVisible = false;\n    if (this.hScroll) {\n      isVisible = this.hScroll.isVisible();\n    }\n    if (this.vScroll) {\n      isVisible = isVisible || this.vScroll.isVisible();\n    }\n    return isVisible;\n  }\n\n  /**\n   * Recalculates the scrollbars' locations within their path and length.\n   * This should be called when the contents of the workspace have changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeContent(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeContentHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeContentVertical(hostMetrics);\n    }\n  }\n\n  /**\n   * Recalculates the scrollbars' locations on the screen and path length.\n   * This should be called when the layout or size of the window has changed.\n   *\n   * @param hostMetrics A data structure describing all the required dimensions,\n   *     possibly fetched from the host object.\n   */\n  resizeView(hostMetrics: Metrics) {\n    if (this.hScroll) {\n      this.hScroll.resizeViewHorizontal(hostMetrics);\n    }\n    if (this.vScroll) {\n      this.vScroll.resizeViewVertical(hostMetrics);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Methods for dragging a workspace visually.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceDragger');\n\nimport * as common from './common.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a workspace dragger.  It moves the workspace around when it is\n * being dragged by a mouse or touch.\n * Note that the workspace itself manages whether or not it has a drag surface\n * and how to do translations based on that.  This simply passes the right\n * commands based on events.\n */\nexport class WorkspaceDragger {\n  private readonly horizontalScrollEnabled_: boolean;\n  private readonly verticalScrollEnabled_: boolean;\n  protected startScrollXY_: Coordinate;\n\n  /** @param workspace The workspace to drag. */\n  constructor(private workspace: WorkspaceSvg) {\n    /** Whether horizontal scroll is enabled. */\n    this.horizontalScrollEnabled_ = this.workspace.isMovableHorizontally();\n\n    /** Whether vertical scroll is enabled. */\n    this.verticalScrollEnabled_ = this.workspace.isMovableVertically();\n\n    /**\n     * The scroll position of the workspace at the beginning of the drag.\n     * Coordinate system: pixel coordinates.\n     */\n    this.startScrollXY_ = new Coordinate(workspace.scrollX, workspace.scrollY);\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @suppress {checkTypes}\n   * @internal\n   */\n  dispose() {\n    // AnyDuringMigration because:  Type 'null' is not assignable to type\n    // 'WorkspaceSvg'.\n    this.workspace = null as AnyDuringMigration;\n  }\n\n  /**\n   * Start dragging the workspace.\n   *\n   * @internal\n   */\n  startDrag() {\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.workspace.setupDragSurface();\n  }\n\n  /**\n   * Finish dragging the workspace and put everything back where it belongs.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  endDrag(currentDragDeltaXY: Coordinate) {\n    // Make sure everything is up to date.\n    this.drag(currentDragDeltaXY);\n    this.workspace.resetDragSurface();\n  }\n\n  /**\n   * Move the workspace based on the most recent mouse movements.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at the start of the drag, in pixel coordinates.\n   * @internal\n   */\n  drag(currentDragDeltaXY: Coordinate) {\n    const newXY = Coordinate.sum(this.startScrollXY_, currentDragDeltaXY);\n\n    if (this.horizontalScrollEnabled_ && this.verticalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, newXY.y);\n    } else if (this.horizontalScrollEnabled_) {\n      this.workspace.scroll(newXY.x, this.workspace.scrollY);\n    } else if (this.verticalScrollEnabled_) {\n      this.workspace.scroll(this.workspace.scrollX, newXY.y);\n    } else {\n      throw new TypeError('Invalid state.');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The class representing an in-progress gesture, e.g. a drag,\n * tap, or pinch to zoom.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Gesture');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as blockAnimations from './block_animations.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport {BubbleDragger} from './bubble_dragger.js';\nimport * as common from './common.js';\nimport {config} from './config.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport * as eventUtils from './events/utils.js';\nimport type {Field} from './field.js';\nimport type {IBlockDragger} from './interfaces/i_block_dragger.js';\nimport type {IBubble} from './interfaces/i_bubble.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport * as internalConstants from './internal_constants.js';\nimport * as registry from './registry.js';\nimport * as Tooltip from './tooltip.js';\nimport * as Touch from './touch.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport {WorkspaceCommentSvg} from './workspace_comment_svg.js';\nimport {WorkspaceDragger} from './workspace_dragger.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Note: In this file \"start\" refers to pointerdown\n * events.  \"End\" refers to pointerup events.\n */\n\n/** A multiplier used to convert the gesture scale to a zoom in delta. */\nconst ZOOM_IN_MULTIPLIER = 5;\n\n/** A multiplier used to convert the gesture scale to a zoom out delta. */\nconst ZOOM_OUT_MULTIPLIER = 6;\n\n/**\n * Class for one gesture.\n */\nexport class Gesture {\n  /**\n   * The position of the pointer when the gesture started.  Units are CSS\n   * pixels, with (0, 0) at the top left of the browser window (pointer event\n   * clientX/Y).\n   */\n  private mouseDownXY_ = new Coordinate(0, 0);\n  private currentDragDeltaXY_: Coordinate;\n\n  /**\n   * The bubble that the gesture started on, or null if it did not start on a\n   * bubble.\n   */\n  private startBubble_: IBubble|null = null;\n\n  /**\n   * The field that the gesture started on, or null if it did not start on a\n   * field.\n   */\n  private startField_: Field|null = null;\n\n  /**\n   * The block that the gesture started on, or null if it did not start on a\n   * block.\n   */\n  private startBlock_: BlockSvg|null = null;\n\n  /**\n   * The block that this gesture targets.  If the gesture started on a\n   * shadow block, this is the first non-shadow parent of the block.  If the\n   * gesture started in the flyout, this is the root block of the block group\n   * that was clicked or dragged.\n   */\n  private targetBlock_: BlockSvg|null = null;\n\n  /**\n   * The workspace that the gesture started on.  There may be multiple\n   * workspaces on a page; this is more accurate than using\n   * Blockly.common.getMainWorkspace().\n   */\n  protected startWorkspace_: WorkspaceSvg|null = null;\n\n  /**\n   * Whether the pointer has at any point moved out of the drag radius.\n   * A gesture that exceeds the drag radius is a drag even if it ends exactly\n   * at its start point.\n   */\n  private hasExceededDragRadius_ = false;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** The object tracking a bubble drag, or null if none is in progress. */\n  private bubbleDragger_: BubbleDragger|null = null;\n\n  /** The object tracking a block drag, or null if none is in progress. */\n  private blockDragger_: IBlockDragger|null = null;\n\n  /**\n   * The object tracking a workspace or flyout workspace drag, or null if none\n   * is in progress.\n   */\n  private workspaceDragger_: WorkspaceDragger|null = null;\n\n  /** The flyout a gesture started in, if any. */\n  private flyout_: IFlyout|null = null;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private calledUpdateIsDragging_ = false;\n\n  /** Boolean for sanity-checking that some code is only called once. */\n  private hasStarted_ = false;\n\n  /** Boolean used internally to break a cycle in disposal. */\n  protected isEnding_ = false;\n  private healStack_: boolean;\n\n  /** The event that most recently updated this gesture. */\n  private mostRecentEvent_: PointerEvent;\n\n  /** Boolean for whether or not this gesture is a multi-touch gesture. */\n  private isMultiTouch_ = false;\n\n  /** A map of cached points used for tracking multi-touch gestures. */\n  private cachedPoints = new Map<string, Coordinate|null>();\n\n  /**\n   * This is the ratio between the starting distance between the touch points\n   * and the most recent distance between the touch points.\n   * Scales between 0 and 1 mean the most recent zoom was a zoom out.\n   * Scales above 1.0 mean the most recent zoom was a zoom in.\n   */\n  private previousScale_ = 0;\n\n  /** The starting distance between two touch points. */\n  private startDistance_ = 0;\n\n  /** Boolean for whether or not the workspace supports pinch-zoom. */\n  private isPinchZoomEnabled_: boolean|null = null;\n\n  /**\n   * The owner of the dropdownDiv when this gesture first starts.\n   * Needed because we'll close the dropdown before fields get to\n   * act on their events, and some fields care about who owns\n   * the dropdown.\n   */\n  currentDropdownOwner: Field|null = null;\n\n  /**\n   * @param e The event that kicked off this gesture.\n   * @param creatorWorkspace The workspace that created this gesture and has a\n   *     reference to it.\n   */\n  constructor(\n      e: PointerEvent, private readonly creatorWorkspace: WorkspaceSvg) {\n    this.mostRecentEvent_ = e;\n\n    /**\n     * How far the pointer has moved during this drag, in pixel units.\n     * (0, 0) is at this.mouseDownXY_.\n     */\n    this.currentDragDeltaXY_ = new Coordinate(0, 0);\n\n    /**\n     * Boolean used to indicate whether or not to heal the stack after\n     * disconnecting a block.\n     */\n    this.healStack_ = !internalConstants.DRAG_STACK;\n  }\n\n  /**\n   * Sever all links from this object.\n   *\n   * @internal\n   */\n  dispose() {\n    Touch.clearTouchIdentifier();\n    Tooltip.unblock();\n    // Clear the owner's reference to this gesture.\n    this.creatorWorkspace.clearGesture();\n\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n\n    if (this.blockDragger_) {\n      this.blockDragger_.dispose();\n    }\n    if (this.workspaceDragger_) {\n      this.workspaceDragger_.dispose();\n    }\n  }\n\n  /**\n   * Update internal state based on an event.\n   *\n   * @param e The most recent pointer event.\n   */\n  private updateFromEvent_(e: PointerEvent) {\n    const currentXY = new Coordinate(e.clientX, e.clientY);\n    const changed = this.updateDragDelta_(currentXY);\n    // Exceeded the drag radius for the first time.\n    if (changed) {\n      this.updateIsDragging_();\n      Touch.longStop();\n    }\n    this.mostRecentEvent_ = e;\n  }\n\n  /**\n   * DO MATH to set currentDragDeltaXY_ based on the most recent pointer\n   * position.\n   *\n   * @param currentXY The most recent pointer position, in pixel units,\n   *     with (0, 0) at the window's top left corner.\n   * @returns True if the drag just exceeded the drag radius for the first time.\n   */\n  private updateDragDelta_(currentXY: Coordinate): boolean {\n    this.currentDragDeltaXY_ =\n        Coordinate.difference(currentXY, (this.mouseDownXY_));\n\n    if (!this.hasExceededDragRadius_) {\n      const currentDragDelta = Coordinate.magnitude(this.currentDragDeltaXY_);\n\n      // The flyout has a different drag radius from the rest of Blockly.\n      const limitRadius =\n          this.flyout_ ? config.flyoutDragRadius : config.dragRadius;\n\n      this.hasExceededDragRadius_ = currentDragDelta > limitRadius;\n      return this.hasExceededDragRadius_;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a block is being dragged from the\n   * flyout.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged from the flyout this function creates\n   * the new block on the main workspace and updates targetBlock_ and\n   * startWorkspace_.\n   *\n   * @returns True if a block is being dragged from the flyout.\n   */\n  private updateIsDraggingFromFlyout_(): boolean {\n    if (!this.targetBlock_ ||\n        !this.flyout_?.isBlockCreatable(this.targetBlock_)) {\n      return false;\n    }\n    if (!this.flyout_.targetWorkspace) {\n      throw new Error(`Cannot update dragging from the flyout because the ' +\n          'flyout's target workspace is undefined`);\n    }\n    if (!this.flyout_.isScrollable() ||\n        this.flyout_.isDragTowardWorkspace(this.currentDragDeltaXY_)) {\n      this.startWorkspace_ = this.flyout_.targetWorkspace;\n      this.startWorkspace_.updateScreenCalculationsIfScrolled();\n      // Start the event group now, so that the same event group is used for\n      // block creation and block dragging.\n      if (!eventUtils.getGroup()) {\n        eventUtils.setGroup(true);\n      }\n      // The start block is no longer relevant, because this is a drag.\n      this.startBlock_ = null;\n      this.targetBlock_ = this.flyout_.createBlock(this.targetBlock_);\n      this.targetBlock_.select();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Update this gesture to record whether a bubble is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a bubble should be dragged this function creates the necessary\n   * BubbleDragger and starts the drag.\n   *\n   * @returns True if a bubble is being dragged.\n   */\n  private updateIsDraggingBubble_(): boolean {\n    if (!this.startBubble_) {\n      return false;\n    }\n\n    this.startDraggingBubble_();\n    return true;\n  }\n\n  /**\n   * Check whether to start a block drag. If a block should be dragged, either\n   * from the flyout or in the workspace, create the necessary BlockDragger and\n   * start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a block should be dragged, either from the flyout or in the\n   * workspace, this function creates the necessary BlockDragger and starts the\n   * drag.\n   *\n   * @returns True if a block is being dragged.\n   */\n  private updateIsDraggingBlock_(): boolean {\n    if (!this.targetBlock_) {\n      return false;\n    }\n    if (this.flyout_) {\n      if (this.updateIsDraggingFromFlyout_()) {\n        this.startDraggingBlock_();\n        return true;\n      }\n    } else if (this.targetBlock_.isMovable()) {\n      this.startDraggingBlock_();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Check whether to start a workspace drag. If a workspace is being dragged,\n   * create the necessary WorkspaceDragger and start the drag.\n   *\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture. If a workspace is being dragged this function creates the\n   * necessary WorkspaceDragger and starts the drag.\n   */\n  private updateIsDraggingWorkspace_() {\n    if (!this.startWorkspace_) {\n      throw new Error(\n          'Cannot update dragging the workspace because the ' +\n          'start workspace is undefined');\n    }\n\n    const wsMovable = this.flyout_ ?\n        this.flyout_.isScrollable() :\n        this.startWorkspace_ && this.startWorkspace_.isDraggable();\n    if (!wsMovable) return;\n\n    this.workspaceDragger_ = new WorkspaceDragger(this.startWorkspace_);\n\n    this.workspaceDragger_.startDrag();\n  }\n\n  /**\n   * Update this gesture to record whether anything is being dragged.\n   * This function should be called on a pointermove event the first time\n   * the drag radius is exceeded.  It should be called no more than once per\n   * gesture.\n   */\n  private updateIsDragging_() {\n    // Sanity check.\n    if (this.calledUpdateIsDragging_) {\n      throw Error('updateIsDragging_ should only be called once per gesture.');\n    }\n    this.calledUpdateIsDragging_ = true;\n\n    // First check if it was a bubble drag.  Bubbles always sit on top of\n    // blocks.\n    if (this.updateIsDraggingBubble_()) {\n      return;\n    }\n    // Then check if it was a block drag.\n    if (this.updateIsDraggingBlock_()) {\n      return;\n    }\n    // Then check if it's a workspace drag.\n    this.updateIsDraggingWorkspace_();\n  }\n\n  /** Create a block dragger and start dragging the selected block. */\n  private startDraggingBlock_() {\n    const BlockDraggerClass = registry.getClassFromOptions(\n        registry.Type.BLOCK_DRAGGER, this.creatorWorkspace.options, true);\n\n    this.blockDragger_ =\n        new BlockDraggerClass!((this.targetBlock_), (this.startWorkspace_));\n    this.blockDragger_!.startDrag(this.currentDragDeltaXY_, this.healStack_);\n    this.blockDragger_!.drag(this.mostRecentEvent_, this.currentDragDeltaXY_);\n  }\n\n  // TODO (fenichel): Possibly combine this and startDraggingBlock_.\n  /** Create a bubble dragger and start dragging the selected bubble. */\n  private startDraggingBubble_() {\n    if (!this.startBubble_) {\n      throw new Error(\n          'Cannot update dragging the bubble because the start ' +\n          'bubble is undefined');\n    }\n    if (!this.startWorkspace_) {\n      throw new Error(\n          'Cannot update dragging the bubble because the start ' +\n          'workspace is undefined');\n    }\n\n    this.bubbleDragger_ =\n        new BubbleDragger(this.startBubble_, this.startWorkspace_);\n    this.bubbleDragger_.startBubbleDrag();\n    this.bubbleDragger_.dragBubble(\n        this.mostRecentEvent_, this.currentDragDeltaXY_);\n  }\n\n  /**\n   * Start a gesture: update the workspace to indicate that a gesture is in\n   * progress and bind pointermove and pointerup handlers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  doStart(e: PointerEvent) {\n    if (!this.startWorkspace_) {\n      throw new Error(\n          'Cannot start the touch gesture becauase the start ' +\n          'workspace is undefined');\n    }\n    this.isPinchZoomEnabled_ = this.startWorkspace_.options.zoomOptions &&\n        this.startWorkspace_.options.zoomOptions.pinch;\n\n    if (browserEvents.isTargetInput(e)) {\n      this.cancel();\n      return;\n    }\n\n    this.hasStarted_ = true;\n\n    blockAnimations.disconnectUiStop();\n\n    this.startWorkspace_.updateScreenCalculationsIfScrolled();\n    if (this.startWorkspace_.isMutator) {\n      // Mutator's coordinate system could be out of date because the bubble was\n      // dragged, the block was moved, the parent workspace zoomed, etc.\n      this.startWorkspace_.resize();\n    }\n\n    // Keep track of which field owns the dropdown before we close it.\n    this.currentDropdownOwner = dropDownDiv.getOwner();\n    // Hide chaff also hides the flyout, so don't do it if the click is in a\n    // flyout.\n    this.startWorkspace_.hideChaff(!!this.flyout_);\n\n    this.startWorkspace_.markFocused();\n    this.mostRecentEvent_ = e;\n\n    Tooltip.block();\n\n    if (this.targetBlock_) {\n      this.targetBlock_.select();\n    }\n\n    if (browserEvents.isRightButton(e)) {\n      this.handleRightClick(e);\n      return;\n    }\n\n    if (e.type.toLowerCase() === 'pointerdown' && e.pointerType !== 'mouse') {\n      Touch.longStart(e, this);\n    }\n\n    this.mouseDownXY_ = new Coordinate(e.clientX, e.clientY);\n    this.healStack_ = e.altKey || e.ctrlKey || e.metaKey;\n\n    this.bindMouseEvents(e);\n\n    if (!this.isEnding_) {\n      this.handleTouchStart(e);\n    }\n  }\n\n  /**\n   * Bind gesture events.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  bindMouseEvents(e: PointerEvent) {\n    this.boundEvents.push(browserEvents.conditionalBind(\n        document, 'pointerdown', null, this.handleStart.bind(this),\n        /* opt_noCaptureIdentifier */ true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        document, 'pointermove', null, this.handleMove.bind(this),\n        /* opt_noCaptureIdentifier */ true));\n    this.boundEvents.push(browserEvents.conditionalBind(\n        document, 'pointerup', null, this.handleUp.bind(this),\n        /* opt_noCaptureIdentifier */ true));\n\n    e.preventDefault();\n    e.stopPropagation();\n  }\n\n  /**\n   * Handle a pointerdown event.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleStart(e: PointerEvent) {\n    if (this.isDragging()) {\n      // A drag has already started, so this can no longer be a pinch-zoom.\n      return;\n    }\n    this.handleTouchStart(e);\n\n    if (this.isMultiTouch()) {\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointermove event.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleMove(e: PointerEvent) {\n    if ((this.isDragging() && Touch.shouldHandleEvent(e)) ||\n        !this.isMultiTouch()) {\n      this.updateFromEvent_(e);\n      if (this.workspaceDragger_) {\n        this.workspaceDragger_.drag(this.currentDragDeltaXY_);\n      } else if (this.blockDragger_) {\n        this.blockDragger_.drag(\n            this.mostRecentEvent_, this.currentDragDeltaXY_);\n      } else if (this.bubbleDragger_) {\n        this.bubbleDragger_.dragBubble(\n            this.mostRecentEvent_, this.currentDragDeltaXY_);\n      }\n      e.preventDefault();\n      e.stopPropagation();\n    } else if (this.isMultiTouch()) {\n      this.handleTouchMove(e);\n      Touch.longStop();\n    }\n  }\n\n  /**\n   * Handle a pointerup event.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleUp(e: PointerEvent) {\n    if (!this.isDragging()) {\n      this.handleTouchEnd(e);\n    }\n    if (!this.isMultiTouch() || this.isDragging()) {\n      if (!Touch.shouldHandleEvent(e)) {\n        return;\n      }\n      this.updateFromEvent_(e);\n      Touch.longStop();\n\n      if (this.isEnding_) {\n        console.log('Trying to end a gesture recursively.');\n        return;\n      }\n      this.isEnding_ = true;\n      // The ordering of these checks is important: drags have higher priority\n      // than clicks.  Fields have higher priority than blocks; blocks have\n      // higher priority than workspaces. The ordering within drags does not\n      // matter, because the three types of dragging are exclusive.\n      if (this.bubbleDragger_) {\n        this.bubbleDragger_.endBubbleDrag(e, this.currentDragDeltaXY_);\n      } else if (this.blockDragger_) {\n        this.blockDragger_.endDrag(e, this.currentDragDeltaXY_);\n      } else if (this.workspaceDragger_) {\n        this.workspaceDragger_.endDrag(this.currentDragDeltaXY_);\n      } else if (this.isBubbleClick_()) {\n        // Bubbles are in front of all fields and blocks.\n        this.doBubbleClick_();\n      } else if (this.isFieldClick_()) {\n        this.doFieldClick_();\n      } else if (this.isBlockClick_()) {\n        this.doBlockClick_();\n      } else if (this.isWorkspaceClick_()) {\n        this.doWorkspaceClick_(e);\n      }\n\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    } else {\n      e.preventDefault();\n      e.stopPropagation();\n\n      this.dispose();\n    }\n  }\n\n  /**\n   * Handle a pointerdown event and keep track of current\n   * pointers.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleTouchStart(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // store the pointerId in the current list of pointers\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n    const pointers = Array.from(this.cachedPoints.keys());\n    // If two pointers are down, store info\n    if (pointers.length === 2) {\n      const point0 = (this.cachedPoints.get(pointers[0]))!;\n      const point1 = (this.cachedPoints.get(pointers[1]))!;\n      this.startDistance_ = Coordinate.distance(point0, point1);\n      this.isMultiTouch_ = true;\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Handle a pointermove event and zoom in/out if two pointers\n   * are on the screen.\n   *\n   * @param e A pointermove event.\n   * @internal\n   */\n  handleTouchMove(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    // Update the cache\n    this.cachedPoints.set(pointerId, this.getTouchPoint(e));\n\n    if (this.isPinchZoomEnabled_ && this.cachedPoints.size === 2) {\n      this.handlePinch_(e);\n    } else {\n      this.handleMove(e);\n    }\n  }\n\n  /**\n   * Handle pinch zoom gesture.\n   *\n   * @param e A pointermove event.\n   */\n  private handlePinch_(e: PointerEvent) {\n    const pointers = Array.from(this.cachedPoints.keys());\n    // Calculate the distance between the two pointers\n    const point0 = (this.cachedPoints.get(pointers[0]))!;\n    const point1 = (this.cachedPoints.get(pointers[1]))!;\n    const moveDistance = Coordinate.distance(point0, point1);\n    const scale = moveDistance / this.startDistance_;\n\n    if (this.previousScale_ > 0 && this.previousScale_ < Infinity) {\n      const gestureScale = scale - this.previousScale_;\n      const delta = gestureScale > 0 ? gestureScale * ZOOM_IN_MULTIPLIER :\n                                       gestureScale * ZOOM_OUT_MULTIPLIER;\n      if (!this.startWorkspace_) {\n        throw new Error(\n            'Cannot handle a pinch because the start workspace ' +\n            'is undefined');\n      }\n      const workspace = this.startWorkspace_;\n      const position = browserEvents.mouseToSvg(\n          e, workspace.getParentSvg(), workspace.getInverseScreenCTM());\n      workspace.zoom(position.x, position.y, delta);\n    }\n    this.previousScale_ = scale;\n    e.preventDefault();\n  }\n\n  /**\n   * Handle a pointerup event and end the gesture.\n   *\n   * @param e A pointerup event.\n   * @internal\n   */\n  handleTouchEnd(e: PointerEvent) {\n    const pointerId = Touch.getTouchIdentifierFromEvent(e);\n    if (this.cachedPoints.has(pointerId)) {\n      this.cachedPoints.delete(pointerId);\n    }\n    if (this.cachedPoints.size < 2) {\n      this.cachedPoints.clear();\n      this.previousScale_ = 0;\n    }\n  }\n\n  /**\n   * Helper function returning the current touch point coordinate.\n   *\n   * @param e A pointer event.\n   * @returns The current touch point coordinate\n   * @internal\n   */\n  getTouchPoint(e: PointerEvent): Coordinate|null {\n    if (!this.startWorkspace_) {\n      return null;\n    }\n    return new Coordinate(e.pageX, e.pageY);\n  }\n\n  /**\n   * Whether this gesture is part of a multi-touch gesture.\n   *\n   * @returns Whether this gesture is part of a multi-touch gesture.\n   * @internal\n   */\n  isMultiTouch(): boolean {\n    return this.isMultiTouch_;\n  }\n\n  /**\n   * Cancel an in-progress gesture.  If a workspace or block drag is in\n   * progress, end the drag at the most recent location.\n   *\n   * @internal\n   */\n  cancel() {\n    // Disposing of a block cancels in-progress drags, but dragging to a delete\n    // area disposes of a block and leads to recursive disposal. Break that\n    // cycle.\n    if (this.isEnding_) {\n      return;\n    }\n    Touch.longStop();\n    if (this.bubbleDragger_) {\n      this.bubbleDragger_.endBubbleDrag(\n          this.mostRecentEvent_, this.currentDragDeltaXY_);\n    } else if (this.blockDragger_) {\n      this.blockDragger_.endDrag(\n          this.mostRecentEvent_, this.currentDragDeltaXY_);\n    } else if (this.workspaceDragger_) {\n      this.workspaceDragger_.endDrag(this.currentDragDeltaXY_);\n    }\n    this.dispose();\n  }\n\n  /**\n   * Handle a real or faked right-click event by showing a context menu.\n   *\n   * @param e A pointerdown event.\n   * @internal\n   */\n  handleRightClick(e: PointerEvent) {\n    if (this.targetBlock_) {\n      this.bringBlockToFront_();\n      this.targetBlock_.workspace.hideChaff(!!this.flyout_);\n      this.targetBlock_.showContextMenu(e);\n    } else if (this.startBubble_) {\n      this.startBubble_.showContextMenu(e);\n    } else if (this.startWorkspace_ && !this.flyout_) {\n      this.startWorkspace_.hideChaff();\n      this.startWorkspace_.showContextMenu(e);\n    }\n\n    // TODO: Handle right-click on a bubble.\n    e.preventDefault();\n    e.stopPropagation();\n\n    this.dispose();\n  }\n\n  /**\n   * Handle a pointerdown event on a workspace.\n   *\n   * @param e A pointerdown event.\n   * @param ws The workspace the event hit.\n   * @internal\n   */\n  handleWsStart(e: PointerEvent, ws: WorkspaceSvg) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleWsStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartWorkspace_(ws);\n    this.mostRecentEvent_ = e;\n    this.doStart(e);\n  }\n\n  /**\n   * Fires a workspace click event.\n   *\n   * @param ws The workspace that a user clicks on.\n   */\n  private fireWorkspaceClick_(ws: WorkspaceSvg) {\n    eventUtils.fire(\n        new (eventUtils.get(eventUtils.CLICK))(null, ws.id, 'workspace'));\n  }\n\n  /**\n   * Handle a pointerdown event on a flyout.\n   *\n   * @param e A pointerdown event.\n   * @param flyout The flyout the event hit.\n   * @internal\n   */\n  handleFlyoutStart(e: PointerEvent, flyout: IFlyout) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleFlyoutStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartFlyout_(flyout);\n    this.handleWsStart(e, flyout.getWorkspace());\n  }\n\n  /**\n   * Handle a pointerdown event on a block.\n   *\n   * @param e A pointerdown event.\n   * @param block The block the event hit.\n   * @internal\n   */\n  handleBlockStart(e: PointerEvent, block: BlockSvg) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleBlockStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartBlock(block);\n    this.mostRecentEvent_ = e;\n  }\n\n  /**\n   * Handle a pointerdown event on a bubble.\n   *\n   * @param e A pointerdown event.\n   * @param bubble The bubble the event hit.\n   * @internal\n   */\n  handleBubbleStart(e: PointerEvent, bubble: IBubble) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.handleBubbleStart, ' +\n          'but the gesture had already been started.');\n    }\n    this.setStartBubble(bubble);\n    this.mostRecentEvent_ = e;\n  }\n\n  /* Begin functions defining what actions to take to execute clicks on each\n   * type of target.  Any developer wanting to add behaviour on clicks should\n   * modify only this code. */\n\n  /** Execute a bubble click. */\n  private doBubbleClick_() {\n    // TODO (#1673): Consistent handling of single clicks.\n    if (this.startBubble_ instanceof WorkspaceCommentSvg) {\n      this.startBubble_.setFocus();\n      this.startBubble_.select();\n    }\n  }\n\n  /** Execute a field click. */\n  private doFieldClick_() {\n    if (!this.startField_) {\n      throw new Error(\n          'Cannot do a field click because the start field is ' +\n          'undefined');\n    }\n\n    // Only show the editor if the field's editor wasn't already open\n    // right before this gesture started.\n    const dropdownAlreadyOpen = this.currentDropdownOwner === this.startField_;\n    if (!dropdownAlreadyOpen) {\n      this.startField_.showEditor(this.mostRecentEvent_);\n    }\n    this.bringBlockToFront_();\n  }\n\n  /** Execute a block click. */\n  private doBlockClick_() {\n    // Block click in an autoclosing flyout.\n    if (this.flyout_ && this.flyout_.autoClose) {\n      if (!this.targetBlock_) {\n        throw new Error(\n            'Cannot do a block click because the target block is ' +\n            'undefined');\n      }\n      if (this.targetBlock_.isEnabled()) {\n        if (!eventUtils.getGroup()) {\n          eventUtils.setGroup(true);\n        }\n        const newBlock = this.flyout_.createBlock(this.targetBlock_);\n        newBlock.scheduleSnapAndBump();\n      }\n    } else {\n      if (!this.startWorkspace_) {\n        throw new Error(\n            'Cannot do a block click because the start workspace ' +\n            'is undefined');\n      }\n      // Clicks events are on the start block, even if it was a shadow.\n      const event = new (eventUtils.get(eventUtils.CLICK))(\n          this.startBlock_, this.startWorkspace_.id, 'block');\n      eventUtils.fire(event);\n    }\n    this.bringBlockToFront_();\n    eventUtils.setGroup(false);\n  }\n\n  /**\n   * Execute a workspace click. When in accessibility mode shift clicking will\n   * move the cursor.\n   *\n   * @param _e A pointerup event.\n   */\n  private doWorkspaceClick_(_e: PointerEvent) {\n    const ws = this.creatorWorkspace;\n    if (common.getSelected()) {\n      common.getSelected()!.unselect();\n    }\n    this.fireWorkspaceClick_(this.startWorkspace_ || ws);\n  }\n\n  /* End functions defining what actions to take to execute clicks on each type\n   * of target. */\n\n  // TODO (fenichel): Move bubbles to the front.\n\n  /**\n   * Move the dragged/clicked block to the front of the workspace so that it is\n   * not occluded by other blocks.\n   */\n  private bringBlockToFront_() {\n    // Blocks in the flyout don't overlap, so skip the work.\n    if (this.targetBlock_ && !this.flyout_) {\n      this.targetBlock_.bringToFront();\n    }\n  }\n\n  /* Begin functions for populating a gesture at pointerdown. */\n\n  /**\n   * Record the field that a gesture started on.\n   *\n   * @param field The field the gesture started on.\n   * @internal\n   */\n  setStartField<T>(field: Field<T>) {\n    if (this.hasStarted_) {\n      throw Error(\n          'Tried to call gesture.setStartField, ' +\n          'but the gesture had already been started.');\n    }\n    if (!this.startField_) {\n      this.startField_ = field as Field;\n    }\n  }\n\n  /**\n   * Record the bubble that a gesture started on\n   *\n   * @param bubble The bubble the gesture started on.\n   * @internal\n   */\n  setStartBubble(bubble: IBubble) {\n    if (!this.startBubble_) {\n      this.startBubble_ = bubble;\n    }\n  }\n\n  /**\n   * Record the block that a gesture started on, and set the target block\n   * appropriately.\n   *\n   * @param block The block the gesture started on.\n   * @internal\n   */\n  setStartBlock(block: BlockSvg) {\n    // If the gesture already went through a bubble, don't set the start block.\n    if (!this.startBlock_ && !this.startBubble_) {\n      this.startBlock_ = block;\n      if (block.isInFlyout && block !== block.getRootBlock()) {\n        this.setTargetBlock_(block.getRootBlock());\n      } else {\n        this.setTargetBlock_(block);\n      }\n    }\n  }\n\n  /**\n   * Record the block that a gesture targets, meaning the block that will be\n   * dragged if this turns into a drag.  If this block is a shadow, that will be\n   * its first non-shadow parent.\n   *\n   * @param block The block the gesture targets.\n   */\n  private setTargetBlock_(block: BlockSvg) {\n    if (block.isShadow()) {\n      // Non-null assertion is fine b/c it is an invariant that shadows always\n      // have parents.\n      this.setTargetBlock_(block.getParent()!);\n    } else {\n      this.targetBlock_ = block;\n    }\n  }\n\n  /**\n   * Record the workspace that a gesture started on.\n   *\n   * @param ws The workspace the gesture started on.\n   */\n  private setStartWorkspace_(ws: WorkspaceSvg) {\n    if (!this.startWorkspace_) {\n      this.startWorkspace_ = ws;\n    }\n  }\n\n  /**\n   * Record the flyout that a gesture started on.\n   *\n   * @param flyout The flyout the gesture started on.\n   */\n  private setStartFlyout_(flyout: IFlyout) {\n    if (!this.flyout_) {\n      this.flyout_ = flyout;\n    }\n  }\n\n  /* End functions for populating a gesture at pointerdown. */\n\n  /* Begin helper functions defining types of clicks.  Any developer wanting\n   * to change the definition of a click should modify only this code. */\n\n  /**\n   * Whether this gesture is a click on a bubble.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a bubble.\n   */\n  private isBubbleClick_(): boolean {\n    // A bubble click starts on a bubble and never escapes the drag radius.\n    const hasStartBubble = !!this.startBubble_;\n    return hasStartBubble && !this.hasExceededDragRadius_;\n  }\n\n  /**\n   * Whether this gesture is a click on a block.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a block.\n   */\n  private isBlockClick_(): boolean {\n    // A block click starts on a block, never escapes the drag radius, and is\n    // not a field click.\n    const hasStartBlock = !!this.startBlock_;\n    return hasStartBlock && !this.hasExceededDragRadius_ &&\n        !this.isFieldClick_();\n  }\n\n  /**\n   * Whether this gesture is a click on a field.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a field.\n   */\n  private isFieldClick_(): boolean {\n    const fieldClickable =\n        this.startField_ ? this.startField_.isClickable() : false;\n    return fieldClickable && !this.hasExceededDragRadius_ &&\n        (!this.flyout_ || !this.flyout_.autoClose);\n  }\n\n  /**\n   * Whether this gesture is a click on a workspace.  This should only be called\n   * when ending a gesture (pointerup).\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   */\n  private isWorkspaceClick_(): boolean {\n    const onlyTouchedWorkspace =\n        !this.startBlock_ && !this.startBubble_ && !this.startField_;\n    return onlyTouchedWorkspace && !this.hasExceededDragRadius_;\n  }\n\n  /* End helper functions defining types of clicks. */\n\n  /**\n   * Whether this gesture is a drag of either a workspace or block.\n   * This function is called externally to block actions that cannot be taken\n   * mid-drag (e.g. using the keyboard to delete the selected blocks).\n   *\n   * @returns True if this gesture is a drag of a workspace or block.\n   * @internal\n   */\n  isDragging(): boolean {\n    return !!this.workspaceDragger_ || !!this.blockDragger_ ||\n        !!this.bubbleDragger_;\n  }\n\n  /**\n   * Whether this gesture has already been started.  In theory every pointerdown\n   * has a corresponding pointerup, but in reality it is possible to lose a\n   * pointerup, leaving an in-process gesture hanging.\n   *\n   * @returns Whether this gesture was a click on a workspace.\n   * @internal\n   */\n  hasStarted(): boolean {\n    return this.hasStarted_;\n  }\n\n  /**\n   * Get a list of the insertion markers that currently exist.  Block drags have\n   * 0, 1, or 2 insertion markers.\n   *\n   * @returns A possibly empty list of insertion marker blocks.\n   * @internal\n   */\n  getInsertionMarkers(): BlockSvg[] {\n    if (this.blockDragger_) {\n      return this.blockDragger_.getInsertionMarkers();\n    }\n    return [];\n  }\n\n  /**\n   * Gets the current dragger if an item is being dragged. Null if nothing is\n   * being dragged.\n   *\n   * @returns The dragger that is currently in use or null if no drag is in\n   *     progress.\n   */\n  getCurrentDragger(): WorkspaceDragger|BubbleDragger|IBlockDragger|null {\n    return this.blockDragger_ ?? this.workspaceDragger_ ?? this.bubbleDragger_;\n  }\n\n  /**\n   * Is a drag or other gesture currently in progress on any workspace?\n   *\n   * @returns True if gesture is occurring.\n   */\n  static inProgress(): boolean {\n    const workspaces = common.getAllWorkspaces();\n    for (let i = 0, workspace; workspace = workspaces[i]; i++) {\n      // Not actually necessarily a WorkspaceSvg, but it doesn't matter b/c\n      // we're just checking if the property exists. Theoretically we would\n      // want to use instanceof, but that causes a circular dependency.\n      if ((workspace as WorkspaceSvg).currentGesture_) {\n        return true;\n      }\n    }\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object for configuring and updating a workspace grid in\n * Blockly.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Grid');\n\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport {GridOptions} from './options.js';\n\n\n/**\n * Class for a workspace's grid.\n */\nexport class Grid {\n  private readonly spacing: number;\n  private readonly length: number;\n  private readonly line1: SVGElement;\n  private readonly line2: SVGElement;\n  private readonly snapToGrid: boolean;\n\n  /**\n   * @param pattern The grid's SVG pattern, created during injection.\n   * @param options A dictionary of normalized options for the grid.\n   *     See grid documentation:\n   *     https://developers.google.com/blockly/guides/configure/web/grid\n   */\n  constructor(private pattern: SVGElement, options: GridOptions) {\n    /** The spacing of the grid lines (in px). */\n    this.spacing = options['spacing'] ?? 0;\n\n    /** How long the grid lines should be (in px). */\n    this.length = options['length'] ?? 1;\n\n    /** The horizontal grid line, if it exists. */\n    this.line1 = pattern.firstChild as SVGElement;\n\n    /** The vertical grid line, if it exists. */\n    this.line2 = this.line1 && this.line1.nextSibling as SVGElement;\n\n    /** Whether blocks should snap to the grid. */\n    this.snapToGrid = options['snap'] ?? false;\n  }\n\n  /**\n   * Whether blocks should snap to the grid, based on the initial configuration.\n   *\n   * @returns True if blocks should snap, false otherwise.\n   * @internal\n   */\n  shouldSnap(): boolean {\n    return this.snapToGrid;\n  }\n\n  /**\n   * Get the spacing of the grid points (in px).\n   *\n   * @returns The spacing of the grid points.\n   * @internal\n   */\n  getSpacing(): number {\n    return this.spacing;\n  }\n\n  /**\n   * Get the ID of the pattern element, which should be randomized to avoid\n   * conflicts with other Blockly instances on the page.\n   *\n   * @returns The pattern ID.\n   * @internal\n   */\n  getPatternId(): string {\n    return this.pattern.id;\n  }\n\n  /**\n   * Update the grid with a new scale.\n   *\n   * @param scale The new workspace scale.\n   * @internal\n   */\n  update(scale: number) {\n    const safeSpacing = this.spacing * scale;\n\n    this.pattern.setAttribute('width', `${safeSpacing}`);\n    this.pattern.setAttribute('height', `${safeSpacing}`);\n\n    let half = Math.floor(this.spacing / 2) + 0.5;\n    let start = half - this.length / 2;\n    let end = half + this.length / 2;\n\n    half *= scale;\n    start *= scale;\n    end *= scale;\n\n    this.setLineAttributes(this.line1, scale, start, end, half, half);\n    this.setLineAttributes(this.line2, scale, half, half, start, end);\n  }\n\n  /**\n   * Set the attributes on one of the lines in the grid.  Use this to update the\n   * length and stroke width of the grid lines.\n   *\n   * @param line Which line to update.\n   * @param width The new stroke size (in px).\n   * @param x1 The new x start position of the line (in px).\n   * @param x2 The new x end position of the line (in px).\n   * @param y1 The new y start position of the line (in px).\n   * @param y2 The new y end position of the line (in px).\n   */\n  private setLineAttributes(\n      line: SVGElement, width: number, x1: number, x2: number, y1: number,\n      y2: number) {\n    if (line) {\n      line.setAttribute('stroke-width', `${width}`);\n      line.setAttribute('x1', `${x1}`);\n      line.setAttribute('y1', `${y1}`);\n      line.setAttribute('x2', `${x2}`);\n      line.setAttribute('y2', `${y2}`);\n    }\n  }\n\n  /**\n   * Move the grid to a new x and y position, and make sure that change is\n   * visible.\n   *\n   * @param x The new x position of the grid (in px).\n   * @param y The new y position of the grid (in px).\n   * @internal\n   */\n  moveTo(x: number, y: number) {\n    this.pattern.setAttribute('x', `${x}`);\n    this.pattern.setAttribute('y', `${y}`);\n  }\n\n  /**\n   * Create the DOM for the grid described by options.\n   *\n   * @param rnd A random ID to append to the pattern's ID.\n   * @param gridOptions The object containing grid configuration.\n   * @param defs The root SVG element for this workspace's defs.\n   * @returns The SVG element for the grid pattern.\n   * @internal\n   */\n  static createDom(rnd: string, gridOptions: GridOptions, defs: SVGElement):\n      SVGElement {\n    /*\n          <pattern id=\"blocklyGridPattern837493\" patternUnits=\"userSpaceOnUse\">\n            <rect stroke=\"#888\" />\n            <rect stroke=\"#888\" />\n          </pattern>\n        */\n    const gridPattern = dom.createSvgElement(\n        Svg.PATTERN,\n        {'id': 'blocklyGridPattern' + rnd, 'patternUnits': 'userSpaceOnUse'},\n        defs);\n    // x1, y1, x1, x2 properties will be set later in update.\n    if ((gridOptions['length'] ?? 1) > 0 && (gridOptions['spacing'] ?? 0) > 0) {\n      dom.createSvgElement(\n          Svg.LINE, {'stroke': gridOptions['colour']}, gridPattern);\n      if (gridOptions['length'] ?? 1 > 1) {\n        dom.createSvgElement(\n            Svg.LINE, {'stroke': gridOptions['colour']}, gridPattern);\n      }\n    } else {\n      // Edge 16 doesn't handle empty patterns\n      dom.createSvgElement(Svg.LINE, {}, gridPattern);\n    }\n    return gridPattern;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for handling variable and procedure names.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Names');\n\nimport {Msg} from './msg.js';\n// import * as Procedures from './procedures.js';\nimport type {VariableMap} from './variable_map.js';\nimport * as Variables from './variables.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a database of entity names (variables, procedures, etc).\n */\nexport class Names {\n  static DEVELOPER_VARIABLE_TYPE: NameType;\n  private readonly variablePrefix_: string;\n\n  /** A set of reserved words. */\n  private readonly reservedWords: Set<string>;\n\n  /**\n   * A map from type (e.g. name, procedure) to maps from names to generated\n   * names.\n   */\n  private readonly db = new Map<string, Map<string, string>>();\n\n  /** A set of used names to avoid collisions. */\n  private readonly dbReverse = new Set<string>();\n\n  /**\n   * The variable map from the workspace, containing Blockly variable models.\n   */\n  private variableMap_: VariableMap|null = null;\n\n  /**\n   * @param reservedWordsList A comma-separated string of words that are illegal\n   *     for use as names in a language (e.g. 'new,if,this,...').\n   * @param opt_variablePrefix Some languages need a '$' or a namespace before\n   *     all variable names (but not procedure names).\n   */\n  constructor(reservedWordsList: string, opt_variablePrefix?: string) {\n    /** The prefix to attach to variable names in generated code. */\n    this.variablePrefix_ = opt_variablePrefix || '';\n\n    this.reservedWords =\n        new Set<string>(reservedWordsList ? reservedWordsList.split(',') : []);\n  }\n\n  /**\n   * Empty the database and start from scratch.  The reserved words are kept.\n   */\n  reset() {\n    this.db.clear();\n    this.dbReverse.clear();\n    this.variableMap_ = null;\n  }\n\n  /**\n   * Set the variable map that maps from variable name to variable object.\n   *\n   * @param map The map to track.\n   */\n  setVariableMap(map: VariableMap) {\n    this.variableMap_ = map;\n  }\n\n  /**\n   * Get the name for a user-defined variable, based on its ID.\n   * This should only be used for variables of NameType VARIABLE.\n   *\n   * @param id The ID to look up in the variable map.\n   * @returns The name of the referenced variable, or null if there was no\n   *     variable map or the variable was not found in the map.\n   */\n  private getNameForUserVariable_(id: string): string|null {\n    if (!this.variableMap_) {\n      console.warn(\n          'Deprecated call to Names.prototype.getName without ' +\n          'defining a variable map. To fix, add the following code in your ' +\n          'generator\\'s init() function:\\n' +\n          'Blockly.YourGeneratorName.nameDB_.setVariableMap(' +\n          'workspace.getVariableMap());');\n      return null;\n    }\n    const variable = this.variableMap_.getVariableById(id);\n    if (variable) {\n      return variable.name;\n    }\n    return null;\n  }\n\n  /**\n   * Generate names for user variables, but only ones that are being used.\n   *\n   * @param workspace Workspace to generate variables from.\n   */\n  populateVariables(workspace: Workspace) {\n    const variables = Variables.allUsedVarModels(workspace);\n    for (let i = 0; i < variables.length; i++) {\n      this.getName(variables[i].getId(), NameType.VARIABLE);\n    }\n  }\n\n  /**\n   * Generate names for procedures.\n   *\n   * @param workspace Workspace to generate procedures from.\n   */\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  populateProcedures(workspace: Workspace) {\n    throw new Error(\n        'The implementation of populateProcedures should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   *\n   * @param nameOrId The Blockly entity name (no constraints) or variable ID.\n   * @param type The type of the name in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getName(nameOrId: string, type: NameType|string): string {\n    let name = nameOrId;\n    if (type === NameType.VARIABLE) {\n      const varName = this.getNameForUserVariable_(nameOrId);\n      if (varName) {\n        // Successful ID lookup.\n        name = varName;\n      }\n    }\n    const normalizedName = name.toLowerCase();\n\n    const isVar =\n        type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n\n    const prefix = isVar ? this.variablePrefix_ : '';\n    if (!this.db.has(type)) {\n      this.db.set(type, new Map<string, string>());\n    }\n    const typeDb = this.db.get(type);\n    if (typeDb!.has(normalizedName)) {\n      return prefix + typeDb!.get(normalizedName);\n    }\n    const safeName = this.getDistinctName(name, type);\n    typeDb!.set(normalizedName, safeName.substr(prefix.length));\n    return safeName;\n  }\n\n  /**\n   * Return a list of all known user-created names of a specified name type.\n   *\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns A list of Blockly entity names (no constraints).\n   */\n  getUserNames(type: NameType|string): string[] {\n    const userNames = this.db.get(type)?.keys();\n    return userNames ? Array.from(userNames) : [];\n  }\n\n  /**\n   * Convert a Blockly entity name to a legal exportable entity name.\n   * Ensure that this is a new name not overlapping any previously defined name.\n   * Also check against list of reserved words for the current language and\n   * ensure name doesn't collide.\n   *\n   * @param name The Blockly entity name (no constraints).\n   * @param type The type of entity in Blockly ('VARIABLE', 'PROCEDURE',\n   *     'DEVELOPER_VARIABLE', etc...).\n   * @returns An entity name that is legal in the exported language.\n   */\n  getDistinctName(name: string, type: NameType|string): string {\n    let safeName = this.safeName_(name);\n    let i: number|null = null;\n    while (this.dbReverse.has(safeName + (i ?? '')) ||\n           this.reservedWords.has(safeName + (i ?? ''))) {\n      // Collision with existing name.  Create a unique name.\n      i = i ? i + 1 : 2;\n    }\n    safeName += (i ?? '');\n    this.dbReverse.add(safeName);\n    const isVar =\n        type === NameType.VARIABLE || type === NameType.DEVELOPER_VARIABLE;\n    const prefix = isVar ? this.variablePrefix_ : '';\n    return prefix + safeName;\n  }\n\n  /**\n   * Given a proposed entity name, generate a name that conforms to the\n   * [_A-Za-z][_A-Za-z0-9]* format that most languages consider legal for\n   * variable and function names.\n   *\n   * @param name Potentially illegal entity name.\n   * @returns Safe entity name.\n   */\n  private safeName_(name: string): string {\n    if (!name) {\n      name = Msg['UNNAMED_KEY'] || 'unnamed';\n    } else {\n      // Unfortunately names in non-latin characters will look like\n      // _E9_9F_B3_E4_B9_90 which is pretty meaningless.\n      // https://github.com/google/blockly/issues/1654\n      name = encodeURI(name.replace(/ /g, '_')).replace(/[^\\w]/g, '_');\n      // Most languages don't allow names with leading numbers.\n      if ('0123456789'.indexOf(name[0]) !== -1) {\n        name = 'my_' + name;\n      }\n    }\n    return name;\n  }\n\n  /**\n   * Do the given two entity names refer to the same entity?\n   * Blockly names are case-insensitive.\n   *\n   * @param name1 First name.\n   * @param name2 Second name.\n   * @returns True if names are the same.\n   */\n  static equals(name1: string, name2: string): boolean {\n    // name1.localeCompare(name2) is slower.\n    return name1.toLowerCase() === name2.toLowerCase();\n  }\n}\n\nexport namespace Names {\n  /**\n   * Enum for the type of a name. Different name types may have different rules\n   * about collisions.\n   * When JavaScript (or most other languages) is generated, variable 'foo' and\n   * procedure 'foo' would collide.  However, Blockly has no such problems since\n   * variable get 'foo' and procedure call 'foo' are unambiguous.\n   * Therefore, Blockly keeps a separate name type to disambiguate.\n   * getName('foo', 'VARIABLE') = 'foo'\n   * getName('foo', 'PROCEDURE') = 'foo2'\n   *\n   */\n  export enum NameType {\n    DEVELOPER_VARIABLE = 'DEVELOPER_VARIABLE',\n    VARIABLE = 'VARIABLE',\n    PROCEDURE = 'PROCEDURE',\n  }\n}\n\nexport type NameType = Names.NameType;\nexport const NameType = Names.NameType;\n\n/**\n * Constant to separate developer variable names from user-defined variable\n * names when running generators.\n * A developer variable will be declared as a global in the generated code, but\n * will never be shown to the user in the workspace or stored in the variable\n * map.\n */\nNames.DEVELOPER_VARIABLE_TYPE = NameType.DEVELOPER_VARIABLE;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport type {IProcedureModel} from './interfaces/i_procedure_model.js';\nimport {isObservable} from './interfaces/i_observable.js';\n\n\nexport class ObservableProcedureMap extends\n    Map<string, IProcedureModel> implements IProcedureMap {\n  /** @internal */\n  constructor() {\n    super();\n  }\n\n  /**\n   * Adds the given procedure model to the procedure map.\n   */\n  override set(id: string, proc: IProcedureModel): this {\n    if (this.get(id) === proc) return this;\n    super.set(id, proc);\n    if (isObservable(proc)) proc.startPublishing();\n    return this;\n  }\n\n  /**\n   * Deletes the ProcedureModel with the given ID from the procedure map (if it\n   * exists).\n   */\n  override delete(id: string): boolean {\n    const proc = this.get(id);\n    const existed = super.delete(id);\n    if (!existed) return existed;\n    if (isObservable(proc)) proc.stopPublishing();\n    return existed;\n  }\n\n  /**\n   * Removes all ProcedureModels from the procedure map.\n   */\n  override clear() {\n    if (!this.size) return;\n    for (const id of this.keys()) {\n      this.delete(id);\n    }\n  }\n\n  /**\n   * Adds the given ProcedureModel to the map of procedure models, so that\n   * blocks can find it.\n   */\n  add(proc: IProcedureModel): this {\n    return this.set(proc.getId(), proc);\n  }\n\n  /**\n   * Returns all of the procedures stored in this map.\n   */\n  getProcedures(): IProcedureModel[] {\n    return [...this.values()];\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Types');\n\nimport type {Measurable} from './base.js';\nimport type {Row} from './row.js';\n\n\n/**\n * Types of rendering elements.\n */\nclass TypesContainer {\n  [index: string]: number|Function;\n\n  NONE = 0;                       // None\n  FIELD = 1 << 0;                 // Field.\n  HAT = 1 << 1;                   // Hat.\n  ICON = 1 << 2;                  // Icon.\n  SPACER = 1 << 3;                // Spacer.\n  BETWEEN_ROW_SPACER = 1 << 4;    // Between Row Spacer.\n  IN_ROW_SPACER = 1 << 5;         // In Row Spacer.\n  EXTERNAL_VALUE_INPUT = 1 << 6;  // External Value Input.\n  INPUT = 1 << 7;                 // Input.\n  INLINE_INPUT = 1 << 8;          // Inline Input.\n  STATEMENT_INPUT = 1 << 9;       // Statement Input.\n  CONNECTION = 1 << 10;           // Connection.\n  PREVIOUS_CONNECTION = 1 << 11;  // Previous Connection.\n  NEXT_CONNECTION = 1 << 12;      // Next Connection.\n  OUTPUT_CONNECTION = 1 << 13;    // Output Connection.\n  CORNER = 1 << 14;               // Corner.\n  LEFT_SQUARE_CORNER = 1 << 15;   // Square Corner.\n  LEFT_ROUND_CORNER = 1 << 16;    // Round Corner.\n  RIGHT_SQUARE_CORNER = 1 << 17;  // Right Square Corner.\n  RIGHT_ROUND_CORNER = 1 << 18;   // Right Round Corner.\n  JAGGED_EDGE = 1 << 19;          // Jagged Edge.\n  ROW = 1 << 20;                  // Row.\n  TOP_ROW = 1 << 21;              // Top Row.\n  BOTTOM_ROW = 1 << 22;           // Bottom Row.\n  INPUT_ROW = 1 << 23;            // Input Row.\n\n  /**\n   * A Left Corner Union Type.\n   */\n  LEFT_CORNER = this.LEFT_SQUARE_CORNER | this.LEFT_ROUND_CORNER;\n\n  /**\n   * A Right Corner Union Type.\n   */\n  RIGHT_CORNER = this.RIGHT_SQUARE_CORNER | this.RIGHT_ROUND_CORNER;\n\n  /**\n   * Next flag value to use for custom rendering element types.\n   * This must be updated to reflect the next enum flag value\n   * to use if additional elements are added to\n   * `Types`.\n   */\n  nextTypeValue_ = 1 << 24;\n\n  /**\n   * Get the enum flag value of an existing type or register a new type.\n   *\n   * @param type The name of the type.\n   * @returns The enum flag value associated with that type.\n   */\n  getType(type: string): number {\n    if (!Object.prototype.hasOwnProperty.call(this, type)) {\n      this[type] = this.nextTypeValue_;\n      this.nextTypeValue_ <<= 1;\n    }\n    return this[type] as number;\n  }\n\n  /**\n   * Whether a measurable stores information about a field.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a field.\n   */\n  isField(elem: Measurable): number {\n    return elem.type & this.FIELD;\n  }\n\n  /**\n   * Whether a measurable stores information about a hat.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a hat.\n   */\n  isHat(elem: Measurable): number {\n    return elem.type & this.HAT;\n  }\n\n  /**\n   * Whether a measurable stores information about an icon.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an icon.\n   */\n  isIcon(elem: Measurable): number {\n    return elem.type & this.ICON;\n  }\n\n  /**\n   * Whether a measurable stores information about a spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a spacer.\n   */\n  isSpacer(elem: Measurable|Row): number {\n    return elem.type & this.SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an in-row spacer.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an in-row spacer.\n   */\n  isInRowSpacer(elem: Measurable): number {\n    return elem.type & this.IN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about an input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an input.\n   */\n  isInput(elem: Measurable): number {\n    return elem.type & this.INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an external input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an external input.\n   */\n  isExternalInput(elem: Measurable): number {\n    return elem.type & this.EXTERNAL_VALUE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about an inline input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about an inline input.\n   */\n  isInlineInput(elem: Measurable): number {\n    return elem.type & this.INLINE_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a statement input.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a statement input.\n   */\n  isStatementInput(elem: Measurable): number {\n    return elem.type & this.STATEMENT_INPUT;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous connection.\n   */\n  isPreviousConnection(elem: Measurable): number {\n    return elem.type & this.PREVIOUS_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a next connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a next connection.\n   */\n  isNextConnection(elem: Measurable): number {\n    return elem.type & this.NEXT_CONNECTION;\n  }\n\n  /**\n   * Whether a measurable stores information about a previous or next\n   * connection.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a previous or next\n   *     connection.\n   */\n  isPreviousOrNextConnection(elem: Measurable): number {\n    return elem.type & (this.PREVIOUS_CONNECTION | this.NEXT_CONNECTION);\n  }\n\n  /**\n   * Whether a measurable stores information about a left round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left round corner.\n   */\n  isLeftRoundedCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right round corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right round corner.\n   */\n  isRightRoundedCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_ROUND_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a left square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a left square corner.\n   */\n  isLeftSquareCorner(elem: Measurable): number {\n    return elem.type & this.LEFT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a right square corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a right square corner.\n   */\n  isRightSquareCorner(elem: Measurable): number {\n    return elem.type & this.RIGHT_SQUARE_CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a corner.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a corner.\n   */\n  isCorner(elem: Measurable): number {\n    return elem.type & this.CORNER;\n  }\n\n  /**\n   * Whether a measurable stores information about a jagged edge.\n   *\n   * @param elem The element to check.\n   * @returns 1 if the object stores information about a jagged edge.\n   */\n  isJaggedEdge(elem: Measurable): number {\n    return elem.type & this.JAGGED_EDGE;\n  }\n\n  /**\n   * Whether a measurable stores information about a row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a row.\n   */\n  isRow(row: Row): number {\n    return row.type & this.ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a between-row spacer.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a between-row spacer.\n   */\n  isBetweenRowSpacer(row: Row): number {\n    return row.type & this.BETWEEN_ROW_SPACER;\n  }\n\n  /**\n   * Whether a measurable stores information about a top row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top row.\n   */\n  isTopRow(row: Row): number {\n    return row.type & this.TOP_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a bottom row.\n   */\n  isBottomRow(row: Row): number {\n    return row.type & this.BOTTOM_ROW;\n  }\n\n  /**\n   * Whether a measurable stores information about a top or bottom row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about a top or bottom row.\n   */\n  isTopOrBottomRow(row: Row): number {\n    return row.type & (this.TOP_ROW | this.BOTTOM_ROW);\n  }\n\n  /**\n   * Whether a measurable stores information about an input row.\n   *\n   * @param row The row to check.\n   * @returns 1 if the object stores information about an input row.\n   */\n  isInputRow(row: Row): number {\n    return row.type & this.INPUT_ROW;\n  }\n}\n\nexport const Types = new TypesContainer();\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Measurable');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Types} from './types.js';\n\n\n/**\n * The base class to represent a part of a block that takes up space during\n * rendering.  The constructor for each non-spacer Measurable records the size\n * of the block element (e.g. field, statement input).\n */\nexport class Measurable {\n  width = 0;\n\n  height = 0;\n  type: number;\n  xPos = 0;\n\n  centerline = 0;\n  notchOffset: number;\n\n  /** The renderer's constant provider. */\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    this.constants_ = constants;\n\n    this.type = Types.NONE;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Row');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {Measurable} from './base.js';\nimport type {InRowSpacer} from './in_row_spacer.js';\nimport type {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object representing a single row on a rendered block and all of its\n * subcomponents.\n */\nexport class Row {\n  type: number;\n\n  /**\n   * An array of elements contained in this row.\n   */\n  elements: Measurable[] = [];\n\n  /**\n   * The height of the row.\n   */\n  height = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the right.\n   * Does not include child blocks unless they are inline.\n   */\n  width = 0;\n\n  /**\n   * The minimum height of the row.\n   */\n  minHeight = 0;\n\n  /**\n   * The minimum width of the row, from the left edge of the block to the\n   * right. Does not include child blocks unless they are inline.\n   */\n  minWidth = 0;\n\n  /**\n   * The width of the row, from the left edge of the block to the edge of the\n   * block or any connected child blocks.\n   */\n  widthWithConnectedBlocks = 0;\n\n  /**\n   * The Y position of the row relative to the origin of the block's svg\n   * group.\n   */\n  yPos = 0;\n\n  /**\n   * The X position of the row relative to the origin of the block's svg\n   * group.\n   */\n  xPos = 0;\n\n  /**\n   * Whether the row has any external inputs.\n   */\n  hasExternalInput = false;\n\n  /**\n   * Whether the row has any statement inputs.\n   */\n  hasStatement = false;\n\n  /**\n   * Where the left edge of all of the statement inputs on the block should\n   * be. This makes sure that statement inputs which are proceded by fields\n   * of varius widths are all aligned.\n   */\n  statementEdge = 0;\n\n  /**\n   * Whether the row has any inline inputs.\n   */\n  hasInlineInput = false;\n\n  /**\n   * Whether the row has any dummy inputs.\n   */\n  hasDummyInput = false;\n\n  /**\n   * Whether the row has a jagged edge.\n   */\n  hasJaggedEdge = false;\n  notchOffset: number;\n\n  /**\n   * Alignment of the row.\n   */\n  align: number|null = null;\n\n  protected readonly constants_: ConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constants_ = constants;\n\n    /** The type of this rendering object. */\n    this.type = Types.ROW;\n\n    this.notchOffset = this.constants_.NOTCH_OFFSET_LEFT;\n  }\n\n  /**\n   * Get the last input on this row, if it has one.\n   *\n   * @returns The last input on the row, or null.\n   */\n  getLastInput(): InputConnection|null {\n    // TODO: Consider moving this to InputRow, if possible.\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isInput(elem)) {\n        return elem as InputConnection;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  measure() {\n    throw Error('Unexpected attempt to measure a base Row.');\n  }\n\n  /**\n   * Determines whether this row should start with an element spacer.\n   *\n   * @returns Whether the row should start with a spacer.\n   */\n  startsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Determines whether this row should end with an element spacer.\n   *\n   * @returns Whether the row should end with a spacer.\n   */\n  endsWithElemSpacer(): boolean {\n    return true;\n  }\n\n  /**\n   * Convenience method to get the first spacer element on this row.\n   *\n   * @returns The first spacer element on this row.\n   */\n  getFirstSpacer(): InRowSpacer|null {\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Convenience method to get the last spacer element on this row.\n   *\n   * @returns The last spacer element on this row.\n   */\n  getLastSpacer(): InRowSpacer|null {\n    for (let i = this.elements.length - 1; i >= 0; i--) {\n      const elem = this.elements[i];\n      if (Types.isSpacer(elem)) {\n        return elem as InRowSpacer;\n      }\n    }\n    return null;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.BottomRow');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport type {NextConnection} from './next_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the bottom row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends Row {\n  /**\n   * Whether this row has a next connection.\n   */\n  hasNextConnection = false;\n\n  /**\n   * The next connection on the row, if any.\n   */\n  connection: NextConnection|null = null;\n\n  /**\n   * The amount that the bottom of the block extends below the horizontal\n   * edge, e.g. because of a next connection.  Must be non-negative (see\n   * #2820).\n   */\n  descenderHeight = 0;\n\n  /**\n   * The Y position of the bottom edge of the block, relative to the origin\n   * of the block rendering.\n   */\n  baseline = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.BOTTOM_ROW;\n  }\n\n  /**\n   * Returns whether or not the bottom row has a left square corner.\n   *\n   * @param block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    return !!block.outputConnection || !!block.getNextBlock();\n  }\n\n  /**\n   * Returns whether or not the bottom row has a right square corner.\n   *\n   * @param _block The block whose bottom row this represents.\n   * @returns Whether or not the bottom row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let descenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        // Note: this assumes that next connections have *only* descenderHeight,\n        // with no height above the baseline.\n        if (Types.isNextConnection(elem)) {\n          descenderHeight = Math.max(descenderHeight, elem.height);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + descenderHeight;\n    this.descenderHeight = descenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Connection');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider, Shape} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * The base class to represent a connection and the space that it takes up on\n * the block.\n */\nexport class Connection extends Measurable {\n  shape: Shape;\n  isDynamicShape: boolean;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n      constants: ConstantProvider, public connectionModel: RenderedConnection) {\n    super(constants);\n\n    this.shape = this.constants_.shapeFor(connectionModel);\n\n    this.isDynamicShape = 'isDynamic' in this.shape && this.shape.isDynamic;\n    this.type |= Types.CONNECTION;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InputConnection');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../input.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * The base class to represent an input that takes up space on a block\n * during rendering.\n */\nexport class InputConnection extends Connection {\n  align: number;\n  connectedBlock: BlockSvg|null;\n  connectedBlockWidth: number;\n  connectedBlockHeight: number;\n  connectionOffsetX = 0;\n  connectionOffsetY = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, public input: Input) {\n    super(constants, input.connection as RenderedConnection);\n\n    this.type |= Types.INPUT;\n\n    this.align = input.align;\n\n    this.connectedBlock =\n        (input.connection && input.connection.targetBlock() ?\n             input.connection.targetBlock() as BlockSvg :\n             null);\n\n    if (this.connectedBlock) {\n      const bBox = this.connectedBlock.getHeightWidth();\n      this.connectedBlockWidth = bBox.width;\n      this.connectedBlockHeight = bBox.height;\n    } else {\n      this.connectedBlockWidth = 0;\n      this.connectedBlockHeight = 0;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.ExternalValueInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an external value input\n * takes up during rendering\n */\nexport class ExternalValueInput extends InputConnection {\n  override height = 0;\n  override width: number;\n  override connectionOffsetY: number;\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The external value input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.EXTERNAL_VALUE_INPUT;\n    if (!this.connectedBlock) {\n      this.height = this.shape.height as number;\n    } else {\n      this.height = this.connectedBlockHeight -\n          this.constants_.TAB_OFFSET_FROM_TOP - this.constants_.MEDIUM_PADDING;\n    }\n\n    this.width = this.shape.width as\n        number + this.constants_.EXTERNAL_VALUE_INPUT_PADDING;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionHeight = this.shape.height as number;\n\n    this.connectionWidth = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Field');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Field as BlocklyField} from '../../field.js';\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a field takes up during\n * rendering\n */\nexport class Field extends Measurable {\n  isEditable: boolean;\n  flipRtl: boolean;\n  override height: number;\n  override width: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param field The field to measure and store information for.\n   * @param parentInput The parent input for the field.\n   */\n  constructor(\n      constants: ConstantProvider, public field: BlocklyField,\n      public parentInput: Input) {\n    super(constants);\n\n    this.isEditable = field.EDITABLE;\n\n    this.flipRtl = field.getFlipRtl();\n    this.type |= Types.FIELD;\n\n    const size = this.field.getSize();\n\n    this.height = size.height;\n\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Hat');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a hat takes up during\n * rendering.\n */\nexport class Hat extends Measurable {\n  ascenderHeight: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.HAT;\n\n    this.height = this.constants_.START_HAT.height;\n    this.width = this.constants_.START_HAT.width;\n\n    this.ascenderHeight = this.height;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Icon');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Icon as BlocklyIcon} from '../../icon.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an icon takes up during\n * rendering.\n */\nexport class Icon extends Measurable {\n  isVisible: boolean;\n  flipRtl = false;\n\n  /**\n   * An object containing information about the space an icon takes up during\n   * rendering.\n   *\n   * @param constants The rendering constants provider.\n   * @param icon The icon to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, public icon: BlocklyIcon) {\n    super(constants);\n\n    this.isVisible = icon.isVisible();\n    this.type |= Types.ICON;\n\n    const size = icon.getCorrectedSize();\n    this.height = size.height;\n    this.width = size.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InRowSpacer');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about a spacer between two elements on a\n * row.\n */\nexport class InRowSpacer extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param width The width of the spacer.\n   */\n  constructor(constants: ConstantProvider, width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.IN_ROW_SPACER;\n    this.width = width;\n    this.height = this.constants_.SPACER_DEFAULT_HEIGHT;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InlineInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends InputConnection {\n  connectionHeight: number;\n  connectionWidth: number;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.INLINE_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_INLINE_INPUT_HEIGHT;\n      this.width = this.constants_.EMPTY_INLINE_INPUT_PADDING;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width = this.connectedBlockWidth;\n      this.height = this.connectedBlockHeight;\n    }\n\n    this.connectionHeight = !this.isDynamicShape ?\n        this.shape.height as number :\n        (this.shape.height as (p1: number) => number)(this.height);\n\n    this.connectionWidth = !this.isDynamicShape ?\n        this.shape.width as number :\n        (this.shape.width as (p1: number) => number)(this.height);\n    if (!this.connectedBlock) {\n      this.width += this.connectionWidth * (this.isDynamicShape ? 2 : 1);\n    }\n\n    this.connectionOffsetY = 'connectionOffsetY' in this.shape ?\n        this.shape.connectionOffsetY(this.connectionHeight) :\n        this.constants_.TAB_OFFSET_FROM_TOP;\n\n    this.connectionOffsetX = 'connectionOffsetX' in this.shape ?\n        this.shape.connectionOffsetX(this.connectionWidth) :\n        0;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.StatementInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../input.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InputConnection} from './input_connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering\n */\nexport class StatementInput extends InputConnection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n    this.type |= Types.STATEMENT_INPUT;\n\n    if (!this.connectedBlock) {\n      this.height = this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT;\n    } else {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height =\n          this.connectedBlockHeight + this.constants_.STATEMENT_BOTTOM_SPACER;\n    }\n    this.width = this.constants_.STATEMENT_INPUT_NOTCH_OFFSET +\n        (this.shape.width as number);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.InputRow');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {ExternalValueInput} from './external_value_input.js';\nimport {InputConnection} from './input_connection.js';\nimport {Row} from './row.js';\nimport {StatementInput} from './statement_input.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about a row that holds one or more inputs.\n */\nexport class InputRow extends Row {\n  /**\n   * The total width of all blocks connected to this row.\n   */\n  connectedBlockWidths = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.INPUT_ROW;\n  }\n\n  /**\n   * Inspect all subcomponents and populate all size properties on the row.\n   */\n  override measure() {\n    this.width = this.minWidth;\n    this.height = this.minHeight;\n    let connectedBlockWidths = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      this.width += elem.width;\n      if (Types.isInput(elem) && elem instanceof InputConnection) {\n        if (Types.isStatementInput(elem) && elem instanceof StatementInput) {\n          connectedBlockWidths += elem.connectedBlockWidth;\n        } else if (\n            Types.isExternalInput(elem) && elem instanceof ExternalValueInput &&\n            elem.connectedBlockWidth !== 0) {\n          connectedBlockWidths +=\n              elem.connectedBlockWidth - elem.connectionWidth;\n        }\n      }\n      if (!Types.isSpacer(elem)) {\n        this.height = Math.max(this.height, elem.height);\n      }\n    }\n    this.connectedBlockWidths = connectedBlockWidths;\n    this.widthWithConnectedBlocks = this.width + connectedBlockWidths;\n  }\n\n  override endsWithElemSpacer() {\n    return !this.hasExternalInput && !this.hasStatement;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.JaggedEdge');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space the jagged edge of a\n * collapsed block takes up during rendering.\n */\nexport class JaggedEdge extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.JAGGED_EDGE;\n    this.height = this.constants_.JAGGED_TEETH.height;\n    this.width = this.constants_.JAGGED_TEETH.width;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.NextConnection');\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a next connection takes\n * up during rendering.\n */\nexport class NextConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n      constants: ConstantProvider, connectionModel: RenderedConnection) {\n    super(constants, connectionModel);\n    this.type |= Types.NEXT_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.OutputConnection');\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space an output connection takes\n * up during rendering.\n */\nexport class OutputConnection extends Connection {\n  startX: number;\n  connectionOffsetY: number;\n  connectionOffsetX = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n      constants: ConstantProvider, connectionModel: RenderedConnection) {\n    super(constants, connectionModel);\n    this.type |= Types.OUTPUT_CONNECTION;\n\n    this.height = !this.isDynamicShape ? this.shape.height as number : 0;\n    this.width = !this.isDynamicShape ? this.shape.width as number : 0;\n\n    this.startX = this.width;\n\n    this.connectionOffsetY = this.constants_.TAB_OFFSET_FROM_TOP;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.PreviousConnection');\n\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Connection} from './connection.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a previous connection takes\n * up during rendering.\n */\nexport class PreviousConnection extends Connection {\n  /**\n   * @param constants The rendering constants provider.\n   * @param connectionModel The connection object on the block that this\n   *     represents.\n   */\n  constructor(\n      constants: ConstantProvider, connectionModel: RenderedConnection) {\n    super(constants, connectionModel);\n    this.type |= Types.PREVIOUS_CONNECTION;\n    this.height = this.shape.height as number;\n    this.width = this.shape.width as number;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.RoundCorner');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a rounded corner takes up\n * during rendering.\n */\nexport class RoundCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n        (!opt_position || opt_position === 'left' ? Types.LEFT_ROUND_CORNER :\n                                                    Types.RIGHT_ROUND_CORNER) |\n        Types.CORNER;\n    this.width = this.constants_.CORNER_RADIUS;\n    // The rounded corner extends into the next row by 4 so we only take the\n    // height that is aligned with this row.\n    this.height = this.constants_.CORNER_RADIUS / 2;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.SpacerRow');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {InRowSpacer} from './in_row_spacer.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about a spacer between two rows.\n */\nexport class SpacerRow extends Row {\n  followsStatement = false;\n\n  precedesStatement = false;\n\n  override widthWithConnectedBlocks = 0;\n  override elements: InRowSpacer[];\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param height The height of the spacer.\n   * @param width The width of the spacer.\n   */\n  constructor(\n      constants: ConstantProvider, public override height: number,\n      public override width: number) {\n    super(constants);\n    this.type |= Types.SPACER | Types.BETWEEN_ROW_SPACER;\n\n    this.elements = [new InRowSpacer(this.constants_, width)];\n  }\n\n  override measure() {}\n}\n// NOP.  Width and height were set at creation.\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.SquareCorner');\n\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Measurable} from './base.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about the space a square corner takes up\n * during rendering.\n */\nexport class SquareCorner extends Measurable {\n  /**\n   * @param constants The rendering constants provider.\n   * @param opt_position The position of this corner.\n   */\n  constructor(constants: ConstantProvider, opt_position?: string) {\n    super(constants);\n    this.type =\n        (!opt_position || opt_position === 'left' ? Types.LEFT_SQUARE_CORNER :\n                                                    Types.RIGHT_SQUARE_CORNER) |\n        Types.CORNER;\n    this.height = this.constants_.NO_PADDING;\n    this.width = this.constants_.NO_PADDING;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.TopRow');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\nimport {Hat} from './hat.js';\nimport type {PreviousConnection} from './previous_connection.js';\nimport {Row} from './row.js';\nimport {Types} from './types.js';\n\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends Row {\n  /**\n   * The starting point for drawing the row, in the y direction.\n   * This allows us to draw hats and similar shapes that don't start at the\n   * origin. Must be non-negative (see #2820).\n   */\n  capline = 0;\n\n  /** How much the row extends up above its capline. */\n  ascenderHeight = 0;\n\n  /** Whether the block has a previous connection. */\n  hasPreviousConnection = false;\n\n  /** The previous connection on the block, if any. */\n  connection: PreviousConnection|null = null;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n\n    this.type |= Types.TOP_ROW;\n  }\n\n  /**\n   * Returns whether or not the top row has a left square corner.\n   *\n   * @param block The block whose top row this represents.\n   * @returns Whether or not the top row has a left square corner.\n   */\n  hasLeftSquareCorner(block: BlockSvg): boolean {\n    const hasHat =\n        (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n        !block.outputConnection && !block.previousConnection;\n    const prevBlock = block.getPreviousBlock();\n\n    return !!block.outputConnection || hasHat ||\n        (prevBlock ? prevBlock.getNextBlock() === block : false);\n  }\n\n  /**\n   * Returns whether or not the top row has a right square corner.\n   *\n   * @param _block The block whose top row this represents.\n   * @returns Whether or not the top row has a right square corner.\n   */\n  hasRightSquareCorner(_block: BlockSvg): boolean {\n    return true;\n  }\n\n  override measure() {\n    let height = 0;\n    let width = 0;\n    let ascenderHeight = 0;\n    for (let i = 0; i < this.elements.length; i++) {\n      const elem = this.elements[i];\n      width += elem.width;\n      if (!Types.isSpacer(elem)) {\n        if (Types.isHat(elem) && elem instanceof Hat) {\n          ascenderHeight = Math.max(ascenderHeight, elem.ascenderHeight);\n        } else {\n          height = Math.max(height, elem.height);\n        }\n      }\n    }\n    this.width = Math.max(this.minWidth, width);\n    this.height = Math.max(this.minHeight, height) + ascenderHeight;\n    this.ascenderHeight = ascenderHeight;\n    this.capline = this.ascenderHeight;\n    this.widthWithConnectedBlocks = this.width;\n  }\n\n  override startsWithElemSpacer() {\n    return false;\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Debug');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {FieldLabel} from '../../field_label.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport type {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\nimport type {RenderInfo as ZelosInfo} from '../zelos/info.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {RenderInfo} from './info.js';\n\n\n/**\n * An object that renders rectangles and dots for debugging rendering code.\n */\nexport class Debug {\n  /**\n   * Configuration object containing booleans to enable and disable debug\n   * rendering of specific rendering components.\n   */\n  static config = {\n    rowSpacers: true,\n    elemSpacers: true,\n    rows: true,\n    elems: true,\n    connections: true,\n    blockBounds: true,\n    connectedBlockBounds: true,\n    render: true,\n  };\n\n  /** An array of SVG elements that have been created by this object. */\n  private debugElements_: SVGElement[] = [];\n\n  /**\n   * The SVG root of the block that is being rendered.  Debug elements will\n   * be attached to this root.\n   */\n  private svgRoot_: SVGElement|null = null;\n\n  private randomColour_ = '';\n\n  /**\n   * @param constants The renderer's constants.\n   */\n  constructor(private readonly constants: ConstantProvider) {}\n\n  /**\n   * Remove all elements the this object created on the last pass.\n   */\n  protected clearElems() {\n    for (let i = 0; i < this.debugElements_.length; i++) {\n      const elem = this.debugElements_[i];\n      dom.removeNode(elem);\n    }\n\n    this.debugElements_ = [];\n  }\n\n  /**\n   * Draw a debug rectangle for a spacer (empty) row.\n   *\n   * @param row The row to render.\n   * @param cursorY The y position of the top of the row.\n   * @param isRtl Whether the block is rendered RTL.\n   */\n  protected drawSpacerRow(row: Row, cursorY: number, isRtl: boolean) {\n    if (!Debug.config.rowSpacers) {\n      return;\n    }\n\n    const height = Math.abs(row.height);\n    const isNegativeSpacing = row.height < 0;\n    if (isNegativeSpacing) {\n      cursorY -= height;\n    }\n\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'rowSpacerRect blockRenderDebug',\n          'x': isRtl ? -(row.xPos + row.width) : row.xPos,\n          'y': cursorY,\n          'width': row.width,\n          'height': height,\n          'stroke': isNegativeSpacing ? 'black' : 'blue',\n          'fill': 'blue',\n          'fill-opacity': '0.5',\n          'stroke-width': '1px',\n        },\n        this.svgRoot_));\n  }\n\n  /**\n   * Draw a debug rectangle for a horizontal spacer.\n   *\n   * @param elem The spacer to render.\n   * @param rowHeight The height of the container row.\n   * @param isRtl Whether the block is rendered RTL.\n   */\n  protected drawSpacerElem(\n      elem: InRowSpacer, rowHeight: number, isRtl: boolean) {\n    if (!Debug.config.elemSpacers) {\n      return;\n    }\n\n    const width = Math.abs(elem.width);\n    const isNegativeSpacing = elem.width < 0;\n    let xPos = isNegativeSpacing ? elem.xPos - width : elem.xPos;\n    if (isRtl) {\n      xPos = -(xPos + width);\n    }\n    const yPos = elem.centerline - elem.height / 2;\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'elemSpacerRect blockRenderDebug',\n          'x': xPos,\n          'y': yPos,\n          'width': width,\n          'height': elem.height,\n          'stroke': 'pink',\n          'fill': isNegativeSpacing ? 'black' : 'pink',\n          'fill-opacity': '0.5',\n          'stroke-width': '1px',\n        },\n        this.svgRoot_));\n  }\n\n  /**\n   * Draw a debug rectangle for an in-row element.\n   *\n   * @param elem The element to render.\n   * @param isRtl Whether the block is rendered RTL.\n   */\n  protected drawRenderedElem(elem: Measurable, isRtl: boolean) {\n    if (Debug.config.elems) {\n      let xPos = elem.xPos;\n      if (isRtl) {\n        xPos = -(xPos + elem.width);\n      }\n      const yPos = elem.centerline - elem.height / 2;\n      this.debugElements_.push(dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'rowRenderingRect blockRenderDebug',\n            'x': xPos,\n            'y': yPos,\n            'width': elem.width,\n            'height': elem.height,\n            'stroke': 'black',\n            'fill': 'none',\n            'stroke-width': '1px',\n          },\n          this.svgRoot_));\n\n      if (Types.isField(elem) && elem instanceof Field &&\n          elem.field instanceof FieldLabel) {\n        const baseline = this.constants.FIELD_TEXT_BASELINE;\n        this.debugElements_.push(dom.createSvgElement(\n            Svg.RECT, {\n              'class': 'rowRenderingRect blockRenderDebug',\n              'x': xPos,\n              'y': yPos + baseline,\n              'width': elem.width,\n              'height': '0.1px',\n              'stroke': 'red',\n              'fill': 'none',\n              'stroke-width': '0.5px',\n            },\n            this.svgRoot_));\n      }\n    }\n\n    if (Types.isInput(elem) && elem instanceof InputConnection &&\n        Debug.config.connections) {\n      this.drawConnection(elem.connectionModel);\n    }\n  }\n\n  /**\n   * Draw a circle at the location of the given connection.  Inputs and outputs\n   * share the same colours, as do previous and next.  When positioned correctly\n   * a connected pair will look like a bullseye.\n   *\n   * @param conn The connection to circle.\n   * @suppress {visibility} Suppress visibility of conn.offsetInBlock_ since\n   * this is a debug module.\n   */\n  protected drawConnection(conn: RenderedConnection) {\n    if (!Debug.config.connections) {\n      return;\n    }\n\n    let colour = '';\n    let size = 0;\n    let fill = '';\n    if (conn.type === ConnectionType.INPUT_VALUE) {\n      size = 4;\n      colour = 'magenta';\n      fill = 'none';\n    } else if (conn.type === ConnectionType.OUTPUT_VALUE) {\n      size = 2;\n      colour = 'magenta';\n      fill = colour;\n    } else if (conn.type === ConnectionType.NEXT_STATEMENT) {\n      size = 4;\n      colour = 'goldenrod';\n      fill = 'none';\n    } else if (conn.type === ConnectionType.PREVIOUS_STATEMENT) {\n      size = 2;\n      colour = 'goldenrod';\n      fill = colour;\n    }\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.CIRCLE, {\n          'class': 'blockRenderDebug',\n          'cx': conn.getOffsetInBlock().x,\n          'cy': conn.getOffsetInBlock().y,\n          'r': size,\n          'fill': fill,\n          'stroke': colour,\n        },\n        this.svgRoot_));\n  }\n\n  /**\n   * Draw a debug rectangle for a non-empty row.\n   *\n   * @param row The non-empty row to render.\n   * @param cursorY The y position of the top of the row.\n   * @param isRtl Whether the block is rendered RTL.\n   */\n  protected drawRenderedRow(row: Row, cursorY: number, isRtl: boolean) {\n    if (!Debug.config.rows) {\n      return;\n    }\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'elemRenderingRect blockRenderDebug',\n          'x': isRtl ? -(row.xPos + row.width) : row.xPos,\n          'y': row.yPos,\n          'width': row.width,\n          'height': row.height,\n          'stroke': 'red',\n          'fill': 'none',\n          'stroke-width': '1px',\n        },\n        this.svgRoot_));\n\n    if (Types.isTopOrBottomRow(row)) {\n      return;\n    }\n\n    if (Debug.config.connectedBlockBounds) {\n      this.debugElements_.push(dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'connectedBlockWidth blockRenderDebug',\n            'x': isRtl ? -(row.xPos + row.widthWithConnectedBlocks) : row.xPos,\n            'y': row.yPos,\n            'width': row.widthWithConnectedBlocks,\n            'height': row.height,\n            'stroke': this.randomColour_,\n            'fill': 'none',\n            'stroke-width': '1px',\n            'stroke-dasharray': '3,3',\n          },\n          this.svgRoot_));\n    }\n  }\n\n  /**\n   * Draw debug rectangles for a non-empty row and all of its subcomponents.\n   *\n   * @param row The non-empty row to render.\n   * @param cursorY The y position of the top of the row.\n   * @param isRtl Whether the block is rendered RTL.\n   */\n  protected drawRowWithElements(row: Row, cursorY: number, isRtl: boolean) {\n    for (let i = 0; i < row.elements.length; i++) {\n      const elem = row.elements[i];\n      if (!elem) {\n        console.warn('A row has an undefined or null element.', row, elem);\n        continue;\n      }\n      if (Types.isSpacer(elem)) {\n        this.drawSpacerElem(elem as InRowSpacer, row.height, isRtl);\n      } else {\n        this.drawRenderedElem(elem, isRtl);\n      }\n    }\n    this.drawRenderedRow(row, cursorY, isRtl);\n  }\n\n  /**\n   * Draw a debug rectangle around the entire block.\n   *\n   * @param info Rendering information about the block to debug.\n   */\n  protected drawBoundingBox(info: RenderInfo) {\n    if (!Debug.config.blockBounds) {\n      return;\n    }\n    // Bounding box without children.\n    let xPos = info.RTL ? -info.width : 0;\n    const yPos = 0;\n    this.debugElements_.push(dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blockBoundingBox blockRenderDebug',\n          'x': xPos,\n          'y': yPos,\n          'width': info.width,\n          'height': info.height,\n          'stroke': 'black',\n          'fill': 'none',\n          'stroke-width': '1px',\n          'stroke-dasharray': '5,5',\n        },\n        this.svgRoot_));\n\n    if (Debug.config.connectedBlockBounds) {\n      // Bounding box with children.\n      xPos = info.RTL ? -info.widthWithChildren : 0;\n      this.debugElements_.push(dom.createSvgElement(\n          Svg.RECT, {\n            'class': 'blockRenderDebug',\n            'x': xPos,\n            'y': yPos,\n            'width': info.widthWithChildren,\n            'height': info.height,\n            'stroke': '#DF57BC',\n            'fill': 'none',\n            'stroke-width': '1px',\n            'stroke-dasharray': '3,3',\n          },\n          this.svgRoot_));\n    }\n  }\n\n  /**\n   * Do all of the work to draw debug information for the whole block.\n   *\n   * @param block The block to draw debug information for.\n   * @param info Rendering information about the block to debug.\n   */\n  drawDebug(block: BlockSvg, info: RenderInfo) {\n    this.clearElems();\n    this.svgRoot_ = block.getSvgRoot();\n\n    this.randomColour_ =\n        '#' + Math.floor(Math.random() * 16777215).toString(16);\n\n    let cursorY = 0;\n    for (let i = 0; i < info.rows.length; i++) {\n      const row = info.rows[i];\n      if (Types.isBetweenRowSpacer(row)) {\n        this.drawSpacerRow(row, cursorY, info.RTL);\n      } else {\n        this.drawRowWithElements(row, cursorY, info.RTL);\n      }\n      cursorY += row.height;\n    }\n\n    if (block.previousConnection) {\n      this.drawConnection(block.previousConnection);\n    }\n    if (block.nextConnection) {\n      this.drawConnection(block.nextConnection);\n    }\n    if (block.outputConnection) {\n      this.drawConnection(block.outputConnection);\n    }\n    /**\n     * TODO: Find a better way to do this check without pulling in all of\n     * zelos, or just delete this line or the whole debug renderer.\n     */\n    const maybeZelosInfo = info as ZelosInfo;\n    if (maybeZelosInfo.rightSide) {\n      this.drawRenderedElem(maybeZelosInfo.rightSide, info.RTL);\n    }\n\n    this.drawBoundingBox(info);\n\n    this.drawRender(block.pathObject.svgPath);\n  }\n\n  /**\n   * Show a debug filter to highlight that a block has been rendered.\n   *\n   * @param svgPath The block's SVG path.\n   */\n  protected drawRender(svgPath: SVGElement) {\n    if (!Debug.config.render) {\n      return;\n    }\n    svgPath.setAttribute(\n        'filter', 'url(#' + this.constants.debugFilterId + ')');\n    setTimeout(function() {\n      svgPath.setAttribute('filter', '');\n    }, 100);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Coordinate} from '../../utils.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {Connection} from '../measurables/connection.js';\nimport type {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport type {Icon} from '../measurables/icon.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {PreviousConnection} from '../measurables/previous_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport {Types} from '../measurables/types.js';\n\nimport {isDynamicShape} from './constants.js';\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\nimport * as debug from './debug.js';\nimport type {RenderInfo} from './info.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer {\n  block_: BlockSvg;\n  info_: RenderInfo;\n  topLeft_: Coordinate;\n  outlinePath_ = '';\n  inlinePath_ = '';\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    this.block_ = block;\n    this.info_ = info;\n    this.topLeft_ = block.getRelativeToSurfaceXY();\n\n    /** The renderer's constant provider. */\n    this.constants_ = info.getRenderer().getConstants();\n  }\n\n  /**\n   * Draw the block to the workspace. Here \"drawing\" means setting SVG path\n   * elements and moving fields, icons, and connections on the screen.\n   *\n   * The pieces of the paths are pushed into arrays of \"steps\", which are then\n   * joined with spaces and set directly on the block.  This guarantees that\n   * the steps are separated by spaces for improved readability, but isn't\n   * required.\n   */\n  draw() {\n    this.hideHiddenIcons_();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    this.block_.pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      this.block_.pathObject.flipRTL();\n    }\n    if (debug.isDebuggerEnabled()) {\n      this.block_.renderingDebugger?.drawDebug(this.block_, this.info_);\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  /**\n   * Save sizing information back to the block\n   * Most of the rendering information can be thrown away at the end of the\n   * render. Anything that needs to be kept around should be set in this\n   * function.\n   */\n  protected recordSizeOnBlock_() {\n    // This is used when the block is reporting its size to anyone else.\n    // The dark path adds to the size of the block in both X and Y.\n    this.block_.height = this.info_.height;\n    this.block_.width = this.info_.widthWithChildren;\n  }\n\n  /** Hide icons that were marked as hidden. */\n  protected hideHiddenIcons_() {\n    for (let i = 0, iconInfo; iconInfo = this.info_.hiddenIcons[i]; i++) {\n      iconInfo.icon.iconGroup_?.setAttribute('display', 'none');\n    }\n  }\n\n  /** Create the outline of the block.  This is a single continuous path. */\n  protected drawOutline_() {\n    this.drawTop_();\n    for (let r = 1; r < this.info_.rows.length - 1; r++) {\n      const row = this.info_.rows[r];\n      if (row.hasJaggedEdge) {\n        this.drawJaggedEdge_(row);\n      } else if (row.hasStatement) {\n        this.drawStatementInput_(row);\n      } else if (row.hasExternalInput) {\n        this.drawValueInput_(row);\n      } else {\n        this.drawRightSideRow_(row);\n      }\n    }\n    this.drawBottom_();\n    this.drawLeft_();\n  }\n\n  /**\n   * Add steps for the top corner of the block, taking into account\n   * details such as hats and rounded corners.\n   */\n  protected drawTop_() {\n    const topRow = this.info_.topRow;\n    const elements = topRow.elements;\n\n    this.positionPreviousConnection_();\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n    for (let i = 0, elem; elem = elements[i]; i++) {\n      if (Types.isLeftRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        this.outlinePath_ += this.constants_.OUTSIDE_CORNERS.topRight;\n      } else if (\n          Types.isPreviousConnection(elem) && elem instanceof Connection) {\n        this.outlinePath_ +=\n            ((elem as PreviousConnection).shape as Notch).pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.outlinePath_ += this.constants_.START_HAT.path;\n      } else if (Types.isSpacer(elem)) {\n        this.outlinePath_ += svgPaths.lineOnAxis('h', elem.width);\n      }\n    }\n    // No branch for a square corner, because it's a no-op.\n    this.outlinePath_ += svgPaths.lineOnAxis('v', topRow.height);\n  }\n\n  /**\n   * Add steps for the jagged edge of a row on a collapsed block.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawJaggedEdge_(row: Row) {\n    const remainder = row.height - this.constants_.JAGGED_TEETH.height;\n    this.outlinePath_ +=\n        this.constants_.JAGGED_TEETH.path + svgPaths.lineOnAxis('v', remainder);\n  }\n\n  /**\n   * Add steps for an external value input, rendered as a notch in the side\n   * of the block.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawValueInput_(row: Row) {\n    const input = row.getLastInput() as ExternalValueInput | InlineInput;\n    this.positionExternalValueConnection_(row);\n\n    const pathDown = isDynamicShape(input.shape) ?\n        input.shape.pathDown(input.height) :\n        (input.shape as PuzzleTab).pathDown;\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', input.xPos + input.width) +\n        pathDown +\n        svgPaths.lineOnAxis('v', row.height - input.connectionHeight);\n  }\n\n  /**\n   * Add steps for a statement input.\n   *\n   * @param row The row that this input belongs to.\n   */\n  protected drawStatementInput_(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as Notch).width;\n\n    const innerTopLeftCorner = (input.shape as Notch).pathRight +\n        svgPaths.lineOnAxis(\n            'h', -(input.notchOffset - this.constants_.INSIDE_CORNERS.width)) +\n        this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', x) + innerTopLeftCorner +\n        svgPaths.lineOnAxis('v', innerHeight) +\n        this.constants_.INSIDE_CORNERS.pathBottom +\n        svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected drawRightSideRow_(row: Row) {\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps for the bottom edge of a block, possibly including a notch\n   * for the next connection.\n   */\n  protected drawBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    const elems = bottomRow.elements;\n    this.positionNextConnection_();\n\n    let rightCornerYOffset = 0;\n    let outlinePath = '';\n    for (let i = elems.length - 1, elem; elem = elems[i]; i--) {\n      if (Types.isNextConnection(elem) && elem instanceof Connection) {\n        outlinePath += (elem.shape as Notch).pathRight;\n      } else if (Types.isLeftSquareCorner(elem)) {\n        outlinePath += svgPaths.lineOnAxis('H', bottomRow.xPos);\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomLeft;\n      } else if (Types.isRightRoundedCorner(elem)) {\n        outlinePath += this.constants_.OUTSIDE_CORNERS.bottomRight;\n        rightCornerYOffset = this.constants_.OUTSIDE_CORNERS.rightHeight;\n      } else if (Types.isSpacer(elem)) {\n        outlinePath += svgPaths.lineOnAxis('h', elem.width * -1);\n      }\n    }\n\n    this.outlinePath_ +=\n        svgPaths.lineOnAxis('V', bottomRow.baseline - rightCornerYOffset);\n    this.outlinePath_ += outlinePath;\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected drawLeft_() {\n    const outputConnection = this.info_.outputConnection;\n    this.positionOutputConnection_();\n\n    if (outputConnection) {\n      const tabBottom =\n          outputConnection.connectionOffsetY + outputConnection.height;\n      const pathUp = isDynamicShape(outputConnection.shape) ?\n          outputConnection.shape.pathUp(outputConnection.height) :\n          (outputConnection.shape as PuzzleTab).pathUp;\n\n      // Draw a line up to the bottom of the tab.\n      this.outlinePath_ += svgPaths.lineOnAxis('V', tabBottom) + pathUp;\n    }\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /**\n   * Draw the internals of the block: inline inputs, fields, and icons.  These\n   * do not depend on the outer path for placement.\n   */\n  protected drawInternals_() {\n    for (let i = 0, row; row = this.info_.rows[i]; i++) {\n      for (let j = 0, elem; elem = row.elements[j]; j++) {\n        if (Types.isInlineInput(elem)) {\n          this.drawInlineInput_(elem as InlineInput);\n        } else if (Types.isIcon(elem) || Types.isField(elem)) {\n          this.layoutField_(elem as Field | Icon);\n        }\n      }\n    }\n  }\n\n  /**\n   * Push a field or icon's new position to its SVG root.\n   *\n   * @param fieldInfo The rendering information for the field or icon.\n   */\n  protected layoutField_(fieldInfo: Icon|Field) {\n    const svgGroup = Types.isField(fieldInfo) ?\n        (fieldInfo as Field).field.getSvgRoot()! :\n        (fieldInfo as Icon).icon.iconGroup_!;  // Never null in rendered case.\n\n    const yPos = fieldInfo.centerline - fieldInfo.height / 2;\n    let xPos = fieldInfo.xPos;\n    let scale = '';\n    if (this.info_.RTL) {\n      xPos = -(xPos + fieldInfo.width);\n      if (fieldInfo.flipRtl) {\n        xPos += fieldInfo.width;\n        scale = 'scale(-1 1)';\n      }\n    }\n    if (Types.isIcon(fieldInfo)) {\n      svgGroup.setAttribute('display', 'block');\n      svgGroup.setAttribute(\n          'transform', 'translate(' + xPos + ',' + yPos + ')');\n      (fieldInfo as Icon).icon.computeIconLocation();\n    } else {\n      svgGroup.setAttribute(\n          'transform', 'translate(' + xPos + ',' + yPos + ')' + scale);\n    }\n\n    if (this.info_.isInsertionMarker) {\n      // Fields and icons are invisible on insertion marker.  They still have to\n      // be rendered so that the block can be sized correctly.\n      svgGroup.setAttribute('display', 'none');\n    }\n  }\n\n  /**\n   * Add steps for an inline input.\n   *\n   * @param input The information about the input to render.\n   */\n  protected drawInlineInput_(input: InlineInput) {\n    const width = input.width;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionTop = input.connectionOffsetY;\n    const connectionBottom = input.connectionHeight + connectionTop;\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    this.inlinePath_ += svgPaths.moveTo(connectionRight, yPos) +\n        svgPaths.lineOnAxis('v', connectionTop) +\n        (input.shape as PuzzleTab).pathDown +\n        svgPaths.lineOnAxis('v', height - connectionBottom) +\n        svgPaths.lineOnAxis('h', width - input.connectionWidth) +\n        svgPaths.lineOnAxis('v', -height) + 'z';\n\n    this.positionInlineInputConnection_(input);\n  }\n\n  /**\n   * Position the connection on an inline value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param input The information about the input that the connection is on.\n   */\n  protected positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX = input.xPos + input.connectionWidth + input.connectionOffsetX;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n          connX, yPos + input.connectionOffsetY);\n    }\n  }\n\n  /**\n   * Position the connection on a statement input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /**\n   * Position the connection on an external value input, taking into account\n   * RTL and the small gap between the parent block and child block which lets\n   * the parent block's dark path show through.\n   *\n   * @param row The row that the connection is on.\n   */\n  protected positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  /** Position the previous connection on a block. */\n  protected positionPreviousConnection_() {\n    const topRow = this.info_.topRow;\n    if (topRow.connection) {\n      const x = topRow.xPos + topRow.notchOffset;\n      const connX = this.info_.RTL ? -x : x;\n      topRow.connection.connectionModel.setOffsetInBlock(connX, 0);\n    }\n  }\n\n  /** Position the next connection on a block. */\n  protected positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos;  // Already contains info about startX.\n      const connX = this.info_.RTL ? -x : x;\n      connInfo.connectionModel.setOffsetInBlock(connX, bottomRow.baseline);\n    }\n  }\n\n  /** Position the output connection on a block. */\n  protected positionOutputConnection_() {\n    if (this.info_.outputConnection) {\n      const x =\n          this.info_.startX + this.info_.outputConnection.connectionOffsetX;\n      const connX = this.info_.RTL ? -x : x;\n      this.block_.outputConnection.setOffsetInBlock(\n          connX, this.info_.outputConnection.connectionOffsetY);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Align, Input} from '../../input.js';\nimport {inputTypes} from '../../input_types.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {BottomRow} from '../measurables/bottom_row.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport {Field} from '../measurables/field.js';\nimport {Hat} from '../measurables/hat.js';\nimport {Icon} from '../measurables/icon.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InlineInput} from '../measurables/inline_input.js';\nimport {InputRow} from '../measurables/input_row.js';\nimport {JaggedEdge} from '../measurables/jagged_edge.js';\nimport {NextConnection} from '../measurables/next_connection.js';\nimport {OutputConnection} from '../measurables/output_connection.js';\nimport {PreviousConnection} from '../measurables/previous_connection.js';\nimport {RoundCorner} from '../measurables/round_corner.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport {SquareCorner} from '../measurables/square_corner.js';\nimport {StatementInput} from '../measurables/statement_input.js';\nimport {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo {\n  block_: BlockSvg;\n  protected constants_: ConstantProvider;\n  outputConnection: OutputConnection|null;\n  isInline: boolean;\n  isCollapsed: boolean;\n  isInsertionMarker: boolean;\n  RTL: boolean;\n\n  /** The block renderer in use. */\n  protected readonly renderer_!: Renderer;\n\n  /** The height of the rendered block, including child blocks. */\n  height = 0;\n\n  /** The width of the rendered block, including child blocks. */\n  widthWithChildren = 0;\n\n  /**\n   * The width of the rendered block, excluding child blocks.  This is the\n   * right edge of the block when rendered LTR.\n   */\n  width = 0;\n  statementEdge = 0;\n\n  /** An array of Row objects containing sizing information. */\n  rows: Row[] = [];\n\n  /** An array of input rows on the block. */\n  inputRows: InputRow[] = [];\n\n  /** An array of measurable objects containing hidden icons. */\n  hiddenIcons: Icon[] = [];\n  topRow: TopRow;\n  bottomRow: BottomRow;\n\n  // The position of the start point for drawing, relative to the block's\n  // location.\n  startX = 0;\n  startY = 0;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    this.renderer_ = renderer;\n\n    this.block_ = block;\n\n    /** The renderer's constant provider. */\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * A measurable representing the output connection if the block has one.\n     * Otherwise null.\n     */\n    this.outputConnection = block.outputConnection ?\n        new OutputConnection(this.constants_, block.outputConnection) :\n        null;\n\n    /**\n     * Whether the block should be rendered as a single line, either because\n     * it's inline or because it has been collapsed.\n     */\n    this.isInline = block.getInputsInline() && !block.isCollapsed();\n\n    /** Whether the block is collapsed. */\n    this.isCollapsed = block.isCollapsed();\n\n    /**\n     * Whether the block is an insertion marker.  Insertion markers are the same\n     * shape as normal blocks, but don't show fields.\n     */\n    this.isInsertionMarker = block.isInsertionMarker();\n\n    /** True if the block should be rendered right-to-left. */\n    this.RTL = block.RTL;\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  /**\n   * Populate and return an object containing all sizing information needed to\n   * draw this block.\n   *\n   * This measure pass does not propagate changes to the block (although fields\n   * may choose to rerender when getSize() is called).  However, calling it\n   * repeatedly may be expensive.\n   */\n  measure() {\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  /**\n   * Create rows of Measurable objects representing all renderable parts of the\n   * block.\n   */\n  protected createRows_() {\n    this.populateTopRow_();\n    this.rows.push(this.topRow);\n    let activeRow = new InputRow(this.constants_);\n    this.inputRows.push(activeRow);\n\n    // Icons always go on the first row, before anything else.\n    const icons = this.block_.getIcons();\n    for (let i = 0, icon; icon = icons[i]; i++) {\n      const iconInfo = new Icon(this.constants_, icon);\n      if (this.isCollapsed && icon.collapseHidden) {\n        this.hiddenIcons.push(iconInfo);\n      } else {\n        activeRow.elements.push(iconInfo);\n      }\n    }\n\n    let lastInput = undefined;\n    // Loop across all of the inputs on the block, creating objects for anything\n    // that needs to be rendered and breaking the block up into visual rows.\n    for (let i = 0, input; input = this.block_.inputList[i]; i++) {\n      if (!input.isVisible()) {\n        continue;\n      }\n      if (this.shouldStartNewRow_(input, lastInput)) {\n        // Finish this row and create a new one.\n        this.rows.push(activeRow);\n        activeRow = new InputRow(this.constants_);\n        this.inputRows.push(activeRow);\n      }\n\n      // All of the fields in an input go on the same row.\n      for (let j = 0, field; field = input.fieldRow[j]; j++) {\n        activeRow.elements.push(new Field(this.constants_, field, input));\n      }\n      this.addInput_(input, activeRow);\n      lastInput = input;\n    }\n\n    if (this.isCollapsed) {\n      activeRow.hasJaggedEdge = true;\n      activeRow.elements.push(new JaggedEdge(this.constants_));\n    }\n\n    if (activeRow.elements.length || activeRow.hasDummyInput) {\n      this.rows.push(activeRow);\n    }\n    this.populateBottomRow_();\n    this.rows.push(this.bottomRow);\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the top row.\n   */\n  protected populateTopRow_() {\n    const hasPrevious = !!this.block_.previousConnection;\n    const hasHat = (this.block_.hat ? this.block_.hat === 'cap' :\n                                      this.constants_.ADD_START_HATS) &&\n        !this.outputConnection && !hasPrevious;\n\n    let cornerClass = this.topRow.hasLeftSquareCorner(this.block_) ?\n        SquareCorner :\n        RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_));\n\n    if (hasHat) {\n      const hat = new Hat(this.constants_);\n      this.topRow.elements.push(hat);\n      this.topRow.capline = hat.ascenderHeight;\n    } else if (hasPrevious) {\n      this.topRow.hasPreviousConnection = true;\n      this.topRow.connection = new PreviousConnection(\n          this.constants_,\n          (this.block_.previousConnection as RenderedConnection));\n      this.topRow.elements.push(this.topRow.connection);\n    }\n\n    const precedesStatement = this.block_.inputList.length &&\n        this.block_.inputList[0].type === inputTypes.STATEMENT;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (precedesStatement && !this.block_.isCollapsed()) {\n      this.topRow.minHeight =\n          this.constants_.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.topRow.minHeight = this.constants_.TOP_ROW_MIN_HEIGHT;\n    }\n\n    cornerClass = this.topRow.hasRightSquareCorner(this.block_) ? SquareCorner :\n                                                                  RoundCorner;\n    this.topRow.elements.push(new cornerClass(this.constants_, 'right'));\n  }\n\n  /**\n   * Create all non-spacer elements that belong on the bottom row.\n   */\n  protected populateBottomRow_() {\n    this.bottomRow.hasNextConnection = !!this.block_.nextConnection;\n\n    const followsStatement = this.block_.inputList.length &&\n        this.block_.inputList[this.block_.inputList.length - 1].type ===\n            inputTypes.STATEMENT;\n\n    // This is the minimum height for the row. If one of its elements has a\n    // greater height it will be overwritten in the compute pass.\n    if (followsStatement) {\n      this.bottomRow.minHeight =\n          this.constants_.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT;\n    } else {\n      this.bottomRow.minHeight = this.constants_.BOTTOM_ROW_MIN_HEIGHT;\n    }\n\n    const leftSquareCorner = this.bottomRow.hasLeftSquareCorner(this.block_);\n\n    if (leftSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_));\n    }\n\n    if (this.bottomRow.hasNextConnection) {\n      this.bottomRow.connection = new NextConnection(\n          this.constants_, (this.block_.nextConnection as RenderedConnection));\n      this.bottomRow.elements.push(this.bottomRow.connection);\n    }\n\n    const rightSquareCorner = this.bottomRow.hasRightSquareCorner(this.block_);\n\n    if (rightSquareCorner) {\n      this.bottomRow.elements.push(new SquareCorner(this.constants_, 'right'));\n    } else {\n      this.bottomRow.elements.push(new RoundCorner(this.constants_, 'right'));\n    }\n  }\n\n  /**\n   * Add an input element to the active row, if needed, and record the type of\n   * the input on the row.\n   *\n   * @param input The input to record information about.\n   * @param activeRow The row that is currently being populated.\n   */\n  protected addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input.type === inputTypes.STATEMENT) {\n      activeRow.elements.push(new StatementInput(this.constants_, input));\n      activeRow.hasStatement = true;\n    } else if (input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input.type === inputTypes.DUMMY) {\n      // Dummy inputs have no visual representation, but the information is\n      // still important.\n      activeRow.minHeight = Math.max(\n          activeRow.minHeight,\n          input.getSourceBlock() && input.getSourceBlock()!.isShadow() ?\n              this.constants_.DUMMY_INPUT_SHADOW_MIN_HEIGHT :\n              this.constants_.DUMMY_INPUT_MIN_HEIGHT);\n      activeRow.hasDummyInput = true;\n    }\n    if (activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  /**\n   * Decide whether to start a new row between the two Blockly.Inputs.\n   *\n   * @param input The first input to consider\n   * @param lastInput The input that follows.\n   * @returns True if the next input should be rendered on a new row.\n   */\n  protected shouldStartNewRow_(input: Input, lastInput?: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!lastInput) {\n      return false;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (input.type === inputTypes.STATEMENT ||\n        lastInput.type === inputTypes.STATEMENT) {\n      return true;\n    }\n    // Value and dummy inputs get new row if inputs are not inlined.\n    if (input.type === inputTypes.VALUE || input.type === inputTypes.DUMMY) {\n      return !this.isInline;\n    }\n    return false;\n  }\n\n  /** Add horizontal spacing between and around elements within each row. */\n  protected addElemSpacing_() {\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_,\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null)));\n      }\n    }\n  }\n\n  /**\n   * Calculate the width of a spacer element in a row based on the previous and\n   * next elements in that row.  For instance, extra padding is added between\n   * two editable fields.\n   *\n   * @param prev The element before the spacer.\n   * @param next The element after the spacer.\n   * @returns The size of the spacing between the two elements.\n   */\n  protected getInRowSpacing_(prev: Measurable|null, next: Measurable|null):\n      number {\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Between inputs and the end of the row.\n    if (prev && Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a square corner and a previous or next connection\n    if (prev && Types.isLeftSquareCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Figure out where the right edge of the block and right edge of statement\n   * inputs should be placed.\n   */\n  protected computeBounds_() {\n    let widestStatementRowFields = 0;\n    let blockWidth = 0;\n    let widestRowWithConnectedBlocks = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      row.measure();\n      blockWidth = Math.max(blockWidth, row.width);\n      if (row.hasStatement) {\n        const statementInput = row.getLastInput();\n        const innerWidth = row.width - (statementInput?.width ?? 0);\n        widestStatementRowFields =\n            Math.max(widestStatementRowFields, innerWidth);\n      }\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n    }\n\n    this.statementEdge = widestStatementRowFields;\n    this.width = blockWidth;\n\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasStatement) {\n        row.statementEdge = this.statementEdge;\n      }\n    }\n\n    this.widthWithChildren = Math.max(blockWidth, widestRowWithConnectedBlocks);\n\n    if (this.outputConnection) {\n      this.startX = this.outputConnection.width;\n      this.width += this.outputConnection.width;\n      this.widthWithChildren += this.outputConnection.width;\n    }\n  }\n\n  /**\n   * Extra spacing may be necessary to make sure that the right sides of all\n   * rows line up.  This can only be calculated after a first pass to calculate\n   * the sizes of all rows.\n   */\n  protected alignRowElements_() {\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasStatement) {\n        this.alignStatementRow_(row as InputRow);\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth = this.getDesiredRowWidth_(row);\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        if (Types.isTopOrBottomRow(row)) {\n          row.widthWithConnectedBlocks = row.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Calculate the desired width of an input row.\n   *\n   * @param _row The input row.\n   * @returns The desired width of the input row.\n   */\n  protected getDesiredRowWidth_(_row: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Modify the given row to add the given amount of padding around its fields.\n   * The exact location of the padding is based on the alignment property of the\n   * last input in the field.\n   *\n   * @param row The row to add padding to.\n   * @param missingSpace How much padding to add.\n   */\n  protected addAlignmentPadding_(row: Row, missingSpace: number) {\n    const firstSpacer = row.getFirstSpacer();\n    const lastSpacer = row.getLastSpacer();\n    if (row.hasExternalInput || row.hasStatement) {\n      row.widthWithConnectedBlocks += missingSpace;\n    }\n\n    // Decide where the extra padding goes.\n    if (row.align === Align.LEFT && lastSpacer) {\n      // Add padding to the end of the row.\n      lastSpacer.width += missingSpace;\n    } else if (row.align === Align.CENTRE && firstSpacer && lastSpacer) {\n      // Split the padding between the beginning and end of the row.\n      firstSpacer.width += missingSpace / 2;\n      lastSpacer.width += missingSpace / 2;\n    } else if (row.align === Align.RIGHT && firstSpacer) {\n      // Add padding at the beginning of the row.\n      firstSpacer.width += missingSpace;\n    } else if (lastSpacer) {\n      // Default to left-aligning.\n      lastSpacer.width += missingSpace;\n    } else {\n      return;\n    }\n    row.width += missingSpace;\n  }\n\n  /**\n   * Align the elements of a statement row based on computed bounds.\n   * Unlike other types of rows, statement rows add space in multiple places.\n   *\n   * @param row The statement row to resize.\n   */\n  protected alignStatementRow_(row: InputRow) {\n    const statementInput = row.getLastInput();\n    if (!statementInput) return;\n    let currentWidth = row.width - statementInput.width;\n    let desiredWidth = this.statementEdge;\n    // Add padding before the statement input.\n    const missingSpace = desiredWidth - currentWidth;\n    if (missingSpace > 0) {\n      this.addAlignmentPadding_(row, missingSpace);\n    }\n    // Also widen the statement input to reach to the right side of the\n    // block. Note that this does not add padding.\n    currentWidth = row.width;\n    desiredWidth = this.getDesiredRowWidth_(row);\n    statementInput.width += desiredWidth - currentWidth;\n    statementInput.height = Math.max(statementInput.height, row.height);\n    row.width += desiredWidth - currentWidth;\n    row.widthWithConnectedBlocks =\n        Math.max(row.width, this.statementEdge + row.connectedBlockWidths);\n  }\n\n  /** Add spacers between rows and set their sizes. */\n  protected addRowSpacing_() {\n    const oldRows = this.rows;\n    this.rows = [];\n\n    for (let r = 0; r < oldRows.length; r++) {\n      this.rows.push(oldRows[r]);\n      if (r !== oldRows.length - 1) {\n        this.rows.push(this.makeSpacerRow_(oldRows[r], oldRows[r + 1]));\n      }\n    }\n  }\n\n  /**\n   * Create a spacer row to go between prev and next, and set its size.\n   *\n   * @param prev The previous row.\n   * @param next The next row.\n   * @returns The newly created spacer row.\n   */\n  protected makeSpacerRow_(prev: Row, next: Row): SpacerRow {\n    const height = this.getSpacerRowHeight_(prev, next);\n    const width = this.getSpacerRowWidth_(prev, next);\n    const spacer = new SpacerRow(this.constants_, height, width);\n    if (prev.hasStatement) {\n      spacer.followsStatement = true;\n    }\n    if (next.hasStatement) {\n      spacer.precedesStatement = true;\n    }\n    return spacer;\n  }\n\n  /**\n   * Calculate the width of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired width of the spacer row between these two rows.\n   */\n  protected getSpacerRowWidth_(_prev: Row, _next: Row): number {\n    return this.width - this.startX;\n  }\n\n  /**\n   * Calculate the height of a spacer row.\n   *\n   * @param _prev The row before the spacer.\n   * @param _next The row after the spacer.\n   * @returns The desired height of the spacer row between these two rows.\n   */\n  protected getSpacerRowHeight_(_prev: Row, _next: Row): number {\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  /**\n   * Calculate the centerline of an element in a rendered row.\n   * This base implementation puts the centerline at the middle of the row\n   * vertically, with no special cases.  You will likely need extra logic to\n   * handle (at minimum) top and bottom rows.\n   *\n   * @param row The row containing the element.\n   * @param elem The element to place.\n   * @returns The desired centerline of the given element, as an offset from the\n   *     top left of the block.\n   */\n  protected getElemCenterline_(row: Row, elem: Measurable): number {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n          bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n    return row.yPos + row.height / 2;\n  }\n\n  /**\n   * Record final position information on elements on the given row, for use in\n   * drawing.  At minimum this records xPos and centerline on each element.\n   *\n   * @param row The row containing the elements.\n   */\n  protected recordElemPositions_(row: Row) {\n    let xCursor = row.xPos;\n    for (let j = 0, elem; elem = row.elements[j]; j++) {\n      // Now that row heights are finalized, make spacers use the row height.\n      if (Types.isSpacer(elem)) {\n        elem.height = row.height;\n      }\n      elem.xPos = xCursor;\n      elem.centerline = this.getElemCenterline_(row, elem);\n      xCursor += elem.width;\n    }\n  }\n\n  /**\n   * Make any final changes to the rendering information object.  In particular,\n   * store the y position of each row, and record the height of the full block.\n   */\n  protected finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n            widestRowWithConnectedBlocks, target.getHeightWidth().width);\n      }\n    }\n\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.MarkerSvg');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../../events/events_marker_move.js';\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport * as eventUtils from '../../events/utils.js';\nimport type {Field} from '../../field.js';\nimport type {IASTNodeLocationSvg} from '../../interfaces/i_ast_node_location_svg.js';\nimport {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport type {ConstantProvider, Notch, PuzzleTab} from './constants.js';\n\n\n/** The name of the CSS class for a cursor. */\nconst CURSOR_CLASS = 'blocklyCursor';\n\n/** The name of the CSS class for a marker. */\nconst MARKER_CLASS = 'blocklyMarker';\n\n/**\n * What we multiply the height by to get the height of the marker.\n * Only used for the block and block connections.\n */\nconst HEIGHT_MULTIPLIER = 3 / 4;\n\n/**\n * Class for a marker, containing methods for graphically rendering a marker as\n * SVG.\n */\nexport class MarkerSvg {\n  /**\n   * The workspace, field, or block that the marker SVG element should be\n   * attached to.\n   */\n  private parent_: IASTNodeLocationSvg|null = null;\n\n  /** The current SVG element for the marker. */\n  currentMarkerSvg: SVGElement|null = null;\n  colour_: string;\n\n  /** The root SVG group containing the marker. */\n  protected markerSvg_: SVGGElement|null = null;\n  protected svgGroup_: SVGGElement|null = null;\n\n  protected markerBlock_: SVGPathElement|null = null;\n\n  protected markerInput_: SVGPathElement|null = null;\n  protected markerSvgLine_: SVGRectElement|null = null;\n\n  protected markerSvgRect_: SVGRectElement|null = null;\n\n  /** The constants necessary to draw the marker. */\n  protected constants_: ConstantProvider;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n      private readonly workspace: WorkspaceSvg, constants: ConstantProvider,\n      private readonly marker: Marker) {\n    this.constants_ = constants;\n\n    const defaultColour = this.isCursor() ? this.constants_.CURSOR_COLOUR :\n                                            this.constants_.MARKER_COLOUR;\n\n    /** The colour of the marker. */\n    this.colour_ = marker.colour || defaultColour;\n  }\n\n  /**\n   * Return the root node of the SVG or null if none exists.\n   *\n   * @returns The root SVG node.\n   */\n  getSvgRoot(): SVGElement|null {\n    return this.svgGroup_;\n  }\n\n  /**\n   * Get the marker.\n   *\n   * @returns The marker to draw for.\n   */\n  getMarker(): Marker {\n    return this.marker;\n  }\n\n  /**\n   * True if the marker should be drawn as a cursor, false otherwise.\n   * A cursor is drawn as a flashing line. A marker is drawn as a solid line.\n   *\n   * @returns True if the marker is a cursor, false otherwise.\n   */\n  isCursor(): boolean {\n    return this.marker.type === 'cursor';\n  }\n\n  /**\n   * Create the DOM element for the marker.\n   *\n   * @returns The marker controls SVG group.\n   */\n  createDom(): SVGElement {\n    const className = this.isCursor() ? CURSOR_CLASS : MARKER_CLASS;\n\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': className});\n\n    this.createDomInternal_();\n    return this.svgGroup_;\n  }\n\n  /**\n   * Attaches the SVG root of the marker to the SVG group of the parent.\n   *\n   * @param newParent The workspace, field, or block that the marker SVG element\n   *     should be attached to.\n   */\n  protected setParent_(newParent: IASTNodeLocationSvg) {\n    if (!this.isCursor()) {\n      if (this.parent_) {\n        this.parent_.setMarkerSvg(null);\n      }\n      newParent.setMarkerSvg(this.getSvgRoot());\n    } else {\n      if (this.parent_) {\n        this.parent_.setCursorSvg(null);\n      }\n      newParent.setCursorSvg(this.getSvgRoot());\n    }\n    this.parent_ = newParent;\n  }\n\n  /**\n   * Update the marker.\n   *\n   * @param oldNode The previous node the marker was on or null.\n   * @param curNode The node that we want to draw the marker for.\n   */\n  draw(oldNode: ASTNode, curNode: ASTNode) {\n    if (!curNode) {\n      this.hide();\n      return;\n    }\n\n    this.constants_ = this.workspace.getRenderer().getConstants();\n\n    const defaultColour = this.isCursor() ? this.constants_.CURSOR_COLOUR :\n                                            this.constants_.MARKER_COLOUR;\n    this.colour_ = this.marker.colour || defaultColour;\n    this.applyColour_(curNode);\n\n    this.showAtLocation_(curNode);\n\n    this.fireMarkerEvent_(oldNode, curNode);\n\n    // Ensures the marker will be visible immediately after the move.\n    const animate = this.currentMarkerSvg!.childNodes[0];\n    if (animate !== undefined) {\n      (animate as SVGAnimationElement).beginElement &&\n          (animate as SVGAnimationElement).beginElement();\n    }\n  }\n\n  /**\n   * Update the marker's visible state based on the type of curNode..\n   *\n   * @param curNode The node that we want to draw the marker for.\n   */\n  protected showAtLocation_(curNode: ASTNode) {\n    const curNodeAsConnection = curNode.getLocation() as Connection;\n    const connectionType = curNodeAsConnection.type;\n    if (curNode.getType() === ASTNode.types.BLOCK) {\n      this.showWithBlock_(curNode);\n    } else if (curNode.getType() === ASTNode.types.OUTPUT) {\n      this.showWithOutput_(curNode);\n    } else if (connectionType === ConnectionType.INPUT_VALUE) {\n      this.showWithInput_(curNode);\n    } else if (connectionType === ConnectionType.NEXT_STATEMENT) {\n      this.showWithNext_(curNode);\n    } else if (curNode.getType() === ASTNode.types.PREVIOUS) {\n      this.showWithPrevious_(curNode);\n    } else if (curNode.getType() === ASTNode.types.FIELD) {\n      this.showWithField_(curNode);\n    } else if (curNode.getType() === ASTNode.types.WORKSPACE) {\n      this.showWithCoordinates_(curNode);\n    } else if (curNode.getType() === ASTNode.types.STACK) {\n      this.showWithStack_(curNode);\n    }\n  }\n\n  /**************************\n   * Display\n   **************************/\n\n  /**\n   * Show the marker as a combination of the previous connection and block,\n   * the output connection and block, or just the block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithBlockPrevOutput_(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const width = block.width;\n    const height = block.height;\n    const markerHeight = height * HEIGHT_MULTIPLIER;\n    const markerOffset = this.constants_.CURSOR_BLOCK_PADDING;\n\n    if (block.previousConnection) {\n      const connectionShape =\n          this.constants_.shapeFor(block.previousConnection) as Notch;\n      this.positionPrevious_(\n          width, markerOffset, markerHeight, connectionShape);\n    } else if (block.outputConnection) {\n      const connectionShape =\n          this.constants_.shapeFor(block.outputConnection) as PuzzleTab;\n      this.positionOutput_(width, height, connectionShape);\n    } else {\n      this.positionBlock_(width, markerOffset, markerHeight);\n    }\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a block.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithBlock_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput_(curNode);\n  }\n\n  /**\n   * Position and display the marker for a previous connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithPrevious_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput_(curNode);\n  }\n\n  /**\n   * Position and display the marker for an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithOutput_(curNode: ASTNode) {\n    this.showWithBlockPrevOutput_(curNode);\n  }\n\n  /**\n   * Position and display the marker for a workspace coordinate.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithCoordinates_(curNode: ASTNode) {\n    const wsCoordinate = curNode.getWsCoordinate();\n    let x = wsCoordinate.x;\n    const y = wsCoordinate.y;\n\n    if (this.workspace.RTL) {\n      x -= this.constants_.CURSOR_WS_WIDTH;\n    }\n\n    this.positionLine_(x, y, this.constants_.CURSOR_WS_WIDTH);\n    this.setParent_(this.workspace);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a field.\n   * This is a box around the field.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithField_(curNode: ASTNode) {\n    const field = curNode.getLocation() as Field;\n    const width = field.getSize().width;\n    const height = field.getSize().height;\n\n    this.positionRect_(0, 0, width, height);\n    this.setParent_(field);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for an input.\n   * This is a puzzle piece.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithInput_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const sourceBlock = (connection.getSourceBlock());\n\n    this.positionInput_(connection);\n    this.setParent_(sourceBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a next connection.\n   * This is a horizontal line.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithNext_(curNode: ASTNode) {\n    const connection = curNode.getLocation() as RenderedConnection;\n    const targetBlock = (connection.getSourceBlock());\n    let x = 0;\n    const y = connection.getOffsetInBlock().y;\n    const width = targetBlock.getHeightWidth().width;\n    if (this.workspace.RTL) {\n      x = -width;\n    }\n    this.positionLine_(x, y, width);\n    this.setParent_(targetBlock);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position and display the marker for a stack.\n   * This is a box with extra padding around the entire stack of blocks.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  protected showWithStack_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    const width = heightWidth.width + this.constants_.CURSOR_STACK_PADDING;\n    const height = heightWidth.height + this.constants_.CURSOR_STACK_PADDING;\n\n    // Shift the rectangle slightly to upper left so padding is equal on all\n    // sides.\n    const xPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n    const yPadding = -this.constants_.CURSOR_STACK_PADDING / 2;\n\n    let x = xPadding;\n    const y = yPadding;\n\n    if (this.workspace.RTL) {\n      x = -(width + xPadding);\n    }\n    this.positionRect_(x, y, width, height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /** Show the current marker. */\n  protected showCurrent_() {\n    this.hide();\n    if (this.currentMarkerSvg) {\n      this.currentMarkerSvg.style.display = '';\n    }\n  }\n\n  /**************************\n   * Position\n   **************************/\n\n  /**\n   * Position the marker for a block.\n   * Displays an outline of the top half of a rectangle around a block.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The extra padding for around the block.\n   * @param markerHeight The height of the marker.\n   */\n  protected positionBlock_(\n      width: number, markerOffset: number, markerHeight: number) {\n    const markerPath = svgPaths.moveBy(-markerOffset, markerHeight) +\n        svgPaths.lineOnAxis('V', -markerOffset) +\n        svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n        svgPaths.lineOnAxis('V', markerHeight);\n    if (!this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before positioning the marker');\n    }\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl_(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for an input connection.\n   * Displays a filled in puzzle piece.\n   *\n   * @param connection The connection to position marker around.\n   */\n  protected positionInput_(connection: RenderedConnection) {\n    const x = connection.getOffsetInBlock().x;\n    const y = connection.getOffsetInBlock().y;\n\n    const path = svgPaths.moveTo(0, 0) +\n        (this.constants_.shapeFor(connection) as PuzzleTab).pathDown;\n\n    this.markerInput_!.setAttribute('d', path);\n    this.markerInput_!.setAttribute(\n        'transform',\n        'translate(' + x + ',' + y + ')' +\n            (this.workspace.RTL ? ' scale(-1 1)' : ''));\n    this.currentMarkerSvg = this.markerInput_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a horizontal line.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   */\n  protected positionLine_(x: number, y: number, width: number) {\n    if (!this.markerSvgLine_) {\n      throw new Error('createDom should be called before positioning the line');\n    }\n    this.markerSvgLine_.setAttribute('x', `${x}`);\n    this.markerSvgLine_.setAttribute('y', `${y}`);\n    this.markerSvgLine_.setAttribute('width', `${width}`);\n    this.currentMarkerSvg = this.markerSvgLine_;\n  }\n\n  /**\n   * Position the marker for an output connection.\n   * Displays a puzzle outline and the top and bottom path.\n   *\n   * @param width The width of the block.\n   * @param height The height of the block.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionOutput_(\n      width: number, height: number, connectionShape: PuzzleTab) {\n    if (!this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before positioning the output');\n    }\n    const markerPath = svgPaths.moveBy(width, 0) +\n        svgPaths.lineOnAxis('h', -(width - connectionShape.width)) +\n        svgPaths.lineOnAxis('v', this.constants_.TAB_OFFSET_FROM_TOP) +\n        connectionShape.pathDown + svgPaths.lineOnAxis('V', height) +\n        svgPaths.lineOnAxis('H', width);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl_(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Position the marker for a previous connection.\n   * Displays a half rectangle with a notch in the top to represent the previous\n   * connection.\n   *\n   * @param width The width of the block.\n   * @param markerOffset The offset of the marker from around the block.\n   * @param markerHeight The height of the marker.\n   * @param connectionShape The shape object for the connection.\n   */\n  protected positionPrevious_(\n      width: number, markerOffset: number, markerHeight: number,\n      connectionShape: Notch) {\n    if (!this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before positioning the previous connection marker');\n    }\n    const markerPath = svgPaths.moveBy(-markerOffset, markerHeight) +\n        svgPaths.lineOnAxis('V', -markerOffset) +\n        svgPaths.lineOnAxis('H', this.constants_.NOTCH_OFFSET_LEFT) +\n        connectionShape.pathLeft +\n        svgPaths.lineOnAxis('H', width + markerOffset * 2) +\n        svgPaths.lineOnAxis('V', markerHeight);\n    this.markerBlock_.setAttribute('d', markerPath);\n    if (this.workspace.RTL) {\n      this.flipRtl_(this.markerBlock_);\n    }\n    this.currentMarkerSvg = this.markerBlock_;\n  }\n\n  /**\n   * Move and show the marker at the specified coordinate in workspace units.\n   * Displays a filled in rectangle.\n   *\n   * @param x The new x, in workspace units.\n   * @param y The new y, in workspace units.\n   * @param width The new width, in workspace units.\n   * @param height The new height, in workspace units.\n   */\n  protected positionRect_(x: number, y: number, width: number, height: number) {\n    if (!this.markerSvgRect_) {\n      throw new Error('createDom should be called before positioning the rect');\n    }\n    this.markerSvgRect_.setAttribute('x', `${x}`);\n    this.markerSvgRect_.setAttribute('y', `${y}`);\n    this.markerSvgRect_.setAttribute('width', `${width}`);\n    this.markerSvgRect_.setAttribute('height', `${height}`);\n    this.currentMarkerSvg = this.markerSvgRect_;\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   *\n   * @param markerSvg The marker that we want to flip.\n   */\n  private flipRtl_(markerSvg: SVGElement) {\n    markerSvg.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /** Hide the marker. */\n  hide() {\n    if (!this.markerSvgLine_ || !this.markerSvgRect_ || !this.markerInput_ ||\n        !this.markerBlock_) {\n      throw new Error('createDom should be called before hiding the marker');\n    }\n    this.markerSvgLine_.style.display = 'none';\n    this.markerSvgRect_.style.display = 'none';\n    this.markerInput_.style.display = 'none';\n    this.markerBlock_.style.display = 'none';\n  }\n\n  /**\n   * Fire event for the marker or marker.\n   *\n   * @param oldNode The old node the marker used to be on.\n   * @param curNode The new node the marker is currently on.\n   */\n  private fireMarkerEvent_(oldNode: ASTNode, curNode: ASTNode) {\n    const curBlock = curNode.getSourceBlock();\n    const event = new (eventUtils.get(eventUtils.MARKER_MOVE))(\n        curBlock, this.isCursor(), oldNode, curNode);\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Get the properties to make a marker blink.\n   *\n   * @returns The object holding attributes to make the marker blink.\n   */\n  protected getBlinkProperties_(): {[key: string]: string} {\n    return {\n      'attributeType': 'XML',\n      'attributeName': 'fill',\n      'dur': '1s',\n      'values': this.colour_ + ';transparent;transparent;',\n      'repeatCount': 'indefinite',\n    };\n  }\n\n  /**\n   * Create the marker SVG.\n   *\n   * @returns The SVG node created.\n   */\n  protected createDomInternal_(): Element {\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\"\n        repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n\n    this.markerSvg_ = dom.createSvgElement(\n        Svg.G, {\n          'width': this.constants_.CURSOR_WS_WIDTH,\n          'height': this.constants_.WS_CURSOR_HEIGHT,\n        },\n        this.svgGroup_);\n\n    // A horizontal line used to represent a workspace coordinate or next\n    // connection.\n    this.markerSvgLine_ = dom.createSvgElement(\n        Svg.RECT, {\n          'width': this.constants_.CURSOR_WS_WIDTH,\n          'height': this.constants_.WS_CURSOR_HEIGHT,\n          'style': 'display: none',\n        },\n        this.markerSvg_);\n\n    // A filled in rectangle used to represent a stack.\n    this.markerSvgRect_ = dom.createSvgElement(\n        Svg.RECT, {\n          'class': 'blocklyVerticalMarker',\n          'rx': 10,\n          'ry': 10,\n          'style': 'display: none',\n        },\n        this.markerSvg_);\n\n    // A filled in puzzle piece used to represent an input value.\n    this.markerInput_ = dom.createSvgElement(\n        Svg.PATH, {'transform': '', 'style': 'display: none'}, this.markerSvg_);\n\n    // A path used to represent a previous connection and a block, an output\n    // connection and a block, or a block.\n    this.markerBlock_ = dom.createSvgElement(\n        Svg.PATH, {\n          'transform': '',\n          'style': 'display: none',\n          'fill': 'none',\n          'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n        },\n        this.markerSvg_);\n\n    // Markers and stack markers don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerSvgLine_);\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerInput_);\n      dom.createSvgElement(\n          Svg.ANIMATE, {...blinkProperties, attributeName: 'stroke'},\n          this.markerBlock_);\n    }\n\n    return this.markerSvg_;\n  }\n\n  /**\n   * Apply the marker's colour.\n   *\n   * @param _curNode The node that we want to draw the marker for.\n   */\n  protected applyColour_(_curNode: ASTNode) {\n    if (!this.markerSvgLine_ || !this.markerSvgRect_ || !this.markerInput_ ||\n        !this.markerBlock_) {\n      throw new Error(\n          'createDom should be called before applying color to the markerj');\n    }\n    this.markerSvgLine_.setAttribute('fill', this.colour_);\n    this.markerSvgRect_.setAttribute('stroke', this.colour_);\n    this.markerInput_.setAttribute('fill', this.colour_);\n    this.markerBlock_.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerSvgLine_.firstElementChild!.setAttribute('values', values);\n      this.markerInput_.firstElementChild!.setAttribute('values', values);\n      this.markerBlock_.firstElementChild!.setAttribute('values', values);\n    }\n  }\n\n  /** Dispose of this marker. */\n  dispose() {\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.PathObject');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport type {IPathObject} from './i_path_object.js';\n\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject implements IPathObject {\n  svgRoot: SVGElement;\n  svgPath: SVGElement;\n\n  /**\n   * Holds the cursors svg element when the cursor is attached to the block.\n   * This is null if there is no cursor on the block.\n   */\n  cursorSvg: SVGElement|null = null;\n\n  /**\n   * Holds the markers svg element when the marker is attached to the block.\n   * This is null if there is no marker on the block.\n   */\n  markerSvg: SVGElement|null = null;\n\n  constants: ConstantProvider;\n  style: BlockStyle;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n      root: SVGElement, style: BlockStyle, constants: ConstantProvider) {\n    this.constants = constants;\n    this.style = style;\n    this.svgRoot = root;\n\n    /** The primary path of the block. */\n    this.svgPath =\n        dom.createSvgElement(Svg.PATH, {'class': 'blocklyPath'}, this.svgRoot);\n  }\n\n  /**\n   * Set the path generated by the renderer onto the respective SVG element.\n   *\n   * @param pathString The path.\n   */\n  setPath(pathString: string) {\n    this.svgPath.setAttribute('d', pathString);\n  }\n\n  /**\n   * Flip the SVG paths in RTL.\n   */\n  flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n  }\n\n  /**\n   * Add the cursor SVG to this block's SVG group.\n   *\n   * @param cursorSvg The SVG root of the cursor to be added to the block SVG\n   *     group.\n   */\n  setCursorSvg(cursorSvg: SVGElement) {\n    if (!cursorSvg) {\n      this.cursorSvg = null;\n      return;\n    }\n\n    this.svgRoot.appendChild(cursorSvg);\n    this.cursorSvg = cursorSvg;\n  }\n\n  /**\n   * Add the marker SVG to this block's SVG group.\n   *\n   * @param markerSvg The SVG root of the marker to be added to the block SVG\n   *     group.\n   */\n  setMarkerSvg(markerSvg: SVGElement) {\n    if (!markerSvg) {\n      this.markerSvg = null;\n      return;\n    }\n\n    if (this.cursorSvg) {\n      this.svgRoot.insertBefore(markerSvg, this.cursorSvg);\n    } else {\n      this.svgRoot.appendChild(markerSvg);\n    }\n    this.markerSvg = markerSvg;\n  }\n\n  /**\n   * Apply the stored colours to the block's path, taking into account whether\n   * the paths belong to a shadow block.\n   *\n   * @param block The source block.\n   */\n  applyColour(block: BlockSvg) {\n    this.svgPath.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPath.setAttribute('fill', this.style.colourPrimary);\n\n    this.updateShadow_(block.isShadow());\n    this.updateDisabled_(!block.isEnabled() || block.getInheritedDisabled());\n  }\n\n  /**\n   * Set the style.\n   *\n   * @param blockStyle The block style to use.\n   */\n  setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n  }\n\n  /**\n   * Add or remove the given CSS class on the path object's root SVG element.\n   *\n   * @param className The name of the class to add or remove\n   * @param add True if the class should be added.  False if it should be\n   *     removed.\n   */\n  protected setClass_(className: string, add: boolean) {\n    if (!className) {\n      return;\n    }\n    if (add) {\n      dom.addClass(this.svgRoot, className);\n    } else {\n      dom.removeClass(this.svgRoot, className);\n    }\n  }\n\n  /**\n   * Set whether the block shows a highlight or not.  Block highlighting is\n   * often used to visually mark blocks currently being executed.\n   *\n   * @param enable True if highlighted.\n   */\n  updateHighlighted(enable: boolean) {\n    if (enable) {\n      this.svgPath.setAttribute(\n          'filter', 'url(#' + this.constants.embossFilterId + ')');\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a shadow state.\n   *\n   * @param shadow True if the block is a shadow block.\n   */\n  protected updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  /**\n   * Updates the look of the block to reflect a disabled state.\n   *\n   * @param disabled True if disabled.\n   */\n  protected updateDisabled_(disabled: boolean) {\n    this.setClass_('blocklyDisabled', disabled);\n    if (disabled) {\n      this.svgPath.setAttribute(\n          'fill', 'url(#' + this.constants.disabledPatternId + ')');\n    }\n  }\n\n  /**\n   * Add or remove styling showing that a block is selected.\n   *\n   * @param enable True if selection is enabled, false otherwise.\n   */\n  updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is dragged over a delete area.\n   *\n   * @param enable True if the block is being dragged over a delete area, false\n   *     otherwise.\n   */\n  updateDraggingDelete(enable: boolean) {\n    this.setClass_('blocklyDraggingDelete', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is an insertion marker.\n   *\n   * @param enable True if the block is an insertion marker, false otherwise.\n   */\n  updateInsertionMarker(enable: boolean) {\n    this.setClass_('blocklyInsertionMarker', enable);\n  }\n\n  /**\n   * Add or remove styling showing that a block is movable.\n   *\n   * @param enable True if the block is movable, false otherwise.\n   */\n  updateMovable(enable: boolean) {\n    this.setClass_('blocklyDraggable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be replaced.  If a shadow block, it will disappear.\n   * Otherwise it will bump.\n   *\n   * @param enable True if styling should be added.\n   */\n  updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n  }\n\n  /**\n   * Add or remove styling that shows that if the dragging block is dropped,\n   * this block will be connected to the input.\n   *\n   * @param _conn The connection on the input to highlight.\n   * @param _enable True if styling should be added.\n   */\n  updateShapeForInputHighlight(_conn: Connection, _enable: boolean) {\n    // NOOP\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.blockRendering.Renderer');\n\nimport type {Block} from '../../block.js';\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager, PreviewType} from '../../insertion_marker_manager.js';\nimport type {IRegistrable} from '../../interfaces/i_registrable.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\n\nimport {ConstantProvider} from './constants.js';\nimport * as debug from './debug.js';\nimport {Debug} from './debugger.js';\nimport {Drawer} from './drawer.js';\nimport type {IPathObject} from './i_path_object.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n\n/**\n * The base class for a block renderer.\n */\nexport class Renderer implements IRegistrable {\n  /** The renderer's constant provider. */\n  protected constants_!: ConstantProvider;\n\n  protected name: string;\n\n  /**\n   * Rendering constant overrides, passed in through options.\n   */\n  protected overrides: object|null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    this.name = name;\n  }\n\n  /**\n   * Gets the class name that identifies this renderer.\n   *\n   * @returns The CSS class name.\n   */\n  getClassName(): string {\n    return this.name + '-renderer';\n  }\n\n  /**\n   * Initialize the renderer.\n   *\n   * @param theme The workspace theme object.\n   * @param opt_rendererOverrides Rendering constant overrides.\n   */\n  init(\n      theme: Theme, opt_rendererOverrides?: {[rendererConstant: string]: any}) {\n    this.constants_ = this.makeConstants_();\n    if (opt_rendererOverrides) {\n      this.overrides = opt_rendererOverrides;\n      Object.assign(this.constants_, opt_rendererOverrides);\n    }\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n  }\n\n  /**\n   * Create any DOM elements that this renderer needs.\n   * If you need to create additional DOM elements, override the\n   * {@link ConstantProvider#createDom} method instead.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   * @internal\n   */\n  createDom(svg: SVGElement, theme: Theme) {\n    this.constants_.createDom(\n        svg, this.name + '-' + theme.name,\n        '.' + this.getClassName() + '.' + theme.getClassName());\n  }\n\n  /**\n   * Refresh the renderer after a theme change.\n   *\n   * @param svg The root of the workspace's SVG.\n   * @param theme The workspace theme object.\n   */\n  refreshDom(svg: SVGElement, theme: Theme) {\n    const previousConstants = this.getConstants();\n    previousConstants.dispose();\n    this.constants_ = this.makeConstants_();\n    if (this.overrides) {\n      Object.assign(this.constants_, this.overrides);\n    }\n    // Ensure the constant provider's random identifier does not change.\n    this.constants_.randomIdentifier = previousConstants.randomIdentifier;\n    this.constants_.setTheme(theme);\n    this.constants_.init();\n    this.createDom(svg, theme);\n  }\n\n  /**\n   * Dispose of this renderer.\n   * Delete all DOM elements that this renderer and its constants created.\n   */\n  dispose() {\n    if (this.constants_) {\n      this.constants_.dispose();\n    }\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected makeDrawer_(block: BlockSvg, info: RenderInfo): Drawer {\n    return new Drawer(block, info);\n  }\n\n  /**\n   * Create a new instance of the renderer's debugger.\n   *\n   * @returns The renderer debugger.\n   * @suppress {strictModuleDepCheck} Debug renderer only included in\n   * playground.\n   */\n  protected makeDebugger_(): Debug {\n    return new Debug(this.getConstants());\n  }\n\n  /**\n   * Create a new instance of the renderer's marker drawer.\n   *\n   * @param workspace The workspace the marker belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker): MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  makePathObject(root: SVGElement, style: BlockStyle): IPathObject {\n    return new PathObject(root, style, (this.constants_));\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  /**\n   * Determine whether or not to highlight a connection.\n   *\n   * @param _conn The connection to determine whether or not to highlight.\n   * @returns True if we should highlight the connection.\n   */\n  shouldHighlightConnection(_conn: Connection): boolean {\n    return true;\n  }\n\n  /**\n   * Checks if an orphaned block can connect to the \"end\" of the topBlock's\n   * block-clump. If the clump is a row the end is the last input. If the clump\n   * is a stack, the end is the last next connection. If the clump is neither,\n   * then this returns false.\n   *\n   * @param topBlock The top block of the block clump we want to try and connect\n   *     to.\n   * @param orphanBlock The orphan block that wants to find a home.\n   * @param localType The type of the connection being dragged.\n   * @returns Whether there is a home for the orphan or not.\n   */\n  protected orphanCanConnectAtEnd(\n      topBlock: BlockSvg, orphanBlock: BlockSvg, localType: number): boolean {\n    const orphanConnection = localType === ConnectionType.OUTPUT_VALUE ?\n        orphanBlock.outputConnection :\n        orphanBlock.previousConnection;\n    return !!Connection.getConnectionForOrphanedConnection(\n        topBlock as Block, orphanConnection as Connection);\n  }\n\n  /**\n   * Chooses a connection preview method based on the available connection, the\n   * current dragged connection, and the block being dragged.\n   *\n   * @param closest The available connection.\n   * @param local The connection currently being dragged.\n   * @param topBlock The block currently being dragged.\n   * @returns The preview type to display.\n   */\n  getConnectionPreviewMethod(\n      closest: RenderedConnection, local: RenderedConnection,\n      topBlock: BlockSvg): PreviewType {\n    if (local.type === ConnectionType.OUTPUT_VALUE ||\n        local.type === ConnectionType.PREVIOUS_STATEMENT) {\n      if (!closest.isConnected() ||\n          this.orphanCanConnectAtEnd(\n              topBlock, closest.targetBlock() as BlockSvg, local.type)) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n      }\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return InsertionMarkerManager.PREVIEW_TYPE.INSERTION_MARKER;\n  }\n\n  /**\n   * Render the block.\n   *\n   * @param block The block to render.\n   * @internal\n   */\n  render(block: BlockSvg) {\n    if (debug.isDebuggerEnabled() && !block.renderingDebugger) {\n      block.renderingDebugger = this.makeDebugger_();\n    }\n    const info = this.makeRenderInfo_(block);\n    info.measure();\n    this.makeDrawer_(block, info).draw();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of storing and updating a workspace theme\n *     and UI components.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ThemeManager');\n\nimport type {Theme} from './theme.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as dom from './utils/dom.js';\nimport type {Workspace} from './workspace.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for storing and updating a workspace's theme and UI components.\n */\nexport class ThemeManager {\n  /** A list of workspaces that are subscribed to this theme. */\n  private subscribedWorkspaces_: Workspace[] = [];\n  private componentDB = new Map<string, Component[]>();\n\n  /**\n   * @param workspace The main workspace.\n   * @param theme The workspace theme.\n   * @internal\n   */\n  constructor(private readonly workspace: WorkspaceSvg, private theme: Theme) {}\n\n  /**\n   * Get the workspace theme.\n   *\n   * @returns The workspace theme.\n   * @internal\n   */\n  getTheme(): Theme {\n    return this.theme;\n  }\n\n  /**\n   * Set the workspace theme, and refresh the workspace and all components.\n   *\n   * @param theme The workspace theme.\n   * @internal\n   */\n  setTheme(theme: Theme) {\n    const prevTheme = this.theme;\n    this.theme = theme;\n    // Set the theme name onto the injection div.\n    const injectionDiv = this.workspace.getInjectionDiv();\n    if (injectionDiv) {\n      if (prevTheme) {\n        const oldClassName = prevTheme.getClassName();\n        if (oldClassName) {\n          dom.removeClass(injectionDiv, oldClassName);\n        }\n      }\n      const newClassName = this.theme.getClassName();\n      if (newClassName) {\n        dom.addClass(injectionDiv, newClassName);\n      }\n    }\n\n    // Refresh all subscribed workspaces.\n    for (let i = 0, workspace; workspace = this.subscribedWorkspaces_[i]; i++) {\n      (workspace as WorkspaceSvg).refreshTheme();\n    }\n\n    // Refresh all registered Blockly UI components.\n    for (const [key, componentList] of this.componentDB) {\n      for (const component of componentList) {\n        const element = component.element;\n        const propertyName = component.propertyName;\n        const style = this.theme && this.theme.getComponentStyle(key);\n        element.style.setProperty(propertyName, style || '');\n      }\n    }\n\n    for (const workspace of this.subscribedWorkspaces_) {\n      (workspace as WorkspaceSvg).hideChaff();\n    }\n  }\n\n  /**\n   * Subscribe a workspace to changes to the selected theme.  If a new theme is\n   * set, the workspace is called to refresh its blocks.\n   *\n   * @param workspace The workspace to subscribe.\n   * @internal\n   */\n  subscribeWorkspace(workspace: Workspace) {\n    this.subscribedWorkspaces_.push(workspace);\n  }\n\n  /**\n   * Unsubscribe a workspace to changes to the selected theme.\n   *\n   * @param workspace The workspace to unsubscribe.\n   * @internal\n   */\n  unsubscribeWorkspace(workspace: Workspace) {\n    if (!arrayUtils.removeElem(this.subscribedWorkspaces_, workspace)) {\n      throw Error(\n          'Cannot unsubscribe a workspace that hasn\\'t been subscribed.');\n    }\n  }\n\n  /**\n   * Subscribe an element to changes to the selected theme.  If a new theme is\n   * selected, the element's style is refreshed with the new theme's style.\n   *\n   * @param element The element to subscribe.\n   * @param componentName The name used to identify the component. This must be\n   *     the same name used to configure the style in the Theme object.\n   * @param propertyName The inline style property name to update.\n   * @internal\n   */\n  subscribe(\n      element: HTMLElement|SVGElement, componentName: string,\n      propertyName: string) {\n    if (!this.componentDB.has(componentName)) {\n      this.componentDB.set(componentName, []);\n    }\n\n    // Add the element to our component map.\n    this.componentDB.get(componentName)!.push({element, propertyName});\n\n    // Initialize the element with its corresponding theme style.\n    const style = this.theme && this.theme.getComponentStyle(componentName);\n    element.style.setProperty(propertyName, style || '');\n  }\n\n  /**\n   * Unsubscribe an element to changes to the selected theme.\n   *\n   * @param element The element to unsubscribe.\n   * @internal\n   */\n  unsubscribe(element: HTMLElement|SVGElement) {\n    if (!element) {\n      return;\n    }\n    // Go through all component, and remove any references to this element.\n    for (const [componentName, elements] of this.componentDB) {\n      for (let i = elements.length - 1; i >= 0; i--) {\n        if (elements[i].element === element) {\n          elements.splice(i, 1);\n        }\n      }\n      // Clean up the component map entry if the list is empty.\n      if (!elements.length) {\n        this.componentDB.delete(componentName);\n      }\n    }\n  }\n\n  /**\n   * Dispose of this theme manager.\n   *\n   * @suppress {checkTypes}\n   * @internal\n   */\n  dispose() {\n    this.subscribedWorkspaces_.length = 0;\n    this.componentDB.clear();\n  }\n}\n\nexport namespace ThemeManager {\n  /** The type for a Blockly UI Component. */\n  export interface Component {\n    element: HTMLElement|SVGElement;\n    propertyName: string;\n  }\n}\n\nexport type Component = ThemeManager.Component;\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a map of variables and their types.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VariableMap');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_delete.js';\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_var_rename.js';\n\nimport type {Block} from './block.js';\nimport * as dialog from './dialog.js';\nimport * as eventUtils from './events/utils.js';\nimport {Msg} from './msg.js';\nimport {Names} from './names.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {VariableModel} from './variable_model.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a variable map.  This contains a dictionary data structure with\n * variable types as keys and lists of variables as values.  The list of\n * variables are the type indicated by the key.\n */\nexport class VariableMap {\n  /**\n   * A map from variable type to list of variable names.  The lists contain\n   * all of the named variables in the workspace, including variables that are\n   * not currently in use.\n   */\n  private variableMap = new Map<string, VariableModel[]>();\n\n  /** @param workspace The workspace this map belongs to. */\n  constructor(public workspace: Workspace) {}\n\n  /** Clear the variable map.  Fires events for every deletion. */\n  clear() {\n    for (const variables of this.variableMap.values()) {\n      while (variables.length > 0) {\n        this.deleteVariable(variables[0]);\n      }\n    }\n    if (this.variableMap.size !== 0) {\n      throw Error('Non-empty variable map');\n    }\n  }\n\n  /* Begin functions for renaming variables. */\n  /**\n   * Rename the given variable by updating its name in the variable map.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @internal\n   */\n  renameVariable(variable: VariableModel, newName: string) {\n    if (variable.name === newName) return;\n    const type = variable.type;\n    const conflictVar = this.getVariable(newName, type);\n    const blocks = this.workspace.getAllBlocks(false);\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      // The IDs may match if the rename is a simple case change (name1 ->\n      // Name1).\n      if (!conflictVar || conflictVar.getId() === variable.getId()) {\n        this.renameVariableAndUses_(variable, newName, blocks);\n      } else {\n        this.renameVariableWithConflict_(\n            variable, newName, conflictVar, blocks);\n      }\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    const variable = this.getVariableById(id);\n    if (!variable) {\n      throw Error('Tried to rename a variable that didn\\'t exist. ID: ' + id);\n    }\n\n    this.renameVariable(variable, newName);\n  }\n\n  /**\n   * Update the name of the given variable and refresh all references to it.\n   * The new name must not conflict with any existing variable names.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableAndUses_(\n      variable: VariableModel, newName: string, blocks: Block[]) {\n    eventUtils.fire(\n        new (eventUtils.get(eventUtils.VAR_RENAME))(variable, newName));\n    variable.name = newName;\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].updateVarName(variable);\n    }\n  }\n\n  /**\n   * Update the name of the given variable to the same name as an existing\n   * variable.  The two variables are coalesced into a single variable with the\n   * ID of the existing variable that was already using newName. Refresh all\n   * references to the variable.\n   *\n   * @param variable Variable to rename.\n   * @param newName New variable name.\n   * @param conflictVar The variable that was already using newName.\n   * @param blocks The list of all blocks in the workspace.\n   */\n  private renameVariableWithConflict_(\n      variable: VariableModel, newName: string, conflictVar: VariableModel,\n      blocks: Block[]) {\n    const type = variable.type;\n    const oldCase = conflictVar.name;\n\n    if (newName !== oldCase) {\n      // Simple rename to change the case and update references.\n      this.renameVariableAndUses_(conflictVar, newName, blocks);\n    }\n\n    // These blocks now refer to a different variable.\n    // These will fire change events.\n    for (let i = 0; i < blocks.length; i++) {\n      blocks[i].renameVarById(variable.getId(), conflictVar.getId());\n    }\n    // Finally delete the original variable, which is now unreferenced.\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\n    // And remove it from the list.\n    arrayUtils.removeElem(this.variableMap.get(type)!, variable);\n  }\n\n  /* End functions for renaming variables. */\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(name: string, opt_type?: string|null, opt_id?: string|null):\n      VariableModel {\n    let variable = this.getVariable(name, opt_type);\n    if (variable) {\n      if (opt_id && variable.getId() !== opt_id) {\n        throw Error(\n            'Variable \"' + name + '\" is already in use and its id is \"' +\n            variable.getId() + '\" which conflicts with the passed in ' +\n            'id, \"' + opt_id + '\".');\n      }\n      // The variable already exists and has the same ID.\n      return variable;\n    }\n    if (opt_id && this.getVariableById(opt_id)) {\n      throw Error('Variable id, \"' + opt_id + '\", is already in use.');\n    }\n    const id = opt_id || idGenerator.genUid();\n    const type = opt_type || '';\n    variable = new VariableModel(this.workspace, name, type, id);\n\n    const variables = this.variableMap.get(type) || [];\n    variables.push(variable);\n    // Delete the list of variables of this type, and re-add it so that\n    // the most recent addition is at the end.\n    // This is used so the toolbox's set block is set to the most recent\n    // variable.\n    this.variableMap.delete(type);\n    this.variableMap.set(type, variables);\n\n    eventUtils.fire(new (eventUtils.get(eventUtils.VAR_CREATE))(variable));\n\n    return variable;\n  }\n\n  /* Begin functions for variable deletion. */\n  /**\n   * Delete a variable.\n   *\n   * @param variable Variable to delete.\n   */\n  deleteVariable(variable: VariableModel) {\n    const variableId = variable.getId();\n    const variableList = this.variableMap.get(variable.type);\n    if (variableList) {\n      for (let i = 0; i < variableList.length; i++) {\n        const tempVar = variableList[i];\n        if (tempVar.getId() === variableId) {\n          variableList.splice(i, 1);\n          eventUtils.fire(\n              new (eventUtils.get(eventUtils.VAR_DELETE))(variable));\n          if (variableList.length === 0) {\n            this.variableMap.delete(variable.type);\n          }\n          return;\n        }\n      }\n    }\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    const variable = this.getVariableById(id);\n    if (variable) {\n      // Check whether this variable is a function parameter before deleting.\n      const variableName = variable.name;\n      const uses = this.getVariableUsesById(id);\n      for (let i = 0, block; block = uses[i]; i++) {\n        if (block.type === 'procedures_defnoreturn' ||\n            block.type === 'procedures_defreturn') {\n          const procedureName = String(block.getFieldValue('NAME'));\n          const deleteText = Msg['CANNOT_DELETE_VARIABLE_PROCEDURE']\n                                 .replace('%1', variableName)\n                                 .replace('%2', procedureName);\n          dialog.alert(deleteText);\n          return;\n        }\n      }\n\n      if (uses.length > 1) {\n        // Confirm before deleting multiple blocks.\n        const confirmText = Msg['DELETE_VARIABLE_CONFIRMATION']\n                                .replace('%1', String(uses.length))\n                                .replace('%2', variableName);\n        dialog.confirm(confirmText, (ok) => {\n          if (ok && variable) {\n            this.deleteVariableInternal(variable, uses);\n          }\n        });\n      } else {\n        // No confirmation necessary for a single block.\n        this.deleteVariableInternal(variable, uses);\n      }\n    } else {\n      console.warn('Can\\'t delete non-existent variable: ' + id);\n    }\n  }\n\n  /**\n   * Deletes a variable and all of its uses from this workspace without asking\n   * the user for confirmation.\n   *\n   * @param variable Variable to delete.\n   * @param uses An array of uses of the variable.\n   * @internal\n   */\n  deleteVariableInternal(variable: VariableModel, uses: Block[]) {\n    const existingGroup = eventUtils.getGroup();\n    if (!existingGroup) {\n      eventUtils.setGroup(true);\n    }\n    try {\n      for (let i = 0; i < uses.length; i++) {\n        uses[i].dispose(true);\n      }\n      this.deleteVariable(variable);\n    } finally {\n      eventUtils.setGroup(existingGroup);\n    }\n  }\n  /* End functions for variable deletion. */\n  /**\n   * Find the variable by the given name and type and return it.  Return null if\n   *     it is not found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name, or null if it was not found.\n   */\n  getVariable(name: string, opt_type?: string|null): VariableModel|null {\n    const type = opt_type || '';\n    const list = this.variableMap.get(type);\n    if (list) {\n      for (let j = 0, variable; variable = list[j]; j++) {\n        if (Names.equals(variable.name, name)) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Find the variable by the given ID and return it.  Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel|null {\n    for (const variables of this.variableMap.values()) {\n      for (const variable of variables) {\n        if (variable.getId() === id) {\n          return variable;\n        }\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Get a list containing all of the variables of a specified type. If type is\n   *     null, return list of variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string|null): VariableModel[] {\n    type = type || '';\n    const variableList = this.variableMap.get(type);\n    if (variableList) {\n      return variableList.slice();\n    }\n    return [];\n  }\n\n  /**\n   * Return all variable and potential variable types.  This list always\n   * contains the empty string.\n   *\n   * @param ws The workspace used to look for potential variables. This can be\n   *     different than the workspace stored on this object if the passed in ws\n   *     is a flyout workspace.\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(ws: Workspace|null): string[] {\n    const variableTypes = new Set<string>(this.variableMap.keys());\n    if (ws && ws.getPotentialVariableMap()) {\n      for (const key of ws.getPotentialVariableMap()!.variableMap.keys()) {\n        variableTypes.add(key);\n      }\n    }\n    if (!variableTypes.has('')) {\n      variableTypes.add('');\n    }\n    return Array.from(variableTypes.values());\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    let allVariables: VariableModel[] = [];\n    for (const variables of this.variableMap.values()) {\n      allVariables = allVariables.concat(variables);\n    }\n    return allVariables;\n  }\n\n  /**\n   * Returns all of the variable names of all types.\n   *\n   * @returns All of the variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return Array.from(this.variableMap.values())\n        .flat()\n        .map((variable) => variable.name);\n  }\n\n  /**\n   * Find all the uses of a named variable.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    const uses = [];\n    const blocks = this.workspace.getAllBlocks(false);\n    // Iterate through every block and check the name.\n    for (let i = 0; i < blocks.length; i++) {\n      const blockVariables = blocks[i].getVarModels();\n      if (blockVariables) {\n        for (let j = 0; j < blockVariables.length; j++) {\n          if (blockVariables[j].getId() === id) {\n            uses.push(blocks[i]);\n          }\n        }\n      }\n    }\n    return uses;\n  }\n}\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Workspace');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './connection_checker.js';\n\nimport type {Block} from './block.js';\nimport type {BlocklyOptions} from './blockly_options.js';\nimport type {ConnectionDB} from './connection_db.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport * as common from './common.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IASTNodeLocation} from './interfaces/i_ast_node_location.js';\nimport type {IConnectionChecker} from './interfaces/i_connection_checker.js';\nimport {Options} from './options.js';\nimport * as registry from './registry.js';\nimport * as arrayUtils from './utils/array.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport * as math from './utils/math.js';\nimport type * as toolbox from './utils/toolbox.js';\nimport {VariableMap} from './variable_map.js';\nimport type {VariableModel} from './variable_model.js';\nimport type {WorkspaceComment} from './workspace_comment.js';\nimport {IProcedureMap} from './interfaces/i_procedure_map.js';\nimport {ObservableProcedureMap} from './observable_procedure_map.js';\n\n\n/**\n * Class for a workspace.  This is a data structure that contains blocks.\n * There is no UI, and can be created headlessly.\n */\nexport class Workspace implements IASTNodeLocation {\n  /**\n   * Angle away from the horizontal to sweep for blocks.  Order of execution is\n   * generally top to bottom, but a small angle changes the scan to give a bit\n   * of a left to right bias (reversed in RTL).  Units are in degrees. See:\n   * https://tvtropes.org/pmwiki/pmwiki.php/Main/DiagonalBilling\n   */\n  static SCAN_ANGLE = 3;\n  id: string;\n  options: Options;\n  RTL: boolean;\n  horizontalLayout: boolean;\n  toolboxPosition: toolbox.Position;\n\n  /**\n   * Returns `true` if the workspace is visible and `false` if it's headless.\n   */\n  rendered = false;\n\n  /**\n   * Is this workspace the surface for a flyout?\n   *\n   * @internal\n   */\n  internalIsFlyout = false;\n\n  /** Is this workspace the surface for a flyout? */\n  get isFlyout(): boolean {\n    return this.internalIsFlyout;\n  }\n\n  /**\n   * Is this workspace the surface for a mutator?\n   *\n   * @internal\n   */\n  internalIsMutator = false;\n\n  /** Is this workspace the surface for a mutator? */\n  get isMutator(): boolean {\n    return this.internalIsMutator;\n  }\n\n  /**\n   * Returns `true` if the workspace is currently in the process of a bulk\n   * clear.\n   *\n   * @internal\n   */\n  isClearing = false;\n\n  /**\n   * Maximum number of undo events in stack. `0` turns off undo, `Infinity`\n   * sets it to unlimited.\n   */\n  MAX_UNDO = 1024;\n\n  /** Set of databases for rapid lookup of connection locations. */\n  connectionDBList: ConnectionDB[] = [];\n  connectionChecker: IConnectionChecker;\n\n  private readonly topBlocks: Block[] = [];\n  private readonly topComments: WorkspaceComment[] = [];\n  private readonly commentDB = new Map<string, WorkspaceComment>();\n  private readonly listeners: Function[] = [];\n  protected undoStack_: Abstract[] = [];\n  protected redoStack_: Abstract[] = [];\n  private readonly blockDB = new Map<string, Block>();\n  private readonly typedBlocksDB = new Map<string, Block[]>();\n  private variableMap: VariableMap;\n  private procedureMap: IProcedureMap = new ObservableProcedureMap();\n\n  /**\n   * Blocks in the flyout can refer to variables that don't exist in the main\n   * workspace.  For instance, the \"get item in list\" block refers to an\n   * \"item\" variable regardless of whether the variable has been created yet.\n   * A FieldVariable must always refer to a VariableModel.  We reconcile\n   * these by tracking \"potential\" variables in the flyout.  These variables\n   * become real when references to them are dragged into the main workspace.\n   */\n  private potentialVariableMap: VariableMap|null = null;\n\n  /** @param opt_options Dictionary of options. */\n  constructor(opt_options?: Options) {\n    this.id = idGenerator.genUid();\n    common.registerWorkspace(this);\n    this.options = opt_options || new Options(({} as BlocklyOptions));\n    this.RTL = !!this.options.RTL;\n    this.horizontalLayout = !!this.options.horizontalLayout;\n    this.toolboxPosition = this.options.toolboxPosition;\n\n    const connectionCheckerClass = registry.getClassFromOptions(\n        registry.Type.CONNECTION_CHECKER, this.options, true);\n    /**\n     * An object that encapsulates logic for safety, type, and dragging checks.\n     */\n    this.connectionChecker = new connectionCheckerClass!(this);\n\n    /**\n     * A map from variable type to list of variable names.  The lists contain\n     * all of the named variables in the workspace, including variables that are\n     * not currently in use.\n     */\n    this.variableMap = new VariableMap(this);\n  }\n\n  /**\n   * Dispose of this workspace.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.listeners.length = 0;\n    this.clear();\n    // Remove from workspace database.\n    common.unregisterWorkpace(this);\n  }\n\n  /**\n   * Compare function for sorting objects (blocks, comments, etc) by position;\n   *    top to bottom (with slight LTR or RTL bias).\n   *\n   * @param a The first object to compare.\n   * @param b The second object to compare.\n   * @returns The comparison value. This tells Array.sort() how to change object\n   *     a's index.\n   */\n  private sortObjects_(a: Block|WorkspaceComment, b: Block|WorkspaceComment):\n      number {\n    const offset =\n        Math.sin(math.toRadians(Workspace.SCAN_ANGLE)) * (this.RTL ? -1 : 1);\n    const aXY = a.getRelativeToSurfaceXY();\n    const bXY = b.getRelativeToSurfaceXY();\n    return aXY.y + offset * aXY.x - (bXY.y + offset * bXY.x);\n  }\n\n  /**\n   * Adds a block to the list of top blocks.\n   *\n   * @param block Block to add.\n   */\n  addTopBlock(block: Block) {\n    this.topBlocks.push(block);\n  }\n\n  /**\n   * Removes a block from the list of top blocks.\n   *\n   * @param block Block to remove.\n   */\n  removeTopBlock(block: Block) {\n    if (!arrayUtils.removeElem(this.topBlocks, block)) {\n      throw Error('Block not present in workspace\\'s list of top-most blocks.');\n    }\n  }\n\n  /**\n   * Finds the top-level blocks and returns them.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level block objects.\n   */\n  getTopBlocks(ordered: boolean): Block[] {\n    // Copy the topBlocks list.\n    const blocks = (new Array<Block>()).concat(this.topBlocks);\n    if (ordered && blocks.length > 1) {\n      blocks.sort(this.sortObjects_.bind(this));\n    }\n    return blocks;\n  }\n\n  /**\n   * Add a block to the list of blocks keyed by type.\n   *\n   * @param block Block to add.\n   */\n  addTypedBlock(block: Block) {\n    if (!this.typedBlocksDB.has(block.type)) {\n      this.typedBlocksDB.set(block.type, []);\n    }\n    this.typedBlocksDB.get(block.type)!.push(block);\n  }\n\n  /**\n   * Remove a block from the list of blocks keyed by type.\n   *\n   * @param block Block to remove.\n   */\n  removeTypedBlock(block: Block) {\n    arrayUtils.removeElem(this.typedBlocksDB.get(block.type)!, block);\n    if (!this.typedBlocksDB.get(block.type)!.length) {\n      this.typedBlocksDB.delete(block.type);\n    }\n  }\n\n  /**\n   * Finds the blocks with the associated type and returns them. Blocks are\n   * optionally sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param type The type of block to search for.\n   * @param ordered Sort the list if true.\n   * @returns The blocks of the given type.\n   */\n  getBlocksByType(type: string, ordered: boolean): Block[] {\n    if (!this.typedBlocksDB.has(type)) {\n      return [];\n    }\n    const blocks = this.typedBlocksDB.get(type)!.slice(0);\n    if (ordered && blocks && blocks.length > 1) {\n      blocks.sort(this.sortObjects_.bind(this));\n    }\n\n    return blocks.filter(function(block: Block) {\n      return !block.isInsertionMarker();\n    });\n  }\n\n  /**\n   * Adds a comment to the list of top comments.\n   *\n   * @param comment comment to add.\n   * @internal\n   */\n  addTopComment(comment: WorkspaceComment) {\n    this.topComments.push(comment);\n\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    if (this.commentDB.has(comment.id)) {\n      console.warn(\n          'Overriding an existing comment on this workspace, with id \"' +\n          comment.id + '\"');\n    }\n    this.commentDB.set(comment.id, comment);\n  }\n\n  /**\n   * Removes a comment from the list of top comments.\n   *\n   * @param comment comment to remove.\n   * @internal\n   */\n  removeTopComment(comment: WorkspaceComment) {\n    if (!arrayUtils.removeElem(this.topComments, comment)) {\n      throw Error(\n          'Comment not present in workspace\\'s list of top-most ' +\n          'comments.');\n    }\n    // Note: If the comment database starts to hold block comments, this may\n    // need to move to a separate function.\n    this.commentDB.delete(comment.id);\n  }\n\n  /**\n   * Finds the top-level comments and returns them.  Comments are optionally\n   * sorted by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns The top-level comment objects.\n   * @internal\n   */\n  getTopComments(ordered: boolean): WorkspaceComment[] {\n    // Copy the topComments list.\n    const comments = (new Array<WorkspaceComment>()).concat(this.topComments);\n    if (ordered && comments.length > 1) {\n      comments.sort(this.sortObjects_.bind(this));\n    }\n    return comments;\n  }\n\n  /**\n   * Find all blocks in workspace.  Blocks are optionally sorted\n   * by position; top to bottom (with slight LTR or RTL bias).\n   *\n   * @param ordered Sort the list if true.\n   * @returns Array of blocks.\n   */\n  getAllBlocks(ordered: boolean): Block[] {\n    let blocks: Block[];\n    if (ordered) {\n      // Slow, but ordered.\n      const topBlocks = this.getTopBlocks(true);\n      blocks = [];\n      for (let i = 0; i < topBlocks.length; i++) {\n        blocks.push(...topBlocks[i].getDescendants(true));\n      }\n    } else {\n      // Fast, but in no particular order.\n      blocks = this.getTopBlocks(false);\n      for (let i = 0; i < blocks.length; i++) {\n        blocks.push(...blocks[i].getChildren(false));\n      }\n    }\n\n    // Insertion markers exist on the workspace for rendering reasons, but\n    // aren't \"real\" blocks from a developer perspective.\n    const filtered = blocks.filter(function(block) {\n      return !block.isInsertionMarker();\n    });\n\n    return filtered;\n  }\n\n  /** Dispose of all blocks and comments in workspace. */\n  clear() {\n    this.isClearing = true;\n    try {\n      const existingGroup = eventUtils.getGroup();\n      if (!existingGroup) {\n        eventUtils.setGroup(true);\n      }\n      while (this.topBlocks.length) {\n        this.topBlocks[0].dispose(false);\n      }\n      while (this.topComments.length) {\n        this.topComments[this.topComments.length - 1].dispose();\n      }\n      eventUtils.setGroup(existingGroup);\n      this.variableMap.clear();\n      if (this.potentialVariableMap) {\n        this.potentialVariableMap.clear();\n      }\n    } finally {\n      this.isClearing = false;\n    }\n  }\n\n  /* Begin functions that are just pass-throughs to the variable map. */\n  /**\n   * Rename a variable by updating its name in the variable map. Identify the\n   * variable to rename with the given ID.\n   *\n   * @param id ID of the variable to rename.\n   * @param newName New variable name.\n   */\n  renameVariableById(id: string, newName: string) {\n    this.variableMap.renameVariableById(id, newName);\n  }\n\n  /**\n   * Create a variable with a given name, optional type, and optional ID.\n   *\n   * @param name The name of the variable. This must be unique across variables\n   *     and procedures.\n   * @param opt_type The type of the variable like 'int' or 'string'.\n   *     Does not need to be unique. Field_variable can filter variables based\n   * on their type. This will default to '' which is a specific type.\n   * @param opt_id The unique ID of the variable. This will default to a UUID.\n   * @returns The newly created variable.\n   */\n  createVariable(name: string, opt_type?: string|null, opt_id?: string|null):\n      VariableModel {\n    return this.variableMap.createVariable(name, opt_type, opt_id);\n  }\n\n  /**\n   * Find all the uses of the given variable, which is identified by ID.\n   *\n   * @param id ID of the variable to find.\n   * @returns Array of block usages.\n   */\n  getVariableUsesById(id: string): Block[] {\n    return this.variableMap.getVariableUsesById(id);\n  }\n\n  /**\n   * Delete a variables by the passed in ID and all of its uses from this\n   * workspace. May prompt the user for confirmation.\n   *\n   * @param id ID of variable to delete.\n   */\n  deleteVariableById(id: string) {\n    this.variableMap.deleteVariableById(id);\n  }\n\n  /**\n   * Find the variable by the given name and return it. Return null if not\n   * found.\n   *\n   * @param name The name to check for.\n   * @param opt_type The type of the variable.  If not provided it defaults to\n   *     the empty string, which is a specific type.\n   * @returns The variable with the given name.\n   */\n  getVariable(name: string, opt_type?: string): VariableModel|null {\n    // TODO (#1559): Possibly delete this function after resolving #1559.\n    return this.variableMap.getVariable(name, opt_type);\n  }\n\n  /**\n   * Find the variable by the given ID and return it. Return null if not found.\n   *\n   * @param id The ID to check for.\n   * @returns The variable with the given ID.\n   */\n  getVariableById(id: string): VariableModel|null {\n    return this.variableMap.getVariableById(id);\n  }\n\n  /**\n   * Find the variable with the specified type. If type is null, return list of\n   *     variables with empty string type.\n   *\n   * @param type Type of the variables to find.\n   * @returns The sought after variables of the passed in type. An empty array\n   *     if none are found.\n   */\n  getVariablesOfType(type: string|null): VariableModel[] {\n    return this.variableMap.getVariablesOfType(type);\n  }\n\n  /**\n   * Return all variable types.\n   *\n   * @returns List of variable types.\n   * @internal\n   */\n  getVariableTypes(): string[] {\n    return this.variableMap.getVariableTypes(this);\n  }\n\n  /**\n   * Return all variables of all types.\n   *\n   * @returns List of variable models.\n   */\n  getAllVariables(): VariableModel[] {\n    return this.variableMap.getAllVariables();\n  }\n\n  /**\n   * Returns all variable names of all types.\n   *\n   * @returns List of all variable names of all types.\n   */\n  getAllVariableNames(): string[] {\n    return this.variableMap.getAllVariableNames();\n  }\n  /* End functions that are just pass-throughs to the variable map. */\n  /**\n   * Returns the horizontal offset of the workspace.\n   * Intended for LTR/RTL compatibility in XML.\n   * Not relevant for a headless workspace.\n   *\n   * @returns Width.\n   */\n  getWidth(): number {\n    return 0;\n  }\n\n  /* eslint-disable jsdoc/require-returns-check */\n  /* eslint-disable @typescript-eslint/no-unused-vars */\n  /**\n   * Obtain a newly created block.\n   *\n   * @param prototypeName Name of the language object containing type-specific\n   *     functions for this block.\n   * @param opt_id Optional ID.  Use this ID if provided, otherwise create a new\n   *     ID.\n   * @returns The created block.\n   */\n  newBlock(prototypeName: string, opt_id?: string): Block {\n    throw new Error(\n        'The implementation of newBlock should be ' +\n        'monkey-patched in by blockly.ts');\n  }\n  /* eslint-enable */\n\n  /**\n   * The number of blocks that may be added to the workspace before reaching\n   *     the maxBlocks.\n   *\n   * @returns Number of blocks left.\n   */\n  remainingCapacity(): number {\n    if (isNaN(this.options.maxBlocks)) {\n      return Infinity;\n    }\n\n    return this.options.maxBlocks - this.getAllBlocks(false).length;\n  }\n\n  /**\n   * The number of blocks of the given type that may be added to the workspace\n   *    before reaching the maxInstances allowed for that type.\n   *\n   * @param type Type of block to return capacity for.\n   * @returns Number of blocks of type left.\n   */\n  remainingCapacityOfType(type: string): number {\n    if (!this.options.maxInstances) {\n      return Infinity;\n    }\n\n    const maxInstanceOfType = this.options.maxInstances[type] !== undefined ?\n        this.options.maxInstances[type] :\n        Infinity;\n\n    return maxInstanceOfType - this.getBlocksByType(type, false).length;\n  }\n\n  /**\n   * Check if there is remaining capacity for blocks of the given counts to be\n   *    created. If the total number of blocks represented by the map is more\n   * than the total remaining capacity, it returns false. If a type count is\n   * more than the remaining capacity for that type, it returns false.\n   *\n   * @param typeCountsMap A map of types to counts (usually representing blocks\n   *     to be created).\n   * @returns True if there is capacity for the given map, false otherwise.\n   */\n  isCapacityAvailable(typeCountsMap: {[key: string]: number}): boolean {\n    if (!this.hasBlockLimits()) {\n      return true;\n    }\n    let copyableBlocksCount = 0;\n    for (const type in typeCountsMap) {\n      if (typeCountsMap[type] > this.remainingCapacityOfType(type)) {\n        return false;\n      }\n      copyableBlocksCount += typeCountsMap[type];\n    }\n    if (copyableBlocksCount > this.remainingCapacity()) {\n      return false;\n    }\n    return true;\n  }\n\n  /**\n   * Checks if the workspace has any limits on the maximum number of blocks,\n   *    or the maximum number of blocks of specific types.\n   *\n   * @returns True if it has block limits, false otherwise.\n   */\n  hasBlockLimits(): boolean {\n    return this.options.maxBlocks !== Infinity || !!this.options.maxInstances;\n  }\n\n  /**\n   * Gets the undo stack for workplace.\n   *\n   * @returns undo stack\n   * @internal\n   */\n  getUndoStack(): Abstract[] {\n    return this.undoStack_;\n  }\n\n  /**\n   * Gets the redo stack for workplace.\n   *\n   * @returns redo stack\n   * @internal\n   */\n  getRedoStack(): Abstract[] {\n    return this.redoStack_;\n  }\n\n  /**\n   * Undo or redo the previous action.\n   *\n   * @param redo False if undo, true if redo.\n   */\n  undo(redo: boolean) {\n    const inputStack = redo ? this.redoStack_ : this.undoStack_;\n    const outputStack = redo ? this.undoStack_ : this.redoStack_;\n    const inputEvent = inputStack.pop();\n    if (!inputEvent) {\n      return;\n    }\n    let events = [inputEvent];\n    // Do another undo/redo if the next one is of the same group.\n    while (inputStack.length && inputEvent.group &&\n           inputEvent.group === inputStack[inputStack.length - 1].group) {\n      const event = inputStack.pop();\n      if (!event) continue;\n      events.push(event);\n    }\n    // Push these popped events on the opposite stack.\n    for (let i = 0; i < events.length; i++) {\n      const event = events[i];\n      outputStack.push(event);\n    }\n    events = eventUtils.filter(events, redo);\n    eventUtils.setRecordUndo(false);\n    try {\n      for (let i = 0; i < events.length; i++) {\n        const event = events[i];\n        event.run(redo);\n      }\n    } finally {\n      eventUtils.setRecordUndo(true);\n    }\n  }\n\n  /** Clear the undo/redo stacks. */\n  clearUndo() {\n    this.undoStack_.length = 0;\n    this.redoStack_.length = 0;\n    // Stop any events already in the firing queue from being undoable.\n    eventUtils.clearPendingUndo();\n  }\n\n  /**\n   * When something in this workspace changes, call a function.\n   * Note that there may be a few recent events already on the stack.  Thus the\n   * new change listener might be called with events that occurred a few\n   * milliseconds before the change listener was added.\n   *\n   * @param func Function to call.\n   * @returns Obsolete return value, ignore.\n   */\n  addChangeListener(func: Function): Function {\n    this.listeners.push(func);\n    return func;\n  }\n\n  /**\n   * Stop listening for this workspace's changes.\n   *\n   * @param func Function to stop calling.\n   */\n  removeChangeListener(func: Function) {\n    arrayUtils.removeElem(this.listeners, func);\n  }\n\n  /**\n   * Fire a change event.\n   *\n   * @param event Event to fire.\n   */\n  fireChangeListener(event: Abstract) {\n    if (event.recordUndo) {\n      this.undoStack_.push(event);\n      this.redoStack_.length = 0;\n      while (this.undoStack_.length > this.MAX_UNDO && this.MAX_UNDO >= 0) {\n        this.undoStack_.shift();\n      }\n    }\n    for (let i = 0; i < this.listeners.length; i++) {\n      const func = this.listeners[i];\n      func(event);\n    }\n  }\n\n  /**\n   * Find the block on this workspace with the specified ID.\n   *\n   * @param id ID of block to find.\n   * @returns The sought after block, or null if not found.\n   */\n  getBlockById(id: string): Block|null {\n    return this.blockDB.get(id) || null;\n  }\n\n  /**\n   * Set a block on this workspace with the specified ID.\n   *\n   * @param id ID of block to set.\n   * @param block The block to set.\n   * @internal\n   */\n  setBlockById(id: string, block: Block) {\n    this.blockDB.set(id, block);\n  }\n\n  /**\n   * Delete a block off this workspace with the specified ID.\n   *\n   * @param id ID of block to delete.\n   * @internal\n   */\n  removeBlockById(id: string) {\n    this.blockDB.delete(id);\n  }\n\n  /**\n   * Find the comment on this workspace with the specified ID.\n   *\n   * @param id ID of comment to find.\n   * @returns The sought after comment, or null if not found.\n   * @internal\n   */\n  getCommentById(id: string): WorkspaceComment|null {\n    return this.commentDB.get(id) ?? null;\n  }\n\n  /**\n   * Checks whether all value and statement inputs in the workspace are filled\n   * with blocks.\n   *\n   * @param opt_shadowBlocksAreFilled An optional argument controlling whether\n   *     shadow blocks are counted as filled. Defaults to true.\n   * @returns True if all inputs are filled, false otherwise.\n   */\n  allInputsFilled(opt_shadowBlocksAreFilled?: boolean): boolean {\n    const blocks = this.getTopBlocks(false);\n    for (let i = 0; i < blocks.length; i++) {\n      const block = blocks[i];\n      if (!block.allInputsFilled(opt_shadowBlocksAreFilled)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  /**\n   * Return the variable map that contains \"potential\" variables.\n   * These exist in the flyout but not in the workspace.\n   *\n   * @returns The potential variable map.\n   * @internal\n   */\n  getPotentialVariableMap(): VariableMap|null {\n    return this.potentialVariableMap;\n  }\n\n  /**\n   * Create and store the potential variable map for this workspace.\n   *\n   * @internal\n   */\n  createPotentialVariableMap() {\n    this.potentialVariableMap = new VariableMap(this);\n  }\n\n  /**\n   * Return the map of all variables on the workspace.\n   *\n   * @returns The variable map.\n   */\n  getVariableMap(): VariableMap {\n    return this.variableMap;\n  }\n\n  /**\n   * Set the map of all variables on the workspace.\n   *\n   * @param variableMap The variable map.\n   * @internal\n   */\n  setVariableMap(variableMap: VariableMap) {\n    this.variableMap = variableMap;\n  }\n\n  /** Returns the map of all procedures on the workpace. */\n  getProcedureMap(): IProcedureMap {\n    return this.procedureMap;\n  }\n\n  /**\n   * Find the workspace with the specified ID.\n   *\n   * @param id ID of workspace to find.\n   * @returns The sought after workspace or null if not found.\n   */\n  static getById(id: string): Workspace|null {\n    return common.getWorkspaceById(id);\n  }\n\n  /**\n   * Find all workspaces.\n   *\n   * @returns Array of workspaces.\n   */\n  static getAll(): Workspace[] {\n    return common.getAllWorkspaces();\n  }\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object in charge of loading, storing, and playing audio for a\n *     workspace.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceAudio');\n\nimport * as userAgent from './utils/useragent.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Prevent a sound from playing if another sound preceded it within this many\n * milliseconds.\n */\nconst SOUND_LIMIT = 100;\n\n/**\n * Class for loading, storing, and playing audio for a workspace.\n */\nexport class WorkspaceAudio {\n  /** Database of pre-loaded sounds. */\n  private sounds = new Map<string, HTMLAudioElement>();\n\n  /** Time that the last sound was played. */\n  private lastSound_: Date|null = null;\n\n  /**\n   * @param parentWorkspace The parent of the workspace this audio object\n   *     belongs to, or null.\n   */\n  constructor(private parentWorkspace: WorkspaceSvg) {}\n\n  /**\n   * Dispose of this audio manager.\n   *\n   * @internal\n   */\n  dispose() {\n    this.sounds.clear();\n  }\n\n  /**\n   * Load an audio file.  Cache it, ready for instantaneous playing.\n   *\n   * @param filenames List of file types in decreasing order of preference (i.e.\n   *     increasing size).  E.g. ['media/go.mp3', 'media/go.wav'] Filenames\n   *     include path from Blockly's root.  File extensions matter.\n   * @param name Name of sound.\n   */\n  load(filenames: string[], name: string) {\n    if (!filenames.length) {\n      return;\n    }\n    let audioTest;\n    try {\n      audioTest = new globalThis['Audio']();\n    } catch (e) {\n      // No browser support for Audio.\n      // IE can throw an error even if the Audio object exists.\n      return;\n    }\n    let sound;\n    for (let i = 0; i < filenames.length; i++) {\n      const filename = filenames[i];\n      const ext = filename.match(/\\.(\\w+)$/);\n      if (ext && audioTest.canPlayType('audio/' + ext[1])) {\n        // Found an audio format we can play.\n        sound = new globalThis['Audio'](filename);\n        break;\n      }\n    }\n    if (sound) {\n      this.sounds.set(name, sound);\n    }\n  }\n\n  /**\n   * Preload all the audio files so that they play quickly when asked for.\n   *\n   * @internal\n   */\n  preload() {\n    for (const sound of this.sounds.values()) {\n      sound.volume = 0.01;\n      const playPromise = sound.play();\n      // Edge does not return a promise, so we need to check.\n      if (playPromise !== undefined) {\n        // If we don't wait for the play request to complete before calling\n        // pause() we will get an exception: (DOMException: The play() request\n        // was interrupted) See more:\n        // https://developers.google.com/web/updates/2017/06/play-request-was-interrupted\n        playPromise.then(sound.pause)\n            .catch(\n                // Play without user interaction was prevented.\n                function() {});\n      } else {\n        sound.pause();\n      }\n\n      // iOS can only process one sound at a time.  Trying to load more than one\n      // corrupts the earlier ones.  Just load one and leave the others\n      // uncached.\n      if (userAgent.IPAD || userAgent.IPHONE) {\n        break;\n      }\n    }\n  }\n\n  /**\n   * Play a named sound at specified volume.  If volume is not specified,\n   * use full volume (1).\n   *\n   * @param name Name of sound.\n   * @param opt_volume Volume of sound (0-1).\n   */\n  play(name: string, opt_volume?: number) {\n    const sound = this.sounds.get(name);\n    if (sound) {\n      // Don't play one sound on top of another.\n      const now = new Date();\n      if (this.lastSound_ !== null &&\n          now.getTime() - this.lastSound_.getTime() < SOUND_LIMIT) {\n        return;\n      }\n      this.lastSound_ = now;\n      let mySound;\n      if (userAgent.IPAD || userAgent.ANDROID) {\n        // Creating a new audio node causes lag in Android and iPad.  Android\n        // refetches the file from the server, iPad uses a singleton audio\n        // node which must be deleted and recreated for each new audio tag.\n        mySound = sound;\n      } else {\n        mySound = sound.cloneNode() as HTMLAudioElement;\n      }\n      mySound.volume = opt_volume === undefined ? 1 : opt_volume;\n      mySound.play();\n    } else if (this.parentWorkspace) {\n      // Maybe a workspace on a lower level knows about this sound.\n      this.parentWorkspace.getAudioManager().play(name, opt_volume);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Contains the path to a single png tat holds the images for the trashcan\n * as well as the zoom controls.\n */\nexport const SPRITE = {\n  width: 96,\n  height: 124,\n  url: 'sprites.png',\n};\n", "/**\n * @license\n * Copyright 2015 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a zoom icons.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ZoomControls');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_click.js';\n\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport * as Css from './css.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport {SPRITE} from './sprites.js';\nimport * as Touch from './touch.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a zoom controls.\n */\nexport class ZoomControls implements IPositionable {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  id = 'zoomControls';\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /** The zoom in svg <g> element. */\n  private zoomInGroup: SVGGElement|null = null;\n\n  /** The zoom out svg <g> element. */\n  private zoomOutGroup: SVGGElement|null = null;\n\n  /** The zoom reset svg <g> element. */\n  private zoomResetGroup: SVGGElement|null = null;\n\n  /** Width of the zoom controls. */\n  private readonly WIDTH = 32;\n\n  /** Height of each zoom control. */\n  private readonly HEIGHT = 32;\n\n  /** Small spacing used between the zoom in and out control, in pixels. */\n  private readonly SMALL_SPACING = 2;\n\n  /**\n   * Large spacing used between the zoom in and reset control, in pixels.\n   */\n  private readonly LARGE_SPACING = 11;\n\n  /** Distance between zoom controls and bottom or top edge of workspace. */\n  private readonly MARGIN_VERTICAL = 20;\n\n  /** Distance between zoom controls and right or left edge of workspace. */\n  private readonly MARGIN_HORIZONTAL = 20;\n\n  /** The SVG group containing the zoom controls. */\n  private svgGroup: SVGElement|null = null;\n\n  /** Left coordinate of the zoom controls. */\n  private left = 0;\n\n  /** Top coordinate of the zoom controls. */\n  private top = 0;\n\n  /** Whether this has been initialized. */\n  private initialized = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private readonly workspace: WorkspaceSvg) {}\n\n  /**\n   * Create the zoom controls.\n   *\n   * @returns The zoom controls SVG group.\n   */\n  createDom(): SVGElement {\n    this.svgGroup = dom.createSvgElement(Svg.G, {});\n\n    // Each filter/pattern needs a unique ID for the case of multiple Blockly\n    // instances on a page.  Browser behaviour becomes undefined otherwise.\n    // https://neil.fraser.name/news/2015/11/01/\n    const rnd = String(Math.random()).substring(2);\n    this.createZoomOutSvg(rnd);\n    this.createZoomInSvg(rnd);\n    if (this.workspace.isMovable()) {\n      // If we zoom to the center and the workspace isn't movable we could\n      // loose blocks at the edges of the workspace.\n      this.createZoomResetSvg(rnd);\n    }\n    return this.svgGroup;\n  }\n\n  /** Initializes the zoom controls. */\n  init() {\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 2,\n      capabilities: [ComponentManager.Capability.POSITIONABLE],\n    });\n    this.initialized = true;\n  }\n\n  /**\n   * Disposes of this zoom controls.\n   * Unlink from all DOM elements to prevent memory leaks.\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('zoomControls');\n    if (this.svgGroup) {\n      dom.removeNode(this.svgGroup);\n    }\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect|null {\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const bottom = this.top + height;\n    const right = this.left + this.WIDTH;\n    return new Rect(this.top, bottom, this.left, right);\n  }\n\n  /**\n   * Positions the zoom controls.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized) {\n      return;\n    }\n\n    const cornerPosition =\n        uiPosition.getCornerOppositeToolbox(this.workspace, metrics);\n    let height = this.SMALL_SPACING + 2 * this.HEIGHT;\n    if (this.zoomResetGroup) {\n      height += this.LARGE_SPACING + this.HEIGHT;\n    }\n    const startRect = uiPosition.getStartPositionRect(\n        cornerPosition, new Size(this.WIDTH, height), this.MARGIN_HORIZONTAL,\n        this.MARGIN_VERTICAL, metrics, this.workspace);\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection = verticalPosition === uiPosition.verticalPosition.TOP ?\n        uiPosition.bumpDirection.DOWN :\n        uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n        startRect, this.MARGIN_VERTICAL, bumpDirection, savedPositions);\n\n    if (verticalPosition === uiPosition.verticalPosition.TOP) {\n      const zoomInTranslateY = this.SMALL_SPACING + this.HEIGHT;\n      this.zoomInGroup?.setAttribute(\n          'transform', 'translate(0, ' + zoomInTranslateY + ')');\n      if (this.zoomResetGroup) {\n        const zoomResetTranslateY =\n            zoomInTranslateY + this.LARGE_SPACING + this.HEIGHT;\n        this.zoomResetGroup.setAttribute(\n            'transform', 'translate(0, ' + zoomResetTranslateY + ')');\n      }\n    } else {\n      const zoomInTranslateY =\n          this.zoomResetGroup ? this.LARGE_SPACING + this.HEIGHT : 0;\n      this.zoomInGroup?.setAttribute(\n          'transform', 'translate(0, ' + zoomInTranslateY + ')');\n      const zoomOutTranslateY =\n          zoomInTranslateY + this.SMALL_SPACING + this.HEIGHT;\n      this.zoomOutGroup?.setAttribute(\n          'transform', 'translate(0, ' + zoomOutTranslateY + ')');\n    }\n\n    this.top = positionRect.top;\n    this.left = positionRect.left;\n    this.svgGroup?.setAttribute(\n        'transform', 'translate(' + this.left + ',' + this.top + ')');\n  }\n\n  /**\n   * Create the zoom in icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomOutSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomoutClipPath837493\">\n            <rect width=\"32\" height=\"32></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-64\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomoutClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomOutGroup =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyZoom'}, this.svgGroup);\n    const clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyZoomoutClipPath' + rnd},\n        this.zoomOutGroup);\n    dom.createSvgElement(\n        Svg.RECT, {\n          'width': 32,\n          'height': 32,\n        },\n        clip);\n    const zoomoutSvg = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'height': SPRITE.height,\n          'x': -64,\n          'y': -92,\n          'clip-path': 'url(#blocklyZoomoutClipPath' + rnd + ')',\n        },\n        this.zoomOutGroup);\n    zoomoutSvg.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // Attach listener.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        this.zoomOutGroup, 'pointerdown', null, this.zoom.bind(this, -1)));\n  }\n\n  /**\n   * Create the zoom out icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomInSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoominClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoominClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomInGroup =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyZoom'}, this.svgGroup);\n    const clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyZoominClipPath' + rnd}, this.zoomInGroup);\n    dom.createSvgElement(\n        Svg.RECT, {\n          'width': 32,\n          'height': 32,\n        },\n        clip);\n    const zoominSvg = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'height': SPRITE.height,\n          'x': -32,\n          'y': -92,\n          'clip-path': 'url(#blocklyZoominClipPath' + rnd + ')',\n        },\n        this.zoomInGroup);\n    zoominSvg.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // Attach listener.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        this.zoomInGroup, 'pointerdown', null, this.zoom.bind(this, 1)));\n  }\n\n  /**\n   * Handles a mouse down event on the zoom in or zoom out buttons on the\n   *    workspace.\n   *\n   * @param amount Amount of zooming. Negative amount values zoom out, and\n   *     positive amount values zoom in.\n   * @param e A mouse down event.\n   */\n  private zoom(amount: number, e: PointerEvent) {\n    this.workspace.markFocused();\n    this.workspace.zoomCenter(amount);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier();  // Don't block future drags.\n    e.stopPropagation();           // Don't start a workspace scroll.\n    e.preventDefault();            // Stop double-clicking from selecting text.\n  }\n\n  /**\n   * Create the zoom reset icon and its event handler.\n   *\n   * @param rnd The random string to use as a suffix in the clip path's ID.\n   *     These IDs must be unique in case there are multiple Blockly instances\n   *     on the same page.\n   */\n  private createZoomResetSvg(rnd: string) {\n    /* This markup will be generated and added to the .svgGroup:\n        <g class=\"blocklyZoom\">\n          <clipPath id=\"blocklyZoomresetClipPath837493\">\n            <rect width=\"32\" height=\"32\"></rect>\n          </clipPath>\n          <image width=\"96\" height=\"124\" x=\"-32\" y=\"-92\"\n        xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyZoomresetClipPath837493)\"></image>\n        </g>\n        */\n    this.zoomResetGroup =\n        dom.createSvgElement(Svg.G, {'class': 'blocklyZoom'}, this.svgGroup);\n    const clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyZoomresetClipPath' + rnd},\n        this.zoomResetGroup);\n    dom.createSvgElement(Svg.RECT, {'width': 32, 'height': 32}, clip);\n    const zoomresetSvg = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'height': SPRITE.height,\n          'y': -92,\n          'clip-path': 'url(#blocklyZoomresetClipPath' + rnd + ')',\n        },\n        this.zoomResetGroup);\n    zoomresetSvg.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // Attach event listeners.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        this.zoomResetGroup, 'pointerdown', null, this.resetZoom.bind(this)));\n  }\n\n  /**\n   * Handles a mouse down event on the reset zoom button on the workspace.\n   *\n   * @param e A mouse down event.\n   */\n  private resetZoom(e: PointerEvent) {\n    this.workspace.markFocused();\n\n    // zoom is passed amount and computes the new scale using the formula:\n    // targetScale = currentScale * Math.pow(speed, amount)\n    const targetScale = this.workspace.options.zoomOptions.startScale;\n    const currentScale = this.workspace.scale;\n    const speed = this.workspace.options.zoomOptions.scaleSpeed;\n    // To compute amount:\n    // amount = log(speed, (targetScale / currentScale))\n    // Math.log computes natural logarithm (ln), to change the base, use\n    // formula: log(base, value) = ln(value) / ln(base)\n    const amount = Math.log(targetScale / currentScale) / Math.log(speed);\n    this.workspace.beginCanvasTransition();\n    this.workspace.zoomCenter(amount);\n    this.workspace.scrollCenter();\n\n    setTimeout(this.workspace.endCanvasTransition.bind(this.workspace), 500);\n    this.fireZoomEvent();\n    Touch.clearTouchIdentifier();  // Don't block future drags.\n    e.stopPropagation();           // Don't start a workspace scroll.\n    e.preventDefault();            // Stop double-clicking from selecting text.\n  }\n\n  /** Fires a zoom control UI event. */\n  private fireZoomEvent() {\n    const uiEvent = new (eventUtils.get(eventUtils.CLICK))(\n        null, this.workspace.id, 'zoom_controls');\n    eventUtils.fire(uiEvent);\n  }\n}\n\n/** CSS for zoom controls.  See css.js for use. */\nCss.register(`\n.blocklyZoom>image, .blocklyZoom>svg>image {\n  opacity: .4;\n}\n\n.blocklyZoom>image:hover, .blocklyZoom>svg>image:hover {\n  opacity: .6;\n}\n\n.blocklyZoom>image:active, .blocklyZoom>svg>image:active {\n  opacity: .8;\n}\n`);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Flyout tray containing blocks which may be created.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Flyout');\n\nimport type {Block} from './block.js';\nimport type {BlockSvg} from './block_svg.js';\nimport * as browserEvents from './browser_events.js';\nimport * as common from './common.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport * as eventUtils from './events/utils.js';\nimport {FlyoutButton} from './flyout_button.js';\nimport {FlyoutMetricsManager} from './flyout_metrics_manager.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {Options} from './options.js';\nimport {ScrollbarPair} from './scrollbar_pair.js';\nimport * as blocks from './serialization/blocks.js';\nimport * as Tooltip from './tooltip.js';\nimport {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport * as idGenerator from './utils/idgenerator.js';\nimport {Svg} from './utils/svg.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as Variables from './variables.js';\nimport {WorkspaceSvg} from './workspace_svg.js';\nimport * as utilsXml from './utils/xml.js';\nimport * as Xml from './xml.js';\n\n\nenum FlyoutItemType {\n  BLOCK = 'block',\n  BUTTON = 'button',\n}\n\n/**\n * Class for a flyout.\n */\nexport abstract class Flyout extends DeleteArea implements IFlyout {\n  /**\n   * Position the flyout.\n   */\n  abstract position(): void;\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has\n   *     moved from the position at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   */\n  abstract isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean;\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float\n   *     between 0 and 1 specifying the degree of scrolling and a\n   *     similar x property.\n   */\n  protected abstract setMetrics_(xyRatio: {x?: number, y?: number}): void;\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected abstract layout_(contents: FlyoutItem[], gaps: number[]): void;\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected abstract wheel_(e: WheelEvent): void;\n\n  /**\n   * Compute height of flyout.  Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected abstract reflowInternal_(): void;\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  abstract getX(): number;\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  abstract getY(): number;\n\n  /**\n   * Scroll the flyout to the beginning of its contents.\n   */\n  abstract scrollToStart(): void;\n\n  /**\n   * The type of a flyout content item.\n   */\n  static FlyoutItemType = FlyoutItemType;\n\n  protected workspace_: WorkspaceSvg;\n  RTL: boolean;\n  /**\n   * Whether the flyout should be laid out horizontally or not.\n   *\n   * @internal\n   */\n  horizontalLayout = false;\n  protected toolboxPosition_: number;\n\n  /**\n   * Array holding info needed to unbind events.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  private boundEvents: browserEvents.Data[] = [];\n\n  /**\n   * Function that will be registered as a change listener on the workspace\n   * to reflow when blocks in the flyout workspace change.\n   */\n  private reflowWrapper_: Function|null = null;\n\n  /**\n   * Function that disables blocks in the flyout based on max block counts\n   * allowed in the target workspace. Registered as a change listener on the\n   * target workspace.\n   */\n  private filterWrapper_: Function|null = null;\n\n  /**\n   * List of background mats that lurk behind each block to catch clicks\n   * landing in the blocks' lakes and bays.\n   */\n  private mats_: SVGElement[] = [];\n  /**\n   * List of visible buttons.\n   */\n  protected buttons_: FlyoutButton[] = [];\n  /**\n   * List of event listeners.\n   */\n  private listeners_: browserEvents.Data[] = [];\n\n  /**\n   * List of blocks that should always be disabled.\n   */\n  private permanentlyDisabled_: Block[] = [];\n  protected readonly tabWidth_: number;\n\n  /**\n   * The target workspace.\n   *\n   * @internal\n   */\n  targetWorkspace!: WorkspaceSvg;\n  /**\n   * A list of blocks that can be reused.\n   */\n  private recycledBlocks_: BlockSvg[] = [];\n  /**\n   * Does the flyout automatically close when a block is created?\n   */\n  autoClose = true;\n\n  /**\n   * Whether the flyout is visible.\n   */\n  private isVisible_ = false;\n\n  /**\n   * Whether the workspace containing this flyout is visible.\n   */\n  private containerVisible_ = true;\n  protected rectMap_: WeakMap<BlockSvg, SVGElement>;\n\n  /**\n   * Corner radius of the flyout background.\n   */\n  readonly CORNER_RADIUS: number = 8;\n  readonly MARGIN: number;\n  readonly GAP_X: number;\n  readonly GAP_Y: number;\n\n  /**\n   * Top/bottom padding between scrollbar and edge of flyout background.\n   */\n  readonly SCROLLBAR_MARGIN: number = 2.5;\n\n  /**\n   * Width of flyout.\n   */\n  protected width_ = 0;\n\n  /**\n   * Height of flyout.\n   */\n  protected height_ = 0;\n  // clang-format off\n  /**\n   * Range of a drag angle from a flyout considered \"dragging toward\n   * workspace\". Drags that are within the bounds of this many degrees from\n   * the orthogonal line to the flyout edge are considered to be \"drags toward\n   * the workspace\".\n   *\n   * @example\n   *\n   * ```\n   * Flyout                                                 Edge   Workspace\n   * [block] /  <-within this angle, drags \"toward workspace\" |\n   * [block] ---- orthogonal to flyout boundary ----          |\n   * [block] \\                                                |\n   * ```\n   *\n   * The angle is given in degrees from the orthogonal.\n   *\n   * This is used to know when to create a new block and when to scroll the\n   * flyout. Setting it to 360 means that all drags create a new block.\n   */\n  // clang-format on\n  protected dragAngleRange_ = 70;\n\n  /**\n   * The path around the background of the flyout, which will be filled with a\n   * background colour.\n   */\n  protected svgBackground_: SVGPathElement|null = null;\n\n  /**\n   * The root SVG group for the button or label.\n   */\n  protected svgGroup_: SVGGElement|null = null;\n  /**\n   * @param workspaceOptions Dictionary of options for the\n   *     workspace.\n   */\n  constructor(workspaceOptions: Options) {\n    super();\n    workspaceOptions.setMetrics = this.setMetrics_.bind(this);\n\n    this.workspace_ = new WorkspaceSvg(workspaceOptions);\n    this.workspace_.setMetricsManager(\n        new FlyoutMetricsManager(this.workspace_, this));\n\n    this.workspace_.internalIsFlyout = true;\n    // Keep the workspace visibility consistent with the flyout's visibility.\n    this.workspace_.setVisible(this.isVisible_);\n\n    /**\n     * The unique id for this component that is used to register with the\n     * ComponentManager.\n     */\n    this.id = idGenerator.genUid();\n\n    /**\n     * Is RTL vs LTR.\n     */\n    this.RTL = !!workspaceOptions.RTL;\n\n    /**\n     * Position of the toolbox and flyout relative to the workspace.\n     */\n    this.toolboxPosition_ = workspaceOptions.toolboxPosition;\n\n    /**\n     * Width of output tab.\n     */\n    this.tabWidth_ = this.workspace_.getRenderer().getConstants().TAB_WIDTH;\n\n    /**\n     * A map from blocks to the rects which are beneath them to act as input\n     * targets.\n     *\n     * @internal\n     */\n    this.rectMap_ = new WeakMap();\n\n    /**\n     * Margin around the edges of the blocks in the flyout.\n     */\n    this.MARGIN = this.CORNER_RADIUS;\n\n    // TODO: Move GAP_X and GAP_Y to their appropriate files.\n    /**\n     * Gap between items in horizontal flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_X = this.MARGIN * 3;\n\n    /**\n     * Gap between items in vertical flyouts. Can be overridden with the \"sep\"\n     * element.\n     */\n    this.GAP_Y = this.MARGIN * 3;\n  }\n\n  /**\n   * Creates the flyout's DOM.  Only needs to be called once.  The flyout can\n   * either exist as its own SVG element or be a g element nested inside a\n   * separate SVG element.\n   *\n   * @param tagName The type of tag to\n   *     put the flyout in. This should be <svg> or <g>.\n   * @returns The flyout's SVG group.\n   */\n  createDom(tagName: string|Svg<SVGSVGElement>|Svg<SVGGElement>): SVGElement {\n    /*\n        <svg | g>\n          <path class=\"blocklyFlyoutBackground\"/>\n          <g class=\"blocklyFlyout\"></g>\n        </ svg | g>\n        */\n    // Setting style to display:none to start. The toolbox and flyout\n    // hide/show code will set up proper visibility and size later.\n    this.svgGroup_ = dom.createSvgElement(\n        tagName, {'class': 'blocklyFlyout', 'style': 'display: none'});\n    this.svgBackground_ = dom.createSvgElement(\n        Svg.PATH, {'class': 'blocklyFlyoutBackground'}, this.svgGroup_);\n    this.svgGroup_.appendChild(this.workspace_.createDom());\n    this.workspace_.getThemeManager().subscribe(\n        this.svgBackground_, 'flyoutBackgroundColour', 'fill');\n    this.workspace_.getThemeManager().subscribe(\n        this.svgBackground_, 'flyoutOpacity', 'fill-opacity');\n    return this.svgGroup_;\n  }\n\n  /**\n   * Initializes the flyout.\n   *\n   * @param targetWorkspace The workspace in which to\n   *     create new blocks.\n   */\n  init(targetWorkspace: WorkspaceSvg) {\n    this.targetWorkspace = targetWorkspace;\n    this.workspace_.targetWorkspace = targetWorkspace;\n\n    this.workspace_.scrollbar = new ScrollbarPair(\n        this.workspace_, this.horizontalLayout, !this.horizontalLayout,\n        'blocklyFlyoutScrollbar', this.SCROLLBAR_MARGIN);\n\n    this.hide();\n\n    this.boundEvents.push(browserEvents.conditionalBind(\n        (this.svgGroup_ as SVGGElement), 'wheel', this, this.wheel_));\n    if (!this.autoClose) {\n      this.filterWrapper_ = this.filterForCapacity_.bind(this);\n      this.targetWorkspace.addChangeListener(this.filterWrapper_);\n    }\n\n    // Dragging the flyout up and down.\n    this.boundEvents.push(browserEvents.conditionalBind(\n        (this.svgBackground_ as SVGPathElement), 'pointerdown', this,\n        this.onMouseDown_));\n\n    // A flyout connected to a workspace doesn't have its own current gesture.\n    this.workspace_.getGesture =\n        this.targetWorkspace.getGesture.bind(this.targetWorkspace);\n\n    // Get variables from the main workspace rather than the target workspace.\n    this.workspace_.setVariableMap(this.targetWorkspace.getVariableMap());\n\n    this.workspace_.createPotentialVariableMap();\n\n    targetWorkspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Dispose of this flyout.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.hide();\n    this.workspace_.getComponentManager().removeComponent(this.id);\n    for (const event of this.boundEvents) {\n      browserEvents.unbind(event);\n    }\n    this.boundEvents.length = 0;\n    if (this.filterWrapper_) {\n      this.targetWorkspace.removeChangeListener(this.filterWrapper_);\n      this.filterWrapper_ = null;\n    }\n    if (this.workspace_) {\n      this.workspace_.getThemeManager().unsubscribe(this.svgBackground_!);\n      this.workspace_.dispose();\n    }\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n      this.svgGroup_ = null;\n    }\n    this.svgBackground_ = null;\n  }\n\n  /**\n   * Get the width of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Get the height of the flyout.\n   *\n   * @returns The width of the flyout.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Get the scale (zoom level) of the flyout. By default,\n   * this matches the target workspace scale, but this can be overridden.\n   *\n   * @returns Flyout workspace scale.\n   */\n  getFlyoutScale(): number {\n    return this.targetWorkspace.scale;\n  }\n\n  /**\n   * Get the workspace inside the flyout.\n   *\n   * @returns The workspace inside the flyout.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Is the flyout visible?\n   *\n   * @returns True if visible.\n   */\n  isVisible(): boolean {\n    return this.isVisible_;\n  }\n\n  /**\n   * Set whether the flyout is visible. A value of true does not necessarily\n   * mean that the flyout is shown. It could be hidden because its container is\n   * hidden.\n   *\n   * @param visible True if visible.\n   */\n  setVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.isVisible();\n\n    this.isVisible_ = visible;\n    if (visibilityChanged) {\n      if (!this.autoClose) {\n        // Auto-close flyouts are ignored as drag targets, so only non\n        // auto-close flyouts need to have their drag target updated.\n        this.workspace_.recordDragTargets();\n      }\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Set whether this flyout's container is visible.\n   *\n   * @param visible Whether the container is visible.\n   */\n  setContainerVisible(visible: boolean) {\n    const visibilityChanged = visible !== this.containerVisible_;\n    this.containerVisible_ = visible;\n    if (visibilityChanged) {\n      this.updateDisplay_();\n    }\n  }\n\n  /**\n   * Update the display property of the flyout based whether it thinks it should\n   * be visible and whether its containing workspace is visible.\n   */\n  private updateDisplay_() {\n    let show = true;\n    if (!this.containerVisible_) {\n      show = false;\n    } else {\n      show = this.isVisible();\n    }\n    if (this.svgGroup_) {\n      this.svgGroup_.style.display = show ? 'block' : 'none';\n    }\n    // Update the scrollbar's visibility too since it should mimic the\n    // flyout's visibility.\n    this.workspace_.scrollbar?.setContainerVisible(show);\n  }\n\n  /**\n   * Update the view based on coordinates calculated in position().\n   *\n   * @param width The computed width of the flyout's SVG group\n   * @param height The computed height of the flyout's SVG group.\n   * @param x The computed x origin of the flyout's SVG group.\n   * @param y The computed y origin of the flyout's SVG group.\n   */\n  protected positionAt_(width: number, height: number, x: number, y: number) {\n    this.svgGroup_?.setAttribute('width', `${width}`);\n    this.svgGroup_?.setAttribute('height', `${height}`);\n    this.workspace_.setCachedParentSvgSize(width, height);\n\n    if (this.svgGroup_) {\n      const transform = 'translate(' + x + 'px,' + y + 'px)';\n      dom.setCssTransform(this.svgGroup_, transform);\n    }\n\n    // Update the scrollbar (if one exists).\n    const scrollbar = this.workspace_.scrollbar;\n    if (scrollbar) {\n      // Set the scrollbars origin to be the top left of the flyout.\n      scrollbar.setOrigin(x, y);\n      scrollbar.resize();\n      // If origin changed and metrics haven't changed enough to trigger\n      // reposition in resize, we need to call setPosition. See issue #4692.\n      if (scrollbar.hScroll) {\n        scrollbar.hScroll.setPosition(\n            scrollbar.hScroll.position.x, scrollbar.hScroll.position.y);\n      }\n      if (scrollbar.vScroll) {\n        scrollbar.vScroll.setPosition(\n            scrollbar.vScroll.position.x, scrollbar.vScroll.position.y);\n      }\n    }\n  }\n\n  /**\n   * Hide and empty the flyout.\n   */\n  hide() {\n    if (!this.isVisible()) {\n      return;\n    }\n    this.setVisible(false);\n    // Delete all the event listeners.\n    for (const listen of this.listeners_) {\n      browserEvents.unbind(listen);\n    }\n    this.listeners_.length = 0;\n    if (this.reflowWrapper_) {\n      this.workspace_.removeChangeListener(this.reflowWrapper_);\n      this.reflowWrapper_ = null;\n    }\n    // Do NOT delete the blocks here.  Wait until Flyout.show.\n    // https://neil.fraser.name/news/2014/08/09/\n  }\n\n  /**\n   * Show and populate the flyout.\n   *\n   * @param flyoutDef Contents to display\n   *     in the flyout. This is either an array of Nodes, a NodeList, a\n   *     toolbox definition, or a string with the name of the dynamic category.\n   */\n  show(flyoutDef: toolbox.FlyoutDefinition|string) {\n    this.workspace_.setResizesEnabled(false);\n    this.hide();\n    this.clearOldBlocks_();\n\n    // Handle dynamic categories, represented by a name instead of a list.\n    if (typeof flyoutDef === 'string') {\n      flyoutDef = this.getDynamicCategoryContents_(flyoutDef);\n    }\n    this.setVisible(true);\n\n    // Parse the Array, Node or NodeList into a a list of flyout items.\n    const parsedContent = toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n    const flyoutInfo = this.createFlyoutInfo_(parsedContent);\n\n    this.layout_(flyoutInfo.contents, flyoutInfo.gaps);\n\n    if (this.horizontalLayout) {\n      this.height_ = 0;\n    } else {\n      this.width_ = 0;\n    }\n    this.workspace_.setResizesEnabled(true);\n    this.reflow();\n\n    this.filterForCapacity_();\n\n    // Correctly position the flyout's scrollbar when it opens.\n    this.position();\n\n    this.reflowWrapper_ = this.reflow.bind(this);\n    this.workspace_.addChangeListener(this.reflowWrapper_);\n    this.emptyRecycledBlocks_();\n  }\n\n  /**\n   * Create the contents array and gaps array necessary to create the layout for\n   * the flyout.\n   *\n   * @param parsedContent The array\n   *     of objects to show in the flyout.\n   * @returns The list of contents and gaps needed to lay out the flyout.\n   */\n  private createFlyoutInfo_(parsedContent: toolbox.FlyoutItemInfoArray):\n      {contents: FlyoutItem[], gaps: number[]} {\n    const contents: FlyoutItem[] = [];\n    const gaps: number[] = [];\n    this.permanentlyDisabled_.length = 0;\n    const defaultGap = this.horizontalLayout ? this.GAP_X : this.GAP_Y;\n    for (const info of parsedContent) {\n      if ('custom' in info) {\n        const customInfo = (info as toolbox.DynamicCategoryInfo);\n        const categoryName = customInfo['custom'];\n        const flyoutDef = this.getDynamicCategoryContents_(categoryName);\n        const parsedDynamicContent =\n            toolbox.convertFlyoutDefToJsonArray(flyoutDef);\n        const {contents: dynamicContents, gaps: dynamicGaps} =\n            this.createFlyoutInfo_(parsedDynamicContent);\n        contents.push(...dynamicContents);\n        gaps.push(...dynamicGaps);\n      }\n\n      switch (info['kind'].toUpperCase()) {\n        case 'BLOCK': {\n          const blockInfo = (info as toolbox.BlockInfo);\n          const block = this.createFlyoutBlock_(blockInfo);\n          contents.push({type: FlyoutItemType.BLOCK, block: block});\n          this.addBlockGap_(blockInfo, gaps, defaultGap);\n          break;\n        }\n        case 'SEP': {\n          const sepInfo = (info as toolbox.SeparatorInfo);\n          this.addSeparatorGap_(sepInfo, gaps, defaultGap);\n          break;\n        }\n        case 'LABEL': {\n          const labelInfo = (info as toolbox.LabelInfo);\n          // A label is a button with different styling.\n          const label = this.createButton_(labelInfo, /** isLabel */ true);\n          contents.push({type: FlyoutItemType.BUTTON, button: label});\n          gaps.push(defaultGap);\n          break;\n        }\n        case 'BUTTON': {\n          const buttonInfo = (info as toolbox.ButtonInfo);\n          const button = this.createButton_(buttonInfo, /** isLabel */ false);\n          contents.push({type: FlyoutItemType.BUTTON, button: button});\n          gaps.push(defaultGap);\n          break;\n        }\n      }\n    }\n\n    return {contents: contents, gaps: gaps};\n  }\n\n  /**\n   * Gets the flyout definition for the dynamic category.\n   *\n   * @param categoryName The name of the dynamic category.\n   * @returns The definition of the\n   *     flyout in one of its many forms.\n   */\n  private getDynamicCategoryContents_(categoryName: string):\n      toolbox.FlyoutDefinition {\n    // Look up the correct category generation function and call that to get a\n    // valid XML list.\n    const fnToApply =\n        this.workspace_.targetWorkspace!.getToolboxCategoryCallback(\n            categoryName);\n    if (typeof fnToApply !== 'function') {\n      throw TypeError(\n          'Couldn\\'t find a callback function when opening' +\n          ' a toolbox category.');\n    }\n    return fnToApply(this.workspace_.targetWorkspace!);\n  }\n\n  /**\n   * Creates a flyout button or a flyout label.\n   *\n   * @param btnInfo The object holding information about a button or a label.\n   * @param isLabel True if the button is a label, false otherwise.\n   * @returns The object used to display the button in the\n   *    flyout.\n   */\n  private createButton_(btnInfo: toolbox.ButtonOrLabelInfo, isLabel: boolean):\n      FlyoutButton {\n    const curButton = new FlyoutButton(\n        this.workspace_, (this.targetWorkspace as WorkspaceSvg), btnInfo,\n        isLabel);\n    return curButton;\n  }\n\n  /**\n   * Create a block from the xml and permanently disable any blocks that were\n   * defined as disabled.\n   *\n   * @param blockInfo The info of the block.\n   * @returns The block created from the blockInfo.\n   */\n  private createFlyoutBlock_(blockInfo: toolbox.BlockInfo): BlockSvg {\n    let block;\n    if (blockInfo['blockxml']) {\n      const xml = (typeof blockInfo['blockxml'] === 'string' ?\n                       utilsXml.textToDom(blockInfo['blockxml']) :\n                       blockInfo['blockxml']) as Element;\n      block = this.getRecycledBlock_(xml.getAttribute('type')!);\n      if (!block) {\n        block = Xml.domToBlock(xml, this.workspace_);\n      }\n    } else {\n      block = this.getRecycledBlock_(blockInfo['type']!);\n      if (!block) {\n        if (blockInfo['enabled'] === undefined) {\n          blockInfo['enabled'] = blockInfo['disabled'] !== 'true' &&\n              blockInfo['disabled'] !== true;\n        }\n        block = blocks.append((blockInfo as blocks.State), this.workspace_);\n      }\n    }\n\n    if (!block.isEnabled()) {\n      // Record blocks that were initially disabled.\n      // Do not enable these blocks as a result of capacity filtering.\n      this.permanentlyDisabled_.push(block);\n    }\n    return (block as BlockSvg);\n  }\n\n  /**\n   * Returns a block from the array of recycled blocks with the given type, or\n   * undefined if one cannot be found.\n   *\n   * @param blockType The type of the block to try to recycle.\n   * @returns The recycled block, or undefined if\n   *     one could not be recycled.\n   */\n  private getRecycledBlock_(blockType: string): BlockSvg|undefined {\n    let index = -1;\n    for (let i = 0; i < this.recycledBlocks_.length; i++) {\n      if (this.recycledBlocks_[i].type === blockType) {\n        index = i;\n        break;\n      }\n    }\n    return index === -1 ? undefined : this.recycledBlocks_.splice(index, 1)[0];\n  }\n\n  /**\n   * Adds a gap in the flyout based on block info.\n   *\n   * @param blockInfo Information about a block.\n   * @param gaps The list of gaps between items in the flyout.\n   * @param defaultGap The default gap between one element and the\n   *     next.\n   */\n  private addBlockGap_(\n      blockInfo: toolbox.BlockInfo, gaps: number[], defaultGap: number) {\n    let gap;\n    if (blockInfo['gap']) {\n      gap = parseInt(String(blockInfo['gap']));\n    } else if (blockInfo['blockxml']) {\n      const xml = (typeof blockInfo['blockxml'] === 'string' ?\n                       utilsXml.textToDom(blockInfo['blockxml']) :\n                       blockInfo['blockxml']) as Element;\n      gap = parseInt(xml.getAttribute('gap')!);\n    }\n    gaps.push(!gap || isNaN(gap) ? defaultGap : gap);\n  }\n\n  /**\n   * Add the necessary gap in the flyout for a separator.\n   *\n   * @param sepInfo The object holding\n   *    information about a separator.\n   * @param gaps The list gaps between items in the flyout.\n   * @param defaultGap The default gap between the button and next\n   *     element.\n   */\n  private addSeparatorGap_(\n      sepInfo: toolbox.SeparatorInfo, gaps: number[], defaultGap: number) {\n    // Change the gap between two toolbox elements.\n    // <sep gap=\"36\"></sep>\n    // The default gap is 24, can be set larger or smaller.\n    // This overwrites the gap attribute on the previous element.\n    const newGap = parseInt(String(sepInfo['gap']));\n    // Ignore gaps before the first block.\n    if (!isNaN(newGap) && gaps.length > 0) {\n      gaps[gaps.length - 1] = newGap;\n    } else {\n      gaps.push(defaultGap);\n    }\n  }\n\n  /**\n   * Delete blocks, mats and buttons from a previous showing of the flyout.\n   */\n  private clearOldBlocks_() {\n    // Delete any blocks from a previous showing.\n    const oldBlocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = oldBlocks[i]; i++) {\n      if (this.blockIsRecyclable_(block)) {\n        this.recycleBlock_(block);\n      } else {\n        block.dispose(false, false);\n      }\n    }\n    // Delete any mats from a previous showing.\n    for (let j = 0; j < this.mats_.length; j++) {\n      const rect = this.mats_[j];\n      if (rect) {\n        Tooltip.unbindMouseEvents(rect);\n        dom.removeNode(rect);\n      }\n    }\n    this.mats_.length = 0;\n    // Delete any buttons from a previous showing.\n    for (let i = 0, button; button = this.buttons_[i]; i++) {\n      button.dispose();\n    }\n    this.buttons_.length = 0;\n\n    // Clear potential variables from the previous showing.\n    this.workspace_.getPotentialVariableMap()?.clear();\n  }\n\n  /**\n   * Empties all of the recycled blocks, properly disposing of them.\n   */\n  private emptyRecycledBlocks_() {\n    for (let i = 0; i < this.recycledBlocks_.length; i++) {\n      this.recycledBlocks_[i].dispose();\n    }\n    this.recycledBlocks_ = [];\n  }\n\n  /**\n   * Returns whether the given block can be recycled or not.\n   *\n   * @param _block The block to check for recyclability.\n   * @returns True if the block can be recycled. False otherwise.\n   */\n  protected blockIsRecyclable_(_block: BlockSvg): boolean {\n    // By default, recycling is disabled.\n    return false;\n  }\n\n  /**\n   * Puts a previously created block into the recycle bin and moves it to the\n   * top of the workspace. Used during large workspace swaps to limit the number\n   * of new DOM elements we need to create.\n   *\n   * @param block The block to recycle.\n   */\n  private recycleBlock_(block: BlockSvg) {\n    const xy = block.getRelativeToSurfaceXY();\n    block.moveBy(-xy.x, -xy.y);\n    this.recycledBlocks_.push(block);\n  }\n\n  /**\n   * Add listeners to a block that has been added to the flyout.\n   *\n   * @param root The root node of the SVG group the block is in.\n   * @param block The block to add listeners for.\n   * @param rect The invisible rectangle under the block that acts\n   *     as a mat for that block.\n   */\n  protected addBlockListeners_(\n      root: SVGElement, block: BlockSvg, rect: SVGElement) {\n    this.listeners_.push(browserEvents.conditionalBind(\n        root, 'pointerdown', null, this.blockMouseDown_(block)));\n    this.listeners_.push(browserEvents.conditionalBind(\n        rect, 'pointerdown', null, this.blockMouseDown_(block)));\n    this.listeners_.push(\n        browserEvents.bind(root, 'pointerenter', block, block.addSelect));\n    this.listeners_.push(\n        browserEvents.bind(root, 'pointerleave', block, block.removeSelect));\n    this.listeners_.push(\n        browserEvents.bind(rect, 'pointerenter', block, block.addSelect));\n    this.listeners_.push(\n        browserEvents.bind(rect, 'pointerleave', block, block.removeSelect));\n  }\n\n  /**\n   * Handle a pointerdown on an SVG block in a non-closing flyout.\n   *\n   * @param block The flyout block to copy.\n   * @returns Function to call when block is clicked.\n   */\n  private blockMouseDown_(block: BlockSvg): Function {\n    return (e: PointerEvent) => {\n      const gesture = this.targetWorkspace.getGesture(e);\n      if (gesture) {\n        gesture.setStartBlock(block);\n        gesture.handleFlyoutStart(e, this);\n      }\n    };\n  }\n\n  /**\n   * Pointer down on the flyout background.  Start a vertical scroll drag.\n   *\n   * @param e Pointer down event.\n   */\n  private onMouseDown_(e: PointerEvent) {\n    const gesture = this.targetWorkspace.getGesture(e);\n    if (gesture) {\n      gesture.handleFlyoutStart(e, this);\n    }\n  }\n\n  /**\n   * Does this flyout allow you to create a new instance of the given block?\n   * Used for deciding if a block can be \"dragged out of\" the flyout.\n   *\n   * @param block The block to copy from the flyout.\n   * @returns True if you can create a new instance of the block, false\n   *    otherwise.\n   * @internal\n   */\n  isBlockCreatable(block: BlockSvg): boolean {\n    return block.isEnabled();\n  }\n\n  /**\n   * Create a copy of this block on the workspace.\n   *\n   * @param originalBlock The block to copy from the flyout.\n   * @returns The newly created block.\n   * @throws {Error} if something went wrong with deserialization.\n   * @internal\n   */\n  createBlock(originalBlock: BlockSvg): BlockSvg {\n    let newBlock = null;\n    eventUtils.disable();\n    const variablesBeforeCreation = this.targetWorkspace.getAllVariables();\n    this.targetWorkspace.setResizesEnabled(false);\n    try {\n      newBlock = this.placeNewBlock_(originalBlock);\n    } finally {\n      eventUtils.enable();\n    }\n\n    // Close the flyout.\n    this.targetWorkspace.hideChaff();\n\n    const newVariables = Variables.getAddedVariables(\n        this.targetWorkspace, variablesBeforeCreation);\n\n    if (eventUtils.isEnabled()) {\n      eventUtils.setGroup(true);\n      // Fire a VarCreate event for each (if any) new variable created.\n      for (let i = 0; i < newVariables.length; i++) {\n        const thisVariable = newVariables[i];\n        eventUtils.fire(\n            new (eventUtils.get(eventUtils.VAR_CREATE))(thisVariable));\n      }\n\n      // Block events come after var events, in case they refer to newly created\n      // variables.\n      eventUtils.fire(new (eventUtils.get(eventUtils.BLOCK_CREATE))(newBlock));\n    }\n    if (this.autoClose) {\n      this.hide();\n    } else {\n      this.filterForCapacity_();\n    }\n    return newBlock;\n  }\n\n  /**\n   * Initialize the given button: move it to the correct location,\n   * add listeners, etc.\n   *\n   * @param button The button to initialize and place.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   */\n  protected initFlyoutButton_(button: FlyoutButton, x: number, y: number) {\n    const buttonSvg = button.createDom();\n    button.moveTo(x, y);\n    button.show();\n    // Clicking on a flyout button or label is a lot like clicking on the\n    // flyout background.\n    this.listeners_.push(browserEvents.conditionalBind(\n        buttonSvg, 'pointerdown', this, this.onMouseDown_));\n\n    this.buttons_.push(button);\n  }\n\n  /**\n   * Create and place a rectangle corresponding to the given block.\n   *\n   * @param block The block to associate the rect to.\n   * @param x The x position of the cursor during this layout pass.\n   * @param y The y position of the cursor during this layout pass.\n   * @param blockHW The height and width of\n   *     the block.\n   * @param index The index into the mats list where this rect should\n   *     be placed.\n   * @returns Newly created SVG element for the rectangle behind\n   *     the block.\n   */\n  protected createRect_(\n      block: BlockSvg, x: number, y: number,\n      blockHW: {height: number, width: number}, index: number): SVGElement {\n    // Create an invisible rectangle under the block to act as a button.  Just\n    // using the block as a button is poor, since blocks have holes in them.\n    const rect = dom.createSvgElement(Svg.RECT, {\n      'fill-opacity': 0,\n      'x': x,\n      'y': y,\n      'height': blockHW.height,\n      'width': blockHW.width,\n    });\n    (rect as AnyDuringMigration).tooltip = block;\n    Tooltip.bindMouseEvents(rect);\n    // Add the rectangles under the blocks, so that the blocks' tooltips work.\n    this.workspace_.getCanvas().insertBefore(rect, block.getSvgRoot());\n\n    this.rectMap_.set(block, rect);\n    this.mats_[index] = rect;\n    return rect;\n  }\n\n  /**\n   * Move a rectangle to sit exactly behind a block, taking into account tabs,\n   * hats, and any other protrusions we invent.\n   *\n   * @param rect The rectangle to move directly behind the block.\n   * @param block The block the rectangle should be behind.\n   */\n  protected moveRectToBlock_(rect: SVGElement, block: BlockSvg) {\n    const blockHW = block.getHeightWidth();\n    rect.setAttribute('width', String(blockHW.width));\n    rect.setAttribute('height', String(blockHW.height));\n\n    const blockXY = block.getRelativeToSurfaceXY();\n    rect.setAttribute('y', String(blockXY.y));\n    rect.setAttribute(\n        'x', String(this.RTL ? blockXY.x - blockHW.width : blockXY.x));\n  }\n\n  /**\n   * Filter the blocks on the flyout to disable the ones that are above the\n   * capacity limit.  For instance, if the user may only place two more blocks\n   * on the workspace, an \"a + b\" block that has two shadow blocks would be\n   * disabled.\n   */\n  private filterForCapacity_() {\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      if (this.permanentlyDisabled_.indexOf(block) === -1) {\n        const enable = this.targetWorkspace.isCapacityAvailable(\n            common.getBlockTypeCounts(block));\n        while (block) {\n          block.setEnabled(enable);\n          block = block.getNextBlock();\n        }\n      }\n    }\n  }\n\n  /**\n   * Reflow blocks and their mats.\n   */\n  reflow() {\n    if (this.reflowWrapper_) {\n      this.workspace_.removeChangeListener(this.reflowWrapper_);\n    }\n    this.reflowInternal_();\n    if (this.reflowWrapper_) {\n      this.workspace_.addChangeListener(this.reflowWrapper_);\n    }\n  }\n\n  /**\n   * @returns True if this flyout may be scrolled with a scrollbar or\n   *     by dragging.\n   * @internal\n   */\n  isScrollable(): boolean {\n    return this.workspace_.scrollbar ? this.workspace_.scrollbar.isVisible() :\n                                       false;\n  }\n\n  /**\n   * Copy a block from the flyout to the workspace and position it correctly.\n   *\n   * @param oldBlock The flyout block to copy.\n   * @returns The new block in the main workspace.\n   */\n  private placeNewBlock_(oldBlock: BlockSvg): BlockSvg {\n    const targetWorkspace = this.targetWorkspace;\n    const svgRootOld = oldBlock.getSvgRoot();\n    if (!svgRootOld) {\n      throw Error('oldBlock is not rendered.');\n    }\n\n    // Clone the block.\n    const json = (blocks.save(oldBlock) as blocks.State);\n    // Normallly this resizes leading to weird jumps. Save it for terminateDrag.\n    targetWorkspace.setResizesEnabled(false);\n    const block = (blocks.append(json, targetWorkspace) as BlockSvg);\n\n    this.positionNewBlock_(oldBlock, block);\n\n    return block;\n  }\n\n  /**\n   * Positions a block on the target workspace.\n   *\n   * @param oldBlock The flyout block being copied.\n   * @param block The block to posiiton.\n   */\n  private positionNewBlock_(oldBlock: BlockSvg, block: BlockSvg) {\n    const targetWorkspace = this.targetWorkspace;\n\n    // The offset in pixels between the main workspace's origin and the upper\n    // left corner of the injection div.\n    const mainOffsetPixels = targetWorkspace.getOriginOffsetInPixels();\n\n    // The offset in pixels between the flyout workspace's origin and the upper\n    // left corner of the injection div.\n    const flyoutOffsetPixels = this.workspace_.getOriginOffsetInPixels();\n\n    // The position of the old block in flyout workspace coordinates.\n    const oldBlockPos = oldBlock.getRelativeToSurfaceXY();\n    // The position of the old block in pixels relative to the flyout\n    // workspace's origin.\n    oldBlockPos.scale(this.workspace_.scale);\n\n    // The position of the old block in pixels relative to the upper left corner\n    // of the injection div.\n    const oldBlockOffsetPixels =\n        Coordinate.sum(flyoutOffsetPixels, oldBlockPos);\n\n    // The position of the old block in pixels relative to the origin of the\n    // main workspace.\n    const finalOffset =\n        Coordinate.difference(oldBlockOffsetPixels, mainOffsetPixels);\n    // The position of the old block in main workspace coordinates.\n    finalOffset.scale(1 / targetWorkspace.scale);\n\n    block.moveTo(new Coordinate(finalOffset.x, finalOffset.y));\n  }\n}\n\n/**\n * A flyout content item.\n */\nexport interface FlyoutItem {\n  type: FlyoutItemType;\n  button?: FlyoutButton|undefined;\n  block?: BlockSvg|undefined;\n}\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Horizontal flyout tray containing blocks which may be created.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.HorizontalFlyout');\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n\n/**\n * Class for a flyout.\n */\nexport class HorizontalFlyout extends Flyout {\n  override horizontalLayout = true;\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number, y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.x === 'number') {\n      this.workspace_.scrollX =\n          -(scrollMetrics.left +\n            (scrollMetrics.width - viewMetrics.width) * xyRatio.x);\n    }\n\n    this.workspace_.translate(\n        this.workspace_.scrollX + absoluteMetrics.left,\n        this.workspace_.scrollY + absoluteMetrics.top);\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    // X is always 0 since this is a horizontal flyout.\n    return 0;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n\n    let y = 0;\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (atTop) {\n          y = toolboxMetrics.height;\n        } else {\n          y = viewMetrics.height - this.height_;\n        }\n      } else {\n        if (atTop) {\n          y = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          y = viewMetrics.height;\n        }\n      }\n    } else {\n      if (atTop) {\n        y = 0;\n      } else {\n        // Because the anchor point of the flyout is on the top, but we want\n        // to align the bottom edge of the flyout with the bottom edge of the\n        // blocklyDiv, we calculate the full height of the div minus the height\n        // of the flyout.\n        y = viewMetrics.height + absoluteMetrics.top - this.height_;\n      }\n    }\n\n    return y;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.width_ = targetWorkspaceViewMetrics.width;\n\n    const edgeWidth = targetWorkspaceViewMetrics.width - 2 * this.CORNER_RADIUS;\n    const edgeHeight = this.height_ - this.CORNER_RADIUS;\n    this.setBackgroundPath_(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath_(width: number, height: number) {\n    const atTop = this.toolboxPosition_ === toolbox.Position.TOP;\n    // Start at top left.\n    const path: (string|number)[] = ['M 0,' + (atTop ? 0 : this.CORNER_RADIUS)];\n\n    if (atTop) {\n      // Top.\n      path.push('h', width + 2 * this.CORNER_RADIUS);\n      // Right.\n      path.push('v', height);\n      // Bottom.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          -this.CORNER_RADIUS, this.CORNER_RADIUS);\n      path.push('h', -width);\n      // Left.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          -this.CORNER_RADIUS, -this.CORNER_RADIUS);\n      path.push('z');\n    } else {\n      // Top.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          this.CORNER_RADIUS, -this.CORNER_RADIUS);\n      path.push('h', width);\n      // Right.\n      path.push(\n          'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, 1,\n          this.CORNER_RADIUS, this.CORNER_RADIUS);\n      path.push('v', height);\n      // Bottom.\n      path.push('h', -width - 2 * this.CORNER_RADIUS);\n      // Left.\n      path.push('z');\n    }\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setX(this.RTL ? Infinity : 0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n    const delta = scrollDelta.x || scrollDelta.y;\n\n    if (delta) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n\n      const pos = viewMetrics.left - scrollMetrics.left + delta;\n      this.workspace_.scrollbar?.setX(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    let cursorX = margin + this.tabWidth_;\n    const cursorY = margin;\n    if (this.RTL) {\n      contents = contents.reverse();\n    }\n\n    for (let i = 0, item; item = contents[i]; i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        const allBlocks = block!.getDescendants(false);\n        for (let j = 0, child; child = allBlocks[j]; j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        block!.render();\n        const root = block!.getSvgRoot();\n        const blockHW = block!.getHeightWidth();\n        // Figure out where to place the block.\n        const tab = block!.outputConnection ? this.tabWidth_ : 0;\n        let moveX;\n        if (this.RTL) {\n          moveX = cursorX + blockHW.width;\n        } else {\n          moveX = cursorX - tab;\n        }\n        block!.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(block!, moveX, cursorY, blockHW, i);\n        cursorX += blockHW.width + gaps[i];\n\n        this.addBlockListeners_(root, block!, rect);\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorX += button.width + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   * @internal\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = Math.atan2(dy, dx) / Math.PI * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for up or down dragging.\n    if (dragDirection < 90 + range && dragDirection > 90 - range ||\n        dragDirection > -90 - range && dragDirection < -90 + range) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const top = flyoutRect.top;\n\n    if (this.toolboxPosition_ === toolbox.Position.TOP) {\n      const height = flyoutRect.height;\n      return new Rect(-BIG_NUM, top + height, -BIG_NUM, BIG_NUM);\n    } else {  // Bottom.\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute height of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutHeight = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      flyoutHeight = Math.max(flyoutHeight, block.getHeightWidth().height);\n    }\n    const buttons = this.buttons_;\n    for (let i = 0, button; button = buttons[i]; i++) {\n      flyoutHeight = Math.max(flyoutHeight, button.height);\n    }\n    flyoutHeight += this.MARGIN * 1.5;\n    flyoutHeight *= this.workspace_.scale;\n    flyoutHeight += Scrollbar.scrollbarThickness;\n\n    if (this.height_ !== flyoutHeight) {\n      for (let i = 0, block; block = blocks[i]; i++) {\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n\n      if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_ &&\n          this.toolboxPosition_ === toolbox.Position.TOP &&\n          !this.targetWorkspace!.getToolbox()) {\n        // This flyout is a simple toolbox. Reposition the workspace so that\n        // (0,0) is in the correct position relative to the new absolute edge\n        // (ie toolbox edge).\n        this.targetWorkspace!.translate(\n            this.targetWorkspace!.scrollX,\n            this.targetWorkspace!.scrollY + flyoutHeight);\n      }\n      this.height_ = flyoutHeight;\n      this.position();\n      this.targetWorkspace!.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n    registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, registry.DEFAULT,\n    HorizontalFlyout);\n", "/**\n * @license\n * Copyright 2017 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Layout code for a vertical variant of the flyout.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.VerticalFlyout');\n\nimport * as browserEvents from './browser_events.js';\nimport * as dropDownDiv from './dropdowndiv.js';\nimport {Flyout, FlyoutItem} from './flyout_base.js';\nimport type {FlyoutButton} from './flyout_button.js';\nimport type {Options} from './options.js';\nimport * as registry from './registry.js';\nimport {Scrollbar} from './scrollbar.js';\nimport type {Coordinate} from './utils/coordinate.js';\nimport {Rect} from './utils/rect.js';\nimport * as toolbox from './utils/toolbox.js';\nimport * as WidgetDiv from './widgetdiv.js';\n\n\n/**\n * Class for a flyout.\n */\nexport class VerticalFlyout extends Flyout {\n  /** The name of the vertical flyout in the registry. */\n  static registryName = 'verticalFlyout';\n\n  /** @param workspaceOptions Dictionary of options for the workspace. */\n  constructor(workspaceOptions: Options) {\n    super(workspaceOptions);\n  }\n\n  /**\n   * Sets the translation of the flyout to match the scrollbars.\n   *\n   * @param xyRatio Contains a y property which is a float between 0 and 1\n   *     specifying the degree of scrolling and a similar x property.\n   */\n  protected override setMetrics_(xyRatio: {x: number, y: number}) {\n    if (!this.isVisible()) {\n      return;\n    }\n    const metricsManager = this.workspace_.getMetricsManager();\n    const scrollMetrics = metricsManager.getScrollMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n\n    if (typeof xyRatio.y === 'number') {\n      this.workspace_.scrollY =\n          -(scrollMetrics.top +\n            (scrollMetrics.height - viewMetrics.height) * xyRatio.y);\n    }\n    this.workspace_.translate(\n        this.workspace_.scrollX + absoluteMetrics.left,\n        this.workspace_.scrollY + absoluteMetrics.top);\n  }\n\n  /**\n   * Calculates the x coordinate for the flyout position.\n   *\n   * @returns X coordinate.\n   */\n  override getX(): number {\n    if (!this.isVisible()) {\n      return 0;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const absoluteMetrics = metricsManager.getAbsoluteMetrics();\n    const viewMetrics = metricsManager.getViewMetrics();\n    const toolboxMetrics = metricsManager.getToolboxMetrics();\n    let x = 0;\n\n    // If this flyout is not the trashcan flyout (e.g. toolbox or mutator).\n    // Trashcan flyout is opposite the main flyout.\n    if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_) {\n      // If there is a category toolbox.\n      // Simple (flyout-only) toolbox.\n      if (this.targetWorkspace!.getToolbox()) {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = toolboxMetrics.width;\n        } else {\n          x = viewMetrics.width - this.width_;\n        }\n      } else {\n        if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n          x = 0;\n        } else {\n          // The simple flyout does not cover the workspace.\n          x = viewMetrics.width;\n        }\n      }\n    } else {\n      if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n        x = 0;\n      } else {\n        // Because the anchor point of the flyout is on the left, but we want\n        // to align the right edge of the flyout with the right edge of the\n        // blocklyDiv, we calculate the full width of the div minus the width\n        // of the flyout.\n        x = viewMetrics.width + absoluteMetrics.left - this.width_;\n      }\n    }\n\n    return x;\n  }\n\n  /**\n   * Calculates the y coordinate for the flyout position.\n   *\n   * @returns Y coordinate.\n   */\n  override getY(): number {\n    // Y is always 0 since this is a vertical flyout.\n    return 0;\n  }\n\n  /** Move the flyout to the edge of the workspace. */\n  override position() {\n    if (!this.isVisible() || !this.targetWorkspace!.isVisible()) {\n      return;\n    }\n    const metricsManager = this.targetWorkspace!.getMetricsManager();\n    const targetWorkspaceViewMetrics = metricsManager.getViewMetrics();\n    this.height_ = targetWorkspaceViewMetrics.height;\n\n    const edgeWidth = this.width_ - this.CORNER_RADIUS;\n    const edgeHeight =\n        targetWorkspaceViewMetrics.height - 2 * this.CORNER_RADIUS;\n    this.setBackgroundPath_(edgeWidth, edgeHeight);\n\n    const x = this.getX();\n    const y = this.getY();\n\n    this.positionAt_(this.width_, this.height_, x, y);\n  }\n\n  /**\n   * Create and set the path for the visible boundaries of the flyout.\n   *\n   * @param width The width of the flyout, not including the rounded corners.\n   * @param height The height of the flyout, not including rounded corners.\n   */\n  private setBackgroundPath_(width: number, height: number) {\n    const atRight = this.toolboxPosition_ === toolbox.Position.RIGHT;\n    const totalWidth = width + this.CORNER_RADIUS;\n\n    // Decide whether to start on the left or right.\n    const path: Array<string|number> =\n        ['M ' + (atRight ? totalWidth : 0) + ',0'];\n    // Top.\n    path.push('h', (atRight ? -width : width));\n    // Rounded corner.\n    path.push(\n        'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, atRight ? 0 : 1,\n        atRight ? -this.CORNER_RADIUS : this.CORNER_RADIUS, this.CORNER_RADIUS);\n    // Side closest to workspace.\n    path.push('v', Math.max(0, height));\n    // Rounded corner.\n    path.push(\n        'a', this.CORNER_RADIUS, this.CORNER_RADIUS, 0, 0, atRight ? 0 : 1,\n        atRight ? this.CORNER_RADIUS : -this.CORNER_RADIUS, this.CORNER_RADIUS);\n    // Bottom.\n    path.push('h', (atRight ? width : -width));\n    path.push('z');\n    this.svgBackground_!.setAttribute('d', path.join(' '));\n  }\n\n  /** Scroll the flyout to the top. */\n  override scrollToStart() {\n    this.workspace_.scrollbar?.setY(0);\n  }\n\n  /**\n   * Scroll the flyout.\n   *\n   * @param e Mouse wheel scroll event.\n   */\n  protected override wheel_(e: WheelEvent) {\n    const scrollDelta = browserEvents.getScrollDeltaPixels(e);\n\n    if (scrollDelta.y) {\n      const metricsManager = this.workspace_.getMetricsManager();\n      const scrollMetrics = metricsManager.getScrollMetrics();\n      const viewMetrics = metricsManager.getViewMetrics();\n      const pos = viewMetrics.top - scrollMetrics.top + scrollDelta.y;\n\n      this.workspace_.scrollbar?.setY(pos);\n      // When the flyout moves from a wheel event, hide WidgetDiv and\n      // dropDownDiv.\n      WidgetDiv.hide();\n      dropDownDiv.hideWithoutAnimation();\n    }\n    // Don't scroll the page.\n    e.preventDefault();\n    // Don't propagate mousewheel event (zooming).\n    e.stopPropagation();\n  }\n\n  /**\n   * Lay out the blocks in the flyout.\n   *\n   * @param contents The blocks and buttons to lay out.\n   * @param gaps The visible gaps between blocks.\n   */\n  protected override layout_(contents: FlyoutItem[], gaps: number[]) {\n    this.workspace_.scale = this.targetWorkspace!.scale;\n    const margin = this.MARGIN;\n    const cursorX = this.RTL ? margin : margin + this.tabWidth_;\n    let cursorY = margin;\n\n    for (let i = 0, item; item = contents[i]; i++) {\n      if (item.type === 'block') {\n        const block = item.block;\n        const allBlocks = block!.getDescendants(false);\n        for (let j = 0, child; child = allBlocks[j]; j++) {\n          // Mark blocks as being inside a flyout.  This is used to detect and\n          // prevent the closure of the flyout if the user right-clicks on such\n          // a block.\n          child.isInFlyout = true;\n        }\n        block!.render();\n        const root = block!.getSvgRoot();\n        const blockHW = block!.getHeightWidth();\n        const moveX =\n            block!.outputConnection ? cursorX - this.tabWidth_ : cursorX;\n        block!.moveBy(moveX, cursorY);\n\n        const rect = this.createRect_(\n            block!, this.RTL ? moveX - blockHW.width : moveX, cursorY, blockHW,\n            i);\n\n        this.addBlockListeners_(root, block!, rect);\n\n        cursorY += blockHW.height + gaps[i];\n      } else if (item.type === 'button') {\n        const button = item.button as FlyoutButton;\n        this.initFlyoutButton_(button, cursorX, cursorY);\n        cursorY += button.height + gaps[i];\n      }\n    }\n  }\n\n  /**\n   * Determine if a drag delta is toward the workspace, based on the position\n   * and orientation of the flyout. This is used in determineDragIntention_ to\n   * determine if a new block should be created or if the flyout should scroll.\n   *\n   * @param currentDragDeltaXY How far the pointer has moved from the position\n   *     at mouse down, in pixel units.\n   * @returns True if the drag is toward the workspace.\n   * @internal\n   */\n  override isDragTowardWorkspace(currentDragDeltaXY: Coordinate): boolean {\n    const dx = currentDragDeltaXY.x;\n    const dy = currentDragDeltaXY.y;\n    // Direction goes from -180 to 180, with 0 toward the right and 90 on top.\n    const dragDirection = Math.atan2(dy, dx) / Math.PI * 180;\n\n    const range = this.dragAngleRange_;\n    // Check for left or right dragging.\n    if (dragDirection < range && dragDirection > -range ||\n        (dragDirection < -180 + range || dragDirection > 180 - range)) {\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.svgGroup_ || this.autoClose || !this.isVisible()) {\n      // The bounding rectangle won't compute correctly if the flyout is closed\n      // and auto-close flyouts aren't valid drag targets (or delete areas).\n      return null;\n    }\n\n    const flyoutRect = this.svgGroup_.getBoundingClientRect();\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the shown\n    // flyout area are still deleted.  Must be larger than the largest screen\n    // size, but be smaller than half Number.MAX_SAFE_INTEGER (not available on\n    // IE).\n    const BIG_NUM = 1000000000;\n    const left = flyoutRect.left;\n\n    if (this.toolboxPosition_ === toolbox.Position.LEFT) {\n      const width = flyoutRect.width;\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, left + width);\n    } else {  // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Compute width of flyout.  toolbox.Position mat under each block.\n   * For RTL: Lay out the blocks and buttons to be right-aligned.\n   */\n  protected override reflowInternal_() {\n    this.workspace_.scale = this.getFlyoutScale();\n    let flyoutWidth = 0;\n    const blocks = this.workspace_.getTopBlocks(false);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      let width = block.getHeightWidth().width;\n      if (block.outputConnection) {\n        width -= this.tabWidth_;\n      }\n      flyoutWidth = Math.max(flyoutWidth, width);\n    }\n    for (let i = 0, button; button = this.buttons_[i]; i++) {\n      flyoutWidth = Math.max(flyoutWidth, button.width);\n    }\n    flyoutWidth += this.MARGIN * 1.5 + this.tabWidth_;\n    flyoutWidth *= this.workspace_.scale;\n    flyoutWidth += Scrollbar.scrollbarThickness;\n\n    if (this.width_ !== flyoutWidth) {\n      for (let i = 0, block; block = blocks[i]; i++) {\n        if (this.RTL) {\n          // With the flyoutWidth known, right-align the blocks.\n          const oldX = block.getRelativeToSurfaceXY().x;\n          let newX = flyoutWidth / this.workspace_.scale - this.MARGIN;\n          if (!block.outputConnection) {\n            newX -= this.tabWidth_;\n          }\n          block.moveBy(newX - oldX, 0);\n        }\n        if (this.rectMap_.has(block)) {\n          this.moveRectToBlock_(this.rectMap_.get(block)!, block);\n        }\n      }\n      if (this.RTL) {\n        // With the flyoutWidth known, right-align the buttons.\n        for (let i = 0, button; button = this.buttons_[i]; i++) {\n          const y = button.getPosition().y;\n          const x = flyoutWidth / this.workspace_.scale - button.width -\n              this.MARGIN - this.tabWidth_;\n          button.moveTo(x, y);\n        }\n      }\n\n      if (this.targetWorkspace!.toolboxPosition === this.toolboxPosition_ &&\n          this.toolboxPosition_ === toolbox.Position.LEFT &&\n          !this.targetWorkspace!.getToolbox()) {\n        // This flyout is a simple toolbox. Reposition the workspace so that\n        // (0,0) is in the correct position relative to the new absolute edge\n        // (ie toolbox edge).\n        this.targetWorkspace!.translate(\n            this.targetWorkspace!.scrollX + flyoutWidth,\n            this.targetWorkspace!.scrollY);\n      }\n      this.width_ = flyoutWidth;\n      this.position();\n      this.targetWorkspace!.recordDragTargets();\n    }\n  }\n}\n\nregistry.register(\n    registry.Type.FLYOUTS_VERTICAL_TOOLBOX, registry.DEFAULT, VerticalFlyout);\n", "/**\n * @license\n * Copyright 2012 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Utility functions for generating executable code from\n * Blockly code.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.CodeGenerator');\n\nimport type {Block} from './block.js';\nimport * as common from './common.js';\nimport {Names, NameType} from './names.js';\nimport * as deprecation from './utils/deprecation.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for a code generator that translates the blocks into a language.\n *\n * @unrestricted\n */\nexport class CodeGenerator {\n  name_: string;\n\n  /**\n   * This is used as a placeholder in functions defined using\n   * CodeGenerator.provideFunction_.  It must not be legal code that could\n   * legitimately appear in a function definition (or comment), and it must\n   * not confuse the regular expression parser.\n   */\n  protected FUNCTION_NAME_PLACEHOLDER_ = '{leCUI8hutHZI4480Dc}';\n  FUNCTION_NAME_PLACEHOLDER_REGEXP_: RegExp;\n\n  /**\n   * Arbitrary code to inject into locations that risk causing infinite loops.\n   * Any instances of '%1' will be replaced by the block ID that failed.\n   * E.g. `  checkTimeout(%1);\\n`\n   */\n  INFINITE_LOOP_TRAP: string|null = null;\n\n  /**\n   * Arbitrary code to inject before every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_PREFIX: string|null = null;\n\n  /**\n   * Arbitrary code to inject after every statement.\n   * Any instances of '%1' will be replaced by the block ID of the statement.\n   * E.g. `highlight(%1);\\n`\n   */\n  STATEMENT_SUFFIX: string|null = null;\n\n  /**\n   * The method of indenting.  Defaults to two spaces, but language generators\n   * may override this to increase indent or change to tabs.\n   */\n  INDENT = '  ';\n\n  /**\n   * Maximum length for a comment before wrapping.  Does not account for\n   * indenting level.\n   */\n  COMMENT_WRAP = 60;\n\n  /** List of outer-inner pairings that do NOT require parentheses. */\n  ORDER_OVERRIDES: number[][] = [];\n\n  /**\n   * Whether the init method has been called.\n   * Generators that set this flag to false after creation and true in init\n   * will cause blockToCode to emit a warning if the generator has not been\n   * initialized. If this flag is untouched, it will have no effect.\n   */\n  isInitialized: boolean|null = null;\n\n  /** Comma-separated list of reserved words. */\n  protected RESERVED_WORDS_ = '';\n\n  /** A dictionary of definitions to be printed before the code. */\n  protected definitions_: {[key: string]: string} = Object.create(null);\n\n  /**\n   * A dictionary mapping desired function names in definitions_ to actual\n   * function names (to avoid collisions with user functions).\n   */\n  protected functionNames_: {[key: string]: string} = Object.create(null);\n\n  /** A database of variable and procedure names. */\n  protected nameDB_?: Names = undefined;\n\n  /** @param name Language name of this generator. */\n  constructor(name: string) {\n    this.name_ = name;\n\n    this.FUNCTION_NAME_PLACEHOLDER_REGEXP_ =\n        new RegExp(this.FUNCTION_NAME_PLACEHOLDER_, 'g');\n  }\n\n  /**\n   * Generate code for all blocks in the workspace to the specified language.\n   *\n   * @param workspace Workspace to generate code from.\n   * @returns Generated code.\n   */\n  workspaceToCode(workspace?: Workspace): string {\n    if (!workspace) {\n      // Backwards compatibility from before there could be multiple workspaces.\n      console.warn(\n          'No workspace specified in workspaceToCode call.  Guessing.');\n      workspace = common.getMainWorkspace();\n    }\n    const code = [];\n    this.init(workspace);\n    const blocks = workspace.getTopBlocks(true);\n    for (let i = 0, block; block = blocks[i]; i++) {\n      let line = this.blockToCode(block);\n      if (Array.isArray(line)) {\n        // Value blocks return tuples of code and operator order.\n        // Top-level blocks don't care about operator order.\n        line = line[0];\n      }\n      if (line) {\n        if (block.outputConnection) {\n          // This block is a naked value.  Ask the language's code generator if\n          // it wants to append a semicolon, or something.\n          line = this.scrubNakedValue(line);\n          if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n            line = this.injectId(this.STATEMENT_PREFIX, block) + line;\n          }\n          if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n            line = line + this.injectId(this.STATEMENT_SUFFIX, block);\n          }\n        }\n        code.push(line);\n      }\n    }\n    // Blank line between each section.\n    let codeString = code.join('\\n');\n    codeString = this.finish(codeString);\n    // Final scrubbing of whitespace.\n    codeString = codeString.replace(/^\\s+\\n/, '');\n    codeString = codeString.replace(/\\n\\s+$/, '\\n');\n    codeString = codeString.replace(/[ \\t]+\\n/g, '\\n');\n    return codeString;\n  }\n\n  // The following are some helpful functions which can be used by multiple\n\n  // languages.\n\n  /**\n   * Prepend a common prefix onto each line of code.\n   * Intended for indenting code or adding comment markers.\n   *\n   * @param text The lines of code.\n   * @param prefix The common prefix.\n   * @returns The prefixed lines of code.\n   */\n  prefixLines(text: string, prefix: string): string {\n    return prefix + text.replace(/(?!\\n$)\\n/g, '\\n' + prefix);\n  }\n\n  /**\n   * Recursively spider a tree of blocks, returning all their comments.\n   *\n   * @param block The block from which to start spidering.\n   * @returns Concatenated list of comments.\n   */\n  allNestedComments(block: Block): string {\n    const comments = [];\n    const blocks = block.getDescendants(true);\n    for (let i = 0; i < blocks.length; i++) {\n      const comment = blocks[i].getCommentText();\n      if (comment) {\n        comments.push(comment);\n      }\n    }\n    // Append an empty string to create a trailing line break when joined.\n    if (comments.length) {\n      comments.push('');\n    }\n    return comments.join('\\n');\n  }\n\n  /**\n   * Generate code for the specified block (and attached blocks).\n   * The generator must be initialized before calling this function.\n   *\n   * @param block The block to generate code for.\n   * @param opt_thisOnly True to generate code for only this statement.\n   * @returns For statement blocks, the generated code.\n   *     For value blocks, an array containing the generated code and an\n   * operator order value.  Returns '' if block is null.\n   */\n  blockToCode(block: Block|null, opt_thisOnly?: boolean): string\n      |[string, number] {\n    if (this.isInitialized === false) {\n      console.warn(\n          'CodeGenerator init was not called before blockToCode was called.');\n    }\n    if (!block) {\n      return '';\n    }\n    if (!block.isEnabled()) {\n      // Skip past this block if it is disabled.\n      return opt_thisOnly ? '' : this.blockToCode(block.getNextBlock());\n    }\n    if (block.isInsertionMarker()) {\n      // Skip past insertion markers.\n      return opt_thisOnly ? '' : this.blockToCode(block.getChildren(false)[0]);\n    }\n\n    const func = (this as any)[block.type];\n    if (typeof func !== 'function') {\n      throw Error(\n          'Language \"' + this.name_ + '\" does not know how to generate ' +\n          'code for block type \"' + block.type + '\".');\n    }\n    // First argument to func.call is the value of 'this' in the generator.\n    // Prior to 24 September 2013 'this' was the only way to access the block.\n    // The current preferred method of accessing the block is through the second\n    // argument to func.call, which becomes the first parameter to the\n    // generator.\n    let code = func.call(block, block);\n    if (Array.isArray(code)) {\n      // Value blocks return tuples of code and operator order.\n      if (!block.outputConnection) {\n        throw TypeError('Expecting string from statement block: ' + block.type);\n      }\n      return [this.scrub_(block, code[0], opt_thisOnly), code[1]];\n    } else if (typeof code === 'string') {\n      if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n        code = this.injectId(this.STATEMENT_PREFIX, block) + code;\n      }\n      if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n        code = code + this.injectId(this.STATEMENT_SUFFIX, block);\n      }\n      return this.scrub_(block, code, opt_thisOnly);\n    } else if (code === null) {\n      // Block has handled code generation itself.\n      return '';\n    }\n    throw SyntaxError('Invalid code generated: ' + code);\n  }\n\n  /**\n   * Generate code representing the specified value input.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @param outerOrder The maximum binding strength (minimum order value) of any\n   *     operators adjacent to \"block\".\n   * @returns Generated code or '' if no blocks are connected or the specified\n   *     input does not exist.\n   */\n  valueToCode(block: Block, name: string, outerOrder: number): string {\n    if (isNaN(outerOrder)) {\n      throw TypeError('Expecting valid order from block: ' + block.type);\n    }\n    const targetBlock = block.getInputTargetBlock(name);\n    if (!targetBlock) {\n      return '';\n    }\n    const tuple = this.blockToCode(targetBlock);\n    if (tuple === '') {\n      // Disabled block.\n      return '';\n    }\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (!Array.isArray(tuple)) {\n      throw TypeError(\n          `Expecting tuple from value block: ${targetBlock.type} See ` +\n          `developers.google.com/blockly/guides/create-custom-blocks/generating-code ` +\n          `for more information`);\n    }\n    let code = tuple[0];\n    const innerOrder = tuple[1];\n    if (isNaN(innerOrder)) {\n      throw TypeError(\n          'Expecting valid order from value block: ' + targetBlock.type);\n    }\n    if (!code) {\n      return '';\n    }\n\n    // Add parentheses if needed.\n    let parensNeeded = false;\n    const outerOrderClass = Math.floor(outerOrder);\n    const innerOrderClass = Math.floor(innerOrder);\n    if (outerOrderClass <= innerOrderClass) {\n      if (outerOrderClass === innerOrderClass &&\n          (outerOrderClass === 0 || outerOrderClass === 99)) {\n        // Don't generate parens around NONE-NONE and ATOMIC-ATOMIC pairs.\n        // 0 is the atomic order, 99 is the none order.  No parentheses needed.\n        // In all known languages multiple such code blocks are not order\n        // sensitive.  In fact in Python ('a' 'b') 'c' would fail.\n      } else {\n        // The operators outside this code are stronger than the operators\n        // inside this code.  To prevent the code from being pulled apart,\n        // wrap the code in parentheses.\n        parensNeeded = true;\n        // Check for special exceptions.\n        for (let i = 0; i < this.ORDER_OVERRIDES.length; i++) {\n          if (this.ORDER_OVERRIDES[i][0] === outerOrder &&\n              this.ORDER_OVERRIDES[i][1] === innerOrder) {\n            parensNeeded = false;\n            break;\n          }\n        }\n      }\n    }\n    if (parensNeeded) {\n      // Technically, this should be handled on a language-by-language basis.\n      // However all known (sane) languages use parentheses for grouping.\n      code = '(' + code + ')';\n    }\n    return code;\n  }\n\n  /**\n   * Generate a code string representing the blocks attached to the named\n   * statement input. Indent the code.\n   * This is mainly used in generators. When trying to generate code to evaluate\n   * look at using workspaceToCode or blockToCode.\n   *\n   * @param block The block containing the input.\n   * @param name The name of the input.\n   * @returns Generated code or '' if no blocks are connected.\n   */\n  statementToCode(block: Block, name: string): string {\n    const targetBlock = block.getInputTargetBlock(name);\n    let code = this.blockToCode(targetBlock);\n    // Value blocks must return code and order of operations info.\n    // Statement blocks must only return code.\n    if (typeof code !== 'string') {\n      throw TypeError(\n          'Expecting code from statement block: ' +\n          (targetBlock && targetBlock.type));\n    }\n    if (code) {\n      code = this.prefixLines((code), this.INDENT);\n    }\n    return code;\n  }\n\n  /**\n   * Add an infinite loop trap to the contents of a loop.\n   * Add statement suffix at the start of the loop block (right after the loop\n   * statement executes), and a statement prefix to the end of the loop block\n   * (right before the loop statement executes).\n   *\n   * @param branch Code for loop contents.\n   * @param block Enclosing block.\n   * @returns Loop contents, with infinite loop trap added.\n   */\n  addLoopTrap(branch: string, block: Block): string {\n    if (this.INFINITE_LOOP_TRAP) {\n      branch = this.prefixLines(\n                   this.injectId(this.INFINITE_LOOP_TRAP, block), this.INDENT) +\n          branch;\n    }\n    if (this.STATEMENT_SUFFIX && !block.suppressPrefixSuffix) {\n      branch = this.prefixLines(\n                   this.injectId(this.STATEMENT_SUFFIX, block), this.INDENT) +\n          branch;\n    }\n    if (this.STATEMENT_PREFIX && !block.suppressPrefixSuffix) {\n      branch = branch +\n          this.prefixLines(\n              this.injectId(this.STATEMENT_PREFIX, block), this.INDENT);\n    }\n    return branch;\n  }\n\n  /**\n   * Inject a block ID into a message to replace '%1'.\n   * Used for STATEMENT_PREFIX, STATEMENT_SUFFIX, and INFINITE_LOOP_TRAP.\n   *\n   * @param msg Code snippet with '%1'.\n   * @param block Block which has an ID.\n   * @returns Code snippet with ID.\n   */\n  injectId(msg: string, block: Block): string {\n    const id = block.id.replace(/\\$/g, '$$$$');  // Issue 251.\n    return msg.replace(/%1/g, '\\'' + id + '\\'');\n  }\n\n  /**\n   * Add one or more words to the list of reserved words for this language.\n   *\n   * @param words Comma-separated list of words to add to the list.\n   *     No spaces.  Duplicates are ok.\n   */\n  addReservedWords(words: string) {\n    this.RESERVED_WORDS_ += words + ',';\n  }\n\n  /**\n   * Define a developer-defined function (not a user-defined procedure) to be\n   * included in the generated code.  Used for creating private helper\n   * functions. The first time this is called with a given desiredName, the code\n   * is saved and an actual name is generated.  Subsequent calls with the same\n   * desiredName have no effect but have the same return value.\n   *\n   * It is up to the caller to make sure the same desiredName is not\n   * used for different helper functions (e.g. use \"colourRandom\" and\n   * \"listRandom\", not \"random\").  There is no danger of colliding with reserved\n   * words, or user-defined variable or procedure names.\n   *\n   * The code gets output when CodeGenerator.finish() is called.\n   *\n   * @param desiredName The desired name of the function (e.g. mathIsPrime).\n   * @param code A list of statements or one multi-line code string.  Use '  '\n   *     for indents (they will be replaced).\n   * @returns The actual name of the new function.  This may differ from\n   *     desiredName if the former has already been taken by the user.\n   */\n  protected provideFunction_(desiredName: string, code: string[]|string):\n      string {\n    if (!this.definitions_[desiredName]) {\n      const functionName =\n          this.nameDB_!.getDistinctName(desiredName, NameType.PROCEDURE);\n      this.functionNames_[desiredName] = functionName;\n      if (Array.isArray(code)) {\n        code = code.join('\\n');\n      }\n      let codeText = code.trim().replace(\n          this.FUNCTION_NAME_PLACEHOLDER_REGEXP_, functionName);\n      // Change all '  ' indents into the desired indent.\n      // To avoid an infinite loop of replacements, change all indents to '\\0'\n      // character first, then replace them all with the indent.\n      // We are assuming that no provided functions contain a literal null char.\n      let oldCodeText;\n      while (oldCodeText !== codeText) {\n        oldCodeText = codeText;\n        codeText = codeText.replace(/^(( {2})*) {2}/gm, '$1\\0');\n      }\n      codeText = codeText.replace(/\\0/g, this.INDENT);\n      this.definitions_[desiredName] = codeText;\n    }\n    return this.functionNames_[desiredName];\n  }\n\n  /**\n   * Hook for code to run before code generation starts.\n   * Subclasses may override this, e.g. to initialise the database of variable\n   * names.\n   *\n   * @param _workspace Workspace to generate code from.\n   */\n  init(_workspace: Workspace) {\n    // Optionally override\n    // Create a dictionary of definitions to be printed before the code.\n    this.definitions_ = Object.create(null);\n    // Create a dictionary mapping desired developer-defined function names in\n    // definitions_ to actual function names (to avoid collisions with\n    // user-defined procedures).\n    this.functionNames_ = Object.create(null);\n  }\n\n  /**\n   * Common tasks for generating code from blocks.  This is called from\n   * blockToCode and is called on every block, not just top level blocks.\n   * Subclasses may override this, e.g. to generate code for statements\n   * following the block, or to handle comments for the specified block and any\n   * connected value blocks.\n   *\n   * @param _block The current block.\n   * @param code The code created for this block.\n   * @param _opt_thisOnly True to generate code for only this statement.\n   * @returns Code with comments and subsequent blocks added.\n   */\n  protected scrub_(_block: Block, code: string, _opt_thisOnly?: boolean):\n      string {\n    // Optionally override\n    return code;\n  }\n\n  /**\n   * Hook for code to run at end of code generation.\n   * Subclasses may override this, e.g. to prepend the generated code with\n   * import statements or variable definitions.\n   *\n   * @param code Generated code.\n   * @returns Completed code.\n   */\n  finish(code: string): string {\n    // Optionally override\n    // Clean up temporary data.\n    this.definitions_ = Object.create(null);\n    this.functionNames_ = Object.create(null);\n    return code;\n  }\n\n  /**\n   * Naked values are top-level blocks with outputs that aren't plugged into\n   * anything.\n   * Subclasses may override this, e.g. if their language does not allow\n   * naked values.\n   *\n   * @param line Line of generated code.\n   * @returns Legal line of code.\n   */\n  scrubNakedValue(line: string): string {\n    // Optionally override\n    return line;\n  }\n}\n\nObject.defineProperties(CodeGenerator.prototype, {\n  /**\n   * A database of variable names.\n   *\n   * @name Blockly.CodeGenerator.prototype.variableDB_\n   * @deprecated 'variableDB_' was renamed to 'nameDB_' (May 2021).\n   * @suppress {checkTypes}\n   */\n  variableDB_: ({\n    /** @returns Name database. */\n    get(this: CodeGenerator): Names |\n        undefined {\n          deprecation.warn('variableDB_', 'version 9', 'version 10', 'nameDB_');\n          return this.nameDB_;\n        },\n    /** @param nameDb New name database. */\n    set(this: CodeGenerator, nameDb: Names|undefined) {\n      deprecation.warn('variableDB_', 'version 9', 'version 10', 'nameDB_');\n      this.nameDB_ = nameDb;\n    },\n  }),\n});\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * The namespace used to keep track of keyboard shortcuts and the\n * key codes used to execute those shortcuts.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ShortcutRegistry');\n\nimport {KeyCodes} from './utils/keycodes.js';\nimport * as object from './utils/object.js';\nimport type {Workspace} from './workspace.js';\n\n\n/**\n * Class for the registry of keyboard shortcuts. This is intended to be a\n * singleton. You should not create a new instance, and only access this class\n * from ShortcutRegistry.registry.\n */\nexport class ShortcutRegistry {\n  static readonly registry = new ShortcutRegistry();\n\n  /** Registry of all keyboard shortcuts, keyed by name of shortcut. */\n  private shortcuts = new Map<string, KeyboardShortcut>();\n\n  /** Map of key codes to an array of shortcut names. */\n  private keyMap = new Map<string, string[]>();\n\n  /** Resets the existing ShortcutRegistry singleton. */\n  private constructor() {\n    this.reset();\n  }\n\n  /** Clear and recreate the registry and keyMap. */\n  reset() {\n    this.shortcuts.clear();\n    this.keyMap.clear();\n  }\n\n  /**\n   * Registers a keyboard shortcut.\n   *\n   * @param shortcut The shortcut for this key code.\n   * @param opt_allowOverrides True to prevent a warning when overriding an\n   *     already registered item.\n   * @throws {Error} if a shortcut with the same name already exists.\n   */\n  register(shortcut: KeyboardShortcut, opt_allowOverrides?: boolean) {\n    const registeredShortcut = this.shortcuts.get(shortcut.name);\n    if (registeredShortcut && !opt_allowOverrides) {\n      throw new Error(`Shortcut named \"${shortcut.name}\" already exists.`);\n    }\n    this.shortcuts.set(shortcut.name, shortcut);\n\n    const keyCodes = shortcut.keyCodes;\n    if (keyCodes && keyCodes.length > 0) {\n      for (let i = 0; i < keyCodes.length; i++) {\n        this.addKeyMapping(\n            keyCodes[i], shortcut.name, !!shortcut.allowCollision);\n      }\n    }\n  }\n\n  /**\n   * Unregisters a keyboard shortcut registered with the given key code. This\n   * will also remove any key mappings that reference this shortcut.\n   *\n   * @param shortcutName The name of the shortcut to unregister.\n   * @returns True if an item was unregistered, false otherwise.\n   */\n  unregister(shortcutName: string): boolean {\n    const shortcut = this.shortcuts.get(shortcutName);\n\n    if (!shortcut) {\n      console.warn(`Keyboard shortcut named \"${shortcutName}\" not found.`);\n      return false;\n    }\n\n    this.removeAllKeyMappings(shortcutName);\n\n    this.shortcuts.delete(shortcutName);\n    return true;\n  }\n\n  /**\n   * Adds a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_allowCollision True to prevent an error when adding a shortcut\n   *     to a key that is already mapped to a shortcut.\n   * @throws {Error} if the given key code is already mapped to a shortcut.\n   */\n  addKeyMapping(\n      keyCode: string|number|KeyCodes, shortcutName: string,\n      opt_allowCollision?: boolean) {\n    keyCode = `${keyCode}`;\n    const shortcutNames = this.keyMap.get(keyCode);\n    if (shortcutNames && !opt_allowCollision) {\n      throw new Error(`Shortcut named \"${\n          shortcutName}\" collides with shortcuts \"${shortcutNames}\"`);\n    } else if (shortcutNames && opt_allowCollision) {\n      shortcutNames.unshift(shortcutName);\n    } else {\n      this.keyMap.set(keyCode, [shortcutName]);\n    }\n  }\n\n  /**\n   * Removes a mapping between a keycode and a keyboard shortcut.\n   *\n   * @param keyCode The key code for the keyboard shortcut. If registering a key\n   *     code with a modifier (ex: ctrl+c) use\n   *     ShortcutRegistry.registry.createSerializedKey;\n   * @param shortcutName The name of the shortcut to execute when the given\n   *     keycode is pressed.\n   * @param opt_quiet True to not console warn when there is no shortcut to\n   *     remove.\n   * @returns True if a key mapping was removed, false otherwise.\n   */\n  removeKeyMapping(keyCode: string, shortcutName: string, opt_quiet?: boolean):\n      boolean {\n    const shortcutNames = this.keyMap.get(keyCode);\n\n    if (!shortcutNames) {\n      if (!opt_quiet) {\n        console.warn(`No keyboard shortcut named \"${\n            shortcutName}\" registered with key code \"${keyCode}\"`);\n      }\n      return false;\n    }\n\n    const shortcutIdx = shortcutNames.indexOf(shortcutName);\n    if (shortcutIdx > -1) {\n      shortcutNames.splice(shortcutIdx, 1);\n      if (shortcutNames.length === 0) {\n        this.keyMap.delete(keyCode);\n      }\n      return true;\n    }\n    if (!opt_quiet) {\n      console.warn(`No keyboard shortcut named \"${\n          shortcutName}\" registered with key code \"${keyCode}\"`);\n    }\n    return false;\n  }\n\n  /**\n   * Removes all the key mappings for a shortcut with the given name.\n   * Useful when changing the default key mappings and the key codes registered\n   * to the shortcut are unknown.\n   *\n   * @param shortcutName The name of the shortcut to remove from the key map.\n   */\n  removeAllKeyMappings(shortcutName: string) {\n    for (const keyCode of this.keyMap.keys()) {\n      this.removeKeyMapping(keyCode, shortcutName, true);\n    }\n  }\n\n  /**\n   * Sets the key map. Setting the key map will override any default key\n   * mappings.\n   *\n   * @param newKeyMap The object with key code to shortcut names.\n   */\n  setKeyMap(newKeyMap: {[key: string]: string[]}) {\n    this.keyMap.clear();\n    for (const key in newKeyMap) {\n      this.keyMap.set(key, newKeyMap[key]);\n    }\n  }\n\n  /**\n   * Gets the current key map.\n   *\n   * @returns The object holding key codes to ShortcutRegistry.KeyboardShortcut.\n   */\n  getKeyMap(): {[key: string]: string[]} {\n    const legacyKeyMap: {[key: string]: string[]} = Object.create(null);\n    for (const [key, value] of this.keyMap) {\n      legacyKeyMap[key] = value;\n    }\n    return legacyKeyMap;\n  }\n\n  /**\n   * Gets the registry of keyboard shortcuts.\n   *\n   * @returns The registry of keyboard shortcuts.\n   */\n  getRegistry(): {[key: string]: KeyboardShortcut} {\n    const legacyRegistry: {[key: string]: KeyboardShortcut} =\n        Object.create(null);\n    for (const [key, value] of this.shortcuts) {\n      legacyRegistry[key] = value;\n    }\n    return object.deepMerge(Object.create(null), legacyRegistry);\n  }\n\n  /**\n   * Handles key down events.\n   *\n   * @param workspace The main workspace where the event was captured.\n   * @param e The key down event.\n   * @returns True if the event was handled, false otherwise.\n   */\n  onKeyDown(workspace: Workspace, e: KeyboardEvent): boolean {\n    const key = this.serializeKeyEvent_(e);\n    const shortcutNames = this.getShortcutNamesByKeyCode(key);\n    if (!shortcutNames) {\n      return false;\n    }\n    for (let i = 0, shortcutName; shortcutName = shortcutNames[i]; i++) {\n      const shortcut = this.shortcuts.get(shortcutName);\n      if (!shortcut?.preconditionFn || shortcut?.preconditionFn(workspace)) {\n        // If the key has been handled, stop processing shortcuts.\n        if (shortcut?.callback && shortcut?.callback(workspace, e, shortcut)) {\n          return true;\n        }\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Gets the shortcuts registered to the given key code.\n   *\n   * @param keyCode The serialized key code.\n   * @returns The list of shortcuts to call when the given keyCode is used.\n   *     Undefined if no shortcuts exist.\n   */\n  getShortcutNamesByKeyCode(keyCode: string): string[]|undefined {\n    return this.keyMap.get(keyCode) || [];\n  }\n\n  /**\n   * Gets the serialized key codes that the shortcut with the given name is\n   * registered under.\n   *\n   * @param shortcutName The name of the shortcut.\n   * @returns An array with all the key codes the shortcut is registered under.\n   */\n  getKeyCodesByShortcutName(shortcutName: string): string[] {\n    const keys = [];\n    for (const [keyCode, shortcuts] of this.keyMap) {\n      const shortcutIdx = shortcuts.indexOf(shortcutName);\n      if (shortcutIdx > -1) {\n        keys.push(keyCode);\n      }\n    }\n    return keys;\n  }\n\n  /**\n   * Serializes a key event.\n   *\n   * @param e A key down event.\n   * @returns The serialized key code for the given event.\n   */\n  private serializeKeyEvent_(e: KeyboardEvent): string {\n    let serializedKey = '';\n    for (const modifier in ShortcutRegistry.modifierKeys) {\n      if (e.getModifierState(modifier)) {\n        if (serializedKey !== '') {\n          serializedKey += '+';\n        }\n        serializedKey += modifier;\n      }\n    }\n    if (serializedKey !== '' && e.keyCode) {\n      serializedKey = serializedKey + '+' + e.keyCode;\n    } else if (e.keyCode) {\n      serializedKey = String(e.keyCode);\n    }\n    return serializedKey;\n  }\n\n  /**\n   * Checks whether any of the given modifiers are not valid.\n   *\n   * @param modifiers List of modifiers to be used with the key.\n   * @throws {Error} if the modifier is not in the valid modifiers list.\n   */\n  private checkModifiers_(modifiers: KeyCodes[]) {\n    for (let i = 0, modifier; modifier = modifiers[i]; i++) {\n      if (!(modifier in ShortcutRegistry.modifierKeys)) {\n        throw new Error(modifier + ' is not a valid modifier key.');\n      }\n    }\n  }\n\n  /**\n   * Creates the serialized key code that will be used in the key map.\n   *\n   * @param keyCode Number code representing the key.\n   * @param modifiers List of modifier key codes to be used with the key. All\n   *     valid modifiers can be found in the ShortcutRegistry.modifierKeys.\n   * @returns The serialized key code for the given modifiers and key.\n   */\n  createSerializedKey(keyCode: number, modifiers: KeyCodes[]|null): string {\n    let serializedKey = '';\n\n    if (modifiers) {\n      this.checkModifiers_(modifiers);\n      for (const modifier in ShortcutRegistry.modifierKeys) {\n        const modifierKeyCode =\n            (ShortcutRegistry.modifierKeys as AnyDuringMigration)[modifier];\n        if (modifiers.indexOf(modifierKeyCode) > -1) {\n          if (serializedKey !== '') {\n            serializedKey += '+';\n          }\n          serializedKey += modifier;\n        }\n      }\n    }\n\n    if (serializedKey !== '' && keyCode) {\n      serializedKey = serializedKey + '+' + keyCode;\n    } else if (keyCode) {\n      serializedKey = `${keyCode}`;\n    }\n    return serializedKey;\n  }\n}\n\nexport namespace ShortcutRegistry {\n  export interface KeyboardShortcut {\n    callback?: ((p1: Workspace, p2: Event, p3: KeyboardShortcut) => boolean);\n    name: string;\n    preconditionFn?: ((p1: Workspace) => boolean);\n    metadata?: object;\n    keyCodes?: (number|string)[];\n    allowCollision?: boolean;\n  }\n\n  /** Supported modifiers. */\n  export enum modifierKeys {\n    Shift = KeyCodes.SHIFT,\n    Control = KeyCodes.CTRL,\n    Alt = KeyCodes.ALT,\n    Meta = KeyCodes.META,\n  }\n}\n\nexport type KeyboardShortcut = ShortcutRegistry.KeyboardShortcut;\n// No need to export ShorcutRegistry.modifierKeys from the module at this time\n// because (1) it wasn't automatically converted by the automatic migration\n// script, (2) the name doesn't follow the styleguide.\n", "/**\n * @license\n * Copyright 2016 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An SVG that floats on top of the workspace.\n * Blocks are moved into this SVG during a drag, improving performance.\n * The entire SVG is translated using CSS translation instead of SVG so the\n * blocks are never repainted during drag improving performance.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.WorkspaceDragSurfaceSvg');\n\nimport type {Coordinate} from './utils/coordinate.js';\nimport * as dom from './utils/dom.js';\nimport {Svg} from './utils/svg.js';\nimport * as svgMath from './utils/svg_math.js';\n\n\n/**\n * Blocks are moved into this SVG during a drag, improving performance.\n * The entire SVG is translated using CSS transforms instead of SVG so the\n * blocks are never repainted during drag improving performance.\n *\n * @alias Blockly.WorkspaceDragSurfaceSvg\n */\nexport class WorkspaceDragSurfaceSvg {\n  /**\n   * The SVG drag surface. Set once by WorkspaceDragSurfaceSvg.createDom.\n   */\n  private SVG!: SVGElement;\n\n  /**\n   * The element to insert the block canvas and bubble canvas after when it\n   * goes back in the DOM at the end of a drag.\n   */\n  private previousSibling: Element|null = null;\n\n  /** @param container Containing element. */\n  constructor(private readonly container: Element) {\n    this.createDom();\n  }\n\n  /** Create the drag surface and inject it into the container. */\n  createDom() {\n    if (this.SVG) {\n      return;  // Already created.\n    }\n    /**\n     * Dom structure when the workspace is being dragged. If there is no drag in\n     * progress, the SVG is empty and display: none.\n     * <svg class=\"blocklyWsDragSurface\" style=transform:translate3d(...)>\n     *   <g class=\"blocklyBlockCanvas\"></g>\n     *   <g class=\"blocklyBubbleCanvas\">/g>\n     * </svg>\n     */\n    this.SVG = dom.createSvgElement(Svg.SVG, {\n      'xmlns': dom.SVG_NS,\n      'xmlns:html': dom.HTML_NS,\n      'xmlns:xlink': dom.XLINK_NS,\n      'version': '1.1',\n      'class': 'blocklyWsDragSurface blocklyOverflowVisible',\n    });\n    this.container.appendChild(this.SVG);\n  }\n\n  /**\n   * Translate the entire drag surface during a drag.\n   * We translate the drag surface instead of the blocks inside the surface\n   * so that the browser avoids repainting the SVG.\n   * Because of this, the drag coordinates must be adjusted by scale.\n   *\n   * @param x X translation for the entire surface\n   * @param y Y translation for the entire surface\n   * @internal\n   */\n  translateSurface(x: number, y: number) {\n    // Make sure the svg exists on a pixel boundary so that it is not fuzzy.\n    const fixedX = Math.round(x);\n    const fixedY = Math.round(y);\n\n    this.SVG.style.display = 'block';\n    dom.setCssTransform(\n        this.SVG, 'translate3d(' + fixedX + 'px, ' + fixedY + 'px, 0)');\n  }\n\n  /**\n   * Reports the surface translation in scaled workspace coordinates.\n   * Use this when finishing a drag to return blocks to the correct position.\n   *\n   * @returns Current translation of the surface\n   * @internal\n   */\n  getSurfaceTranslation(): Coordinate {\n    return svgMath.getRelativeXY((this.SVG));\n  }\n\n  /**\n   * Move the blockCanvas and bubbleCanvas out of the surface SVG and on to\n   * newSurface.\n   *\n   * @param newSurface The element to put the drag surface contents into.\n   * @internal\n   */\n  clearAndHide(newSurface: SVGElement) {\n    if (!newSurface) {\n      throw Error(\n          'Couldn\\'t clear and hide the drag surface: missing new surface.');\n    }\n    const blockCanvas = this.SVG.childNodes[0] as Element;\n    const bubbleCanvas = this.SVG.childNodes[1] as Element;\n    if (!blockCanvas || !bubbleCanvas ||\n        !(blockCanvas.classList.contains('blocklyBlockCanvas') ||\n          !bubbleCanvas.classList.contains('blocklyBubbleCanvas'))) {\n      throw Error(\n          'Couldn\\'t clear and hide the drag surface. A node was missing.');\n    }\n\n    // If there is a previous sibling, put the blockCanvas back right\n    // afterwards, otherwise insert it as the first child node in newSurface.\n    if (this.previousSibling !== null) {\n      dom.insertAfter(blockCanvas, this.previousSibling);\n    } else {\n      newSurface.insertBefore(blockCanvas, newSurface.firstChild);\n    }\n\n    // Reattach the bubble canvas after the blockCanvas.\n    dom.insertAfter(bubbleCanvas, blockCanvas);\n    // Hide the drag surface.\n    this.SVG.style.display = 'none';\n    if (this.SVG.childNodes.length) {\n      throw Error('Drag surface was not cleared.');\n    }\n    dom.setCssTransform(this.SVG, '');\n    this.previousSibling = null;\n  }\n\n  /**\n   * Set the SVG to have the block canvas and bubble canvas in it and then\n   * show the surface.\n   *\n   * @param blockCanvas The block canvas <g> element from the\n   *     workspace.\n   * @param bubbleCanvas The <g> element that contains the\n     bubbles.\n   * @param previousSibling The element to insert the block canvas and\n           bubble canvas after when it goes back in the DOM at the end of a\n     drag.\n   * @param width The width of the workspace SVG element.\n   * @param height The height of the workspace SVG element.\n   * @param scale The scale of the workspace being dragged.\n   * @internal\n   */\n  setContentsAndShow(\n      blockCanvas: SVGElement, bubbleCanvas: SVGElement,\n      previousSibling: Element, width: number, height: number, scale: number) {\n    if (this.SVG.childNodes.length) {\n      throw Error('Already dragging a block.');\n    }\n    this.previousSibling = previousSibling;\n    // Make sure the blocks and bubble canvas are scaled appropriately.\n    blockCanvas.setAttribute(\n        'transform', 'translate(0, 0) scale(' + scale + ')');\n    bubbleCanvas.setAttribute(\n        'transform', 'translate(0, 0) scale(' + scale + ')');\n    this.SVG.setAttribute('width', String(width));\n    this.SVG.setAttribute('height', String(height));\n    this.SVG.appendChild(blockCanvas);\n    this.SVG.appendChild(bubbleCanvas);\n    this.SVG.style.display = 'block';\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.ConstantProvider');\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n\n/**\n * An object that provides constants for rendering blocks in Geras mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  override FIELD_TEXT_BASELINE_CENTER = false;\n\n  // The dark/shadow path in classic rendering is the same as the normal block\n  // path, but translated down one and right one.\n  DARK_PATH_OFFSET = 1;\n\n  /**\n   * The maximum width of a bottom row that follows a statement input and has\n   * inputs inline.\n   */\n  MAX_BOTTOM_WIDTH = 30;\n  override STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT / 2;\n\n  constructor() {\n    super();\n  }\n\n  override getCSS_(selector: string) {\n    return super.getCSS_(selector).concat([\n      /* eslint-disable indent */\n      /* clang-format off */\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPathLight,`,\n      `${selector} .blocklyInsertionMarker>.blocklyPathDark {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      '}',\n      /* clang-format on */\n      /* eslint-enable indent */\n    ]);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.Highlighter');\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Row} from '../measurables/row.js';\nimport {SpacerRow} from '../measurables/spacer_row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {HighlightConstantProvider, InsideCorner, JaggedTeeth, Notch, OutsideCorner, PuzzleTab, StartHat} from './highlight_constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\n\n\n/**\n * An object that adds highlights to a block based on the given rendering\n * information.\n *\n * Highlighting is interesting because the highlights do not fully enclose the\n * block.  Instead, they are positioned based on a light source in the top left.\n * This means that rendering highlights requires exact information about the\n * position of each part of the block.  The resulting paths are not continuous\n * or closed paths.  The highlights for tabs and notches are loosely based on\n * tab and notch shapes, but are not exactly the same.\n */\nexport class Highlighter {\n  info_: RenderInfo;\n  steps_ = '';\n  inlineSteps_ = '';\n  RTL_: boolean;\n  constants_: ConstantProvider;\n  highlightConstants_: HighlightConstantProvider;\n  private readonly highlightOffset_: number;\n  outsideCornerPaths_: OutsideCorner;\n  insideCornerPaths_: InsideCorner;\n  puzzleTabPaths_: PuzzleTab;\n  notchPaths_: Notch;\n  startPaths_: StartHat;\n  jaggedTeethPaths_: JaggedTeeth;\n\n  /**\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(info: RenderInfo) {\n    this.info_ = info;\n\n    this.RTL_ = this.info_.RTL;\n\n    const renderer = (info.getRenderer());\n\n    /** The renderer's constant provider. */\n    this.constants_ = renderer.getConstants();\n\n    this.highlightConstants_ = renderer.getHighlightConstants();\n    /** The offset between the block's main path and highlight path. */\n    this.highlightOffset_ = this.highlightConstants_.OFFSET;\n\n    this.outsideCornerPaths_ = this.highlightConstants_.OUTSIDE_CORNER;\n    this.insideCornerPaths_ = this.highlightConstants_.INSIDE_CORNER;\n    this.puzzleTabPaths_ = this.highlightConstants_.PUZZLE_TAB;\n    this.notchPaths_ = this.highlightConstants_.NOTCH;\n    this.startPaths_ = this.highlightConstants_.START_HAT;\n    this.jaggedTeethPaths_ = this.highlightConstants_.JAGGED_TEETH;\n  }\n\n  /**\n   * Get the steps for the highlight path.\n   *\n   * @returns The steps for the highlight path.\n   */\n  getPath(): string {\n    return this.steps_ + '\\n' + this.inlineSteps_;\n  }\n\n  /**\n   * Add a highlight to the top corner of a block.\n   *\n   * @param row The top row of the block.\n   */\n  drawTopCorner(row: TopRow) {\n    this.steps_ += svgPaths.moveBy(row.xPos, this.info_.startY);\n    for (let i = 0, elem; elem = row.elements[i]; i++) {\n      if (Types.isLeftSquareCorner(elem)) {\n        this.steps_ += this.highlightConstants_.START_POINT;\n      } else if (Types.isLeftRoundedCorner(elem)) {\n        this.steps_ += this.outsideCornerPaths_.topLeft(this.RTL_);\n      } else if (Types.isPreviousConnection(elem)) {\n        this.steps_ += this.notchPaths_.pathLeft;\n      } else if (Types.isHat(elem)) {\n        this.steps_ += this.startPaths_.path(this.RTL_);\n      } else if (Types.isSpacer(elem) && elem.width !== 0) {\n        // The end point of the spacer needs to be offset by the highlight\n        // amount. So instead of using the spacer's width for a relative\n        // horizontal, use its width and position for an absolute horizontal\n        // move.\n        this.steps_ += svgPaths.lineOnAxis(\n            'H', elem.xPos + elem.width - this.highlightOffset_);\n      }\n    }\n\n    const right = row.xPos + row.width - this.highlightOffset_;\n    this.steps_ += svgPaths.lineOnAxis('H', right);\n  }\n\n  /**\n   * Add a highlight on a jagged edge for a collapsed block.\n   *\n   * @param row  The row to highlight.\n   */\n  drawJaggedEdge_(row: Row) {\n    if (this.info_.RTL) {\n      const remainder =\n          row.height - this.jaggedTeethPaths_.height - this.highlightOffset_;\n      this.steps_ +=\n          this.jaggedTeethPaths_.pathLeft + svgPaths.lineOnAxis('v', remainder);\n    }\n  }\n\n  /**\n   * Add a highlight on a value input.\n   *\n   * @param row The row the input belongs to.\n   */\n  drawValueInput(row: Row) {\n    const input = row.getLastInput() as InlineInput;\n    if (this.RTL_) {\n      const belowTabHeight = row.height - input.connectionHeight;\n\n      this.steps_ +=\n          svgPaths.moveTo(\n              input.xPos + input.width - this.highlightOffset_, row.yPos) +\n          this.puzzleTabPaths_.pathDown(this.RTL_) +\n          svgPaths.lineOnAxis('v', belowTabHeight);\n    } else {\n      this.steps_ += svgPaths.moveTo(input.xPos + input.width, row.yPos) +\n          this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n\n  /**\n   * Add a highlight on a statement input.\n   *\n   * @param row The row to highlight.\n   */\n  drawStatementInput(row: Row) {\n    const input = row.getLastInput();\n    if (!input) return;\n    if (this.RTL_) {\n      const innerHeight = row.height - 2 * this.insideCornerPaths_.height;\n      this.steps_ += svgPaths.moveTo(input.xPos, row.yPos) +\n          this.insideCornerPaths_.pathTop(this.RTL_) +\n          svgPaths.lineOnAxis('v', innerHeight) +\n          this.insideCornerPaths_.pathBottom(this.RTL_) +\n          svgPaths.lineTo(\n              row.width - input.xPos - this.insideCornerPaths_.width, 0);\n    } else {\n      this.steps_ += svgPaths.moveTo(input.xPos, row.yPos + row.height) +\n          this.insideCornerPaths_.pathBottom(this.RTL_) +\n          svgPaths.lineTo(\n              row.width - input.xPos - this.insideCornerPaths_.width, 0);\n    }\n  }\n\n  /**\n   * Add a highlight on the right side of a row.\n   *\n   * @param row The row to highlight.\n   */\n  drawRightSideRow(row: Row) {\n    const rightEdge = row.xPos + row.width - this.highlightOffset_;\n    if (row instanceof SpacerRow && row.followsStatement) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n    }\n    if (this.RTL_) {\n      this.steps_ += svgPaths.lineOnAxis('H', rightEdge);\n      if (row.height > this.highlightOffset_) {\n        this.steps_ += svgPaths.lineOnAxis(\n            'V', row.yPos + row.height - this.highlightOffset_);\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to the bottom row.\n   *\n   * @param row The row to highlight.\n   */\n  drawBottomRow(row: BottomRow) {\n    // Highlight the vertical edge of the bottom row on the input side.\n    // Highlighting is always from the top left, both in LTR and RTL.\n    if (this.RTL_) {\n      this.steps_ +=\n          svgPaths.lineOnAxis('V', row.baseline - this.highlightOffset_);\n    } else {\n      const cornerElem = this.info_.bottomRow.elements[0];\n      if (Types.isLeftSquareCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(\n            row.xPos + this.highlightOffset_,\n            row.baseline - this.highlightOffset_);\n      } else if (Types.isLeftRoundedCorner(cornerElem)) {\n        this.steps_ += svgPaths.moveTo(row.xPos, row.baseline);\n        this.steps_ += this.outsideCornerPaths_.bottomLeft();\n      }\n    }\n  }\n\n  /**\n   * Draw the highlight on the left side of the block.\n   */\n  drawLeft() {\n    const outputConnection = this.info_.outputConnection;\n    if (outputConnection) {\n      const tabBottom =\n          outputConnection.connectionOffsetY + outputConnection.height;\n      // Draw a line up to the bottom of the tab.\n      if (this.RTL_) {\n        this.steps_ += svgPaths.moveTo(this.info_.startX, tabBottom);\n      } else {\n        const left = this.info_.startX + this.highlightOffset_;\n        const bottom = this.info_.bottomRow.baseline - this.highlightOffset_;\n        this.steps_ += svgPaths.moveTo(left, bottom);\n        this.steps_ += svgPaths.lineOnAxis('V', tabBottom);\n      }\n      this.steps_ += this.puzzleTabPaths_.pathUp(this.RTL_);\n    }\n\n    if (!this.RTL_) {\n      const topRow = this.info_.topRow;\n      if (Types.isLeftRoundedCorner(topRow.elements[0])) {\n        this.steps_ +=\n            svgPaths.lineOnAxis('V', this.outsideCornerPaths_.height);\n      } else {\n        this.steps_ +=\n            svgPaths.lineOnAxis('V', topRow.capline + this.highlightOffset_);\n      }\n    }\n  }\n\n  /**\n   * Add a highlight to an inline input.\n   *\n   * @param input The input to highlight.\n   */\n  drawInlineInput(input: InlineInput) {\n    const offset = this.highlightOffset_;\n\n    // Relative to the block's left.\n    const connectionRight = input.xPos + input.connectionWidth;\n    const yPos = input.centerline - input.height / 2;\n    const bottomHighlightWidth = input.width - input.connectionWidth;\n    const startY = yPos + offset;\n\n    if (this.RTL_) {\n      const aboveTabHeight = input.connectionOffsetY - offset;\n      const belowTabHeight = input.height -\n          (input.connectionOffsetY + input.connectionHeight) + offset;\n\n      const startX = connectionRight - offset;\n\n      this.inlineSteps_ +=\n          svgPaths.moveTo(startX, startY) +           // Right edge above tab.\n          svgPaths.lineOnAxis('v', aboveTabHeight) +  // Back of tab.\n          this.puzzleTabPaths_.pathDown(this.RTL_) +  // Right edge below tab.\n          svgPaths.lineOnAxis('v', belowTabHeight) +  // Bottom.\n          svgPaths.lineOnAxis('h', bottomHighlightWidth);\n    } else {\n      this.inlineSteps_ +=  // Go to top right corner.\n          svgPaths.moveTo(\n              input.xPos + input.width + offset,\n              startY) +  // Highlight right edge, bottom.\n          svgPaths.lineOnAxis('v', input.height) +\n          svgPaths.lineOnAxis(\n              'h', -bottomHighlightWidth) +  // Go to top of tab.\n          svgPaths.moveTo(\n              connectionRight,\n              yPos + input.connectionOffsetY) +  // Short highlight glint at\n          // bottom of tab.\n          this.puzzleTabPaths_.pathDown(this.RTL_);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport * as debug from '../common/debug.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {Row} from '../measurables/row.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {Highlighter} from './highlighter.js';\nimport type {RenderInfo} from './info.js';\nimport type {InlineInput} from './measurables/inline_input.js';\nimport type {PathObject} from './path_object.js';\n\n\n/**\n * An object that draws a block based on the given rendering information,\n * customized for the geras renderer.\n */\nexport class Drawer extends BaseDrawer {\n  highlighter_: Highlighter;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n    // Unlike Thrasos, Geras has highlights and drop shadows.\n    this.highlighter_ = new Highlighter(info);\n  }\n\n  override draw() {\n    this.hideHiddenIcons_();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    pathObject.setHighlightPath(this.highlighter_.getPath());\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    if (debug.isDebuggerEnabled()) {\n      this.block_?.renderingDebugger?.drawDebug(this.block_, this.info_);\n    }\n    this.recordSizeOnBlock_();\n  }\n\n  override drawTop_() {\n    this.highlighter_.drawTopCorner(this.info_.topRow);\n    this.highlighter_.drawRightSideRow(this.info_.topRow);\n\n    super.drawTop_();\n  }\n\n  override drawJaggedEdge_(row: Row) {\n    this.highlighter_.drawJaggedEdge_(row);\n\n    super.drawJaggedEdge_(row);\n  }\n\n  override drawValueInput_(row: Row) {\n    this.highlighter_.drawValueInput(row);\n\n    super.drawValueInput_(row);\n  }\n\n  override drawStatementInput_(row: Row) {\n    this.highlighter_.drawStatementInput(row);\n\n    super.drawStatementInput_(row);\n  }\n\n  override drawRightSideRow_(row: Row) {\n    this.highlighter_.drawRightSideRow(row);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', row.xPos + row.width) +\n        svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  override drawBottom_() {\n    this.highlighter_.drawBottomRow(this.info_.bottomRow);\n\n    super.drawBottom_();\n  }\n\n  /**\n   * Add steps for the left side of the block, which may include an output\n   * connection\n   */\n  protected override drawLeft_() {\n    this.highlighter_.drawLeft();\n\n    super.drawLeft_();\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.highlighter_.drawInlineInput(input as InlineInput);\n\n    super.drawInlineInput_(input);\n  }\n\n  override positionInlineInputConnection_(input: InlineInput) {\n    const yPos = input.centerline - input.height / 2;\n    // Move the connection.\n    if (input.connectionModel) {\n      // xPos already contains info about startX\n      let connX =\n          input.xPos + input.connectionWidth + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(\n          connX,\n          yPos + input.connectionOffsetY + this.constants_.DARK_PATH_OFFSET);\n    }\n  }\n\n  override positionStatementInputConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input?.connectionModel) {\n      let connX = row.xPos + row.statementEdge + input.notchOffset;\n      if (this.info_.RTL) {\n        connX *= -1;\n      } else {\n        connX += this.constants_.DARK_PATH_OFFSET;\n      }\n      input.connectionModel.setOffsetInBlock(\n          connX, row.yPos + this.constants_.DARK_PATH_OFFSET);\n    }\n  }\n\n  override positionExternalValueConnection_(row: Row) {\n    const input = row.getLastInput();\n    if (input && input.connectionModel) {\n      let connX = row.xPos + row.width + this.constants_.DARK_PATH_OFFSET;\n      if (this.info_.RTL) {\n        connX *= -1;\n      }\n      input.connectionModel.setOffsetInBlock(connX, row.yPos);\n    }\n  }\n\n  override positionNextConnection_() {\n    const bottomRow = this.info_.bottomRow;\n\n    if (bottomRow.connection) {\n      const connInfo = bottomRow.connection;\n      const x = connInfo.xPos;  // Already contains info about startX.\n      const connX =\n          (this.info_.RTL ? -x : x) + this.constants_.DARK_PATH_OFFSET / 2;\n      connInfo.connectionModel.setOffsetInBlock(\n          connX, bottomRow.baseline + this.constants_.DARK_PATH_OFFSET);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.HighlightConstantProvider');\n\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {ConstantProvider} from '../common/constants.js';\n\n\n/** An object containing sizing and path information about an outside corner. */\nexport interface OutsideCorner {\n  height: number;\n  topLeft: (p1: boolean) => string;\n  bottomLeft: () => string;\n}\n\n/** An object containing sizing and path information about an inside corner. */\nexport interface InsideCorner {\n  width: number;\n  height: number;\n  pathTop: (p1: boolean) => string;\n  pathBottom: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a start hat. */\nexport interface StartHat {\n  path: (p1: boolean) => string;\n}\n\n/** An object containing sizing and path information about a notch. */\nexport interface Notch {\n  pathLeft: string;\n}\n\n/** An object containing sizing and path information about a puzzle tab. */\nexport interface PuzzleTab {\n  width: number;\n  height: number;\n  pathDown: (p1: boolean) => string;\n  pathUp: (p1: boolean) => string;\n}\n\n/**\n * An object containing sizing and path information about collapsed block\n * indicators.\n */\nexport interface JaggedTeeth {\n  height: number;\n  width: number;\n  pathLeft: string;\n}\n\n/**\n * An object that provides constants for rendering highlights on blocks.\n * Some highlights are simple offsets of the parent paths and can be generated\n * programmatically.  Others, especially on curves, are just made out of piles\n * of constants and are hard to tweak.\n */\nexport class HighlightConstantProvider {\n  constantProvider: ConstantProvider;\n\n  /** The offset between the block's main path and highlight path. */\n  OFFSET = 0.5;\n  START_POINT: string;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  INSIDE_CORNER!: InsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  OUTSIDE_CORNER!: OutsideCorner;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  PUZZLE_TAB!: PuzzleTab;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  NOTCH!: Notch;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  JAGGED_TEETH!: JaggedTeeth;\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  START_HAT!: StartHat;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    /** The renderer's constant provider. */\n    this.constantProvider = constants;\n\n    /**\n     * The start point, which is offset in both X and Y, as an SVG path chunk.\n     */\n    this.START_POINT = svgPaths.moveBy(this.OFFSET, this.OFFSET);\n  }\n\n  /**\n   * Initialize shape objects based on the constants set in the constructor.\n   */\n  init() {\n    /**\n     * An object containing sizing and path information about inside corner\n     * highlights.\n     */\n    this.INSIDE_CORNER = this.makeInsideCorner();\n\n    /**\n     * An object containing sizing and path information about outside corner\n     * highlights.\n     */\n    this.OUTSIDE_CORNER = this.makeOutsideCorner();\n\n    /**\n     * An object containing sizing and path information about puzzle tab\n     * highlights.\n     */\n    this.PUZZLE_TAB = this.makePuzzleTab();\n\n    /**\n     * An object containing sizing and path information about notch highlights.\n     */\n    this.NOTCH = this.makeNotch();\n\n    /**\n     * An object containing sizing and path information about highlights for\n     * collapsed block indicators.\n     */\n    this.JAGGED_TEETH = this.makeJaggedTeeth();\n\n    /**\n     * An object containing sizing and path information about start hat\n     * highlights.\n     */\n    this.START_HAT = this.makeStartHat();\n  }\n\n  /**\n   * @returns An object containing sizing and path information about inside\n   *     corner highlights.\n   */\n  protected makeInsideCorner(): InsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the outside of a curve.\n     */\n    const distance45outside = (1 - Math.SQRT1_2) * (radius + offset) - offset;\n\n    const pathTopRtl = svgPaths.moveBy(distance45outside, distance45outside) +\n        svgPaths.arc(\n            'a', '0 0,0', radius,\n            svgPaths.point(\n                -distance45outside - offset, radius - distance45outside));\n\n    const pathBottomRtl = svgPaths.arc(\n        'a', '0 0,0', radius + offset,\n        svgPaths.point(radius + offset, radius + offset));\n\n    const pathBottomLtr =\n        svgPaths.moveBy(distance45outside, -distance45outside) +\n        svgPaths.arc(\n            'a', '0 0,0', radius + offset,\n            svgPaths.point(\n                radius - distance45outside, distance45outside + offset));\n\n    return {\n      width: radius + offset,\n      height: radius,\n      pathTop(rtl) {\n        return rtl ? pathTopRtl : '';\n      },\n      pathBottom(rtl) {\n        return rtl ? pathBottomRtl : pathBottomLtr;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about outside\n   *     corner highlights.\n   */\n  protected makeOutsideCorner(): OutsideCorner {\n    const radius = this.constantProvider.CORNER_RADIUS;\n    const offset = this.OFFSET;\n\n    /**\n     * Distance from shape edge to intersect with a curved corner at 45 degrees.\n     * Applies to highlighting on around the inside of a curve.\n     */\n    const distance45inside = (1 - Math.SQRT1_2) * (radius - offset) + offset;\n\n    const topLeftStartX = distance45inside;\n    const topLeftStartY = distance45inside;\n    const topLeftCornerHighlightRtl =\n        svgPaths.moveBy(topLeftStartX, topLeftStartY) +\n        svgPaths.arc(\n            'a', '0 0,1', radius - offset,\n            svgPaths.point(radius - topLeftStartX, -topLeftStartY + offset));\n    /**\n     * SVG path for drawing the highlight on the rounded top-left corner.\n     */\n    const topLeftCornerHighlightLtr = svgPaths.moveBy(offset, radius) +\n        svgPaths.arc(\n            'a', '0 0,1', radius - offset,\n            svgPaths.point(radius, -radius + offset));\n\n    const bottomLeftStartX = distance45inside;\n    const bottomLeftStartY = -distance45inside;\n    const bottomLeftPath = svgPaths.moveBy(bottomLeftStartX, bottomLeftStartY) +\n        svgPaths.arc(\n            'a', '0 0,1', radius - offset,\n            svgPaths.point(\n                -bottomLeftStartX + offset, -bottomLeftStartY - radius));\n\n    return {\n      height: radius,\n      topLeft(rtl) {\n        return rtl ? topLeftCornerHighlightRtl : topLeftCornerHighlightLtr;\n      },\n      bottomLeft() {\n        return bottomLeftPath;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about puzzle tab\n   *     highlights.\n   */\n  protected makePuzzleTab(): PuzzleTab {\n    const width = this.constantProvider.TAB_WIDTH;\n    const height = this.constantProvider.TAB_HEIGHT;\n\n    // This is how much of the vertical block edge is actually drawn by the\n    // puzzle tab.\n    const verticalOverlap = 2.5;\n\n    const highlightRtlUp =\n        svgPaths.moveBy(-2, -height + verticalOverlap + 0.9) +\n        svgPaths.lineTo(width * -0.45, -2.1);\n\n    const highlightRtlDown = svgPaths.lineOnAxis('v', verticalOverlap) +\n        svgPaths.moveBy(-width * 0.97, 2.5) +\n        svgPaths.curve(\n            'q',\n            [\n              svgPaths.point(-width * 0.05, 10),\n              svgPaths.point(width * 0.3, 9.5),\n            ]) +\n        svgPaths.moveBy(width * 0.67, -1.9) +\n        svgPaths.lineOnAxis('v', verticalOverlap);\n\n    const highlightLtrUp = svgPaths.lineOnAxis('v', -1.5) +\n        svgPaths.moveBy(width * -0.92, -0.5) +\n        svgPaths.curve(\n            'q',\n            [svgPaths.point(width * -0.19, -5.5), svgPaths.point(0, -11)]) +\n        svgPaths.moveBy(width * 0.92, 1);\n\n    const highlightLtrDown =\n        svgPaths.moveBy(-5, height - 0.7) + svgPaths.lineTo(width * 0.46, -2.1);\n\n    return {\n      width,\n      height,\n      pathUp(rtl) {\n        return rtl ? highlightRtlUp : highlightLtrUp;\n      },\n      pathDown(rtl) {\n        return rtl ? highlightRtlDown : highlightLtrDown;\n      },\n    };\n  }\n\n  /**\n   * @returns An object containing sizing and path information about notch\n   *     highlights.\n   */\n  protected makeNotch(): Notch {\n    // This is only for the previous connection.\n    const pathLeft = svgPaths.lineOnAxis('h', this.OFFSET) +\n        this.constantProvider.NOTCH.pathLeft;\n    return {pathLeft};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about collapsed\n   *     block edge highlights.\n   */\n  protected makeJaggedTeeth(): JaggedTeeth {\n    const pathLeft = svgPaths.lineTo(5.1, 2.6) + svgPaths.moveBy(-10.2, 6.8) +\n        svgPaths.lineTo(5.1, 2.6);\n    return {pathLeft, height: 12, width: 10.2};\n  }\n\n  /**\n   * @returns An object containing sizing and path information about start\n   *     highlights.\n   */\n  protected makeStartHat(): StartHat {\n    const hatHeight = this.constantProvider.START_HAT.height;\n    const pathRtl = svgPaths.moveBy(25, -8.7) + svgPaths.curve('c', [\n      svgPaths.point(29.7, -6.2),\n      svgPaths.point(57.2, -0.5),\n      svgPaths.point(75, 8.7),\n    ]);\n\n    const pathLtr = svgPaths.curve('c', [\n      svgPaths.point(17.8, -9.2),\n      svgPaths.point(45.3, -14.9),\n      svgPaths.point(75, -8.7),\n    ]) + svgPaths.moveTo(100.5, hatHeight + 0.5);\n    return {\n      path(rtl) {\n        return rtl ? pathRtl : pathLtr;\n      },\n    };\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.InlineInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {InlineInput as BaseInlineInput} from '../../../renderers/measurables/inline_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n\n/**\n * An object containing information about the space an inline input takes up\n * during rendering.\n */\nexport class InlineInput extends BaseInlineInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The inline input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.width += this.constants_.DARK_PATH_OFFSET;\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.StatementInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../input.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\nimport type {ConstantProvider as GerasConstantProvider} from '../constants.js';\n\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  override constants_: GerasConstantProvider;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: BaseConstantProvider, input: Input) {\n    super(constants, input);\n    this.constants_ = constants as GerasConstantProvider;\n\n    if (this.connectedBlock) {\n      // We allow the dark path to show on the parent block so that the child\n      // block looks embossed.  This takes up an extra pixel in both x and y.\n      this.height += this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Input} from '../../input.js';\nimport {inputTypes} from '../../input_types.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport {ExternalValueInput} from '../measurables/external_value_input.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {InputRow} from '../measurables/input_row.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {ConstantProvider} from './constants.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block,\n * customized for the geras renderer.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override constants_!: ConstantProvider;\n\n  protected override readonly renderer_: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n    this.renderer_ = renderer;\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override populateBottomRow_() {\n    super.populateBottomRow_();\n\n    const followsStatement = this.block_.inputList.length &&\n        this.block_.inputList[this.block_.inputList.length - 1].type ===\n            inputTypes.STATEMENT;\n    // The minimum height of the bottom row is smaller in Geras than in other\n    // renderers, because the dark path adds a pixel.\n    // If one of the row's elements has a greater height this will be\n    // overwritten in the compute pass.\n    if (!followsStatement) {\n      this.bottomRow.minHeight =\n          this.constants_.MEDIUM_PADDING - this.constants_.DARK_PATH_OFFSET;\n    }\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // Non-dummy inputs have visual representations onscreen.\n    if (this.isInline && input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new InlineInput(this.constants_, input));\n      activeRow.hasInlineInput = true;\n    } else if (input.type === inputTypes.STATEMENT) {\n      activeRow.elements.push(new StatementInput(this.constants_, input));\n      activeRow.hasStatement = true;\n    } else if (input.type === inputTypes.VALUE) {\n      activeRow.elements.push(new ExternalValueInput(this.constants_, input));\n      activeRow.hasExternalInput = true;\n    } else if (input.type === inputTypes.DUMMY) {\n      // Dummy inputs have no visual representation, but the information is\n      // still important.\n      activeRow.minHeight =\n          Math.max(activeRow.minHeight, this.constants_.DUMMY_INPUT_MIN_HEIGHT);\n      activeRow.hasDummyInput = true;\n    }\n    // Ignore row alignment if inline.\n    if (!this.isInline && activeRow.align === null) {\n      activeRow.align = input.align;\n    }\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n      }\n    }\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing =\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null);\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable|null, next: Measurable|null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row or a statement input.\n    if (!Types.isInput(prev) && (!next || Types.isStatementInput(next))) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n            (this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET / 2;\n        return next.notchOffset + offset;\n      }\n    }\n\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      } else if (Types.isNextConnection(next)) {\n        // Next connections are shifted slightly to the left (in both LTR and\n        // RTL) to make the dark path under the previous connection show\n        // through.\n        const offset =\n            (this.RTL ? 1 : -1) * this.constants_.DARK_PATH_OFFSET / 2;\n        return next.notchOffset - this.constants_.CORNER_RADIUS + offset;\n      }\n    }\n\n    // Spacing between two fields of the same editability.\n    if (Types.isField(prev) && next && Types.isField(next) &&\n        (prev as Field).isEditable === (next as Field).isEditable) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n          bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) || Types.isIcon(elem)) {\n      result += elem.height / 2;\n      if ((row.hasInlineInput || row.hasStatement) &&\n          elem.height + this.constants_.TALL_INPUT_FIELD_OFFSET_Y <=\n              row.height) {\n        result += this.constants_.TALL_INPUT_FIELD_OFFSET_Y;\n      }\n    } else if (Types.isInlineInput(elem)) {\n      result += elem.height / 2;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override alignRowElements_() {\n    if (!this.isInline) {\n      super.alignRowElements_();\n      return;\n    }\n    // Walk backgrounds through rows on the block, keeping track of the right\n    // input edge.\n    let nextRightEdge = 0;\n    const rowNextRightEdges = new WeakMap();\n    let prevInput = null;\n    for (let i = this.rows.length - 1, row; row = this.rows[i]; i--) {\n      rowNextRightEdges.set(row, nextRightEdge);\n      if (Types.isInputRow(row)) {\n        if (row.hasStatement) {\n          this.alignStatementRow_(row as InputRow);\n        }\n        if (prevInput && prevInput.hasStatement &&\n            row.width < prevInput.width) {\n          rowNextRightEdges.set(row, prevInput.width);\n        } else {\n          nextRightEdge = row.width;\n        }\n        prevInput = row;\n      }\n    }\n    // Walk down each row from the top, comparing the prev and next right input\n    // edges and setting the desired width to the max of the two.\n    let prevRightEdge = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      if (row.hasStatement) {\n        prevRightEdge = this.getDesiredRowWidth_(row);\n      } else if (Types.isSpacer(row)) {\n        // Set the spacer row to the max of the prev or next input width.\n        row.width = Math.max(prevRightEdge, rowNextRightEdges.get(row));\n      } else {\n        const currentWidth = row.width;\n        const desiredWidth =\n            Math.max(prevRightEdge, rowNextRightEdges.get(row));\n        const missingSpace = desiredWidth - currentWidth;\n        if (missingSpace > 0) {\n          this.addAlignmentPadding_(row, missingSpace);\n        }\n        prevRightEdge = row.width;\n      }\n    }\n  }\n\n  override getDesiredRowWidth_(row: Row) {\n    // Limit the width of a statement row when a block is inline.\n    if (this.isInline && row.hasStatement) {\n      return this.statementEdge + this.constants_.MAX_BOTTOM_WIDTH +\n          this.startX;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0, row; row = this.rows[i]; i++) {\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (row === this.bottomRow &&\n          heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection &&\n        this.block_.nextConnection.isConnected()) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n            widestRowWithConnectedBlocks,\n            target.getHeightWidth().width - this.constants_.DARK_PATH_OFFSET);\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX +\n        this.constants_.DARK_PATH_OFFSET;\n    this.width += this.constants_.DARK_PATH_OFFSET;\n    this.height = yCursor + this.constants_.DARK_PATH_OFFSET;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.PathObject');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as colour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  svgPathDark: SVGElement;\n  svgPathLight: SVGElement;\n\n  /**\n   * The colour of the dark path on the block in '#RRGGBB' format.\n   */\n  colourDark = '#000000';\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n      root: SVGElement, style: BlockStyle,\n      public override constants: ConstantProvider) {\n    super(root, style, constants);\n\n    /** The dark path of the block. */\n    this.svgPathDark = dom.createSvgElement(\n        Svg.PATH, {'class': 'blocklyPathDark', 'transform': 'translate(1,1)'});\n    // SVG draw order is based on the order of elements (top most = back most)\n    // So we need to insert the dark path before the base path to make sure it\n    // gets drawn first.\n    this.svgRoot.insertBefore(this.svgPathDark, this.svgPath);\n\n    /** The light path of the block. */\n    this.svgPathLight = dom.createSvgElement(\n        Svg.PATH, {'class': 'blocklyPathLight'}, this.svgRoot);\n  }\n\n  override setPath(mainPath: string) {\n    this.svgPath.setAttribute('d', mainPath);\n    this.svgPathDark.setAttribute('d', mainPath);\n  }\n\n  /**\n   * Set the highlight path generated by the renderer onto the SVG element.\n   *\n   * @param highlightPath The highlight path.\n   */\n  setHighlightPath(highlightPath: string) {\n    this.svgPathLight.setAttribute('d', highlightPath);\n  }\n\n  override flipRTL() {\n    // Mirror the block's path.\n    this.svgPath.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathLight.setAttribute('transform', 'scale(-1 1)');\n    this.svgPathDark.setAttribute('transform', 'translate(1,1) scale(-1 1)');\n  }\n\n  override applyColour(block: BlockSvg) {\n    this.svgPathLight.style.display = '';\n    this.svgPathDark.style.display = '';\n    if (!this.style.colourTertiary) {\n      throw new Error(\n          'The renderer did not properly initialize the tertiary colour of ' +\n          'the block style');\n    }\n    this.svgPathLight.setAttribute('stroke', this.style.colourTertiary);\n    this.svgPathDark.setAttribute('fill', this.colourDark);\n\n    super.applyColour(block);\n\n    this.svgPath.setAttribute('stroke', 'none');\n  }\n\n  override setStyle(blockStyle: BlockStyle) {\n    this.style = blockStyle;\n    this.colourDark =\n        colour.blend('#000', this.style.colourPrimary, 0.2) || this.colourDark;\n  }\n\n  override updateHighlighted(highlighted: boolean) {\n    if (highlighted) {\n      this.svgPath.setAttribute(\n          'filter', 'url(#' + this.constants.embossFilterId + ')');\n      this.svgPathLight.style.display = 'none';\n    } else {\n      this.svgPath.setAttribute('filter', 'none');\n      this.svgPathLight.style.display = 'inline';\n    }\n  }\n\n  override updateShadow_(shadow: boolean) {\n    if (shadow) {\n      this.svgPathLight.style.display = 'none';\n      if (!this.style.colourSecondary) {\n        throw new Error(\n            'The renderer did not properly initialize the secondary colour ' +\n            'of the block style block style');\n      }\n      this.svgPathDark.setAttribute('fill', this.style.colourSecondary);\n      this.svgPath.setAttribute('stroke', 'none');\n      this.svgPath.setAttribute('fill', this.style.colourSecondary);\n    }\n  }\n\n  override updateDisabled_(disabled: boolean) {\n    super.updateDisabled_(disabled);\n    if (disabled) {\n      this.svgPath.setAttribute('stroke', 'none');\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {BlockStyle, Theme} from '../../theme.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {RenderInfo} from './info.js';\nimport {PathObject} from './path_object.js';\n\n\n/**\n * The geras renderer. This renderer was designed to be backwards compatible\n * with pre-2019 Blockly. Newer projects that are not constrained by backwards\n * compatibility should use thrasos, which is a more modern take on this\n * renderer.\n *\n * Geras is the ancient Greek spirit of old age.\n */\nexport class Renderer extends BaseRenderer {\n  /** The renderer's highlight constant provider. */\n  private highlightConstants_: HighlightConstantProvider|null = null;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Initialize the renderer.  Geras has a highlight provider in addition to\n   * the normal constant provider.\n   */\n  override init(\n      theme: Theme, opt_rendererOverrides?: {[rendererConstant: string]: any}) {\n    super.init(theme, opt_rendererOverrides);\n    this.highlightConstants_ = this.makeHighlightConstants_();\n    this.highlightConstants_.init();\n  }\n\n  override refreshDom(svg: SVGElement, theme: Theme) {\n    super.refreshDom(svg, theme);\n    this.getHighlightConstants().init();\n  }\n\n  override makeConstants_() {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(block: BlockSvg, info: BaseRenderInfo):\n      Drawer {\n    return new Drawer(block, (info as RenderInfo));\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(\n        root, style, (this.getConstants() as ConstantProvider));\n  }\n\n  /**\n   * Create a new instance of the renderer's highlight constant provider.\n   *\n   * @returns The highlight constant provider.\n   */\n  protected makeHighlightConstants_(): HighlightConstantProvider {\n    return new HighlightConstantProvider((this.getConstants()));\n  }\n\n  /**\n   * Get the renderer's highlight constant provider.  We assume that when this\n   * is called, the renderer has already been initialized.\n   *\n   * @returns The highlight constant provider.\n   */\n  getHighlightConstants(): HighlightConstantProvider {\n    if (!this.highlightConstants_) {\n      throw new Error(\n          'Cannot access the highlight constants because init has not ' +\n          'been called');\n    }\n    return this.highlightConstants_;\n  }\n}\n\nblockRendering.register('geras', Renderer);\n", "/** @file Re-exports of Blockly.geras.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.geras');\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {HighlightConstantProvider} from './highlight_constants.js';\nimport {Highlighter} from './highlighter.js';\nimport {RenderInfo} from './info.js';\nimport {InlineInput} from './measurables/inline_input.js';\nimport {StatementInput} from './measurables/statement_input.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {\n  ConstantProvider,\n  Drawer,\n  HighlightConstantProvider,\n  Highlighter,\n  InlineInput,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  StatementInput,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.ConstantProvider');\n\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\n\n\n/**\n * An object that provides constants for rendering blocks in the minimalist\n * renderer.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  constructor() {\n    super();\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\n\nimport type {RenderInfo} from './info.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer extends BaseDrawer {\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\n\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\n\n\n/**\n * The minimalist renderer.\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(block: BlockSvg, info: BaseRenderInfo):\n      Drawer {\n    return new Drawer(block, (info as RenderInfo));\n  }\n}\n\nblockRendering.register('minimalist', Renderer);\n", "/** @file Re-exports of Blockly.minimalist.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.minimalist');\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {ConstantProvider, Drawer, Renderer, RenderInfo};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.thrasos.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport type {BottomRow} from '../measurables/bottom_row.js';\nimport type {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport type {Row} from '../measurables/row.js';\nimport type {TopRow} from '../measurables/top_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  // Exclamation is fine b/c this is assigned by the super constructor.\n  protected override renderer_!: Renderer;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_;\n  }\n\n  override addElemSpacing_() {\n    let hasExternalInputs = false;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (row.hasExternalInput) {\n        hasExternalInputs = true;\n        break;\n      }\n    }\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      const oldElems = row.elements;\n      row.elements = [];\n      // No spacing needed before the corner on the top row or the bottom row.\n      if (row.startsWithElemSpacer()) {\n        // There's a spacer before the first element in the row.\n        row.elements.push(new InRowSpacer(\n            this.constants_, this.getInRowSpacing_(null, oldElems[0])));\n      }\n      if (!oldElems.length) {\n        continue;\n      }\n      for (let e = 0; e < oldElems.length - 1; e++) {\n        row.elements.push(oldElems[e]);\n        const spacing = this.getInRowSpacing_(oldElems[e], oldElems[e + 1]);\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n      row.elements.push(oldElems[oldElems.length - 1]);\n      if (row.endsWithElemSpacer()) {\n        let spacing =\n            this.getInRowSpacing_(oldElems[oldElems.length - 1], null);\n        if (hasExternalInputs && row.hasDummyInput) {\n          spacing += this.constants_.TAB_WIDTH;\n        }\n        // There's a spacer after the last element in the row.\n        row.elements.push(new InRowSpacer(this.constants_, spacing));\n      }\n    }\n  }\n\n  override getInRowSpacing_(prev: Measurable|null, next: Measurable|null) {\n    if (!prev) {\n      // Between an editable field and the beginning of the row.\n      if (next && Types.isField(next) && (next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Inline input at the beginning of the row.\n      if (next && Types.isInlineInput(next)) {\n        return this.constants_.MEDIUM_LARGE_PADDING;\n      }\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n      // Anything else at the beginning of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between a non-input and the end of the row.\n    if (!Types.isInput(prev) && !next) {\n      // Between an editable field and the end of the row.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      }\n      // Padding at the end of an icon-only row to make the block shape clearer.\n      if (Types.isIcon(prev)) {\n        return this.constants_.LARGE_PADDING * 2 + 1;\n      }\n      if (Types.isHat(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Establish a minimum width for a block with a previous or next\n      // connection.\n      if (Types.isPreviousOrNextConnection(prev)) {\n        return this.constants_.LARGE_PADDING;\n      }\n      // Between rounded corner and the end of the row.\n      if (Types.isLeftRoundedCorner(prev)) {\n        return this.constants_.MIN_BLOCK_WIDTH;\n      }\n      // Between a jagged edge and the end of the row.\n      if (Types.isJaggedEdge(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Between noneditable fields and icons and the end of the row.\n      return this.constants_.LARGE_PADDING;\n    }\n    // Between inputs and the end of the row.\n    if (Types.isInput(prev) && !next) {\n      if (Types.isExternalInput(prev)) {\n        return this.constants_.NO_PADDING;\n      } else if (Types.isInlineInput(prev)) {\n        return this.constants_.LARGE_PADDING;\n      } else if (Types.isStatementInput(prev)) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n\n    // Spacing between a non-input and an input.\n    if (!Types.isInput(prev) && next && Types.isInput(next)) {\n      // Between an editable field and an input.\n      if (Types.isField(prev) && (prev as Field).isEditable) {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.SMALL_PADDING;\n        }\n      } else {\n        if (Types.isInlineInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isExternalInput(next)) {\n          return this.constants_.MEDIUM_LARGE_PADDING;\n        } else if (Types.isStatementInput(next)) {\n          return this.constants_.LARGE_PADDING;\n        }\n      }\n      return this.constants_.LARGE_PADDING - 1;\n    }\n\n    // Spacing between an icon and an icon or field.\n    if (Types.isIcon(prev) && next && !Types.isInput(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between an inline input and a field.\n    if (Types.isInlineInput(prev) && next && Types.isField(next)) {\n      // Editable field after inline input.\n      if ((next as Field).isEditable) {\n        return this.constants_.MEDIUM_PADDING;\n      } else {\n        // Noneditable field after inline input.\n        return this.constants_.LARGE_PADDING;\n      }\n    }\n\n    if (Types.isLeftSquareCorner(prev) && next) {\n      // Spacing between a hat and a corner\n      if (Types.isHat(next)) {\n        return this.constants_.NO_PADDING;\n      }\n      // Spacing between a square corner and a previous or next connection\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (Types.isLeftRoundedCorner(prev) && next) {\n      return next.notchOffset - this.constants_.CORNER_RADIUS;\n    }\n\n    // Spacing between two fields of the same editability.\n    if (Types.isField(prev) && next && Types.isField(next) &&\n        (prev as Field).isEditable === (next as Field).isEditable) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    // Spacing between anything and a jagged edge.\n    if (next && Types.isJaggedEdge(next)) {\n      return this.constants_.LARGE_PADDING;\n    }\n\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row) {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev) || Types.isBottomRow(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    if (prev.hasExternalInput && next.hasExternalInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (!prev.hasStatement && next.hasStatement) {\n      return this.constants_.BETWEEN_STATEMENT_PADDING_Y;\n    }\n    if (prev.hasStatement && next.hasStatement) {\n      return this.constants_.LARGE_PADDING;\n    }\n    if (prev.hasDummyInput || next.hasDummyInput) {\n      return this.constants_.LARGE_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable) {\n    if (Types.isSpacer(elem)) {\n      return row.yPos + elem.height / 2;\n    }\n    if (Types.isBottomRow(row)) {\n      const bottomRow = row as BottomRow;\n      const baseline =\n          bottomRow.yPos + bottomRow.height - bottomRow.descenderHeight;\n      if (Types.isNextConnection(elem)) {\n        return baseline + elem.height / 2;\n      }\n      return baseline - elem.height / 2;\n    }\n    if (Types.isTopRow(row)) {\n      const topRow = row as TopRow;\n      if (Types.isHat(elem)) {\n        return topRow.capline - elem.height / 2;\n      }\n      return topRow.capline + elem.height / 2;\n    }\n\n    let result = row.yPos;\n    if (Types.isField(elem) && row.hasStatement) {\n      const offset =\n          this.constants_.TALL_INPUT_FIELD_OFFSET_Y + elem.height / 2;\n      result += offset;\n    } else {\n      result += row.height / 2;\n    }\n    return result;\n  }\n\n  override finalize_() {\n    // Performance note: this could be combined with the draw pass, if the time\n    // that this takes is excessive.  But it shouldn't be, because it only\n    // accesses and sets properties that already exist on the objects.\n    let widestRowWithConnectedBlocks = 0;\n    let yCursor = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      row.xPos = this.startX;\n      yCursor += row.height;\n\n      widestRowWithConnectedBlocks =\n          Math.max(widestRowWithConnectedBlocks, row.widthWithConnectedBlocks);\n      // Add padding to the bottom row if block height is less than minimum\n      const heightWithoutHat = yCursor - this.topRow.ascenderHeight;\n      if (row === this.bottomRow &&\n          heightWithoutHat < this.constants_.MIN_BLOCK_HEIGHT) {\n        // But the hat height shouldn't be part of this.\n        const diff = this.constants_.MIN_BLOCK_HEIGHT - heightWithoutHat;\n        this.bottomRow.height += diff;\n        yCursor += diff;\n      }\n      this.recordElemPositions_(row);\n    }\n    if (this.outputConnection && this.block_.nextConnection &&\n        this.block_.nextConnection.isConnected()) {\n      const target = this.block_.nextConnection.targetBlock();\n      if (target) {\n        // Include width of connected block in value to stack width measurement.\n        widestRowWithConnectedBlocks = Math.max(\n            widestRowWithConnectedBlocks, target.getHeightWidth().width);\n      }\n    }\n\n    this.bottomRow.baseline = yCursor - this.bottomRow.descenderHeight;\n    this.widthWithChildren = widestRowWithConnectedBlocks + this.startX;\n\n    this.height = yCursor;\n    this.startY = this.topRow.capline;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.thrasos.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {RenderInfo} from './info.js';\n\n\n/**\n * The thrasos renderer. This is a more modern take on the legacy geras\n * renderer.\n *\n * Thrasos is the ancient Greek spirit of boldness.\n */\nexport class Renderer extends BaseRenderer {\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n}\n\nblockRendering.register('thrasos', Renderer);\n", "/** @file Re-exports of Blockly.thrasos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.thrasos');\n\nimport {RenderInfo} from './info.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {Renderer, RenderInfo};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.ConstantProvider');\n\nimport {ConnectionType} from '../../connection_type.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {Theme} from '../../theme.js';\nimport * as utilsColour from '../../utils/colour.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport type {Shape} from '../common/constants.js';\n\n\n/** An object containing sizing and path information about inside corners. */\nexport interface InsideCorners {\n  width: number;\n  height: number;\n  pathTop: string;\n  pathBottom: string;\n  rightWidth: number;\n  rightHeight: number;\n  pathTopRight: string;\n  pathBottomRight: string;\n}\n\n/**\n * An object that provides constants for rendering blocks in Zelos mode.\n */\nexport class ConstantProvider extends BaseConstantProvider {\n  GRID_UNIT = 4;\n  STATEMENT_INPUT_SPACER_MIN_WIDTH: number;\n\n  override CURSOR_COLOUR = '#ffa200';\n\n  /**\n   * Radius of the cursor for input and output connections.\n   */\n  CURSOR_RADIUS = 5;\n\n  override JAGGED_TEETH_HEIGHT = 0;\n\n  override JAGGED_TEETH_WIDTH = 0;\n  override START_HAT_HEIGHT = 22;\n\n  override START_HAT_WIDTH = 96;\n\n  override SHAPES = {HEXAGONAL: 1, ROUND: 2, SQUARE: 3, PUZZLE: 4, NOTCH: 5};\n\n  /**\n   * Map of output/input shapes and the amount they should cause a block to be\n   * padded. Outer key is the outer shape, inner key is the inner shape.\n   * When a block with the outer shape contains an input block with the inner\n   * shape on its left or right edge, the block elements are aligned such that\n   * the padding specified is reached.\n   */\n  SHAPE_IN_SHAPE_PADDING: {[key: number]: {[key: number]: number}} = {\n    1: {\n      // Outer shape: hexagon.\n      0: 5 * this.GRID_UNIT,  // Field in hexagon.\n      1: 2 * this.GRID_UNIT,  // Hexagon in hexagon.\n      2: 5 * this.GRID_UNIT,  // Round in hexagon.\n      3: 5 * this.GRID_UNIT,  // Square in hexagon.\n    },\n    2: {\n      // Outer shape: round.\n      0: 3 * this.GRID_UNIT,  // Field in round.\n      1: 3 * this.GRID_UNIT,  // Hexagon in round.\n      2: 1 * this.GRID_UNIT,  // Round in round.\n      3: 2 * this.GRID_UNIT,  // Square in round.\n    },\n    3: {\n      // Outer shape: square.\n      0: 2 * this.GRID_UNIT,  // Field in square.\n      1: 2 * this.GRID_UNIT,  // Hexagon in square.\n      2: 2 * this.GRID_UNIT,  // Round in square.\n      3: 2 * this.GRID_UNIT,  // Square in square.\n    },\n  };\n\n  override FULL_BLOCK_FIELDS = true;\n\n  override FIELD_TEXT_FONTWEIGHT = 'bold';\n\n  override FIELD_TEXT_FONTFAMILY =\n      '\"Helvetica Neue\", \"Segoe UI\", Helvetica, sans-serif';\n\n  override FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW = true;\n\n  override FIELD_DROPDOWN_COLOURED_DIV = true;\n\n  override FIELD_DROPDOWN_SVG_ARROW = true;\n  override FIELD_TEXTINPUT_BOX_SHADOW = true;\n\n  override FIELD_COLOUR_FULL_BLOCK = true;\n  MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH: number;\n\n  /** The selected glow colour. */\n  SELECTED_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  SELECTED_GLOW_SIZE = 0.5;\n\n  /** The replacement glow colour. */\n  REPLACEMENT_GLOW_COLOUR = '#fff200';\n\n  /** The size of the selected glow. */\n  REPLACEMENT_GLOW_SIZE = 2;\n\n  /**\n   * The ID of the selected glow filter, or the empty string if no filter is\n   * set.\n   */\n  selectedGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a selected glow, or null if not set.\n   */\n  private selectedGlowFilter_: SVGElement|null = null;\n\n  /**\n   * The ID of the replacement glow filter, or the empty string if no filter\n   * is set.\n   */\n  replacementGlowFilterId = '';\n\n  /**\n   * The <filter> element to use for a replacement glow, or null if not set.\n   */\n  private replacementGlowFilter_: SVGElement|null = null;\n\n  /**\n   * The object containing information about the hexagon used for a boolean\n   * reporter block. Null before init is called.\n   */\n  HEXAGONAL: Shape|null = null;\n\n  /**\n   * The object containing information about the hexagon used for a number or\n   * string reporter block. Null before init is called.\n   */\n  ROUNDED: Shape|null = null;\n\n  /**\n   * The object containing information about the hexagon used for a\n   * rectangular reporter block. Null before init is called.\n   */\n  SQUARED: Shape|null = null;\n\n  constructor() {\n    super();\n\n    this.SMALL_PADDING = this.GRID_UNIT;\n\n    this.MEDIUM_PADDING = 2 * this.GRID_UNIT;\n\n    this.MEDIUM_LARGE_PADDING = 3 * this.GRID_UNIT;\n\n    this.LARGE_PADDING = 4 * this.GRID_UNIT;\n\n    this.CORNER_RADIUS = 1 * this.GRID_UNIT;\n\n    this.NOTCH_WIDTH = 9 * this.GRID_UNIT;\n\n    this.NOTCH_HEIGHT = 2 * this.GRID_UNIT;\n\n    this.NOTCH_OFFSET_LEFT = 3 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT;\n\n    this.MIN_BLOCK_WIDTH = 2 * this.GRID_UNIT;\n\n    this.MIN_BLOCK_HEIGHT = 12 * this.GRID_UNIT;\n\n    this.EMPTY_STATEMENT_INPUT_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.TOP_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT = this.LARGE_PADDING;\n\n    this.BOTTOM_ROW_MIN_HEIGHT = this.CORNER_RADIUS;\n\n    this.BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.STATEMENT_BOTTOM_SPACER = -this.NOTCH_HEIGHT;\n\n    /** Minimum statement input spacer width. */\n    this.STATEMENT_INPUT_SPACER_MIN_WIDTH = 40 * this.GRID_UNIT;\n\n    this.STATEMENT_INPUT_PADDING_LEFT = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_PADDING = 4 * this.GRID_UNIT;\n\n    this.EMPTY_INLINE_INPUT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_MIN_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.DUMMY_INPUT_SHADOW_MIN_HEIGHT = 6 * this.GRID_UNIT;\n\n    this.CURSOR_WS_WIDTH = 20 * this.GRID_UNIT;\n\n    this.FIELD_TEXT_FONTSIZE = 3 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_RADIUS = this.CORNER_RADIUS;\n\n    this.FIELD_BORDER_RECT_X_PADDING = 2 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_Y_PADDING = 1.625 * this.GRID_UNIT;\n\n    this.FIELD_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = 8 * this.GRID_UNIT;\n\n    this.FIELD_DROPDOWN_SVG_ARROW_PADDING = this.FIELD_BORDER_RECT_X_PADDING;\n\n    this.FIELD_COLOUR_DEFAULT_WIDTH = 2 * this.GRID_UNIT;\n\n    this.FIELD_COLOUR_DEFAULT_HEIGHT = 4 * this.GRID_UNIT;\n\n    this.FIELD_CHECKBOX_X_OFFSET = 1 * this.GRID_UNIT;\n\n    /** The maximum width of a dynamic connection shape. */\n    this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH = 12 * this.GRID_UNIT;\n  }\n\n  override setFontConstants_(theme: Theme) {\n    super.setFontConstants_(theme);\n\n    this.FIELD_BORDER_RECT_HEIGHT =\n        this.FIELD_TEXT_HEIGHT + this.FIELD_BORDER_RECT_Y_PADDING * 2;\n    this.FIELD_DROPDOWN_BORDER_RECT_HEIGHT = this.FIELD_BORDER_RECT_HEIGHT;\n  }\n\n  override init() {\n    super.init();\n    this.HEXAGONAL = this.makeHexagonal();\n    this.ROUNDED = this.makeRounded();\n    this.SQUARED = this.makeSquared();\n\n    this.STATEMENT_INPUT_NOTCH_OFFSET = this.NOTCH_OFFSET_LEFT +\n        (this.INSIDE_CORNERS as InsideCorners).rightWidth;\n  }\n\n  override setDynamicProperties_(theme: Theme) {\n    super.setDynamicProperties_(theme);\n\n    this.SELECTED_GLOW_COLOUR = theme.getComponentStyle('selectedGlowColour') ||\n        this.SELECTED_GLOW_COLOUR;\n    const selectedGlowSize =\n        Number(theme.getComponentStyle('selectedGlowSize'));\n    this.SELECTED_GLOW_SIZE = selectedGlowSize && !isNaN(selectedGlowSize) ?\n        selectedGlowSize :\n        this.SELECTED_GLOW_SIZE;\n    this.REPLACEMENT_GLOW_COLOUR =\n        theme.getComponentStyle('replacementGlowColour') ||\n        this.REPLACEMENT_GLOW_COLOUR;\n    const replacementGlowSize =\n        Number(theme.getComponentStyle('replacementGlowSize'));\n    this.REPLACEMENT_GLOW_SIZE =\n        replacementGlowSize && !isNaN(replacementGlowSize) ?\n        replacementGlowSize :\n        this.REPLACEMENT_GLOW_SIZE;\n  }\n\n  override dispose() {\n    super.dispose();\n    if (this.selectedGlowFilter_) {\n      dom.removeNode(this.selectedGlowFilter_);\n    }\n    if (this.replacementGlowFilter_) {\n      dom.removeNode(this.replacementGlowFilter_);\n    }\n  }\n\n  override makeStartHat() {\n    const height = this.START_HAT_HEIGHT;\n    const width = this.START_HAT_WIDTH;\n\n    const mainPath = svgPaths.curve('c', [\n      svgPaths.point(25, -height),\n      svgPaths.point(71, -height),\n      svgPaths.point(width, 0),\n    ]);\n    return {height, width, path: mainPath};\n  }\n\n  /**\n   * Create sizing and path information about a hexagonal shape.\n   *\n   * @returns An object containing sizing and path information about a hexagonal\n   *     shape for connections.\n   */\n  protected makeHexagonal(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n\n    /**\n     * Make the main path for the hexagonal connection shape out of two lines.\n     * The lines are defined with relative positions and require the block\n     * height. The 'up' and 'down' versions of the paths are the same, but the Y\n     * sign flips.  The 'left' and 'right' versions of the path are also the\n     * same, but the X sign flips.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const halfHeight = height / 2;\n      const width = halfHeight > maxWidth ? maxWidth : halfHeight;\n      const forward = up ? -1 : 1;\n      const direction = right ? -1 : 1;\n      const dy = forward * height / 2;\n      return svgPaths.lineTo(-direction * width, dy) +\n          svgPaths.lineTo(direction * width, dy);\n    }\n\n    return {\n      type: this.SHAPES.HEXAGONAL,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a rounded shape.\n   *\n   * @returns An object containing sizing and path information about a rounded\n   *     shape for connections.\n   */\n  protected makeRounded(): Shape {\n    const maxWidth = this.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n    const maxHeight = maxWidth * 2;\n\n    /**\n     * Make the main path for the rounded connection shape out of two arcs and\n     * a line that joins them.  The arcs are defined with relative positions.\n     * Usually, the height of the block is split between the two arcs. In the\n     * case where the height of the block exceeds the maximum height, a line is\n     * drawn in between the two arcs. The 'up' and 'down' versions of the paths\n     * are the same, but the Y sign flips.  The 'up' and 'right' versions of the\n     * path flip the sweep-flag which moves the arc at negative angles.\n     *\n     * @param blockHeight The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a rounded connection.\n     */\n    function makeMainPath(\n        blockHeight: number, up: boolean, right: boolean): string {\n      const remainingHeight =\n          blockHeight > maxHeight ? blockHeight - maxHeight : 0;\n      const height = blockHeight > maxHeight ? maxHeight : blockHeight;\n      const radius = height / 2;\n      return svgPaths.arc(\n                 'a', '0 0,1', radius,\n                 svgPaths.point(\n                     (up ? -1 : 1) * radius, (up ? -1 : 1) * radius)) +\n          svgPaths.lineOnAxis('v', (right ? 1 : -1) * remainingHeight) +\n          svgPaths.arc(\n              'a', '0 0,1', radius,\n              svgPaths.point((up ? 1 : -1) * radius, (up ? -1 : 1) * radius));\n    }\n\n    return {\n      type: this.SHAPES.ROUND,\n      isDynamic: true,\n      width(height: number): number {\n        const halfHeight = height / 2;\n        return halfHeight > maxWidth ? maxWidth : halfHeight;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  /**\n   * Create sizing and path information about a squared shape.\n   *\n   * @returns An object containing sizing and path information about a squared\n   *     shape for connections.\n   */\n  protected makeSquared(): Shape {\n    const radius = this.CORNER_RADIUS;\n\n    /**\n     * Make the main path for the squared connection shape out of two corners\n     * and a single line in-between (a and v). These are defined in relative\n     * positions and require the height of the block.\n     * The 'left' and 'right' versions of the paths are the same, but the Y sign\n     * flips.  The 'up' and 'down' versions of the path determine where the\n     * corner point is placed and in turn the direction of the corners.\n     *\n     * @param height The height of the block the connection is on.\n     * @param up True if the path should be drawn from bottom to top, false\n     *     otherwise.\n     * @param right True if the path is for the right side of the block.\n     * @returns A path fragment describing a squared connection.\n     */\n    function makeMainPath(height: number, up: boolean, right: boolean): string {\n      const innerHeight = height - radius * 2;\n      return svgPaths.arc(\n                 'a', '0 0,1', radius,\n                 svgPaths.point(\n                     (up ? -1 : 1) * radius, (up ? -1 : 1) * radius)) +\n          svgPaths.lineOnAxis('v', (right ? 1 : -1) * innerHeight) +\n          svgPaths.arc(\n              'a', '0 0,1', radius,\n              svgPaths.point((up ? 1 : -1) * radius, (up ? -1 : 1) * radius));\n    }\n\n    return {\n      type: this.SHAPES.SQUARE,\n      isDynamic: true,\n      width(_height: number): number {\n        return radius;\n      },\n      height(height: number): number {\n        return height;\n      },\n      connectionOffsetY(connectionHeight: number): number {\n        return connectionHeight / 2;\n      },\n      connectionOffsetX(connectionWidth: number): number {\n        return -connectionWidth;\n      },\n      pathDown(height: number): string {\n        return makeMainPath(height, false, false);\n      },\n      pathUp(height: number): string {\n        return makeMainPath(height, true, false);\n      },\n      pathRightDown(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n      pathRightUp(height: number): string {\n        return makeMainPath(height, false, true);\n      },\n    };\n  }\n\n  override shapeFor(connection: RenderedConnection): Shape {\n    let checks = connection.getCheck();\n    if (!checks && connection.targetConnection) {\n      checks = connection.targetConnection.getCheck();\n    }\n    let outputShape;\n    switch (connection.type) {\n      case ConnectionType.INPUT_VALUE:\n      case ConnectionType.OUTPUT_VALUE:\n        outputShape = connection.getSourceBlock().getOutputShape();\n        // If the block has an output shape set, use that instead.\n        if (outputShape !== null) {\n          switch (outputShape) {\n            case this.SHAPES.HEXAGONAL:\n              return this.HEXAGONAL!;\n            case this.SHAPES.ROUND:\n              return this.ROUNDED!;\n            case this.SHAPES.SQUARE:\n              return this.SQUARED!;\n          }\n        }\n        // Includes doesn't work in IE.\n        if (checks && checks.indexOf('Boolean') !== -1) {\n          return this.HEXAGONAL!;\n        }\n        if (checks && checks.indexOf('Number') !== -1) {\n          return this.ROUNDED!;\n        }\n        if (checks && checks.indexOf('String') !== -1) {\n          return this.ROUNDED!;\n        }\n        return this.ROUNDED!;\n      case ConnectionType.PREVIOUS_STATEMENT:\n      case ConnectionType.NEXT_STATEMENT:\n        return this.NOTCH!;\n      default:\n        throw Error('Unknown type');\n    }\n  }\n\n  override makeNotch() {\n    const width = this.NOTCH_WIDTH;\n    const height = this.NOTCH_HEIGHT;\n\n    const innerWidth = width / 3;\n    const curveWidth = innerWidth / 3;\n\n    const halfHeight = height / 2;\n    const quarterHeight = halfHeight / 2;\n\n    /**\n     * Make the main path for the notch.\n     *\n     * @param dir Direction multiplier to apply to horizontal offsets along the\n     *     path. Either 1 or -1.\n     * @returns A path fragment describing a notch.\n     */\n    function makeMainPath(dir: number): string {\n      return svgPaths.curve(\n                 'c',\n                 [\n                   svgPaths.point(dir * curveWidth / 2, 0),\n                   svgPaths.point(dir * curveWidth * 3 / 4, quarterHeight / 2),\n                   svgPaths.point(dir * curveWidth, quarterHeight),\n                 ]) +\n          svgPaths.line([svgPaths.point(dir * curveWidth, halfHeight)]) +\n          svgPaths.curve(\n              'c',\n              [\n                svgPaths.point(dir * curveWidth / 4, quarterHeight / 2),\n                svgPaths.point(dir * curveWidth / 2, quarterHeight),\n                svgPaths.point(dir * curveWidth, quarterHeight),\n              ]) +\n          svgPaths.lineOnAxis('h', dir * innerWidth) +\n          svgPaths.curve(\n              'c',\n              [\n                svgPaths.point(dir * curveWidth / 2, 0),\n                svgPaths.point(dir * curveWidth * 3 / 4, -(quarterHeight / 2)),\n                svgPaths.point(dir * curveWidth, -quarterHeight),\n              ]) +\n          svgPaths.line([svgPaths.point(dir * curveWidth, -halfHeight)]) +\n          svgPaths.curve('c', [\n            svgPaths.point(dir * curveWidth / 4, -(quarterHeight / 2)),\n            svgPaths.point(dir * curveWidth / 2, -quarterHeight),\n            svgPaths.point(dir * curveWidth, -quarterHeight),\n          ]);\n    }\n\n    const pathLeft = makeMainPath(1);\n    const pathRight = makeMainPath(-1);\n\n    return {\n      type: this.SHAPES.NOTCH,\n      width,\n      height,\n      pathLeft,\n      pathRight,\n    };\n  }\n\n  override makeInsideCorners() {\n    const radius = this.CORNER_RADIUS;\n\n    const innerTopLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(-radius, radius));\n\n    const innerTopRightCorner =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(-radius, radius));\n\n    const innerBottomLeftCorner =\n        svgPaths.arc('a', '0 0,0', radius, svgPaths.point(radius, radius));\n\n    const innerBottomRightCorner =\n        svgPaths.arc('a', '0 0,1', radius, svgPaths.point(radius, radius));\n\n    return {\n      width: radius,\n      height: radius,\n      pathTop: innerTopLeftCorner,\n      pathBottom: innerBottomLeftCorner,\n      rightWidth: radius,\n      rightHeight: radius,\n      pathTopRight: innerTopRightCorner,\n      pathBottomRight: innerBottomRightCorner,\n    };\n  }\n\n  override generateSecondaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.15) || colour;\n  }\n\n  override generateTertiaryColour_(colour: string) {\n    return utilsColour.blend('#000', colour, 0.25) || colour;\n  }\n\n  override createDom(svg: SVGElement, tagName: string, selector: string) {\n    super.createDom(svg, tagName, selector);\n    /*\n        <defs>\n          ... filters go here ...\n        </defs>\n        */\n    const defs = dom.createSvgElement(Svg.DEFS, {}, svg);\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const selectedGlowFilter = dom.createSvgElement(\n        Svg.FILTER, {\n          'id': 'blocklySelectedGlowFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        defs);\n    dom.createSvgElement(\n        Svg.FEGAUSSIANBLUR,\n        {'in': 'SourceGraphic', 'stdDeviation': this.SELECTED_GLOW_SIZE},\n        selectedGlowFilter);\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const selectedComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER, {'result': 'outBlur'}, selectedGlowFilter);\n    dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        selectedComponentTransfer);\n    // Color the highlight\n    dom.createSvgElement(\n        Svg.FEFLOOD, {\n          'flood-color': this.SELECTED_GLOW_COLOUR,\n          'flood-opacity': 1,\n          'result': 'outColor',\n        },\n        selectedGlowFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        selectedGlowFilter);\n    this.selectedGlowFilterId = selectedGlowFilter.id;\n    this.selectedGlowFilter_ = selectedGlowFilter;\n\n    // Using a dilate distorts the block shape.\n    // Instead use a gaussian blur, and then set all alpha to 1 with a transfer.\n    const replacementGlowFilter = dom.createSvgElement(\n        Svg.FILTER, {\n          'id': 'blocklyReplacementGlowFilter' + this.randomIdentifier,\n          'height': '160%',\n          'width': '180%',\n          'y': '-30%',\n          'x': '-40%',\n        },\n        defs);\n    dom.createSvgElement(\n        Svg.FEGAUSSIANBLUR,\n        {'in': 'SourceGraphic', 'stdDeviation': this.REPLACEMENT_GLOW_SIZE},\n        replacementGlowFilter);\n    // Set all gaussian blur pixels to 1 opacity before applying flood\n    const replacementComponentTransfer = dom.createSvgElement(\n        Svg.FECOMPONENTTRANSFER, {'result': 'outBlur'}, replacementGlowFilter);\n    dom.createSvgElement(\n        Svg.FEFUNCA,\n        {'type': 'table', 'tableValues': '0 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1'},\n        replacementComponentTransfer);\n    // Color the highlight\n    dom.createSvgElement(\n        Svg.FEFLOOD, {\n          'flood-color': this.REPLACEMENT_GLOW_COLOUR,\n          'flood-opacity': 1,\n          'result': 'outColor',\n        },\n        replacementGlowFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'outColor',\n          'in2': 'outBlur',\n          'operator': 'in',\n          'result': 'outGlow',\n        },\n        replacementGlowFilter);\n    dom.createSvgElement(\n        Svg.FECOMPOSITE, {\n          'in': 'SourceGraphic',\n          'in2': 'outGlow',\n          'operator': 'over',\n        },\n        replacementGlowFilter);\n    this.replacementGlowFilterId = replacementGlowFilter.id;\n    this.replacementGlowFilter_ = replacementGlowFilter;\n  }\n\n  override getCSS_(selector: string) {\n    return [\n      /* eslint-disable indent */\n      // Text.\n      `${selector} .blocklyText,`,\n      `${selector} .blocklyFlyoutLabelText {`,\n      `font: ${this.FIELD_TEXT_FONTWEIGHT} ${this.FIELD_TEXT_FONTSIZE}` +\n          `pt ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n\n      // Fields.\n      `${selector} .blocklyText {`,\n      `fill: #fff;`,\n      `}`,\n      `${selector} .blocklyNonEditableText>rect:not(.blocklyDropdownRect),`,\n      `${selector} .blocklyEditableText>rect:not(.blocklyDropdownRect) {`,\n      `fill: ${this.FIELD_BORDER_RECT_COLOUR};`,\n      `}`,\n      `${selector} .blocklyNonEditableText>text,`,\n      `${selector} .blocklyEditableText>text,`,\n      `${selector} .blocklyNonEditableText>g>text,`,\n      `${selector} .blocklyEditableText>g>text {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Flyout labels.\n      `${selector} .blocklyFlyoutLabelText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Bubbles.\n      `${selector} .blocklyText.blocklyBubbleText {`,\n      `fill: #575E75;`,\n      `}`,\n\n      // Editable field hover.\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>rect,`,\n      `${selector} .blocklyDraggable:not(.blocklyDisabled)`,\n      ` .blocklyEditableText:not(.editing):hover>.blocklyPath {`,\n      `stroke: #fff;`,\n      `stroke-width: 2;`,\n      `}`,\n\n      // Text field input.\n      `${selector} .blocklyHtmlInput {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `font-weight: ${this.FIELD_TEXT_FONTWEIGHT};`,\n      `color: #575E75;`,\n      `}`,\n\n      // Dropdown field.\n      `${selector} .blocklyDropdownText {`,\n      `fill: #fff !important;`,\n      `}`,\n\n      // Widget and Dropdown Div\n      `${selector}.blocklyWidgetDiv .goog-menuitem,`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem {`,\n      `font-family: ${this.FIELD_TEXT_FONTFAMILY};`,\n      `}`,\n      `${selector}.blocklyDropDownDiv .goog-menuitem-content {`,\n      `color: #fff;`,\n      `}`,\n\n      // Connection highlight.\n      `${selector} .blocklyHighlightedConnectionPath {`,\n      `stroke: ${this.SELECTED_GLOW_COLOUR};`,\n      `}`,\n\n      // Disabled outline paths.\n      `${selector} .blocklyDisabled > .blocklyOutlinePath {`,\n      `fill: url(#blocklyDisabledPattern${this.randomIdentifier})`,\n      `}`,\n\n      // Insertion marker.\n      `${selector} .blocklyInsertionMarker>.blocklyPath {`,\n      `fill-opacity: ${this.INSERTION_MARKER_OPACITY};`,\n      `stroke: none;`,\n      `}`,\n    ];\n  }\n}\n/* eslint-enable indent */\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.Drawer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport * as svgPaths from '../../utils/svg_paths.js';\nimport type {BaseShape, DynamicShape, Notch} from '../common/constants.js';\nimport * as debug from '../common/debug.js';\nimport {Drawer as BaseDrawer} from '../common/drawer.js';\nimport type {InlineInput} from '../measurables/inline_input.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {InsideCorners} from './constants.js';\nimport type {RenderInfo} from './info.js';\nimport type {StatementInput} from './measurables/inputs.js';\nimport type {PathObject} from './path_object.js';\n\n\n/**\n * An object that draws a block based on the given rendering information.\n */\nexport class Drawer extends BaseDrawer {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override info_!: RenderInfo;\n\n  /**\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   */\n  constructor(block: BlockSvg, info: RenderInfo) {\n    super(block, info);\n  }\n\n  override draw() {\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.beginDrawing();\n    this.hideHiddenIcons_();\n    this.drawOutline_();\n    this.drawInternals_();\n\n    pathObject.setPath(this.outlinePath_ + '\\n' + this.inlinePath_);\n    if (this.info_.RTL) {\n      pathObject.flipRTL();\n    }\n    if (debug.isDebuggerEnabled()) {\n      this.block_?.renderingDebugger?.drawDebug(this.block_, this.info_);\n    }\n    this.recordSizeOnBlock_();\n    if (this.info_.outputConnection) {\n      // Store the output connection shape type for parent blocks to use during\n      // rendering.\n      pathObject.outputShapeType = this.info_.outputConnection.shape.type;\n    }\n    pathObject.endDrawing();\n  }\n\n  override drawOutline_() {\n    if (this.info_.outputConnection &&\n        this.info_.outputConnection.isDynamicShape &&\n        !this.info_.hasStatementInput &&\n        !this.info_.bottomRow.hasNextConnection) {\n      this.drawFlatTop_();\n      this.drawRightDynamicConnection_();\n      this.drawFlatBottom_();\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawOutline_();\n    }\n  }\n\n  override drawLeft_() {\n    if (this.info_.outputConnection &&\n        this.info_.outputConnection.isDynamicShape) {\n      this.drawLeftDynamicConnection_();\n    } else {\n      super.drawLeft_();\n    }\n  }\n\n  /**\n   * Add steps for the right side of a row that does not have value or\n   * statement input connections.\n   *\n   * @param row The row to draw the side of.\n   */\n  protected override drawRightSideRow_(row: Row) {\n    if (row.height <= 0) {\n      return;\n    }\n    if (Types.isSpacer(row)) {\n      const spacerRow = row as SpacerRow;\n      if (spacerRow.precedesStatement || spacerRow.followsStatement) {\n        const cornerHeight =\n            (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight;\n        const remainingHeight =\n            spacerRow.height - (spacerRow.precedesStatement ? cornerHeight : 0);\n        this.outlinePath_ +=\n            (spacerRow.followsStatement ?\n                 (this.constants_.INSIDE_CORNERS as InsideCorners)\n                     .pathBottomRight :\n                 '') +\n            (remainingHeight > 0 ?\n                 svgPaths.lineOnAxis('V', spacerRow.yPos + remainingHeight) :\n                 '') +\n            (spacerRow.precedesStatement ?\n                 (this.constants_.INSIDE_CORNERS as InsideCorners)\n                     .pathTopRight :\n                 '');\n        return;\n      }\n    }\n    this.outlinePath_ += svgPaths.lineOnAxis('V', row.yPos + row.height);\n  }\n\n  /**\n   * Add steps to draw the right side of an output with a dynamic connection.\n   */\n  protected drawRightDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n          `Cannot draw the output connection of a block that doesn't have one`);\n    }\n    this.outlinePath_ += (this.info_.outputConnection.shape as DynamicShape)\n                             .pathRightDown(this.info_.outputConnection.height);\n  }\n\n  /**\n   * Add steps to draw the left side of an output with a dynamic connection.\n   */\n  protected drawLeftDynamicConnection_() {\n    if (!this.info_.outputConnection) {\n      throw new Error(\n          `Cannot draw the output connection of a block that doesn't have one`);\n    }\n    this.positionOutputConnection_();\n\n    this.outlinePath_ += (this.info_.outputConnection.shape as DynamicShape)\n                             .pathUp(this.info_.outputConnection.height);\n\n    // Close off the path.  This draws a vertical line up to the start of the\n    // block's path, which may be either a rounded or a sharp corner.\n    this.outlinePath_ += 'z';\n  }\n\n  /** Add steps to draw a flat top row. */\n  protected drawFlatTop_() {\n    const topRow = this.info_.topRow;\n    this.positionPreviousConnection_();\n\n    this.outlinePath_ += svgPaths.moveBy(topRow.xPos, this.info_.startY);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('h', topRow.width);\n  }\n\n  /** Add steps to draw a flat bottom row. */\n  protected drawFlatBottom_() {\n    const bottomRow = this.info_.bottomRow;\n    this.positionNextConnection_();\n\n    this.outlinePath_ += svgPaths.lineOnAxis('V', bottomRow.baseline);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('h', -bottomRow.width);\n  }\n\n  override drawInlineInput_(input: InlineInput) {\n    this.positionInlineInputConnection_(input);\n\n    const inputName = input.input.name;\n    if (input.connectedBlock || this.info_.isInsertionMarker) {\n      return;\n    }\n\n    const width = input.width - input.connectionWidth * 2;\n    const height = input.height;\n    const yPos = input.centerline - height / 2;\n\n    const connectionRight = input.xPos + input.connectionWidth;\n\n    const outlinePath = svgPaths.moveTo(connectionRight, yPos) +\n        svgPaths.lineOnAxis('h', width) +\n        (input.shape as DynamicShape).pathRightDown(input.height) +\n        svgPaths.lineOnAxis('h', -width) +\n        (input.shape as DynamicShape).pathUp(input.height) + 'z';\n    const pathObject = this.block_.pathObject as PathObject;\n    pathObject.setOutlinePath(inputName, outlinePath);\n  }\n\n  override drawStatementInput_(row: Row) {\n    const input = row.getLastInput() as StatementInput;\n    // Where to start drawing the notch, which is on the right side in LTR.\n    const x = input.xPos + input.notchOffset + (input.shape as BaseShape).width;\n\n    const innerTopLeftCorner = (input.shape as Notch).pathRight +\n        svgPaths.lineOnAxis(\n            'h', -(input.notchOffset - this.constants_.INSIDE_CORNERS.width)) +\n        this.constants_.INSIDE_CORNERS.pathTop;\n\n    const innerHeight = row.height - 2 * this.constants_.INSIDE_CORNERS.height;\n\n    const innerBottomLeftCorner = this.constants_.INSIDE_CORNERS.pathBottom +\n        svgPaths.lineOnAxis(\n            'h', input.notchOffset - this.constants_.INSIDE_CORNERS.width) +\n        (input.connectedBottomNextConnection ? '' :\n                                               (input.shape as Notch).pathLeft);\n\n    this.outlinePath_ += svgPaths.lineOnAxis('H', x) + innerTopLeftCorner +\n        svgPaths.lineOnAxis('v', innerHeight) + innerBottomLeftCorner +\n        svgPaths.lineOnAxis('H', row.xPos + row.width);\n\n    this.positionStatementInputConnection_(row);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.BottomRow');\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {BottomRow as BaseBottomRow} from '../../../renderers/measurables/bottom_row.js';\n\n\n/**\n * An object containing information about what elements are in the bottom row of\n * a block as well as spacing information for the top row.\n * Elements in a bottom row can consist of corners, spacers and next\n * connections.\n */\nexport class BottomRow extends BaseBottomRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection && !block.statementInputCount &&\n        !block.nextConnection;\n  }\n}\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.StatementInput');\n\n/* eslint-disable-next-line no-unused-vars */\nimport type {Input} from '../../../input.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {StatementInput as BaseStatementInput} from '../../../renderers/measurables/statement_input.js';\n\n\n/**\n * An object containing information about the space a statement input takes up\n * during rendering.\n */\nexport class StatementInput extends BaseStatementInput {\n  connectedBottomNextConnection = false;\n\n  /**\n   * @param constants The rendering constants provider.\n   * @param input The statement input to measure and store information for.\n   */\n  constructor(constants: ConstantProvider, input: Input) {\n    super(constants, input);\n\n    if (this.connectedBlock) {\n      // Find the bottom-most connected block in the stack.\n      let block = this.connectedBlock;\n      let nextBlock;\n      while (nextBlock = block.getNextBlock()) {\n        block = nextBlock;\n      }\n      if (!block.nextConnection) {\n        this.height = this.connectedBlockHeight;\n        this.connectedBottomNextConnection = true;\n      }\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.RightConnectionShape');\n\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {Measurable} from '../../../renderers/measurables/base.js';\nimport {Types} from '../../../renderers/measurables/types.js';\n\n\n/**\n * An object containing information about the space a right connection shape\n * takes up during rendering.\n */\nexport class RightConnectionShape extends Measurable {\n  // Size is dynamic\n  override height = 0;\n  override width = 0;\n\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n    this.type |= Types.getType('RIGHT_CONNECTION');\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.TopRow');\n\nimport type {BlockSvg} from '../../../block_svg.js';\nimport type {ConstantProvider} from '../../../renderers/common/constants.js';\nimport {TopRow as BaseTopRow} from '../../../renderers/measurables/top_row.js';\n\n\n/**\n * An object containing information about what elements are in the top row of a\n * block as well as sizing information for the top row.\n * Elements in a top row can consist of corners, hats, spacers, and previous\n * connections.\n * After this constructor is called, the row will contain all non-spacer\n * elements it needs.\n */\nexport class TopRow extends BaseTopRow {\n  /**\n   * @param constants The rendering constants provider.\n   */\n  constructor(constants: ConstantProvider) {\n    super(constants);\n  }\n\n  override endsWithElemSpacer() {\n    return false;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasLeftSquareCorner(block: BlockSvg) {\n    const hasHat =\n        (block.hat ? block.hat === 'cap' : this.constants_.ADD_START_HATS) &&\n        !block.outputConnection && !block.previousConnection;\n    return !!block.outputConnection || hasHat;\n  }\n\n  /** Render a round corner unless the block has an output connection. */\n  override hasRightSquareCorner(block: BlockSvg) {\n    return !!block.outputConnection && !block.statementInputCount &&\n        !block.nextConnection;\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.RenderInfo');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport {FieldImage} from '../../field_image.js';\nimport {FieldLabel} from '../../field_label.js';\nimport {FieldTextInput} from '../../field_textinput.js';\nimport {Align, Input} from '../../input.js';\nimport {inputTypes} from '../../input_types.js';\nimport {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport type {Measurable} from '../measurables/base.js';\nimport {Field} from '../measurables/field.js';\nimport {InRowSpacer} from '../measurables/in_row_spacer.js';\nimport {InputConnection} from '../measurables/input_connection.js';\nimport type {Row} from '../measurables/row.js';\nimport type {SpacerRow} from '../measurables/spacer_row.js';\nimport {Types} from '../measurables/types.js';\n\nimport type {ConstantProvider, InsideCorners} from './constants.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport type {PathObject} from './path_object.js';\nimport type {Renderer} from './renderer.js';\n\n\n/**\n * An object containing all sizing information needed to draw this block.\n *\n * This measure pass does not propagate changes to the block (although fields\n * may choose to rerender when getSize() is called).  However, calling it\n * repeatedly may be expensive.\n */\nexport class RenderInfo extends BaseRenderInfo {\n  override topRow: TopRow;\n  override bottomRow: BottomRow;\n  override constants_: ConstantProvider;\n  override renderer_: Renderer;\n\n  override isInline = true;\n  isMultiRow: boolean;\n  hasStatementInput: boolean;\n  rightSide: RightConnectionShape|null;\n  private readonly rightAlignedDummyInputs_: WeakMap<Row, Input>;\n\n  /**\n   * @param renderer The renderer in use.\n   * @param block The block to measure.\n   */\n  constructor(renderer: Renderer, block: BlockSvg) {\n    super(renderer, block);\n\n    this.renderer_ = renderer;\n\n    this.constants_ = this.renderer_.getConstants();\n\n    /**\n     * An object with rendering information about the top row of the block.\n     */\n    this.topRow = new TopRow(this.constants_);\n\n    /**\n     * An object with rendering information about the bottom row of the block.\n     */\n    this.bottomRow = new BottomRow(this.constants_);\n\n    /**\n     * Whether the block should be rendered as a multi-line block, either\n     * because it's not inline or because it has been collapsed.\n     */\n    this.isMultiRow = !block.getInputsInline() || block.isCollapsed();\n\n    /**\n     * Whether or not the block has a statement input in one of its rows.\n     */\n    this.hasStatementInput = block.statementInputCount > 0;\n\n    /**\n     * An object with rendering information about the right connection shape.\n     */\n    this.rightSide = this.outputConnection ?\n        new RightConnectionShape(this.constants_) :\n        null;\n\n    /**\n     * A map of rows to right aligned dummy inputs within those rows. Used to\n     * add padding between left and right aligned inputs.\n     */\n    this.rightAlignedDummyInputs_ = new WeakMap();\n  }\n\n  /**\n   * Get the block renderer in use.\n   *\n   * @returns The block renderer in use.\n   */\n  override getRenderer(): Renderer {\n    return this.renderer_ as Renderer;\n  }\n\n  override measure() {\n    // Modifying parent measure method to add `adjustXPosition_`.\n    this.createRows_();\n    this.addElemSpacing_();\n    this.addRowSpacing_();\n    this.adjustXPosition_();\n    this.computeBounds_();\n    this.alignRowElements_();\n    this.finalize_();\n  }\n\n  override shouldStartNewRow_(input: Input, lastInput: Input): boolean {\n    // If this is the first input, just add to the existing row.\n    // That row is either empty or has some icons in it.\n    if (!lastInput) {\n      return false;\n    }\n    // A statement input or an input following one always gets a new row.\n    if (input.type === inputTypes.STATEMENT ||\n        lastInput.type === inputTypes.STATEMENT) {\n      return true;\n    }\n    // Value and dummy inputs get new row if inputs are not inlined.\n    if (input.type === inputTypes.VALUE || input.type === inputTypes.DUMMY) {\n      return !this.isInline || this.isMultiRow;\n    }\n    return false;\n  }\n\n  override getDesiredRowWidth_(row: Row): number {\n    if (row.hasStatement) {\n      const rightCornerWidth =\n          (this.constants_.INSIDE_CORNERS as InsideCorners).rightWidth || 0;\n      return this.width - this.startX - rightCornerWidth;\n    }\n    return super.getDesiredRowWidth_(row);\n  }\n\n  override getInRowSpacing_(prev: Measurable|null, next: Measurable|null):\n      number {\n    if (!prev || !next) {\n      // No need for padding at the beginning or end of the row if the\n      // output shape is dynamic.\n      if (this.outputConnection && this.outputConnection.isDynamicShape &&\n          !this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n        return this.constants_.NO_PADDING;\n      }\n    }\n    if (!prev) {\n      // Statement input padding.\n      if (next && Types.isStatementInput(next)) {\n        return this.constants_.STATEMENT_INPUT_PADDING_LEFT;\n      }\n    }\n    // Spacing between a rounded corner and a previous or next connection.\n    if (prev && Types.isLeftRoundedCorner(prev) && next) {\n      if (Types.isPreviousConnection(next) || Types.isNextConnection(next)) {\n        return next.notchOffset - this.constants_.CORNER_RADIUS;\n      }\n    }\n    // Spacing between a square corner and a hat.\n    if (prev && Types.isLeftSquareCorner(prev) && next && Types.isHat(next)) {\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowHeight_(prev: Row, next: Row): number {\n    // If we have an empty block add a spacer to increase the height.\n    if (Types.isTopRow(prev) && Types.isBottomRow(next)) {\n      return this.constants_.EMPTY_BLOCK_SPACER_HEIGHT;\n    }\n    const followsStatement = Types.isInputRow(prev) && prev.hasStatement;\n    const precedesStatement = Types.isInputRow(next) && next.hasStatement;\n    if (precedesStatement || followsStatement) {\n      const cornerHeight =\n          (this.constants_.INSIDE_CORNERS as InsideCorners).rightHeight || 0;\n      const height = Math.max(this.constants_.NOTCH_HEIGHT, cornerHeight);\n      return precedesStatement && followsStatement ?\n          Math.max(height, this.constants_.DUMMY_INPUT_MIN_HEIGHT) :\n          height;\n    }\n    // Top and bottom rows act as a spacer so we don't need any extra padding.\n    if (Types.isTopRow(prev)) {\n      const topRow = prev as TopRow;\n      if (!topRow.hasPreviousConnection &&\n          (!this.outputConnection || this.hasStatementInput)) {\n        return Math.abs(\n            this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS);\n      }\n      return this.constants_.NO_PADDING;\n    }\n    if (Types.isBottomRow(next)) {\n      const bottomRow = next as BottomRow;\n      if (!this.outputConnection) {\n        const topHeight = Math.max(\n                              this.topRow.minHeight,\n                              Math.max(\n                                  this.constants_.NOTCH_HEIGHT,\n                                  this.constants_.CORNER_RADIUS)) -\n            this.constants_.CORNER_RADIUS;\n        return topHeight;\n      } else if (!bottomRow.hasNextConnection && this.hasStatementInput) {\n        return Math.abs(\n            this.constants_.NOTCH_HEIGHT - this.constants_.CORNER_RADIUS);\n      }\n      return this.constants_.NO_PADDING;\n    }\n    return this.constants_.MEDIUM_PADDING;\n  }\n\n  override getSpacerRowWidth_(prev: Row, next: Row): number {\n    const width = this.width - this.startX;\n    if (Types.isInputRow(prev) && prev.hasStatement ||\n        Types.isInputRow(next) && next.hasStatement) {\n      return Math.max(width, this.constants_.STATEMENT_INPUT_SPACER_MIN_WIDTH);\n    }\n    return width;\n  }\n\n  override getElemCenterline_(row: Row, elem: Measurable): number {\n    if (row.hasStatement && !Types.isSpacer(elem) &&\n        !Types.isStatementInput(elem)) {\n      return row.yPos + this.constants_.EMPTY_STATEMENT_INPUT_HEIGHT / 2;\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      if (connectedBlock && connectedBlock.outputConnection &&\n          connectedBlock.nextConnection) {\n        return row.yPos + connectedBlock.height / 2;\n      }\n    }\n    return super.getElemCenterline_(row, elem);\n  }\n\n  override addInput_(input: Input, activeRow: Row) {\n    // If we have two dummy inputs on the same row, one aligned left and the\n    // other right, keep track of the right aligned dummy input so we can add\n    // padding later.\n    if (input.type === inputTypes.DUMMY && activeRow.hasDummyInput &&\n        activeRow.align === Align.LEFT && input.align === Align.RIGHT) {\n      this.rightAlignedDummyInputs_.set(activeRow, input);\n    } else if (input.type === inputTypes.STATEMENT) {\n      // Handle statements without next connections correctly.\n      activeRow.elements.push(new StatementInput(this.constants_, input));\n      activeRow.hasStatement = true;\n\n      if (activeRow.align === null) {\n        activeRow.align = input.align;\n      }\n      return;\n    }\n    super.addInput_(input, activeRow);\n  }\n\n  override addAlignmentPadding_(row: Row, missingSpace: number) {\n    if (this.rightAlignedDummyInputs_.get(row)) {\n      let alignmentDivider;\n      for (let i = 0; i < row.elements.length; i++) {\n        const elem = row.elements[i];\n        if (Types.isSpacer(elem)) {\n          alignmentDivider = elem;\n        }\n        if (Types.isField(elem) && elem instanceof Field &&\n            elem.parentInput === this.rightAlignedDummyInputs_.get(row)) {\n          break;\n        }\n      }\n      if (alignmentDivider) {\n        alignmentDivider.width += missingSpace;\n        row.width += missingSpace;\n        return;\n      }\n    }\n    super.addAlignmentPadding_(row, missingSpace);\n  }\n\n  /**\n   * Adjust the x position of fields to bump all non-label fields in the first\n   * row past the notch position.  This must be called before `computeBounds`\n   * is called.\n   */\n  protected adjustXPosition_() {\n    const notchTotalWidth =\n        this.constants_.NOTCH_OFFSET_LEFT + this.constants_.NOTCH_WIDTH;\n    let minXPos = notchTotalWidth;\n    // Run through every input row on the block and only apply bump logic to the\n    // first input row (if the block has prev connection) and every input row\n    // that has a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const hasPrevNotch = i === 2 ? !!this.topRow.hasPreviousConnection :\n                                     !!prevSpacer.followsStatement;\n      const hasNextNotch = i + 2 >= this.rows.length - 1 ?\n          !!this.bottomRow.hasNextConnection :\n          !!nextSpacer.precedesStatement;\n\n      if (Types.isInputRow(row) && row.hasStatement) {\n        row.measure();\n        minXPos =\n            row.width - (row.getLastInput()?.width ?? 0) + notchTotalWidth;\n      } else if (\n          hasPrevNotch && (i === 2 || hasNextNotch) && Types.isInputRow(row) &&\n          !row.hasStatement) {\n        let xCursor = row.xPos;\n        let prevInRowSpacer = null;\n        for (let j = 0; j < row.elements.length; j++) {\n          const elem = row.elements[j];\n          if (Types.isSpacer(elem)) {\n            prevInRowSpacer = elem;\n          }\n          if (prevInRowSpacer && (Types.isField(elem) || Types.isInput(elem))) {\n            if (xCursor < minXPos &&\n                !(Types.isField(elem) && elem instanceof Field &&\n                  (elem.field instanceof FieldLabel ||\n                   elem.field instanceof FieldImage))) {\n              const difference = minXPos - xCursor;\n              prevInRowSpacer.width += difference;\n            }\n          }\n          xCursor += elem.width;\n        }\n      }\n    }\n  }\n\n  /**\n   * Finalize the output connection info.  In particular, set the height of the\n   * output connection to match that of the block.  For the right side, add a\n   * right connection shape element and have it match the dimensions of the\n   * output connection.\n   */\n  protected finalizeOutputConnection_() {\n    // Dynamic output connections depend on the height of the block.\n    if (!this.outputConnection || !this.outputConnection.isDynamicShape) {\n      return;\n    }\n    const outputConnectionShape = this.outputConnection.shape;\n    if (!('isDynamic' in outputConnectionShape &&\n          outputConnectionShape.isDynamic)) {\n      return;\n    }\n\n    let yCursor = 0;\n    // Determine the block height.\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      row.yPos = yCursor;\n      yCursor += row.height;\n    }\n    this.height = yCursor;\n\n    // Adjust the height of the output connection.\n    const blockHeight = this.bottomRow.hasNextConnection ?\n        this.height - this.bottomRow.descenderHeight :\n        this.height;\n    const connectionHeight = outputConnectionShape.height(blockHeight);\n    const connectionWidth = outputConnectionShape.width(blockHeight);\n\n    this.outputConnection.height = connectionHeight;\n    this.outputConnection.width = connectionWidth;\n    this.outputConnection.startX = connectionWidth;\n    this.outputConnection.connectionOffsetY =\n        outputConnectionShape.connectionOffsetY(connectionHeight);\n    this.outputConnection.connectionOffsetX =\n        outputConnectionShape.connectionOffsetX(connectionWidth);\n\n    // Add the right connection measurable.\n    // Don't add it if we have a value-to-statement or a value-to-stack block.\n    let rightConnectionWidth = 0;\n    if (!this.hasStatementInput && !this.bottomRow.hasNextConnection) {\n      rightConnectionWidth = connectionWidth;\n      this.rightSide!.height = connectionHeight;\n      this.rightSide!.width = rightConnectionWidth;\n      this.rightSide!.centerline = connectionHeight / 2;\n      this.rightSide!.xPos = this.width + rightConnectionWidth;\n    }\n    this.startX = connectionWidth;\n    this.width += connectionWidth + rightConnectionWidth;\n    this.widthWithChildren += connectionWidth + rightConnectionWidth;\n  }\n\n  /**\n   * Finalize horizontal alignment of elements on the block.  In particular,\n   * reduce the implicit spacing created by the left and right output connection\n   * shapes by adding setting negative spacing onto the leftmost and rightmost\n   * spacers.\n   */\n  protected finalizeHorizontalAlignment_() {\n    if (!this.outputConnection || this.hasStatementInput ||\n        this.bottomRow.hasNextConnection) {\n      return;\n    }\n    let totalNegativeSpacing = 0;\n    for (let i = 0; i < this.rows.length; i++) {\n      const row = this.rows[i];\n      if (!Types.isInputRow(row)) {\n        continue;\n      }\n      const firstElem = row.elements[1];\n      const lastElem = row.elements[row.elements.length - 2];\n      let leftNegPadding = this.getNegativeSpacing_(firstElem);\n      let rightNegPadding = this.getNegativeSpacing_(lastElem);\n      totalNegativeSpacing = leftNegPadding + rightNegPadding;\n      const minBlockWidth =\n          this.constants_.MIN_BLOCK_WIDTH + this.outputConnection.width * 2;\n      if (this.width - totalNegativeSpacing < minBlockWidth) {\n        // Maintain a minimum block width, split negative spacing between left\n        // and right edge.\n        totalNegativeSpacing = this.width - minBlockWidth;\n        leftNegPadding = totalNegativeSpacing / 2;\n        rightNegPadding = totalNegativeSpacing / 2;\n      }\n      // Add a negative spacer on the start and end of the block.\n      row.elements.unshift(new InRowSpacer(this.constants_, -leftNegPadding));\n      row.elements.push(new InRowSpacer(this.constants_, -rightNegPadding));\n    }\n    if (totalNegativeSpacing) {\n      this.width -= totalNegativeSpacing;\n      this.widthWithChildren -= totalNegativeSpacing;\n      this.rightSide!.xPos -= totalNegativeSpacing;\n      for (let i = 0; i < this.rows.length; i++) {\n        const row = this.rows[i];\n        if (Types.isTopOrBottomRow(row)) {\n          row.elements[1].width -= totalNegativeSpacing;\n        }\n        row.width -= totalNegativeSpacing;\n        row.widthWithConnectedBlocks -= totalNegativeSpacing;\n      }\n    }\n  }\n\n  /**\n   * Calculate the spacing to reduce the left and right edges by based on the\n   * outer and inner connection shape.\n   *\n   * @param elem The first or last element on a block.\n   * @returns The amount of spacing to reduce the first or last spacer.\n   */\n  protected getNegativeSpacing_(elem: Measurable): number {\n    if (!elem || !this.outputConnection) {\n      return 0;\n    }\n    const connectionWidth = this.outputConnection.width;\n    const outerShape = this.outputConnection.shape.type;\n    const constants = (this.constants_);\n    if (this.isMultiRow && this.inputRows.length > 1) {\n      switch (outerShape) {\n        case constants.SHAPES.ROUND: {\n          // Special case for multi-row round reporter blocks.\n          const maxWidth = this.constants_.MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH;\n          const width = this.height / 2 > maxWidth ? maxWidth : this.height / 2;\n          const topPadding = this.constants_.SMALL_PADDING;\n          const roundPadding =\n              width * (1 - Math.sin(Math.acos((width - topPadding) / width)));\n          return connectionWidth - roundPadding;\n        }\n        default:\n          return 0;\n      }\n    }\n    if (Types.isInlineInput(elem) && elem instanceof InputConnection) {\n      const connectedBlock = elem.connectedBlock;\n      const innerShape = connectedBlock ?\n          (connectedBlock.pathObject as PathObject).outputShapeType :\n          elem.shape.type;\n      if (innerShape == null) {\n        return 0;\n      }\n      // Special case for value to stack / value to statement blocks.\n      if (connectedBlock && connectedBlock.outputConnection &&\n          (connectedBlock.statementInputCount ||\n           connectedBlock.nextConnection)) {\n        return 0;\n      }\n      // Special case for hexagonal output.\n      if (outerShape === constants.SHAPES.HEXAGONAL &&\n          outerShape !== innerShape) {\n        return 0;\n      }\n      return connectionWidth -\n          this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][innerShape];\n    } else if (Types.isField(elem) && elem instanceof Field) {\n      // Special case for text inputs.\n      if (outerShape === constants.SHAPES.ROUND &&\n          elem.field instanceof FieldTextInput) {\n        return connectionWidth - 2.75 * constants.GRID_UNIT;\n      }\n      return connectionWidth -\n          this.constants_.SHAPE_IN_SHAPE_PADDING[outerShape][0];\n    } else if (Types.isIcon(elem)) {\n      return this.constants_.SMALL_PADDING;\n    }\n    return 0;\n  }\n\n  /**\n   * Finalize vertical alignment of rows on a block.  In particular, reduce the\n   * implicit spacing when a non-shadow block is connected to any of an input\n   * row's inline inputs.\n   */\n  protected finalizeVerticalAlignment_() {\n    if (this.outputConnection) {\n      return;\n    }\n    // Run through every input row on the block and only apply tight nesting\n    // logic to input rows that have a prev and next notch.\n    for (let i = 2; i < this.rows.length - 1; i += 2) {\n      const prevSpacer = this.rows[i - 1] as SpacerRow;\n      const row = this.rows[i];\n      const nextSpacer = this.rows[i + 1] as SpacerRow;\n\n      const firstRow = i === 2;\n      const hasPrevNotch = firstRow ? !!this.topRow.hasPreviousConnection :\n                                      !!prevSpacer.followsStatement;\n      const hasNextNotch = i + 2 >= this.rows.length - 1 ?\n          !!this.bottomRow.hasNextConnection :\n          !!nextSpacer.precedesStatement;\n\n      if (hasPrevNotch) {\n        const elem = row.elements[1];\n        const hasSingleTextOrImageField = row.elements.length === 3 &&\n            elem instanceof Field &&\n            (elem.field instanceof FieldLabel ||\n             elem.field instanceof FieldImage);\n        if (!firstRow && hasSingleTextOrImageField) {\n          // Remove some padding if we have a single image or text field.\n          prevSpacer.height -= this.constants_.SMALL_PADDING;\n          nextSpacer.height -= this.constants_.SMALL_PADDING;\n          row.height -= this.constants_.MEDIUM_PADDING;\n        } else if (!firstRow && !hasNextNotch) {\n          // Add a small padding so the notch doesn't clash with inputs/fields.\n          prevSpacer.height += this.constants_.SMALL_PADDING;\n        } else if (hasNextNotch) {\n          // Determine if the input row has non-shadow connected blocks.\n          let hasNonShadowConnectedBlocks = false;\n          const minVerticalTightNestingHeight = 40;\n          for (let j = 0; j < row.elements.length; j++) {\n            const elem = row.elements[j];\n            if (elem instanceof InputConnection && Types.isInlineInput(elem) &&\n                elem.connectedBlock && !elem.connectedBlock.isShadow() &&\n                elem.connectedBlock.getHeightWidth().height >=\n                    minVerticalTightNestingHeight) {\n              hasNonShadowConnectedBlocks = true;\n              break;\n            }\n          }\n          // Apply tight-nesting if we have both a prev and next notch and the\n          // block has non-shadow connected blocks.\n          if (hasNonShadowConnectedBlocks) {\n            prevSpacer.height -= this.constants_.SMALL_PADDING;\n            nextSpacer.height -= this.constants_.SMALL_PADDING;\n          }\n        }\n      }\n    }\n  }\n\n  override finalize_() {\n    this.finalizeOutputConnection_();\n    this.finalizeHorizontalAlignment_();\n    this.finalizeVerticalAlignment_();\n    super.finalize_();\n\n    if (this.rightSide) {\n      this.widthWithChildren += this.rightSide.width;\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.MarkerSvg');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {ASTNode} from '../../keyboard_nav/ast_node.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport type {ConstantProvider as BaseConstantProvider} from '../common/constants.js';\nimport {MarkerSvg as BaseMarkerSvg} from '../common/marker_svg.js';\n\nimport type {ConstantProvider as ZelosConstantProvider} from './constants.js';\n\n\n/**\n * Class to draw a marker.\n */\nexport class MarkerSvg extends BaseMarkerSvg {\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  constants_!: ZelosConstantProvider;\n\n  private markerCircle_: SVGCircleElement|null = null;\n\n  /**\n   * @param workspace The workspace the marker belongs to.\n   * @param constants The constants for the renderer.\n   * @param marker The marker to draw.\n   */\n  constructor(\n      workspace: WorkspaceSvg, constants: BaseConstantProvider,\n      marker: Marker) {\n    super(workspace, constants, marker);\n  }\n\n  /**\n   * Position and display the marker for an input or an output connection.\n   *\n   * @param curNode The node to draw the marker for.\n   */\n  private showWithInputOutput_(curNode: ASTNode) {\n    const block = curNode.getSourceBlock() as BlockSvg;\n    const connection = curNode.getLocation() as RenderedConnection;\n    const offsetInBlock = connection.getOffsetInBlock();\n\n    this.positionCircle_(offsetInBlock.x, offsetInBlock.y);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  override showWithOutput_(curNode: ASTNode) {\n    this.showWithInputOutput_(curNode);\n  }\n\n  override showWithInput_(curNode: ASTNode) {\n    this.showWithInputOutput_(curNode);\n  }\n\n  /**\n   * Draw a rectangle around the block.\n   *\n   * @param curNode The current node of the marker.\n   */\n  override showWithBlock_(curNode: ASTNode) {\n    const block = curNode.getLocation() as BlockSvg;\n\n    // Gets the height and width of entire stack.\n    const heightWidth = block.getHeightWidth();\n    // Add padding so that being on a stack looks different than being on a\n    // block.\n    this.positionRect_(0, 0, heightWidth.width, heightWidth.height);\n    this.setParent_(block);\n    this.showCurrent_();\n  }\n\n  /**\n   * Position the circle we use for input and output connections.\n   *\n   * @param x The x position of the circle.\n   * @param y The y position of the circle.\n   */\n  private positionCircle_(x: number, y: number) {\n    this.markerCircle_?.setAttribute('cx', `${x}`);\n    this.markerCircle_?.setAttribute('cy', `${y}`);\n    this.currentMarkerSvg = this.markerCircle_;\n  }\n\n  override hide() {\n    super.hide();\n    if (this.markerCircle_) {\n      this.markerCircle_.style.display = 'none';\n    }\n  }\n\n  override createDomInternal_() {\n    /* clang-format off */\n    /* This markup will be generated and added to the .svgGroup_:\n        <g>\n          <rect width=\"100\" height=\"5\">\n            <animate attributeType=\"XML\" attributeName=\"fill\" dur=\"1s\"\n              values=\"transparent;transparent;#fff;transparent\" repeatCount=\"indefinite\" />\n          </rect>\n        </g>\n        */\n    /* clang-format on */\n    super.createDomInternal_();\n\n    this.markerCircle_ = dom.createSvgElement(\n        Svg.CIRCLE, {\n          'r': this.constants_.CURSOR_RADIUS,\n          'style': 'display: none',\n          'stroke-width': this.constants_.CURSOR_STROKE_WIDTH,\n        },\n        this.markerSvg_);\n\n    // Markers and stack cursors don't blink.\n    if (this.isCursor()) {\n      const blinkProperties = this.getBlinkProperties_();\n      dom.createSvgElement(Svg.ANIMATE, blinkProperties, this.markerCircle_!);\n    }\n\n    return this.markerSvg_!;\n  }\n\n  override applyColour_(curNode: ASTNode) {\n    super.applyColour_(curNode);\n\n    this.markerCircle_?.setAttribute('fill', this.colour_);\n    this.markerCircle_?.setAttribute('stroke', this.colour_);\n\n    if (this.isCursor()) {\n      const values = this.colour_ + ';transparent;transparent;';\n      this.markerCircle_?.firstElementChild!.setAttribute('values', values);\n    }\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.PathObject');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport * as dom from '../../utils/dom.js';\nimport {Svg} from '../../utils/svg.js';\nimport {PathObject as BasePathObject} from '../common/path_object.js';\n\nimport type {ConstantProvider} from './constants.js';\n\n\n/**\n * An object that handles creating and setting each of the SVG elements\n * used by the renderer.\n */\nexport class PathObject extends BasePathObject {\n  /** The selected path of the block. */\n  private svgPathSelected_: SVGElement|null = null;\n\n  /** The outline paths on the block. */\n  private readonly outlines = new Map<string, SVGElement>();\n\n  /**\n   * A set used to determine which outlines were used during a draw pass.  The\n   * set is initialized with a reference to all the outlines in\n   * `this.outlines`. Every time we use an outline during the draw pass, the\n   * reference is removed from this set.\n   */\n  private remainingOutlines = new Set<string>();\n\n  /**\n   * The type of block's output connection shape.  This is set when a block\n   * with an output connection is drawn.\n   */\n  outputShapeType: number|null = null;\n\n  public override constants: ConstantProvider;\n\n  /**\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @param constants The renderer's constants.\n   */\n  constructor(\n      root: SVGElement, style: BlockStyle, constants: ConstantProvider) {\n    super(root, style, constants);\n\n    this.constants = constants;\n  }\n\n  override setPath(pathString: string) {\n    super.setPath(pathString);\n    if (this.svgPathSelected_) {\n      this.svgPathSelected_.setAttribute('d', pathString);\n    }\n  }\n\n  override applyColour(block: BlockSvg) {\n    super.applyColour(block);\n    // Set shadow stroke colour.\n    const parent = block.getParent();\n    if (block.isShadow() && parent) {\n      this.svgPath.setAttribute('stroke', parent.style.colourTertiary);\n    }\n\n    // Apply colour to outlines.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('fill', this.style.colourTertiary);\n    }\n  }\n\n  override flipRTL() {\n    super.flipRTL();\n    // Mirror each input outline path.\n    for (const outline of this.outlines.values()) {\n      outline.setAttribute('transform', 'scale(-1 1)');\n    }\n  }\n\n  override updateSelected(enable: boolean) {\n    this.setClass_('blocklySelected', enable);\n    if (enable) {\n      if (!this.svgPathSelected_) {\n        this.svgPathSelected_ = this.svgPath.cloneNode(true) as SVGElement;\n        this.svgPathSelected_.setAttribute('fill', 'none');\n        this.svgPathSelected_.setAttribute(\n            'filter', 'url(#' + this.constants.selectedGlowFilterId + ')');\n        this.svgRoot.appendChild(this.svgPathSelected_);\n      }\n    } else {\n      if (this.svgPathSelected_) {\n        this.svgRoot.removeChild(this.svgPathSelected_);\n        this.svgPathSelected_ = null;\n      }\n    }\n  }\n\n  override updateReplacementFade(enable: boolean) {\n    this.setClass_('blocklyReplaceable', enable);\n    if (enable) {\n      this.svgPath.setAttribute(\n          'filter', 'url(#' + this.constants.replacementGlowFilterId + ')');\n    } else {\n      this.svgPath.removeAttribute('filter');\n    }\n  }\n\n  override updateShapeForInputHighlight(conn: Connection, enable: boolean) {\n    const name = conn.getParentInput()!.name;\n    const outlinePath = this.getOutlinePath_(name);\n    if (!outlinePath) {\n      return;\n    }\n    if (enable) {\n      outlinePath.setAttribute(\n          'filter', 'url(#' + this.constants.replacementGlowFilterId + ')');\n    } else {\n      outlinePath.removeAttribute('filter');\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is about to draw the block.\n   */\n  beginDrawing() {\n    this.remainingOutlines.clear();\n    for (const key of this.outlines.keys()) {\n      this.remainingOutlines.add(key);\n    }\n  }\n\n  /**\n   * Method that's called when the drawer is done drawing.\n   */\n  endDrawing() {\n    // Go through all remaining outlines that were not used this draw pass, and\n    // remove them.\n    if (this.remainingOutlines.size) {\n      for (const key of this.remainingOutlines) {\n        this.removeOutlinePath_(key);\n      }\n    }\n    this.remainingOutlines.clear();\n  }\n\n  /**\n   * Set the path generated by the renderer for an outline path on the\n   * respective outline path SVG element.\n   *\n   * @param name The input name.\n   * @param pathString The path.\n   */\n  setOutlinePath(name: string, pathString: string) {\n    const outline = this.getOutlinePath_(name);\n    outline.setAttribute('d', pathString);\n    outline.setAttribute('fill', this.style.colourTertiary);\n  }\n\n  /**\n   * Create's an outline path for the specified input.\n   *\n   * @param name The input name.\n   * @returns The SVG outline path.\n   */\n  private getOutlinePath_(name: string): SVGElement {\n    if (!this.outlines.has(name)) {\n      this.outlines.set(\n          name,\n          dom.createSvgElement(\n              Svg.PATH, {\n                'class':\n                    'blocklyOutlinePath',  // IE doesn't like paths without the\n                // data definition, set empty\n                // default\n                'd': '',\n              },\n              this.svgRoot));\n    }\n    this.remainingOutlines.delete(name);\n    return this.outlines.get(name)!;\n  }\n\n  /**\n   * Remove an outline path that is associated with the specified input.\n   *\n   * @param name The input name.\n   */\n  private removeOutlinePath_(name: string) {\n    this.outlines.get(name)?.parentNode?.removeChild(this.outlines.get(name)!);\n    this.outlines.delete(name);\n  }\n}\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos.Renderer');\n\nimport type {BlockSvg} from '../../block_svg.js';\nimport type {Connection} from '../../connection.js';\nimport {ConnectionType} from '../../connection_type.js';\nimport {InsertionMarkerManager} from '../../insertion_marker_manager.js';\nimport type {Marker} from '../../keyboard_nav/marker.js';\nimport type {RenderedConnection} from '../../rendered_connection.js';\nimport type {BlockStyle} from '../../theme.js';\nimport type {WorkspaceSvg} from '../../workspace_svg.js';\nimport * as blockRendering from '../common/block_rendering.js';\nimport type {RenderInfo as BaseRenderInfo} from '../common/info.js';\nimport {Renderer as BaseRenderer} from '../common/renderer.js';\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {PathObject} from './path_object.js';\n\n\n/**\n * The zelos renderer. This renderer emulates Scratch-style and MakeCode-style\n * rendering.\n *\n * Zelos is the ancient Greek spirit of rivalry and emulation.\n */\nexport class Renderer extends BaseRenderer {\n  protected override constants_!: ConstantProvider;\n\n  /**\n   * @param name The renderer name.\n   */\n  constructor(name: string) {\n    super(name);\n  }\n\n  /**\n   * Create a new instance of the renderer's constant provider.\n   *\n   * @returns The constant provider.\n   */\n  protected override makeConstants_(): ConstantProvider {\n    return new ConstantProvider();\n  }\n\n  /**\n   * Create a new instance of the renderer's render info object.\n   *\n   * @param block The block to measure.\n   * @returns The render info object.\n   */\n  protected override makeRenderInfo_(block: BlockSvg): RenderInfo {\n    return new RenderInfo(this, block);\n  }\n\n  /**\n   * Create a new instance of the renderer's drawer.\n   *\n   * @param block The block to render.\n   * @param info An object containing all information needed to render this\n   *     block.\n   * @returns The drawer.\n   */\n  protected override makeDrawer_(block: BlockSvg, info: BaseRenderInfo):\n      Drawer {\n    return new Drawer(block, (info as RenderInfo));\n  }\n\n  /**\n   * Create a new instance of the renderer's cursor drawer.\n   *\n   * @param workspace The workspace the cursor belongs to.\n   * @param marker The marker.\n   * @returns The object in charge of drawing the marker.\n   */\n  override makeMarkerDrawer(workspace: WorkspaceSvg, marker: Marker):\n      MarkerSvg {\n    return new MarkerSvg(workspace, this.getConstants(), marker);\n  }\n\n  /**\n   * Create a new instance of a renderer path object.\n   *\n   * @param root The root SVG element.\n   * @param style The style object to use for colouring.\n   * @returns The renderer path object.\n   */\n  override makePathObject(root: SVGElement, style: BlockStyle): PathObject {\n    return new PathObject(\n        root, style, (this.getConstants() as ConstantProvider));\n  }\n\n  /**\n   * Get the current renderer's constant provider.  We assume that when this is\n   * called, the renderer has already been initialized.\n   *\n   * @returns The constant provider.\n   */\n  override getConstants(): ConstantProvider {\n    return this.constants_;\n  }\n\n  override shouldHighlightConnection(conn: Connection) {\n    return conn.type !== ConnectionType.INPUT_VALUE &&\n        conn.type !== ConnectionType.OUTPUT_VALUE;\n  }\n\n  override getConnectionPreviewMethod(\n      closest: RenderedConnection, local: RenderedConnection,\n      topBlock: BlockSvg) {\n    if (local.type === ConnectionType.OUTPUT_VALUE) {\n      if (!closest.isConnected()) {\n        return InsertionMarkerManager.PREVIEW_TYPE.INPUT_OUTLINE;\n      }\n      // TODO: Returning this is a total hack, because we don't want to show\n      //   a replacement fade, we want to show an outline affect.\n      //   Sadly zelos does not support showing an outline around filled\n      //   inputs, so we have to pretend like the connected block is getting\n      //   replaced.\n      return InsertionMarkerManager.PREVIEW_TYPE.REPLACEMENT_FADE;\n    }\n\n    return super.getConnectionPreviewMethod(closest, local, topBlock);\n  }\n}\n\nblockRendering.register('zelos', Renderer);\n", "/** @file Re-exports of Blockly.zelos.* modules. */\n\n/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.zelos');\n\nimport {ConstantProvider} from './constants.js';\nimport {Drawer} from './drawer.js';\nimport {RenderInfo} from './info.js';\nimport {MarkerSvg} from './marker_svg.js';\nimport {BottomRow} from './measurables/bottom_row.js';\nimport {StatementInput} from './measurables/inputs.js';\nimport {RightConnectionShape} from './measurables/row_elements.js';\nimport {TopRow} from './measurables/top_row.js';\nimport {PathObject} from './path_object.js';\nimport {Renderer} from './renderer.js';\n\n\nexport {\n  BottomRow,\n  ConstantProvider,\n  Drawer,\n  MarkerSvg,\n  PathObject,\n  Renderer,\n  RenderInfo,\n  RightConnectionShape,\n  StatementInput,\n  TopRow,\n};\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization.variables');\n\nimport type {ISerializer} from '../interfaces/i_serializer.js';\nimport type {Workspace} from '../workspace.js';\n\nimport * as priorities from './priorities.js';\nimport * as serializationRegistry from './registry.js';\n\n\n/**\n * Represents the state of a given variable.\n */\nexport interface State {\n  name: string;\n  id: string;\n  type: string|undefined;\n}\n\n/**\n * Serializer for saving and loading variable state.\n */\nexport class VariableSerializer implements ISerializer {\n  priority: number;\n\n  /* eslint-disable-next-line require-jsdoc */\n  constructor() {\n    /** The priority for deserializing variables. */\n    this.priority = priorities.VARIABLES;\n  }\n\n  /**\n   * Serializes the variables of the given workspace.\n   *\n   * @param workspace The workspace to save the variables of.\n   * @returns The state of the workspace's variables, or null if there are no\n   *     variables.\n   */\n  save(workspace: Workspace): State[]|null {\n    const variableStates = [];\n    for (const variable of workspace.getAllVariables()) {\n      const state = {\n        'name': variable.name,\n        'id': variable.getId(),\n      };\n      if (variable.type) {\n        (state as AnyDuringMigration)['type'] = variable.type;\n      }\n      variableStates.push(state);\n    }\n    // AnyDuringMigration because:  Type '{ name: string; id: string; }[] |\n    // null' is not assignable to type 'State[] | null'.\n    return (variableStates.length ? variableStates : null) as\n        AnyDuringMigration;\n  }\n\n  /**\n   * Deserializes the variable defined by the given state into the given\n   * workspace.\n   *\n   * @param state The state of the variables to deserialize.\n   * @param workspace The workspace to deserialize into.\n   */\n  load(state: State[], workspace: Workspace) {\n    for (const varState of state) {\n      workspace.createVariable(\n          varState['name'], varState['type'], varState['id']);\n    }\n  }\n\n  /**\n   * Disposes of any variables that exist on the workspace.\n   *\n   * @param workspace The workspace to clear the variables of.\n   */\n  clear(workspace: Workspace) {\n    workspace.getVariableMap().clear();\n  }\n}\n\nserializationRegistry.register('variables', new VariableSerializer());\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Serialization methods.\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.serialization');\n\nimport * as blocks from './serialization/blocks.js';\nimport * as exceptions from './serialization/exceptions.js';\nimport * as priorities from './serialization/priorities.js';\nimport * as procedures from './serialization/procedures.js';\nimport * as registry from './serialization/registry.js';\nimport * as variables from './serialization/variables.js';\nimport * as workspaces from './serialization/workspaces.js';\nimport {ISerializer} from './interfaces/i_serializer.js';\n\nexport {\n  blocks,\n  exceptions,\n  priorities,\n  procedures,\n  registry,\n  variables,\n  workspaces,\n  ISerializer,\n};\n", "/**\n * @license\n * Copyright 2019 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.utils.KeyCodes');\n\n\n/**\n * Key codes for common characters.\n *\n * Copied from Closure's goog.events.KeyCodes\n *\n * This list is not localized and therefore some of the key codes are not\n * correct for non US keyboard layouts. See comments below.\n */\nexport enum KeyCodes {\n  WIN_KEY_FF_LINUX = 0,\n  MAC_ENTER = 3,\n  BACKSPACE = 8,\n  TAB = 9,\n  NUM_CENTER = 12,  // NUMLOCK on FF/Safari Mac\n  ENTER = 13,\n  SHIFT = 16,\n  CTRL = 17,\n  ALT = 18,\n  PAUSE = 19,\n  CAPS_LOCK = 20,\n  ESC = 27,\n  SPACE = 32,\n  PAGE_UP = 33,    // also NUM_NORTH_EAST\n  PAGE_DOWN = 34,  // also NUM_SOUTH_EAST\n  END = 35,        // also NUM_SOUTH_WEST\n  HOME = 36,       // also NUM_NORTH_WEST\n  LEFT = 37,       // also NUM_WEST\n  UP = 38,         // also NUM_NORTH\n  RIGHT = 39,      // also NUM_EAST\n  DOWN = 40,       // also NUM_SOUTH\n  PLUS_SIGN = 43,  // NOT numpad plus\n  PRINT_SCREEN = 44,\n  INSERT = 45,  // also NUM_INSERT\n  DELETE = 46,  // also NUM_DELETE\n  ZERO = 48,\n  ONE = 49,\n  TWO = 50,\n  THREE = 51,\n  FOUR = 52,\n  FIVE = 53,\n  SIX = 54,\n  SEVEN = 55,\n  EIGHT = 56,\n  NINE = 57,\n  FF_SEMICOLON = 59,  // Firefox (Gecko) fires this for semicolon instead of 186\n  FF_EQUALS = 61,     // Firefox (Gecko) fires this for equals instead of 187\n  FF_DASH = 173,      // Firefox (Gecko) fires this for dash instead of 189\n  // Firefox (Gecko) fires this for # on UK keyboards, rather than\n  // Shift+SINGLE_QUOTE.\n  FF_HASH = 163,\n  QUESTION_MARK = 63,  // needs localization\n  AT_SIGN = 64,\n  A = 65,\n  B = 66,\n  C = 67,\n  D = 68,\n  E = 69,\n  F = 70,\n  G = 71,\n  H = 72,\n  I = 73,\n  J = 74,\n  K = 75,\n  L = 76,\n  M = 77,\n  N = 78,\n  O = 79,\n  P = 80,\n  Q = 81,\n  R = 82,\n  S = 83,\n  T = 84,\n  U = 85,\n  V = 86,\n  W = 87,\n  X = 88,\n  Y = 89,\n  Z = 90,\n  META = 91,  // WIN_KEY_LEFT\n  WIN_KEY_RIGHT = 92,\n  CONTEXT_MENU = 93,\n  NUM_ZERO = 96,\n  NUM_ONE = 97,\n  NUM_TWO = 98,\n  NUM_THREE = 99,\n  NUM_FOUR = 100,\n  NUM_FIVE = 101,\n  NUM_SIX = 102,\n  NUM_SEVEN = 103,\n  NUM_EIGHT = 104,\n  NUM_NINE = 105,\n  NUM_MULTIPLY = 106,\n  NUM_PLUS = 107,\n  NUM_MINUS = 109,\n  NUM_PERIOD = 110,\n  NUM_DIVISION = 111,\n  F1 = 112,\n  F2 = 113,\n  F3 = 114,\n  F4 = 115,\n  F5 = 116,\n  F6 = 117,\n  F7 = 118,\n  F8 = 119,\n  F9 = 120,\n  F10 = 121,\n  F11 = 122,\n  F12 = 123,\n  NUMLOCK = 144,\n  SCROLL_LOCK = 145,\n\n  // OS-specific media keys like volume controls and browser controls.\n  FIRST_MEDIA_KEY = 166,\n  LAST_MEDIA_KEY = 183,\n\n  SEMICOLON = 186,             // needs localization\n  DASH = 189,                  // needs localization\n  EQUALS = 187,                // needs localization\n  COMMA = 188,                 // needs localization\n  PERIOD = 190,                // needs localization\n  SLASH = 191,                 // needs localization\n  APOSTROPHE = 192,            // needs localization\n  TILDE = 192,                 // needs localization\n  SINGLE_QUOTE = 222,          // needs localization\n  OPEN_SQUARE_BRACKET = 219,   // needs localization\n  BACKSLASH = 220,             // needs localization\n  CLOSE_SQUARE_BRACKET = 221,  // needs localization\n  WIN_KEY = 224,\n  MAC_FF_META =\n      224,  // Firefox (Gecko) fires this for the meta key instead of 91\n  MAC_WK_CMD_LEFT = 91,   // WebKit Left Command key fired, same as META\n  MAC_WK_CMD_RIGHT = 93,  // WebKit Right Command key fired, different from META\n  WIN_IME = 229,\n\n  // \"Reserved for future use\". Some programs (e.g. the SlingPlayer 2.4 ActiveX\n  // control) fire this as a hacky way to disable screensavers.\n  VK_NONAME = 252,\n\n  // We've seen users whose machines fire this keycode at regular one\n  // second intervals. The common thread among these users is that\n  // they're all using Dell Inspiron laptops, so we suspect that this\n  // indicates a hardware/bios problem.\n  // http://en.community.dell.com/support-forums/laptop/f/3518/p/19285957/19523128.aspx\n  PHANTOM = 255,\n}\n", "/**\n * @license\n * Copyright 2018 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Themes.Zelos');\n\nimport {Theme} from '../theme.js';\n\n\nconst defaultBlockStyles = {\n  'colour_blocks': {\n    'colourPrimary': '#CF63CF',\n    'colourSecondary': '#C94FC9',\n    'colourTertiary': '#BD42BD',\n  },\n  'list_blocks': {\n    'colourPrimary': '#9966FF',\n    'colourSecondary': '#855CD6',\n    'colourTertiary': '#774DCB',\n  },\n  'logic_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n  },\n  'loop_blocks': {\n    'colourPrimary': '#0fBD8C',\n    'colourSecondary': '#0DA57A',\n    'colourTertiary': '#0B8E69',\n  },\n  'math_blocks': {\n    'colourPrimary': '#59C059',\n    'colourSecondary': '#46B946',\n    'colourTertiary': '#389438',\n  },\n  'procedure_blocks': {\n    'colourPrimary': '#FF6680',\n    'colourSecondary': '#FF4D6A',\n    'colourTertiary': '#FF3355',\n  },\n  'text_blocks': {\n    'colourPrimary': '#FFBF00',\n    'colourSecondary': '#E6AC00',\n    'colourTertiary': '#CC9900',\n  },\n  'variable_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'variable_dynamic_blocks': {\n    'colourPrimary': '#FF8C1A',\n    'colourSecondary': '#FF8000',\n    'colourTertiary': '#DB6E00',\n  },\n  'hat_blocks': {\n    'colourPrimary': '#4C97FF',\n    'colourSecondary': '#4280D7',\n    'colourTertiary': '#3373CC',\n    'hat': 'cap',\n  },\n};\n\nconst categoryStyles = {\n  'colour_category': {'colour': '#CF63CF'},\n  'list_category': {'colour': '#9966FF'},\n  'logic_category': {'colour': '#4C97FF'},\n  'loop_category': {'colour': '#0fBD8C'},\n  'math_category': {'colour': '#59C059'},\n  'procedure_category': {'colour': '#FF6680'},\n  'text_category': {'colour': '#FFBF00'},\n  'variable_category': {'colour': '#FF8C1A'},\n  'variable_dynamic_category': {'colour': '#FF8C1A'},\n};\n\n/**\n * Zelos theme.\n */\nexport const Zelos = new Theme('zelos', defaultBlockStyles, categoryStyles);\n", "/**\n * @license\n * Copyright 2021 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Themes');\n\nimport {Classic} from './classic.js';\nimport {Zelos} from './zelos.js';\n\n\nexport {Classic, Zelos};\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * An item in the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ToolboxItem');\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as idGenerator from '../utils/idgenerator.js';\nimport type * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\n\n/**\n * Class for an item in the toolbox.\n */\nexport class ToolboxItem implements IToolboxItem {\n  protected id_: string;\n  protected parent_: ICollapsibleToolboxItem|null;\n  protected level_: number;\n  protected toolboxItemDef_: toolbox.ToolboxItemInfo|null;\n  protected workspace_: WorkspaceSvg;\n  /** The toolbox this category belongs to. */\n  protected readonly parentToolbox_: IToolbox;\n\n  /**\n   * @param toolboxItemDef The JSON defining the toolbox item.\n   * @param parentToolbox The toolbox that holds the toolbox item.\n   * @param opt_parent The parent toolbox item or null if the category does not\n   *     have a parent.\n   */\n  constructor(\n      toolboxItemDef: toolbox.ToolboxItemInfo, parentToolbox: IToolbox,\n      opt_parent?: ICollapsibleToolboxItem) {\n    /** The ID for the category. */\n    this.id_ = (toolboxItemDef as AnyDuringMigration)['toolboxitemid'] ||\n        idGenerator.getNextUniqueId();\n\n    /** The parent of the category. */\n    this.parent_ = opt_parent || null;\n\n    /** The level that the category is nested at. */\n    this.level_ = this.parent_ ? this.parent_.getLevel() + 1 : 0;\n\n    /** The JSON definition of the toolbox item. */\n    this.toolboxItemDef_ = toolboxItemDef;\n\n    this.parentToolbox_ = parentToolbox;\n\n    /** The workspace of the parent toolbox. */\n    this.workspace_ = this.parentToolbox_.getWorkspace();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   */\n  init() {}\n  // No-op by default.\n\n  /**\n   * Gets the div for the toolbox item.\n   *\n   * @returns The div for the toolbox item.\n   */\n  getDiv(): Element|null {\n    return null;\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks, or null if this item should\n   *     not receive clicks.\n   */\n  getClickTarget(): Element|null {\n    return null;\n  }\n\n  /**\n   * Gets a unique identifier for this toolbox item.\n   *\n   * @returns The ID for the toolbox item.\n   */\n  getId(): string {\n    return this.id_;\n  }\n\n  /**\n   * Gets the parent if the toolbox item is nested.\n   *\n   * @returns The parent toolbox item, or null if this toolbox item is not\n   *     nested.\n   */\n  getParent(): ICollapsibleToolboxItem|null {\n    return null;\n  }\n\n  /**\n   * Gets the nested level of the category.\n   *\n   * @returns The nested level of the category.\n   * @internal\n   */\n  getLevel(): number {\n    return this.level_;\n  }\n\n  /**\n   * Whether the toolbox item is selectable.\n   *\n   * @returns True if the toolbox item can be selected.\n   */\n  isSelectable(): boolean {\n    return false;\n  }\n\n  /**\n   * Whether the toolbox item is collapsible.\n   *\n   * @returns True if the toolbox item is collapsible.\n   */\n  isCollapsible(): boolean {\n    return false;\n  }\n\n  /** Dispose of this toolbox item. No-op by default. */\n  dispose() {}\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param _isVisible True if category should be visible.\n   */\n  setVisible_(_isVisible: boolean) {}\n}\n// nop by default\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ToolboxCategory');\n\nimport * as Css from '../css.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport type {CategoryInfo, DynamicCategoryInfo, FlyoutDefinition, FlyoutItemInfo, FlyoutItemInfoArray, StaticCategoryInfo} from '../utils/toolbox.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as colourUtils from '../utils/colour.js';\nimport * as dom from '../utils/dom.js';\nimport * as parsing from '../utils/parsing.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n\n/**\n * Class for a category in a toolbox.\n */\nexport class ToolboxCategory extends ToolboxItem implements\n    ISelectableToolboxItem {\n  /** Name used for registering a toolbox category. */\n  static registrationName = 'category';\n\n  /** The number of pixels to move the category over at each nested level. */\n  static nestedPadding = 19;\n\n  /** The width in pixels of the strip of colour next to each category. */\n  static borderWidth = 8;\n\n  /**\n   * The default colour of the category. This is used as the background colour\n   * of the category when it is selected.\n   */\n  static defaultBackgroundColour = '#57e';\n\n  // TODO(b/109816955): remove '!', see go/strict-prop-init-fix.\n  override toolboxItemDef_!: CategoryInfo;\n\n  /** The name that will be displayed on the category. */\n  protected name_ = '';\n\n  /** The colour of the category. */\n  protected colour_ = '';\n\n  /** The HTML container for the category. */\n  protected htmlDiv_: HTMLDivElement|null = null;\n\n  /** The HTML element for the category row. */\n  protected rowDiv_: HTMLDivElement|null = null;\n\n  /** The HTML element that holds children elements of the category row. */\n  protected rowContents_: HTMLDivElement|null = null;\n\n  /** The HTML element for the toolbox icon. */\n  protected iconDom_: Element|null = null;\n\n  /** The HTML element for the toolbox label. */\n  protected labelDom_: Element|null = null;\n  protected cssConfig_: CssConfig;\n\n  /** True if the category is meant to be hidden, false otherwise. */\n  protected isHidden_ = false;\n\n  /** True if this category is disabled, false otherwise. */\n  protected isDisabled_ = false;\n\n  /** The flyout items for this category. */\n  protected flyoutItems_: string|FlyoutItemInfoArray = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param parentToolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n      categoryDef: CategoryInfo, parentToolbox: IToolbox,\n      opt_parent?: ICollapsibleToolboxItem) {\n    super(categoryDef, parentToolbox, opt_parent);\n\n    /** All the css class names that are used to create a category. */\n    this.cssConfig_ = this.makeDefaultCssConfig_();\n  }\n\n  /**\n   * Initializes the toolbox item.\n   * This includes creating the DOM and updating the state of any items based\n   * on the info object.\n   * Init should be called immediately after the construction of the toolbox\n   * item, to ensure that the category contents are properly parsed.\n   */\n  override init() {\n    this.parseCategoryDef_(this.toolboxItemDef_);\n    this.parseContents_(this.toolboxItemDef_);\n    this.createDom_();\n    if (this.toolboxItemDef_['hidden'] === 'true') {\n      this.hide();\n    }\n  }\n\n  /**\n   * Creates an object holding the default classes for a category.\n   *\n   * @returns The configuration object holding all the CSS classes for a\n   *     category.\n   */\n  protected makeDefaultCssConfig_(): CssConfig {\n    return {\n      'container': 'blocklyToolboxCategory',\n      'row': 'blocklyTreeRow',\n      'rowcontentcontainer': 'blocklyTreeRowContentContainer',\n      'icon': 'blocklyTreeIcon',\n      'label': 'blocklyTreeLabel',\n      'contents': 'blocklyToolboxContents',\n      'selected': 'blocklyTreeSelected',\n      'openicon': 'blocklyTreeIconOpen',\n      'closedicon': 'blocklyTreeIconClosed',\n    };\n  }\n\n  /**\n   * Parses the contents array depending on if the category is a dynamic\n   * category, or if its contents are meant to be shown in the flyout.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseContents_(categoryDef: CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        const flyoutItem = itemDef as FlyoutItemInfo;\n        if (Array.isArray(this.flyoutItems_)) {\n          this.flyoutItems_.push(flyoutItem);\n        }\n      }\n    }\n  }\n\n  /**\n   * Parses the non-contents parts of the category def.\n   *\n   * @param categoryDef The information needed to create a category.\n   */\n  protected parseCategoryDef_(categoryDef: CategoryInfo) {\n    this.name_ = 'name' in categoryDef ?\n        parsing.replaceMessageReferences(categoryDef['name']) :\n        '';\n    this.colour_ = this.getColour_(categoryDef);\n    Object.assign(\n        this.cssConfig_,\n        categoryDef['cssconfig'] || (categoryDef as any)['cssConfig']);\n  }\n\n  /**\n   * Creates the DOM for the category.\n   *\n   * @returns The parent element for the category.\n   */\n  protected createDom_(): HTMLDivElement {\n    this.htmlDiv_ = this.createContainer_();\n    aria.setRole(this.htmlDiv_, aria.Role.TREEITEM);\n    aria.setState(this.htmlDiv_, aria.State.SELECTED, false);\n    aria.setState(this.htmlDiv_, aria.State.LEVEL, this.level_);\n\n    this.rowDiv_ = this.createRowContainer_();\n    this.rowDiv_.style.pointerEvents = 'auto';\n    this.htmlDiv_.appendChild(this.rowDiv_);\n\n    this.rowContents_ = this.createRowContentsContainer_();\n    this.rowContents_.style.pointerEvents = 'none';\n    this.rowDiv_.appendChild(this.rowContents_);\n\n    this.iconDom_ = this.createIconDom_();\n    aria.setRole(this.iconDom_, aria.Role.PRESENTATION);\n    this.rowContents_.appendChild(this.iconDom_);\n\n    this.labelDom_ = this.createLabelDom_(this.name_);\n    this.rowContents_.appendChild(this.labelDom_);\n\n    const id = this.labelDom_.getAttribute('id');\n    if (id) {\n      aria.setState(this.htmlDiv_, aria.State.LABELLEDBY, id);\n    }\n\n    this.addColourBorder_(this.colour_);\n\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Creates the container that holds the row and any subcategories.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    return container;\n  }\n\n  /**\n   * Creates the parent of the contents container. All clicks will happen on\n   * this div.\n   *\n   * @returns The div that holds the contents container.\n   */\n  protected createRowContainer_(): HTMLDivElement {\n    const rowDiv = document.createElement('div');\n    const className = this.cssConfig_['row'];\n    if (className) {\n      dom.addClass(rowDiv, className);\n    }\n    const nestedPadding =\n        `${ToolboxCategory.nestedPadding * this.getLevel()}px`;\n    this.workspace_.RTL ? rowDiv.style.paddingRight = nestedPadding :\n                          rowDiv.style.paddingLeft = nestedPadding;\n    return rowDiv;\n  }\n\n  /**\n   * Creates the container for the label and icon.\n   * This is necessary so we can set all subcategory pointer events to none.\n   *\n   * @returns The div that holds the icon and the label.\n   */\n  protected createRowContentsContainer_(): HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = this.cssConfig_['rowcontentcontainer'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Creates the span that holds the category icon.\n   *\n   * @returns The span that holds the category icon.\n   */\n  protected createIconDom_(): Element {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Creates the span that holds the category label.\n   * This should have an ID for accessibility purposes.\n   *\n   * @param name The name of the category.\n   * @returns The span that holds the category label.\n   */\n  protected createLabelDom_(name: string): Element {\n    const toolboxLabel = document.createElement('span');\n    toolboxLabel.setAttribute('id', this.getId() + '.label');\n    toolboxLabel.textContent = name;\n    const className = this.cssConfig_['label'];\n    if (className) {\n      dom.addClass(toolboxLabel, className);\n    }\n    return toolboxLabel;\n  }\n\n  /** Updates the colour for this category. */\n  refreshTheme() {\n    this.colour_ = this.getColour_(this.toolboxItemDef_);\n    this.addColourBorder_(this.colour_);\n  }\n\n  /**\n   * Add the strip of colour to the toolbox category.\n   *\n   * @param colour The category colour.\n   */\n  protected addColourBorder_(colour: string) {\n    if (colour) {\n      const border =\n          ToolboxCategory.borderWidth + 'px solid ' + (colour || '#ddd');\n      if (this.workspace_.RTL) {\n        this.rowDiv_!.style.borderRight = border;\n      } else {\n        this.rowDiv_!.style.borderLeft = border;\n      }\n    }\n  }\n\n  /**\n   * Gets either the colour or the style for a category.\n   *\n   * @param categoryDef The object holding information on the category.\n   * @returns The hex colour for the category.\n   */\n  protected getColour_(categoryDef: CategoryInfo): string {\n    const styleName =\n        categoryDef['categorystyle'] || (categoryDef as any)['categoryStyle'];\n    const colour = categoryDef['colour'];\n\n    if (colour && styleName) {\n      console.warn(\n          'Toolbox category \"' + this.name_ +\n          '\" must not have both a style and a colour');\n    } else if (styleName) {\n      return this.getColourfromStyle_(styleName);\n    } else if (colour) {\n      return this.parseColour_(colour);\n    }\n    return '';\n  }\n\n  /**\n   * Sets the colour for the category using the style name and returns the new\n   * colour as a hex string.\n   *\n   * @param styleName Name of the style.\n   * @returns The hex colour for the category.\n   */\n  private getColourfromStyle_(styleName: string): string {\n    const theme = this.workspace_.getTheme();\n    if (styleName && theme) {\n      const style = theme.categoryStyles[styleName];\n      if (style && style.colour) {\n        return this.parseColour_(style.colour);\n      } else {\n        console.warn(\n            'Style \"' + styleName + '\" must exist and contain a colour value');\n      }\n    }\n    return '';\n  }\n\n  /**\n   * Gets the HTML element that is clickable.\n   * The parent toolbox element receives clicks. The parent toolbox will add an\n   * ID to this element so it can pass the onClick event to the correct\n   * toolboxItem.\n   *\n   * @returns The HTML element that receives clicks.\n   */\n  override getClickTarget(): Element {\n    return this.rowDiv_ as Element;\n  }\n\n  /**\n   * Parses the colour on the category.\n   *\n   * @param colourValue HSV hue value (0 to 360), #RRGGBB string, or a message\n   *     reference string pointing to one of those two values.\n   * @returns The hex colour for the category.\n   */\n  private parseColour_(colourValue: number|string): string {\n    // Decode the colour for any potential message references\n    // (eg. `%{BKY_MATH_HUE}`).\n    const colour = parsing.replaceMessageReferences(colourValue);\n    if (colour == null || colour === '') {\n      // No attribute. No colour.\n      return '';\n    } else {\n      const hue = Number(colour);\n      if (!isNaN(hue)) {\n        return colourUtils.hueToHex(hue);\n      } else {\n        const hex = colourUtils.parse(colour);\n        if (hex) {\n          return hex;\n        } else {\n          console.warn(\n              'Toolbox category \"' + this.name_ +\n              '\" has unrecognized colour attribute: ' + colour);\n          return '';\n        }\n      }\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display an open icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected openIcon_(iconDiv: Element|null) {\n    if (!iconDiv) {\n      return;\n    }\n    const closedIconClass = this.cssConfig_['closedicon'];\n    if (closedIconClass) {\n      dom.removeClasses(iconDiv, closedIconClass);\n    }\n    const className = this.cssConfig_['openicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Adds appropriate classes to display a closed icon.\n   *\n   * @param iconDiv The div that holds the icon.\n   */\n  protected closeIcon_(iconDiv: Element|null) {\n    if (!iconDiv) {\n      return;\n    }\n    const openIconClass = this.cssConfig_['openicon'];\n    if (openIconClass) {\n      dom.removeClasses(iconDiv, openIconClass);\n    }\n    const className = this.cssConfig_['closedicon'];\n    if (className) {\n      dom.addClass(iconDiv, className);\n    }\n  }\n\n  /**\n   * Sets whether the category is visible or not.\n   * For a category to be visible its parent category must also be expanded.\n   *\n   * @param isVisible True if category should be visible.\n   */\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /** Hide the category. */\n  hide() {\n    this.setVisible_(false);\n  }\n\n  /**\n   * Show the category. Category will only appear if its parent category is also\n   * expanded.\n   */\n  show() {\n    this.setVisible_(true);\n  }\n\n  /**\n   * Whether the category is visible.\n   * A category is only visible if all of its ancestors are expanded and\n   * isHidden_ is false.\n   *\n   * @returns True if the category is visible, false otherwise.\n   */\n  isVisible(): boolean {\n    return !this.isHidden_ && this.allAncestorsExpanded_();\n  }\n\n  /**\n   * Whether all ancestors of a category (parent and parent's parent, etc.) are\n   * expanded.\n   *\n   * @returns True only if every ancestor is expanded\n   */\n  protected allAncestorsExpanded_(): boolean {\n    /* eslint-disable-next-line @typescript-eslint/no-this-alias */\n    let category: IToolboxItem = this;\n    while (category.getParent()) {\n      category = category.getParent()!;\n      if (!(category as ICollapsibleToolboxItem).isExpanded()) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  override isSelectable() {\n    return this.isVisible() && !this.isDisabled_;\n  }\n\n  /**\n   * Handles when the toolbox item is clicked.\n   *\n   * @param _e Click event to handle.\n   */\n  onClick(_e: Event) {}\n  // No-op\n\n  /**\n   * Sets the current category as selected.\n   *\n   * @param isSelected True if this category is selected, false otherwise.\n   */\n  setSelected(isSelected: boolean) {\n    if (!this.rowDiv_) {\n      return;\n    }\n    const className = this.cssConfig_['selected'];\n    if (isSelected) {\n      const defaultColour =\n          this.parseColour_(ToolboxCategory.defaultBackgroundColour);\n      this.rowDiv_.style.backgroundColor = this.colour_ || defaultColour;\n      if (className) {\n        dom.addClass(this.rowDiv_, className);\n      }\n    } else {\n      this.rowDiv_.style.backgroundColor = '';\n      if (className) {\n        dom.removeClass(this.rowDiv_, className);\n      }\n    }\n    aria.setState(this.htmlDiv_ as Element, aria.State.SELECTED, isSelected);\n  }\n\n  /**\n   * Sets whether the category is disabled.\n   *\n   * @param isDisabled True to disable the category, false otherwise.\n   */\n  setDisabled(isDisabled: boolean) {\n    this.isDisabled_ = isDisabled;\n    this.getDiv()!.setAttribute('disabled', `${isDisabled}`);\n    isDisabled ? this.getDiv()!.setAttribute('disabled', 'true') :\n                 this.getDiv()!.removeAttribute('disabled');\n  }\n\n  /**\n   * Gets the name of the category. Used for emitting events.\n   *\n   * @returns The name of the toolbox item.\n   */\n  getName(): string {\n    return this.name_;\n  }\n\n  override getParent() {\n    return this.parent_;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets the contents of the category. These are items that are meant to be\n   * displayed in the flyout.\n   *\n   * @returns The definition of items to be displayed in the flyout.\n   */\n  getContents(): FlyoutItemInfoArray|string {\n    return this.flyoutItems_;\n  }\n\n  /**\n   * Updates the contents to be displayed in the flyout.\n   * If the flyout is open when the contents are updated, refreshSelection on\n   * the toolbox must also be called.\n   *\n   * @param contents The contents to be displayed in the flyout. A string can be\n   *     supplied to create a dynamic category.\n   */\n  updateFlyoutContents(contents: FlyoutDefinition|string) {\n    this.flyoutItems_ = [];\n\n    if (typeof contents === 'string') {\n      const newDefinition: DynamicCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        custom: contents,\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    } else {\n      const newDefinition: StaticCategoryInfo = {\n        kind: this.toolboxItemDef_.kind,\n        name: 'name' in this.toolboxItemDef_ ? this.toolboxItemDef_['name'] :\n                                               '',\n        contents: toolbox.convertFlyoutDefToJsonArray(contents),\n        id: this.toolboxItemDef_.id,\n        categorystyle: this.toolboxItemDef_.categorystyle,\n        colour: this.toolboxItemDef_.colour,\n        cssconfig: this.toolboxItemDef_.cssconfig,\n        hidden: this.toolboxItemDef_.hidden,\n      };\n      this.toolboxItemDef_ = newDefinition;\n    }\n    this.parseContents_(this.toolboxItemDef_);\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_);\n  }\n}\n\nexport namespace ToolboxCategory {\n  /** All the CSS class names that are used to create a category. */\n  export interface CssConfig {\n    container?: string;\n    row?: string;\n    rowcontentcontainer?: string;\n    icon?: string;\n    label?: string;\n    contents?: string;\n    selected?: string;\n    openicon?: string;\n    closedicon?: string;\n  }\n}\n\nexport type CssConfig = ToolboxCategory.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeRow:not(.blocklyTreeSelected):hover {\n  background-color: rgba(255, 255, 255, .2);\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 5px 1px 0;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"][layout=\"h\"] .blocklyToolboxCategory {\n  margin: 1px 0 1px 5px;\n}\n\n.blocklyTreeRow {\n  height: 22px;\n  line-height: 22px;\n  margin-bottom: 3px;\n  padding-right: 8px;\n  white-space: nowrap;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeRow {\n  margin-left: 8px;\n  padding-right: 0;\n}\n\n.blocklyTreeIcon {\n  background-image: url(<<<PATH>>>/sprites.png);\n  height: 16px;\n  vertical-align: middle;\n  visibility: hidden;\n  width: 16px;\n}\n\n.blocklyTreeIconClosed {\n  background-position: -32px -1px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeIconClosed {\n  background-position: 0 -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: -32px -17px;\n}\n\n.blocklyToolboxDiv[dir=\"RTL\"] .blocklyTreeSelected>.blocklyTreeIconClosed {\n  background-position: 0 -17px;\n}\n\n.blocklyTreeIconOpen {\n  background-position: -16px -1px;\n}\n\n.blocklyTreeSelected>.blocklyTreeIconOpen {\n  background-position: -16px -17px;\n}\n\n.blocklyTreeLabel {\n  cursor: default;\n  font: 16px sans-serif;\n  padding: 0 3px;\n  vertical-align: middle;\n}\n\n.blocklyToolboxDelete .blocklyTreeLabel {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyTreeSelected .blocklyTreeLabel {\n  color: #fff;\n}\n`);\n\nregistry.register(\n    registry.Type.TOOLBOX_ITEM, ToolboxCategory.registrationName,\n    ToolboxCategory);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A separator used for separating toolbox categories.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.ToolboxSeparator');\n\nimport * as Css from '../css.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport * as registry from '../registry.js';\nimport * as dom from '../utils/dom.js';\nimport type * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxItem} from './toolbox_item.js';\n\n\n/**\n * Class for a toolbox separator. This is the thin visual line that appears on\n * the toolbox. This item is not interactable.\n */\nexport class ToolboxSeparator extends ToolboxItem {\n  /** Name used for registering a toolbox separator. */\n  static registrationName = 'sep';\n\n  /** All the CSS class names that are used to create a separator. */\n  protected cssConfig_: CssConfig = {'container': 'blocklyTreeSeparator'};\n\n  private htmlDiv_: HTMLDivElement|null = null;\n\n  /**\n   * @param separatorDef The information needed to create a separator.\n   * @param toolbox The parent toolbox for the separator.\n   */\n  constructor(separatorDef: toolbox.SeparatorInfo, toolbox: IToolbox) {\n    super(separatorDef, toolbox);\n\n    const cssConfig =\n        separatorDef['cssconfig'] || (separatorDef as any)['cssConfig'];\n    Object.assign(this.cssConfig_, cssConfig);\n  }\n\n  override init() {\n    this.createDom_();\n  }\n\n  /**\n   * Creates the DOM for a separator.\n   *\n   * @returns The parent element for the separator.\n   */\n  protected createDom_(): HTMLDivElement {\n    const container = document.createElement('div');\n    const className = this.cssConfig_['container'];\n    if (className) {\n      dom.addClass(container, className);\n    }\n    this.htmlDiv_ = container;\n    return container;\n  }\n\n  override getDiv() {\n    return this.htmlDiv_ as HTMLDivElement;\n  }\n\n  override dispose() {\n    dom.removeNode(this.htmlDiv_ as HTMLDivElement);\n  }\n}\n\nexport namespace ToolboxSeparator {\n  export interface CssConfig {\n    container: string|undefined;\n  }\n}\n\nexport type CssConfig = ToolboxSeparator.CssConfig;\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyTreeSeparator {\n  border-bottom: solid #e5e5e5 1px;\n  height: 0;\n  margin: 5px 0;\n}\n\n.blocklyToolboxDiv[layout=\"h\"] .blocklyTreeSeparator {\n  border-right: solid #e5e5e5 1px;\n  border-bottom: none;\n  height: auto;\n  margin: 0 5px 0 5px;\n  padding: 5px 0;\n  width: 0;\n}\n`);\n\nregistry.register(\n    registry.Type.TOOLBOX_ITEM, ToolboxSeparator.registrationName,\n    ToolboxSeparator);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * A toolbox category used to organize blocks in the toolbox.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.CollapsibleToolboxCategory');\n\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport * as registry from '../registry.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport * as toolbox from '../utils/toolbox.js';\n\nimport {ToolboxCategory} from './category.js';\nimport {ToolboxSeparator} from './separator.js';\n\n\n/**\n * Class for a category in a toolbox that can be collapsed.\n */\nexport class CollapsibleToolboxCategory extends ToolboxCategory implements\n    ICollapsibleToolboxItem {\n  /** Name used for registering a collapsible toolbox category. */\n  static override registrationName = 'collapsibleCategory';\n\n  /** Container for any child categories. */\n  protected subcategoriesDiv_: HTMLDivElement|null = null;\n\n  /** Whether or not the category should display its subcategories. */\n  protected expanded_ = false;\n\n  /** The child toolbox items for this category. */\n  protected toolboxItems_: IToolboxItem[] = [];\n\n  /**\n   * @param categoryDef The information needed to create a category in the\n   *     toolbox.\n   * @param toolbox The parent toolbox for the category.\n   * @param opt_parent The parent category or null if the category does not have\n   *     a parent.\n   */\n  constructor(\n      categoryDef: toolbox.CategoryInfo, toolbox: IToolbox,\n      opt_parent?: ICollapsibleToolboxItem) {\n    super(categoryDef, toolbox, opt_parent);\n  }\n\n  override makeDefaultCssConfig_() {\n    const cssConfig = super.makeDefaultCssConfig_();\n    cssConfig['contents'] = 'blocklyToolboxContents';\n    return cssConfig;\n  }\n\n  override parseContents_(categoryDef: toolbox.CategoryInfo) {\n    if ('custom' in categoryDef) {\n      this.flyoutItems_ = categoryDef['custom'];\n    } else {\n      const contents = categoryDef['contents'];\n      if (!contents) return;\n      this.flyoutItems_ = [];\n      let prevIsFlyoutItem = true;\n      for (let i = 0; i < contents.length; i++) {\n        const itemDef = contents[i];\n        // Separators can exist as either a flyout item or a toolbox item so\n        // decide where it goes based on the type of the previous item.\n        if (!registry.hasItem(registry.Type.TOOLBOX_ITEM, itemDef['kind']) ||\n            itemDef['kind'].toLowerCase() ===\n                    ToolboxSeparator.registrationName &&\n                prevIsFlyoutItem) {\n          const flyoutItem = itemDef as toolbox.FlyoutItemInfo;\n          this.flyoutItems_.push(flyoutItem);\n          prevIsFlyoutItem = true;\n        } else {\n          this.createToolboxItem_(itemDef);\n          prevIsFlyoutItem = false;\n        }\n      }\n    }\n  }\n\n  /**\n   * Creates a toolbox item and adds it to the list of toolbox items.\n   *\n   * @param itemDef The information needed to create a toolbox item.\n   */\n  private createToolboxItem_(itemDef: toolbox.ToolboxItemInfo) {\n    let registryName = itemDef['kind'];\n    const categoryDef = itemDef as toolbox.CategoryInfo;\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (registryName.toUpperCase() === 'CATEGORY' &&\n        toolbox.isCategoryCollapsible(categoryDef)) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n    const ToolboxItemClass =\n        registry.getClass(registry.Type.TOOLBOX_ITEM, registryName);\n    const toolboxItem =\n        new ToolboxItemClass!(itemDef, this.parentToolbox_, this);\n    this.toolboxItems_.push(toolboxItem);\n  }\n\n  override init() {\n    super.init();\n\n    this.setExpanded(\n        this.toolboxItemDef_['expanded'] === 'true' ||\n        !!this.toolboxItemDef_['expanded']);\n  }\n\n  override createDom_() {\n    super.createDom_();\n\n    const subCategories = this.getChildToolboxItems();\n    this.subcategoriesDiv_ = this.createSubCategoriesDom_(subCategories);\n    aria.setRole(this.subcategoriesDiv_, aria.Role.GROUP);\n    this.htmlDiv_!.appendChild(this.subcategoriesDiv_);\n\n    return this.htmlDiv_!;\n  }\n\n  override createIconDom_() {\n    const toolboxIcon = document.createElement('span');\n    if (!this.parentToolbox_.isHorizontal()) {\n      const className = this.cssConfig_['icon'];\n      if (className) {\n        dom.addClass(toolboxIcon, className);\n      }\n      toolboxIcon.style.visibility = 'visible';\n    }\n\n    toolboxIcon.style.display = 'inline-block';\n    return toolboxIcon;\n  }\n\n  /**\n   * Create the DOM for all subcategories.\n   *\n   * @param subcategories The subcategories.\n   * @returns The div holding all the subcategories.\n   */\n  protected createSubCategoriesDom_(subcategories: IToolboxItem[]):\n      HTMLDivElement {\n    const contentsContainer = document.createElement('div');\n    const className = this.cssConfig_['contents'];\n    if (className) {\n      dom.addClass(contentsContainer, className);\n    }\n\n    for (let i = 0; i < subcategories.length; i++) {\n      const newCategory = subcategories[i];\n      newCategory.init();\n      const newCategoryDiv = newCategory.getDiv();\n      contentsContainer.appendChild(newCategoryDiv!);\n      if (newCategory.getClickTarget) {\n        newCategory.getClickTarget()?.setAttribute('id', newCategory.getId());\n      }\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Opens or closes the current category.\n   *\n   * @param isExpanded True to expand the category, false to close.\n   */\n  setExpanded(isExpanded: boolean) {\n    if (this.expanded_ === isExpanded) {\n      return;\n    }\n    this.expanded_ = isExpanded;\n    if (isExpanded) {\n      this.subcategoriesDiv_!.style.display = 'block';\n      this.openIcon_(this.iconDom_);\n    } else {\n      this.subcategoriesDiv_!.style.display = 'none';\n      this.closeIcon_(this.iconDom_);\n    }\n    aria.setState(\n        this.htmlDiv_ as HTMLDivElement, aria.State.EXPANDED, isExpanded);\n\n    this.parentToolbox_.handleToolboxItemResize();\n  }\n\n  override setVisible_(isVisible: boolean) {\n    this.htmlDiv_!.style.display = isVisible ? 'block' : 'none';\n    const childToolboxItems = this.getChildToolboxItems();\n    for (let i = 0; i < childToolboxItems.length; i++) {\n      const child = childToolboxItems[i];\n      child.setVisible_(isVisible);\n    }\n    this.isHidden_ = !isVisible;\n\n    if (this.parentToolbox_.getSelectedItem() === this) {\n      this.parentToolbox_.clearSelection();\n    }\n  }\n\n  /**\n   * Whether the category is expanded to show its child subcategories.\n   *\n   * @returns True if the toolbox item shows its children, false if it is\n   *     collapsed.\n   */\n  isExpanded(): boolean {\n    return this.expanded_;\n  }\n\n  override isCollapsible() {\n    return true;\n  }\n\n  override onClick(_e: Event) {\n    this.toggleExpanded();\n  }\n\n  /** Toggles whether or not the category is expanded. */\n  toggleExpanded() {\n    this.setExpanded(!this.expanded_);\n  }\n\n  override getDiv() {\n    return this.htmlDiv_;\n  }\n\n  /**\n   * Gets any children toolbox items. (ex. Gets the subcategories)\n   *\n   * @returns The child toolbox items.\n   */\n  getChildToolboxItems(): IToolboxItem[] {\n    return this.toolboxItems_;\n  }\n}\n\nexport namespace CollapsibleToolboxCategory {\n  /**\n   * All the CSS class names that are used to create a collapsible\n   * category. This is all the properties from the regular category plus\n   * contents.\n   */\n  export interface CssConfig {\n    container: string|null;\n    row: string|null;\n    rowcontentcontainer: string|null;\n    icon: string|null;\n    label: string|null;\n    selected: string|null;\n    openicon: string|null;\n    closedicon: string|null;\n    contents: string|null;\n  }\n}\n\nexport type CssConfig = CollapsibleToolboxCategory.CssConfig;\n\nregistry.register(\n    registry.Type.TOOLBOX_ITEM, CollapsibleToolboxCategory.registrationName,\n    CollapsibleToolboxCategory);\n", "/**\n * @license\n * Copyright 2020 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Toolbox from whence to create blocks.\n *\n * @class\n */\nimport * as goog from '../../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Toolbox');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport '../events/events_toolbox_item_select.js';\n\nimport {BlockSvg} from '../block_svg.js';\nimport type {BlocklyOptions} from '../blockly_options.js';\nimport * as browserEvents from '../browser_events.js';\nimport * as common from '../common.js';\nimport {ComponentManager} from '../component_manager.js';\nimport * as Css from '../css.js';\nimport {DeleteArea} from '../delete_area.js';\nimport * as eventUtils from '../events/utils.js';\nimport type {IAutoHideable} from '../interfaces/i_autohideable.js';\nimport type {ICollapsibleToolboxItem} from '../interfaces/i_collapsible_toolbox_item.js';\nimport type {IDraggable} from '../interfaces/i_draggable.js';\nimport type {IFlyout} from '../interfaces/i_flyout.js';\nimport type {IKeyboardAccessible} from '../interfaces/i_keyboard_accessible.js';\nimport type {ISelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport {isSelectableToolboxItem} from '../interfaces/i_selectable_toolbox_item.js';\nimport type {IStyleable} from '../interfaces/i_styleable.js';\nimport type {IToolbox} from '../interfaces/i_toolbox.js';\nimport type {IToolboxItem} from '../interfaces/i_toolbox_item.js';\nimport {Options} from '../options.js';\nimport * as registry from '../registry.js';\nimport type {KeyboardShortcut} from '../shortcut_registry.js';\nimport * as Touch from '../touch.js';\nimport * as aria from '../utils/aria.js';\nimport * as dom from '../utils/dom.js';\nimport {Rect} from '../utils/rect.js';\nimport * as toolbox from '../utils/toolbox.js';\nimport type {WorkspaceSvg} from '../workspace_svg.js';\n\nimport type {ToolboxCategory} from './category.js';\nimport {CollapsibleToolboxCategory} from './collapsible_category.js';\n\n\n/**\n * Class for a Toolbox.\n * Creates the toolbox's DOM.\n */\nexport class Toolbox extends DeleteArea implements IAutoHideable,\n                                                   IKeyboardAccessible,\n                                                   IStyleable, IToolbox {\n  /**\n   * The unique ID for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'toolbox';\n  protected toolboxDef_: toolbox.ToolboxInfo;\n  private readonly horizontalLayout_: boolean;\n\n  /** The HTML container for the toolbox. */\n  HtmlDiv: HTMLDivElement|null = null;\n\n  /** The HTML container for the contents of a toolbox. */\n  protected contentsDiv_: HTMLDivElement|null = null;\n\n  /** Whether the Toolbox is visible. */\n  protected isVisible_ = false;\n\n  /** The list of items in the toolbox. */\n  protected contents_: IToolboxItem[] = [];\n\n  /** The width of the toolbox. */\n  protected width_ = 0;\n\n  /** The height of the toolbox. */\n  protected height_ = 0;\n  RTL: boolean;\n\n  /** The flyout for the toolbox. */\n  private flyout_: IFlyout|null = null;\n  protected contentMap_: {[key: string]: IToolboxItem};\n  toolboxPosition: toolbox.Position;\n\n  /** The currently selected item. */\n  protected selectedItem_: ISelectableToolboxItem|null = null;\n\n  /** The previously selected item. */\n  protected previouslySelectedItem_: ISelectableToolboxItem|null = null;\n\n  /**\n   * Array holding info needed to unbind event handlers.\n   * Used for disposing.\n   * Ex: [[node, name, func], [node, name, func]].\n   */\n  protected boundEvents_: browserEvents.Data[] = [];\n\n  /** The workspace this toolbox is on. */\n  protected readonly workspace_: WorkspaceSvg;\n\n  /** @param workspace The workspace in which to create new blocks. */\n  constructor(workspace: WorkspaceSvg) {\n    super();\n\n    this.workspace_ = workspace;\n\n    /** The JSON describing the contents of this toolbox. */\n    this.toolboxDef_ =\n        (workspace.options.languageTree ||\n         {contents: new Array<toolbox.ToolboxItemInfo>()});\n\n    /** Whether the toolbox should be laid out horizontally. */\n    this.horizontalLayout_ = workspace.options.horizontalLayout;\n\n    /** Is RTL vs LTR. */\n    this.RTL = workspace.options.RTL;\n\n    /** A map from toolbox item IDs to toolbox items. */\n    this.contentMap_ = Object.create(null);\n\n    /** Position of the toolbox and flyout relative to the workspace. */\n    this.toolboxPosition = workspace.options.toolboxPosition;\n  }\n\n  /**\n   * Handles the given keyboard shortcut.\n   *\n   * @param _shortcut The shortcut to be handled.\n   * @returns True if the shortcut has been handled, false otherwise.\n   */\n  onShortcut(_shortcut: KeyboardShortcut): boolean {\n    return false;\n  }\n\n  /** Initializes the toolbox */\n  init() {\n    const workspace = this.workspace_;\n    const svg = workspace.getParentSvg();\n\n    this.flyout_ = this.createFlyout_();\n\n    this.HtmlDiv = this.createDom_(this.workspace_);\n    dom.insertAfter(this.flyout_.createDom('svg'), svg);\n    this.setVisible(true);\n    this.flyout_.init(workspace);\n\n    this.render(this.toolboxDef_);\n    const themeManager = workspace.getThemeManager();\n    themeManager.subscribe(\n        this.HtmlDiv, 'toolboxBackgroundColour', 'background-color');\n    themeManager.subscribe(this.HtmlDiv, 'toolboxForegroundColour', 'color');\n    this.workspace_.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n      ],\n    });\n  }\n\n  /**\n   * Creates the DOM for the toolbox.\n   *\n   * @param workspace The workspace this toolbox is on.\n   * @returns The HTML container for the toolbox.\n   */\n  protected createDom_(workspace: WorkspaceSvg): HTMLDivElement {\n    const svg = workspace.getParentSvg();\n\n    const container = this.createContainer_();\n\n    this.contentsDiv_ = this.createContentsContainer_();\n    this.contentsDiv_.tabIndex = 0;\n    aria.setRole(this.contentsDiv_, aria.Role.TREE);\n    container.appendChild(this.contentsDiv_);\n\n    svg.parentNode!.insertBefore(container, svg);\n\n    this.attachEvents_(container, this.contentsDiv_);\n    return container;\n  }\n\n  /**\n   * Creates the container div for the toolbox.\n   *\n   * @returns The HTML container for the toolbox.\n   */\n  protected createContainer_(): HTMLDivElement {\n    const toolboxContainer = (document.createElement('div'));\n    toolboxContainer.setAttribute('layout', this.isHorizontal() ? 'h' : 'v');\n    dom.addClass(toolboxContainer, 'blocklyToolboxDiv');\n    dom.addClass(toolboxContainer, 'blocklyNonSelectable');\n    toolboxContainer.setAttribute('dir', this.RTL ? 'RTL' : 'LTR');\n    return toolboxContainer;\n  }\n\n  /**\n   * Creates the container for all the contents in the toolbox.\n   *\n   * @returns The HTML container for the toolbox contents.\n   */\n  protected createContentsContainer_(): HTMLDivElement {\n    const contentsContainer = (document.createElement('div'));\n    dom.addClass(contentsContainer, 'blocklyToolboxContents');\n    if (this.isHorizontal()) {\n      contentsContainer.style.flexDirection = 'row';\n    }\n    return contentsContainer;\n  }\n\n  /**\n   * Adds event listeners to the toolbox container div.\n   *\n   * @param container The HTML container for the toolbox.\n   * @param contentsContainer The HTML container for the contents of the\n   *     toolbox.\n   */\n  protected attachEvents_(\n      container: HTMLDivElement, contentsContainer: HTMLDivElement) {\n    // Clicking on toolbox closes popups.\n    const clickEvent = browserEvents.conditionalBind(\n        container, 'pointerdown', this, this.onClick_,\n        /* opt_noCaptureIdentifier */ false);\n    this.boundEvents_.push(clickEvent);\n\n    const keyDownEvent = browserEvents.conditionalBind(\n        contentsContainer, 'keydown', this, this.onKeyDown_,\n        /* opt_noCaptureIdentifier */ false);\n    this.boundEvents_.push(keyDownEvent);\n  }\n\n  /**\n   * Handles on click events for when the toolbox or toolbox items are clicked.\n   *\n   * @param e Click event to handle.\n   */\n  protected onClick_(e: PointerEvent) {\n    if (browserEvents.isRightButton(e) || e.target === this.HtmlDiv) {\n      // Close flyout.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(false);\n    } else {\n      const targetElement = e.target;\n      const itemId = (targetElement as Element).getAttribute('id');\n      if (itemId) {\n        const item = this.getToolboxItemById(itemId);\n        if (item!.isSelectable()) {\n          this.setSelectedItem(item);\n          (item as ISelectableToolboxItem).onClick(e);\n        }\n      }\n      // Just close popups.\n      (common.getMainWorkspace() as WorkspaceSvg).hideChaff(true);\n    }\n    Touch.clearTouchIdentifier();\n  }\n\n  /**\n   * Handles key down events for the toolbox.\n   *\n   * @param e The key down event.\n   */\n  protected onKeyDown_(e: KeyboardEvent) {\n    let handled = false;\n    switch (e.key) {\n      case 'ArrowDown':\n        handled = this.selectNext_();\n        break;\n      case 'ArrowUp':\n        handled = this.selectPrevious_();\n        break;\n      case 'ArrowLeft':\n        handled = this.selectParent_();\n        break;\n      case 'ArrowRight':\n        handled = this.selectChild_();\n        break;\n      case 'Enter':\n      case ' ':\n        if (this.selectedItem_ && this.selectedItem_.isCollapsible()) {\n          const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n          collapsibleItem.toggleExpanded();\n          handled = true;\n        }\n        break;\n      default:\n        handled = false;\n        break;\n    }\n    if (!handled && this.selectedItem_) {\n      // TODO(#6097): Figure out who implements onKeyDown and which interface it\n      // should be part of.\n      if ((this.selectedItem_ as any).onKeyDown) {\n        handled = (this.selectedItem_ as any).onKeyDown(e);\n      }\n    }\n\n    if (handled) {\n      e.preventDefault();\n    }\n  }\n\n  /**\n   * Creates the flyout based on the toolbox layout.\n   *\n   * @returns The flyout for the toolbox.\n   * @throws {Error} If missing a require for `Blockly.HorizontalFlyout`,\n   *     `Blockly.VerticalFlyout`, and no flyout plugin is specified.\n   */\n  protected createFlyout_(): IFlyout {\n    const workspace = this.workspace_;\n    // TODO (#4247): Look into adding a makeFlyout method to Blockly Options.\n    const workspaceOptions = new Options(({\n      'parentWorkspace': workspace,\n      'rtl': workspace.RTL,\n      'oneBasedIndex': workspace.options.oneBasedIndex,\n      'horizontalLayout': workspace.horizontalLayout,\n      'renderer': workspace.options.renderer,\n      'rendererOverrides': workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions));\n    // Options takes in either 'end' or 'start'. This has already been parsed to\n    // be either 0 or 1, so set it after.\n    workspaceOptions.toolboxPosition = workspace.options.toolboxPosition;\n    let FlyoutClass = null;\n    if (workspace.horizontalLayout) {\n      FlyoutClass = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, workspace.options, true);\n    } else {\n      FlyoutClass = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_VERTICAL_TOOLBOX, workspace.options, true);\n    }\n    return new FlyoutClass!(workspaceOptions);\n  }\n\n  /**\n   * Fills the toolbox with new toolbox items and removes any old contents.\n   *\n   * @param toolboxDef Object holding information for creating a toolbox.\n   * @internal\n   */\n  render(toolboxDef: toolbox.ToolboxInfo) {\n    this.toolboxDef_ = toolboxDef;\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      if (toolboxItem) {\n        toolboxItem.dispose();\n      }\n    }\n    this.contents_ = [];\n    this.contentMap_ = Object.create(null);\n    this.renderContents_(toolboxDef['contents']);\n    this.position();\n    this.handleToolboxItemResize();\n  }\n\n  /**\n   * Adds all the toolbox items to the toolbox.\n   *\n   * @param toolboxDef Array holding objects containing information on the\n   *     contents of the toolbox.\n   */\n  protected renderContents_(toolboxDef: toolbox.ToolboxItemInfo[]) {\n    // This is for performance reasons. By using document fragment we only have\n    // to add to the DOM once.\n    const fragment = document.createDocumentFragment();\n    for (let i = 0; i < toolboxDef.length; i++) {\n      const toolboxItemDef = toolboxDef[i];\n      this.createToolboxItem_(toolboxItemDef, fragment);\n    }\n    this.contentsDiv_!.appendChild(fragment);\n  }\n\n  /**\n   * Creates and renders the toolbox item.\n   *\n   * @param toolboxItemDef Any information that can be used to create an item in\n   *     the toolbox.\n   * @param fragment The document fragment to add the child toolbox elements to.\n   */\n  private createToolboxItem_(\n      toolboxItemDef: toolbox.ToolboxItemInfo, fragment: DocumentFragment) {\n    let registryName = toolboxItemDef['kind'];\n\n    // Categories that are collapsible are created using a class registered\n    // under a different name.\n    if (registryName.toUpperCase() === 'CATEGORY' &&\n        toolbox.isCategoryCollapsible(toolboxItemDef as toolbox.CategoryInfo)) {\n      registryName = CollapsibleToolboxCategory.registrationName;\n    }\n\n    const ToolboxItemClass = registry.getClass(\n        registry.Type.TOOLBOX_ITEM, registryName.toLowerCase());\n    if (ToolboxItemClass) {\n      const toolboxItem = new ToolboxItemClass(toolboxItemDef, this);\n      toolboxItem.init();\n      this.addToolboxItem_(toolboxItem);\n      const toolboxItemDom = toolboxItem.getDiv();\n      if (toolboxItemDom) {\n        fragment.appendChild(toolboxItemDom);\n      }\n      // Adds the ID to the HTML element that can receive a click.\n      // This is used in onClick_ to find the toolboxItem that was clicked.\n      if (toolboxItem.getClickTarget()) {\n        toolboxItem.getClickTarget()!.setAttribute('id', toolboxItem.getId());\n      }\n    }\n  }\n\n  /**\n   * Adds an item to the toolbox.\n   *\n   * @param toolboxItem The item in the toolbox.\n   */\n  protected addToolboxItem_(toolboxItem: IToolboxItem) {\n    this.contents_.push(toolboxItem);\n    this.contentMap_[toolboxItem.getId()] = toolboxItem;\n    if (toolboxItem.isCollapsible()) {\n      const collapsibleItem = toolboxItem as ICollapsibleToolboxItem;\n      const childToolboxItems = collapsibleItem.getChildToolboxItems();\n      for (let i = 0; i < childToolboxItems.length; i++) {\n        const child = childToolboxItems[i];\n        this.addToolboxItem_(child);\n      }\n    }\n  }\n\n  /**\n   * Gets the items in the toolbox.\n   *\n   * @returns The list of items in the toolbox.\n   */\n  getToolboxItems(): IToolboxItem[] {\n    return this.contents_;\n  }\n\n  /**\n   * Adds a style on the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to add.\n   * @internal\n   */\n  addStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.addClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Removes a style from the toolbox. Usually used to change the cursor.\n   *\n   * @param style The name of the class to remove.\n   * @internal\n   */\n  removeStyle(style: string) {\n    if (style && this.HtmlDiv) {\n      dom.removeClass(this.HtmlDiv, style);\n    }\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.HtmlDiv || !this.isVisible_) {\n      return null;\n    }\n    // BIG_NUM is offscreen padding so that blocks dragged beyond the toolbox\n    // area are still deleted.  Must be smaller than Infinity, but larger than\n    // the largest screen size.\n    const BIG_NUM = 10000000;\n    const toolboxRect = this.HtmlDiv.getBoundingClientRect();\n\n    const top = toolboxRect.top;\n    const bottom = top + toolboxRect.height;\n    const left = toolboxRect.left;\n    const right = left + toolboxRect.width;\n\n    // Assumes that the toolbox is on the SVG edge.  If this changes\n    // (e.g. toolboxes in mutators) then this code will need to be more complex.\n    if (this.toolboxPosition === toolbox.Position.TOP) {\n      return new Rect(-BIG_NUM, bottom, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.BOTTOM) {\n      return new Rect(top, BIG_NUM, -BIG_NUM, BIG_NUM);\n    } else if (this.toolboxPosition === toolbox.Position.LEFT) {\n      return new Rect(-BIG_NUM, BIG_NUM, -BIG_NUM, right);\n    } else {  // Right\n      return new Rect(-BIG_NUM, BIG_NUM, left, BIG_NUM);\n    }\n  }\n\n  /**\n   * Returns whether the provided block or bubble would be deleted if dropped on\n   * this area.\n   * This method should check if the element is deletable and is always called\n   * before onDragEnter/onDragOver/onDragExit.\n   *\n   * @param element The block or bubble currently being dragged.\n   * @param _couldConnect Whether the element could could connect to another.\n   * @returns Whether the element provided would be deleted if dropped on this\n   *     area.\n   */\n  override wouldDelete(element: IDraggable, _couldConnect: boolean): boolean {\n    if (element instanceof BlockSvg) {\n      const block = (element);\n      // Prefer dragging to the toolbox over connecting to other blocks.\n      this.updateWouldDelete_(!block.getParent() && block.isDeletable());\n    } else {\n      this.updateWouldDelete_(element.isDeletable());\n    }\n    return this.wouldDelete_;\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble enters this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragEnter(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    this.updateCursorDeleteStyle_(false);\n  }\n\n  /**\n   * Updates the internal wouldDelete_ state.\n   *\n   * @param wouldDelete The new value for the wouldDelete state.\n   */\n  protected override updateWouldDelete_(wouldDelete: boolean) {\n    if (wouldDelete === this.wouldDelete_) {\n      return;\n    }\n    // This logic handles updating the deleteStyle properly if the delete state\n    // changes while the block is over the Toolbox. This could happen if the\n    // implementation of wouldDeleteBlock depends on the couldConnect parameter\n    // or if the isDeletable property of the block currently being dragged\n    // changes during the drag.\n    this.updateCursorDeleteStyle_(false);\n    this.wouldDelete_ = wouldDelete;\n    this.updateCursorDeleteStyle_(true);\n  }\n\n  /**\n   * Adds or removes the CSS style of the cursor over the toolbox based whether\n   * the block or bubble over it is expected to be deleted if dropped (using the\n   * internal this.wouldDelete_ property).\n   *\n   * @param addStyle Whether the style should be added or removed.\n   */\n  protected updateCursorDeleteStyle_(addStyle: boolean) {\n    const style =\n        this.wouldDelete_ ? 'blocklyToolboxDelete' : 'blocklyToolboxGrab';\n    if (addStyle) {\n      this.addStyle(style);\n    } else {\n      this.removeStyle(style);\n    }\n  }\n\n  /**\n   * Gets the toolbox item with the given ID.\n   *\n   * @param id The ID of the toolbox item.\n   * @returns The toolbox item with the given ID, or null if no item exists.\n   */\n  getToolboxItemById(id: string): IToolboxItem|null {\n    return this.contentMap_[id] || null;\n  }\n\n  /**\n   * Gets the width of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getWidth(): number {\n    return this.width_;\n  }\n\n  /**\n   * Gets the height of the toolbox.\n   *\n   * @returns The width of the toolbox.\n   */\n  getHeight(): number {\n    return this.height_;\n  }\n\n  /**\n   * Gets the toolbox flyout.\n   *\n   * @returns The toolbox flyout.\n   */\n  getFlyout(): IFlyout|null {\n    return this.flyout_;\n  }\n\n  /**\n   * Gets the workspace for the toolbox.\n   *\n   * @returns The parent workspace for the toolbox.\n   */\n  getWorkspace(): WorkspaceSvg {\n    return this.workspace_;\n  }\n\n  /**\n   * Gets the selected item.\n   *\n   * @returns The selected item, or null if no item is currently selected.\n   */\n  getSelectedItem(): ISelectableToolboxItem|null {\n    return this.selectedItem_;\n  }\n\n  /**\n   * Gets the previously selected item.\n   *\n   * @returns The previously selected item, or null if no item was previously\n   *     selected.\n   */\n  getPreviouslySelectedItem(): ISelectableToolboxItem|null {\n    return this.previouslySelectedItem_;\n  }\n\n  /**\n   * Gets whether or not the toolbox is horizontal.\n   *\n   * @returns True if the toolbox is horizontal, false if the toolbox is\n   *     vertical.\n   */\n  isHorizontal(): boolean {\n    return this.horizontalLayout_;\n  }\n\n  /**\n   * Positions the toolbox based on whether it is a horizontal toolbox and\n   * whether the workspace is in rtl.\n   */\n  position() {\n    const workspaceMetrics = this.workspace_.getMetrics();\n    const toolboxDiv = this.HtmlDiv;\n    if (!toolboxDiv) {\n      // Not initialized yet.\n      return;\n    }\n\n    if (this.horizontalLayout_) {\n      toolboxDiv.style.left = '0';\n      toolboxDiv.style.height = 'auto';\n      toolboxDiv.style.width = '100%';\n      this.height_ = toolboxDiv.offsetHeight;\n      this.width_ = workspaceMetrics.viewWidth;\n      if (this.toolboxPosition === toolbox.Position.TOP) {\n        toolboxDiv.style.top = '0';\n      } else {  // Bottom\n        toolboxDiv.style.bottom = '0';\n      }\n    } else {\n      if (this.toolboxPosition === toolbox.Position.RIGHT) {\n        toolboxDiv.style.right = '0';\n      } else {  // Left\n        toolboxDiv.style.left = '0';\n      }\n      toolboxDiv.style.height = '100%';\n      this.width_ = toolboxDiv.offsetWidth;\n      this.height_ = workspaceMetrics.viewHeight;\n    }\n    this.flyout_!.position();\n  }\n\n  /**\n   * Handles resizing the toolbox when a toolbox item resizes.\n   *\n   * @internal\n   */\n  handleToolboxItemResize() {\n    // Reposition the workspace so that (0,0) is in the correct position\n    // relative to the new absolute edge (ie toolbox edge).\n    const workspace = this.workspace_;\n    const rect = this.HtmlDiv!.getBoundingClientRect();\n    const newX = this.toolboxPosition === toolbox.Position.LEFT ?\n        workspace.scrollX + rect.width :\n        workspace.scrollX;\n    const newY = this.toolboxPosition === toolbox.Position.TOP ?\n        workspace.scrollY + rect.height :\n        workspace.scrollY;\n    workspace.translate(newX, newY);\n\n    // Even though the div hasn't changed size, the visible workspace\n    // surface of the workspace has, so we may need to reposition everything.\n    common.svgResize(workspace);\n  }\n\n  /** Unhighlights any previously selected item. */\n  clearSelection() {\n    this.setSelectedItem(null);\n  }\n\n  /**\n   * Updates the category colours and background colour of selected categories.\n   *\n   * @internal\n   */\n  refreshTheme() {\n    for (let i = 0; i < this.contents_.length; i++) {\n      const child = this.contents_[i];\n      // TODO(#6097): Fix types or add refreshTheme to IToolboxItem.\n      const childAsCategory = child as ToolboxCategory;\n      if (childAsCategory.refreshTheme) {\n        childAsCategory.refreshTheme();\n      }\n    }\n  }\n\n  /**\n   * Updates the flyout's content without closing it.  Should be used in\n   * response to a change in one of the dynamic categories, such as variables or\n   * procedures.\n   */\n  refreshSelection() {\n    if (this.selectedItem_ && this.selectedItem_.isSelectable() &&\n        this.selectedItem_.getContents().length) {\n      this.flyout_!.show(this.selectedItem_.getContents());\n    }\n  }\n\n  /**\n   * Shows or hides the toolbox.\n   *\n   * @param isVisible True if toolbox should be visible.\n   */\n  setVisible(isVisible: boolean) {\n    if (this.isVisible_ === isVisible) {\n      return;\n    }\n\n    this.HtmlDiv!.style.display = isVisible ? 'block' : 'none';\n    this.isVisible_ = isVisible;\n    // Invisible toolbox is ignored as drag targets and must have the drag\n    // target updated.\n    this.workspace_.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    if (!onlyClosePopups && this.flyout_ && this.flyout_.autoClose) {\n      this.clearSelection();\n    }\n  }\n\n  /**\n   * Sets the given item as selected.\n   * No-op if the item is not selectable.\n   *\n   * @param newItem The toolbox item to select.\n   */\n  setSelectedItem(newItem: IToolboxItem|null) {\n    const oldItem = this.selectedItem_;\n\n    if (!newItem && !oldItem || newItem && !isSelectableToolboxItem(newItem)) {\n      return;\n    }\n\n    if (this.shouldDeselectItem_(oldItem, newItem) && oldItem !== null) {\n      this.deselectItem_(oldItem);\n    }\n\n    if (this.shouldSelectItem_(oldItem, newItem) && newItem !== null) {\n      this.selectItem_(oldItem, newItem);\n    }\n\n    this.updateFlyout_(oldItem, newItem);\n    this.fireSelectEvent_(oldItem, newItem);\n  }\n\n  /**\n   * Decides whether the old item should be deselected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the old item should be deselected, false otherwise.\n   */\n  protected shouldDeselectItem_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null): boolean {\n    // Deselect the old item unless the old item is collapsible and has been\n    // previously clicked on.\n    return oldItem !== null &&\n        (!oldItem.isCollapsible() || oldItem !== newItem);\n  }\n\n  /**\n   * Decides whether the new item should be selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   * @returns True if the new item should be selected, false otherwise.\n   */\n  protected shouldSelectItem_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null): boolean {\n    // Select the new item unless the old item equals the new item.\n    return newItem !== null && newItem !== oldItem;\n  }\n\n  /**\n   * Deselects the given item, marks it as unselected, and updates aria state.\n   *\n   * @param item The previously selected toolbox item which should be\n   *     deselected.\n   */\n  protected deselectItem_(item: ISelectableToolboxItem) {\n    this.selectedItem_ = null;\n    this.previouslySelectedItem_ = item;\n    item.setSelected(false);\n    aria.setState(\n        this.contentsDiv_ as Element, aria.State.ACTIVEDESCENDANT, '');\n  }\n\n  /**\n   * Selects the given item, marks it selected, and updates aria state.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected selectItem_(\n      oldItem: ISelectableToolboxItem|null, newItem: ISelectableToolboxItem) {\n    this.selectedItem_ = newItem;\n    this.previouslySelectedItem_ = oldItem;\n    newItem.setSelected(true);\n    aria.setState(\n        this.contentsDiv_ as Element, aria.State.ACTIVEDESCENDANT,\n        newItem.getId());\n  }\n\n  /**\n   * Selects the toolbox item by its position in the list of toolbox items.\n   *\n   * @param position The position of the item to select.\n   */\n  selectItemByPosition(position: number) {\n    if (position > -1 && position < this.contents_.length) {\n      const item = this.contents_[position];\n      if (item.isSelectable()) {\n        this.setSelectedItem(item);\n      }\n    }\n  }\n\n  /**\n   * Decides whether to hide or show the flyout depending on the selected item.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  protected updateFlyout_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null) {\n    if (!newItem || oldItem === newItem && !newItem.isCollapsible() ||\n        !newItem.getContents().length) {\n      this.flyout_!.hide();\n    } else {\n      this.flyout_!.show(newItem.getContents());\n      this.flyout_!.scrollToStart();\n    }\n  }\n\n  /**\n   * Emits an event when a new toolbox item is selected.\n   *\n   * @param oldItem The previously selected toolbox item.\n   * @param newItem The newly selected toolbox item.\n   */\n  private fireSelectEvent_(\n      oldItem: ISelectableToolboxItem|null,\n      newItem: ISelectableToolboxItem|null) {\n    const oldElement = oldItem && oldItem.getName();\n    let newElement = newItem && newItem.getName();\n    // In this case the toolbox closes, so the newElement should be null.\n    if (oldItem === newItem) {\n      newElement = null;\n    }\n    const event = new (eventUtils.get(eventUtils.TOOLBOX_ITEM_SELECT))(\n        oldElement, newElement, this.workspace_.id);\n    eventUtils.fire(event);\n  }\n\n  /**\n   * Closes the current item if it is expanded, or selects the parent.\n   *\n   * @returns True if a parent category was selected, false otherwise.\n   */\n  private selectParent_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    if (this.selectedItem_.isCollapsible() &&\n        (this.selectedItem_ as ICollapsibleToolboxItem).isExpanded()) {\n      const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else if (\n        this.selectedItem_.getParent() &&\n        this.selectedItem_.getParent()!.isSelectable()) {\n      this.setSelectedItem(this.selectedItem_.getParent());\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Selects the first child of the currently selected item, or nothing if the\n   * toolbox item has no children.\n   *\n   * @returns True if a child category was selected, false otherwise.\n   */\n  private selectChild_(): boolean {\n    if (!this.selectedItem_ || !this.selectedItem_.isCollapsible()) {\n      return false;\n    }\n    const collapsibleItem = this.selectedItem_ as ICollapsibleToolboxItem;\n    if (!collapsibleItem.isExpanded()) {\n      collapsibleItem.toggleExpanded();\n      return true;\n    } else {\n      this.selectNext_();\n      return true;\n    }\n  }\n\n  /**\n   * Selects the next visible toolbox item.\n   *\n   * @returns True if a next category was selected, false otherwise.\n   */\n  private selectNext_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let nextItemIdx = this.contents_.indexOf(this.selectedItem_) + 1;\n    if (nextItemIdx > -1 && nextItemIdx < this.contents_.length) {\n      let nextItem = this.contents_[nextItemIdx];\n      while (nextItem && !nextItem.isSelectable()) {\n        nextItem = this.contents_[++nextItemIdx];\n      }\n      if (nextItem && nextItem.isSelectable()) {\n        this.setSelectedItem(nextItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /**\n   * Selects the previous visible toolbox item.\n   *\n   * @returns True if a previous category was selected, false otherwise.\n   */\n  private selectPrevious_(): boolean {\n    if (!this.selectedItem_) {\n      return false;\n    }\n\n    let prevItemIdx = this.contents_.indexOf(this.selectedItem_) - 1;\n    if (prevItemIdx > -1 && prevItemIdx < this.contents_.length) {\n      let prevItem = this.contents_[prevItemIdx];\n      while (prevItem && !prevItem.isSelectable()) {\n        prevItem = this.contents_[--prevItemIdx];\n      }\n      if (prevItem && prevItem.isSelectable()) {\n        this.setSelectedItem(prevItem);\n        return true;\n      }\n    }\n    return false;\n  }\n\n  /** Disposes of this toolbox. */\n  dispose() {\n    this.workspace_.getComponentManager().removeComponent('toolbox');\n    this.flyout_!.dispose();\n    for (let i = 0; i < this.contents_.length; i++) {\n      const toolboxItem = this.contents_[i];\n      toolboxItem.dispose();\n    }\n\n    for (let j = 0; j < this.boundEvents_.length; j++) {\n      browserEvents.unbind(this.boundEvents_[j]);\n    }\n    this.boundEvents_ = [];\n    this.contents_ = [];\n\n    if (this.HtmlDiv) {\n      this.workspace_.getThemeManager().unsubscribe(this.HtmlDiv);\n      dom.removeNode(this.HtmlDiv);\n    }\n  }\n}\n\n/** CSS for Toolbox.  See css.js for use. */\nCss.register(`\n.blocklyToolboxDelete {\n  cursor: url(\"<<<PATH>>>/handdelete.cur\"), auto;\n}\n\n.blocklyToolboxGrab {\n  cursor: url(\"<<<PATH>>>/handclosed.cur\"), auto;\n  cursor: grabbing;\n  cursor: -webkit-grabbing;\n}\n\n/* Category tree in Toolbox. */\n.blocklyToolboxDiv {\n  background-color: #ddd;\n  overflow-x: visible;\n  overflow-y: auto;\n  padding: 4px 0 4px 0;\n  position: absolute;\n  z-index: 70;  /* so blocks go under toolbox when dragging */\n  -webkit-tap-highlight-color: transparent;  /* issue #1345 */\n}\n\n.blocklyToolboxContents {\n  display: flex;\n  flex-wrap: wrap;\n  flex-direction: column;\n}\n\n.blocklyToolboxContents:focus {\n  outline: none;\n}\n`);\n\nregistry.register(registry.Type.TOOLBOX, registry.DEFAULT, Toolbox);\n", "/**\n * @license\n * Copyright 2011 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * Object representing a trash can icon.\n *\n * @class\n */\nimport * as goog from '../closure/goog/goog.js';\ngoog.declareModuleId('Blockly.Trashcan');\n\n// Unused import preserved for side-effects. Remove if unneeded.\nimport './events/events_trashcan_open.js';\n\nimport type {BlocklyOptions} from './blockly_options.js';\nimport * as browserEvents from './browser_events.js';\nimport {ComponentManager} from './component_manager.js';\nimport {DeleteArea} from './delete_area.js';\nimport type {Abstract} from './events/events_abstract.js';\nimport type {BlockDelete} from './events/events_block_delete.js';\nimport * as eventUtils from './events/utils.js';\nimport type {IAutoHideable} from './interfaces/i_autohideable.js';\nimport type {IDraggable} from './interfaces/i_draggable.js';\nimport type {IFlyout} from './interfaces/i_flyout.js';\nimport type {IPositionable} from './interfaces/i_positionable.js';\nimport type {UiMetrics} from './metrics_manager.js';\nimport {Options} from './options.js';\nimport * as uiPosition from './positionable_helpers.js';\nimport * as registry from './registry.js';\nimport type * as blocks from './serialization/blocks.js';\nimport {SPRITE} from './sprites.js';\nimport * as dom from './utils/dom.js';\nimport {Rect} from './utils/rect.js';\nimport {Size} from './utils/size.js';\nimport {Svg} from './utils/svg.js';\nimport {BlockInfo} from './utils/toolbox.js';\nimport * as toolbox from './utils/toolbox.js';\nimport type {WorkspaceSvg} from './workspace_svg.js';\n\n\n/**\n * Class for a trash can.\n */\nexport class Trashcan extends DeleteArea implements IAutoHideable,\n                                                    IPositionable {\n  /**\n   * The unique id for this component that is used to register with the\n   * ComponentManager.\n   */\n  override id = 'trashcan';\n\n  /**\n   * A list of JSON (stored as strings) representing blocks in the trashcan.\n   */\n  private readonly contents_: string[] = [];\n\n  /**\n   * The trashcan flyout.\n   *\n   * @internal\n   */\n  flyout: IFlyout|null = null;\n\n  /** Current open/close state of the lid. */\n  isLidOpen = false;\n\n  /**\n   * The minimum openness of the lid. Used to indicate if the trashcan\n   * contains blocks.\n   */\n  private minOpenness_ = 0;\n\n  /** The SVG group containing the trash can. */\n  private svgGroup_: SVGElement|null = null;\n\n  /** The SVG image element of the trash can lid. */\n  private svgLid_: SVGElement|null = null;\n\n  /** Task ID of opening/closing animation. */\n  private lidTask_: ReturnType<typeof setTimeout>|null = null;\n\n  /** Current state of lid opening (0.0 = closed, 1.0 = open). */\n  private lidOpen_ = 0;\n\n  /** Left coordinate of the trash can. */\n  private left_ = 0;\n\n  /** Top coordinate of the trash can. */\n  private top_ = 0;\n\n  /** Whether this trash can has been initialized. */\n  private initialized_ = false;\n\n  /** @param workspace The workspace to sit in. */\n  constructor(private workspace: WorkspaceSvg) {\n    super();\n\n    if (this.workspace.options.maxTrashcanContents <= 0) {\n      return;\n    }\n\n    // Create flyout options.\n    const flyoutWorkspaceOptions = new Options(({\n      'scrollbars': true,\n      'parentWorkspace': this.workspace,\n      'rtl': this.workspace.RTL,\n      'oneBasedIndex': this.workspace.options.oneBasedIndex,\n      'renderer': this.workspace.options.renderer,\n      'rendererOverrides': this.workspace.options.rendererOverrides,\n      'move': {\n        'scrollbars': true,\n      },\n    } as BlocklyOptions));\n    // Create vertical or horizontal flyout.\n    if (this.workspace.horizontalLayout) {\n      flyoutWorkspaceOptions.toolboxPosition =\n          this.workspace.toolboxPosition === toolbox.Position.TOP ?\n          toolbox.Position.BOTTOM :\n          toolbox.Position.TOP;\n      const HorizontalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_HORIZONTAL_TOOLBOX, this.workspace.options,\n          true);\n      this.flyout = new HorizontalFlyout!(flyoutWorkspaceOptions);\n    } else {\n      flyoutWorkspaceOptions.toolboxPosition =\n          this.workspace.toolboxPosition === toolbox.Position.RIGHT ?\n          toolbox.Position.LEFT :\n          toolbox.Position.RIGHT;\n      const VerticalFlyout = registry.getClassFromOptions(\n          registry.Type.FLYOUTS_VERTICAL_TOOLBOX, this.workspace.options, true);\n      this.flyout = new VerticalFlyout!(flyoutWorkspaceOptions);\n    }\n    this.workspace.addChangeListener(this.onDelete_.bind(this));\n  }\n\n  /**\n   * Create the trash can elements.\n   *\n   * @returns The trash can's SVG group.\n   */\n  createDom(): SVGElement {\n    /* Here's the markup that will be generated:\n        <g class=\"blocklyTrash\">\n          <clippath id=\"blocklyTrashBodyClipPath837493\">\n            <rect width=\"47\" height=\"45\" y=\"15\"></rect>\n          </clippath>\n          <image width=\"64\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashBodyClipPath837493)\"></image>\n          <clippath id=\"blocklyTrashLidClipPath837493\">\n            <rect width=\"47\" height=\"15\"></rect>\n          </clippath>\n          <image width=\"84\" height=\"92\" y=\"-32\" xlink:href=\"media/sprites.png\"\n              clip-path=\"url(#blocklyTrashLidClipPath837493)\"></image>\n        </g>\n        */\n    this.svgGroup_ = dom.createSvgElement(Svg.G, {'class': 'blocklyTrash'});\n    let clip;\n    const rnd = String(Math.random()).substring(2);\n    clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyTrashBodyClipPath' + rnd}, this.svgGroup_);\n    dom.createSvgElement(\n        Svg.RECT, {'width': WIDTH, 'height': BODY_HEIGHT, 'y': LID_HEIGHT},\n        clip);\n    const body = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'x': -SPRITE_LEFT,\n          'height': SPRITE.height,\n          'y': -SPRITE_TOP,\n          'clip-path': 'url(#blocklyTrashBodyClipPath' + rnd + ')',\n        },\n        this.svgGroup_);\n    body.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    clip = dom.createSvgElement(\n        Svg.CLIPPATH, {'id': 'blocklyTrashLidClipPath' + rnd}, this.svgGroup_);\n    dom.createSvgElement(\n        Svg.RECT, {'width': WIDTH, 'height': LID_HEIGHT}, clip);\n    this.svgLid_ = dom.createSvgElement(\n        Svg.IMAGE, {\n          'width': SPRITE.width,\n          'x': -SPRITE_LEFT,\n          'height': SPRITE.height,\n          'y': -SPRITE_TOP,\n          'clip-path': 'url(#blocklyTrashLidClipPath' + rnd + ')',\n        },\n        this.svgGroup_);\n    this.svgLid_.setAttributeNS(\n        dom.XLINK_NS, 'xlink:href',\n        this.workspace.options.pathToMedia + SPRITE.url);\n\n    // bindEventWithChecks_ quashes events too aggressively. See:\n    // https://groups.google.com/forum/#!topic/blockly/QF4yB9Wx00s\n    // Using bindEventWithChecks_ for blocking mousedown causes issue in mobile.\n    // See #4303\n    browserEvents.bind(\n        this.svgGroup_, 'pointerdown', this, this.blockMouseDownWhenOpenable_);\n    browserEvents.bind(this.svgGroup_, 'pointerup', this, this.click);\n    // Bind to body instead of this.svgGroup_ so that we don't get lid jitters\n    browserEvents.bind(body, 'pointerover', this, this.mouseOver_);\n    browserEvents.bind(body, 'pointerout', this, this.mouseOut_);\n    this.animateLid_();\n    return this.svgGroup_;\n  }\n\n  /** Initializes the trash can. */\n  init() {\n    if (this.workspace.options.maxTrashcanContents > 0) {\n      dom.insertAfter(\n          this.flyout!.createDom(Svg.SVG)!, this.workspace.getParentSvg());\n      this.flyout!.init(this.workspace);\n    }\n    this.workspace.getComponentManager().addComponent({\n      component: this,\n      weight: 1,\n      capabilities: [\n        ComponentManager.Capability.AUTOHIDEABLE,\n        ComponentManager.Capability.DELETE_AREA,\n        ComponentManager.Capability.DRAG_TARGET,\n        ComponentManager.Capability.POSITIONABLE,\n      ],\n    });\n    this.initialized_ = true;\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Dispose of this trash can.\n   * Unlink from all DOM elements to prevent memory leaks.\n   *\n   * @suppress {checkTypes}\n   */\n  dispose() {\n    this.workspace.getComponentManager().removeComponent('trashcan');\n    if (this.svgGroup_) {\n      dom.removeNode(this.svgGroup_);\n      this.svgGroup_ = null;\n    }\n    this.svgLid_ = null;\n    if (this.lidTask_) {\n      clearTimeout(this.lidTask_);\n    }\n  }\n\n  /**\n   * Whether the trashcan has contents.\n   *\n   * @returns True if the trashcan has contents.\n   */\n  private hasContents_(): boolean {\n    return !!this.contents_.length;\n  }\n\n  /**\n   * Returns true if the trashcan contents-flyout is currently open.\n   *\n   * @returns True if the trashcan contents-flyout is currently open.\n   */\n  contentsIsOpen(): boolean {\n    return !!this.flyout && this.flyout.isVisible();\n  }\n\n  /** Opens the trashcan flyout. */\n  openFlyout() {\n    if (this.contentsIsOpen()) {\n      return;\n    }\n    const contents = this.contents_.map(function(string) {\n      return JSON.parse(string);\n    });\n    // Trashcans with lots of blocks can take a second to render.\n    const blocklyStyle = this.workspace.getParentSvg().style;\n    blocklyStyle.cursor = 'wait';\n    setTimeout(() => {\n      this.flyout?.show(contents);\n      blocklyStyle.cursor = '';\n    }, 10);\n    this.fireUiEvent_(true);\n  }\n\n  /** Closes the trashcan flyout. */\n  closeFlyout() {\n    if (!this.contentsIsOpen()) {\n      return;\n    }\n    this.flyout?.hide();\n    this.fireUiEvent_(false);\n    this.workspace.recordDragTargets();\n  }\n\n  /**\n   * Hides the component. Called in WorkspaceSvg.hideChaff.\n   *\n   * @param onlyClosePopups Whether only popups should be closed.\n   *     Flyouts should not be closed if this is true.\n   */\n  autoHide(onlyClosePopups: boolean) {\n    // For now the trashcan flyout always autocloses because it overlays the\n    // trashcan UI (no trashcan to click to close it).\n    if (!onlyClosePopups && this.flyout) {\n      this.closeFlyout();\n    }\n  }\n\n  /**\n   * Empties the trashcan's contents. If the contents-flyout is currently open\n   * it will be closed.\n   */\n  emptyContents() {\n    if (!this.hasContents_()) {\n      return;\n    }\n    this.contents_.length = 0;\n    this.setMinOpenness_(0);\n    this.closeFlyout();\n  }\n\n  /**\n   * Positions the trashcan.\n   * It is positioned in the opposite corner to the corner the\n   * categories/toolbox starts at.\n   *\n   * @param metrics The workspace metrics.\n   * @param savedPositions List of rectangles that are already on the workspace.\n   */\n  position(metrics: UiMetrics, savedPositions: Rect[]) {\n    // Not yet initialized.\n    if (!this.initialized_) {\n      return;\n    }\n\n    const cornerPosition =\n        uiPosition.getCornerOppositeToolbox(this.workspace, metrics);\n\n    const height = BODY_HEIGHT + LID_HEIGHT;\n    const startRect = uiPosition.getStartPositionRect(\n        cornerPosition, new Size(WIDTH, height), MARGIN_HORIZONTAL,\n        MARGIN_VERTICAL, metrics, this.workspace);\n\n    const verticalPosition = cornerPosition.vertical;\n    const bumpDirection = verticalPosition === uiPosition.verticalPosition.TOP ?\n        uiPosition.bumpDirection.DOWN :\n        uiPosition.bumpDirection.UP;\n    const positionRect = uiPosition.bumpPositionRect(\n        startRect, MARGIN_VERTICAL, bumpDirection, savedPositions);\n\n    this.top_ = positionRect.top;\n    this.left_ = positionRect.left;\n    this.svgGroup_?.setAttribute(\n        'transform', 'translate(' + this.left_ + ',' + this.top_ + ')');\n  }\n\n  /**\n   * Returns the bounding rectangle of the UI element in pixel units relative to\n   * the Blockly injection div.\n   *\n   * @returns The UI elements's bounding box. Null if bounding box should be\n   *     ignored by other UI elements.\n   */\n  getBoundingRectangle(): Rect|null {\n    const bottom = this.top_ + BODY_HEIGHT + LID_HEIGHT;\n    const right = this.left_ + WIDTH;\n    return new Rect(this.top_, bottom, this.left_, right);\n  }\n\n  /**\n   * Returns the bounding rectangle of the drag target area in pixel units\n   * relative to viewport.\n   *\n   * @returns The component's bounding box. Null if drag target area should be\n   *     ignored.\n   */\n  override getClientRect(): Rect|null {\n    if (!this.svgGroup_) {\n      return null;\n    }\n\n    const trashRect = this.svgGroup_.getBoundingClientRect();\n    const top = trashRect.top + SPRITE_TOP - MARGIN_HOTSPOT;\n    const bottom = top + LID_HEIGHT + BODY_HEIGHT + 2 * MARGIN_HOTSPOT;\n    const left = trashRect.left + SPRITE_LEFT - MARGIN_HOTSPOT;\n    const right = left + WIDTH + 2 * MARGIN_HOTSPOT;\n    return new Rect(top, bottom, left, right);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble is dragged over this drag\n   * target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragOver(_dragElement: IDraggable) {\n    this.setLidOpen(this.wouldDelete_);\n  }\n\n  /**\n   * Handles when a cursor with a block or bubble exits this drag target.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDragExit(_dragElement: IDraggable) {\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handles when a block or bubble is dropped on this component.\n   * Should not handle delete here.\n   *\n   * @param _dragElement The block or bubble currently being dragged.\n   */\n  override onDrop(_dragElement: IDraggable) {\n    setTimeout(this.setLidOpen.bind(this, false), 100);\n  }\n\n  /**\n   * Flip the lid open or shut.\n   *\n   * @param state True if open.\n   * @internal\n   */\n  setLidOpen(state: boolean) {\n    if (this.isLidOpen === state) {\n      return;\n    }\n    if (this.lidTask_) {\n      clearTimeout(this.lidTask_);\n    }\n    this.isLidOpen = state;\n    this.animateLid_();\n  }\n\n  /** Rotate the lid open or closed by one step.  Then wait and recurse. */\n  private animateLid_() {\n    const frames = ANIMATION_FRAMES;\n\n    const delta = 1 / (frames + 1);\n    this.lidOpen_ += this.isLidOpen ? delta : -delta;\n    this.lidOpen_ = Math.min(Math.max(this.lidOpen_, this.minOpenness_), 1);\n\n    this.setLidAngle_(this.lidOpen_ * MAX_LID_ANGLE);\n\n    // Linear interpolation between min and max.\n    const opacity = OPACITY_MIN + this.lidOpen_ * (OPACITY_MAX - OPACITY_MIN);\n    if (this.svgGroup_) {\n      this.svgGroup_.style.opacity = `${opacity}`;\n    }\n\n    if (this.lidOpen_ > this.minOpenness_ && this.lidOpen_ < 1) {\n      this.lidTask_ =\n          setTimeout(this.animateLid_.bind(this), ANIMATION_LENGTH / frames);\n    }\n  }\n\n  /**\n   * Set the angle of the trashcan's lid.\n   *\n   * @param lidAngle The angle at which to set the lid.\n   */\n  private setLidAngle_(lidAngle: number) {\n    const openAtRight =\n        this.workspace.toolboxPosition === toolbox.Position.RIGHT ||\n        this.workspace.horizontalLayout && this.workspace.RTL;\n    this.svgLid_?.setAttribute(\n        'transform',\n        'rotate(' + (openAtRight ? -lidAngle : lidAngle) + ',' +\n            (openAtRight ? 4 : WIDTH - 4) + ',' + (LID_HEIGHT - 2) + ')');\n  }\n\n  /**\n   * Sets the minimum openness of the trashcan lid. If the lid is currently\n   * closed, this will update lid's position.\n   *\n   * @param newMin The new minimum openness of the lid. Should be between 0\n   *     and 1.\n   */\n  private setMinOpenness_(newMin: number) {\n    this.minOpenness_ = newMin;\n    if (!this.isLidOpen) {\n      this.setLidAngle_(newMin * MAX_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Flip the lid shut.\n   * Called externally after a drag.\n   */\n  closeLid() {\n    this.setLidOpen(false);\n  }\n\n  /** Inspect the contents of the trash. */\n  click() {\n    if (!this.hasContents_()) {\n      return;\n    }\n    this.openFlyout();\n  }\n\n  /**\n   * Fires a UI event for trashcan flyout open or close.\n   *\n   * @param trashcanOpen Whether the flyout is opening.\n   */\n  private fireUiEvent_(trashcanOpen: boolean) {\n    const uiEvent = new (eventUtils.get(eventUtils.TRASHCAN_OPEN))(\n        trashcanOpen, this.workspace.id);\n    eventUtils.fire(uiEvent);\n  }\n\n  /**\n   * Prevents a workspace scroll and click event if the trashcan has blocks.\n   *\n   * @param e A mouse down event.\n   */\n  private blockMouseDownWhenOpenable_(e: PointerEvent) {\n    if (!this.contentsIsOpen() && this.hasContents_()) {\n      // Don't start a workspace scroll.\n      e.stopPropagation();\n    }\n  }\n\n  /**\n   * Indicate that the trashcan can be clicked (by opening it) if it has blocks.\n   */\n  private mouseOver_() {\n    if (this.hasContents_()) {\n      this.setLidOpen(true);\n    }\n  }\n\n  /**\n   * Close the lid of the trashcan if it was open (Vis. it was indicating it had\n   *    blocks).\n   */\n  private mouseOut_() {\n    // No need to do a .hasBlocks check here because if it doesn't the trashcan\n    // won't be open in the first place, and setOpen won't run.\n    this.setLidOpen(false);\n  }\n\n  /**\n   * Handle a BLOCK_DELETE event. Adds deleted blocks oldXml to the content\n   * array.\n   *\n   * @param event Workspace event.\n   */\n  private onDelete_(event: Abstract) {\n    if (this.workspace.options.maxTrashcanContents <= 0 ||\n        event.type !== eventUtils.BLOCK_DELETE) {\n      return;\n    }\n    const deleteEvent = event as BlockDelete;\n    if (event.type === eventUtils.BLOCK_DELETE && !deleteEvent.wasShadow) {\n      if (!deleteEvent.oldJson) {\n        throw new Error('Encountered a delete event without proper oldJson');\n      }\n      const cleanedJson =\n          JSON.stringify(this.cleanBlockJson_(deleteEvent.oldJson));\n      if (this.contents_.indexOf(cleanedJson) !== -1) {\n        return;\n      }\n      this.contents_.unshift(cleanedJson);\n      while (this.contents_.length >\n             this.workspace.options.maxTrashcanContents) {\n        this.contents_.pop();\n      }\n\n      this.setMinOpenness_(HAS_BLOCKS_LID_ANGLE);\n    }\n  }\n\n  /**\n   * Converts JSON representing a block into text that can be stored in the\n   * content array.\n   *\n   * @param json A JSON representation of a block's state.\n   * @returns A BlockInfo object corresponding to the JSON, cleaned of all\n   *     unnecessary attributes.\n   */\n  private cleanBlockJson_(json: blocks.State): BlockInfo {\n    // Create a deep copy.\n    json = JSON.parse(JSON.stringify(json)) as blocks.State;\n\n    /**\n     * Reshape JSON into a nicer format.\n     *\n     * @param json The JSON to clean.\n     */\n    function cleanRec(json: blocks.State) {\n      if (!json) {\n        return;\n      }\n\n      delete json['id'];\n      delete json['x'];\n      delete json['y'];\n      delete json['enabled'];\n\n      if (json['icons'] && json['icons']['comment']) {\n        const comment = json['icons']['comment'];\n        delete comment['height'];\n        delete comment['width'];\n        delete comment['pinned'];\n      }\n\n      const inputs = json['inputs'];\n      for (const name in inputs) {\n        const input = inputs[name];\n        const block = input['block'];\n        const shadow = input['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n      if (json['next']) {\n        const next = json['next'];\n        const block = next['block'];\n        const shadow = next['shadow'];\n        if (block) {\n          cleanRec(block);\n        }\n        if (shadow) {\n          cleanRec(shadow);\n        }\n      }\n    }\n\n    cleanRec(json);\n\n    const blockInfo: BlockInfo = {\n      'kind': 'BLOCK',\n      ...json,\n    };\n    return blockInfo;\n  }\n}\n\n\n/** Width of both the trash can and lid images. */\nconst WIDTH = 47;\n\n/** Height of the trashcan image (minus lid). */\nconst BODY_HEIGHT = 44;\n\n/** Height of the lid image. */\nconst LID_HEIGHT = 16;\n\n/** Distance between trashcan and bottom or top edge of workspace. */\nconst MARGIN_VERTICAL = 20;\n\n/** Distance between trashcan and right or left edge of workspace. */\nconst MARGIN_HORIZONTAL = 20;\n\n/** Extent of hotspot on all sides beyond the size of the image. */\nconst MARGIN_HOTSPOT = 10;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_LEFT = 0;\n\n/** Location of trashcan in sprite image. */\nconst SPRITE_TOP = 32;\n\n/**\n * The openness of the lid when the trashcan contains blocks.\n *    (0.0 = closed, 1.0 = open)\n */\nconst HAS_BLOCKS_LID_ANGLE = 0.1;\n\n/** The length of the lid open/close animation in milliseconds. */\nconst ANIMATION_LENGTH = 80;\n\n/** The number of frames in the animation. */\nconst ANIMATION_FRAMES = 4;\n\n/** The minimum (resting) opacity of the trashcan and lid. */\nconst OPACITY_MIN = 0.4;\n\n/** The maximum (hovered) opacity of the trashcan and lid. */\nconst OPACITY_MAX = 0.8;\n\n/**\n * The maximum angle the trashcan lid can opens to. At the end of the open\n * animation the lid will be open to this angle.\n */\nconst MAX_LID_ANGLE = 45;\n", "/**\n * @license\n * Copyright 2022 Google LLC\n * SPDX-License-Identifier: Apache-2.0\n */\n\n/**\n * @fileoverview The entrypoint for blockly_compressed.js.  Provides\n *     various backwards-compatibility hacks.  Not used when loading\n *     in uncompiled (uncompressed) mode via bootstrap.js.\n */\n'use strict';\n\ngoog.module('Blockly.main');\n\nconst Blockly = goog.require('Blockly');\nconst ContextMenu = goog.require('Blockly.ContextMenu');\nconst Events = goog.require('Blockly.Events');\nconst Msg = goog.require('Blockly.Msg');\nconst Tooltip = goog.require('Blockly.Tooltip');\nconst WidgetDiv = goog.require('Blockly.WidgetDiv');\nconst colour = goog.require('Blockly.utils.colour');\nconst common = goog.require('Blockly.common');\nconst deprecation = goog.require('Blockly.utils.deprecation');\nconst dialog = goog.require('Blockly.dialog');\nconst eventUtils = goog.require('Blockly.Events.utils');\n\n/*\n * Aliased functions and properties that used to be on the Blockly namespace.\n * Everything in this section is deprecated. Both external and internal code\n * should avoid using these functions and use the designated replacements.\n * Everything in this section will be removed in a future version of Blockly.\n */\n\n// Add accessors for properties on Blockly that have now been deprecated.\nObject.defineProperties(Blockly, {\n  /**\n   * Wrapper to window.alert() that app developers may override to\n   * provide alternatives to the modal browser window.\n   * @name Blockly.alert\n   * @type {!function(string, function()=)}\n   * @deprecated Use Blockly.dialog.alert / .setAlert() instead.\n   *     (December 2021)\n   * @suppress {checkTypes}\n   */\n  alert: {\n    set: function(newAlert) {\n      deprecation.warn(\n          'Blockly.alert', 'version 9', 'version 10',\n          'Blockly.dialog.setAlert');\n      dialog.setAlert(newAlert);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.alert', 'version 9', 'version 10', 'Blockly.dialog.alert');\n      return dialog.alert;\n    },\n  },\n  /**\n   * Wrapper to window.confirm() that app developers may override to\n   * provide alternatives to the modal browser window.\n   * @name Blockly.confirm\n   * @type {!function(string, function()=)}\n   * @deprecated Use Blockly.dialog.confirm / .setConfirm() instead.\n   *     (December 2021)\n   * @suppress {checkTypes}\n   */\n  confirm: {\n    set: function(newConfirm) {\n      deprecation.warn(\n          'Blockly.confirm', 'version 9', 'version 10',\n          'Blockly.dialog.setConfirm');\n      dialog.setConfirm(newConfirm);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.confirm', 'version 9', 'version 10',\n          'Blockly.dialog.confirm');\n      return dialog.confirm;\n    },\n  },\n  /**\n   * The main workspace most recently used.\n   * Set by Blockly.WorkspaceSvg.prototype.markFocused\n   * @name Blockly.mainWorkspace\n   * @type {Workspace}\n   * @suppress {checkTypes}\n   */\n  mainWorkspace: {\n    set: function(x) {\n      deprecation.warn(\n          'Blockly.mainWorkspace', 'version 9', 'version 10',\n          'Blockly.getMainWorkspace');\n      common.setMainWorkspace(x);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.mainWorkspace', 'version 9', 'version 10',\n          'Blockly.getMainWorkspace');\n      return common.getMainWorkspace();\n    },\n  },\n  /**\n   * Wrapper to window.prompt() that app developers may override to\n   * provide alternatives to the modal browser window. Built-in\n   * browser prompts are often used for better text input experience\n   * on mobile device. We strongly recommend testing mobile when\n   * overriding this.\n   * @name Blockly.prompt\n   * @type {!function(string, string, function()=)}\n   * @deprecated Use Blockly.dialog.prompt / .setPrompt() instead.\n   *     (December 2021)\n   * @suppress {checkTypes}\n   */\n  prompt: {\n    set: function(newPrompt) {\n      deprecation.warn(\n          'Blockly.prompt', 'version 9', 'version 10',\n          'Blockly.dialog.setPrompt');\n      dialog.setPrompt(newPrompt);\n    },\n    get: function() {\n      deprecation.warn(\n          'Blockly.prompt', 'version 9', 'version 10', 'Blockly.dialog.prompt');\n      return dialog.prompt;\n    },\n  },\n  /**\n   * Currently selected block.\n   * @name Blockly.selected\n   * @type {?ICopyable}\n   * @suppress {checkTypes}\n   */\n  selected: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.selected', 'version 9', 'version 10', 'Blockly.getSelected');\n      return common.getSelected();\n    },\n    set: function(newSelection) {\n      deprecation.warn(\n          'Blockly.selected', 'version 9', 'version 10', 'Blockly.getSelected');\n      common.setSelected(newSelection);\n    },\n  },\n  /**\n   * The richness of block colours, regardless of the hue.\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\n   * @name Blockly.HSV_SATURATION\n   * @type {number}\n   * @suppress {checkTypes}\n   */\n  HSV_SATURATION: {\n    get: function() {\n      return colour.getHsvSaturation();\n    },\n    set: function(newValue) {\n      colour.setHsvSaturation(newValue);\n    },\n  },\n  /**\n   * The intensity of block colours, regardless of the hue.\n   * Must be in the range of 0 (inclusive) to 1 (exclusive).\n   * @name Blockly.HSV_VALUE\n   * @type {number}\n   * @suppress {checkTypes}\n   */\n  HSV_VALUE: {\n    get: function() {\n      return colour.getHsvValue();\n    },\n    set: function(newValue) {\n      colour.setHsvValue(newValue);\n    },\n  },\n});\n\n// Add accessors for properties on Blockly.ContextMenu that have now\n// been deprecated.\nObject.defineProperties(ContextMenu, {\n  /**\n   * Which block is the context menu attached to?\n   * @name Blockly.ContextMenu.currentBlock\n   * @type {Block}\n   * @deprecated Use Blockly.Tooltip.getCurrentBlock() /\n   *     .setCurrentBlock() instead.  (September 2021)\n   * @suppress {checkTypes}\n   */\n  currentBlock: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.ContextMenu.currentBlock', 'September 2021',\n          'September 2022', 'Blockly.Tooltip.getCurrentBlock()');\n      return ContextMenu.getCurrentBlock();\n    },\n    set: function(block) {\n      deprecation.warn(\n          'Blockly.ContextMenu.currentBlock', 'September 2021',\n          'September 2022', 'Blockly.Tooltip.setCurrentBlock(block)');\n      ContextMenu.setCurrentBlock(block);\n    },\n  },\n});\n\n// Add accessors for properties on Blockly.Events that have now been\n// deprecated.\nObject.defineProperties(Events, {\n  /**\n   * Sets whether the next event should be added to the undo stack.\n   * @name Blockly.Evenents.recordUndo\n   * @type {boolean}\n   * @deprecated Use Blockly.Events.getRecordUndo() and\n   *     .setRecordUndo().  (September 2021)\n   * @suppress {checkTypes}\n   */\n  recordUndo: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.Events.recordUndo', 'September 2021', 'September 2022',\n          'Blockly.Events.getRecordUndo()');\n      return eventUtils.getRecordUndo();\n    },\n    set: function(record) {\n      deprecation.warn(\n          'Blockly.Events.recordUndo', 'September 2021', 'September 2022',\n          'Blockly.Events.setRecordUndo()');\n      eventUtils.setRecordUndo(record);\n    },\n  },\n});\n\n\n// Add accessors for properties on Blockly.Tooltip that have now been\n// deprecated.\nObject.defineProperties(Tooltip, {\n  /**\n   * Is a tooltip currently showing?\n   * @name Blockly.Tooltip.visible\n   * @type {boolean}\n   * @deprecated Use Blockly.Tooltip.isVisible() instead.  (September\n   *     2021)\n   * @suppress {checkTypes}\n   */\n  visible: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.Tooltip.visible', 'September 2021', 'September 2022',\n          'Blockly.Tooltip.isVisible()');\n      return Tooltip.isVisible();\n    },\n  },\n  /**\n   * The HTML container.  Set once by createDom.\n   * @name Blockly.Tooltip.DIV\n   * @type {HTMLDivElement}\n   * @deprecated Use Blockly.Tooltip.getDiv() and .setDiv().\n   *     (September 2021)\n   * @suppress {checkTypes}\n   */\n  DIV: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.Tooltip.DIV', 'September 2021', 'September 2022',\n          'Blockly.Tooltip.getDiv()');\n      return Tooltip.getDiv();\n    },\n  },\n});\n\n// Add accessors for properties on Blockly.WidgetDiv that have now been\n// deprecated.\nObject.defineProperties(WidgetDiv, {\n  /**\n   * The HTML container for popup overlays (e.g. editor widgets).\n   * @name Blockly.WidgetDiv.DIV\n   * @type {?Element}\n   * @deprecated Use Blockly.WidgetDiv.getDiv() and .setDiv().\n   *     (September 2021)\n   * @suppress {checkTypes}\n   */\n  DIV: {\n    get: function() {\n      deprecation.warn(\n          'Blockly.WidgetDiv.DIV', 'September 2021', 'September 2022',\n          'Blockly.WidgetDiv.getDiv()');\n      return WidgetDiv.getDiv();\n    },\n  },\n});\n\n// If Blockly is compiled with ADVANCED_COMPILATION and/or loaded as a\n// CJS or ES module there will not be a Blockly global variable\n// created.  This can cause problems because a very common way of\n// loading translations is to use a <script> tag to load one of\n// the generated msg/*.js files, which consists of lines like:\n//\n// Blockly.Msg[\"ADD_COMMENT\"] = \"Add Comment\";\n// Blockly.Msg[\"CLEAN_UP\"] = \"Clean up Blocks\";\n//\n// This obviously only works if Blockly.Msg is the Msg export from the\n// Blockly.Msg module - so make sure it is, but only if there is not\n// yet a Blockly global variable.\nif (!('Blockly' in globalThis)) {\n  globalThis['Blockly'] = {'Msg': Msg};\n}\n"],
  "mappings": "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",
  "names": ["warn", "register", "validate", "unregister", "getItem", "hasItem", "getClass", "getObject", "getAllItems", "getClassFromOptions", "getWorkspaceById", "getAllWorkspaces", "registerWorkspace", "unregisterWorkpace", "getMainWorkspace", "setMainWorkspace", "getSelected", "setSelected", "getParentContainer", "setParentContainer", "svgResize", "getBlockTypeCounts", "jsonInitFactory", "defineBlocksWithJsonArray", "defineBlocksWithJsonArrayInternal", "getNextUniqueId", "genUid", "setRecordUndo", "getRecordUndo", "fire", "fireInternal", "fireNow", "filter", "clearPendingUndo", "disable", "enable", "isEnabled", "getGroup", "setGroup", "setGroupInternal", "getDescendantIds", "fromJson", "eventClassHasStaticFromJson", "get", "disableOrphans", "injectDependencies", "getDocument", "setDocument", "createTextNode", "textToDom", "textToDomDocument", "domToText", "createSvgElement", "addClass", "removeClasses", "removeClass", "hasClass", "removeNode", "insertAfter", "containsNode", "setCssTransform", "startTextWidthCache", "stopTextWidthCache", "getTextWidth", "getFastTextWidth", "getFastTextWidthWithSizeString", "measureFontMetrics", "alert", "setAlert", "confirm", "confirmInternal", "setConfirm", "prompt", "setPrompt", "isVariableBackedParameterModel", "isLegacyProcedureDefBlock", "isLegacyProcedureCallBlock", "allUsedVarModels", "allDeveloperVariables", "flyoutCategory", "flyoutCategoryBlocks", "generateUniqueName", "generateUniqueNameInternal", "generateUniqueNameFromOptions", "createVariableButtonHandler", "renameVariable", "promptName", "nameUsedWithOtherType", "nameUsedWithAnyType", "nameUsedWithConflictingParam", "checkForConflictingParamWithProcedureModels", "checkForConflictingParamWithLegacyProcedures", "generateVariableFieldDom", "getOrCreateVariablePackage", "getVariable", "createVariable", "getAddedVariables", "longStart", "longStop", "clearTouchIdentifier", "shouldHandleEvent", "getTouchIdentifierFromEvent", "checkTouchIdentifier", "setClientFromTouch", "isMouseOrTouchEvent", "isTouchEvent", "splitEventByTouches", "conditionalBind", "bind", "unbind", "isTargetInput", "isRightButton", "mouseToSvg", "getScrollDeltaPixels", "inject", "getSize", "getSizeInternal", "getSizeWithDisplay", "getComputedStyle", "getCascadedStyle", "getPageOffset", "getViewportPageOffset", "getBorderBox", "scrollIntoContainerView", "getContainerOffsetToScrollInto", "getRelativeXY", "getInjectionDivXY", "is3dSupported", "getViewportBBox", "getDocumentScroll", "screenToWsCoordinates", "workspaceToDom", "variablesToDom", "blockToDomWithXY", "fieldToDom", "allFieldsToDom", "blockToDom", "cloneShadow", "domToPrettyText", "clearWorkspaceAndLoadFromXml", "domToWorkspace", "appendDomToWorkspace", "domToBlock", "domToVariables", "mapSupportedXmlTags", "applyMutationTagNodes", "applyCommentTagNodes", "applyDataTagNodes", "applyFieldTagNodes", "findChildBlocks", "applyInputTagNodes", "applyNextTagNodes", "domToBlockHeadless", "domToField", "deleteNext", "isElement", "save", "saveAttributes", "saveCoords", "saveExtraState", "saveIcons", "saveFields", "saveInputBlocks", "saveNextBlocks", "saveConnection", "append", "appendInternal", "appendPrivate", "loadCoords", "loadAttributes", "loadExtraState", "tryToConnectParent", "loadIcons", "loadFields", "loadInputBlocks", "loadNextBlocks", "loadConnection", "initBlock", "connectReciprocally", "getSingleConnection", "getConnectionForOrphanedOutput", "toRadians", "toDegrees", "clamp", "createDom", "setBoundsElement", "getOwner", "getContentDiv", "clearContent", "setColour", "showPositionedByBlock", "showPositionedByField", "getScaledBboxOfBlock", "getScaledBboxOfField", "showPositionedByRect", "show", "getPositionBelowMetrics", "getPositionAboveMetrics", "getPositionTopOfPageMetrics", "getPositionX", "isVisible", "hideIfOwner", "hide", "hideWithoutAnimation", "positionInternal", "repositionForWindowResize", "startsWith", "shortestStringLength", "commonWordPrefix", "commonWordSuffix", "wrap", "wrapLine", "wrapScore", "wrapMutate", "wrapToText", "isNumber", "setCustomTooltip", "getCustomTooltip", "getDiv", "getTooltipOfObject", "getTargetObject", "bindMouseEvents", "unbindMouseEvents", "onMouseOver", "onMouseOut", "onMouseMove", "dispose", "block", "unblock", "renderContent", "renderDefaultContent", "getPosition", "getHsvSaturation", "setHsvSaturation", "getHsvValue", "setHsvValue", "parse", "rgbToHex", "hexToRgb", "hsvToHex", "blend", "hueToHex", "tokenizeInterpolationInternal", "tokenizeInterpolation", "replaceMessageReferences", "checkMessageReferences", "parseBlockColour", "testOnly_setDiv", "positionWithAnchor", "calculateX", "calculateY", "fromJsonInternal", "setRole", "setState", "trimOptions", "applyTrim", "validateOptions", "inherits", "mixin", "deepMerge", "values", "convertToolboxDefToJson", "validateToolbox", "convertFlyoutDefToJsonArray", "hasCategories", "hasCategoriesInternal", "isCategoryCollapsible", "convertToToolboxJson", "xmlToJsonArray", "addAttributes", "parseToolboxTree", "registerMixin", "isRegistered", "apply", "checkNoMutatorProperties", "checkXmlHooks", "checkJsonHooks", "checkMutatorDialog", "checkHasFunctionPair", "checkHasMutatorProperties", "getMutatorProperties", "mutatorPropertiesMatch", "runAfterPageLoad", "checkDropdownOptionsInTable", "extensionParentTooltip", "removeElem", "disposeUiEffect", "disposeUiStep", "connectionUiEffect", "connectionUiStep", "disconnectUiEffect", "disconnectUiStep", "disconnectUiStop", "bumpObjectIntoBounds", "bumpIntoBoundsHandler", "extractObjectFromEvent", "bumpTopObjectsIntoBounds", "initIconData", "copy", "copyInternal", "paste", "duplicate", "duplicateInternal", "getCurrentBlock", "setCurrentBlock", "populate_", "position_", "createWidget_", "haltPropagation", "callbackFactory", "commentDeleteOption", "commentDuplicateOption", "workspaceCommentOption", "getParentConnection", "point", "curve", "moveTo", "moveBy", "lineTo", "line", "lineOnAxis", "arc", "queueRender", "queueBlock", "doRenders", "renderBlock", "updateConnectionLocations", "updateIconLocations", "registerUndo", "registerRedo", "registerCleanup", "toggleOption_", "registerCollapse", "registerExpand", "addDeletableBlocks_", "getDeletableBlocks_", "deleteNext_", "registerDeleteAll", "registerWorkspaceOptions_", "registerDuplicate", "registerComment", "registerInline", "registerCollapseExpandBlock", "registerDisable", "registerDelete", "registerHelp", "registerBlockOptions_", "registerDefaultOptions", "isProcedureBlock", "isObservable", "allProcedures", "procTupleComparator", "findLegalName", "isLegalName", "isNameUsed", "rename", "updateMutatorFlyout", "mutatorOpenListener", "mutatorChangeListener", "getCallers", "blockIsModernCallerFor", "mutateCallers", "getDefinition", "isDynamicShape", "isDebuggerEnabled", "startDebugger", "stopDebugger", "init", "stringButtonClickHandler", "numberButtonClickHandler", "colourButtonClickHandler", "getStartPositionRect", "getCornerOppositeToolbox", "bumpPositionRect", "resizeSvgContents", "createMainWorkspace", "onKeyDown", "bindDocumentEvents", "loadSounds", "saveProcedure", "saveParameter", "loadProcedure", "loadParameter", "load", "registerEscape", "registerCopy", "registerCut", "registerPaste", "registerDefaultShortcuts", "isSelectableToolboxItem", "arrayRemove", "hideChaff", "resizeSvgContentsLocal", "bindEvent_", "unbindEvent_", "bindEventWithChecks_", "name", "deprecationDate", "deletionDate", "opt_use", "msg", "console", "type", "registryItem", "opt_allowOverrides", "Type", "trim", "Error", "toLowerCase", "caselessName", "typeRegistry", "typeMap", "nameRegistry", "nameMap", "Object", "create", "String", "FIELD", "opt_throwIfMissing", "opt_cased", "casedRegistry", "key", "keys", "options", "plugin", "plugins", "DEFAULT", "id", "WorkspaceDB_", "workspaces", "workspaceId", "push", "workspace", "mainWorkspace", "selected", "newSelection", "parentContainer", "newParent", "parentWorkspace", "svg", "getParentSvg", "cachedSize", "getCachedParentSvgSize", "div", "parentElement", "HTMLElement", "width", "offsetWidth", "height", "offsetHeight", "setAttribute", "setCachedParentSvgSize", "resize", "opt_stripFollowing", "typeCountsMap", "descendants", "getDescendants", "nextBlock", "getNextBlock", "index", "indexOf", "splice", "length", "i", "checkBlock", "jsonDef", "jsonInit", "jsonArray", "TEST_ONLY", "defineBlocks", "createBlockDefinitionsFromJsonArray", "blocks", "elem", "definition", "Blocks", "nextId", "toString", "internal", "newValue", "recordUndo", "event", "FIRE_QUEUE", "requestAnimationFrame", "setTimeout", "e", "queue", "eventWorkspace", "fireChangeListener", "queueIn", "forward", "slice", "reverse", "mergedQueue", "hash", "isNull", "isUiEvent", "UI", "blockId", "join", "lastEntry", "lastEvent", "MOVE", "moveEvent", "newParentId", "newInputName", "newCoordinate", "CHANGE", "element", "VIEWPORT_CHANGE", "viewportEvent", "viewTop", "viewLeft", "scale", "oldScale", "CLICK", "BUBBLE_OPEN", "unshift", "disabled", "group", "state", "ids", "descendant", "json", "eventClass", "getOwnPropertyDescriptors", "eventType", "EVENT", "CREATE", "getBlockById", "initialUndoFlag", "parent", "getParent", "children", "child", "setEnabled", "outputConnection", "previousConnection", "isDragging", "dependencies", "document", "DOMParser", "XMLSerializer", "xmlDocument", "createElement", "tagName", "createElementNS", "NAME_SPACE", "text", "doc", "documentElement", "getElementsByTagName", "oParser", "parseFromString", "dom", "oSerializer", "serializeToString", "attrs", "opt_parent", "SVG_NS", "appendChild", "className", "classNames", "split", "every", "classList", "contains", "add", "remove", "node", "parentNode", "removeChild", "newNode", "refNode", "siblingNode", "nextSibling", "insertBefore", "compareDocumentPosition", "NodeType", "DOCUMENT_POSITION_CONTAINED_BY", "transform", "style", "cacheReference", "cacheWidths", "textElement", "textContent", "baseVal", "getComputedTextLength", "fontSize", "fontWeight", "fontFamily", "canvasContext", "computeCanvas", "body", "getContext", "font", "measureText", "span", "result", "baseline", "alignItems", "offsetTop", "message", "opt_callback", "alertImplementation", "alertFunction", "callback", "confirmImplementation", "confirmFunction", "defaultValue", "promptImplementation", "promptFunction", "param", "undefined", "getVariableModel", "getProcedureDef", "getProcedureCall", "renameProcedure", "ws", "getAllBlocks", "variables", "Set", "blockVariables", "getVarModels", "j", "variable", "getId", "Array", "from", "getDeveloperVariables", "devVars", "xmlList", "button", "registerButtonCallback", "getTargetWorkspace", "blockList", "concat", "variableModelList", "getVariablesOfType", "mostRecentVariable", "value", "sort", "VariableModel", "compareByName", "VAR_LETTER_OPTIONS", "charAt", "getAllVariableNames", "startChar", "usedNames", "letters", "suffix", "letterIndex", "inUse", "potName", "Number", "opt_type", "promptAndCheckWithAlert", "defaultName", "Msg", "existing", "replace", "promptText", "newName", "procedure", "renameVariableById", "defaultText", "newVar", "allVariables", "getVariableMap", "getAllVariables", "oldName", "getProcedureMap", "getProcedures", "procedures", "params", "getParameters", "map", "procHasOld", "some", "procHasNew", "getName", "def", "blockHasOld", "blockHasNew", "variableModel", "field", "opt_name", "potentialVariableMap", "getPotentialVariableMap", "getVariableById", "isFlyout", "targetWorkspace", "originalVariables", "allCurrentVariables", "addedVariables", "gesture", "longPid_", "handleRightClick", "LONGPRESS", "clearTimeout", "touchIdentifier_", "PointerEvent", "pointerId", "identifier", "changedTouches", "touchPoint", "clientX", "clientY", "events", "newEvent", "target", "stopPropagation", "preventDefault", "thisObject", "func", "opt_noCaptureIdentifier", "opt_noPreventDefault", "wrapFunc", "call", "bindData", "TOUCH_MAP", "addEventListener", "pop", "removeEventListener", "isContentEditable", "getAttribute", "HTMLInputElement", "HTMLTextAreaElement", "ctrlKey", "MAC", "matrix", "svgPoint", "createSVGPoint", "x", "y", "getScreenCTM", "inverse", "matrixTransform", "deltaMode", "deltaX", "deltaY", "LINE_MODE_MULTIPLIER", "PAGE_MODE_MULTIPLIER", "cssContent", "injected", "content", "hasCss", "pathToMedia", "mediaPath", "cssNode", "cssTextNode", "head", "firstChild", "originalDisplay", "display", "originalVisibility", "visibility", "originalPosition", "position", "Size", "property", "styles", "window", "getPropertyValue", "currentStyle", "el", "pos", "Coordinate", "box", "getBoundingClientRect", "scrollCoord", "pageXOffset", "scrollLeft", "pageYOffset", "scrollTop", "left", "top", "parseFloat", "right", "bottom", "Rect", "container", "opt_center", "offset", "elementPos", "containerPos", "containerBorder", "relX", "relY", "elementSize", "spaceX", "clientWidth", "spaceY", "clientHeight", "Math", "min", "max", "xy", "parseInt", "r", "match", "XY_REGEX", "styleComponents", "XY_STYLE_REGEX", "scrollOffset", "win", "screenCoordinates", "screenX", "screenY", "boundingRect", "getInjectionDiv", "injectionDiv", "clientOffsetPixels", "mainOffsetPixels", "getOriginOffsetInPixels", "difference", "finalOffsetPixels", "finalOffsetMainWs", "opt_noId", "treeXml", "variablesElement", "hasChildNodes", "comments", "getTopComments", "comment", "toXmlWithXY", "getTopBlocks", "variableList", "isInsertionMarker", "getChildren", "DocumentFragment", "RTL", "getWidth", "getRelativeToSurfaceXY", "round", "isSerializable", "toXml", "inputList", "input", "fieldRow", "fieldDom", "isShadow", "mutationToDom", "mutation", "hasAttributes", "commentText", "getCommentText", "size", "commentModel", "pinned", "commentElement", "data", "dataElement", "empty", "inputTypes", "DUMMY", "childBlock", "connection", "targetBlock", "VALUE", "STATEMENT", "childShadow", "getShadowDom", "childElem", "nodeType", "ELEMENT_NODE", "inputsInline", "inputsInlineDefault", "isCollapsed", "isDeletable", "isMovable", "isEditable", "nextElem", "nextShadow", "nextConnection", "shadow", "cloneNode", "textNode", "nodeName", "removeAttribute", "TEXT_NODE", "lines", "blob", "indent", "substring", "xml", "setResizesEnabled", "clear", "blockIds", "newBlockIds", "existingGroup", "variablesFirst", "xmlChild", "childNodes", "xmlChildElement", "blockX", "blockY", "isNaN", "TypeError", "rendered", "WorkspaceCommentSvg", "fromXmlRendered", "WorkspaceComment", "fromXml", "FINISHED_LOADING", "getBlocksBoundingBox", "bbox", "farY", "topX", "newLeftX", "Infinity", "newRightX", "newY", "blockXY", "offsetY", "ySeparation", "offsetX", "xmlBlock", "variablesBeforeCreation", "topBlock", "topBlockSvg", "setConnectionTracking", "initSvg", "render", "disposed", "updateDisabled", "resizeContents", "initModel", "newVariables", "thisVariable", "VAR_CREATE", "xmlVariables", "childNodeMap", "next", "xmlChildren", "shouldCallInitSvg", "domToMutation", "setCommentText", "getCommentIcon", "isInFlyout", "blockSvg", "setVisible", "xmlNode", "childBlockElement", "childShadowElement", "prototypeName", "getInput", "childBlockInfo", "setShadowDom", "isConnected", "parentConnection", "connectedToParentNext", "outerHTML", "newBlock", "xmlChildNameMap", "connect", "inline", "setInputsInline", "deletable", "setDeletable", "movable", "setMovable", "editable", "setEditable", "collapsed", "setCollapsed", "setShadow", "fieldName", "getField", "serializer", "SERIALIZER", "addCoordinates", "addInputBlocks", "addNextBlocks", "doFullSerialization", "isOwnDeletable", "isOwnMovable", "isOwnEditable", "extraState", "fields", "saveState", "inputs", "connectionState", "getShadowState", "prevRecordUndo", "BLOCK_CREATE", "MissingBlockType", "getSourceBlock", "RealChildOfShadow", "childConnection", "MissingConnection", "connected", "checker", "connectionChecker", "BadConnectionCheck", "getErrorMessage", "canConnectWithReason", "fieldState", "loadState", "inputName", "setShadowState", "icons", "getIcons", "computeIconLocation", "first", "second", "targetConnection", "orphanBlock", "foundConnection", "output", "typeChecker", "getConnectionChecker", "canConnect", "startBlock", "angleDegrees", "PI", "angleRadians", "lowerBound", "number", "upperBound", "temp", "arrow", "opacity", "transition", "ANIMATION_TIME", "boundsElem", "boundsElement", "owner", "backgroundColour", "borderColour", "backgroundColor", "borderColor", "opt_onHide", "opt_secondaryYOffset", "positionToField", "getSvgRoot", "scaledHeight", "scaledWidth", "bBox", "getScaledBBox", "primaryX", "primaryY", "secondaryY", "sourceBlock", "newOwner", "rtl", "secondaryX", "onHide", "direction", "renderedClassName", "getRenderer", "getClassName", "themeClassName", "getTheme", "boundsInfo", "divSize", "xCoords", "initialX", "divX", "initialY", "finalX", "finalY", "PADDING_Y", "arrowX", "arrowY", "ARROW_SIZE", "BORDER_SIZE", "arrowAtTop", "arrowVisible", "sourceX", "boundsLeft", "boundsRight", "divWidth", "relativeArrowX", "horizPadding", "ARROW_HORIZONTAL_PADDING", "divOwner", "opt_withoutAnimation", "animateOutTimer", "markFocused", "metrics", "getPositionMetrics", "floor", "str", "prefix", "array", "reduce", "a", "b", "opt_shortest", "wordPrefix", "len", "letter", "substr", "limit", "words", "score", "lastText", "lineCount", "lastScore", "wordBreaks", "steps", "insertedBreaks", "lineLengths", "linePunctuation", "maxLength", "pow", "abs", "bestScore", "bestBreaks", "mutatedWordBreaks", "mutatedScore", "test", "customFn", "customTooltip", "visible", "containerDiv", "object", "obj", "tooltip", "mouseOverWrapper_", "mouseOutWrapper_", "blocked", "newElement", "currentTarget", "poisonedElement", "mouseOutPid", "_e", "showPid", "dx", "lastX", "pageX", "dy", "lastY", "pageY", "sqrt", "RADIUS_OK", "HOVER_MS", "tip", "LIMIT", "windowWidth", "windowHeight", "anchorX", "OFFSET_X", "anchorY", "OFFSET_Y", "scrollY", "MARGINS", "scrollX", "hsvSaturation", "newSaturation", "hsvValue", "hex", "names", "rgb", "g", "colour", "h", "s", "v", "red", "green", "blue", "sextant", "remainder", "val1", "val2", "val3", "colour1", "colour2", "factor", "hex1", "hex2", "rgb1", "rgb2", "hue", "parseInterpolationTokens", "tokens", "chars", "buffer", "c", "rawKey", "keyUpper", "toUpperCase", "bklyKey", "rawValue", "prototype", "mergedTokens", "interpolatedResult", "validSoFar", "msgTable", "m", "msgKey", "dereferenced", "errorMsg", "newDiv", "newDispose", "rendererClassName", "oldOwner", "viewportBBox", "anchorBBox", "widgetSize", "fieldClass", "fieldObject", "roleName", "ROLE_ATTRIBUTE", "stateName", "isArray", "ARIA_PREFIX", "hasImages", "trimmedOptions", "label", "alt", "stringLabels", "shortest", "prefixLength", "suffixLength", "foundError", "tuple", "error", "src", "childCtor", "parentCtor", "superClass_", "setPrototypeOf", "constructor", "source", "toolboxDef", "Element", "toolboxJson", "toolboxKind", "toolboxContents", "FLYOUT_TOOLBOX_KIND", "CATEGORY_TOOLBOX_KIND", "flyoutDef", "item", "categories", "categoryInfo", "contents", "Node", "arr", "attributes", "attr", "parsedToolboxDef", "initFn", "allExtensions", "mixinObj", "registerMutator", "opt_helperFn", "opt_blockList", "errorPrefix", "hasMutatorDialog", "setMutator", "Mutator", "isMutator", "extensionFn", "mutatorProperties", "mutationName", "properties", "compose", "decompose", "func1", "func2", "hasXmlHooks", "hasJsonHooks", "oldProperties", "newProperties", "fn", "readyState", "readyStateCheckInterval", "setInterval", "clearInterval", "buildTooltipForDropdown", "dropdownName", "lookupTable", "blockTypesChecked", "setTooltip", "getFieldValue", "warning", "dropdown", "FieldDropdown", "isOptionListDynamic", "getOptions", "optionKey", "buildTooltipWithFieldText", "msgTemplate", "getText", "tooltipWhenNotConnected", "getInputsInline", "svgGroup", "getAudioManager", "play", "getSvgXY", "clone", "cloneRect", "Date", "rect", "start", "workspaceScale", "percent", "getTime", "ripple", "Svg", "CIRCLE", "disconnectPid", "getHeightWidth", "magnitude", "atan", "DISPLACEMENT", "wobblingBlock", "DURATION", "skew", "sin", "WIGGLES", "val", "getTranslation", "scrollMetrics", "objectMetrics", "getBoundingRectangle", "newYPosition", "leftClamp", "rightClamp", "newXPosition", "metricsManager", "getMetricsManager", "hasFixedEdges", "BUMP_EVENTS", "scrollMetricsInWsCoords", "getScrollMetrics", "wasBumped", "BLOCK_MOVE", "getRootBlock", "COMMENT_CREATE", "COMMENT_MOVE", "getCommentById", "commentId", "topBlocks", "getTopBoundedElements", "dragIconData", "location", "getIconLocation", "icon", "toCopy", "copyData", "toCopyData", "typeCounts", "isCapacityAvailable", "saveInfo", "toDuplicate", "oldCopyData", "pastedThing", "currentBlock", "dummyOwner", "menu", "menu_", "focus", "Menu", "Role", "MENU", "option", "menuItem", "MenuItem", "setRightToLeft", "MENUITEM", "addChild", "enabled", "onAction", "actionHandler", "scope", "menuSize", "menuDom", "config", "snapRadius", "select", "deleteOption", "duplicateOption", "wsCommentOption", "wsCommentOption.callback", "DEFAULT_SIZE", "finalOffset", "topConnection", "command", "points", "flags", "radius", "pid", "dirtyBlocks", "rootBlocks", "isDisposed", "has", "renderEfficiently", "blockOrigin", "conn", "getConnections_", "moved", "moveToOffset", "isSuperior", "sum", "relativeCoords", "ContextMenuRegistry", "registry", "undoOption", "displayText", "preconditionFn", "getUndoStack", "undo", "scopeType", "ScopeType", "WORKSPACE", "weight", "redoOption", "getRedoStack", "cleanOption", "cleanUp", "shouldCollapse", "timeoutFn", "timeoutCounter", "ms", "DELAY", "collapseOption", "collapse", "expandOption", "deleteList", "eventGroup", "shift", "isDeadOrDying", "deletableBlocksLength", "cancelCurrentGesture", "deletableBlocks", "ok", "isDuplicatable", "BLOCK", "commentOption", "inlineOption", "collapseExpandOption", "disableOption", "getInheritedDisabled", "descendantCount", "checkAndDelete", "helpOption", "helpUrl", "showHelp", "getProcedureModel", "doProcedureUpdate", "isProcedureDef", "startPublishing", "stopPublishing", "root", "proceduresNoReturn", "p", "getReturnTypes", "pa", "getBlocksByType", "forEach", "proceduresReturn", "ta", "tb", "localeCompare", "sensitivity", "opt_exclude", "Names", "equals", "excludeModel", "model", "UnattachedFieldError", "legalName", "setName", "getValue", "procedureBlock", "populateProcedures", "procedureList", "templateName", "args", "arg", "nameField", "xmlElement", "argBlock", "argValue", "DEFAULT_ARG", "fieldContent", "updateToolbox", "bubbleType", "isOpen", "mutator", "getWorkspace", "addChangeListener", "BLOCK_DELETE", "BLOCK_CHANGE", "procName", "defBlock", "oldRecordUndo", "callers", "caller", "oldMutation", "oldMutationDom", "newMutationDom", "newMutation", "shape", "isDynamic", "useDebugger", "rendererClass", "RENDERER", "theme", "opt_rendererOverrides", "renderer", "firstVariable", "horizontalPadding", "verticalPadding", "hasVerticalScrollbar", "scrollbar", "canScrollVertically", "horizontal", "horizontalPosition", "LEFT", "absoluteMetrics", "Scrollbar", "scrollbarThickness", "viewMetrics", "vertical", "verticalPosition", "TOP", "canScrollHorizontally", "toolboxMetrics", "Position", "horizontalLayout", "RIGHT", "BOTTOM", "startRect", "margin", "bumpDir", "savedPositions", "otherEl", "intersects", "bumpDirection", "UP", "opt_options", "getElementById", "querySelector", "Options", "subContainer", "tabIndex", "State", "LABEL", "blockDragSurface", "BlockDragSurfaceSvg", "workspaceDragSurface", "WorkspaceDragSurfaceSvg", "SVG", "HTML_NS", "XLINK_NS", "defs", "DEFS", "rnd", "random", "gridPattern", "Grid", "gridOptions", "WorkspaceSvg", "wsOptions", "zoomOptions", "startScale", "languageTree", "flyout", "addFlyout", "hasTrashcan", "addTrashcan", "controls", "addZoomControls", "getThemeManager", "subscribe", "translate", "workspaceResizeHandler", "setResizeHandlerWrapper", "toolbox", "getToolbox", "getFlyout", "scrollToStart", "trashcan", "zoomControls_", "moveOptions", "scrollbars", "ScrollbarPair", "setMetrics", "hasSounds", "ShortcutRegistry", "documentEventsBound", "updateInverseScreenCTM", "IPAD", "unbindSounds", "soundBinds", "audioMgr", "preload", "proc", "returnTypes", "parameters", "getTypes", "types", "procedureModelClass", "parameterModelClass", "setReturnTypes", "entries", "insertParameter", "setTypes", "serializerMap", "deserializers", "priority", "deserializer", "pluginState", "escapeAction", "ESCAPE", "readOnly", "keyCodes", "KeyCodes", "ESC", "deleteShortcut", "DELETE", "Gesture", "inProgress", "BACKSPACE", "ctrlC", "createSerializedKey", "C", "CTRL", "altC", "ALT", "metaC", "META", "copyShortcut", "COPY", "ctrlX", "X", "altX", "metaX", "cutShortcut", "CUT", "BlockSvg", "ctrlV", "V", "altV", "metaV", "pasteShortcut", "PASTE", "ctrlZ", "Z", "altZ", "metaZ", "undoShortcut", "UNDO", "ctrlShiftZ", "SHIFT", "altShiftZ", "metaShiftZ", "ctrlY", "Y", "redoShortcut", "REDO", "toolboxItem", "isSelectable", "opt_onlyClosePopups", "realResizeSvgContents", "_opt_noPreventDefault", "COMPILED", "goog", "global", "globalThis", "define", "goog.define", "DEBUG", "DISALLOW_TEST_ONLY_CODE", "provide", "goog.provide", "module", "goog.module", "goog.module.get", "declareLegacyNamespace", "goog.module.declareLegacyNamespace", "setTestOnly", "goog.setTestOnly", "opt_message", "require", "goog.require", "namespace", "requireType", "goog.requireType", "declareModuleId", "$jscomp$tmp$exports$module$name", "CONNECTION_CHECKER", "CURSOR", "TOOLBOX", "THEME", "TOOLBOX_ITEM", "FLYOUTS_VERTICAL_TOOLBOX", "FLYOUTS_HORIZONTAL_TOOLBOX", "METRICS_MANAGER", "BLOCK_DRAGGER", "draggingConnections", "soup", "soupLength", "VAR_DELETE", "VAR_RENAME", "BLOCK_DRAG", "SELECTED", "MARKER_MOVE", "TRASHCAN_OPEN", "TOOLBOX_ITEM_SELECT", "THEME_CHANGE", "COMMENT_DELETE", "COMMENT_CHANGE", "COMMENT_NODE", "setLocale", "locale", "k", "Abstract", "toJson", "isBlank", "run", "_forward", "getEventWorkspace_", "VarBase", "AbstractEvent", "opt_variable", "varId", "VarCreate", "varType", "varName", "deleteVariableById", "opt_id", "id_", "var1", "var2", "CATEGORY_NAME", "tx", "ty", "distance", "editable_", "movable_", "deletable_", "disposed_", "isComment", "addTopComment", "xy_", "height_", "width_", "content_", "fireCreateEvent", "removeTopComment", "getHeight", "setHeight", "setWidth", "recordNew", "getContent", "setContent", "xmlComment", "info", "parseAttributes", "w", "xmlX", "xmlY", "commentX", "NaN", "commentY", "xmlH", "xmlW", "xmlId", "UiBase", "opt_workspaceId", "Selected", "opt_oldElementId", "opt_newElementId", "oldElementId", "newElementId", "TOUCH_ENABLED", "rawUserAgent", "isJavaFx", "isWebKit", "isGecko", "isAndroid", "isIPad", "isIPhone", "isMac", "isTablet", "isMobile", "raw", "rawUpper", "maxTouchPoints", "JavaFx", "GECKO", "ANDROID", "IPHONE", "MOBILE", "other", "ANIMATE", "CLIPPATH", "FECOMPOSITE", "FECOMPONENTTRANSFER", "FEFLOOD", "FEFUNCA", "FEGAUSSIANBLUR", "FEPOINTLIGHT", "FESPECULARLIGHTING", "FILTER", "FOREIGNOBJECT", "G", "IMAGE", "LINE", "PATH", "PATTERN", "POLYGON", "RECT", "TEXT", "TSPAN", "RESIZE_SIZE", "BORDER_RADIUS", "TEXTAREA_OFFSET", "onMouseMoveWrapper_", "onMouseUpWrapper_", "eventsInit_", "deleteIconBorder_", "deleteGroup_", "resizeGroup_", "foreignObject_", "svgHandleTarget_", "svgRectTarget_", "textarea_", "rendered_", "autoLayout_", "focused_", "svgGroup_", "svgRect_", "useDragSurface_", "getBlockDragSurface", "unselect", "disposeInternal_", "opt_noSelect", "pathMouseDown_", "updateMovable", "getBubbleCanvas", "getGesture", "handleBubbleStart", "showContextMenu", "oldId", "addSelect", "removeSelect", "blurFocus", "setFocus", "addFocus", "removeFocus", "dragSurfaceGroup", "surfaceTranslation", "getSurfaceTranslation", "moveToDragSurface", "clearTransformAttributes_", "translateSurface", "setBlocksAndShow", "moveDuringDrag", "dragSurface", "newLoc", "translation", "commentBounds", "setDragging", "adding", "setDeleteStyle", "setAutoLayout", "_enable", "foreignObject", "createEditor_", "addResizeDom_", "addDeleteDom_", "setSize_", "resizeMouseDown_", "deleteMouseDown_", "deleteMouseOut_", "deleteMouseUp_", "TOP_OFFSET", "textarea", "unbindDragEvents_", "startDrag", "resizeMouseUp_", "resizeMouseMove_", "newXY", "moveDrag", "resizeComment_", "topOffset", "textOffset", "blur", "opt_wsWidth", "wsWidth", "DeserializationError", "toDevString", "reason", "childState", "VARIABLES", "PROCEDURES", "BLOCKS", "saveBlock", "BlockSerializer", "blockStates", "BlockBase", "opt_block", "BlockCreate", "FinishedLoading", "opt_workspace", "Ui", "opt_element", "opt_oldValue", "opt_newValue", "oldValue", "BlockChange", "setValue", "oldState", "getExtraBlockState_", "JSON", "stringify", "BlockDelete", "oldXml", "wasShadow", "oldJson", "ConnectionType", "INPUT_VALUE", "OUTPUT_VALUE", "NEXT_STATEMENT", "PREVIOUS_STATEMENT", "Connection", "shadowDom_", "check_", "shadowState_", "sourceBlock_", "connect_", "INPUT", "parentBlock", "disconnectInternal", "orphan", "shadowState", "stashShadowState_", "applyShadowState_", "setParent", "orphanConnection", "getConnectionForOrphanedConnection", "onFailedConnect", "setShadowStateInternal_", "unplug", "_otherConnection", "otherConnection", "disconnect", "getParentAndChildConnections", "respawnShadow_", "createShadowBlock_", "onCheckChanged_", "setCheck", "check", "getCheck", "shadowDom", "returnCurrent", "neighbours", "_maxLimit", "getParentInput", "parentInput", "serializeShadow_", "attemptToConnect", "blockShadow", "lastConnectionInStack", "CAN_CONNECT", "REASON_SELF_CONNECTION", "REASON_WRONG_TYPE", "REASON_TARGET_NULL", "REASON_CHECKS_FAILED", "REASON_DIFFERENT_WORKSPACES", "REASON_SHADOW_PARENT", "REASON_DRAG_CHECKS_FAILED", "REASON_PREVIOUS_AND_OUTPUT", "COLLAPSED_INPUT_NAME", "COLLAPSED_FIELD_NAME", "getBoundsInfo", "boundPosition", "boundSize", "clientTop", "MarkerManager", "cursorSvg_", "cursor_", "markers", "Map", "markerSvg_", "registerMarker", "marker", "unregisterMarker", "setDrawer", "makeMarkerDrawer", "setMarkerSvg", "getDrawer", "set", "delete", "getCursor", "getMarker", "setCursor", "cursor", "drawer", "setCursorSvg", "cursorSvg", "getBlockCanvas", "markerSvg", "updateMarkers", "keyboardAccessibilityMode", "draw", "markerIds", "markerId", "LOCAL_MARKER", "Field", "validator", "DEFAULT_VALUE", "constants_", "mouseDownWrapper_", "textContent_", "textElement_", "borderRect_", "fieldGroup_", "tooltip_", "validator_", "maxDisplayLength", "enabled_", "visible_", "isDirty_", "suffixField", "prefixField", "clickTarget_", "EDITABLE", "SERIALIZABLE", "value_", "size_", "SKIP_SETUP", "configure_", "setValidator", "setSourceBlock", "getConstants", "initView", "updateEditable", "bindEvents_", "createBorderRect_", "createTextElement_", "FIELD_BORDER_RECT_RADIUS", "FIELD_TEXT_BASELINE_CENTER", "clickTarget", "getClickTarget_", "onMouseDown_", "fieldElement", "_doFullSerialization", "legacyState", "saveLegacyState", "loadLegacyState", "callingClass", "isClickable", "showEditor_", "isCurrentlyEditable", "handler", "getValidator", "getBorderRect", "getTextElement", "getTextContent", "applyColour", "render_", "nodeValue", "getDisplayText_", "updateSize_", "showEditor", "constants", "xOffset", "FIELD_BORDER_RECT_X_PADDING", "totalWidth", "totalHeight", "FIELD_TEXT_HEIGHT", "contentWidth", "FIELD_TEXT_FONTSIZE", "FIELD_TEXT_FONTWEIGHT", "FIELD_TEXT_FONTFAMILY", "FIELD_BORDER_RECT_HEIGHT", "positionTextElement_", "positionBorderRect_", "halfHeight", "FIELD_TEXT_BASELINE", "getAbsoluteXY_", "NBSP", "getText_", "markDirty", "forceRerender", "bumpNeighbours", "classValidation", "doClassValidation_", "classValue", "processValidation_", "localValidation", "localValue", "doValueUpdate_", "validatedValue", "doValueInvalid_", "_invalidValue", "setStartField", "newTip", "getTooltip", "referencesVariables", "refreshVariableName", "idx", "fieldRows", "getFlipRtl", "isTabNavigable", "onShortcut", "_shortcut", "updateMarkers_", "Symbol", "GRID", "GRIDCELL", "GROUP", "LISTBOX", "MENUITEMCHECKBOX", "OPTION", "PRESENTATION", "ROW", "TREE", "TREEITEM", "menuItems", "onKeyDownHandler", "mouseLeaveHandler", "mouseEnterHandler", "clickHandler", "mouseOverHandler", "highlightedItem", "openingCoords", "handleMouseOver", "handleClick", "handleMouseEnter", "handleMouseLeave", "handleKeyEvent", "getElement", "preventScroll", "getMenuItem", "menuElem", "currentElement", "setHighlighted", "currentHighlighted", "ACTIVEDESCENDANT", "highlightNext", "highlightHelper", "highlightPrevious", "highlightFirst", "highlightLast", "startIndex", "delta", "oldCoords", "newCoords", "performAction", "shiftKey", "metaKey", "altKey", "highlighted", "scrollHeight", "opt_value", "rightToLeft", "highlight", "checked", "checkable", "checkbox", "contentDom", "DISABLED", "setCheckable", "setChecked", "nameDep", "menuGenerator", "svgArrow_", "arrow_", "imageElement_", "selectedMenuItem_", "generatedOptions_", "trimmed", "menuGenerator_", "selectedOption_", "shouldAddBorderRect_", "FIELD_DROPDOWN_SVG_ARROW", "createSVGArrow_", "createTextArrow_", "FIELD_DROPDOWN_NO_BORDER_RECT_SHADOW", "ARROW_CHAR", "FIELD_DROPDOWN_SVG_ARROW_SIZE", "setAttributeNS", "FIELD_DROPDOWN_SVG_ARROW_DATAURI", "dropdownCreate_", "menuElement", "FIELD_DROPDOWN_COLOURED_DIV", "primaryColour", "getColour", "colourTertiary", "dropdownDispose_", "image", "Image", "handleMenuActionEvent_", "onItemSelected_", "useCache", "isValueValid", "fill", "colourSecondary", "colourPrimary", "renderSelectedImage_", "renderSelectedText_", "imageJson", "imageHeight", "imageWidth", "hasBorder", "FIELD_DROPDOWN_BORDER_RECT_HEIGHT", "IMAGE_Y_PADDING", "xPadding", "arrowWidth", "positionSVGArrow_", "textWidth", "textPadding", "FIELD_DROPDOWN_SVG_ARROW_PADDING", "svgArrowSize", "CHECKMARK_OVERHANG", "MAX_MENU_HEIGHT_VH", "IMAGE_Y_OFFSET", "BubbleOpen", "opt_isOpen", "opt_bubbleType", "BubbleType", "MUTATOR", "COMMENT", "WARNING", "opt_pair", "opt_class", "opt_margin", "oldHostMetrics", "ratio", "origin", "startDragHandle", "handlePosition", "handleLength", "scrollbarLength", "startDragMouse", "containerVisible", "isHandleVisible", "pair", "DEFAULT_SCROLLBAR_MARGIN", "outerSvg", "svgBackground", "svgHandle", "setInitialThickness", "lengthAttribute_", "positionAttribute_", "onMouseDownBarWrapper_", "onMouseDownBar", "onMouseDownHandleWrapper_", "onMouseDownHandle", "unsubscribe", "constrainHandleLength", "setHandleLength", "newLength", "constrainHandlePosition", "setHandlePosition", "newPosition", "setScrollbarLength", "newSize", "setPosition", "opt_metrics", "hostMetrics", "getMetrics", "metricsAreEquivalent", "resizeHorizontal", "resizeVertical", "updateMetrics", "requiresViewResize", "viewWidth", "viewHeight", "absoluteLeft", "absoluteTop", "resizeViewHorizontal", "resizeContentHorizontal", "viewSize", "xCoordinate", "scrollWidth", "maxScrollDistance", "maxHandleOffset", "handleOffset", "resizeViewVertical", "resizeContentVertical", "setContainerVisible", "visibilityChanged", "updateDisplay_", "mouseXY", "getInverseScreenCTM", "mouseLocation", "handleXY", "handleStart", "pageLength", "setupDragSurface", "onMouseUpHandle", "onMouseMoveHandle", "resetDragSurface", "getRatio_", "setOrigin", "Bubble", "anchorXY", "bubbleWidth", "bubbleHeight", "resizeGroup", "bubbleBack", "bubbleArrow", "bubbleGroup", "relativeTop", "relativeLeft", "autoLayout", "onMouseDownResizeWrapper", "onMouseDownBubbleWrapper", "moveCallback", "resizeCallback", "workspace_", "shape_", "angle", "ARROW_ANGLE", "arrowRadians", "canvas", "setAnchorLocation", "getBBox", "BORDER_WIDTH", "setBubbleSize", "positionBubble", "renderArrow", "hasResize", "embossFilterId", "bubbleEmboss", "bubbleMouseDown", "resizeMouseDown", "setSvgId", "promote", "unbindDragEvents", "onMouseUpWrapper", "bubbleMouseUp", "onMouseMoveWrapper", "resizeMouseMove", "registerResizeEvent", "registerMoveEvent", "lastChild", "layoutBubble", "getViewMetrics", "optimalLeft", "getOptimalRelativeLeft", "optimalTop", "getOptimalRelativeTop", "topPosition", "MIN_BLOCK_HEIGHT", "startPosition", "endPosition", "bottomPosition", "closerPosition", "fartherPosition", "topPositionOverlap", "getOverlap", "startPositionOverlap", "closerPositionOverlap", "fartherPositionOverlap", "mostOverlap", "relativeMin", "bubbleRight", "workspaceRight", "workspaceLeft", "bubbleLeft", "bubbleTop", "bubbleBottom", "workspaceTop", "workspaceBottom", "getBubbleSize", "doubleBorderWidth", "relBubbleX", "relBubbleY", "relAnchorX", "relAnchorY", "hypotenuse", "rise", "acos", "rightAngle", "rightRise", "rightRun", "cos", "bubbleSize", "thickness", "ARROW_THICKNESS", "backoffRatio", "ANCHOR_RADIUS", "baseX1", "baseY1", "swirlAngle", "swirlRise", "ARROW_BEND", "swirlRun", "baseX2", "baseY2", "hexColour", "paragraph", "tspanElement", "createNonEditableBubble", "paragraphElement", "iconXY", "bubble", "pathObject", "svgPath", "maxWidth", "DEFAULT_SNAP_RADIUS", "dragRadius", "flyoutDragRadius", "connectingSnapRadius", "currentConnectionPreference", "bumpDelay", "Icon", "iconGroup_", "collapseHidden", "SIZE", "iconXY_", "bubble_", "block_", "createIcon", "getBlock", "drawIcon_", "iconClick_", "setIconLocation", "getCorrectedSize", "_group", "_visible", "Theme", "opt_blockStyles", "opt_categoryStyles", "opt_componentStyles", "startHats", "blockStyles", "categoryStyles", "componentStyles", "fontStyle", "setBlockStyle", "blockStyleName", "blockStyle", "setCategoryStyle", "categoryStyleName", "categoryStyle", "getComponentStyle", "componentName", "recursiveStyle", "setComponentStyle", "styleValue", "setFontStyle", "setStartHats", "defineTheme", "themeObj", "base", "defaultBlockStyles", "Classic", "toolboxJsonDef", "hasCollapse", "hasComments", "hasDisable", "rawHasTrashcan", "rawHasCollapse", "rawHasComments", "rawHasDisable", "rawHasSounds", "maxTrashcanContents", "toolboxAtStart", "toolboxPosition", "endsWith", "rawOneBasedIndex", "modalInputs", "oneBasedIndex", "maxBlocks", "maxInstances", "parseMoveOptions_", "hasScrollbars", "parseGridOptions_", "parseZoomOptions_", "parseThemeOptions_", "rendererOverrides", "move", "wheel", "drag", "zoom", "maxScale", "minScale", "scaleSpeed", "pinch", "grid", "spacing", "snap", "quarkNames", "workspaceHeight", "workspaceWidth", "updateWorkspacePid", "sourceListener", "rootBlock", "svgDialog", "setBlock", "createEditor", "quarkXml", "quarkName", "workspaceOptions", "hasFlyout", "newWorkspaceSvg", "internalIsMutator", "flyoutSvg", "background", "svgBlockCanvas_", "resizeBubble", "getCanvas", "workspaceSize", "flyoutScrollMetrics", "isRtl", "onBubbleMove", "recordDragTargets", "tree", "CORNER_RADIUS", "saveConnections", "thisRootBlock", "boundListener", "workspaceChanged", "updateWorkspace", "removeChangeListener", "shouldIgnoreMutatorEvent_", "MARGIN", "oldExtraState", "newExtraState", "mutationGroup", "oldGroup", "updateBlockStyle", "workspaceBlocks", "setStyle", "getStyleName", "flyoutBlocks", "reconnect", "connectionChild", "connectionParent", "currentParent", "findParentWs", "outerWs", "FieldLabel", "textClass", "class_", "class", "setClass", "cssClass", "Input", "align", "Align", "appendField", "insertFieldAt", "removeField", "opt_quiet", "renderList", "renderedConnection", "startTrackingAll", "stopTrackingAll", "setAlign", "CENTRE", "Block", "hue_", "colour_", "styleName_", "suppressPrefixSuffix", "contextMenu", "parentBlock_", "childBlocks_", "collapsed_", "isShadow_", "outputShape_", "disposing", "isInsertionMarker_", "onchangeWrapper_", "statementInputCount", "setBlockById", "isInMutator", "assign", "addTopBlock", "addTypedBlock", "doInit_", "onchange", "setOnChange", "healStack", "removeTopBlock", "disposeInternal", "removeTypedBlock", "removeBlockById", "destroy", "opt_healStack", "unplugFromRow_", "unplugFromStack_", "thisConnection", "getOnlyValueConnection_", "previousTarget", "nextTarget", "_all", "myConnections", "ignoreShadows", "getInputWithBlock", "getSurroundParent", "prevBlock", "getPreviousBlock", "getFirstStatementConnection", "getTopStackBlock", "previous", "ordered", "childBlocks", "hasBlockLimits", "setInsertionMarker", "insertionMarker", "getMatchingConnection", "otherBlock", "connections", "otherConnections", "setHelpUrl", "url", "getHue", "parsed", "onchangeFn", "getVars", "vars", "updateVarName", "renameVarById", "newId", "setFieldValue", "setPreviousStatement", "newBoolean", "opt_check", "makeConnection_", "setNextStatement", "setOutput", "setOutputShape", "outputShape", "getOutputShape", "ancestor", "opt_maxLength", "opt_emptyToken", "toTokens", "prev", "acc", "curr", "emptyToken", "checks", "shouldAddParens", "appendValueInput", "appendInput_", "appendStatementInput", "appendDummyInput", "warningPrefix", "hat", "jsonInitStyle_", "jsonInitColour_", "interpolate_", "localizedText", "localizedValue", "extensionNames", "styleError", "opt_disableCheck", "overwrites", "lastDummyAlign", "validateTokens_", "elements", "interpolateArguments_", "fieldStack", "isInputKeyword_", "inputFromJson_", "fieldFromJson_", "argsCount", "visitedArgsHash", "visitedArgsCount", "token", "stringToFieldJson_", "dummyInput", "alignmentLookup", "alignment", "moveInputBefore", "refName", "inputIndex", "refIndex", "moveNumberedInputBefore", "RangeError", "removeInput", "getInputTargetBlock", "setWarningText", "_text", "_opt_id", "_mutator", "allInputsFilled", "opt_shadowBlocksAreFilled", "surfaceXY", "childSurfaceXY", "dragGroup", "translateAndScaleGroup", "roundX", "roundY", "translateSurfaceInternal_", "translateBy", "getWsTranslation", "clearAndHide", "opt_newSurface", "currentBlockElement", "BlockDrag", "opt_isStart", "opt_blocks", "isStart", "bumpIntoBounds", "Capability", "name_", "POSITIONABLE", "DRAG_TARGET", "DELETE_AREA", "AUTOHIDEABLE", "ComponentManager", "componentData", "capabilityToComponentIds", "addComponent", "componentInfo", "component", "capabilities", "stringCapabilities", "capability", "removeComponent", "addCapability", "getComponent", "hasCapability", "removeCapability", "getComponents", "sorted", "componentIds", "components", "componentDataList", "componentDatum", "DUPLICATE_BLOCK_ERROR", "InsertionMarkerManager", "activeCandidate", "lastMarker", "lastOnStack", "wouldDeleteBlock", "fadedBlock", "highlightedBlock", "markerConnection", "firstMarker", "createMarkerBlock", "availableConnections", "initAvailableConnections", "disposeInsertionMarker", "updateAvailableConnections", "wouldConnectBlock", "applyConnections", "hidePreview", "local", "closest", "inferiorConnection", "bringToFront", "update", "dxy", "dragTarget", "newCandidate", "getCandidate", "shouldDelete", "shouldUpdatePreviews", "maybeHidePreview", "maybeShowPreview", "imType", "sourceInput", "resultInput", "sourceField", "resultField", "available", "activeLocal", "activeClosest", "xDiff", "yDiff", "curDistance", "getStartRadius", "candidate", "myConnection", "neighbour", "getComponentManager", "componentManager", "isDeleteArea", "wouldDelete", "log", "showPreview", "getConnectionPreviewMethod", "method", "PREVIEW_TYPE", "INPUT_OUTLINE", "showInsertionInputOutline", "INSERTION_MARKER", "showInsertionMarker", "REPLACEMENT_FADE", "showReplacementFade", "shouldHighlightConnection", "localChanged", "unhighlight", "hideReplacementFade", "hideInsertionInputOutline", "hideInsertionMarker", "isLastInStack", "imConn", "positionNearConnection", "markerConn", "imBlock", "markerOutput", "markerPrev", "highlightShapeForInput", "fadeForReplacement", "getInsertionMarkers", "PreviewType", "BlockDragger", "dragTarget_", "wouldDeleteBlock_", "draggingBlock_", "draggedConnectionManager_", "startXY_", "dragIconData_", "currentDragDeltaXY", "fireDragStartEvent_", "shouldDisconnect_", "disconnectBlock_", "pixelsToWorkspaceUnits_", "dragIcons_", "oldDragTarget", "getDragTarget", "oldWouldDeleteBlock", "updateCursorDuringBlockDrag_", "onDragExit", "onDragEnter", "onDragOver", "endDrag", "fireDragEndEvent_", "shouldPreventMove", "newValues", "getNewLocationAfterDrag_", "newLocation", "moveOffDragSurface", "onDrop", "maybeDeleteBlock_", "deleted", "updateBlockAfterMove_", "fireMoveEvent_", "scheduleSnapAndBump", "updateToolboxStyle_", "isEnd", "removeStyle", "addStyle", "oldCoordinate", "pixelCoord", "Comment", "cachedText", "boundEvents", "paragraphElement_", "resizeTextarea", "startEdit", "disposeBubble", "createBubble", "onBubbleResize", "widthMinusBorder", "heightMinusBorder", "createEditableBubble", "updateText", "registry_", "reset", "getContextMenuOptions", "menuOptions", "precondition", "menuOption", "COLLAPSE_CHARS", "DRAG_STACK", "OPPOSITE_TYPE", "RENAME_VARIABLE_ID", "DELETE_VARIABLE_ID", "ASTNode", "opt_params", "wsCoordinate_", "type_", "isConnection_", "isConnectionType_", "location_", "processParams_", "wsCoordinate", "getLocation", "getType", "getWsCoordinate", "isConnection", "findNextForInput_", "curIdx", "NAVIGATE_ALL_FIELDS", "createFieldNode", "createInputNode", "findNextForField_", "fieldIdx", "newInput", "findPrevForInput_", "findPrevForField_", "navigateBetweenStacks_", "curLocation", "curLocationAsBlock", "curRoot", "resultIndex", "createStackNode", "findTopASTNodeForBlock_", "createConnectionNode", "createBlockNode", "getOutAstNodeForBlock_", "findFirstFieldOrInput_", "STACK", "OUTPUT", "PREVIOUS", "NEXT", "in", "out", "blockPos", "DEFAULT_OFFSET_Y", "createWorkspaceNode", "createTopNode", "Marker", "drawer_", "curNode_", "getCurNode", "setCurNode", "oldNode", "Cursor", "curNode", "BasicCursor", "getNextNode_", "validNode_", "getPreviousNode_", "isValid", "siblingOrParent", "findSiblingOrParent_", "getRightMostChild_", "nextNode", "registrationName", "TabNavigateCursor", "BUMP_RANDOMNESS", "RenderedConnection", "highlightPath", "db_", "connectionDBList", "dbOpposite_", "offsetInBlock_", "trackedState_", "TrackedState", "WILL_TRACK", "TRACKED", "removeConnection", "distanceFrom", "bumpAwayFrom", "staticConnection", "updated", "addConnection", "blockTL", "setOffsetInBlock", "getOffsetInBlock", "tighten", "svgRoot", "moveConnections", "tightenEfficiently", "maxLimit", "searchForClosest", "renderConstants", "shapeFor", "yLen", "TAB_OFFSET_FROM_TOP", "pathDown", "xLen", "NOTCH_OFFSET_LEFT", "pathLeft", "setTracking", "doTracking", "UNTRACKED", "getNeighbours", "parentRendered", "childRendered", "Warning", "setText", "allWarnings", "WeakSet", "renderingDebugger", "warningTextDb", "commentIcon_", "renderIsInProgress_", "visuallyDisabled", "bumpNeighboursPid", "getBlockStyle", "makePathObject", "getColourSecondary", "getColourTertiary", "oldParent", "isClearing", "oldXY", "eventsEnabled", "curXY", "snapToGrid", "getGrid", "shouldSnap", "getSpacing", "half", "blockBounds", "updateCollapsed_", "collapsedInputName", "collapsedFieldName", "tab", "tabCursor", "currentNode", "nextField", "handleBlockStart", "open", "generateContextMenu", "customContextMenu", "INSERTION_MARKER_COLOUR", "updateInsertionMarker", "animate", "n", "shouldHaveComment", "timeout", "changedState", "collapsedParent", "COLLAPSED_WARNING_ID", "oldText", "newText", "updateHighlighted", "updateSelected", "updateDraggingDelete", "styleObj", "getBlockStyleForColour", "removed", "track", "all", "bumpNeighboursInternal", "sourceConnection", "opt_bubble", "tightenChildrenEfficiently", "nextHeightWidth", "tabHeight", "NOTCH_HEIGHT", "updateReplacementFade", "updateShapeForInputHighlight", "INLINE", "BubbleDragger", "wouldDeleteBubble_", "dragSurface_", "startBubbleDrag", "dragBubble", "oldWouldDeleteBubble", "shouldDelete_", "updateCursorDuringBubbleDrag_", "endBubbleDrag", "setOldCoordinate", "ConnectionChecker", "opt_distance", "safety", "doSafetyChecks", "doTypeChecks", "doDragChecks", "errorCode", "superiorBlock", "inferiorBlock", "superiorConnection", "checkArrayOne", "checkArrayTwo", "canConnectToPrevious_", "ConnectionDB", "connections_", "yPos", "calculateIndexForYPos_", "findIndexOfConnection_", "bestGuess", "pointer", "pointerMin", "pointerMax", "pointerMid", "maxRadius", "checkConnection_", "yIndex", "currentX", "db", "currentY", "isInYRange_", "baseY", "baseX", "closestIndex", "bestConnection", "bestRadius", "dbList", "BlockMove", "currentLocation_", "oldParentId", "parentId", "oldInputName", "coordinate", "blockConnection", "connectionType", "Click", "opt_targetType", "targetType", "ClickTarget", "ZOOM_CONTROLS", "CommentBase", "opt_comment", "CommentCreateDeleteHelper", "CommentChange", "opt_oldContents", "opt_newContents", "oldContents_", "newContents_", "CommentCreate", "CommentDelete", "CommentMove", "comment_", "oldCoordinate_", "newCoordinate_", "current", "MarkerMove", "isCursor", "opt_oldNode", "opt_newNode", "ThemeChange", "opt_themeName", "themeName", "ToolboxItemSelect", "opt_oldItem", "opt_newItem", "oldItem", "newItem", "TrashcanOpen", "VarDelete", "VarRename", "ViewportChange", "opt_top", "opt_left", "opt_scale", "opt_oldScale", "DragTarget", "_dragElement", "getClientRect", "DeleteArea", "wouldDelete_", "couldConnect", "couldDeleteBlock", "updateWouldDelete_", "FieldInput", "spellcheck_", "htmlInput_", "isTextValid_", "isBeingEdited_", "onKeyInputWrapper_", "onKeyDownWrapper_", "fullBlockClickTarget_", "spellcheck", "FULL_BLOCK_FIELDS", "nFields", "nConnections", "FIELD_BORDER_RECT_COLOUR", "resizeEditor_", "htmlInput", "INVALID", "setSpellcheck", "quietInput", "showPromptEditor_", "showInlineEditor_", "getValueFromEditorText_", "widgetDispose_", "widgetCreate_", "getScale", "borderRadius", "BORDERRADIUS", "strokeColour", "border", "FIELD_TEXTINPUT_BOX_SHADOW", "boxShadow", "getEditorText_", "bindInputEvents_", "onFinishEditing_", "unbindInputEvents_", "_value", "onHtmlInputKeyDown_", "onHtmlInputChange_", "setEditorValue_", "FieldAngle", "clockwise", "CLOCKWISE", "OFFSET", "WRAP", "ROUND", "symbol_", "gauge", "mode", "Mode", "COMPASS", "PROTRACTOR", "updateGraph", "editor", "dropdownCreate", "dropdownDispose", "HALF", "circle", "RADIUS", "onMouseMove_", "ownerSVGElement", "displayMouseOrKeyboardValue", "wrapValue", "path", "x2", "y2", "clockwiseFlag", "angle1", "x1", "y1", "largeFlag", "multiplier", "isFinite", "FieldCheckbox", "checkChar_", "CHECK_CHAR", "checkCharacter", "getValueBoolean", "FIELD_CHECKBOX_X_OFFSET", "setCheckCharacter", "character", "convertValueToBool_", "FieldColour", "highlightedIndex", "picker", "titles", "colours", "columns", "colourOptions", "colourTitles", "FIELD_COLOUR_DEFAULT_WIDTH", "FIELD_COLOUR_DEFAULT_HEIGHT", "FIELD_COLOUR_FULL_BLOCK", "setColours", "setColumns", "onClick", "cell", "handled", "moveHighlightBy", "getHighlighted", "COLOURS", "COLUMNS", "setHighlightedCell", "onMouseEnter", "onMouseLeave", "row", "cellId", "TITLES", "selectedColour", "table", "dir", "EXPANDED", "ROWCOUNT", "COLCOUNT", "title", "FieldImage", "flipRtl", "clickHandler_", "flipRtl_", "altText_", "Y_PADDING", "imageHeight_", "setAlt", "setOnClickHandler", "FieldLabelSerializable", "FieldTextInput", "FieldMultilineInput", "textGroup", "maxLines_", "isOverflowedY_", "maxLines", "setMaxLines", "textLines", "displayLinesNumber", "currentChild", "lineHeight", "FIELD_BORDER_RECT_Y_PADDING", "nodes", "tspan", "actualEditorLines", "dummyTextElement", "lineWidth", "paddingX", "paddingY", "padding", "getMaxLines", "FieldNumber", "precision", "min_", "max_", "precision_", "decimalPlaces_", "setConstraints", "setMinInternal_", "setMaxInternal_", "setPrecisionInternal_", "setMin", "getMin", "setMax", "getMax", "setPrecision", "precisionString", "toLocaleString", "maximumFractionDigits", "decimalIndex", "getPrecision", "toFixed", "VALUEMIN", "VALUEMAX", "FieldVariable", "variableTypes", "defaultType", "defaultType_", "variable_", "defaultVariableName", "setTypes_", "variableName", "variableType", "typeIsAllowed_", "typeList", "getVariableTypes_", "getVariableTypes", "isInArray", "FlyoutButton", "isLabel_", "svgText_", "text_", "callbackKey_", "cssClass_", "svgText", "fontMetrics", "TEXT_MARGIN_X", "TEXT_MARGIN_Y", "updateTransform_", "onMouseUp_", "isLabel", "getButtonText", "cancel", "getButtonCallback", "MetricsManager", "getDimensionsPx_", "getFlyoutMetrics", "opt_own", "flyoutDimensions", "getToolboxMetrics", "toolboxDimensions", "getSvgMetrics", "getAbsoluteMetrics", "flyoutMetrics", "doesToolboxExist", "doesFlyoutExist", "atLeft", "atTop", "opt_getWorkspaceCoordinates", "svgMetrics", "getContentMetrics", "blockBox", "isMovableHorizontally", "isMovableVertically", "getComputedFixedEdges_", "opt_viewMetrics", "hScrollEnabled", "vScrollEnabled", "edges", "getPaddedContent_", "contentMetrics", "contentBottom", "contentRight", "halfWidth", "opt_contentMetrics", "fixedEdges", "paddedContent", "getUiMetrics", "contentHeight", "contentTop", "contentLeft", "svgHeight", "svgWidth", "toolboxWidth", "toolboxHeight", "flyoutWidth", "flyoutHeight", "FlyoutMetricsManager", "flyout_", "getBoundingBox_", "blockBoundingBox", "addHorizontal", "addVertical", "oldHostMetrics_", "corner_", "vScroll", "hScroll", "isPair", "resizeH", "resizeV", "maybeFireViewportChangeEvent", "xyRatio", "setX", "setY", "resizeContent", "resizeView", "WorkspaceDragger", "horizontalScrollEnabled_", "verticalScrollEnabled_", "startScrollXY_", "scroll", "ZOOM_IN_MULTIPLIER", "ZOOM_OUT_MULTIPLIER", "creatorWorkspace", "mouseDownXY_", "startWorkspace_", "targetBlock_", "startBlock_", "startField_", "startBubble_", "hasExceededDragRadius_", "workspaceDragger_", "blockDragger_", "bubbleDragger_", "isMultiTouch_", "isEnding_", "hasStarted_", "calledUpdateIsDragging_", "cachedPoints", "startDistance_", "previousScale_", "currentDropdownOwner", "isPinchZoomEnabled_", "mostRecentEvent_", "currentDragDeltaXY_", "healStack_", "clearGesture", "updateFromEvent_", "currentXY", "updateDragDelta_", "changed", "updateIsDragging_", "currentDragDelta", "updateIsDraggingFromFlyout_", "isBlockCreatable", "isScrollable", "isDragTowardWorkspace", "updateScreenCalculationsIfScrolled", "createBlock", "updateIsDraggingBubble_", "startDraggingBubble_", "updateIsDraggingBlock_", "startDraggingBlock_", "updateIsDraggingWorkspace_", "isDraggable", "BlockDraggerClass", "doStart", "pointerType", "handleTouchStart", "handleMove", "handleUp", "isMultiTouch", "handleTouchMove", "handleTouchEnd", "isBubbleClick_", "doBubbleClick_", "isFieldClick_", "doFieldClick_", "isBlockClick_", "doBlockClick_", "isWorkspaceClick_", "doWorkspaceClick_", "getTouchPoint", "pointers", "point0", "point1", "handlePinch_", "moveDistance", "gestureScale", "bringBlockToFront_", "handleWsStart", "setStartWorkspace_", "fireWorkspaceClick_", "handleFlyoutStart", "setStartFlyout_", "setStartBlock", "setStartBubble", "autoClose", "setTargetBlock_", "hasStartBubble", "hasStartBlock", "hasStarted", "getCurrentDragger", "currentGesture_", "pattern", "line2", "line1", "getPatternId", "safeSpacing", "end", "setLineAttributes", "reservedWordsList", "opt_variablePrefix", "dbReverse", "variableMap_", "variablePrefix_", "reservedWords", "setVariableMap", "getNameForUserVariable_", "populateVariables", "NameType", "VARIABLE", "nameOrId", "normalizedName", "DEVELOPER_VARIABLE", "typeDb", "safeName", "getDistinctName", "getUserNames", "userNames", "safeName_", "encodeURI", "name1", "name2", "PROCEDURE", "DEVELOPER_VARIABLE_TYPE", "ObservableProcedureMap", "existed", "TypesContainer", "NONE", "HAT", "ICON", "SPACER", "BETWEEN_ROW_SPACER", "IN_ROW_SPACER", "EXTERNAL_VALUE_INPUT", "INLINE_INPUT", "STATEMENT_INPUT", "CONNECTION", "PREVIOUS_CONNECTION", "NEXT_CONNECTION", "OUTPUT_CONNECTION", "CORNER", "LEFT_SQUARE_CORNER", "LEFT_ROUND_CORNER", "RIGHT_SQUARE_CORNER", "RIGHT_ROUND_CORNER", "JAGGED_EDGE", "TOP_ROW", "BOTTOM_ROW", "INPUT_ROW", "LEFT_CORNER", "RIGHT_CORNER", "nextTypeValue_", "hasOwnProperty", "isField", "isHat", "isIcon", "isSpacer", "isInRowSpacer", "isInput", "isExternalInput", "isInlineInput", "isStatementInput", "isPreviousConnection", "isNextConnection", "isPreviousOrNextConnection", "isLeftRoundedCorner", "isRightRoundedCorner", "isLeftSquareCorner", "isRightSquareCorner", "isCorner", "isJaggedEdge", "isRow", "isBetweenRowSpacer", "isTopRow", "isBottomRow", "isTopOrBottomRow", "isInputRow", "Types", "Measurable", "centerline", "xPos", "notchOffset", "Row", "widthWithConnectedBlocks", "minWidth", "minHeight", "hasStatement", "hasExternalInput", "statementEdge", "hasJaggedEdge", "hasDummyInput", "hasInlineInput", "getLastInput", "measure", "startsWithElemSpacer", "endsWithElemSpacer", "getFirstSpacer", "getLastSpacer", "BottomRow", "hasNextConnection", "descenderHeight", "hasLeftSquareCorner", "hasRightSquareCorner", "_block", "connectionModel", "InputConnection", "connectionOffsetY", "connectionOffsetX", "connectedBlock", "connectedBlockWidth", "connectedBlockHeight", "ExternalValueInput", "MEDIUM_PADDING", "EXTERNAL_VALUE_INPUT_PADDING", "connectionHeight", "connectionWidth", "Hat", "START_HAT", "ascenderHeight", "InRowSpacer", "SPACER_DEFAULT_HEIGHT", "InlineInput", "EMPTY_INLINE_INPUT_HEIGHT", "EMPTY_INLINE_INPUT_PADDING", "StatementInput", "STATEMENT_BOTTOM_SPACER", "EMPTY_STATEMENT_INPUT_HEIGHT", "STATEMENT_INPUT_NOTCH_OFFSET", "InputRow", "connectedBlockWidths", "JaggedEdge", "JAGGED_TEETH", "NextConnection", "OutputConnection", "startX", "PreviousConnection", "RoundCorner", "opt_position", "SpacerRow", "precedesStatement", "followsStatement", "SquareCorner", "NO_PADDING", "TopRow", "capline", "hasPreviousConnection", "hasHat", "ADD_START_HATS", "ConstantProvider", "SMALL_PADDING", "MEDIUM_LARGE_PADDING", "LARGE_PADDING", "TAB_HEIGHT", "TAB_VERTICAL_OVERLAP", "TAB_WIDTH", "NOTCH_WIDTH", "MIN_BLOCK_WIDTH", "EMPTY_BLOCK_SPACER_HEIGHT", "STATEMENT_INPUT_PADDING_LEFT", "BETWEEN_STATEMENT_PADDING_Y", "START_HAT_HEIGHT", "START_HAT_WIDTH", "JAGGED_TEETH_HEIGHT", "JAGGED_TEETH_WIDTH", "defs_", "embossFilter_", "disabledPatternId", "disabledPattern_", "debugFilterId", "cssNode_", "debugFilter_", "CURSOR_COLOUR", "MARKER_COLOUR", "CURSOR_WS_WIDTH", "WS_CURSOR_HEIGHT", "CURSOR_STACK_PADDING", "CURSOR_BLOCK_PADDING", "CURSOR_STROKE_WIDTH", "INSERTION_MARKER_OPACITY", "SHAPES", "PUZZLE", "NOTCH", "TALL_INPUT_FIELD_OFFSET_Y", "DUMMY_INPUT_SHADOW_MIN_HEIGHT", "DUMMY_INPUT_MIN_HEIGHT", "TOP_ROW_MIN_HEIGHT", "TOP_ROW_PRECEDES_STATEMENT_MIN_HEIGHT", "BOTTOM_ROW_MIN_HEIGHT", "BOTTOM_ROW_AFTER_STATEMENT_MIN_HEIGHT", "START_POINT", "randomIdentifier", "makeJaggedTeeth", "makeNotch", "makeStartHat", "PUZZLE_TAB", "makePuzzleTab", "INSIDE_CORNERS", "makeInsideCorners", "OUTSIDE_CORNERS", "makeOutsideCorners", "setTheme", "validatedBlockStyle_", "setDynamicProperties_", "setFontConstants_", "setComponentConstants_", "createBlockStyle_", "valid", "parsedColour", "generateSecondaryColour_", "generateTertiaryColour_", "inputColour", "mainPath", "makeMainPath", "up", "back", "control1Y", "overlap", "control2Y", "endPoint1", "endPoint2", "pathUp", "outerWidth", "innerWidth", "pathRight", "innerTopLeftCorner", "innerBottomLeftCorner", "pathTop", "pathBottom", "topLeft", "topRight", "bottomLeft", "bottomRight", "rightHeight", "selector", "injectCSS_", "embossFilter", "feSpecularLighting", "disabledPattern", "createDebugFilter", "debugFilter", "debugComponentTransfer", "cssArray", "getCSS_", "cssNodeId", "Debug", "debugElements_", "svgRoot_", "randomColour_", "clearElems", "drawSpacerRow", "cursorY", "rowSpacers", "isNegativeSpacing", "drawSpacerElem", "rowHeight", "elemSpacers", "drawRenderedElem", "elems", "drawConnection", "drawRenderedRow", "rows", "connectedBlockBounds", "drawRowWithElements", "drawBoundingBox", "widthWithChildren", "drawDebug", "rightSide", "drawRender", "Drawer", "inlinePath_", "outlinePath_", "info_", "topLeft_", "hideHiddenIcons_", "drawOutline_", "drawInternals_", "setPath", "flipRTL", "recordSizeOnBlock_", "iconInfo", "hiddenIcons", "drawTop_", "drawJaggedEdge_", "drawStatementInput_", "drawValueInput_", "drawRightSideRow_", "drawBottom_", "drawLeft_", "topRow", "positionPreviousConnection_", "startY", "positionExternalValueConnection_", "innerHeight", "positionStatementInputConnection_", "bottomRow", "positionNextConnection_", "rightCornerYOffset", "outlinePath", "positionOutputConnection_", "tabBottom", "drawInlineInput_", "layoutField_", "fieldInfo", "connectionTop", "connectionBottom", "positionInlineInputConnection_", "connX", "connInfo", "RenderInfo", "inputRows", "renderer_", "isInline", "createRows_", "addElemSpacing_", "addRowSpacing_", "computeBounds_", "alignRowElements_", "finalize_", "populateTopRow_", "activeRow", "lastInput", "shouldStartNewRow_", "addInput_", "populateBottomRow_", "hasPrevious", "cornerClass", "leftSquareCorner", "rightSquareCorner", "oldElems", "getInRowSpacing_", "widestStatementRowFields", "blockWidth", "widestRowWithConnectedBlocks", "statementInput", "alignStatementRow_", "currentWidth", "missingSpace", "getDesiredRowWidth_", "desiredWidth", "addAlignmentPadding_", "_row", "firstSpacer", "lastSpacer", "oldRows", "makeSpacerRow_", "getSpacerRowHeight_", "getSpacerRowWidth_", "spacer", "_prev", "_next", "getElemCenterline_", "recordElemPositions_", "xCursor", "yCursor", "CURSOR_CLASS", "MARKER_CLASS", "HEIGHT_MULTIPLIER", "MarkerSvg", "markerSvgRect_", "markerSvgLine_", "markerInput_", "markerBlock_", "currentMarkerSvg", "parent_", "defaultColour", "createDomInternal_", "setParent_", "applyColour_", "showAtLocation_", "fireMarkerEvent_", "beginElement", "curNodeAsConnection", "showWithBlock_", "showWithOutput_", "showWithInput_", "showWithNext_", "showWithPrevious_", "showWithField_", "showWithCoordinates_", "showWithStack_", "showWithBlockPrevOutput_", "markerHeight", "markerOffset", "connectionShape", "positionPrevious_", "positionOutput_", "positionBlock_", "showCurrent_", "positionLine_", "positionRect_", "positionInput_", "heightWidth", "yPadding", "markerPath", "curBlock", "getBlinkProperties_", "blinkProperties", "attributeName", "_curNode", "firstElementChild", "PathObject", "pathString", "updateShadow_", "updateDisabled_", "setClass_", "_conn", "Renderer", "overrides", "makeConstants_", "refreshDom", "previousConstants", "makeRenderInfo_", "makeDrawer_", "makeDebugger_", "orphanCanConnectAtEnd", "localType", "ThemeManager", "subscribedWorkspaces_", "componentDB", "prevTheme", "oldClassName", "newClassName", "refreshTheme", "componentList", "propertyName", "setProperty", "subscribeWorkspace", "unsubscribeWorkspace", "onCreateVariableButtonClick_String", "onCreateVariableButtonClick_Number", "onCreateVariableButtonClick_Colour", "VariableMap", "variableMap", "deleteVariable", "conflictVar", "renameVariableWithConflict_", "renameVariableAndUses_", "variableId", "tempVar", "uses", "getVariableUsesById", "procedureName", "deleteText", "confirmText", "deleteVariableInternal", "list", "flat", "Workspace", "internalIsFlyout", "MAX_UNDO", "topComments", "commentDB", "listeners", "undoStack_", "redoStack_", "blockDB", "typedBlocksDB", "procedureMap", "connectionCheckerClass", "sortObjects_", "SCAN_ANGLE", "aXY", "bXY", "filtered", "remainingCapacity", "remainingCapacityOfType", "copyableBlocksCount", "redo", "inputStack", "outputStack", "inputEvent", "clearUndo", "createPotentialVariableMap", "getById", "getAll", "SOUND_LIMIT", "WorkspaceAudio", "sounds", "lastSound_", "filenames", "audioTest", "filename", "ext", "canPlayType", "sound", "volume", "playPromise", "then", "pause", "catch", "opt_volume", "now", "mySound", "DOWN", "SPRITE", "ZoomControls", "zoomResetGroup", "zoomOutGroup", "zoomInGroup", "HEIGHT", "WIDTH", "SMALL_SPACING", "LARGE_SPACING", "MARGIN_HORIZONTAL", "MARGIN_VERTICAL", "initialized", "createZoomOutSvg", "createZoomInSvg", "createZoomResetSvg", "cornerPosition", "positionRect", "zoomInTranslateY", "zoomOutTranslateY", "clip", "zoomoutSvg", "zoominSvg", "amount", "zoomCenter", "fireZoomEvent", "zoomresetSvg", "resetZoom", "beginCanvasTransition", "scrollCenter", "endCanvasTransition", "uiEvent", "ZOOM_TO_FIT_MARGIN", "opt_blockDragSurface", "opt_wsDragSurface", "resizeHandlerWrapper", "resizesEnabled", "isVisible_", "startScrollY", "startScrollX", "dragDeltaXY", "oldLeft", "oldTop", "toolbox_", "isDragSurfaceActive", "inverseScreenCTM", "configureContextMenu", "lastRecordedPageScroll", "inverseScreenCTMDirty", "highlightedBlocks", "toolboxCategoryCallbacks", "flyoutButtonCallbacks", "cachedParentSvg", "topBoundedElements", "dragTargetAreas", "MetricsManagerClass", "setTopLevelWorkspaceMetrics_", "useWorkspaceDragSurface", "audioManager", "markerManager", "Variables", "registerToolboxCategoryCallback", "Procedures", "themeManager_", "cachedParentSvgSize", "getMarkerManager", "setMetricsManager", "updateBlockStyles_", "refreshToolboxSelection", "ctm", "opt_backgroundClass", "svgBackground_", "svgBubbleCanvas_", "onMouseWheel_", "ToolboxClass", "CursorClass", "parentSvg", "newTrashcan", "svgTrashcan", "_workspace", "svgZoomControls", "HorizontalFlyout", "VerticalFlyout", "updateScreenCalculations_", "positionables", "positionable", "currScroll", "trans", "previousElement", "previousSibling", "coord", "setContentsAndShow", "imList", "highlightBlock", "opt_state", "pasteBlock_", "pasteWorkspaceComment_", "jsonBlock", "collide", "allBlocks", "otherXY", "refreshSelection", "dragTargets", "targetArea", "clientRect", "canWheelZoom", "canWheelMove", "scrollDelta", "commandKey", "PIXELS_PER_ZOOM_STEP", "topElements", "boundary", "topElement", "blockBoundary", "scaleChange", "newScale", "getCTM", "center", "f", "setScale", "zoomToFit", "blocksBox", "doubleMargin", "blocksWidth", "blocksHeight", "ratioX", "ratioY", "centerOnBlock", "blockOnly", "pixelX", "pixelY", "reflow", "maxYScroll", "maxYDisplacement", "maxXDisplacement", "addTopBoundedElement", "removeTopBoundedElement", "reenabled", "removeButtonCallback", "getToolboxCategoryCallback", "removeToolboxCategoryCallback", "onlyClosePopups", "autoHideables", "autoHideable", "autoHide", "FlyoutItemType", "BUTTON", "Flyout", "filterWrapper_", "reflowWrapper_", "mats_", "buttons_", "listeners_", "permanentlyDisabled_", "recycledBlocks_", "containerVisible_", "SCROLLBAR_MARGIN", "dragAngleRange_", "setMetrics_", "toolboxPosition_", "tabWidth_", "rectMap_", "WeakMap", "GAP_X", "GAP_Y", "wheel_", "filterForCapacity_", "getFlyoutScale", "positionAt_", "listen", "clearOldBlocks_", "getDynamicCategoryContents_", "parsedContent", "flyoutInfo", "createFlyoutInfo_", "layout_", "gaps", "emptyRecycledBlocks_", "defaultGap", "categoryName", "parsedDynamicContent", "dynamicContents", "dynamicGaps", "blockInfo", "createFlyoutBlock_", "addBlockGap_", "addSeparatorGap_", "createButton_", "fnToApply", "btnInfo", "curButton", "getRecycledBlock_", "blockType", "gap", "sepInfo", "newGap", "oldBlocks", "blockIsRecyclable_", "recycleBlock_", "addBlockListeners_", "blockMouseDown_", "originalBlock", "placeNewBlock_", "initFlyoutButton_", "buttonSvg", "createRect_", "blockHW", "moveRectToBlock_", "reflowInternal_", "oldBlock", "svgRootOld", "positionNewBlock_", "flyoutOffsetPixels", "oldBlockPos", "oldBlockOffsetPixels", "getX", "getY", "targetWorkspaceViewMetrics", "setBackgroundPath_", "cursorX", "moveX", "dragDirection", "atan2", "range", "flyoutRect", "BIG_NUM", "buttons", "atRight", "oldX", "newX", "registryName", "CodeGenerator", "FUNCTION_NAME_PLACEHOLDER_", "STATEMENT_SUFFIX", "STATEMENT_PREFIX", "INFINITE_LOOP_TRAP", "INDENT", "COMMENT_WRAP", "ORDER_OVERRIDES", "isInitialized", "RESERVED_WORDS_", "definitions_", "functionNames_", "nameDB_", "FUNCTION_NAME_PLACEHOLDER_REGEXP_", "RegExp", "workspaceToCode", "code", "blockToCode", "scrubNakedValue", "injectId", "codeString", "finish", "prefixLines", "allNestedComments", "opt_thisOnly", "scrub_", "SyntaxError", "valueToCode", "outerOrder", "innerOrder", "parensNeeded", "outerOrderClass", "innerOrderClass", "statementToCode", "addLoopTrap", "branch", "addReservedWords", "provideFunction_", "desiredName", "functionName", "codeText", "oldCodeText", "_opt_thisOnly", "defineProperties", "variableDB_", "nameDb", "shortcuts", "keyMap", "shortcut", "registeredShortcut", "addKeyMapping", "allowCollision", "shortcutName", "removeAllKeyMappings", "keyCode", "opt_allowCollision", "shortcutNames", "removeKeyMapping", "shortcutIdx", "setKeyMap", "newKeyMap", "getKeyMap", "legacyKeyMap", "getRegistry", "legacyRegistry", "serializeKeyEvent_", "getShortcutNamesByKeyCode", "getKeyCodesByShortcutName", "serializedKey", "modifier", "modifierKeys", "getModifierState", "checkModifiers_", "modifiers", "modifierKeyCode", "Shift", "Control", "Alt", "Meta", "fixedX", "fixedY", "newSurface", "blockCanvas", "bubbleCanvas", "BaseConstantProvider", "DARK_PATH_OFFSET", "MAX_BOTTOM_WIDTH", "Highlighter", "inlineSteps_", "steps_", "RTL_", "highlightConstants_", "getHighlightConstants", "highlightOffset_", "outsideCornerPaths_", "OUTSIDE_CORNER", "insideCornerPaths_", "INSIDE_CORNER", "puzzleTabPaths_", "notchPaths_", "startPaths_", "jaggedTeethPaths_", "getPath", "drawTopCorner", "drawValueInput", "belowTabHeight", "drawStatementInput", "drawRightSideRow", "rightEdge", "drawBottomRow", "cornerElem", "drawLeft", "drawInlineInput", "connectionRight", "bottomHighlightWidth", "aboveTabHeight", "BaseDrawer", "highlighter_", "setHighlightPath", "HighlightConstantProvider", "constantProvider", "makeInsideCorner", "makeOutsideCorner", "distance45outside", "SQRT1_2", "pathTopRtl", "pathBottomRtl", "pathBottomLtr", "distance45inside", "topLeftCornerHighlightRtl", "topLeftCornerHighlightLtr", "bottomLeftStartY", "bottomLeftPath", "highlightRtlUp", "highlightRtlDown", "verticalOverlap", "highlightLtrUp", "highlightLtrDown", "hatHeight", "pathRtl", "pathLtr", "BaseInlineInput", "BaseStatementInput", "BaseRenderInfo", "hasExternalInputs", "nextRightEdge", "rowNextRightEdges", "prevInput", "prevRightEdge", "heightWithoutHat", "diff", "BasePathObject", "colourDark", "svgPathDark", "svgPathLight", "BaseRenderer", "makeHighlightConstants_", "GRID_UNIT", "CURSOR_RADIUS", "HEXAGONAL", "SQUARE", "SHAPE_IN_SHAPE_PADDING", "SELECTED_GLOW_COLOUR", "SELECTED_GLOW_SIZE", "REPLACEMENT_GLOW_COLOUR", "REPLACEMENT_GLOW_SIZE", "selectedGlowFilterId", "selectedGlowFilter_", "replacementGlowFilterId", "SQUARED", "ROUNDED", "replacementGlowFilter_", "STATEMENT_INPUT_SPACER_MIN_WIDTH", "MAX_DYNAMIC_CONNECTION_SHAPE_WIDTH", "makeHexagonal", "makeRounded", "makeSquared", "rightWidth", "selectedGlowSize", "replacementGlowSize", "pathRightDown", "pathRightUp", "blockHeight", "remainingHeight", "maxHeight", "_height", "curveWidth", "quarterHeight", "innerTopRightCorner", "innerBottomRightCorner", "pathTopRight", "pathBottomRight", "selectedGlowFilter", "selectedComponentTransfer", "replacementGlowFilter", "replacementComponentTransfer", "beginDrawing", "outputShapeType", "endDrawing", "hasStatementInput", "drawFlatTop_", "drawRightDynamicConnection_", "drawFlatBottom_", "drawLeftDynamicConnection_", "cornerHeight", "setOutlinePath", "connectedBottomNextConnection", "BaseBottomRow", "RightConnectionShape", "BaseTopRow", "isMultiRow", "rightAlignedDummyInputs_", "adjustXPosition_", "alignmentDivider", "notchTotalWidth", "minXPos", "prevSpacer", "nextSpacer", "hasPrevNotch", "hasNextNotch", "prevInRowSpacer", "finalizeOutputConnection_", "outputConnectionShape", "rightConnectionWidth", "finalizeHorizontalAlignment_", "totalNegativeSpacing", "lastElem", "leftNegPadding", "getNegativeSpacing_", "firstElem", "rightNegPadding", "minBlockWidth", "outerShape", "innerShape", "finalizeVerticalAlignment_", "firstRow", "hasSingleTextOrImageField", "hasNonShadowConnectedBlocks", "minVerticalTightNestingHeight", "BaseMarkerSvg", "markerCircle_", "showWithInputOutput_", "offsetInBlock", "positionCircle_", "svgPathSelected_", "outlines", "remainingOutlines", "outline", "getOutlinePath_", "removeOutlinePath_", "ProcedureSerializer", "procState", "VariableSerializer", "variableStates", "varState", "exceptions", "priorities", "WIN_KEY_FF_LINUX", "MAC_ENTER", "TAB", "NUM_CENTER", "ENTER", "PAUSE", "CAPS_LOCK", "SPACE", "PAGE_UP", "PAGE_DOWN", "END", "HOME", "PLUS_SIGN", "PRINT_SCREEN", "INSERT", "ZERO", "ONE", "TWO", "THREE", "FOUR", "FIVE", "SIX", "SEVEN", "EIGHT", "NINE", "FF_SEMICOLON", "FF_EQUALS", "FF_DASH", "FF_HASH", "QUESTION_MARK", "AT_SIGN", "A", "B", "D", "E", "F", "H", "I", "J", "K", "L", "M", "N", "O", "P", "Q", "R", "S", "T", "U", "W", "WIN_KEY_RIGHT", "CONTEXT_MENU", "NUM_ZERO", "NUM_ONE", "NUM_TWO", "NUM_THREE", "NUM_FOUR", "NUM_FIVE", "NUM_SIX", "NUM_SEVEN", "NUM_EIGHT", "NUM_NINE", "NUM_MULTIPLY", "NUM_PLUS", "NUM_MINUS", "NUM_PERIOD", "NUM_DIVISION", "F1", "F2", "F3", "F4", "F5", "F6", "F7", "F8", "F9", "F10", "F11", "F12", "NUMLOCK", "SCROLL_LOCK", "FIRST_MEDIA_KEY", "LAST_MEDIA_KEY", "SEMICOLON", "DASH", "EQUALS", "COMMA", "PERIOD", "SLASH", "APOSTROPHE", "TILDE", "SINGLE_QUOTE", "OPEN_SQUARE_BRACKET", "BACKSLASH", "CLOSE_SQUARE_BRACKET", "WIN_KEY", "MAC_FF_META", "MAC_WK_CMD_LEFT", "MAC_WK_CMD_RIGHT", "WIN_IME", "VK_NONAME", "PHANTOM", "Zelos", "ToolboxItem", "toolboxItemDef", "parentToolbox", "level_", "getLevel", "toolboxItemDef_", "parentToolbox_", "getClickTarget", "isCollapsible", "setVisible_", "_isVisible", "ToolboxCategory", "categoryDef", "labelDom_", "iconDom_", "rowContents_", "rowDiv_", "htmlDiv_", "isDisabled_", "isHidden_", "flyoutItems_", "cssConfig_", "makeDefaultCssConfig_", "parseCategoryDef_", "parseContents_", "createDom_", "flyoutItem", "itemDef", "getColour_", "createContainer_", "LEVEL", "createRowContainer_", "pointerEvents", "createRowContentsContainer_", "createIconDom_", "createLabelDom_", "LABELLEDBY", "addColourBorder_", "rowDiv", "nestedPadding", "paddingRight", "paddingLeft", "contentsContainer", "toolboxIcon", "isHorizontal", "toolboxLabel", "borderWidth", "borderRight", "borderLeft", "styleName", "getColourfromStyle_", "parseColour_", "colourValue", "openIcon_", "iconDiv", "closedIconClass", "closeIcon_", "openIconClass", "getSelectedItem", "clearSelection", "allAncestorsExpanded_", "category", "isExpanded", "isSelected", "defaultBackgroundColour", "setDisabled", "isDisabled", "getContents", "updateFlyoutContents", "newDefinition", "kind", "custom", "categorystyle", "cssconfig", "hidden", "ToolboxSeparator", "separatorDef", "CollapsibleToolboxCategory", "subcategoriesDiv_", "expanded_", "toolboxItems_", "cssConfig", "prevIsFlyoutItem", "createToolboxItem_", "ToolboxItemClass", "setExpanded", "subCategories", "getChildToolboxItems", "createSubCategoriesDom_", "subcategories", "newCategory", "newCategoryDiv", "handleToolboxItemResize", "childToolboxItems", "toggleExpanded", "Toolbox", "contentsDiv_", "HtmlDiv", "contents_", "previouslySelectedItem_", "selectedItem_", "boundEvents_", "toolboxDef_", "horizontalLayout_", "contentMap_", "createFlyout_", "themeManager", "createContentsContainer_", "attachEvents_", "toolboxContainer", "flexDirection", "clickEvent", "onClick_", "keyDownEvent", "onKeyDown_", "itemId", "getToolboxItemById", "setSelectedItem", "selectNext_", "selectPrevious_", "selectParent_", "selectChild_", "renderContents_", "fragment", "createDocumentFragment", "addToolboxItem_", "toolboxItemDom", "getToolboxItems", "toolboxRect", "_couldConnect", "updateCursorDeleteStyle_", "getPreviouslySelectedItem", "workspaceMetrics", "toolboxDiv", "childAsCategory", "shouldDeselectItem_", "deselectItem_", "shouldSelectItem_", "selectItem_", "updateFlyout_", "fireSelectEvent_", "selectItemByPosition", "oldElement", "collapsibleItem", "nextItemIdx", "nextItem", "prevItemIdx", "prevItem", "Trashcan", "isLidOpen", "minOpenness_", "lidTask_", "svgLid_", "top_", "left_", "lidOpen_", "initialized_", "flyoutWorkspaceOptions", "onDelete_", "BODY_HEIGHT", "LID_HEIGHT", "SPRITE_LEFT", "SPRITE_TOP", "blockMouseDownWhenOpenable_", "click", "mouseOver_", "mouseOut_", "animateLid_", "setLidOpen", "hasContents_", "contentsIsOpen", "openFlyout", "string", "blocklyStyle", "fireUiEvent_", "closeFlyout", "emptyContents", "setMinOpenness_", "trashRect", "MARGIN_HOTSPOT", "frames", "ANIMATION_FRAMES", "setLidAngle_", "MAX_LID_ANGLE", "OPACITY_MIN", "OPACITY_MAX", "ANIMATION_LENGTH", "lidAngle", "openAtRight", "newMin", "closeLid", "trashcanOpen", "cleanedJson", "cleanBlockJson_", "HAS_BLOCKS_LID_ANGLE", "cleanRec", "getInjectionDivXY_", "aria", "arrayUtils", "browserEvents", "deprecation", "extensions", "idGenerator", "math", "parsing", "stringUtils", "svgMath", "svgPaths", "userAgent", "VERSION", "ALIGN_LEFT", "ALIGN_CENTRE", "ALIGN_RIGHT", "DUMMY_INPUT", "TOOLBOX_AT_TOP", "TOOLBOX_AT_BOTTOM", "TOOLBOX_AT_LEFT", "TOOLBOX_AT_RIGHT", "VARIABLE_CATEGORY_NAME", "VARIABLE_DYNAMIC_CATEGORY_NAME", "PROCEDURE_CATEGORY_NAME", "Workspace.prototype.newBlock", "WorkspaceSvg.prototype.newBlock", "WorkspaceSvg.newTrashcan", "WorkspaceCommentSvg.prototype.showContextMenu", "Mutator.prototype.newWorkspaceSvg", "Names.prototype.populateProcedures", "flattenedProcedures", "DropDownDiv", "dropDownDiv", "connectionTypes", "ContextMenu", "ContextMenuItems", "Css", "Events", "Extensions", "ShortcutItems", "Themes", "Tooltip", "Touch", "VariablesDynamic", "WidgetDiv", "Xml", "blockAnimations", "blockRendering", "bumpObjects", "clipboard", "common", "dialog", "fieldRegistry", "geras", "minimalist", "serialization", "thrasos", "uiPosition", "utils", "zelos", "Blockly", "eventUtils", "newAlert", "newConfirm", "newPrompt", "HSV_SATURATION", "HSV_VALUE", "record", "DIV"]
}
